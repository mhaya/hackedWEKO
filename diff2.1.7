Only in hackedWEKO/repository/: .svn
Only in hackedWEKO/repository/action/edit/item: detail
Only in hackedWEKO/repository/action/main/item: selecttype
diff -r repository/action/main/sword/SwordUpdate.class.php hackedWEKO/repository/action/main/sword/SwordUpdate.class.php
4c4
< // $Id: SwordUpdate.class.php 42605 2014-10-03 01:02:01Z keiya_sugimoto $
---
> // $Id: SwordUpdate.class.php 640 2014-10-24 08:07:50Z ivis $
645c645
<                         "\" xmlns:sword=\""    . htmlspecialchars_self("http://purl.org/net/sword/") .
---
>                         "\" xmlns:sword=\""    . htmlspecialchars_self("http://purl.org/net/sword/terms/") .
diff -r repository/action/main/sword/SwordUtility.class.php hackedWEKO/repository/action/main/sword/SwordUtility.class.php
4c4
< // $Id: SwordUtility.class.php 24783 2013-08-20 07:31:46Z yuko_nakao $
---
> // $Id: SwordUtility.class.php 562 2014-04-14 01:03:17Z ivis $
130c130,131
< 	    $root['version']         = 2.0;								// Server Version
---
> 		// V2.0 : The SWORD server MUST specify the sword:version element with a value of 2.0
> 	    $root['version']         = '2.0';								// Server Version
diff -r repository/action/main/sword/servicedocument/Servicedocument.class.php hackedWEKO/repository/action/main/sword/servicedocument/Servicedocument.class.php
127c127
<         $str .="<service xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns=\"http://www.w3.org/2007/app\" xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:sword=\"http://purl.org/net/sword/\">" . "\n";
---
>         $str .="<service xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns=\"http://www.w3.org/2007/app\" xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:sword=\"http://purl.org/net/sword/terms/\">" . "\n";
Only in hackedWEKO/repository/files/images/blue: 88x31(1).png
Only in hackedWEKO/repository/files/images/blue: 88x31(2).png
Only in hackedWEKO/repository/files/images/blue: 88x31(3).png
Only in hackedWEKO/repository/files/images/blue: 88x31(4).png
Only in hackedWEKO/repository/files/images/blue: 88x31(5).png
Only in hackedWEKO/repository/files/images/blue: 88x31(6).png
Only in hackedWEKO/repository/files/images/blue: add_file.gif
Only in hackedWEKO/repository/files/images/blue: bibtex.png
Only in hackedWEKO/repository/files/images/blue: bt00_bk.gif
Only in hackedWEKO/repository/files/images/blue: bt01_bk.gif
Only in hackedWEKO/repository/files/images/blue: bt02_bk.gif
Only in hackedWEKO/repository/files/images/blue: bt_back.png
Only in hackedWEKO/repository/files/images/blue: bt_delete.png
Only in hackedWEKO/repository/files/images/blue: bt_next.png
Only in hackedWEKO/repository/files/images/blue: bt_upload.png
Only in hackedWEKO/repository/files/images/blue: btn03_bk.gif
Only in hackedWEKO/repository/files/images/blue: btn_delete.gif
Only in hackedWEKO/repository/files/images/blue: btn_delete_hover.gif
Only in hackedWEKO/repository/files/images/blue: btn_white.gif
Only in hackedWEKO/repository/files/images/blue: btn_white_hover.gif
Only in hackedWEKO/repository/files/images/blue: check.png
Only in hackedWEKO/repository/files/images/blue: down_displayseq.jpg
Only in hackedWEKO/repository/files/images/blue: down_displayseq.png
Only in hackedWEKO/repository/files/images/blue: download_list.png
Only in hackedWEKO/repository/files/images/blue: export.png
Only in hackedWEKO/repository/files/images/blue: file.png
Only in hackedWEKO/repository/files/images/blue: heading_bg.jpg
Only in hackedWEKO/repository/files/images/blue: help.png
Only in hackedWEKO/repository/files/images/blue: icon_help.gif
Only in hackedWEKO/repository/files/images/blue: icon_keyword.gif
Only in hackedWEKO/repository/files/images/blue: item_select_type_1.gif
Only in hackedWEKO/repository/files/images/blue: item_select_type_2.gif
Only in hackedWEKO/repository/files/images/blue: item_select_type_3.gif
Only in hackedWEKO/repository/files/images/blue: item_select_type_4.gif
Only in hackedWEKO/repository/files/images/blue: item_select_type_5.gif
Only in hackedWEKO/repository/files/images/blue: keyword_ui.gif
Only in hackedWEKO/repository/files/images/blue: newitem1.gif
Only in hackedWEKO/repository/files/images/blue: newitem2.gif
Only in hackedWEKO/repository/files/images/blue: newitem3.gif
Only in hackedWEKO/repository/files/images/blue: oai_ore.png
Only in hackedWEKO/repository/files/images/blue: oai_pmh.png
Only in hackedWEKO/repository/files/images/blue: onto.png
Only in hackedWEKO/repository/files/images/blue: page_next.gif
Only in hackedWEKO/repository/files/images/blue: page_prev.gif
Only in hackedWEKO/repository/files/images/blue: print.png
Only in hackedWEKO/repository/files/images/blue: rank-1.png
Only in hackedWEKO/repository/files/images/blue: rank-2.png
Only in hackedWEKO/repository/files/images/blue: rank-3.png
Only in hackedWEKO/repository/files/images/blue: rank1_bk.gif
Only in hackedWEKO/repository/files/images/blue: rank2_bk.gif
Only in hackedWEKO/repository/files/images/blue: rank3_bk.gif
Only in hackedWEKO/repository/files/images/blue: rank4_bk.gif
Only in hackedWEKO/repository/files/images/blue: rank_bk.gif
Only in hackedWEKO/repository/files/images/blue: rss.png
Only in hackedWEKO/repository/files/images/blue: swrc.png
Only in hackedWEKO/repository/files/images/blue: tab_content_bk.gif
Only in hackedWEKO/repository/files/images/blue: th_bk.gif
Only in hackedWEKO/repository/files/images/blue: up_displayseq.jpg
Only in hackedWEKO/repository/files/images/blue: up_displayseq.png
Only in hackedWEKO/repository/files/images/default: file.png
Only in hackedWEKO/repository/files/images/green: 88x31(1).png
Only in hackedWEKO/repository/files/images/green: 88x31(2).png
Only in hackedWEKO/repository/files/images/green: 88x31(3).png
Only in hackedWEKO/repository/files/images/green: 88x31(4).png
Only in hackedWEKO/repository/files/images/green: 88x31(5).png
Only in hackedWEKO/repository/files/images/green: 88x31(6).png
Only in hackedWEKO/repository/files/images/green: add_file.gif
Only in hackedWEKO/repository/files/images/green: bibtex.png
Only in hackedWEKO/repository/files/images/green: bt00_bk.gif
Only in hackedWEKO/repository/files/images/green: bt01_bk.gif
Only in hackedWEKO/repository/files/images/green: bt02_bk.gif
Only in hackedWEKO/repository/files/images/green: bt_back.png
Only in hackedWEKO/repository/files/images/green: bt_delete.png
Only in hackedWEKO/repository/files/images/green: bt_next.png
Only in hackedWEKO/repository/files/images/green: bt_upload.png
Only in hackedWEKO/repository/files/images/green: btn03_bk.gif
Only in hackedWEKO/repository/files/images/green: btn_delete.gif
Only in hackedWEKO/repository/files/images/green: btn_delete_hover.gif
Only in hackedWEKO/repository/files/images/green: btn_white.gif
Only in hackedWEKO/repository/files/images/green: btn_white_hover.gif
Only in hackedWEKO/repository/files/images/green: check.png
Only in hackedWEKO/repository/files/images/green: down_displayseq.jpg
Only in hackedWEKO/repository/files/images/green: down_displayseq.png
Only in hackedWEKO/repository/files/images/green: download_list.png
Only in hackedWEKO/repository/files/images/green: export.png
Only in hackedWEKO/repository/files/images/green: file.png
Only in hackedWEKO/repository/files/images/green: heading_bg.jpg
Only in hackedWEKO/repository/files/images/green: help.png
Only in hackedWEKO/repository/files/images/green: icon_help.gif
Only in hackedWEKO/repository/files/images/green: icon_keyword.gif
Only in hackedWEKO/repository/files/images/green: item_select_type_1.gif
Only in hackedWEKO/repository/files/images/green: item_select_type_2.gif
Only in hackedWEKO/repository/files/images/green: item_select_type_3.gif
Only in hackedWEKO/repository/files/images/green: item_select_type_4.gif
Only in hackedWEKO/repository/files/images/green: item_select_type_5.gif
Only in hackedWEKO/repository/files/images/green: keyword_ui.gif
Only in hackedWEKO/repository/files/images/green: newitem1.gif
Only in hackedWEKO/repository/files/images/green: newitem2.gif
Only in hackedWEKO/repository/files/images/green: newitem3.gif
Only in hackedWEKO/repository/files/images/green: oai_ore.png
Only in hackedWEKO/repository/files/images/green: oai_pmh.png
Only in hackedWEKO/repository/files/images/green: onto.png
Only in hackedWEKO/repository/files/images/green: page_next.gif
Only in hackedWEKO/repository/files/images/green: page_prev.gif
Only in hackedWEKO/repository/files/images/green: print.png
Only in hackedWEKO/repository/files/images/green: rank-1.png
Only in hackedWEKO/repository/files/images/green: rank-2.png
Only in hackedWEKO/repository/files/images/green: rank-3.png
Only in hackedWEKO/repository/files/images/green: rank1_bk.gif
Only in hackedWEKO/repository/files/images/green: rank2_bk.gif
Only in hackedWEKO/repository/files/images/green: rank3_bk.gif
Only in hackedWEKO/repository/files/images/green: rank4_bk.gif
Only in hackedWEKO/repository/files/images/green: rank_bk.gif
Only in hackedWEKO/repository/files/images/green: rss.png
Only in hackedWEKO/repository/files/images/green: swrc.png
Only in hackedWEKO/repository/files/images/green: tab_content_bk.gif
Only in hackedWEKO/repository/files/images/green: th_bk.gif
Only in hackedWEKO/repository/files/images/green: up_displayseq.jpg
Only in hackedWEKO/repository/files/images/green: up_displayseq.png
Only in hackedWEKO/repository/files/images/orange: Thumbs.db
Only in hackedWEKO/repository/files/images/orange: th_bk.gif
Only in hackedWEKO/repository/files/images/pink: Thumbs.db
Only in hackedWEKO/repository/files/images/pink: tab_content_bk.gif
Only in hackedWEKO/repository/files/images/pink: th_bk.gif
Only in hackedWEKO/repository/files/images/red: Thumbs.db
Only in hackedWEKO/repository/files/images/red: tab_content_bk.gif
Only in hackedWEKO/repository/files/images/red: th_bk.gif
Only in repository/files/sword: utils.php
Only in hackedWEKO/repository/oaipmh: dicon.ini
diff -r repository/oaipmh/format/Lido.class.php hackedWEKO/repository/oaipmh/format/Lido.class.php
132c132,135
<         
---
> 
> 
>         $this->fixOutputFormat();
> 
1158a1162,1384
> 
>     /**
>      *
>      * LODO Schemaの妥当性検証パスするための暫定対応
>      *
>      **/
>     private function fixOutputFormat(){
>         $this->domDocument->normalizeDocument();
> 
>         // sequence暫定対応(lido:descriptiveMetadata)
>         $descmeta = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_DESCRIPTIVE_METADATA);
>         if($descmeta->length===1){
>             $descmeta = $descmeta->item(0);
> 
>             $obj_cls_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_CLASSIFICATION_WRAP)->item(0);
>             $obj_ident_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_IDENTIFICATION_WRAP)->item(0);
>             $event_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_WRAP)->item(0);
> $obj_rel_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_RELATION_WRAP)->item(0);
> 
>             $descmeta->removeChild($obj_cls_wrap);
>             $descmeta->removeChild($obj_ident_wrap);
>             $descmeta->removeChild($event_wrap);
>             $descmeta->removeChild($obj_rel_wrap);
> 
>             $descmeta->appendChild($obj_cls_wrap);
>             $descmeta->appendChild($obj_ident_wrap);
>             $descmeta->appendChild($event_wrap);
>             $descmeta->appendChild($obj_rel_wrap);
>         }
> 
>         // sequence暫定対応(lido:objectIdentificationWrap)
>         $obj_ident_wrap = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_IDENTIFICATION_WRAP);
>         if($obj_ident_wrap->length ===1 ){
>             $obj_ident_wrap = $obj_ident_wrap->item(0);
> 
>             $title_wrap = $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_TITLE_WRAP)->item(0);
>             $repo_wrap = $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_REPOSITORY_WRAP)->item(0);
>             $obj_desc_wrap =  $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_DESCRIPTION_WRAP)->item(0);
>             $obj_mesure_wrap = $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_MEASUREMENTS_WRAP)->item(0);
>             /*
>             $obj_ident_wrap->removeChild($title_wrap);
>             $obj_ident_wrap->removeChild($repo_wrap);
>             $obj_ident_wrap->removeChild($obj_desc_wrap);
>             $obj_ident_wrap->removeChild($obj_mesure_wrap);
>             */
>             $obj_ident_wrap->appendChild($title_wrap);
>             $obj_ident_wrap->appendChild($repo_wrap);
>             $obj_ident_wrap->appendChild($obj_desc_wrap);
>             $obj_ident_wrap->appendChild($obj_mesure_wrap);
>         }
> 
>         // sequence暫定対応(lido:objectWorkType)
>         $obj_work_type = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_WORK_TYPE);
>         foreach($obj_work_type as $node){
>             //$id = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_CONCEPT_ID);
>             $term = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_TERM);
>             if($term->length >0 ){
>                 foreach($term as $node2){
>                     //       $node->removeChild($node2);
>                     $node->appendChild($node2);
>                 }
>             }
>         }
> 
> 
>         //eventID 0..*
>         //eventType 
>         //roleInEvent 0..*
>         //eventName 0..*
>         //eventActor 0..*
>         //culture 0..*
>         //eventDate 0..*
>         //periodName 0..*
>         //eventPlace 0..*
>         //eventMethod 0..*
>         //eventMaterialsTech 0..*
>         //thingPresent 0..*
>         //relatedEventSet 0..*
>         //eventDescriptionSet 0..*
>         $eventTag = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT);
>         if($eventTag->length === 1){
>             $tmp = $eventTag->item(0);
>             //            $event_id = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_ID);
>             $event_type = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_TYPE);
>             $event_actorTag = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_ACTOR);
>             $event_date = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_DATE);
>             $period_name = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_PERIOD_NAME);
>             $event_place = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_PLACE); 
>             $event_materialstech = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_MATERIALS_TECH);
>             
>             /*
>             foreach($event_id as $node) {
>                 $tmp->appendChild($node);
>             }
>             */
>             // lido:event_type は lido:eventでは必須
>             if($event_type->length === 0 ){
>                 $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_TYPE);
>                 $tmp->appendChild($node);
>             }
>             foreach($event_type as $node) {
>                 $tmp->appendChild($node);
>             }           
>             foreach($event_actorTag as $node) {
>                 $tmp->appendChild($node);
>             }
>             foreach($event_date as $node) {
>                 $tmp->appendChild($node);
>             }
>             foreach($period_name as $node) {
>                 $tmp->appendChild($node);
>             }
>             foreach($event_place as $node) {
>                 $tmp->appendChild($node);
>             }
>             foreach($event_materialstech as $node) {
>                 $tmp->appendChild($node);
>             }
>         }
>         
>         // RecordWrap
>         $record_wrap = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_WRAP);
>         if($record_wrap->length === 1 ){
>             $tmp = $record_wrap->item(0);
>             // recordID 1..*            
>             $rec_id = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_ID);
>             // recordType            
>             $rec_type = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_TYPE);
>             // recordSource 1..*
>             $rec_src = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_SOURCE);
>             // recordRights 0..*
>             //$rec_right = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_);
> 
>             // recordInfoSet 0..*
>             $rec_infoset = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_INFO_SET);
> 
>             if($rec_id->length === 0 ){
>                 $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_ID);
>                 $tmp->appendChild($node);
>             }
> 
>             if($rec_type->length === 0){
>                 $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_TYPE);
>                 $tmp->appendChild($node);
>             }
> 
>             if($rec_src->length === 0 ){
>                 $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_SOURCE);
>                 $tmp->appendChild($node);
>             }
>             
>             $newDoc = new DOMDocument();
>             $root = $newDoc->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_WRAP);
>             $newDoc->appendChild($root);
>             foreach($rec_id as $node){
>                 $root->appendChild($newDoc->importNode($node,true));
>             }
>             foreach($rec_type as $node){
>                 $root->appendChild($newDoc->importNode($node,true));
>             }
>             foreach($rec_src as $node){
>                 $root->appendChild($newDoc->importNode($node,true));
>             }
>             
>             foreach($rec_infoset as $node){
>                 $root->appendChild($newDoc->importNode($node,true));
>             }
>             $this->deleteChildren($record_wrap->item(0));
>             $newNode = $this->domDocument->importNode($root,true);
>             $record_wrap->item(0)->parentNode->replaceChild($newNode,$record_wrap->item(0));
>             
>             
>         }
> 
>         //resourceSet
>         //resourceID 0..1
>         //resourceRepresentation 0..*
>         //resourceType 0..1
>         //resourceRelType 0..*
>         //resourcePerspective 0..*
>         //resourceDescription 0..*
>         //resourceDateTaken 0..1
>         //resourceSource 0..*
>         //rightsResource 0..*
>         $resourceSet = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_SET);
>         foreach($resourceSet as $node){
>             $res_rep = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_REPRESENTATION);
>             $res_desc = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_DESCRIPTION);
>             $res_src = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_SOURCE);
>             $res_right = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RIGHT_RESOURCE);
>             
>             foreach($res_rep as $n) {
>                 $node->appendChild($n);
>             }
>             foreach($res_desc as $n){
>                 $node->appendChild($n);
>             }
>             foreach($res_src as $n){
>                 $node->appendChild($n);
>             }
>             foreach($res_right as $n){
>                 $node->appendChild($n);
>             }
>         }
>         
>         
>         
>     }
> 
>     private function deleteNode($node) { 
>         $this->deleteChildren($node); 
>         $parent = $node->parentNode; 
>         $oldnode = $parent->removeChild($node); 
>     } 
> 
>     private function deleteChildren($node) {
>         while (isset($node->firstChild)) { 
>             $this->deleteChildren($node->firstChild); 
>             $node->removeChild($node->firstChild); 
>         } 
>     } 
> 
>     
diff -r repository/opensearch/Opensearch.class.php hackedWEKO/repository/opensearch/Opensearch.class.php
4c4
< // $Id: Opensearch.class.php 40423 2014-08-26 02:30:50Z tatsuya_koyasu $
---
> // $Id: Opensearch.class.php 610 2014-08-29 07:24:55Z ivis $
162c162,163
<                 $outputClass = new Repository_OpenSearch_Atom($this->Session, $this->Db);
---
>                 $blockid = $this->RepositoryAction->getBlockPageId();
>                 $outputClass = new Repository_OpenSearch_Atom($this->Session, $this->Db,$blockid);
217a219
> 
diff -r repository/opensearch/format/Atom.class.php hackedWEKO/repository/opensearch/format/Atom.class.php
26c26,28
<     
---
> 
> 
>     private $blockid = array();
30c32
<     public function __construct($session, $db)
---
>     public function __construct($session, $db,$blockid)
32a35
>         $this->blockid = $blockid;
185a189
> 
231c235
<             
---
> 
244a249,259
>                 //enclosure file link
>                 //リダイレクト後のURLを作成する
>                 $url = $itemData[self::DATA_FILE_URI][$jj];
>                 $url = str_replace("/?","/index.php?",$url);
>                 $url = str_replace("action=repository_uri","action=pages_view_main&active_action=repository_action_common_download",$url);
>                 $url = str_replace("file_id","attribute_id",$url);
>                 $url .= '&item_no='.$searchResult[0]['item_no'];
>                 $url .= '&page_id='.$this->blockid['page_id'].'&block_id='.$this->blockid['block_id'];
>                 
>                 $xml .= '       <link rel="enclosure" title="'.$this->RepositoryAction->forXmlChange($itemData[self::DATA_FILE_NAME][$jj]).'" type="'.$this->RepositoryAction->forXmlChange($itemData[self::DATA_MIME_TYPE][$jj]).'" href="'.$this->RepositoryAction->forXmlChange($url).'" />'.self::LF;
>                 
Only in hackedWEKO/repository/opensearch/format: Atom.class.php.org
diff -r repository/opensearch/format/FormatAbstract.class.php hackedWEKO/repository/opensearch/format/FormatAbstract.class.php
33a34
>     const DATA_FILE_NAME = "file_name";
243a245
>                         self::DATA_FILE_NAME => array(),
366a369
>                
369a373
>                    
371c375
<                     if(strlen($itemData[self::DATA_MIME_TYPE]) > 0)
---
>                     if(is_array($itemData[self::DATA_MIME_TYPE]))
378a383,385
>                         
>                         array_push($itemData[self::DATA_FILE_NAME],$itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NAME]);
> 
379a387
> 
Only in hackedWEKO/repository/opensearch/format: FormatAbstract.class.php.org
Only in hackedWEKO/repository/templates/default: repository_ebook_viewer.html
diff -r repository/templates/default/repository_item_detail.html hackedWEKO/repository/templates/default/repository_item_detail.html
3c3
< <!--// $Id: repository_item_detail.html 43252 2014-10-27 12:16:31Z keiya_sugimoto $          -->
---
> <!--// $Id: repository_item_detail.html 645 2014-10-29 12:39:52Z ivis $          -->
1153c1153
< 														<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
---
> <!--														<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
1159a1160,1178
> -->
> <!-- using iframe/img tag 2012/09/20 by mhaya start -->
> <{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
> 	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
> <{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
> <!-- 
> 	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
> -->
> 	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px /><br/>
> <{else}>
> 	<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
> 	<{if $item_attr[i][j].attribute_value[1] != ""}>
> 		<{$item_attr[i][j].attribute_value[1]}>
> 	<{else}>
> 		<{$item_attr[i][j].attribute_value[0]}>
> 	<{/if}>
>         </a><br/>
> <{/if}>
> <!-- using iframe/img tag 2012/09/20 by mhaya end -->
diff -r repository/templates/default/repository_mobile_item_detail.html hackedWEKO/repository/templates/default/repository_mobile_item_detail.html
3c3
< <!--// $Id: repository_mobile_item_detail.html 40423 2014-08-26 02:30:50Z tatsuya_koyasu $          -->
---
> <!--// $Id: repository_mobile_item_detail.html 610 2014-08-29 07:24:55Z ivis $          -->
629a630,637
> <!-- using iframe/img tag 2012/09/20 by mhaya start -->
> <{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
> 	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
> 
> <{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
> 	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
> <{else}>
> 
636a645,646
> <{/if}>
> <!-- using iframe/img tag 2012/09/20 by mhaya end -->
644a655,662
> <!-- using iframe/img tag 2012/09/20 by mhaya start -->
> <{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
> 	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
> <{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
> 	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
> <{else}>
> 
> 
651a670,672
> 
> <{/if}>
> <!-- using iframe/img tag 2012/09/20 by mhaya end -->
Only in hackedWEKO/repository/templates/default: repository_sitemap_confirm.html
diff -r repository/templates/default/smartphone/repository_item_detail.html hackedWEKO/repository/templates/default/smartphone/repository_item_detail.html
3c3
< <!--// $Id: repository_item_detail.html 43252 2014-10-27 12:16:31Z keiya_sugimoto $          -->
---
> <!--// $Id: repository_item_detail.html 645 2014-10-29 12:39:52Z ivis $          -->
897a898,899
> <!-- using iframe/img tag 2012/09/20 by mhaya start -->
> <!-- 
904a907,921
> -->
> <{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
> 	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
> <{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
> 	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
> <{else}>
> 	<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
> 	<{if $item_attr[i][j].attribute_value[1] != ""}>
> 		<{$item_attr[i][j].attribute_value[1]}>
> 	<{else}>
> 		<{$item_attr[i][j].attribute_value[0]}>
> 	<{/if}>
> 	</a><br>
> <{/if}>
> <!-- using iframe/img tag 2012/09/20 by mhaya end -->
Only in hackedWEKO/repository/view/common: tree
Only in hackedWEKO/repository/view/edit/item: embargo
Only in hackedWEKO/repository/view/main/item: ebook
