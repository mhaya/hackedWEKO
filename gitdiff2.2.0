diff --git a/repository/action/common/background/sitelicensemail/Sitelicensemail.class.php b/repository/action/common/background/sitelicensemail/Sitelicensemail.class.php
index 956ef62..249cde4 100644
--- a/repository/action/common/background/sitelicensemail/Sitelicensemail.class.php
+++ b/repository/action/common/background/sitelicensemail/Sitelicensemail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Sitelicensemail.class.php 43734 2014-11-07 03:59:44Z tatsuya_koyasu $
+// $Id: Sitelicensemail.class.php 53621 2015-05-28 12:02:01Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -91,39 +91,26 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
      * @param fileList deleted file
      */
     protected function prepareBackgroundProcess(&$sl_user_info) {
-        $this->user_authority_id = "";
-        $this->authority_id = "";
-        $this->user_id = "";
         // check login
-        $result = null;
-        $error_msg = null;
-        $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
+        $return = $this->checkExecuteAuthority();
         if($return == false){
             print("Incorrect Login!\n");
             $this->failTrans();
             $this->exitAction();
             return false;
         }
-        // check user authority id
-        if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
-            print("You do not have permission to send sitelicense mail.\n");
-            $this->failTrans();
-            $this->exitAction();
-            return false;
-        }
         
         $this->setLangResource();
         $this->smartyAssign = $this->Session->getParameter("smartyAssign");
         
-        // 機関データ取得
-        $query = "SELECT * FROM ". DATABASE_PREFIX. "repository_send_mail_sitelicense ".
-                 "ORDER BY no ASC ".
-                 "LIMIT 0,1 ;";
-        $result = $this->dbAccess->executeQuery($query);
-        if(count($result) == 0) {
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
+        
+        // サイトライセンスユーザー情報1件取得
+        $sl_user_info = $sendSitelicense->getSendSitelicenseUser();
+        if(count($sl_user_info) == 0) {
             return false;
-        } else {
-            $sl_user_info = $result;
         }
         
         return true;
@@ -136,28 +123,29 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
      * @param Array $sl_user_info
      */
     protected function executeBackgroundProcess($sl_user_info) {
-        if($sl_user_info[0]["mail_address"] != "") {
+        if(strlen($sl_user_info[0]["mail_address"]) > 0) {
             $send_zip_name = "";
             
-            $this->createFeedbackReport(WEBAPP_DIR.'/uploads/repository/tmp/', $sl_user_info[0]["start_ip_address"], $sl_user_info[0]["finish_ip_address"]);
-            $this->compressFile(WEBAPP_DIR.'/uploads/repository/tmp/', $send_zip_name);
-            $this->sendSitelicenseReport(WEBAPP_DIR.'/uploads/repository/', $send_zip_name, $sl_user_info[0]["mail_address"], $sl_user_info[0]["organization_name"]);
+            $this->createFeedbackReport($sl_user_info[0]["organization_id"]);
+            $this->compressFile($send_zip_name);
+            $this->sendSitelicenseReport($send_zip_name, $sl_user_info[0]["mail_address"], $sl_user_info[0]["organization_name"]);
         }
+        // 送信が終わったサイトライセンスユーザー情報を削除する
         $this->deleteSitelicenseUserInfo($sl_user_info);
     }
     
     /** 
      * create feedback report
      * 
-     * @param string $tmp_dir
-     * @param string $start_ip
-     * @param string $finish_ip
+     * @param int $sitelicense_id
      */
-    private function createFeedbackReport($tmp_dir, $start_ip, $finish_ip) {
+    private function createFeedbackReport($sitelicense_id) {
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
+        
         // 一時ディレクトリが存在しない場合作成する
-	    if(!file_exists($tmp_dir)) {
-            mkdir( $tmp_dir, 0777 );
-        }
+        $sendSitelicense = $sendSitelicense->createSitelicenseMailTmpDir();
         
         // レポート作成に必要なパラメータを作成する
         // サイトライセンスログの範囲を指定する
@@ -173,25 +161,37 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
         $params[] = $language;
         $result = $this->dbAccess->executeQuery($query, $params);
         $organization_name = $result[0]["conf_value"];
-        $this->createSearchReport($tmp_dir, $start_date, $finish_date, $start_ip, $finish_ip, $organization_name);
-        $this->createDownloadReport($tmp_dir, $start_date, $finish_date, $start_ip, $finish_ip, $organization_name);
-        $this->createUsagestaticsReport($tmp_dir, $start_date, $finish_date, $start_ip, $finish_ip, $organization_name);
+        
+        // 検索レポートを作成する
+        $this->createSearchReport($start_date, $finish_date, $organization_name, $sitelicense_id);       /* 中の処理をビジネスに移す予定 */
+        // ダウンロードレポートを作成する
+        $this->createDownloadReport($start_date, $finish_date, $organization_name, $sitelicense_id);
+        // 利用統計レポートを作成する
+        $this->createUsagestaticsReport($start_date, $finish_date, $organization_name, $sitelicense_id);
     }
     
     /** 
      * create search log report
      * 
-     * @param string $tmp_dir
-     * @param string $start_ip
-     * @param string $finish_ip
+     * @param string $start_date
+     * @param string $finish_date
+     * @param string $organization_name
+     * @param int    $sitelicense_id
      */
-    private function createSearchReport($tmp_dir, $start_date, $finish_date, $start_ip, $finish_ip, $organization_name) {
+    private function createSearchReport($start_date, $finish_date, $organization_name, $sitelicense_id) {
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
+        
+        // 検索回数デフォルト値
         $search_count = 0;
-        $result = $this->getSearchKeywordPerMonthly($start_date, $finish_date, $start_ip, $finish_ip);
-        if(strlen($result[0]["COUNT(record_date)"]) != 0) {
-            $search_count = $result[0]["COUNT(record_date)"];
+        // 指定した機関のサイトライセンスユーザーによる検索ログの件数を取得する
+        $result = $sendSitelicense->getLogCountBySitelicenseId($start_date, $finish_date, $sitelicense_id, RepositoryConst::LOG_OPERATION_SEARCH);
+        if(isset($result) && count($result) > 0) {
+            $search_count = $result[0]["COUNT(LOG.record_date)"];
         }
-        $log_file = $tmp_dir. "SearchReport_".date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).".tsv";
+        // レポート文面の作成
+        $log_file = "SearchReport_".date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).".tsv";
         $report_header = $this->smartyAssign->getLang("repository_sitelicense_mail_body_title")."\t".$organization_name."\r\n".
                          $this->smartyAssign->getLang("repository_sitelicense_mail_body_create_date")."\t".date("Y-m-d")."\r\n".
                          $this->smartyAssign->getLang("repository_sitelicense_mail_body_month")."\t".date("Y-m", mktime(0, 0, 0, date("m") - 1, 1, date("Y")))."\r\n".
@@ -203,27 +203,29 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
         
         $report = $report_header. $report_body;
         
-        $BOM = pack('C*',0xEF,0xBB,0xBF);
-        $log_report = fopen($log_file, "w");
-        fwrite($log_report, $BOM.$report);
-        fclose($log_report);
+        // レポートファイル作成
+        $sendSitelicense->createReport($log_file, $report);
     }
     
     /** 
      * create download log report
      * 
-     * @param string $tmp_dir
-     * @param string $start_ip
-     * @param string $finish_ip
+     * @param string $start_date
+     * @param string $finish_date
+     * @param string $organization_name
+     * @param int    $sitelicense_id
      */
-    private function createDownloadReport($tmp_dir, $start_date, $finish_date, $start_ip, $finish_ip, $organization_name) {
-        $result = $this->getUsagePerJournalPerMonthly($start_date, $finish_date, $start_ip, $finish_ip);
-        
+    private function createDownloadReport($start_date, $finish_date, $organization_name, $sitelicense_id) {
+        // ダウンロード合計回数デフォルト値
         $sum_download = 0;
+        // 指定した機関のサイトライセンスユーザーによる利用統計情報を取得する
+        $result = $this->getUsagePerJournalPerMonthly($start_date, $finish_date, $sitelicense_id);
+        
+        // レポート文面の作成
         for($ii = 0; $ii < count($result["index_info"]);  $ii++) {
             $sum_download += intval($result["index_info"][$ii]["download"]);
         }
-        $log_file = $tmp_dir. "DownloadReport_".date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).".tsv";
+        $log_file = "DownloadReport_".date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).".tsv";
         $report_header = $this->smartyAssign->getLang("repository_sitelicense_mail_body_title")."\t".$organization_name."\r\n".
                          $this->smartyAssign->getLang("repository_sitelicense_mail_body_create_date")."\t".date("Y-m-d")."\r\n".
                          $this->smartyAssign->getLang("repository_sitelicense_mail_body_month")."\t".date("Y-m", mktime(0, 0, 0, date("m") - 1, 1, date("Y")))."\r\n".
@@ -251,24 +253,28 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
         }
         $report = $report_header. $report_body;
         
-        $BOM = pack('C*',0xEF,0xBB,0xBF);
-        $log_report = fopen($log_file, "w");
-        fwrite($log_report, $BOM.$report);
-        fclose($log_report);
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
         
+        // レポートファイル作成
+        $sendSitelicense->createReport($log_file, $report);
     }
     
     /** 
      * create usage statistics report
      * 
-     * @param string $tmp_dir
-     * @param string $start_ip
-     * @param string $finish_ip
+     * @param string $start_date
+     * @param string $finish_date
+     * @param string $organization_name
+     * @param int    $sitelicense_id
      */
-    private function createUsagestaticsReport($tmp_dir, $start_date, $finish_date, $start_ip, $finish_ip, $organization_name) {
-        $result = $this->getUsagePerJournalPerMonthly($start_date, $finish_date, $start_ip, $finish_ip);
+    private function createUsagestaticsReport($start_date, $finish_date, $organization_name, $sitelicense_id) {
+        // 指定した機関のサイトライセンスユーザーによる利用統計情報を取得する
+        $result = $this->getUsagePerJournalPerMonthly($start_date, $finish_date, $sitelicense_id);
         
-        $log_file = $tmp_dir. "UsagestatisticsReport_".date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).".tsv";
+        // レポート文面の作成
+        $log_file = "UsagestatisticsReport_".date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).".tsv";
         $report_header = $this->smartyAssign->getLang("repository_sitelicense_mail_body_title")."\t".$organization_name."\r\n".
                          $this->smartyAssign->getLang("repository_sitelicense_mail_body_create_date")."\t".date("Y-m-d")."\r\n".
                          $this->smartyAssign->getLang("repository_sitelicense_mail_body_month")."\t".date("Y-m", mktime(0, 0, 0, date("m") - 1, 1, date("Y")))."\r\n".
@@ -297,36 +303,12 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
         }
         $report = $report_header. $report_body;
         
-        $BOM = pack('C*',0xEF,0xBB,0xBF);
-        $log_report = fopen($log_file, "w");
-        fwrite($log_report, $BOM.$report);
-        fclose($log_report);        
-    }
-    
-    /** 
-     * get search keyword per monthly
-     * 
-     * @param string $start_date
-     * @param string $finish_date
-     * @param string $start_ip
-     * @param string $finish_ip
-     */
-    private function getSearchKeywordPerMonthly($start_date, $finish_date, $start_ip, $finish_ip) {
-        $query = "SELECT *,COUNT(record_date),". Repository_Components_Loganalyzor::dateformatMonthlyQuery(""). 
-                 " FROM ". Repository_Components_Loganalyzor::execlusiveDoubleAccessSubQuery(RepositoryConst::LOG_OPERATION_SEARCH, "", $start_date, $finish_date, RepositoryConst::LOG_OPERATION_SEARCH). 
-                 " WHERE record_date >= ? ".
-                 Repository_Components_Loganalyzor::execlusiveIpAddressQuery(""). 
-                 Repository_Components_Loganalyzor::execlusiveRobotsQuery(""). 
-                 " AND operation_id = ? ". 
-                 $this->getTargetIpAddressRangeQuery($start_ip, $finish_ip, ""). 
-                 Repository_Components_Loganalyzor::perMonthlyQuery(). " ;";
-        $params = array();
-        $params[] = $start_date;
-        $params[] = RepositoryConst::LOG_OPERATION_SEARCH;
-        
-        $result = $this->dbAccess->executeQuery($query, $params);
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
         
-        return $result;
+        // レポートファイル作成
+        $sendSitelicense->createReport($log_file, $report);
     }
     
     /** 
@@ -334,24 +316,32 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
      * 
      * @param string $start_date
      * @param string $finish_date
-     * @param string $start_ip
-     * @param string $finish_ip
+     * @param int    $sitelicense_id
      */
-    private function getUsagePerJournalPerMonthly($start_date, $finish_date, $start_ip, $finish_ip) {
+    private function getUsagePerJournalPerMonthly($start_date, $finish_date, $sitelicense_id) {
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
+        
+        // 統計情報配列にISSN情報設定
+        $online_issn = $sendSitelicense->getOnlineIssn();
+        if(count($online_issn) == 0) {
+            return array();
+        }
         $statistics = array();
-        $query = "SELECT issn, jtitle, jtitle_en, set_spec ".
-                 "FROM ". DATABASE_PREFIX. "repository_issn ".
-                 "WHERE is_delete = ? ;";
-        $params = array();
-        $params[] = 0;
-        $statistics["index_info"] = $this->dbAccess->executeQuery($query, $params);
-
-        $issn = array("");
+        $statistics["index_info"] = $online_issn;
+        
+        // クエリパラメータ用のISSN文字列を作成する
+        $issn_param = "";
         for($ii = 0; $ii < count($statistics["index_info"]); $ii++) {
-            $issn[] = $statistics["index_info"][$ii]["issn"];
+            if($ii > 0) {
+                $issn_param .= ",";
+            }
+            $issn_param .= "'". $statistics["index_info"][$ii]["issn"]. "'";
         }
-        // set download values group by issn
-        $download_result = $this->getItemsDownloadPerMonthly($issn, $start_date, $finish_date, $start_ip, $finish_ip);
+        
+        // ISSN毎のダウンロードログ取得
+        $download_result = $sendSitelicense->getLogBySitelicenseId($issn_param, $start_date, $finish_date, $sitelicense_id, RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE);
         for($ii = 0; $ii < count($statistics["index_info"]); $ii++) {
             // initialize value of downlooad
             $statistics["index_info"][$ii]["download"] = 0;
@@ -362,8 +352,8 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
             }
         }
         
-        // set view values group by issn
-        $view_result = $this->getItemsViewPerMonthly($issn, $start_date, $finish_date, $start_ip, $finish_ip);
+        // ISSN毎の閲覧ログ取得
+        $view_result = $sendSitelicense->getLogBySitelicenseId($issn_param, $start_date, $finish_date, $sitelicense_id, RepositoryConst::LOG_OPERATION_DETAIL_VIEW);
         for($ii = 0; $ii < count($statistics["index_info"]); $ii++) {
             // initialize value of view
             $statistics["index_info"][$ii]["view"] = 0;
@@ -378,140 +368,20 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
     }
     
     /** 
-     * get item download records per month
-     * 
-     * @param string $issn
-     * @param string $start_date
-     * @param string $finish_date
-     */
-    private function getItemsDownloadPerMonthly($issn, $start_date, $finish_date, $start_ip, $finish_ip) {
-        $online_issn = "";
-        for($ii = 0; $ii < count($issn); $ii++) {
-            if($ii != 0) {
-                $online_issn .= ",";
-            }
-            $online_issn .= "'". $issn[$ii]. "'";
-        }
-        $query = "SELECT COUNT(DISTINCT LOG.record_date), ". 
-                 " IDX.online_issn, ".
-                 Repository_Components_Loganalyzor::dateformatMonthlyQuery("LOG").
-                 " FROM (". Repository_Components_Loganalyzor::execlusiveDoubleAccessSubQuery(RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE, "", $start_date, $finish_date, RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE). ") AS LOG, ".
-                        DATABASE_PREFIX. "repository_index AS IDX, ".
-                        DATABASE_PREFIX. "repository_position_index AS POS, ".
-                        DATABASE_PREFIX. "repository_item AS ITEM ".
-                 " WHERE LOG.record_date >= ? ".
-                 " AND LOG.record_date <= ? ".
-                 " ". Repository_Components_Loganalyzor::execlusiveIpAddressQuery("LOG").
-                 " ". Repository_Components_Loganalyzor::execlusiveRobotsQuery("LOG").
-                 " AND LOG.operation_id = ? ".
-                 " AND IDX.biblio_flag = ? ".
-                 " AND IDX.online_issn IN ( ". $online_issn. " ) ".
-                 " AND IDX.index_id = POS.index_id ".
-                 " AND POS.item_id = LOG.item_id ".
-                 " AND POS.item_id = ITEM.item_id ".
-                 $this->getTargetIpAddressRangeQuery($start_ip, $finish_ip, "LOG").
-                 $this->getExclusiveSitelicenseItemtype("ITEM").
-                 " ". Repository_Components_Loganalyzor::perMonthlyQuery(). ", IDX.online_issn ;";
-        $params = array();
-        $params[] = $start_date;
-        $params[] = $finish_date;
-        $params[] = RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE;
-        $params[] = 1;
-        
-        $result = $this->dbAccess->executeQuery($query, $params);
-        
-        return $result;
-    }
-    
-    /** 
-     * get item view records per month
-     * 
-     * @param string $issn
-     * @param string $start_date
-     * @param string $finish_date
-     */
-    private function getItemsViewPerMonthly($issn, $start_date, $finish_date, $start_ip, $finish_ip) {
-        $online_issn = "";
-        for($ii = 0; $ii < count($issn); $ii++) {
-            if($ii != 0) {
-                $online_issn .= ",";
-            }
-            $online_issn .= "'". $issn[$ii]. "'";
-        }
-    
-        $query = "SELECT COUNT(DISTINCT LOG.record_date), ".
-                 " IDX.online_issn, ".
-                 Repository_Components_Loganalyzor::dateformatMonthlyQuery("LOG").
-                 " FROM ". Repository_Components_Loganalyzor::execlusiveDoubleAccessSubQuery(RepositoryConst::LOG_OPERATION_DETAIL_VIEW, "", $start_date, $finish_date, RepositoryConst::LOG_OPERATION_DETAIL_VIEW). " AS LOG, ".
-                        DATABASE_PREFIX. "repository_index AS IDX, ".
-                        DATABASE_PREFIX. "repository_position_index AS POS, ".
-                        DATABASE_PREFIX. "repository_item AS ITEM ".
-                 " WHERE LOG.record_date >= ? ".
-                 " AND LOG.record_date <= ? ".
-                 " ". Repository_Components_Loganalyzor::execlusiveIpAddressQuery("LOG").
-                 " ". Repository_Components_Loganalyzor::execlusiveRobotsQuery("LOG").
-                 " AND LOG.operation_id = ? ".
-                 " AND IDX.biblio_flag = ? ".
-                 " AND IDX.online_issn IN ( ". $online_issn. " ) ".
-                 " AND IDX.index_id = POS.index_id ".
-                 " AND POS.item_id = LOG.item_id ".
-                 " AND POS.item_id = ITEM.item_id ".
-                 $this->getTargetIpAddressRangeQuery($start_ip, $finish_ip, "LOG").
-                 $this->getExclusiveSitelicenseItemtype("ITEM").
-                 " ". Repository_Components_Loganalyzor::perMonthlyQuery(). ", IDX.online_issn ;";
-        $params = array();
-        $params[] = $start_date;
-        $params[] = $finish_date;
-        $params[] = RepositoryConst::LOG_OPERATION_DETAIL_VIEW;
-        $params[] = 1;
-        
-        $result = $this->dbAccess->executeQuery($query, $params);
-
-        return $result;
-        
-    }
-    
-    /** 
-     * make ip range query parts
-     * 
-     * @param stirng $start_ip
-     * @param string $finish_ip
-     * @param string $abbreviation
-     */
-    private function getTargetIpAddressRangeQuery($start_ip, $finish_ip, $abbreviation) {
-        $query_parts_ip = "";
-        if($abbreviation == "") {
-            $query_parts_ip = " AND numeric_ip_address >= ". $start_ip.
-                              " AND numeric_ip_address <= ". $finish_ip;
-        } else {
-            $query_parts_ip = " AND ". $abbreviation. ".numeric_ip_address >= ".$start_ip.
-                              " AND ". $abbreviation. ".numeric_ip_address <= ". $finish_ip;
-        }
-        
-        return $query_parts_ip;
-    }
-    
-    /** 
      * compress file
      * 
-     * @param string $dir_path
+     * @param string &$zip_file
      */
-    private function compressFile($dir_path, &$zip_file) {
-        $output_files = array($dir_path);
+    private function compressFile(&$zip_file) {
         // set zip file name
         $zip_file = "SiteLicenseUserReport_". date("Ym", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))). ".zip";
-        // compress zip file	
-        File_Archive::extract(
-            $output_files,
-            File_Archive::toArchive($zip_file, File_Archive::toFiles(WEBAPP_DIR.'/uploads/repository/'))
-        );
-        if ($handle = opendir($dir_path)) {
-            while (false !== ($file = readdir($handle))) {
-                unlink($dir_path. $file);
-            }
-        closedir($handle);
-        $this->removeDirectory($dir_path);
-        }
+        
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
+        
+        // compress zip file
+        $sendSitelicense->compressToZip($zip_file);
     }
     
     /** 
@@ -521,27 +391,35 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
      * @param string $mail_address
      * @param string $organization_name
      */
-    private function sendSitelicenseReport($file_path, $file_name, $mail_address, $organization_name) {
-        // サイト名と管理者メールアドレスを取得する
-        $query = "SELECT conf_value FROM ". DATABASE_PREFIX. "config ".
+    private function sendSitelicenseReport($file_name, $mail_address, $organization_name) {
+        $file_path = WEBAPP_DIR. "/uploads/repository/";
+        
+        // サイト名を取得する
+        $language = $this->Session->getParameter("_lang");
+        $query = "SELECT conf_value FROM ". DATABASE_PREFIX. "config_language ".
                  "WHERE conf_name = ? ".
-                 "OR conf_name = ? ".
-                 "ORDER BY conf_id ASC ;";
+                 "AND lang_dirname = ? ;";
         $params = array();
         $params[] = "sitename";
+        $params[] = $language;
+        $site_name = $this->dbAccess->executeQuery($query, $params);
+        // 管理者メールアドアレスを取得する
+        $query = "SELECT conf_value FROM ". DATABASE_PREFIX. "config ".
+                 "WHERE conf_name = ? ;";
+        $params = array();
         $params[] = "from";
-        $result = $this->dbAccess->executeQuery($query, $params);
+        $admin_mail = $this->dbAccess->executeQuery($query, $params);
         
         // タイトル
-        $sub = "[". $result[0]["conf_value"]. "] ".
+        $sub = "[". $site_name[0]["conf_value"]. "] ".
                date("Y-m", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).
                " ".$this->smartyAssign->getLang("repository_sitelicense_mail_subject");
         $this->mailMain->setSubject($sub);
         // 本文
         $body = sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_body_dear"), $organization_name)."\n\n".
-                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_body_thank"), $result[0]["conf_value"])."\n".
-                date("Y-m", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))).$this->smartyAssign->getLang("repository_sitelicense_mail_body_announcement")."\n\n".
-                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_body_unnecessary"), $result[1]["conf_value"])."\n\n\n".
+                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_body_thank"), $site_name[0]["conf_value"])."\n".
+                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_body_announcement"), date("Y-m", mktime(0, 0, 0, date("m") - 1, 1, date("Y"))))."\n\n".
+                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_body_unnecessary"), $admin_mail[0]["conf_value"])."\n\n\n".
                 $this->smartyAssign->getLang("repository_sitelicense_mail_body_explain_rule_1")."\n".
                 $this->smartyAssign->getLang("repository_sitelicense_mail_body_explain_rule_2")."\n\n".
                 $this->smartyAssign->getLang("repository_sitelicense_mail_body_explain_format")."\n\n".
@@ -553,15 +431,11 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
                 $this->smartyAssign->getLang("repository_sitelicense_mail_body_explain_usagestatistics_1")."\n".
                 $this->smartyAssign->getLang("repository_sitelicense_mail_body_explain_usagestatistics_2")."\n\n\n".
                 "------------------------------------------------"."\n".
-                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_footer_contact"), $result[0]["conf_value"])."\n".
-                $result[1]["conf_value"];
+                sprintf($this->smartyAssign->getLang("repository_sitelicense_mail_footer_contact"), $site_name[0]["conf_value"])."\n".
+                $admin_mail[0]["conf_value"];
         $this->mailMain->setBody($body);
         // 送り先
         $users = array();
-        // メールアドレスをデコード
-        $mail_address = str_replace("&#124;", "|", $mail_address);
-        $mail_address = str_replace("&#44;", ",", $mail_address);
-        $mail_address = str_replace("&#46;", ".", $mail_address);
         $users[0]["email"] = $mail_address;
         $users[0]["handle"] = $organization_name;
         $this->mailMain->setToUsers($users);
@@ -597,42 +471,45 @@ class Repository_Action_Common_Background_Sitelicensemail extends BackgroundProc
      * @param Array $sl_user_info
      */
     private function deleteSitelicenseUserInfo($sl_user_info) {
-        $query = "DELETE FROM ".DATABASE_PREFIX ."repository_send_mail_sitelicense ".
-                 "WHERE organization_name = ? ".
-                 "AND start_ip_address = ? ".
-                 "AND finish_ip_address = ? ".
-                 "AND mail_address = ? ;";
-        $params = array();
-        $params[] = $sl_user_info[0]["organization_name"];
-        $params[] = $sl_user_info[0]["start_ip_address"];
-        $params[] = $sl_user_info[0]["finish_ip_address"];
-        $params[] = $sl_user_info[0]["mail_address"];
-        $this->dbAccess->executeQuery($query, $params);
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
         
-        $this->exitAction();
+        // 1件指定して削除
+        $sendSitelicense->deleteSendSitelicenseuser($sl_user_info[0]["organization_id"]);
     }
     
-    /** 
-     * get exclusive sitelicense itemtype
-     * 
-     * @param string $abbreviation
+    /**
+     * check execute authority
+     *
+     * @return bool
      */
-    private function getExclusiveSitelicenseItemtype($abbreviation) {
-        $query = "SELECT param_value FROM ".DATABASE_PREFIX ."repository_parameter ".
-                 "WHERE param_name = ? ;";
-        $params = array();
-        $params = "site_license_item_type_id";
-        $result = $this->dbAccess->executeQuery($query, $params);
-        $item_type_id_query = "";
-        if(strlen($result[0]["param_value"]) > 0) {
-            if($abbreviation == "") {
-                $item_type_id_query = " AND item_type_id NOT IN (". $result[0]["param_value"]. ") ";
-            } else {
-                $item_type_id_query = " AND ". $abbreviation.".item_type_id NOT IN (". $result[0]["param_value"]. ") ";
-            }
+    private function checkExecuteAuthority() {
+        // Init user authorities
+        $this->user_authority_id = "";
+        $this->authority_id = "";
+        $this->user_id = "";
+        
+        // Check login
+        $result = null;
+        $error_msg = null;
+        $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
+        if($return == false) {
+            $this->failTrans();
+            $this->exitAction();
+            print("Incorrect Login!\n");
+            return false;
         }
         
-        return $item_type_id_query;
+        // Check user authority id
+        if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room) {
+            $this->failTrans();
+            $this->exitAction();
+            print("You do not have permission to update.\n");
+            return false;
+        }
+        
+        return true;
     }
 }
 ?>
\ No newline at end of file
diff --git a/repository/action/common/background/sitelicensemail/dicon.ini b/repository/action/common/background/sitelicensemail/dicon.ini
index 673397c..1f03d29 100644
--- a/repository/action/common/background/sitelicensemail/dicon.ini
+++ b/repository/action/common/background/sitelicensemail/dicon.ini
@@ -1,2 +1,3 @@
 [DIContainer]
+businessSendsitelicensemail = "modules://repository.components.business.Sendsitelicensemail"
 mailMain = "mail.main"
\ No newline at end of file
diff --git a/repository/action/common/cinii/Cinii.class.php b/repository/action/common/cinii/Cinii.class.php
index b58b346..7174a5a 100644
--- a/repository/action/common/cinii/Cinii.class.php
+++ b/repository/action/common/cinii/Cinii.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Cinii.class.php 657 2014-11-28 10:40:35Z ivis $
+// $Id: Cinii.class.php 44462 2014-11-28 02:42:41Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/common/crossdomainproxy/Crossdomainproxy.class.php b/repository/action/common/crossdomainproxy/Crossdomainproxy.class.php
index b52e73f..df318fc 100644
--- a/repository/action/common/crossdomainproxy/Crossdomainproxy.class.php
+++ b/repository/action/common/crossdomainproxy/Crossdomainproxy.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Crossdomainproxy.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Crossdomainproxy.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -19,7 +19,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.
 
 class Repository_Action_Common_Crossdomainproxy extends RepositoryAction
 {
-    function executeForWeko() {
+    function executeApp() {
         $url = html_entity_decode($_GET["ajaxRequest"]);
         
         $option = array("timeout" => 10, 
diff --git a/repository/action/common/download/Download.class.php b/repository/action/common/download/Download.class.php
index 9c468ea..20db1e3 100644
--- a/repository/action/common/download/Download.class.php
+++ b/repository/action/common/download/Download.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Download.class.php 620 2014-09-12 07:32:43Z ivis $
+// $Id: Download.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -15,6 +15,7 @@
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDownload.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryPdfCover.class.php';
 
 /**
  * [[機能説明]]
@@ -175,6 +176,7 @@ class Repository_Action_Common_Download extends RepositoryAction
         $params[] = 0;
         
         $ret = $this->Db->execute($query, $params);
+        
         // SQLエラーの場合 終了
         if ($ret === false) {
             $error_msg = $this->Db->ErrorMsg();
@@ -197,51 +199,112 @@ class Repository_Action_Common_Download extends RepositoryAction
         }
         // Download check
         
-        // throw file contents for user
-        // Add separate file from DB 2009/04/21 Y.Nakao --start--
-        // get contents save path
-        $contents_path = $this->getFileSavePath("file");
-        if(strlen($contents_path) == 0){
-            // default directory
-            $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
+        // Add delete pdf cover 2015/01/27 K.Matsushita -start-
+        // get temporary directory path for pdfCover instance
+        $tmpDirPath = $this->getDefaltTmpDirPath();
+        
+        $user_id = $this->Session->getParameter("_user_id");
+        
+        $pdfCover = new RepositoryPdfCover(
+                                            $this->Session,
+                                            $this->Db,
+                                            $this->TransStartDate,
+                                            $user_id,
+                                            $this->item_id,
+                                            $this->item_no,
+                                            $this->attribute_id,
+                                            $this->file_no,
+                                            $tmpDirPath
+                                            );
+        
+        // Check index setting of pdf cover create
+        $index_id = $this->index_id;
+        if( $index_id == null ){
+            // get index_id
+            $query = " SELECT index_id  ".
+                     " FROM ". DATABASE_PREFIX ."repository_position_index ".
+                     " WHERE item_id = ? ".
+                     "  AND item_no = ? ".
+                     "  AND is_delete = ?; ";
+            
+            $params = array();
+            $params[] = $this->item_id;
+            $params[] = $this->item_no;
+            $params[] = 0;
+            
+            $retGetIndexId = $this->Db->execute($query, $params);
+            
+            // SQLエラーの場合 終了
+            if ($retGetIndexId === false) {
+                $error_msg = $this->Db->ErrorMsg();
+                $this->failTrans();
+                return;
+            }
+            $index_id = $retGetIndexId[0]["index_id"];
         }
-        // check directory exists 
-        if( !(file_exists($contents_path)) ){
-            //$this->Session->setParameter("error_msg", $error_msg);
-            $this->failTrans();
-            return false;
+        
+        $indexIds = array( 0 => $index_id );
+        $pdfCoverCreateFlag = $this->checkIndexCreateCover($indexIds);
+        
+        if( $pdfCoverCreateFlag == TRUE && $ret[0]['extension'] == "pdf" ){
+            
+            $download_file_path = "";
+            
+            // create pdf cover page
+            if( !$pdfCover->execute() ){
+                //cover create  failure -> DL file without cover 
+                $download_file_path = $this->getCopyFilePath($ret[0]['extension']);
+                
+            }
+            else{
+                //cover create sucess
+                $download_file_path = $tmpDirPath.RepositoryPdfCover::PDF_NAME_COMBINED;
+            }
+            
+            if( file_exists( $download_file_path ) === TRUE ){
+                
+                $repositoryDownload = new RepositoryDownload();
+                $repositoryDownload->downloadFile(
+                        $download_file_path,
+                        $ret[0]['file_name'],
+                        $ret[0]['mime_type']
+                );
+                
+                if( file_exists($copy_path) === TRUE ){
+                    unlink($copy_path);
+                }
+            }
         }
-        // Add separate file from DB 2009/04/21 Y.Nakao --end--
-        $file_path = $contents_path.DIRECTORY_SEPARATOR.
-                    $this->item_id.'_'.
-                    $this->attribute_id.'_'.
-                    $this->file_no.'.'.
-                    $ret[0]['extension'];
-        // check file exists
-        if( !(file_exists($file_path)) ){
-            $this->failTrans();
-            return false;
+        else 
+        {
+            $coverCreatedFlag = false;
+            if( $pdfCover->chkExistCover($coverCreatedFlag) === TRUE ){
+                // delete pdf cover page
+                $pdfCover->deleteCoverPage();
+                
+            }
+            
+            $copy_path = $this->getCopyFilePath($ret[0]['extension']);
+            
+            // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
+            $repositoryDownload = new RepositoryDownload();
+            $repositoryDownload->downloadFile($copy_path, $ret[0]['file_name'], $ret[0]['mime_type']);
+            // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
+            
+            unlink($copy_path);
         }
-        $copy_path = BASE_DIR.'/webapp/uploads/repository/'.
-                    $this->item_id.'_'.
-                    $this->attribute_id.'_'.
-                    $this->file_no.'.'.
-                    $ret[0]['extension'];
-        // コンテンツ本体コピー
-        copy($file_path, $copy_path);
-        
-        // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
-        $repositoryDownload = new RepositoryDownload();
-        $repositoryDownload->downloadFile($copy_path, $ret[0]['file_name'], $ret[0]['mime_type']);
-        // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
         
-        unlink($copy_path);
+        // remove temporary directory for pdfCover instance
+        $this->removeDirectory($tmpDirPath);
+        // Add delete pdf cover 2015/01/27 K.Matsushita -end-
         
         if($this->image_slide == null)
         {
-            // Add log common action Y.Nakao 2010/03/05 --start--
-            $this->entryLog(2, $this->item_id, $this->item_no, $this->attribute_id, $this->file_no, $this->image_slide);
-            // Add log common action Y.Nakao 2010/03/05 --end--
+            // Mod entryLog T.Koyasu 2015/03/06 --start--
+            $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+            $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+            $logManager->entryLogForDownload($this->item_id, $this->item_no, $this->attribute_id, $this->file_no);
+            // Mod entryLog T.Koyasu 2015/03/06 --end--
         }
         
         // アクション終了処理
@@ -406,5 +469,72 @@ class Repository_Action_Common_Download extends RepositoryAction
         $result = $this->exitAction();
         return;
     }
+    
+    // Add delete pdf cover 2015/01/27 K.Matsushita -start-
+    /**
+     * Get defaut temporary directory path
+     *
+     * @return string
+     */
+    private function getDefaltTmpDirPath()
+    {
+        $tmpDirPath = "";
+        $query = "SELECT DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS now_date;";
+        $result = $this->Db->execute($query);
+        if($result === false || count($result) != 1){
+            return $tmpDirPath;
+        }
+        $date = $result[0]['now_date'];
+        $tmpDirPath = WEBAPP_DIR."/uploads/repository/_".$date."/";
+    
+        return $tmpDirPath;
+    }
+    
+    /**
+     * Get copy path of download file 
+     * 
+     * @param string
+     * @return string
+     */
+    private function getCopyFilePath($extension){
+        
+        // throw file contents for user
+        // Add separate file from DB 2009/04/21 Y.Nakao --start--
+        // get contents save path
+        $contents_path = $this->getFileSavePath("file");
+        if(strlen($contents_path) == 0){
+            // default directory
+            $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
+        }
+        // check directory exists
+        if( !(file_exists($contents_path)) ){
+            $this->failTrans();
+            return false;
+        }
+        // Add separate file from DB 2009/04/21 Y.Nakao --end--
+        
+        $file_path = $contents_path.DIRECTORY_SEPARATOR.
+        $this->item_id.'_'.
+        $this->attribute_id.'_'.
+        $this->file_no.'.'.
+        $extension;
+        // check file exists
+        if( !(file_exists($file_path)) ){
+            $this->failTrans();
+            return false;
+        }
+        $copy_path = BASE_DIR.'/webapp/uploads/repository/'.
+                $this->item_id.'_'.
+                $this->attribute_id.'_'.
+                $this->file_no.'.'.
+                $extension;
+        // コンテンツ本体コピー
+        copy($file_path, $copy_path);
+        
+        return $copy_path;
+    }
+    
+    
+    // Add delete pdf cover 2015/01/27 K.Matsushita -end-
 }
 ?>
diff --git a/repository/action/common/download/maple.ini b/repository/action/common/download/maple.ini
index e102cf6..b5c25c1 100644
--- a/repository/action/common/download/maple.ini
+++ b/repository/action/common/download/maple.ini
@@ -1,6 +1,3 @@
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
 request = GET
 
diff --git a/repository/action/common/filecleanup/Filecleanup.class.php b/repository/action/common/filecleanup/Filecleanup.class.php
index 52fd024..b9090f1 100644
--- a/repository/action/common/filecleanup/Filecleanup.class.php
+++ b/repository/action/common/filecleanup/Filecleanup.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Filecleanup.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Filecleanup.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/common/filecleanup/update/Update.class.php b/repository/action/common/filecleanup/update/Update.class.php
index b8fba8a..e7e2e05 100644
--- a/repository/action/common/filecleanup/update/Update.class.php
+++ b/repository/action/common/filecleanup/update/Update.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Update.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Update.class.php 32789 2014-03-13 08:46:25Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/common/getpublicitem/Getpublicitem.class.php b/repository/action/common/getpublicitem/Getpublicitem.class.php
index 3adfa78..30d1c10 100644
--- a/repository/action/common/getpublicitem/Getpublicitem.class.php
+++ b/repository/action/common/getpublicitem/Getpublicitem.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Getpublicitem.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Getpublicitem.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -54,7 +54,7 @@ class Repository_Action_Common_Getpublicitem extends RepositoryAction
      */
     public $authority_id = 0;
     
-    function executeForWeko() {
+    function executeApp() {
         // login check
         $result = null;
         $error_msg = null;
diff --git a/repository/action/common/harvesting/Harvesting.class.php b/repository/action/common/harvesting/Harvesting.class.php
index 807987a..0f60aec 100644
--- a/repository/action/common/harvesting/Harvesting.class.php
+++ b/repository/action/common/harvesting/Harvesting.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Harvesting.class.php 657 2014-11-28 10:40:35Z ivis $
+// $Id: Harvesting.class.php 44462 2014-11-28 02:42:41Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/common/harvesting/filter/HarvestingOaipmh.class.php b/repository/action/common/harvesting/filter/HarvestingOaipmh.class.php
index 203178a..30b13c5 100644
--- a/repository/action/common/harvesting/filter/HarvestingOaipmh.class.php
+++ b/repository/action/common/harvesting/filter/HarvestingOaipmh.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: HarvestingOaipmh.class.php 42605 2014-10-03 01:02:01Z keiya_sugimoto $
+// $Id: HarvestingOaipmh.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -909,6 +909,7 @@ class HarvestingOaipmh extends RepositoryAction
             {
                 case RepositoryConst::HARVESTING_COL_SETSPEC:
                     $setSpec = $this->forXmlChangeDecode($val["value"]);
+                    $setSpec = $this->getSetspecValue($setSpec);
                     break;
                 case RepositoryConst::HARVESTING_COL_SETNAME:
                     $setName = $this->forXmlChangeDecode($val["value"]);
@@ -1512,6 +1513,11 @@ class HarvestingOaipmh extends RepositoryAction
                             return false;
                         }
                     }
+                    
+                    // BugFix when before and after update, assignment doi is failed T.Koyasu 2015/03/09 --start--
+                    // must check self_doi when after update item metadatas
+                    $this->itemRegister->updateSelfDoi($irBasic);
+                    // BugFix when before and after update, assignment doi is failed T.Koyasu 2015/03/09 --end--
                 }
                 catch (Exception $ex)
                 {
@@ -1985,8 +1991,8 @@ class HarvestingOaipmh extends RepositoryAction
      * @param string $uri
      * @param string $lastModDate
      */
-    public function entryHarvestingLog(   $oparationId, $update='', $listSets='', $setSpec='', 
-                                            $indexId='', $identifier='', $itemId='', $uri='', $lastModDate='')
+    public function entryHarvestingLog(   $oparationId, $update=0, $listSets='', $setSpec='', 
+                                            $indexId='', $identifier='', $itemId=0, $uri='', $lastModDate='')
     {
         $query = "INSERT INTO ".DATABASE_PREFIX. RepositoryConst::DBTABLE_REPOSITORY_HARVESTING_LOG. 
                 " ( ".
@@ -4311,6 +4317,30 @@ class HarvestingOaipmh extends RepositoryAction
         return true;
     }
     // Add for JuNii2 Redaction 2013/09/16 R.Matsuura --end--
+    
+    
+    /**
+     * get setSpec Value
+     * 
+     * @param string $setSpec
+     * @return string
+     */
+    private function getSetspecValue($setSpec) {
+        if(preg_match("/^[0-9]+$/", $setSpec) == 1) {
+            // 通常のsetSpecが来た場合そのまま返す
+            return $setSpec;
+        } else {
+            // setSpecが連結形式で来た場合は最後の要素を返す
+            $specs = explode(":", $setSpec);
+            if(count($specs) > 1 && preg_match("/^[0-9]+$/", $specs[count($set)-1]) == 1) {
+                // 照合に使うのは最後の1節部分なので配列の最後の値を返す
+                return $specs[count($set)-1];
+            }
+        }
+        
+        // どれにも一致しなかった場合はエラーとして空文字を返す
+        return "";
+    }
 }
 
 ?>
\ No newline at end of file
diff --git a/repository/action/common/ranking/Ranking.class.php b/repository/action/common/ranking/Ranking.class.php
index d5fe4d6..f359398 100644
--- a/repository/action/common/ranking/Ranking.class.php
+++ b/repository/action/common/ranking/Ranking.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Ranking.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Ranking.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,6 +14,7 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/view/main/ranking/Ranking.class.php';
 
 /**
@@ -22,7 +23,7 @@ require_once WEBAPP_DIR. '/modules/repository/view/main/ranking/Ranking.class.ph
  * @package     [[package名]]
  * @access      public
  */
-class Repository_Action_Common_Ranking extends RepositoryAction
+class Repository_Action_Common_Ranking extends WekoAction
 {
 	// リクエストパラメータを受け取るため
 	var $login_id = null;
@@ -31,16 +32,8 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 	// ユーザの権限レベル
 	var $user_authority_id = "";
 	
-	// ランキング集計期間
-	var $rank_term = 365;
-	// ランキング数（新着アイテム以外）
-	var $rank_num = 5;
-	// 新着アイテム扱いの期間（過去Ｘ日）
-	var $newitem_term = 14;
-	var $log_exception = "";
-
 	// Add log reset ranking refer 2010/02/18 K.Ando --start--
-	var $ranking_reset_last_date = "";
+	var $ranking_num = 5;
 	var $ranking_term_date = "";
 	// Add log reset ranking refer 2010/02/18 K.Ando --end--
 	
@@ -53,138 +46,59 @@ class Repository_Action_Common_Ranking extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    protected function executeApp()
     {
-    	try {
-	        //アクション初期化処理
-	        $result = $this->initAction();
-    		if ( $result === false ) {
-	            $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-	        }
-	        
-	        // check login
-	        $result = null;
-	        $error_msg = null;
-	        $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
-	        if($return == false){
-	        	print("Incorrect Login!\n");
-	        	return false;
-	        }
-	        
-	        // check user authority id
-	        // Add config management authority 2010/02/23 Y.Nakao --start--
-			//if($this->user_authority_id != 5){
-			if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
-			// Add config management authority 2010/02/23 Y.Nakao --end--
-	        	print("You do not have permission to update.\n");
-	        	return false;
-	        }
-	        
-	        // ランキング集計期間
-			$items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_term_stats'");
-			if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-				$this->rank_term = $items[0]['param_value'];
-			}
-			// ランキング数（新着アイテム以外）
-			$items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_disp_num';");
-			if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-				$this->rank_num = $items[0]['param_value'];
-			}
-			// 新着アイテム扱いの期間（過去Ｘ日）
-			$items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_term_recent_regist';");
-			if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-				$this->newitem_term = $items[0]['param_value'];
-			}
-			// Add log reset ranking refer 2010/02/18 K.Ando --start--
-			// last reset-ranking date
-			$items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_last_reset_date';");
-			if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-				$this->ranking_reset_last_date = $items[0]['param_value'];
-			}
-			if($this->ranking_reset_last_date != "" )
-			{
-				// Fix date calculate 2010/07/29 A.Suzuki --start--
-				//$logjikan = time()- 60 * 60 * 24 * $this->rank_term;
-				//$jikan = strtotime($this->ranking_reset_last_date);
-				//$this->ranking_term_sec = $jikan <= $logjikan ? $logjikan : $jikan;
-				$this->ranking_reset_last_date = str_replace("/","-",$this->ranking_reset_last_date);
-				$query = "SELECT DATE_SUB(NOW(), INTERVAL ".$this->rank_term." DAY) AS rank_date;";
-				$result = $this->Db->execute($query);
-				$rank_term_date = $result[0]['rank_date'];
-				$query = "SELECT DATEDIFF('".$rank_term_date."', '".$this->ranking_reset_last_date."') AS date_diff;";
-				$result = $this->Db->execute($query);
-				if($result[0]['date_diff'] >= 0){
-					$this->ranking_term_date = $rank_term_date;
-				} else {
-					$this->ranking_term_date = $this->ranking_reset_last_date;
-				}
-				// Fix date calculate 2010/07/29 A.Suzuki --end--
-			}else
-			{
-				// Fix date calculate 2010/07/29 A.Suzuki --start--
-				//$this->ranking_term_sec = time() - 60 * 60 * 24 * $this->rank_term;
-				$query = "SELECT DATE_SUB(NOW(), INTERVAL ".$this->rank_term." DAY) AS rank_date;";
-				$result = $this->Db->execute($query);
-				$this->ranking_term_date = $result[0]['rank_date'];
-				// Fix date calculate 2010/07/29 A.Suzuki --end--
-			}
-			// Add log reset ranking refer 2010/02/18 K.Ando --end--
-	
-			// Add log exclusion from user-agaent 2011/04/28 H.Ito --start--
-			// Call Common function ->logExclusion()
-			$this->log_exception = $this->createLogExclusion(0,false);
-			// Add log exclusion from user-agaent 2011/04/28 H.Ito --end--
-	
-			$viewRanking = new Repository_View_Main_Ranking();
-            // Add tree access control list 2012/03/07 T.Koyasu -start-
-            $viewRanking->setConfigAuthority();
-            // Add tree access control list 2012/03/07 T.Koyasu -end-
-			$viewRanking->SetData($this->Session, $this->Db, $this->log_exception, $this->ranking_term_date, $this->TransStartDate);
-			
-			// update ranking
-			$this->referRanking($viewRanking);
-			$this->downloadRanking($viewRanking);
-			$this->userRanking($viewRanking);
-			$this->keywordRanking($viewRanking);
-			$this->recentRanking($viewRanking);
-			
-	    	// アクション終了処理
-			$result = $this->exitAction();	// トランザクションが成功していればCOMMITされる
-			if ( $result == false ){
-				//print "終了処理失敗";
-			}
-			
-			print("Successfully updated.\n");
-	    	return 'success';
-	    	
-    	} catch ( RepositoryException $Exception) {
-    	    //エラーログ出力
-        	$this->logFile(
-	        	"SampleAction",					//クラス名
-	        	"execute",						//メソッド名
-	        	$Exception->getCode(),			//ログID
-	        	$Exception->getMessage(),		//主メッセージ
-	        	$Exception->getDetailMsg() );	//詳細メッセージ	        
-        	//アクション終了処理
-      		$this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-	        //異常終了
-	        $this->Session->setParameter("error_msg", $user_error_msg);
-    	    return "error";
-		}
+        $this->isLoginAdministrator();
+        
+        $this->rank_num = 5;
+        $query = "SELECT param_value ". 
+                 " FROM ". DATABASE_PREFIX. "repository_parameter ". 
+                 " WHERE param_name = ?;";
+        $params = array();
+        $params[] = 'ranking_disp_num';
+        $result = $this->Db->execute($query, $params);
+        if($result === false)
+        {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        if($result[0]['param_value'] != "" && $result[0]['param_value'] != null){
+            $this->rank_num = $result[0]['param_value'];
+        }
+
+        $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+        $viewRanking = BusinessFactory::getFactory()->getBusiness("businessRanking");
+        $viewRanking->execute();
+        
+        // update ranking
+        $this->debugLog("start insert refer ranking", __FILE__, __CLASS__, __LINE__);
+        $this->referRanking($viewRanking);
+        
+        $this->debugLog("start insert download ranking", __FILE__, __CLASS__, __LINE__);
+        $this->downloadRanking($viewRanking);
+        
+        $this->debugLog("start insert user ranking", __FILE__, __CLASS__, __LINE__);
+        $this->userRanking($viewRanking);
+        
+        $this->debugLog("start insert keyword ranking", __FILE__, __CLASS__, __LINE__);
+        $this->keywordRanking($viewRanking);
+        
+        $this->debugLog("start insert recent ranking", __FILE__, __CLASS__, __LINE__);
+        $this->recentRanking($viewRanking);
+        
+        $this->debugLog("successfully update", __FILE__, __CLASS__, __LINE__);
+        print("Successfully updated.\n");
+        
+        return 'success';
     }
 
     /**
      * 閲覧回数ランキング計算
      *
      */
-    function referRanking($viewRanking)
+    private function referRanking($viewRanking)
     {
-		$items = $viewRanking->getReferRankingData();   // ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+		$items = $viewRanking->getReferRanking();   // ranking acquisition portion is made into a function K.Matsuo 2011/11/18
 		
   		$len = count($items);
 
@@ -193,7 +107,8 @@ class Repository_Action_Common_Ranking extends RepositoryAction
   				 "WHERE rank_type = 'referRanking';";
   		$result = $this->Db->execute($query);
   		if($result === false){
-  			return 'error';
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
   		}
   		$rank_len = count($result);
   		
@@ -203,7 +118,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				 "	  	is_delete = ? ".
 				 "WHERE	rank_type = 'referRanking'; ".
 		$params = null;
-		$params[] = $this->TransStartDate;
+		$params[] = $this->accessDate;
 		$params[] = 1;
 		$this->Db->execute($query, $params);
   		
@@ -216,7 +131,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 						 "	  	disp_value = ?, ".
 						 "	  	item_id = ?, ".
 						 "	  	item_no = ?, ".
-						 "	  	file_no = '', ".
+						 "	  	file_no = 0, ".
 						 "	  	mod_date = ?, ".
 						 "	  	del_date = '', ".
 						 "	  	is_delete = 0 ".
@@ -225,10 +140,10 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params = null;
 				$params[] = $items[$ii]['title'];
 				$params[] = $items[$ii]['title_english'];
-				$params[] = $items[$ii]['count(*)'];
+				$params[] = $items[$ii]['CNT'];
 				$params[] = $items[$ii]['item_id'];
 				$params[] = $items[$ii]['item_no'];
-				$params[] = $this->TransStartDate;
+				$params[] = $this->accessDate;
 				$params[] = $ii+1;
 				$this->Db->execute($query, $params);
 			} else {
@@ -242,12 +157,12 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params[] = $ii+1;
 				$params[] = $items[$ii]['title'];
 				$params[] = $items[$ii]['title_english'];
-				$params[] = $items[$ii]['count(*)'];
+				$params[] = $items[$ii]['CNT'];
 				$params[] = $items[$ii]['item_id'];
 				$params[] = $items[$ii]['item_no'];
-				$params[] = "";
-				$params[] = $this->TransStartDate;
-				$params[] = $this->TransStartDate;
+				$params[] = 0;
+				$params[] = $this->accessDate;
+				$params[] = $this->accessDate;
 				$params[] = "";
 				$params[] = 0;
 				$this->Db->execute($query, $params);
@@ -259,9 +174,9 @@ class Repository_Action_Common_Ranking extends RepositoryAction
      * ダウンロードランキング計算
      *
      */
-    function downloadRanking($viewRanking)
+    private function downloadRanking($viewRanking)
     {
-		$items = $viewRanking->getDownloadRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+		$items = $viewRanking->getDownloadRanking(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
   		$len = count($items);
   		
   		$query = "SELECT * ".
@@ -269,7 +184,8 @@ class Repository_Action_Common_Ranking extends RepositoryAction
   				 "WHERE rank_type = 'downloadRanking';";
   		$result = $this->Db->execute($query);
   		if($result === false){
-  			return 'error';
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
   		}
   		$rank_len = count($result);
   		
@@ -279,7 +195,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				 "	  	is_delete = ? ".
 				 "WHERE	rank_type = 'downloadRanking'; ".
 		$params = null;
-		$params[] = $this->TransStartDate;
+		$params[] = $this->accessDate;
 		$params[] = 1;
 		$this->Db->execute($query, $params);
   		
@@ -309,11 +225,11 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				}
 				$params[] = $disp_name;
 				$params[] = $disp_name_english;
-				$params[] = $items[$ii]['count(*)'];
+				$params[] = $items[$ii]['CNT'];
 				$params[] = $items[$ii]['item_id'];
 				$params[] = $items[$ii]['item_no'];
 				$params[] = $items[$ii]['file_no'];
-				$params[] = $this->TransStartDate;
+				$params[] = $this->accessDate;
 				$params[] = $ii+1;
 				$this->Db->execute($query, $params);
 			} else {
@@ -335,12 +251,12 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params[] = $ii+1;
 				$params[] = $disp_name;
 				$params[] = $disp_name_english;
-				$params[] = $items[$ii]['count(*)'];
+				$params[] = $items[$ii]['CNT'];
 				$params[] = $items[$ii]['item_id'];
 				$params[] = $items[$ii]['item_no'];
 				$params[] = $items[$ii]['file_no'];
-				$params[] = $this->TransStartDate;
-				$params[] = $this->TransStartDate;
+				$params[] = $this->accessDate;
+				$params[] = $this->accessDate;
 				$params[] = "";
 				$params[] = 0;
 				$this->Db->execute($query, $params);
@@ -352,9 +268,9 @@ class Repository_Action_Common_Ranking extends RepositoryAction
      * ユーザランキング計算
      *
      */
-    function userRanking($viewRanking)
+    private function userRanking($viewRanking)
     {
-		$items = $viewRanking->getUserRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+		$items = $viewRanking->getUserRanking(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
 		
   		$len = count($items);
 
@@ -363,7 +279,8 @@ class Repository_Action_Common_Ranking extends RepositoryAction
   				 "WHERE rank_type = 'userRanking';";
   		$result = $this->Db->execute($query);
   		if($result === false){
-  			return 'error';
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
   		}
   		$rank_len = count($result);
   		
@@ -373,7 +290,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				 "	  	is_delete = ? ".
 				 "WHERE	rank_type = 'userRanking'; ".
 		$params = null;
-		$params[] = $this->TransStartDate;
+		$params[] = $this->accessDate;
 		$params[] = 1;
 		$this->Db->execute($query, $params);
   		
@@ -385,7 +302,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 						 "	  	disp_value = ?, ".
 						 "	  	item_id = ?, ".
 						 "	  	item_no = ?, ".
-						 "	  	file_no = '', ".
+						 "	  	file_no = 0, ".
 						 "	  	mod_date = ?, ".
 						 "	  	del_date = '', ".
 						 "	  	is_delete = 0 ".
@@ -393,10 +310,10 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 						 "AND	rank = ?;";
 				$params = null;
 				$params[] = $items[$ii]['handle'];
-				$params[] = $items[$ii]['count(*)'];
-				$params[] = "";
-				$params[] = "";
-				$params[] = $this->TransStartDate;
+				$params[] = $items[$ii]['CNT'];
+				$params[] = 0;
+				$params[] = 0;
+				$params[] = $this->accessDate;
 				$params[] = $ii+1;
 				$this->Db->execute($query, $params);
 			} else {
@@ -409,12 +326,12 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params[] = "userRanking";
 				$params[] = $ii+1;
 				$params[] = $items[$ii]['handle'];
-				$params[] = $items[$ii]['count(*)'];
-				$params[] = "";
-				$params[] = "";
-				$params[] = "";
-				$params[] = $this->TransStartDate;
-				$params[] = $this->TransStartDate;
+				$params[] = $items[$ii]['CNT'];
+				$params[] = 0;
+				$params[] = 0;
+				$params[] = 0;
+				$params[] = $this->accessDate;
+				$params[] = $this->accessDate;
 				$params[] = "";
 				$params[] = 0;
 				$this->Db->execute($query, $params);
@@ -428,7 +345,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
      */
     function keywordRanking($viewRanking)
     {
-		$items = $viewRanking->getKeywordRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+		$items = $viewRanking->getKeywordRanking(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
 		$len = count($items);
   		
   		$query = "SELECT * ".
@@ -436,7 +353,8 @@ class Repository_Action_Common_Ranking extends RepositoryAction
   				 "WHERE rank_type = 'keywordRanking';";
   		$result = $this->Db->execute($query);
   		if($result === false){
-  			return 'error';
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
   		}
   		$rank_len = count($result);
   		
@@ -446,7 +364,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				 "	  	is_delete = ? ".
 				 "WHERE	rank_type = 'keywordRanking'; ".
 		$params = null;
-		$params[] = $this->TransStartDate;
+		$params[] = $this->accessDate;
 		$params[] = 1;
 		$this->Db->execute($query, $params);
   		
@@ -458,7 +376,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 						 "	  	disp_value = ?, ".
 						 "	  	item_id = ?, ".
 						 "	  	item_no = ?, ".
-						 "	  	file_no = '', ".
+						 "	  	file_no = 0, ".
 						 "	  	mod_date = ?, ".
 						 "	  	del_date = '', ".
 						 "	  	is_delete = 0 ".
@@ -466,10 +384,10 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 						 "AND	rank = ?;";
 				$params = null;
 				$params[] = $items[$ii]['search_keyword'];
-				$params[] = $items[$ii]['count(*)'];
-				$params[] = "";
-				$params[] = "";
-				$params[] = $this->TransStartDate;
+				$params[] = $items[$ii]['CNT'];
+				$params[] = 0;
+				$params[] = 0;
+				$params[] = $this->accessDate;
 				$params[] = $ii+1;
 				$this->Db->execute($query, $params);
 			} else {
@@ -482,12 +400,12 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params[] = "keywordRanking";
 				$params[] = $ii+1;
 				$params[] = $items[$ii]['search_keyword'];
-				$params[] = $items[$ii]['count(*)'];
-				$params[] = "";
-				$params[] = "";
-				$params[] = "";
-				$params[] = $this->TransStartDate;
-				$params[] = $this->TransStartDate;
+				$params[] = $items[$ii]['CNT'];
+				$params[] = 0;
+				$params[] = 0;
+				$params[] = 0;
+				$params[] = $this->accessDate;
+				$params[] = $this->accessDate;
 				$params[] = "";
 				$params[] = 0;
 				$this->Db->execute($query, $params);
@@ -501,7 +419,10 @@ class Repository_Action_Common_Ranking extends RepositoryAction
      */
     function recentRanking($viewRanking)
     {
-		$items = $viewRanking->getRecentRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+        $this->debugLog("recentRanking:start", __FILE__, __CLASS__, __LINE__);
+		$items = $viewRanking->getNewItemRanking(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+        $this->debugLog("recentRanking:got recent ranking data", __FILE__, __CLASS__, __LINE__);
+        
   		$len = count($items);
    		
     	$query = "SELECT * ".
@@ -509,7 +430,8 @@ class Repository_Action_Common_Ranking extends RepositoryAction
   				 "WHERE rank_type = 'recentRanking';";
   		$result = $this->Db->execute($query);
   		if($result === false){
-  			return 'error';
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
   		}
   		$rank_len = count($result);
   		
@@ -519,9 +441,10 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				 "	  	is_delete = ? ".
 				 "WHERE	rank_type = 'recentRanking'; ".
 		$params = null;
-		$params[] = $this->TransStartDate;
+		$params[] = $this->accessDate;
 		$params[] = 1;
 		$this->Db->execute($query, $params);
+        $this->debugLog("recentRanking: updated ranking data deleted", __FILE__, __CLASS__, __LINE__);
   		
   		for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
 			if($ii < $rank_len){
@@ -532,7 +455,7 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 						 "	  	disp_value = ?, ".
 						 "	  	item_id = ?, ".
 						 "	  	item_no = ?, ".
-						 "	  	file_no = '', ".
+						 "	  	file_no = 0, ".
 						 "	  	mod_date = ?, ".
 						 "	  	del_date = '', ".
 						 "	  	is_delete = 0 ".
@@ -544,9 +467,10 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params[] = substr($items[$ii]['shown_date'],0,10);
 				$params[] = $items[$ii]['item_id'];
 				$params[] = $items[$ii]['item_no'];
-				$params[] = $this->TransStartDate;
+				$params[] = $this->accessDate;
 				$params[] = $ii+1;
 				$this->Db->execute($query, $params);
+                $this->debugLog("recentRanking: update no = ". $ii + 1, __FILE__, __CLASS__, __LINE__);
 			} else {
 				// insert
 				$query = "INSERT INTO ".DATABASE_PREFIX."repository_ranking ".
@@ -561,14 +485,49 @@ class Repository_Action_Common_Ranking extends RepositoryAction
 				$params[] = substr($items[$ii]['shown_date'],0,10);
 				$params[] = $items[$ii]['item_id'];
 				$params[] = $items[$ii]['item_no'];
-				$params[] = "";
-				$params[] = $this->TransStartDate;
-				$params[] = $this->TransStartDate;
+				$params[] = 0;
+				$params[] = $this->accessDate;
+				$params[] = $this->accessDate;
 				$params[] = "";
 				$params[] = 0;
 				$this->Db->execute($query, $params);
+                $this->debugLog("recentRanking: inserted new record no = ". $ii + 1, __FILE__, __CLASS__, __LINE__);
 			}
   		}
+        $this->debugLog("recentRanking: finish", __FILE__, __CLASS__, __LINE__);
+    }
+    
+    /**
+     * check be able to login or not and login user has authority
+     * 
+     */
+    private function isLoginAdministrator()
+    {
+        // check login
+        $result = null;
+        $error_msg = null;
+        
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setConfigAuthority();
+        $repositoryAction->dbAccess = $this->Db;
+        
+        $return = $repositoryAction->checkLogin($this->login_id, $this->password, $result, $error_msg);
+        if($return == false){
+            print("Incorrect Login!\n");
+            throw new AppException("Incorrect Login!");
+        }
+        
+        // check user authority id
+        // Add config management authority 2010/02/23 Y.Nakao --start--
+        //if($this->user_authority_id != 5){
+        if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
+        // Add config management authority 2010/02/23 Y.Nakao --end--
+            print("You do not have permission to update.\n");
+            throw new AppException("You do not have permission to update.");
+        }
     }
 }
-?>
+?>
\ No newline at end of file
diff --git a/repository/action/common/ranking/maple.ini b/repository/action/common/ranking/maple.ini
index 5070761..688e9bc 100644
--- a/repository/action/common/ranking/maple.ini
+++ b/repository/action/common/ranking/maple.ini
@@ -2,8 +2,5 @@
 Session = "ref:Session"
 Db = "ref:DbObject"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
-request = GET
\ No newline at end of file
+request = GET
diff --git a/repository/action/common/reconstruction/indexauthority/Indexauthority.class.php b/repository/action/common/reconstruction/indexauthority/Indexauthority.class.php
index a642b06..bb76418 100644
--- a/repository/action/common/reconstruction/indexauthority/Indexauthority.class.php
+++ b/repository/action/common/reconstruction/indexauthority/Indexauthority.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Indexauthority.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Indexauthority.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -32,7 +32,7 @@ class Repository_Action_Common_Reconstruction_Indexauthority extends RepositoryA
     public $user_authority_id = "";
     public $authority_id = '';
     
-    function executeForWeko()
+    function executeApp()
     {
         // check login
         $result = null;
diff --git a/repository/action/common/reconstruction/search/Search.class.php b/repository/action/common/reconstruction/search/Search.class.php
index f3f6c3b..d9eac57 100644
--- a/repository/action/common/reconstruction/search/Search.class.php
+++ b/repository/action/common/reconstruction/search/Search.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Search.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Search.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -32,7 +32,7 @@ class Repository_Action_Common_Reconstruction_Search extends RepositoryAction
     public $user_authority_id = "";
     public $authority_id = '';
     
-    function executeForWeko()
+    function executeApp()
     {
         // check login
         $result = null;
diff --git a/repository/action/common/search/update/Update.class.php b/repository/action/common/search/update/Update.class.php
index c2e2536..f2f3ceb 100644
--- a/repository/action/common/search/update/Update.class.php
+++ b/repository/action/common/search/update/Update.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Update.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Update.class.php 41684 2014-09-18 00:04:18Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/common/sitelicensemail/Sitelicensemail.class.php b/repository/action/common/sitelicensemail/Sitelicensemail.class.php
index 26f5866..b3882e1 100644
--- a/repository/action/common/sitelicensemail/Sitelicensemail.class.php
+++ b/repository/action/common/sitelicensemail/Sitelicensemail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Sitelicensemail.class.php 44462 2014-11-28 02:42:41Z tomohiro_ichikawa $
+// $Id: Sitelicensemail.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -11,6 +11,7 @@
 //
 // --------------------------------------------------------------------
 
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
@@ -21,7 +22,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Common_Sitelicensemail extends RepositoryAction
+class Repository_Action_Common_Sitelicensemail extends WekoAction
 {
     //----------------------------
     // Request parameters
@@ -57,108 +58,35 @@ class Repository_Action_Common_Sitelicensemail extends RepositoryAction
      */
     public $user_id = "";
     
-    public function executeForWeko() {
-        $this->user_authority_id = "";
-        $this->authority_id = "";
-        $this->user_id = "";
-        // check login
-        $result = null;
-        $error_msg = null;
-        $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
-        if($return == false){
-            print("Incorrect Login!\n");
-            $this->failTrans();
-            $this->exitAction();
-            return false;
-        }
-        // check user authority id
-        if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
-            print("You do not have permission to send　sitelicense mail.\n");
-            $this->failTrans();
-            $this->exitAction();
-            return false;
+    /**
+     * サイトライセンスメール送信処理開始
+     * 
+     */
+    public function executeApp() {
+        // ログインチェック
+        if(!$this->checkExecuteAuthority()) {
+            return "error";
         }
         
+        // サイトライセンスメール用のビジネスクラス取得
+        $this->infoLog("businessSendsitelicensemail", __FILE__, __CLASS__, __LINE__);
+        $sendSitelicense = BusinessFactory::getFactory()->getBusiness("businessSendsitelicensemail");
+        
         // サイトライセンスメールの送信フラグのチェック
-        $query = "SELECT param_value FROM ".DATABASE_PREFIX. "repository_parameter ".
-                 "WHERE param_name = ? ;";
-        $params = array();
-        $params[] = "send_sitelicense_mail_activate_flg";
-        $result = $this->dbAccess->executeQuery($query, $params);
-        if($result[0]["param_value"] == 0) {
-            return "error";
-        }
+        $send_flag = $sendSitelicense->checkSendSitelicense();
         
-        $query = "SELECT no FROM ".DATABASE_PREFIX. "repository_send_mail_sitelicense ;";
-        $result = $this->dbAccess->executeQuery($query);
-        if(count($result) == 0) {
-            // パラメータテーブルからサイトラインセンス情報を取得
-            $query = "SELECT param_value FROM ".DATABASE_PREFIX ."repository_parameter ".
-                     "WHERE param_name = ? ;";
-            $params = array();
-            $params[] = "site_license";
-            $result = $this->dbAccess->executeQuery($query, $params);
-            
-            // 取得したサイトライセンス情報をサイトライセンスメール情報テーブルに挿入
-            $sl_users = explode("|", $result[0]["param_value"]);
-            $insert_sl = "";
-            for($ii = 0; $ii < count($sl_users); $ii++) {
-                $start_ip = "";
-                $finish_ip = "";
-                if($ii != 0) {
-                    $insert_sl .= ", ";
-                }
-                $insert_sl .= "(". $ii;
-                $sl_info = explode(",", $sl_users[$ii]);
-                // 機関名
-                if(strlen($sl_info[0]) == 0) {
-                    $insert_sl .= ", ''";
-                } else {
-                    $insert_sl .= ", '".$sl_info[0]. "'";
-                }
-                // 開始IPアドレス
-                if(strlen($sl_info[1]) != 0) {
-                    $tmp_ip = explode(".", $sl_info[1]);
-                    $start_ip = $tmp_ip[0].
-                                sprintf("%03d", $tmp_ip[1]).
-                                sprintf("%03d", $tmp_ip[2]).
-                                sprintf("%03d", $tmp_ip[3]);
-                }
-                $insert_sl .= ", '".floatval($start_ip). "' ";
-                // 終了IPアドレス
-                if(strlen($sl_info[2]) == 0) {
-                    $finish_ip = $start_ip;
-                } else {
-                    $tmp_ip = explode(".", $sl_info[2]);
-                    $finish_ip = $tmp_ip[0].
-                                 sprintf("%03d", $tmp_ip[1]).
-                                 sprintf("%03d", $tmp_ip[2]).
-                                 sprintf("%03d", $tmp_ip[3]);
-                }
-                $insert_sl .= ", '".floatval($finish_ip). "' ";
-                // 機関メールアドレス
-                if(strlen($sl_info[3]) == 0) {
-                    $insert_sl .= ", ''";
-                } else {
-                    $insert_sl .= ", '".$sl_info[3]. "'";
-                }
-                $insert_sl .= ")";
-            }
-            $query = "INSERT INTO ".DATABASE_PREFIX ."repository_send_mail_sitelicense ".
-                     "(no, organization_name, start_ip_address, finish_ip_address, mail_address) ".
-                     "VALUES ".$insert_sl;
-            $this->dbAccess->executeQuery($query);
+        if($send_flag == true) {
+            // サイトライセンスメール送信対象者リストの作成
+            $sendSitelicense->insertSendSitelicenseMailList();
             
             // サイトライセンス送信のバックグラウンド処理のリクエストを送信する
             // Call oneself by async
-            
             if(!$this->callAnotherProcessByAsync())
             {
                 // Print error message.
                 print("Failed to send site license mail.\n");
-                $this->failTrans();
-                $this->exitAction();
-                exit();
+                $this->exitFlag = true;
+                return "error";
             } 
             
             // Print message.
@@ -209,6 +137,39 @@ class Repository_Action_Common_Sitelicensemail extends RepositoryAction
         
         return true;
     }
+    
+    /**
+     * check execute authority
+     *
+     * @return bool
+     */
+    private function checkExecuteAuthority()
+    {
+        // check login
+        $result = null;
+        $error_msg = null;
+        
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setConfigAuthority();
+        $repositoryAction->dbAccess = $this->Db;
+        
+        $return = $repositoryAction->checkLogin($this->login_id, $this->password, $result, $error_msg);
+        if($return == false){
+            print("Incorrect Login!\n");
+            return false;
+        }
+        
+        // check user authority id
+        if($this->user_authority_id < $repositoryAction->repository_admin_base || $this->authority_id < $repositoryAction->repository_admin_room){
+            print("You do not have permission to update.\n");
+            return false;
+        }
+        
+        return true;
+    }
 }
 
 ?>
\ No newline at end of file
diff --git a/repository/action/common/usagestatistics/Usagestatistics.class.php b/repository/action/common/usagestatistics/Usagestatistics.class.php
index b0a0b16..9affd19 100644
--- a/repository/action/common/usagestatistics/Usagestatistics.class.php
+++ b/repository/action/common/usagestatistics/Usagestatistics.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Usagestatistics.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: Usagestatistics.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,7 +13,6 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatistics.class.php';
 
 /**
  * Usage statistics
@@ -64,62 +63,65 @@ class Repository_Action_Common_Usagestatistics extends RepositoryAction
      *
      * @return string
      */
-    public function execute()
+    public function executeApp()
     {
-        try {
-            // Init action
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $this->failTrans();
-                $this->exitAction();
-                return "error";
-            }
-            
-            // Init user authorities
-            $this->user_authority_id = "";
-            $this->authority_id = "";
-            $this->user_id = "";
-            
-            // Check login
-            $result = null;
-            $error_msg = null;
-            $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
-            if($return == false){
-                $this->failTrans();
-                $this->exitAction();
-                print("Incorrect Login!\n");
-                return "error";
-            }
-            
-            // Check user authority id
-            if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
-                $this->failTrans();
-                $this->exitAction();
-                print("You do not have permission to update.\n");
-                return "error";
-            }
-            
-            // Aggregate usage statistics
-            $RepositoryUsagestatistics = new RepositoryUsagestatistics($this->Session, $this->Db, $this->TransStartDate, $this->user_id);
-            if(!$RepositoryUsagestatistics->aggregateUsagestatistics())
-            {
-                $this->failTrans();
-                $this->exitAction();
-                print("Update usage statistics is failed.\n");
-                return "error";
-            }
-            
-            // finalize
-            $this->exitAction();
-            print("Successfully updated.\n");
-            return "success";
+        // Init action
+        $result = $this->initAction();
+        if ($result === false) {
+            $this->errorLog("Failed initAction", __FILE__, __CLASS__, __LINE__);
+            throw new AppException("Failed to execute.");
         }
-        catch (RepositoryException $Exception)
-        {
-            $this->failTrans();
-            $this->exitAction();
+        
+        // check execute authority
+        if(!$this->checkExecuteAuthority()) {
+            $this->infoLog("failed to login for usagestatistics", __FILE__, __CLASS__, __LINE__);
+            print("Login is failed.\n");
             return "error";
         }
+        
+        // Aggregate usage statistics
+        $this->infoLog("businessUsagestatistics", __FILE__, __CLASS__, __LINE__);
+        $usageStatistics = BusinessFactory::getFactory()->getBusiness("businessUsagestatistics");
+        if(!$usageStatistics->aggregateUsagestatistics()) {
+            $this->errorLog("", __FILE__, __CLASS__, __LINE__);
+            print("Update usage statistics is failed.\n");
+            throw new AppException("Failed to usage statistics update");
+        }
+        
+        // finalize
+        $this->exitAction();
+        print("Successfully updated.\n");
+        return "success";
+    }
+    
+    /**
+     * check execute authority
+     *
+     * @return bool
+     */
+    private function checkExecuteAuthority() {
+        // Init user authorities
+        $this->user_authority_id = "";
+        $this->authority_id = "";
+        $this->user_id = "";
+        
+        // Check login
+        $result = null;
+        $error_msg = null;
+        $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
+        if($return == false) {
+            print("Incorrect Login!\n");
+            return false;
+        }
+        
+        // Check user authority id
+        if($this->user_authority_id < $this->repository_admin_base || 
+           $this->authority_id < $this->repository_admin_room) {
+            print("You do not have permission to update.\n");
+            return false;
+        }
+        
+        return true;
     }
 }
 ?>
\ No newline at end of file
diff --git a/repository/action/common/usagestatistics/maple.ini b/repository/action/common/usagestatistics/maple.ini
index 5070761..c69b38a 100644
--- a/repository/action/common/usagestatistics/maple.ini
+++ b/repository/action/common/usagestatistics/maple.ini
@@ -2,8 +2,5 @@
 Session = "ref:Session"
 Db = "ref:DbObject"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
 request = GET
\ No newline at end of file
diff --git a/repository/action/common/usagestatisticsmail/Usagestatisticsmail.class.php b/repository/action/common/usagestatisticsmail/Usagestatisticsmail.class.php
index c85580c..0e6d18b 100644
--- a/repository/action/common/usagestatisticsmail/Usagestatisticsmail.class.php
+++ b/repository/action/common/usagestatisticsmail/Usagestatisticsmail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Usagestatisticsmail.class.php 657 2014-11-28 10:40:35Z ivis $
+// $Id: Usagestatisticsmail.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,8 +13,6 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatistics.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatisticsSendMail.class.php';
 
 /**
  * Usagestatisticsmail
@@ -71,152 +69,138 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
      * @var string
      */
     public $user_id = "";
+    /**
+     * language
+     *
+     * @var string
+     */
+    public $lang = "";
     
-    function execute()
-    {
-        try {
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                throw $exception;
+    function executeApp() {
+        //アクション初期化処理
+        $result = $this->initAction();
+        if ( $result === false ) {
+            $this->errorLog("Failed initAction", __FILE__, __CLASS__, __LINE__);
+            throw new AppException("Failed to execute.");
+        }
+        
+        // check execute authority
+        if(!$this->checkExecuteAuthority()) {
+            $this->errorLog("failed to login for send feedback mail", __FILE__, __CLASS__, __LINE__);
+            print("Login is failed.\n");
+            $this->exitFlag = true;
+            return;
+        }
+        
+        // Set user id to session
+        $this->Session->setParameter("_user_id", $this->user_id);
+        
+        // Set language
+        if(strlen($this->lang) == 0) {
+            $this->lang = $this->Session->getParameter("_lang");
+        }
+        
+        // Set year and month
+        $this->setYearAndMonth();
+        
+        // get instance
+        $this->infoLog("businessSendusagestatisticsmail", __FILE__, __CLASS__, __LINE__);
+        $SendMail = BusinessFactory::getFactory()->getBusiness("businessSendusagestatisticsmail");
+        
+        // parameter for send
+        $mailAddress = "";
+        $orderNum = 0;
+        $isAuthor = false;
+        $authorId = 0;
+        $status = $SendMail->openProgressFile($mailAddress, $orderNum, $isAuthor, $authorId);
+        if($status == "start") {
+            // --------------------
+            // Start send mail
+            // --------------------
+            // If activate flag is unavailable, cannot start send mail.
+            if(!$this->getSendFeedbackMailActivateFlag()) {
+                $this->infoLog("send feedback mail flag is disabled", __FILE__, __CLASS__, __LINE__);
+                print("Cannot to send feedback mail. Because setting is not enabled.\n");
+                $this->exitFlag = true;
+                return;
             }
             
-            $this->user_authority_id = "";
-            $this->authority_id = "";
-            $this->user_id = "";
+            // Call send mail start process
+            $SendMail->startSendMail();
             
-            // check login
-            $result = null;
-            $error_msg = null;
-            $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
-            if($return == false){
-                print("Incorrect Login!\n");
-                $this->failTrans();
-                $this->exitAction();
-                return false;
+            // Create progress file
+            if(!$SendMail->createProgressFile()) {
+                // Print error message.
+                $this->errorLog("create progress file failed", __FILE__, __CLASS__, __LINE__);
+                print("Failed to send feedback mail.\n");
+                throw new AppException("create progress file failed");
             }
             
-            // check user authority id
-            if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
-                print("You do not have permission to update.\n");
-                $this->failTrans();
-                $this->exitAction();
-                return false;
-            }
+            // 再帰リクエストによってトランザクション競合が起きて更新ミスが起きるためここでファイナライズする
+            $this->exitAction();
             
-            // Set user id to session
-            $this->Session->setParameter("_user_id", $this->user_id);
+            // Call oneself by async
+            if(!$this->callAnotherProcessByAsync()) {
+                // Print error message.
+                $this->errorLog("execute HTTP request failed", __FILE__, __CLASS__, __LINE__);
+                print("Failed to send feedback mail.\n");
+                throw new AppException("execute HTTP request failed");
+            }
+            // Print message.
+            print("Start send feedback mail.\n");
+        } else if($status == "running") {
+            // --------------------
+            // Running send mail
+            // --------------------
+            // Execute send mail
+            $SendMail->executeSendMail($mailAddress, 
+                                       $orderNum, 
+                                       $authorId, 
+                                       $isAuthor, 
+                                       $this->year, 
+                                       $this->month, 
+                                       $this->lang);
             
-            // Set year and month
-            $this->setYearAndMonth();
+            // Update progress file
+            if(!$SendMail->updateProgressFile()) {
+                // Print error message.
+                $this->errorLog("update progress file is failed", __FILE__, __CLASS__, __LINE__);
+                print("Failed to send feedback mail.\n");
+                throw new AppException("execute HTTP request failed");
+            }
             
-            // RepositoryUsagestatisticsSendMail class
-            $SendMail = new RepositoryUsagestatisticsSendMail($this->Session, $this->Db, $this->TransStartDate);
+            // 再帰リクエストによってトランザクション競合が起きて更新ミスが起きるためここでファイナライズする
+            $this->exitAction();
             
-            $SendMail->openProgressFile();
-            if($SendMail->getStatus() == "start")
-            {
-                // --------------------
-                // Start send mail
-                // --------------------
-                // If activate flag is unavailable, cannot start send mail.
-                if(!$this->getSendFeedbackMailActivateFlag())
-                {
-                    // Print error message.
-                    print("Cannot to send feedback mail. Because setting is not enabled.\n");
-                    $this->failTrans();
-                    $this->exitAction();
-                    exit();
-                }
-                
-                // Call send mail start process
-                $SendMail->startSendMail();
-                
-                // Create progress file
-                if(!$SendMail->createProgressFile())
-                {
-                    // Print error message.
-                    print("Failed to send feedback mail.\n");
-                    $this->failTrans();
-                    $this->exitAction();
-                    exit();
-                }
-                
-                // Call oneself by async
-                if(!$this->callAnotherProcessByAsync())
-                {
-                    // Print error message.
-                    print("Failed to send feedback mail.\n");
-                    $this->failTrans();
-                    $this->exitAction();
-                    exit();
-                }
-                // Print message.
-                print("Start send feedback mail.\n");
-            }
-            else if($SendMail->getStatus() == "running")
-            {
-                // --------------------
-                // Running send mail
-                // --------------------
-                // Execute send mail
-                $SendMail->executeSendMail($this->year, $this->month);
-                
-                // Update progress file
-                if(!$SendMail->updateProgressFile())
-                {
-                    // Print error message.
-                    print("Failed to send feedback mail.\n");
-                    $this->failTrans();
-                    $this->exitAction();
-                    exit();
-                }
-                
-                // Call oneself by async
-                if(!$this->callAnotherProcessByAsync())
-                {
-                    // Print error message.
-                    print("Failed to send feedback mail.\n");
-                    $this->failTrans();
-                    $this->exitAction();
-                    exit();
-                }
-                // Print message.
-                print("Send feedback mail runnung continue.\n");
-            }
-            else if($SendMail->getStatus() == "end")
-            {
-                // --------------------
-                // End send mail
-                // --------------------
-                // Call send mail end process
-                $SendMail->endSendMail();
-                
-                // Print message.
-                print("Send feedback mail completed.\n");
-            }
-            else
-            {
-                // Print message.
-                print("Cannot execute send mail, because running other process.\n");
+            // Call oneself by async
+            if(!$this->callAnotherProcessByAsync()) {
+                // Print error message.
+                $this->errorLog("execute HTTP request failed", __FILE__, __CLASS__, __LINE__);
+                print("Failed to send feedback mail.\n");
+                throw new AppException("execute HTTP request failed");
             }
+            // Print message.
+            print("Send feedback mail runnung continue.\n");
+        } else if($status == "end") {
+            // --------------------
+            // End send mail
+            // --------------------
+            // Call send mail end process
+            $SendMail->endSendMail();
             
-            // Finalize
+            // 再帰リクエストによってトランザクション競合が起きて更新ミスが起きるためここでファイナライズする
             $this->exitAction();
-            exit();
-        }
-        catch (Exception $exception)
-        {
-            // rollback
-            $this->failTrans();
-            $this->exitAction();
-            print($exception->getMessage()."\n");
-            exit();
+            
+            // Print message.
+            print("Send feedback mail completed.\n");
+        } else {
+            // Print message.
+            print("Cannot execute send mail, because running other process.\n");
         }
+        
+        // Finalize
+        $this->exitFlag = true;
+        return;
     }
     
     /**
@@ -224,11 +208,10 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
      *
      * @return bool
      */
-    public function callAnotherProcessByAsync()
-    {
+    public function callAnotherProcessByAsync() {
         // Request parameter for next URL
         $nextRequest = BASE_URL."/?action=repository_action_common_usagestatisticsmail".
-                       "&year=".$this->year."&month=".$this->month.
+                       "&year=".$this->year."&month=".$this->month."&lang=".$this->lang.
                        "&login_id=".$this->login_id."&password=".$this->password;
         $url = parse_url($nextRequest);
         $nextRequest = str_replace($url["scheme"]."://".$url["host"], "",  $nextRequest);
@@ -237,18 +220,16 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
         $host = array();
         preg_match("/^https?:\/\/(([^\/]+)).*$/", BASE_URL, $host);
         $hostName = $host[1];
-        if($hostName == "localhost"){
+        if($hostName == "localhost") {
             $hostName = gethostbyname($_SERVER['SERVER_NAME']);
         }
         $hostSock = $hostName;
-        if($_SERVER["SERVER_PORT"] == 443)
-        {
+        if($_SERVER["SERVER_PORT"] == 443) {
             $hostSock = "ssl://".$hostName;
         }
         
         $handle = fsockopen($hostSock, $_SERVER["SERVER_PORT"]);
-        if (!$handle)
-        {
+        if (!$handle) {
             return false;
         }
         
@@ -262,11 +243,8 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
     /**
      * Set year and month
      */
-    private function setYearAndMonth()
-    {
-        if( strlen($this->year) == 0 || intval($this->year) < 1 ||
-            strlen($this->month) == 0 || intval($this->month) < 1 || intval($this->month) > 12)
-        {
+    private function setYearAndMonth() {
+        if( strlen($this->year) == 0 || intval($this->year) < 1 || strlen($this->month) == 0 || intval($this->month) < 1 || intval($this->month) > 12) {
             // Get previous month
             $prevYearMonth = $this->getPreviousMonth();
             $prevYearMonthArray = explode("-", $prevYearMonth, 2);
@@ -282,13 +260,16 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
      *
      * @return string
      */
-    private function getPreviousMonth()
-    {
+    private function getPreviousMonth() {
         // Get previous month (format: YYYY-MM)
         $query = "SELECT DATE_FORMAT(NOW() - INTERVAL 1 MONTH, '%Y-%m') AS prevMonth ";
         $result = $this->Db->execute($query);
-        if($result === false || count($result)!=1)
-        {
+        if($result === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        
+        if(count($result) == 0) {
             return "";
         }
         
@@ -300,8 +281,7 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
      *
      * @return bool
      */
-    private function getSendFeedbackMailActivateFlag()
-    {
+    private function getSendFeedbackMailActivateFlag() {
         $rtn = false;
         
         // Get send feedback mail activate flag in parameter
@@ -309,12 +289,45 @@ class Repository_Action_Common_Usagestatisticsmail extends RepositoryAction
                  "FROM ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_PARAMETER." ".
                  "WHERE ".RepositoryConst::DBCOL_REPOSITORY_PARAMETER_PARAM_NAME." = 'send_feedback_mail_activate_flg';";
         $result = $this->Db->execute($query);
-        if($result !== false && count($result)==1 && $result[0][RepositoryConst::DBCOL_REPOSITORY_PARAMETER_PARAM_VALUE]=="1")
-        {
+        if($result === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        
+        if(count($result) == 1 && $result[0][RepositoryConst::DBCOL_REPOSITORY_PARAMETER_PARAM_VALUE]=="1") {
             $rtn = true;
         }
         
         return $rtn;
     }
+    
+    /**
+     * check execute authority
+     *
+     * @return bool
+     */
+    private function checkExecuteAuthority() {
+        // Init user authorities
+        $this->user_authority_id = "";
+        $this->authority_id = "";
+        $this->user_id = "";
+        
+        // Check login
+        $result = null;
+        $error_msg = null;
+        $return = $this->checkLogin($this->login_id, $this->password, $result, $error_msg);
+        if($return == false) {
+            print("Incorrect Login!\n");
+            return false;
+        }
+        
+        // Check user authority id
+        if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room) {
+            print("You do not have permission to update.\n");
+            return false;
+        }
+        
+        return true;
+    }
 }
 ?>
\ No newline at end of file
diff --git a/repository/action/edit/adminadmit/Adminadmit.class.php b/repository/action/edit/adminadmit/Adminadmit.class.php
index af67084..c4ab0e8 100644
--- a/repository/action/edit/adminadmit/Adminadmit.class.php
+++ b/repository/action/edit/adminadmit/Adminadmit.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Adminadmit.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Adminadmit.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -102,7 +102,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 	// Add Site License 2008/10/09 Y.Nakao --start--
 	//var $site_license = null;	// site license authorization
 	// Add Site License 2008/10/09 Y.Nakao --end--
+	var $sitelicense_id = null;      // org id for site license
 	var $sitelicense_org = null;	// org name for site license
+	var $sitelicense_group = null;   // org group name for site license
 	var $ip_sitelicense_from = null;	// ip address from for site license
 	var $ip_sitelicense_to = null;	// ip address to for site license
 	// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
@@ -303,6 +305,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
      */
     public $prefixJalcDoi = null;
     public $prefixCrossRef = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --start--
+    public $prefixDataCite = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --end--
     public $prefixCnri = null;
     // Add prefix Admin T.Ichikawa 2013/12/24 --end--
     
@@ -351,25 +356,40 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
     // OAI-PMH Output Flag
     public $oaipmh_output_flag = null;
     
+    // Institution Name
+    public $institutionName = null;
+    
+    // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+    // Default Search Type
+    public $default_search_type = null;
+    // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+    
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+    public $usagestatistics_link_display = null;
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+    public $ranking_tab_display = null;
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+    
+    // Add DataCite 2015/02/09 K.Sugimoto --start--
+    // PrefixID Add Flag
+    public $prefix_flag = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --end--
+    
+    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+    public $CrossRefQueryServicesAccount = null;
+    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+    
+    // Add RobotList 2015/04/06 S.Suzuki --start--
+    public $robotlistValid = null;
+    // Add RobotList 2015/04/06 S.Suzuki --end--
+    
 	/**
 	 * @access  public
 	 */
-	function execute()
+	function executeApp()
 	{
-		try {
-			// ----------------------------------------------------
-			// call init action
-			// ----------------------------------------------------
-			$result = $this->initAction();			
-			if ( $result === false ) {
-				$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-				$DetailMsg = null;							 	 //詳細メッセージ文字列作成
-				sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-				$exception->setDetailMsg( $DetailMsg );			 //詳細メッセージ設定
-				$this->failTrans();								 //トランザクション失敗を設定(ROLLBACK)
-				throw $exception;
-			}
-			
             // add get lang 2012/12/05 A.Jin --start--
             $smartyAssign = $this->Session->getParameter("smartyAssign");    // for get language resource
             // add get lang 2012/12/05 A.Jin --end--
@@ -403,36 +423,32 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 			
 			// check date : year, month, date
 			if($this->prvd_Identify_earliestDatestamp_year == null) {
-				$this->Session->setParameter("error_msg", "error : invalid date input.");
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+                $this->Session->setParameter("error_msg", "error : invalid date input.");
+                $this->errorLog("error : invalid date input.", __FILE__, __CLASS__, __LINE__);
+                throw new AppException("error : invalid date input.");
 			}
 			if( checkdate(	intval($this->prvd_Identify_earliestDatestamp_month),
 							intval($this->prvd_Identify_earliestDatestamp_day),
 							intval($this->prvd_Identify_earliestDatestamp_year)) == false ) {
-				$this->Session->setParameter("error_msg", "error : invalid date input.");
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+                $this->Session->setParameter("error_msg", "error : invalid date input.");
+                $this->errorLog("error : invalid date input.", __FILE__, __CLASS__, __LINE__);
+                throw new AppException("error : invalid date input.");
 			}					
 			// Add Selective Harvesting 2013/09/04 R.Matsuura --start--
 			for($ii=0;$ii<count($this->harvesting_from_date_year);$ii++) {
 			    if(checkdate( intval($this->harvesting_from_date_month[$ii]),
 			                  intval($this->harvesting_from_date_day[$ii]),
 			                  intval($this->harvesting_from_date_year[$ii])) == false ) {
-    			    $this->Session->setParameter("error_msg", "error : invalid date input.");
-                    $this->failTrans();     //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+                    $this->Session->setParameter("error_msg", "error : invalid date input.");
+                    $this->errorLog("error : invalid date input.", __FILE__, __CLASS__, __LINE__);
+                    throw new AppException("error : invalid date input.");
 			    }
                 if(checkdate( intval($this->harvesting_until_date_month[$ii]),
                               intval($this->harvesting_until_date_day[$ii]),
                               intval($this->harvesting_until_date_year[$ii])) == false ) {
                     $this->Session->setParameter("error_msg", "error : invalid date input.");
-                    $this->failTrans();     //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+                    $this->errorLog("error : invalid date input.", __FILE__, __CLASS__, __LINE__);
+                    throw new AppException("error : invalid date input.");
                 }
                 
                 // Consolidated inthe form of YYYY-MM-DDThh:mm:ssZ
@@ -451,9 +467,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                             $this->harvesting_until_date_second[$ii] . "Z";
                 if($from_date > $until_date) {
                     $this->Session->setParameter("error_msg", "error : invalid date input.");
-                    $this->failTrans();     //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+                    $this->errorLog("error : invalid date input.", __FILE__, __CLASS__, __LINE__);
+                    throw new AppException("error : invalid date input.");
                 }
             }
 			// Add Selective Harvesting 2013/09/04 R.Matsuura --end--
@@ -467,11 +482,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 		   	$result = $this->getParamTableRecord($admin_records, $Error_Msg);
 	   		if ($result === false) {
 				$errMsg = $this->Db->ErrorMsg();
-				$tmpstr = sprintf("item_coef_cp update failed : %s", $ii, $jj, $errMsg ); 
-				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+				$tmpstr = sprintf("item_coef_cp update failed : %s", $ii, $jj, $errMsg );
+                $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 
 			// ----------------------------------------------------
@@ -484,9 +497,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				// If Edit start time different update time then not update
 				if( $admin_records_old[$key]['mod_date'] != $value['mod_date'] ) {	
 					$this->Session->setParameter("error_msg", "error : probably " . $key . " was updated by other admin.");
-					$this->failTrans();		//ROLLBACK
-                    $this->exitAction();
-					return 'error';
+					$tmpstr = "error : probably " . $key . " was updated by other admin.";
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			
@@ -508,7 +521,7 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 }
                 // Mod Item handle management T.Koyasu 2014/01/28 --end--
 				// end action
-				$result = $this->exitAction();
+				//$result = $this->exitAction();
 				return 'success';
 			}
 			// Add get Prefix 2008/11/19 --end--
@@ -544,9 +557,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("default_disp_type update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//ROLLBACK
-                    $this->exitAction();
-					return 'error';
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add default display type setting 2008/12/8 A.Suzuki --end--
@@ -559,9 +571,7 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("disp_index_type update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    throw new AppException($tmpstr);
 				}
 			}
 			if( $this->default_disp_index != null ){
@@ -573,9 +583,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("default_disp_index update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			
@@ -589,9 +598,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("select_language update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add select_language 2009/07/01 A.Suzuki --end--
@@ -615,9 +623,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("alternative_language update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+                $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add alternative language setting 2009/08/11 A.Suzuki --end--
 			
@@ -631,9 +638,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("currency_setting update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add currency_setting 2009/06/29 A.Suzuki --end--
@@ -648,13 +654,79 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("ranking_disp_setting update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add ranking disp setting 2008/12/1 A.Suzuki --end-- 
 			
+			// Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+			// 現在の設定値取得
+			$paramsGetRankingDisplay = array('param_name' => 'ranking_tab_display');
+			$rankingDisplayInfo = $this->Db->selectExecute("repository_parameter",$paramsGetRankingDisplay);
+			if ($rankingDisplayInfo === false) {
+			    return 'error';
+			}
+			
+			// DBの値とセッションの値を比較
+			if( $rankingDisplayInfo[0]['param_value'] !== $this->ranking_tab_display ){
+			    // 異なる場合
+			    
+			    // maple.ini書き換え
+			    $view_main_maple_ini_file_path = WEBAPP_DIR. '/modules/repository/view/main/maple.ini';
+			    
+			    // Check file read & write rights
+			    if(is_readable($view_main_maple_ini_file_path) && is_writable($view_main_maple_ini_file_path)){
+			        
+			        // 読み込み
+			        $fp = fopen($view_main_maple_ini_file_path, "r");
+			        $maple_ini_text = array();
+			        while ($line = fgets($fp)) {
+			            $maple_ini_text[] = $line;
+			        }
+			        fclose($fp);
+			        
+			        // 書き込み
+			        $fp = fopen($view_main_maple_ini_file_path, "w");
+			        for($ii = 0; $ii < count($maple_ini_text); $ii++){
+			             
+			            if( $this->ranking_tab_display == 1 && strpos($maple_ini_text[$ii], "define:repository_view_main_ranking") !== false ){
+			                $maple_ini_text[$ii] = '_ranking = "define:repository_view_main_ranking"'."\n";
+			            }
+			            else if( $this->ranking_tab_display == 0 && strpos($maple_ini_text[$ii], "define:repository_view_main_ranking") !== false )
+			            {
+			                $maple_ini_text[$ii] = ';_ranking = "define:repository_view_main_ranking"'."\n";//先頭をコメントアウト
+			            }
+			            fwrite($fp, $maple_ini_text[$ii]);
+			        }
+			        fclose($fp);
+			        
+			        // DBの値を更新
+			        if( $this->ranking_tab_display != null ){
+			            // ランキング管理 : ランキングタブ表示設定
+			            $params[0] = $this->ranking_tab_display;	// param_value
+			            $params[3] = 'ranking_tab_display';		// param_name
+			            $result = $this->updateParamTableData($params, $Error_Msg);
+			            if ($result === false) {
+			                $errMsg = $this->Db->ErrorMsg();
+			                $tmpstr = sprintf("ranking_tab_display_setting update failed : %s", $ii, $jj, $errMsg );
+			                $this->Session->setParameter("error_msg", $tmpstr);
+                            $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                            throw new AppException($tmpstr);
+			            }
+			        }
+			    }
+			    else{
+			        // エラーメッセージ
+			        $tmpstr = "error: impossible to read and write view/main/maple.ini";
+			        $this->Session->setParameter("error_msg", $tmpstr);
+                    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
+			    }
+			}
+			// Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+			
+			
 			if( $this->ranking_term_recent_regist != null ){
 				// ランキング管理 : 新規登録期間
 				$params[0] = intval($this->ranking_term_recent_regist);	// param_value
@@ -664,9 +736,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("ranking_term_recent_regist update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+				    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			if( $this->ranking_term_stats != null ){
@@ -677,10 +748,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				if ($result === false) {
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("ranking_term_stats update failed : %s", $ii, $jj, $errMsg ); 
-					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    $this->Session->setParameter("error_msg", $tmpstr);
+				    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			if( $this->ranking_disp_num != null ){
@@ -691,10 +761,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				if ($result === false) {
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("ranking_disp_num update failed : %s", $ii, $jj, $errMsg ); 
-					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+                    $this->Session->setParameter("error_msg", $tmpstr);
+				    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// ランキング表示可否, 最も閲覧されたアイテム
@@ -709,10 +778,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 			if ($result === false) {
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("ranking_is_disp_browse_item update failed : %s", $ii, $jj, $errMsg ); 
-				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+                $this->Session->setParameter("error_msg", $tmpstr);
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// ランキング表示可否, 最もダウンロードされたアイテム
 			if( $this->ranking_is_disp_download_item == null ){
@@ -726,10 +794,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 			if ($result === false) {
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("ranking_is_disp_download_item update failed : %s", $ii, $jj, $errMsg ); 
-				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+                $this->Session->setParameter("error_msg", $tmpstr);
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// ランキング表示可否, 最もアイテムを作成したユーザ
 			if( $this->ranking_is_disp_item_creator == null ){
@@ -744,9 +811,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("ranking_is_disp_item_creator update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// ランキング表示可否, 最も検索されたキーワード
 			if( $this->ranking_is_disp_keyword == null ){
@@ -761,9 +827,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("ranking_is_disp_keyword update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+                $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// ランキング表示可否, 新着アイテム
 			if( $this->ranking_is_disp_recent_item == null ){
@@ -778,9 +843,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("ranking_is_disp_recent_item update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 /*
 			// アイテム数／ファイル要領制限関連は保留
@@ -852,9 +916,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("export_is_include_files update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add review mail setting 2009/09/24 Y.Nakao --start--
@@ -872,9 +935,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("review_flg update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// アイテム管理 : 査読後のアイテム公開方式
 			if( $this->item_auto_public != null ){
@@ -885,9 +947,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("item_auto_public update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// 査読通知メール設定
@@ -903,9 +964,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("review_mail_flg update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			
             // Bugfix input scrutiny 2011/06/17 Y.Nakao --start--
@@ -930,9 +990,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("review_mail update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add review mail setting 2009/09/24 Y.Nakao --end--
 			
@@ -945,9 +1004,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("prvd_Identify_adminEmail update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// OAI-PMH管理 : リポジトリ名
@@ -959,9 +1017,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("prvd_Identify_repositoryName update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                    $this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// OAI-PMH管理 : earliest_datestamp
@@ -978,9 +1035,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("prvd_Identify_earliestDatestamp update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			
 			// Add command path setting 2008/08/07 Y.Nakao --start--
@@ -997,9 +1053,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("path_wvWare update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Server environment : pass to xlhtml
 			if( $this->path_xlhtml != null ){
@@ -1014,9 +1069,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("path_xlhtml update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Server environment : pass to poppler
 			if( $this->path_poppler != null ){
@@ -1031,9 +1085,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("path_poppler update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Server environment : pass to ImageMagick
 			if( $this->path_ImageMagick != null ){
@@ -1048,9 +1101,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("path_ImageMagick update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
             // Add pdftk 2012/06/07 A.Suzuki --start--
             // Server environment : path to pdftk
@@ -1066,9 +1118,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("path_pdftk update failed : %s", $errMsg ); 
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();     //ROLLBACK
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             // Add pdftk 2012/06/07 A.Suzuki --end--
             
@@ -1086,9 +1137,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("path_ffmpeg update failed : %s", $errMsg);
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();         // ROLLBACK
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             // Add multimedia support 2012/08/27 T.Koyasu -end-
             // Add external serarch word 2014/05/23 K.Matsuo -start-
@@ -1105,97 +1155,26 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("path_mecab update failed : %s", $errMsg);
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();         // ROLLBACK
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             // Add external serarch word 2014/05/23 K.Matsuo -end-
 			// Add command path setting 2008/08/07 Y.Nakao --end--
 
 			// Add Site License 2008/10/09 Y.Nakao --start--
 			// Add Site License 2008/10/20 Y.Nakao --start--
-			$site_license = "";
-			$cnt_ipaddress = 0;
-			for($ii=0; $ii<count($this->sitelicense_org); $ii++){
-                // Bugfix Input scrutiny 2011/06/17 Y.Nakao --start--
-                // replace explode delimiters.
-                $this->sitelicense_org = str_replace("|", "&#124;", $this->sitelicense_org);
-                $this->sitelicense_org = str_replace(",", "&#44;", $this->sitelicense_org);
-                $this->sitelicense_org = str_replace(".", "&#46;", $this->sitelicense_org);
-                // Bugfix Input scrutiny 2011/06/17 Y.Nakao --end--
-                // Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-                $this->sitelicense_mail = str_replace("|", "&#124;", $this->sitelicense_mail);
-                $this->sitelicense_mail = str_replace(",", "&#44;", $this->sitelicense_mail);
-                $this->sitelicense_mail = str_replace(".", "&#46;", $this->sitelicense_mail);
-                // Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-				if($ii != 0){
-					$site_license .= "|";
-				}
-				if(	str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]) != "" &&
-					str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]) != "" &&
-					str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]) != "" &&
-					str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3]) != "")
-				{
-					if(	str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]) != "" && 
-						str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]) != "" && 
-						str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]) != "" && 
-						str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3]) != "")
-					{
-						$site_license .= str_replace(" ", "", $this->sitelicense_org[$ii]).",";
-						
-						$from = sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]))).
-								sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]))).
-								sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]))).
-								sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3])));
-						$to = sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]))).
-							  sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]))).
-							  sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]))).
-							  sprintf("%03d",intval(str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3])));
-						
-						if($from > $to){
-							$site_license .= str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3]). ",";
-							$site_license .= str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3]). ",";
-						} else {
-							$site_license .= str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3]). ",";
-							$site_license .= str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]). "." .
-											 str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3]). ",";
-						}
-					} else {
-						$site_license .= str_replace(" ", "", $this->sitelicense_org[$ii]).",";
-						$site_license .= str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]). "." .
-										 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]). "." .
-										 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]). "." .
-										 str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3]). ",";
-						$site_license .= ",";
-					}
-                    // Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-                    $site_license .= str_replace(" ", "", $this->sitelicense_mail[$ii]);
-                    // Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-				}
-				$cnt_ipaddress += 3;
-			}
-			
-			$params[0] = $site_license;	// param_value
-			$params[3] = 'site_license';		// param_name
-			$result = $this->updateParamTableData($params, $Error_Msg);
+            // Sitelicense 2015/01/21 T.Ichikawa --start--
+            $result = $this->executeUpdateSitelicense($Error_Msg);
 			if ($result === false) {
 				$errMsg = $this->Db->ErrorMsg();
-				$tmpstr = sprintf("site_license update failed : %s", $errMsg ); 
-				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+                if(strlen($errMsg) > 0) {
+                    $tmpstr = sprintf("site_license update failed : %s", $errMsg ); 
+                } else {
+                    $tmpstr = sprintf("site_license update failed : %s", $Error_Msg ); 
+                }
+                $this->Session->setParameter("error_msg", $tmpstr);
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add Site License 2008/10/20 Y.Nakao --end--
 			// Add Site License 2008/10/09 Y.Nakao --end--
@@ -1212,9 +1191,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("AWSAccessKeyId update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add AWSAccessKeyId 2008/11/18 A.Suzuki --end--
 			
@@ -1230,9 +1208,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("AWSSecretAccessKey update failed : %s", $errMsg );
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add AWSSecretAccessKey 2010/03/01 S.Nonomura --end--
 			
@@ -1247,10 +1224,9 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
             if ($result === false) {
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("AWSSecretAccessKey update failed : %s", $errMsg );
-                $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-                return 'error';
+				$this->Session->setParameter("error_msg", $tmpstr);
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             // Add AssociateTag for modify API Y.Nakao 2011/10/19 --end--
             
@@ -1269,8 +1245,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $tmpstr = sprintf("ichushiIsConnect update failed : %s", $errMsg );
                 $this->Session->setParameter("error_msg", $tmpstr);
                 $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             
             if($this->ichushiLoginId == null)
@@ -1284,9 +1260,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("ichushiLoginId update failed : %s", $errMsg );
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             
             if($this->ichushiLoginPasswd == null)
@@ -1322,9 +1297,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                         $errMsg = $this->Db->ErrorMsg();
                         $tmpstr = sprintf("ichushiLoginPasswd update failed : %s", $errMsg );
                         $this->Session->setParameter("error_msg", $tmpstr);
-                        $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                        $this->exitAction();
-                        return 'error';
+        			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                        throw new AppException($tmpstr);
                     }
                     
                 } else {
@@ -1341,9 +1315,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("site_license_item_type_id update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add Item Type Select for Site License 2009/01/06 A.Suzuki --end--
 			
@@ -1355,9 +1328,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("sort_disp update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			
 			$params[0] = $this->sort_not_disp;	// param_value
@@ -1367,9 +1339,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("sort_not_disp update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			
 			$params[0] = $this->sort_disp_default_index."|".$this->sort_disp_default_keyword;	// param_value
@@ -1379,9 +1350,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("sort_disp_default update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add search result setting 2009/03/13 A.Suzuki --start--
 			
@@ -1393,9 +1363,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("default_list_view_num update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			$this->Session->removeParameter("list_view_num");
 			// Add default_list_view_num 2009/03/27 A.Suzuki --end--
@@ -1422,9 +1391,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("log_exclusion update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//ROLLBACK
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			
 			// Add supple WEKO setting 2009/09/09 A.Suzuki --start--
@@ -1437,9 +1405,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 if(preg_match("/^(https?|ftp)(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/", $this->supple_weko_url) == 0){
                     $this->supple_weko_url = "";
                     $this->Session->setParameter("error_msg", "ERROR : supple weko URL");
-                    $this->failTrans();
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
             }
             // Bugfix form sanitizing Y.Nakao 2011/06/16 --end--
@@ -1450,9 +1417,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("supple_weko_url update failed : %s", $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			
 			// サプリコンテンツ査読承認のON/OFF
@@ -1468,9 +1434,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				$errMsg = $this->Db->ErrorMsg();
 				$tmpstr = sprintf("review_flg_supple update failed : %s", $ii, $jj, $errMsg ); 
 				$this->Session->setParameter("error_msg", $tmpstr);
-				$this->failTrans();		//トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-				return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
 			}
 			// Add supple WEKO setting 2009/09/09 A.Suzuki --end--
 			
@@ -1484,9 +1449,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("help_icon_display update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//ROLLBACK
-                    $this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add index list 2011/4/5 S.Abe --start--
@@ -1499,9 +1463,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                     $errMsg = $this->Db->ErrorMsg();
                     $tmpstr = sprintf("select_index_list_display update failed : %s", $ii, $jj, $errMsg ); 
                     $this->Session->setParameter("error_msg", $tmpstr);
-                    $this->failTrans();     //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
             }
 			// Add index list 2011/4/5 S.Abe --end--
@@ -1514,9 +1477,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("oaiore_icon_display update failed : %s", $ii, $jj, $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//ROLLBACK
-                    $this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add help icon and OAI-ORE icon setting 2010/02/10 K.Ando --end--
@@ -1537,9 +1499,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("exclude_address_for_feedback update failed : %s", $errMsg ); 
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             
             $params[0] = $this->feedback_exclude_address_list;  // param_value
@@ -1549,9 +1510,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("exclude_address_for_feedback update failed : %s", $errMsg ); 
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             // Add send feedback mail 2012/08/24 A.Suzuki --end--
             // Add send sitelicense mail 2014/04/23 T.Ichikawa --start--
@@ -1570,9 +1530,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 $errMsg = $this->Db->ErrorMsg();
                 $tmpstr = sprintf("exclude_address_for_sitelicense update failed : %s", $errMsg ); 
                 $this->Session->setParameter("error_msg", $tmpstr);
-                $this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-                $this->exitAction();
-                return 'error';
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
             // Add send sitelicense mail 2014/04/23 T.Ichikawa --end--
 			// Add private tree parameter K.Matsuo 2013/4/5 --start--
@@ -1592,9 +1551,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("is_make_privatetree update failed : %s", $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-					$this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 				// Add file rewrite for privatetree edit tab authority K.Matsuo 2013/04/24 --start--
 				$define_inc_file_path = WEBAPP_DIR. '/modules/repository/config/define.inc.php';
@@ -1624,9 +1582,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("is_make_privatetree update failed : %s", $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-					$this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			// Add file rewrite for privatetree edit tab authority K.Matsuo 2013/04/24 --end--
@@ -1638,9 +1595,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 					$errMsg = $this->Db->ErrorMsg();
 					$tmpstr = sprintf("privatetree_sort_order update failed : %s", $errMsg ); 
 					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-					$this->exitAction();
-					return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
 				}
 			}
 			if($this->privatetree_parent_indexid != null){
@@ -1653,16 +1609,15 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 						$errMsg = $this->Db->ErrorMsg();
 						$tmpstr = sprintf("privatetree_parent_indexid update failed : %s", $errMsg ); 
 						$this->Session->setParameter("error_msg", $tmpstr);
-						$this->failTrans();     //トランザクション失敗を設定(ROLLBACK)
-						$this->exitAction();
-						return 'error';
+        			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                        throw new AppException($tmpstr);
 					}
 					// 現在のプライベートツリーの親インデックスを新しく設定した親インデックスに変更
 					$query = "SELECT `index_id` ".
 							 "FROM ". DATABASE_PREFIX ."repository_index ".
 							 "WHERE `owner_user_id` != '' AND " .
 							 "`parent_index_id` = ? AND ".
-							 "`is_delete` = '0' ".
+							 "`is_delete` = 0 ".
 							 "ORDER BY show_order ;";
 					$queryParams = null;
 					$queryParams[] = $admin_records['privatetree_parent_indexid']['param_value'];
@@ -1690,6 +1645,20 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 				}
 			}
 			// Add private tree parameter K.Matsuo 2013/4/5 --end--
+			
+			// Add institution Name S.Suzuki 2014/12/19 --start--
+            $params[0] = $this->institutionName;    // param_value
+            $params[3] = 'institution_name';        // param_name
+            $result = $this->updateParamTableData($params, $Error_Msg);
+            if ($result === false) {
+                $errMsg = $this->Db->ErrorMsg();
+                $tmpstr = sprintf("institution_name update failed : %s", $errMsg ); 
+                $this->Session->setParameter("error_msg", $tmpstr);
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
+            }
+			// Add institution Name S.Suzuki 2014/12/19 --end--
+			
 			// Add external author ID prefix 2010/11/11 A.Suzuki --start--
             if($this->external_author_id_prefix_text != null){
 			    $NameAuthority = new NameAuthority($this->Session, $this->Db);
@@ -1703,13 +1672,12 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 			    }
                 $result = $NameAuthority->entryExternalAuthorIdPrefix($prefix_data);
                 if($result===false){
-                    $this->failTrans();     //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
             }
 			// Add external author ID prefix 2010/11/11 A.Suzuki --end--
-
+			
             // Add URL rewrite 2011/11/15 T.Koyasu -start-
             $use_url_rewrite = $this->Session->getParameter('use_url_rewrite');
             // chage url rewrite radio button -> resetting .htaccess
@@ -1839,10 +1807,10 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                     // Upsert repositories data
                     if(!$Harvesting->UpsertRepositoriesData($harvestingRepositories, $user_id, $edit_start_date))
                     {
-                        $this->Session->setParameter("error_msg", "Failed to upsert repository information for Harvesting.");
-                        $this->failTrans();     //ROLLBACK
-                        $this->exitAction();
-                        return 'error';
+                        $tmpstr = "Failed to upsert repository information for Harvesting.";
+                        $this->Session->setParameter("error_msg", $tmpstr);
+        			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                        throw new AppException($tmpstr);
                     }
                 }
             }
@@ -1861,29 +1829,27 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                     $errMsg = $this->Db->ErrorMsg();
                     $tmpstr = sprintf("headerType update failed : %s", $errMsg ); 
                     $this->Session->setParameter("error_msg", $tmpstr);
-                    $this->failTrans(); //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
             }
             
-            // PDF cover header text
-            if($this->pdf_cover_header_text != null){
-                $params = array();
-                $params[RepositoryConst::DBCOL_REPOSITORY_PDF_COVER_PARAMETER_PARAM_NAME] = RepositoryConst::PDF_COVER_PARAM_NAME_HEADER_TEXT;
-                $params[RepositoryConst::DBCOL_REPOSITORY_PDF_COVER_PARAMETER_TEXT] = mb_strimwidth($this->pdf_cover_header_text, 0, 100);
-                $params[RepositoryConst::DBCOL_COMMON_MOD_USER_ID] = $user_id;
-                $params[RepositoryConst::DBCOL_COMMON_MOD_DATE] = $this->TransStartDate;
-                $result = $this->updatePdfCoverParamByParamName($params);
-                if ($result === false) {
-                    $errMsg = $this->Db->ErrorMsg();
-                    $tmpstr = sprintf("headerText update failed : %s", $errMsg ); 
-                    $this->Session->setParameter("error_msg", $tmpstr);
-                    $this->failTrans(); //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
-                }
+            // PDF cover header text 
+            // Delete null check(pdf_cover_header_text) K.Matsushita 2015/2/5 --start--
+            $params = array();
+            $params[RepositoryConst::DBCOL_REPOSITORY_PDF_COVER_PARAMETER_PARAM_NAME] = RepositoryConst::PDF_COVER_PARAM_NAME_HEADER_TEXT;
+            $params[RepositoryConst::DBCOL_REPOSITORY_PDF_COVER_PARAMETER_TEXT] = mb_strimwidth($this->pdf_cover_header_text, 0, 100);
+            $params[RepositoryConst::DBCOL_COMMON_MOD_USER_ID] = $user_id;
+            $params[RepositoryConst::DBCOL_COMMON_MOD_DATE] = $this->TransStartDate;
+            $result = $this->updatePdfCoverParamByParamName($params);
+            if ($result === false) {
+                $errMsg = $this->Db->ErrorMsg();
+                $tmpstr = sprintf("headerText update failed : %s", $errMsg ); 
+                $this->Session->setParameter("error_msg", $tmpstr);
+			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($tmpstr);
             }
+            // Delete null check(pdf_cover_header_text) K.Matsushita 2015/2/5 --end--
             
             // PDF cover header image
             $uploadFile = $this->Session->getParameter("repositoryAdminFileList");
@@ -1914,23 +1880,22 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                     $errMsg = $this->Db->ErrorMsg();
                     $tmpstr = sprintf("headerImage update failed : %s", $errMsg ); 
                     $this->Session->setParameter("error_msg", $tmpstr);
-                    $this->failTrans(); //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
             }
             else if(is_array($uploadFile) && count($uploadFile) > 0)
             {
                 if(!is_numeric(strpos($uploadFile["mimetype"],"image")) || !$this->checkHeaderImageExtension($uploadFile["extension"]))
                 {
-                    $this->Session->setParameter("error_msg", "Uploaded file to the Header Image cannot be used!");
+                    $tmpstr = "Uploaded file to the Header Image cannot be used!";
+                    $this->Session->setParameter("error_msg", $tmpstr);
                     
                     // delete upload file
                     $this->uploadsAction->delUploadsById($uploadFile["upload_id"]);
                     
-                    $this->failTrans(); //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
                 else
                 {
@@ -1956,9 +1921,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                         // delete upload file
                         $this->uploadsAction->delUploadsById($uploadFile["upload_id"]);
                         
-                        $this->failTrans(); //ROLLBACK
-                        $this->exitAction();
-                        return 'error';
+        			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                        throw new AppException($tmpstr);
                     }
                     $path = WEBAPP_DIR. "/uploads/repository/".$uploadFile['physical_file_name'];
                     $ret = $this->Db->updateBlobFile(
@@ -1976,9 +1940,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                         // delete upload file
                         $this->uploadsAction->delUploadsById($uploadFile["upload_id"]);
                         
-                        $this->failTrans(); //ROLLBACK
-                        $this->exitAction();
-                        return 'error';
+        			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                        throw new AppException($tmpstr);
                     }
                     
                     // delete upload file
@@ -1998,9 +1961,8 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                     $errMsg = $this->Db->ErrorMsg();
                     $tmpstr = sprintf("headerAlign update failed : %s", $errMsg ); 
                     $this->Session->setParameter("error_msg", $tmpstr);
-                    $this->failTrans(); //ROLLBACK
-                    $this->exitAction();
-                    return 'error';
+    			    $this->errorLog($tmpstr, __FILE__, __CLASS__, __LINE__);
+                    throw new AppException($tmpstr);
                 }
             }
             
@@ -2010,7 +1972,17 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 			
             //Add Prefix Admin 2013/12/24 T.Ichikawa --start--
             $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->dbAccess, $this->TransStartDate);
-            $repositoryHandleManager->registerPrefix($this->prefixJalcDoi, $this->prefixCrossRef, $this->prefixCnri);
+        	// Add DataCite 2015/02/09 K.Sugimoto --start--
+            $repositoryHandleManager->registerPrefix($this->prefixJalcDoi, $this->prefixCrossRef, $this->prefixDataCite, $this->prefixCnri);
+            if(isset($repositoryHandleManager->err_msg) && strlen($repositoryHandleManager->err_msg) > 0)
+            {
+                //エラーメッセージ「PrefixIDのフォーマットが不正です」
+                $error_message = $smartyAssign->getLang("repository_admin_prefix_incorrect");
+                $this->Session->setParameter("error_msg", $error_message);
+			    $this->errorLog($error_message, __FILE__, __CLASS__, __LINE__);
+                throw new AppException($error_message);
+            }
+        	// Add DataCite 2015/02/09 K.Sugimoto --end--
             //Add Prefix Admin 2013/12/24 T.Ichikawa --end--
 			
             // Add Detail Search 2013/11/20 R.Matsuura --start--
@@ -2049,28 +2021,67 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
 		    $params[] = "output_oaipmh";
 		    $this->dbAccess->executeQuery($query, $params);
             
+            // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+            // Default Search Type
+            $query = "UPDATE ".DATABASE_PREFIX. "repository_parameter ".
+			         "SET `param_value` = ? ".
+			         "WHERE `param_name` = ? ;";
+		    $params = array();
+		    $params[] = $this->default_search_type;
+		    $params[] = "default_search_type";
+		    $this->dbAccess->executeQuery($query, $params);
+            // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+            // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+            $query = "UPDATE ".DATABASE_PREFIX. "repository_parameter ".
+                    "SET `param_value` = ? ".
+                    "WHERE `param_name` = ? ;";
+            $params = array();
+            $params[] = $this->usagestatistics_link_display;
+            $params[] = "usagestatistics_link_display";
+            $this->dbAccess->executeQuery($query, $params);
+            // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+            
+            // Add DataCite 2015/02/09 K.Sugimoto --start--
+	        $query = "SELECT COUNT(*) ".
+	                 "FROM ".DATABASE_PREFIX."repository_doi_status ;";
+            $params = array();
+	        $result = $this->dbAccess->executeQuery($query, $params);
+	        
+	        if(isset($this->prefix_flag) && $result[0]["COUNT(*)"] == 0){
+	            // PrefixID Add Flag
+	            $query = "UPDATE ".DATABASE_PREFIX. "repository_parameter ".
+				         "SET `param_value` = ? ".
+				         "WHERE `param_name` = ? ;";
+			    $params = array();
+			    $params[] = $this->prefix_flag;
+			    $params[] = "prefix_flag";
+			    $this->dbAccess->executeQuery($query, $params);
+		    }
+            // Add DataCite 2015/02/09 K.Sugimoto --end--
+            
+            // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+            $query = "UPDATE ".DATABASE_PREFIX. "repository_parameter ".
+                    "SET `param_value` = ? ".
+                    "WHERE `param_name` = ? ;";
+            $params = array();
+            $params[] = $this->CrossRefQueryServicesAccount;
+            $params[] = "crossref_query_service_account";
+            $this->dbAccess->executeQuery($query, $params);
+            // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+            
+            // Add RobotList 2015/04/06 S.Suzuki --start--
+            $this->robotlistCheckboxUpdate();
+            // Add RobotList 2015/04/06 S.Suzuki --end--
+            
 			// アクション終了処理
-			$result = $this->exitAction();	// トランザクションが成功していればCOMMITされる
+			// $result = $this->exitAction();	// トランザクションが成功していればCOMMITされる
 			// return 'success';
 			
 			// redirect
 			$this->Session->setParameter("redirect_flg", "admin");
 			return 'redirect';
 			
-		}
-		catch ( RepositoryException $Exception) {
-			//エラーログ出力
-            $this->logFile(
-				"SampleAction",					//クラス名
-				"execute",						//メソッド名
-				$Exception->getCode(),			//ログID
-				$Exception->getMessage(),		//主メッセージ
-				$Exception->getDetailMsg() );	//詳細メッセージ			
-			//アクション終了処理
-	  		$this->exitAction();				   //トランザクションが失敗していればROLLBACKされる		
-			//異常終了
-			return "error";
-		}
 	}
 	
 	/**
@@ -2115,7 +2126,7 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
                 // make pattern for preg_match
                 $replaced_path = preg_quote($path, "/");
                 $pattern = "/RewriteBase +" .$replaced_path ."/";
-
+                
                 // file change or not
                 $url_rewrite_flg = false;
                 $flg_pattern = "/RewriteEngine +On/";
@@ -2217,5 +2228,312 @@ class Repository_Action_Edit_Adminadmit extends RepositoryAction
         
         return true;
 	}
+    
+    // Add multi ip address 2015/01/21 T.Ichikawa --start--
+    /**
+     * update sitelicense info
+     * 
+     * @return boolean
+     */
+    private function executeUpdateSitelicense(&$errMsg="")
+    {
+        // 一度全てのデータを削除状態にする
+        $query = "UPDATE ".DATABASE_PREFIX. "repository_sitelicense_info ".
+                 "SET show_order = ?, del_user_id = ?, del_date = ?, is_delete = ? ;";
+        $params = array();
+        $params[] = 0;
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->TransStartDate;
+        $params[] = 1;
+        $result1 = $this->dbAccess->executeQuery($query, $params);
+        $query = "UPDATE ".DATABASE_PREFIX. "repository_sitelicense_ip_address ".
+                 "SET del_user_id = ?, del_date = ?, is_delete = ? ;";
+        $params = array();
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->TransStartDate;
+        $params[] = 1;
+        $result2 = $this->dbAccess->executeQuery($query, $params);
+        if($result1 == false || $result2 == false) {
+            $errMsg = "Updating database is failed";
+            return false;
+        }
+        
+        // サイトライセンス情報を取得する
+        $show_order = 0;
+        for($ii= 0 ; $ii < count($this->sitelicense_id); $ii++) {
+            $this->sitelicense_org[$ii] = str_replace(" ", "", $this->sitelicense_org[$ii]);
+            // 機関名が入力されていない場合はエラー
+            if(strlen($this->sitelicense_org[$ii]) == 0) {
+                $errMsg = "Please enter Organization name";
+                return false;
+            } else {
+                // 新規追加の機関の場合はIDを発行する
+                if($this->sitelicense_id[$ii] == 0) {
+                    // 最新のサイトライセンス機関IDを取得する
+                    $query = "SELECT organization_id FROM ". DATABASE_PREFIX. "repository_sitelicense_info ".
+                             "ORDER BY organization_id DESC ".
+                             "LIMIT 0, 1 ;";
+                    $sitelicense_seq_id = $this->dbAccess->executeQuery($query);
+                    if(count($sitelicense_seq_id) > 0) {
+                        $this->sitelicense_id[$ii] = intval($sitelicense_seq_id[0]["organization_id"]) + 1;
+                    } else {
+                        $this->sitelicense_id[$ii] = 1;
+                    }
+                }
+                $this->sitelicense_group[$ii] = str_replace(" ", "", $this->sitelicense_group[$ii]);
+                $this->sitelicense_mail[$ii] = str_replace(" ", "", $this->sitelicense_mail[$ii]);
+                
+                // IPアドレス整形
+                $ip_address = array();
+                $cnt_enable_ip = 0;
+                for($jj = 0; $jj < count($this->ip_sitelicense_from[$ii]); $jj++) {
+                    // 開始IP
+                    $tmp_start_ip = str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][0]). ".".
+                                    str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][1]). ".".
+                                    str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][2]). ".".
+                                    str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][3]);
+                    if(preg_match("/^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/", $tmp_start_ip) == 1) {
+                        $ip_address[$cnt_enable_ip]["start"] = $tmp_start_ip;
+                        // 終了IP
+                        $tmp_finish_ip = str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][0]). ".".
+                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][1]). ".".
+                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][2]). ".".
+                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][3]);
+                        if(preg_match("/^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/", $tmp_finish_ip) == 1) {
+                            $ip_address[$cnt_enable_ip]["finish"] = $tmp_finish_ip;
+                        } else {
+                            $ip_address[$cnt_enable_ip]["finish"] = "";
+                        }
+                        
+                        $cnt_enable_ip++;
+                    }
+                }
+                
+                // 組織名もIPアドレスもない場合エラー
+                if(count($ip_address) == 0 && strlen($this->sitelicense_group[$ii]) == 0) {
+                    $errMsg = "Please enter OrganizationName or IP Adress Range ";
+                    return false;
+                } else if(count($ip_address) == 0 && strlen($this->sitelicense_group[$ii]) > 0) {
+                    // 組織名のみ入力されている場合IP配列に空文字を追加
+                    $ip_address[0]["start"] = "";
+                    $ip_address[0]["finish"] = "";
+                }
+                
+                // サイトライセンス機関情報登録
+                $show_order++;
+                $query = "INSERT INTO ". DATABASE_PREFIX. "repository_sitelicense_info ".
+                         "(organization_id, show_order, organization_name, group_name, mail_address, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                         "VALUES ".
+                         "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ".
+                         "ON DUPLICATE KEY UPDATE ".
+                         "show_order = ?, ".
+                         "organization_name = ?, ".
+                         "group_name = ?, ".
+                         "mail_address = ?, ".
+                         "mod_user_id = ?, ".
+                         "del_user_id = ?, ".
+                         "mod_date = ?, ".
+                         "del_date = ?, ".
+                         "is_delete = ? ;";
+                $params = array();
+                $params[] = $this->sitelicense_id[$ii];               // INSERT:機関ID
+                $params[] = $show_order;                              // INSERT:ソート順
+                $params[] = $this->sitelicense_org[$ii];              // INSERT:機関名
+                $params[] = $this->sitelicense_group[$ii];            // INSERT:組織名
+                $params[] = $this->sitelicense_mail[$ii];             // INSERT:メールアドレス
+                $params[] = $this->Session->getParameter("_user_id"); // INSERT:登録者
+                $params[] = $this->Session->getParameter("_user_id"); // INSERT:更新者
+                $params[] = "";                                       // INSERT:削除者
+                $params[] = $this->TransStartDate;                    // INSERT:登録日時
+                $params[] = $this->TransStartDate;                    // INSERT:更新日時
+                $params[] = "";                                       // INSERT:削除日時
+                $params[] = 0;                                        // INSERT:削除フラグ
+                $params[] = $show_order;                              // UPDATE:ソート順
+                $params[] = $this->sitelicense_org[$ii];              // UPDATE:機関名
+                $params[] = $this->sitelicense_group[$ii];            // UPDATE:組織名
+                $params[] = $this->sitelicense_mail[$ii];             // UPDATE:メールアドレス
+                $params[] = $this->Session->getParameter("_user_id"); // UPDATE:更新者
+                $params[] = "";                                       // UPDATE:削除者
+                $params[] = $this->TransStartDate;                    // UPDATE:更新日時
+                $params[] = "";                                       // UPDATE:削除日時
+                $params[] = 0;                                        // UPDATE:削除フラグ
+                $result = $this->dbAccess->executeQuery($query, $params);
+                if($result == false) {
+                    $errMsg = "Updating database is failed";
+                    return false;
+                }
+                
+                // サイトライセンスIP情報登録
+                if(count($ip_address) > 0) {
+                    $ip_address_no = 0;
+                    for($jj = 0; $jj < count($ip_address); $jj++) {
+                        $ip_address_no++;
+                        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_sitelicense_ip_address ".
+                                 "(organization_id, organization_no, start_ip_address, finish_ip_address, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                                 "VALUES ".
+                                 "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ".
+                                 "ON DUPLICATE KEY UPDATE ".
+                                 "start_ip_address = ?, ".
+                                 "finish_ip_address = ?, ".
+                                 "mod_user_id = ?, ".
+                                 "del_user_id = ?, ".
+                                 "mod_date = ?, ".
+                                 "del_date = ?, ".
+                                 "is_delete = ? ;";
+                        $params = array();
+                        $params[] = $this->sitelicense_id[$ii];               // INSERT:機関ID
+                        $params[] = $ip_address_no;                           // INSERT:機関IPアドレスNo
+                        $params[] = $ip_address[$jj]["start"];                // INSERT:IPアドレス（開始部分）
+                        $params[] = $ip_address[$jj]["finish"];               // INSERT:IPアドレス（終了部分）
+                        $params[] = $this->Session->getParameter("_user_id"); // INSERT:登録者
+                        $params[] = $this->Session->getParameter("_user_id"); // INSERT:更新者
+                        $params[] = "";                                       // INSERT:削除者
+                        $params[] = $this->TransStartDate;                    // INSERT:登録日時
+                        $params[] = $this->TransStartDate;                    // INSERT:更新日時
+                        $params[] = "";                                       // INSERT:削除日時
+                        $params[] = 0;                                        // INSERT:削除フラグ
+                        $params[] = $ip_address[$jj]["start"];                // UPDATE:IPアドレス（開始部分）
+                        $params[] = $ip_address[$jj]["finish"];               // UPDATE:IPアドレス（終了部分）
+                        $params[] = $this->Session->getParameter("_user_id"); // UPDATE:更新者
+                        $params[] = "";                                       // UPDATE:削除者
+                        $params[] = $this->TransStartDate;                    // UPDATE:更新日時
+                        $params[] = "";                                       // UPDATE:削除日時
+                        $params[] = 0;                                        // UPDATE:削除フラグ
+                        $result = $this->dbAccess->executeQuery($query, $params);
+                        if($result == false) {
+                            $errMsg = "Updating database is failed";
+                            return false;
+                        }
+                    }
+                }
+            }
+        }
+        
+        return true;
+    }
+    // Add multi ip address 2015/01/21 T.Ichikawa --end--
+    
+    // Add RobotList 2015/04/06 S.Suzuki --start--
+    /**
+     * update robotlist status
+     * 
+     * @return boolean
+     */
+    private function robotlistCheckboxUpdate()
+    {
+        // 現在の全てのロボットリストマスタの情報
+        $query = "SELECT * " . 
+                 "FROM " . DATABASE_PREFIX . "repository_robotlist_master ; ";
+        
+        $params = array();
+        $all = $this->Db->execute($query, $params);
+        
+        if($all === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        
+        $validIds = array();
+        if (isset($this->robotlistValid)){
+            $validIds = array_keys($this->robotlistValid);
+        }
+        
+        for ($ii = 0; $ii < count($all); $ii++) {
+            for ($jj = 0; $jj < count($validIds); $jj++) {
+                // 渡ってきた値が有効を示す
+                if ($all[$ii]["robotlist_id"] == $validIds[$jj]) {
+                    // 登録されている値が無効を示す
+                    if ($all[$ii]["is_robotlist_use"] == 0)
+                    {
+                        $query = "UPDATE " . DATABASE_PREFIX . "repository_robotlist_data " . 
+                                 "SET status = ?, " . 
+                                 "mod_user_id = ?, " . 
+                                 "mod_date = ? " . 
+                                 "WHERE robotlist_id = ? ; " ;
+                        
+                        $params = array();
+                        $params[] = "0"; 
+                        $params[] = $this->Session->getParameter("_user_id");
+                        $params[] = $this->TransStartDate;
+                        $params[] = $all[$ii]["robotlist_id"];
+                        
+                        $update = $this->Db->execute($query, $params);
+                        
+                        if($update === false) {
+                            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                            throw new AppException($this->Db->ErrorMsg());
+                        }
+                    }
+                }
+                // 渡ってきた値が無効を示す
+                else {
+                    // 登録されている値が有効を示す
+                    if ($all[$ii]["is_robotlist_use"] == 1)
+                    {
+                        $query = "UPDATE " . DATABASE_PREFIX . "repository_robotlist_data " . 
+                                 "SET status = ?, " . 
+                                 "mod_user_id = ?, " . 
+                                 "mod_date = ? " . 
+                                 "WHERE robotlist_id = ? ; " ;
+                        
+                        $params = array();
+                        $params[] = "-1"; 
+                        $params[] = $this->Session->getParameter("_user_id");
+                        $params[] = $this->TransStartDate;
+                        $params[] = $all[$ii]["robotlist_id"];
+                        
+                        $update = $this->Db->execute($query, $params);
+                        
+                        if($update === false) {
+                            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                            throw new AppException($this->Db->ErrorMsg());
+                        }
+                    }
+                }
+            }
+        }
+        
+        // 全て無効化
+        $query = "UPDATE " . DATABASE_PREFIX . "repository_robotlist_master " . 
+                 "SET is_robotlist_use = ?, " . 
+                 "mod_user_id = ?, " . 
+                 "mod_date = ? ; ";
+        
+        $params = array();
+        $params[] = 0; 
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->TransStartDate;
+        
+        $update = $this->Db->execute($query, $params);
+        
+        if($update === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        
+        // チェックされているものだけ有効化
+        for ($ii = 0; $ii < count($validIds); $ii++)
+        {
+            $query = "UPDATE " . DATABASE_PREFIX . "repository_robotlist_master " . 
+                     "SET is_robotlist_use = ?, " . 
+                     "mod_user_id = ?, " . 
+                     "mod_date = ? " . 
+                     "WHERE robotlist_id = ? ; " ;
+            
+            $params = array();
+            $params[] = 1; 
+            $params[] = $this->Session->getParameter("_user_id");
+            $params[] = $this->TransStartDate;
+            $params[] = $validIds[$ii];
+            
+            $update = $this->Db->execute($query, $params);
+            
+            if($update === false) {
+                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                throw new AppException($this->Db->ErrorMsg());
+            }
+        }
+    }
+    // Add RobotList 2015/04/06 S.Suzuki --end--
 }
 ?>
diff --git a/repository/action/edit/adminadmit/maple.ini b/repository/action/edit/adminadmit/maple.ini
index 66ce1b6..57fe967 100644
--- a/repository/action/edit/adminadmit/maple.ini
+++ b/repository/action/edit/adminadmit/maple.ini
@@ -48,6 +48,7 @@ harvesting_execution_date
 search_use_flag
 search_default_flag
 search_type_id
+robotlistValid
 
 [View]
 success = "action:repository_view_edit_admin"
diff --git a/repository/action/edit/admineditrow/Admineditrow.class.php b/repository/action/edit/admineditrow/Admineditrow.class.php
index f6dce18..bb136c1 100644
--- a/repository/action/edit/admineditrow/Admineditrow.class.php
+++ b/repository/action/edit/admineditrow/Admineditrow.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Admineditrow.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Admineditrow.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,7 +14,6 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHarvesting.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatisticsSendMail.class.php';
 
 /**
  * repository module admin action
@@ -91,6 +90,10 @@ class Repository_Action_Edit_Admineditrow extends RepositoryAction
 	// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
 	var $sitelicense_mail = null; // mail address for site license
 	// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
+	// Add multi ip address 2015/01/20 T.Ichikawa --start--
+	var $sitelicense_id = null;
+	var $sitelicense_group = null;
+	// Add multi ip address 2015/01/20 T.Ichikawa --end--
 	var $edit_type = null;			// edit type (addrow, shufflerow, deleterow, addHarvestRow, delHarvestRow, killHarvestingProcess, addExcludeAddress, killSendFeedbackMailProcess)
 	var $edit_idx = null;			// edit row number
 	
@@ -294,16 +297,44 @@ class Repository_Action_Edit_Admineditrow extends RepositoryAction
     // Bug Fix WEKO-2014-039 no inherit prefix from html 2014/07/11 --start--
     public $prefixJalcDoi = null;
     public $prefixCrossRef = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --start--
+    public $prefixDataCite = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --end--
     public $prefixCnri = null;
     // Bug Fix WEKO-2014-039 no inherit prefix from html 2014/07/11 --end--
     
-    //OAI-PMH Output Flag
+    // OAI-PMH Output Flag
     public $oaipmh_output_flag = null;
     
+    // Institution Name
+    public $institutionName = null;
+    
+    // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+    // Default Search Type
+    public $default_search_type = null;
+    // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+    public $usagestatistics_link_display = null;
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+    public $ranking_tab_display = null;
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+    
+    // Add DataCite 2015/02/09 K.Sugimoto --start--
+    // PrefixID Add Flag
+    public $prefix_flag = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --end--
+
+    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+    public $CrossRefQueryServicesAccount = null;
+    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+    
 	/**
 	 * @access  public
 	 */
-	function execute()
+	function executeApp()
 	{
 		$istest = true;	// test flag
 		try {
@@ -560,195 +591,119 @@ class Repository_Action_Edit_Admineditrow extends RepositoryAction
 			}
 			// Add privatetree setting 2013/04/05 K.Matsuo -end-
 			
-			if($this->edit_type == "addrow"){
-				// more input row
-				$cnt_ipaddress = 0;
-				$ipaddress_from = array();
-				$ipaddress_to = array();
-				for($ii=0; $ii<count($this->sitelicense_org); $ii++){
-					$this->sitelicense_org[$ii] = str_replace(" ", "", $this->sitelicense_org[$ii]);
-					$this->sitelicense_mail[$ii] = str_replace(" ", "", $this->sitelicense_mail[$ii]);
-					array_push($ipaddress_from, array(	str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3])
-												)
-					);
-					array_push($ipaddress_to, array(	str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3])
-												)
-					);
-					$cnt_ipaddress += 3;
-				}
-				if($this->sitelicense_org == null){
-					$this->sitelicense_org = array();
-					array_push($this->sitelicense_org, "");
-				} else {
-					array_push($this->sitelicense_org, "");
-				}
-				array_push($ipaddress_from, array("", "", ""));
-				array_push($ipaddress_to, array("", "", ""));
-				// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-				if($this->sitelicense_mail == null){
-					$this->sitelicense_mail = array();
-					array_push($this->sitelicense_mail, "");
-				} else {
-					array_push($this->sitelicense_mail, "");
-				}
-				// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-			} else if($this->edit_type == "shfrow_up"){
-				// shuffle row up
-				$cnt_ipaddress = 0;
-				$ipaddress_from = array();
-				$ipaddress_to = array();
-				for($ii=0; $ii<count($this->sitelicense_org); $ii++){
-					$this->sitelicense_org[$ii] = str_replace(" ", "", $this->sitelicense_org[$ii]);
-					$this->sitelicense_mail[$ii] = str_replace(" ", "", $this->sitelicense_mail[$ii]);
-					array_push($ipaddress_from, array(	str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3])
-												)
-					);
-					array_push($ipaddress_to, array(	str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3])
-												)
-					);
-					$cnt_ipaddress += 3;
-				}
-				// shuffle
-				for($ii=1; $ii<count($this->sitelicense_org); $ii++){
-					if($ii == $this->edit_idx){
-						$tmp = $this->sitelicense_org[$this->edit_idx];
-    					$this->sitelicense_org[$this->edit_idx] = $this->sitelicense_org[$this->edit_idx-1];
-    					$this->sitelicense_org[$this->edit_idx-1] = $tmp;
-    					
-    					$tmp = $ipaddress_from[$this->edit_idx];
-    					$ipaddress_from[$this->edit_idx] = $ipaddress_from[$this->edit_idx-1];
-    					$ipaddress_from[$this->edit_idx-1] = $tmp;
-    					
-    					$tmp = $ipaddress_to[$this->edit_idx];
-    					$ipaddress_to[$this->edit_idx] = $ipaddress_to[$this->edit_idx-1];
-    					$ipaddress_to[$this->edit_idx-1] = $tmp;
-    					
-						// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-						$tmp = $this->sitelicense_mail[$this->edit_idx];
-    					$this->sitelicense_mail[$this->edit_idx] = $this->sitelicense_mail[$this->edit_idx-1];
-    					$this->sitelicense_mail[$this->edit_idx-1] = $tmp;
-						// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-					}
-				}
-			} else if($this->edit_type == "shfrow_dw"){
-				// shuffle row down
-				$cnt_ipaddress = 0;
-				$ipaddress_from = array();
-				$ipaddress_to = array();
-				for($ii=0; $ii<count($this->sitelicense_org); $ii++){
-					$this->sitelicense_org[$ii] = str_replace(" ", "", $this->sitelicense_org[$ii]);
-					$this->sitelicense_mail[$ii] = str_replace(" ", "", $this->sitelicense_mail[$ii]);
-					array_push($ipaddress_from, array(	str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]),
-														str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3])
-												)
-					);
-					array_push($ipaddress_to, array(	str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]),
-														str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3])
-												)
-					);
-					$cnt_ipaddress += 3;
-				}
-				// shuffle
-				for($ii=0; $ii<count($this->sitelicense_org)-1; $ii++){
-					if($ii == $this->edit_idx){
-						$tmp = $this->sitelicense_org[$this->edit_idx];
-    					$this->sitelicense_org[$this->edit_idx] = $this->sitelicense_org[$this->edit_idx+1];
-    					$this->sitelicense_org[$this->edit_idx+1] = $tmp;
-    					
-    					$tmp = $ipaddress_from[$this->edit_idx];
-    					$ipaddress_from[$this->edit_idx] = $ipaddress_from[$this->edit_idx+1];
-    					$ipaddress_from[$this->edit_idx+1] = $tmp;
-    					
-    					$tmp = $ipaddress_to[$this->edit_idx];
-    					$ipaddress_to[$this->edit_idx] = $ipaddress_to[$this->edit_idx+1];
-    					$ipaddress_to[$this->edit_idx+1] = $tmp;
-    					
-    					// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-						$tmp = $this->sitelicense_mail[$this->edit_idx];
-    					$this->sitelicense_mail[$this->edit_idx] = $this->sitelicense_mail[$this->edit_idx+1];
-    					$this->sitelicense_mail[$this->edit_idx+1] = $tmp;
-						// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-					}
-				}
-			} else if($this->edit_type == "delrow"){
-				// delete row
-				$cnt_ipaddress = 0;
-				$sitelicense_org = array();
-				$ipaddress_from = array();
-				$ipaddress_to = array();
-    			// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-    			$sitelicense_mail = array();
-				// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-				for($ii=0; $ii<count($this->sitelicense_org); $ii++){
-					if($this->edit_idx != $ii){
-						array_push($sitelicense_org, str_replace(" ", "", $this->sitelicense_org[$ii]));
-						array_push($ipaddress_from, array(	str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]),
-															str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]),
-															str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]),
-															str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3])
-														 )
-						);
-						array_push($ipaddress_to, array(	str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]),
-															str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]),
-															str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]),
-															str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3])
-													   )
-						);
-		    			// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-		    			array_push($sitelicense_mail, str_replace(" ", "", $this->sitelicense_mail[$ii]));
-						// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-					}
-					$cnt_ipaddress += 3;
-				}
-				$this->sitelicense_org = array();
-				$this->sitelicense_org = $sitelicense_org;
-				// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-				$this->sitelicense_mail = array();
-				$this->sitelicense_mail = $sitelicense_mail;
-				// Add mail address for feedback mail 2014/04/11 T.Ichikawa --end--
-            } else {
-                $cnt_ipaddress = 0;
+            // Set SiteLicense
+            for($ii=0; $ii<count($this->sitelicense_id); $ii++){
+                $this->sitelicense_org[$ii] = str_replace(" ", "", $this->sitelicense_org[$ii]);
+                $this->sitelicense_group[$ii] = str_replace(" ", "", $this->sitelicense_group[$ii]);
+                $this->sitelicense_mail[$ii] = str_replace(" ", "", $this->sitelicense_mail[$ii]);
+                // IPは$ip[$ii][$jj][$kk]の形式で渡される
+                // $ii : 機関の数を表す, $jj : 機関に設定されたIPの数を表す, $kk : IPアドレスを表す。セグメントで分割されており0～3になる
                 $ipaddress_from = array();
+                for($jj = 0; $jj < count($this->ip_sitelicense_from[$ii]); $jj++) {
+                    array_push($ipaddress_from, array(
+                                                       str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][0]), 
+                                                       str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][1]), 
+                                                       str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][2]), 
+                                                       str_replace(" ", "", $this->ip_sitelicense_from[$ii][$jj][3])
+                                                     )
+                              );
+                }
+                $this->ip_sitelicense_from[$ii] = $ipaddress_from;
+                
                 $ipaddress_to = array();
-                for($ii=0; $ii<count($this->sitelicense_org); $ii++){
-                    $this->sitelicense_org[$ii] = str_replace(" ", "", $this->sitelicense_org[$ii]);
-                    $this->sitelicense_mail[$ii] = str_replace(" ", "", $this->sitelicense_mail[$ii]);
-                    array_push($ipaddress_from, array(  str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 0]),
-                                                        str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 1]),
-                                                        str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 2]),
-                                                        str_replace(" ", "", $this->ip_sitelicense_from[$ii + $cnt_ipaddress + 3])
-                                                )
-                    );
-                    array_push($ipaddress_to, array(    str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 0]),
-                                                        str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 1]),
-                                                        str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 2]),
-                                                        str_replace(" ", "", $this->ip_sitelicense_to[$ii + $cnt_ipaddress + 3])
-                                                )
-                    );
-                    $cnt_ipaddress += 3;
+                for($jj = 0; $jj < count($this->ip_sitelicense_to[$ii]); $jj++) {
+                    array_push($ipaddress_to, array(
+                                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][0]), 
+                                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][1]), 
+                                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][2]), 
+                                                         str_replace(" ", "", $this->ip_sitelicense_to[$ii][$jj][3])
+                                                        )
+                              );
                 }
+                $this->ip_sitelicense_to[$ii] = $ipaddress_to;
             }
-			$admin_params["sitelicense_org"]["param_value"] = $this->sitelicense_org;
-			$admin_params["ip_sitelicense_from"]["param_value"] = $ipaddress_from;
-			$admin_params["ip_sitelicense_to"]["param_value"] = $ipaddress_to;
-			// Add mail address for feedback mail 2014/04/11 T.Ichikawa --start--
-			$admin_params["sitelicense_mail"]["param_value"] = $this->sitelicense_mail;
+            if($this->edit_type == "addrow"){
+                // 各配列の末尾に空の値の要素を挿入する
+                $this->sitelicense_id[] = 0;
+                $this->sitelicense_org[] = "";
+                $this->sitelicense_group[] = "";
+                $this->ip_sitelicense_from[] = array(array("", "", "", ""));
+                $this->ip_sitelicense_to[] = array(array("", "", "", ""));
+                $this->sitelicense_mail[] = "";
+            } else if($this->edit_type == "shfrow_up"){
+                // 一つ前の要素と入れ替える
+                if($this->edit_idx > 0) {
+                    $tmp_id = $this->sitelicense_id[$this->edit_idx];
+                    $this->sitelicense_id[$this->edit_idx] = $this->sitelicense_id[$this->edit_idx-1];
+                    $this->sitelicense_id[$this->edit_idx-1] = $tmp_id;
+                    
+                    $tmp_org = $this->sitelicense_org[$this->edit_idx];
+                    $this->sitelicense_org[$this->edit_idx] = $this->sitelicense_org[$this->edit_idx-1];
+                    $this->sitelicense_org[$this->edit_idx-1] = $tmp_org;
+                    
+                    $tmp_group = $this->sitelicense_group[$this->edit_idx];
+                    $this->sitelicense_group[$this->edit_idx] = $this->sitelicense_group[$this->edit_idx-1];
+                    $this->sitelicense_group[$this->edit_idx-1] = $tmp_group;
+                    
+                    $tmp_start_ip = $this->ip_sitelicense_from[$this->edit_idx];
+                    $this->ip_sitelicense_from[$this->edit_idx] = $this->ip_sitelicense_from[$this->edit_idx-1];
+                    $this->ip_sitelicense_from[$this->edit_idx-1] = $tmp_start_ip;
+                    
+                    $tmp_finish_ip = $this->ip_sitelicense_to[$this->edit_idx];
+                    $this->ip_sitelicense_to[$this->edit_idx] = $this->ip_sitelicense_to[$this->edit_idx-1];
+                    $this->ip_sitelicense_to[$this->edit_idx-1] = $tmp_finish_ip;
+                    
+                    $tmp_mail = $this->sitelicense_mail[$this->edit_idx];
+                    $this->sitelicense_mail[$this->edit_idx] = $this->sitelicense_mail[$this->edit_idx-1];
+                    $this->sitelicense_mail[$this->edit_idx-1] = $tmp_mail;
+                }
+            } else if($this->edit_type == "shfrow_dw"){
+                // 一つ後の要素と入れ替える
+                if($this->edit_idx < count($this->sitelicense_id)-1) {
+                    $tmp_id = $this->sitelicense_id[$this->edit_idx];
+                    $this->sitelicense_id[$this->edit_idx] = $this->sitelicense_id[$this->edit_idx+1];
+                    $this->sitelicense_id[$this->edit_idx+1] = $tmp_id;
+                    
+                    $tmp_org = $this->sitelicense_org[$this->edit_idx];
+                    $this->sitelicense_org[$this->edit_idx] = $this->sitelicense_org[$this->edit_idx+1];
+                    $this->sitelicense_org[$this->edit_idx+1] = $tmp_org;
+                    
+                    $tmp_group = $this->sitelicense_group[$this->edit_idx];
+                    $this->sitelicense_group[$this->edit_idx] = $this->sitelicense_group[$this->edit_idx+1];
+                    $this->sitelicense_group[$this->edit_idx+1] = $tmp_group;
+                    
+                    $tmp_start_ip = $this->ip_sitelicense_from[$this->edit_idx];
+                    $this->ip_sitelicense_from[$this->edit_idx] = $this->ip_sitelicense_from[$this->edit_idx+1];
+                    $this->ip_sitelicense_from[$this->edit_idx+1] = $tmp_start_ip;
+                    
+                    $tmp_finish_ip = $this->ip_sitelicense_to[$this->edit_idx];
+                    $this->ip_sitelicense_to[$this->edit_idx] = $this->ip_sitelicense_to[$this->edit_idx+1];
+                    $this->ip_sitelicense_to[$this->edit_idx+1] = $tmp_finish_ip;
+                    
+                    $tmp_mail = $this->sitelicense_mail[$this->edit_idx];
+                    $this->sitelicense_mail[$this->edit_idx] = $this->sitelicense_mail[$this->edit_idx+1];
+                    $this->sitelicense_mail[$this->edit_idx+1] = $tmp_mail;
+                }
+            } else if($this->edit_type == "delrow"){
+                // 指定された要素を削除する
+                array_splice($this->sitelicense_id, $this->edit_idx, 1);
+                array_splice($this->sitelicense_org, $this->edit_idx, 1);
+                array_splice($this->sitelicense_group, $this->edit_idx, 1);
+                array_splice($this->ip_sitelicense_from, $this->edit_idx, 1);
+                array_splice($this->ip_sitelicense_to, $this->edit_idx, 1);
+                array_splice($this->sitelicense_mail, $this->edit_idx, 1);
+            } else if($this->edit_type == "addiprow") {
+                // IP配列の末尾に空の要素を追加する
+                $this->ip_sitelicense_from[$this->edit_idx][] = array("", "", "", "");
+                $this->ip_sitelicense_to[$this->edit_idx][] = array("", "", "", "");
+            }
+            $admin_params["sitelicense_id"]["param_value"] = $this->sitelicense_id;
+            $admin_params["sitelicense_org"]["param_value"] = $this->sitelicense_org;
+            $admin_params["sitelicense_group"]["param_value"] = $this->sitelicense_group;
+            $admin_params["ip_sitelicense_from"]["param_value"] = $this->ip_sitelicense_from;
+            $admin_params["ip_sitelicense_to"]["param_value"] = $this->ip_sitelicense_to;
+            $admin_params["sitelicense_mail"]["param_value"] = $this->sitelicense_mail;
+            
 			if(!isset($this->sitelicenseSendMailActivateFlag))
             {
                 $admin_params["send_sitelicense_mail_activate_flg"]["param_value"] = "0";
@@ -1218,16 +1173,17 @@ class Repository_Action_Edit_Admineditrow extends RepositoryAction
             }
             else if($this->edit_type == "killSendFeedbackMailProcess")
             {
-                $repositoryUsagestatisticsmail = new RepositoryUsagestatisticsSendMail($this->Session, $this->Db, $this->TransStartDate);
+                $this->infoLog("businessSendusagestatisticsmail", __FILE__, __CLASS__, __LINE__);
+                $repositoryUsagestatisticsmail = BusinessFactory::getFactory()->getBusiness("businessSendusagestatisticsmail");
                 $repositoryUsagestatisticsmail->killProcess();
-                $repositoryUsagestatisticsmail->openProgressFile(false);
-                $this->Session->setParameter("sendFeedbackStatus", $repositoryUsagestatisticsmail->getStatus());
+                // 引数は一番最後以外ダミー（リファレンス渡しになっているので一応変数を書いている）
+                $status = $repositoryUsagestatisticsmail->openProgressFile($mailAddress, $orderNum, $isAuhtor, $authorId, false);
+                $this->Session->setParameter("sendFeedbackStatus", $status);
             }
             $this->Session->setParameter("excludeUserDataList", $excludeUserDataList);
             $this->Session->setParameter("excludeUserDataText", $excludeUserDataText);
             // Add send feedback mail 2012/08/24 A.Suzuki --end--
             
-            
             // Add ichuushi fill 2012/11/21 A.jin --start--
             if($this->ichushiIsConnect == null){
                 $flg = 0;
@@ -1245,16 +1201,41 @@ class Repository_Action_Edit_Admineditrow extends RepositoryAction
             //再描画時に入力値がクリアされる問題対応 A.Jin 2012/11/30 --end--
             // Add ichuushi fill 2012/11/21 A.jin --end--
             
-            //OAI-PMH Output Flag
+            // OAI-PMH Output Flag
             $admin_params["oaipmh_output_flag"]["param_value"] = $this->oaipmh_output_flag;
             
-            $this->Session->setParameter("admin_params", $admin_params);
+            // Institution Name
+            $admin_params["institution_name"]["param_value"] = $this->institutionName;
+            
+            // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+            // Default Search Type
+            $admin_params["default_search_type"]["param_value"] = $this->default_search_type;
+            // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+            // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+            $admin_params["usagestatistics_link_display"]["param_value"] = $this->usagestatistics_link_display;
+            // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+            // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+            $admin_params["ranking_tab_display"]["param_value"] = $this->ranking_tab_display;
+            // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+            
+            // Add DataCite 2015/02/09 K.Sugimoto --start--
+            // PrefixID Add Flag
+            $admin_params["prefix_flag"]["param_value"] = $this->prefix_flag;
             
-            // Bug Fix WEKO-2014-039 no inherit prefix from html 2014/07/11 --start--
-            $this->Session->setParameter("prefixCnri", $this->prefixCnri);
-            $this->Session->setParameter("prefixJalcDoi", $this->prefixJalcDoi);
-            $this->Session->setParameter("prefixCrossRef", $this->prefixCrossRef);
-            // Bug Fix WEKO-2014-039 no inherit prefix from html 2014/07/11 --end--
+            // Prefix
+            $admin_params["prefixCnri"]["param_value"] = $this->prefixCnri;
+            $admin_params["prefixJalcDoi"]["param_value"] = $this->prefixJalcDoi;
+            $admin_params["prefixCrossRef"]["param_value"] = $this->prefixCrossRef;
+            $admin_params["prefixDataCite"]["param_value"] = $this->prefixDataCite;
+            // Add DataCite 2015/02/09 K.Sugimoto --end--
+
+		    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+            $admin_params["CrossRefQueryServicesAccount"]["param_value"] = $this->CrossRefQueryServicesAccount;
+		    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+            
+            $this->Session->setParameter("admin_params", $admin_params);
             
 			// アクション終了処理
 			$result = $this->exitAction();	// トランザクションが成功していればCOMMITされる
diff --git a/repository/action/edit/admineditrow/maple.ini b/repository/action/edit/admineditrow/maple.ini
index b8198aa..3d30cd1 100644
--- a/repository/action/edit/admineditrow/maple.ini
+++ b/repository/action/edit/admineditrow/maple.ini
@@ -1,9 +1,6 @@
 ;[Convert]
 ;*.trim =
 
-[DIContainer]
-filename_upload = "dicon.ini"
-
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
diff --git a/repository/action/edit/adminupload/Adminupload.class.php b/repository/action/edit/adminupload/Adminupload.class.php
index 18e1fb8..f50c3e7 100644
--- a/repository/action/edit/adminupload/Adminupload.class.php
+++ b/repository/action/edit/adminupload/Adminupload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Adminupload.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: Adminupload.class.php 18290 2012-06-25 07:05:42Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/cinii/ElsCommon.class.php b/repository/action/edit/cinii/ElsCommon.class.php
index f16c314..32681b9 100644
--- a/repository/action/edit/cinii/ElsCommon.class.php
+++ b/repository/action/edit/cinii/ElsCommon.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: ElsCommon.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: ElsCommon.class.php 36236 2014-05-26 07:53:04Z satoshi_arata $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/cinii/admin/Admin.class.php b/repository/action/edit/cinii/admin/Admin.class.php
index 8c61633..b0b2687 100644
--- a/repository/action/edit/cinii/admin/Admin.class.php
+++ b/repository/action/edit/cinii/admin/Admin.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Admin.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: Admin.class.php 20119 2012-11-02 10:33:38Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/cinii/els/download/Download.class.php b/repository/action/edit/cinii/els/download/Download.class.php
index 7ef03f2..3b402ad 100644
--- a/repository/action/edit/cinii/els/download/Download.class.php
+++ b/repository/action/edit/cinii/els/download/Download.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Download.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: Download.class.php 22551 2013-05-13 00:57:50Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/cinii/els/entry/Entry.class.php b/repository/action/edit/cinii/els/entry/Entry.class.php
index ab7a45a..73a6bf7 100644
--- a/repository/action/edit/cinii/els/entry/Entry.class.php
+++ b/repository/action/edit/cinii/els/entry/Entry.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Entry.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: Entry.class.php 22551 2013-05-13 00:57:50Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/cinii/els/setting/Setting.class.php b/repository/action/edit/cinii/els/setting/Setting.class.php
index 0af5729..8ede13a 100644
--- a/repository/action/edit/cinii/els/setting/Setting.class.php
+++ b/repository/action/edit/cinii/els/setting/Setting.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setting.class.php 421 2010-07-06 00:57:14Z ivis $
+// $Id: Setting.class.php 945 2010-07-05 06:09:05Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/createfulltext/Createfulltext.class.php b/repository/action/edit/createfulltext/Createfulltext.class.php
index 5cc03d3..8bce782 100644
--- a/repository/action/edit/createfulltext/Createfulltext.class.php
+++ b/repository/action/edit/createfulltext/Createfulltext.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Createfulltext.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Createfulltext.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/import/ImportCommon.class.php b/repository/action/edit/import/ImportCommon.class.php
index 7a15668..c600b2b 100644
--- a/repository/action/edit/import/ImportCommon.class.php
+++ b/repository/action/edit/import/ImportCommon.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: ImportCommon.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: ImportCommon.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -26,6 +26,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryCheckFileType
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryImportXmlValidator.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/ItemtypeManager.class.php';
 
 /**
  * Import common action
@@ -48,6 +49,7 @@ class ImportCommon extends RepositoryAction
     const DAY = "day";
 
     private $repositoryHandleManager = null;
+    private $itemtypeManager = null;
 
     /**
      * Set log file handle
@@ -148,8 +150,8 @@ class ImportCommon extends RepositoryAction
             $rtn = xml_parse_into_struct( $xml_parser, $content, $vals );
             
             if($rtn == 0){
-                $this->Session->setParameter("error_msg", "Not right XML.");
-                $this->writeLog("error_msg: Not right XML.");
+                $this->Session->setParameter("error_msg", "Invalid XML Format.");
+                $this->writeLog("error_msg: Invalid XML Format.");
                 $this->writeLog("-- End XMLAnalysis in ImportCommon class --\n");
                 return false;
             }
@@ -186,6 +188,9 @@ class ImportCommon extends RepositoryAction
         $suffix_column = array('ITEM_ID', 'ITEM_NO', 'CNRI');
         // Add cnri handle T.Ichikawa --start-- 2014/09/17 --end--
         $selfdoi_column = array('ITEM_ID', 'ITEM_NO', 'RA', 'SELFDOI');
+        // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/17 --start--
+        $supple_column = array('ITEM_ID','ITEM_NO','VALUE','SUPPLE_NO','ITEM_TYPE_ID','SUPPLE_WEKO_ITEM_ID','SUPPLE_TITLE','SUPPLE_TITLE_EN','URI','SUPPLE_ITEM_TYPE_NAME','MIME_TYPE','FILE_ID','SUPPLE_REVIEW_STATUS','SUPPLE_REVIEW_DATE','SUPPLE_REJECT_STATUS','SUPPLE_REJECT_DATE','SUPPLE_REJECT__REASON');
+        // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/17 --end--
 
         // Object array(Key: The one that main key tied by '_' and value: Array of item (Key = column name: Value = value))
         $item_key_array = array();                  // item
@@ -204,7 +209,8 @@ class ImportCommon extends RepositoryAction
         $feedback_mailaddress_key_array = array();      // Add  e-person R.Matsuura 2013/10/21 --Add--
         $cnri_key_array = array();                  // Add cnri handle T.Ichikawa 2014/09/17 --Add--
         $selfdoi_key_array = array();
-        
+        $supple_info_key_array = array();           // Add suppleContentsEntry Y.Yamazawa 2015/03/17 --Add--
+
         // KeyMap（Key=existing ID、Value=new ID）
         $item_type_key_map = array();
         $item_key_map = array();
@@ -227,6 +233,7 @@ class ImportCommon extends RepositoryAction
         $feedback_mailaddress_array = array();      // Add  e-person R.Matsuura 2013/10/21 --Add--
         $cnri_array = array();                  // Add cnri handle T.Ichikawa 2014/09/17 --Add--
         $selfdoi_array = array();
+        $supple_info_array = array();           // Add suppleContentsEntry Y.Yamazawa 2015/03/17 --Add--
 
         $array_item_type_data = array(); // XML data of each item type
         $array_item_data = array(); // XML data of each item
@@ -288,7 +295,8 @@ class ImportCommon extends RepositoryAction
                                                 'edit_array' => $edit_array,
                                                 'feedback_mailaddress_array' => $feedback_mailaddress_array,
                                                 'cnri_array' => $cnri_array,
-                                                'selfdoi_array' => $selfdoi_array
+                                                'selfdoi_array' => $selfdoi_array,
+                                                'supple_info_array' => $supple_info_array
                                         )
                         );
                         $item_array = array();
@@ -307,6 +315,7 @@ class ImportCommon extends RepositoryAction
                         $feedback_mailaddress_array = array();      // Add  e-person R.Matsuura 2013/10/24 --Add--
                         $cnri_array = array();                  // Add cnri handle T.Ichikawa 2014/09/17 --Add--
                         $selfdoi_array = array();
+                        $supple_info_array = array();
                     }
 
                     $insert_data = $this->pickupData($vals[$row_cnt]['attributes'], $item_column );
@@ -484,6 +493,28 @@ class ImportCommon extends RepositoryAction
                     $selfdoi_key_array[] = $key;
                     $selfdoi_array = array_merge($selfdoi_array, array($insert_data));
                     break;
+                // Add suppleContentsEntry 2015/03/17 Y.Yamazawa --start--
+                case 'REPOSITORY_SUPPLE':
+                    $insert_data = $this->pickupData($vals[$row_cnt]['attributes'], $supple_column);
+                    $key = $insert_data['ITEM_ID'] . '_' . $insert_data['ITEM_NO']. '_'. $insert_data['SUPPLE_NO'];
+                    // 既に配列内に同様のKey値がある場合はコンテニュー
+                    if (in_array($key, $supple_info_key_array)) {
+                        $this->traceLog("conflict data", __FILE__, __CLASS__, __LINE__);
+                        continue;   // skip conflict data
+                    }
+
+                    $supple_info_key_array[] = $key;
+
+                    // サプリコンテンツURLが複数ある場合"|"で分割する
+                    $suppleContensURL = explode("|", $vals[$row_cnt]['value']);
+
+                    // サプリコンテンツURL分配列に詰める
+                    foreach ($suppleContensURL as $url) {
+                        $supple_info_array = array_merge($supple_info_array, array($url));
+                    }
+
+                    break;
+                // Add suppleContentsEntry 2015/03/17 Y.Yamazawa --end--
                 default:
                     $this->Session->setParameter("error_msg", "Not Found this parameter. Param : ".$this->forXmlChangeDecode($vals[$row_cnt]['tag']));
                     $this->writeLog("Not Found this parameter. Param : ".$this->forXmlChangeDecode($vals[$row_cnt]['tag'])."\n");
@@ -518,7 +549,8 @@ class ImportCommon extends RepositoryAction
                                                 'edit_array' => $edit_array,
                                                 'feedback_mailaddress_array' => $feedback_mailaddress_array,
                                                 'cnri_array' => $cnri_array,
-                                                'selfdoi_array' => $selfdoi_array
+                                                'selfdoi_array' => $selfdoi_array,
+                                                'supple_info_array' => $supple_info_array // Add suppleContentsEntry Y.Yamazawa 2015/03/17 --Add--
                                         )
                         );
 
@@ -874,6 +906,12 @@ class ImportCommon extends RepositoryAction
                     return false;
                 }
             }
+            
+            // checkbox plural flag on
+            if($item_attr_type[$ii]['INPUT_TYPE'] == "checkbox"){
+                $item_attr_type[$ii]['PLURAL_ENABLE'] = 1;
+            }
+            
             $query = "INSERT INTO ". DATABASE_PREFIX ."repository_item_attr_type(" .
                     "item_type_id, " .
                     "attribute_id, " .
@@ -889,13 +927,14 @@ class ImportCommon extends RepositoryAction
                     "junii2_mapping, " .
                     "dublin_core_mapping, " .
                     "lom_mapping, " .// add "lom_mapping" 2013/01/29 A.Jin
+                    "lido_mapping, ".
                     "display_lang_type, " . // add "display_lang_type" 2009/07/23 A.Suzuki
                     "ins_user_id, " .
                     "mod_user_id, " .
                     "ins_date, " .
                     "mod_date, " .
                     "is_delete ) " .
-                    "VALUES( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? );";
+                    "VALUES( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? );";
             // バインド変数設定
             $param_item_attr_type = array();
             $param_item_attr_type[] = intval( $newID );
@@ -912,10 +951,17 @@ class ImportCommon extends RepositoryAction
             $param_item_attr_type[] = $item_attr_type[$ii]['JUNII2_MAPPING'];
             $param_item_attr_type[] = $item_attr_type[$ii]['DUBLIN_CORE_MAPPING'];
             $param_item_attr_type[] = $item_attr_type[$ii]['LOM_MAPPING'];
+            $param_item_attr_type[] = "";
             // add "display_lang_type" 2009/07/23 A.Suzuki --start--
             if($item_attr_type[$ii]['DISPLAY_LANG_TYPE']==null){
                 $item_attr_type[$ii]['DISPLAY_LANG_TYPE'] = "";
             }
+            else if ( strcasecmp($item_attr_type[$ii]['DISPLAY_LANG_TYPE'], "japanese") == 0 || strcasecmp($item_attr_type[$ii]['DISPLAY_LANG_TYPE'], "english") == 0  ) {
+                $item_attr_type[$ii]['DISPLAY_LANG_TYPE'] = mb_strtolower($item_attr_type[$ii]['DISPLAY_LANG_TYPE']);
+            }
+            else {
+                $item_attr_type[$ii]['DISPLAY_LANG_TYPE'] = "";
+            }
             $param_item_attr_type[] = $item_attr_type[$ii]['DISPLAY_LANG_TYPE'];
             // add "display_lang_type" 2009/07/23 A.Suzuki --end--
             $param_item_attr_type[] = $user_id; // ins_user_id
@@ -991,7 +1037,7 @@ class ImportCommon extends RepositoryAction
     /**
      * Insert or Update an item
      */
-    function itemEntry($array_item_data, $tmp_dir, &$array_item, $index_id, $item_type_info, $array_item_type_data, &$error_msg, &$item_id, &$detail_uri){
+    function itemEntry($array_item_data, $tmp_dir, &$array_item, $index_id, $item_type_info, $array_item_type_data, &$error_msg, &$item_id, &$detail_uri, &$warningMsg){
         $this->writeLog("-- Start itemEntry in ImportCommon class --\n");
 
         // get user_id
@@ -1025,7 +1071,7 @@ class ImportCommon extends RepositoryAction
             // Update 2013/09/09 R.Matsuura (Add argument "item_type_info")
             $result = $updateAction->executeUpdate(
                             $array_item_data, $array_item_type_data, $tmp_dir, $user_id,
-                            $item_id, $item_no, $array_item, $index_id, $item_type_info, $detail_uri, $error_msg);
+                            $item_id, $item_no, $array_item, $index_id, $item_type_info, $detail_uri, $error_msg, $warningMsg);
 
             return $result;
         }
@@ -1062,6 +1108,7 @@ class ImportCommon extends RepositoryAction
         $feedback_mailaddress_array = $array_item_data['feedback_mailaddress_array'];
         $cnri_array = $array_item_data['cnri_array'];
         $selfdoi_array = $array_item_data['selfdoi_array'];
+        $supple_info_array = $array_item_data['supple_info_array']; // Add supple info Y.Yamazawa 2015/03/17 --Add--
         $item_type_key_map = array();
         $item_key_map = array();
 
@@ -1352,7 +1399,8 @@ class ImportCommon extends RepositoryAction
 
             // input_type
             $inputType = $inputTypeList[$attrId];
-            $attrValue = str_replace("\\n", "\n", $item_attr_array[$cnt]["ATTRIBUTE_VALUE"]);
+            $attrValue = preg_replace("/([^\\\\](\\\\\\\\)*)\\\\n/", "$1\n", $item_attr_array[$cnt]["ATTRIBUTE_VALUE"]);
+            $attrValue = str_replace("\\\\", "\\", $attrValue);
 
             if($inputType == RepositoryConst::ITEM_ATTR_TYPE_CHECKBOX ||
                $inputType == RepositoryConst::ITEM_ATTR_TYPE_SELECT ||
@@ -2075,7 +2123,20 @@ class ImportCommon extends RepositoryAction
             if(file_exists($file_path)){
                 unlink($file_path);
             }
-            copy($path, $file_path);
+            
+	        // file upload check 2015/04/02 K.Sugimoto --start--
+	        $result = copy($path, $file_path);
+	        if(!$result || !(file_exists($file_path))){
+		        $smarty_assign = $this->Session->getParameter("smartyAssign");
+		        if(!isset($smarty_assign))
+		        {
+			        $this->setLangResource();
+			        $smarty_assign = $this->Session->getParameter("smartyAssign");
+		        }
+		        $error_msg = sprintf($smarty_assign->getLang("repository_file_upload_failed"), $file_array[$cnt]['FILE_NAME']);
+		        return false;
+	        }
+	        // file upload check 2015/04/02 K.Sugimoto --end--
             // Add separate file from DB 2009/04/21 Y.Nakao --end--
 
             // display_type
@@ -2139,7 +2200,7 @@ class ImportCommon extends RepositoryAction
             $param_file[] = $filePubDate;
             $param_file[] = $flashPubDate;
             $param_file[] = $item_type_id;
-            $param_file[] = ""; // prev_id
+            $param_file[] = 0; // prev_id
             $param_file[] = ""; // file_prev(BLOB)
             if($prev_flg == "true"){
                 // PDFの場合、プレビュー用の名前を事前登録する。
@@ -2588,22 +2649,23 @@ class ImportCommon extends RepositoryAction
         //////////////////////////////////// Insert selfDOI //////////////////////////////////
         if(isset($selfdoi_array[0]['RA']) && strlen($selfdoi_array[0]['RA']) > 0)
         {
+            $selfdoi_array[0]['RA'] = strtoupper($selfdoi_array[0]['RA']);
             $checkdoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
             $handleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
-            if($selfdoi_array[0]['RA'] === RepositoryConst::JUNII2_SELFDOI_RA_JALC)
+            if($selfdoi_array[0]['RA'] === strtoupper(RepositoryConst::JUNII2_SELFDOI_RA_JALC))
             {
                 $selfdoiPrefixSuffix = explode("/", $selfdoi_array[0]['SELFDOI']);
                 $libraryJalcdoiPrefix = $handleManager->getLibraryJalcDoiPrefix();
                 if($selfdoiPrefixSuffix[0] === $libraryJalcdoiPrefix)
                 {
-                    $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, 2, 0);
+                    $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_LIBRARY_JALC_DOI, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                     if($checkRegist)
                     {
                         $handleManager->registLibraryJalcdoiSuffix($item_id, $item_no, $selfdoi_array[0]['SELFDOI']);
                     }
                     else
                     {
-                        $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, 0, 0);
+                        $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_JALC_DOI, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                         if($checkRegist)
                         {
                             $suffix = $handleManager->getYHandleSuffix($item_id, $item_no);
@@ -2613,7 +2675,7 @@ class ImportCommon extends RepositoryAction
                 }
                 else
                 {
-                    $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, 0, 0);
+                    $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_JALC_DOI, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                     if($checkRegist)
                     {
                         $suffix = $handleManager->getYHandleSuffix($item_id, $item_no);
@@ -2621,18 +2683,35 @@ class ImportCommon extends RepositoryAction
                     }
                 }
             }
-            else if($selfdoi_array[0]['RA'] === RepositoryConst::JUNII2_SELFDOI_RA_CROSSREF)
+            else if($selfdoi_array[0]['RA'] === strtoupper(RepositoryConst::JUNII2_SELFDOI_RA_CROSSREF))
             {
             
-                $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, 1, 0);
+                $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_CROSS_REF, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                 if($checkRegist)
                 {
                     $suffix = $handleManager->getYHandleSuffix($item_id, $item_no);
                     $handleManager->registCrossrefSuffix($item_id, $item_no, $suffix);
                 }
             }
+        	// Add DataCite 2015/02/09 K.Sugimoto --start--
+            else if($selfdoi_array[0]['RA'] === strtoupper(RepositoryConst::JUNII2_SELFDOI_RA_DATACITE))
+            {
+            
+                $checkRegist = $checkdoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_DATACITE, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
+                if($checkRegist)
+                {
+                    $suffix = $handleManager->getYHandleSuffix($item_id, $item_no);
+                    $handleManager->registDataciteSuffix($item_id, $item_no, $suffix);
+                }
+            }
+        	// Add DataCite 2015/02/09 K.Sugimoto --end--
         }
 
+        // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/17 --start--
+        //////////////////////////////////// Insert suppleContents //////////////////////////////////
+        $this->entrySupple($item_id,$item_no,$supple_info_array,$error_msg);
+        // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/17 --end--
+
         // Reissue attribute_no
         if(!$this->reissueAttrNo(intval($item_id), intval($item_array[0]['ITEM_NO']), $error_msg))
         {
@@ -2696,9 +2775,11 @@ class ImportCommon extends RepositoryAction
         // ------------------------------------------------------------------
         // add item insert log
         // ------------------------------------------------------------------
-        // Add log common action Y.Nakao 2010/03/05 --start--
-        $this->entryLog(1, intval($item_id), intval($item_array[0]['ITEM_NO']), "", "", "");
-        // Add log common action Y.Nakao 2010/03/05 --end--
+        // Mod entryLog T.Koyasu 2015/03/06 --start--
+        $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+        $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+        $logManager->entryLogForRegistItem($item_id, intval($item_array[0]['ITEM_NO']));
+        // Mod entryLog T.Koyasu 2015/03/06 --end--
 
         // Update review status
         $array_item[count($array_item)-1]["status"] = "success";
@@ -4268,6 +4349,23 @@ class ImportCommon extends RepositoryAction
         }
     }
     
+    /**
+     * create ItemtypeManager instance
+     *
+     */
+    private function getItemtypeManager()
+    {
+        if(!isset($this->itemtypeManager))
+        {
+            if(!isset($this->TransStartDate) || strlen($this->TransStartDate) == 0)
+            {
+                $DATE = new Date();
+                $this->TransStartDate = $DATE->getDate(). ".000";
+            }
+            $this->itemtypeManager = new Repository_Components_Itemtypemanager($this->Session, $this->Db, $this->TransStartDate);
+        }
+    }
+    
     // Bug Fix WEKO-2014-046 T.Koyasu 2014/08/07 --start--
     /**
      * correct attribute_id of item_type data array
@@ -4277,6 +4375,17 @@ class ImportCommon extends RepositoryAction
      */
     public function validateItemTypeXmlData($itemTypeId, &$xmlItemTypeData)
     {
+        // 表示順データの整合チェック（データ変更を走らせないために最初に行う）
+        foreach($xmlItemTypeData['item_attr_type_array'] as $elm => $valArray) {
+            if(!isset($valArray['SHOW_ORDER'])) {
+                // 表示順が設定されていない場合
+                return;
+            } else if($this->getAttrIdByShowOrderAndItemTypeId($valArray['SHOW_ORDER'], $itemTypeId) == 0) {
+                // アイテムタイプIDと表示順で照合して一致するものが無い場合
+                return;
+            }
+        }
+        
         // 修正用のデータ配列(逐次処理で修正していくと修正済みと修正前の見分けがつかないため)
         $candidateArray = array();
         
@@ -4324,19 +4433,102 @@ class ImportCommon extends RepositoryAction
      */
     private function getAttrIdByShowOrderAndItemTypeId($showOrder, $itemTypeId)
     {
+        $attrId = 0;
+        
         $query = "SELECT attribute_id ". 
                  " FROM ". DATABASE_PREFIX. "repository_item_attr_type ". 
                  " WHERE item_type_id = ? ". 
-                 " AND show_order = ?;";
+                 " AND show_order = ? ".
+                 " AND is_delete = ? ;";
         
         $params = array();
         $params[] = $itemTypeId;
         $params[] = $showOrder;
+        $params[] = 0;
         
         $result = $this->dbAccess->executeQuery($query, $params);
+        if(count($result) > 0) {
+            $attrId = $result[0]["attribute_id"];
+        }
         
-        return $result[0]["attribute_id"];
+        return $attrId;
     }
     // Bug Fix WEKO-2014-046 T.Koyasu 2014/08/07 --end--
+    
+    /**
+     * check usage itemtype
+     *
+     * @param int $item_type_id_list
+     * @param int $user_role_id
+     * @param int $user_room_auth_id
+     * @return bool
+     */
+    function canUseItemtype($item_type_id_list, $user_role_id, $user_room_auth_id)
+    {
+        if(!isset($this->itemtypeManager)) {
+            $this->getItemtypeManager();
+        }
+        
+        // 現在のユーザーの権限で使用可能なアイテムタイプの一覧を取得する
+        $result = $this->itemtypeManager->getItemtypeDataByUserAuth($user_role_id, $user_room_auth_id);
+        // 引数のアイテムタイプが使用できるアイテムタイプに含まれているかチェックする
+        $check_result = array();
+        for($ii = 0; $ii < count($item_type_id_list); $ii++) {
+            $use_flag = false;
+            for($jj = 0; $jj < count($result); $jj++) {
+                if($item_type_id_list[$ii] == $result[$jj]["item_type_id"]) {
+                    $use_flag = true;
+                    break;
+                }
+            }
+            $check_result[] = $use_flag;
+        }
+        
+        return $check_result;
+    }
+
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/17 --start--
+    /**
+     * サプリコンテンツ登録
+     * 1.サプリコンテンツURLが空か確認
+     * 2.ビジネスクラスの呼び出し
+     * 3.サプリコンテンツの登録
+     *
+     * @param string $item_id アイテムID
+     * @param string $item_no アイテムNo
+     * @param array $supple_info_array サプリコンテンツURL
+     * @param string $error_msg エラーメッセージ
+     * @return boolean 登録結果
+     */
+    private function entrySupple($item_id,$item_no,$supple_info_array,&$error_msg)
+    {
+        $this->traceLog(__FUNCTION__, __FILE__, __CLASS__, __LINE__);
+        $this->traceLog(print_r($supple_info_array, true), __FILE__, __CLASS__, __LINE__);
+        // サプリコンテンツURLが空か確認
+        if(!isset($supple_info_array[0]) || !(strlen($supple_info_array[0]) > 0))
+        {
+            return false;
+        }
+
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+
+        // サプリコンテンツの登録
+        try{
+            $this->infoLog("businessSupple", __FILE__, __CLASS__, __LINE__);
+            $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
+            $businessSupple->entrySuppleContentsForImport($item_id,$item_no,$supple_info_array);
+        }
+        catch (AppException $e){
+            $code = $e->getMessage();
+            $msg = $smartyAssign->getLang($code);
+            $this->errorLog($msg, __FILE__, __CLASS__, __LINE__);
+            // 複数のサプリでエラーが発生する場合があるため一つの警告メッセージとしてまとめる
+            $error_msg = $msg;
+            return false;
+        }
+        $this->infoLog("businessSupple", __FILE__, __CLASS__, __LINE__);
+        return true;
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/17 --end--
 }
 ?>
diff --git a/repository/action/edit/import/confirm/Confirm.class.php b/repository/action/edit/import/confirm/Confirm.class.php
index 09246c7..6beadfc 100644
--- a/repository/action/edit/import/confirm/Confirm.class.php
+++ b/repository/action/edit/import/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 651 2014-11-13 10:14:11Z ivis $
+// $Id: Confirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -16,6 +16,8 @@
 include_once MAPLE_DIR.'/includes/pear/File/Archive.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/action/edit/import/ImportCommon.class.php';;
+require_once WEBAPP_DIR. '/modules/repository/components/util/ZipUtility.class.php';
+
 
 /**
  * [[import終了時、確認画面表示用action]]
@@ -198,6 +200,50 @@ class Repository_Action_Edit_Import_Confirm extends RepositoryAction
                 $this->failTrans();
                 throw $exception;
             }
+            // check itemtype authority
+            // 権限IDを取得する
+            $query = "SELECT role_authority_id ".
+                     "FROM ".DATABASE_PREFIX. "users ".
+                     "WHERE user_id = ? ;";
+            $params = array();
+            $params[] = $this->Session->getParameter("_user_id");
+            $role_auth = $this->Db->execute($query, $params);
+            // ルーム権限を取得する
+            $room_auth = $this->getRoomAuthorityID($this->Session->getParameter("_user_id"));
+            // アイテムタイプIDリストを作成する
+            $item_type_id_list = array();
+            for($ii = 0; $ii < count($item_type_info); $ii++) {
+                $item_type_id_list[] = $item_type_info[$ii]["item_type_id"];
+            }
+            $result = $import_common->canUseItemtype($item_type_id_list, $role_auth[0]["role_authority_id"], $room_auth);
+            // アイテムタイプ使用チェック結果を確認する
+            $error_info = array();
+            $error_cnt = 0;
+            for($ii = 0; $ii < count($result); $ii++) {
+                if($result[$ii] == false) {
+                    $error_info[$error_cnt] = array();
+                    $error_info[$error_cnt]["error"] = "User do not have permission to use itemtype";
+                    if($this->Session->getParameter("_lang") == "english" && strlen($array_item_data["item"][$ii]["item_array"][0]["TITLE_ENGLISH"]) > 0) {
+                        $error_info[$error_cnt]["title"] = $array_item_data["item"][$ii]["item_array"][0]["TITLE_ENGLISH"]; 
+                    } else {
+                        $error_info[$error_cnt]["title"] = $array_item_data["item"][$ii]["item_array"][0]["TITLE"]; 
+                    }
+                    $error_info[$error_cnt]["item_id"] = $array_item_data["item"][$ii]["item_array"][0]["ITEM_ID"];
+                    $error_info[$error_cnt]["attr_name"] = "";
+                    $error_info[$error_cnt]["input_value"] = $item_type_info[$ii]["item_type_name"];
+                    $error_info[$error_cnt]["regist_value"] = "";
+                    $error_info[$error_cnt]["error_no"] = 20;
+                    $error_cnt++;
+                }
+            }
+            if(count($error_info) > 0) {
+                $this->Session->setParameter("error_info", $error_info);
+                // error action
+                $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );
+                // ROLLBACK
+                $this->failTrans();
+                throw $exception;
+            }
             
             ////////////////////////////////////////
             // insert item
@@ -206,15 +252,21 @@ class Repository_Action_Edit_Import_Confirm extends RepositoryAction
             $array_item = array();
             for($nCnt=0;$nCnt<count($array_item_data['item']);$nCnt++){
                 $error_msg = "";
+                $warningMsg = "";
                 // insert 1 item
-                $ret = $import_common->itemEntry($array_item_data['item'][$nCnt], $tmp_dir, $array_item, $this->index_id, $item_type_info[$nCnt], $array_item_data['item_type'][$nCnt], $error_msg, $item_id, $detail_uri);
+                $ret = $import_common->itemEntry($array_item_data['item'][$nCnt], $tmp_dir, $array_item, $this->index_id, $item_type_info[$nCnt], $array_item_data['item_type'][$nCnt], $error_msg, $item_id, $detail_uri, $warningMsg);
                 if($ret === false){
                     $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );
+                    $this->Session->setParameter("error_msg", $error_msg);
                     // ROLLBACK
                     $this->failTrans();
                     throw $exception;
                 }
-                $array_item[$nCnt]["error_msg"] = $error_msg;
+                if(strlen($warningMsg) > 0){
+                    $array_item[$nCnt]["error_msg"] = $warningMsg;
+                } else {
+                    $array_item[$nCnt]["error_msg"] = $error_msg;
+                }
                 
                 // Add review mail setting 2009/09/30 Y.Nakao --start--
                 // 査読対象のコンテンツ情報をメール本文に記載する
@@ -356,11 +408,12 @@ class Repository_Action_Edit_Import_Confirm extends RepositoryAction
     /*
      * zip file extract
      */
-    function extraction(){
+    private function extraction(){
 
         // get upload file
         $tmp_file = $this->Session->getParameter("filelist");
-
+        $this->Session->removeParameter("filelist");
+        
         //$dir_path = WEBAPP_DIR. "\\uploads\\repository\\";
         $dir_path = WEBAPP_DIR. "/uploads/repository/";
         $file_path = $dir_path . $tmp_file[0]['physical_file_name'];
@@ -379,12 +432,14 @@ class Repository_Action_Edit_Import_Confirm extends RepositoryAction
             throw $exception;
         }
 
+        // Update SuppleContentsEntry Y.Yamazawa 2015/04/02 --satrt--
         // extract zip file
-        File_Archive::extract(
-        File_Archive::read($file_path . "/"),
-        File_Archive::appender($dir)
-        );
-        
+        $result = Repository_Components_Util_ZipUtility::extract($file_path, $dir);
+        if($result === false){
+            return false;
+        }
+        // Update SuppleContentsEntry Y.Yamazawa 2015/04/02 --end--
+
         // delete upload xip file
         unlink($file_path);
         
diff --git a/repository/action/edit/import/confirm/maple.ini b/repository/action/edit/import/confirm/maple.ini
index e9266f0..a37f8a5 100644
--- a/repository/action/edit/import/confirm/maple.ini
+++ b/repository/action/edit/import/confirm/maple.ini
@@ -1,9 +1,6 @@
 ;[Convert]
 ;*.trim =
 
-[DIContainer]
-filename = "dicon.ini"
-
 [ValidateDef]
 index_id
 
diff --git a/repository/action/edit/import/upload/Upload.class.php b/repository/action/edit/import/upload/Upload.class.php
index 1458cbf..7265215 100644
--- a/repository/action/edit/import/upload/Upload.class.php
+++ b/repository/action/edit/import/upload/Upload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Upload.class.php 270 2009-01-21 04:50:41Z ivis $
+// $Id: Upload.class.php 3 2010-02-02 05:07:44Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/importauthority/Importauthority.class.php b/repository/action/edit/importauthority/Importauthority.class.php
index 43265f1..98d974d 100644
--- a/repository/action/edit/importauthority/Importauthority.class.php
+++ b/repository/action/edit/importauthority/Importauthority.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Importauthority.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Importauthority.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -26,7 +26,7 @@ class Repository_Action_Edit_Importauthority extends RepositoryAction
     public $Db = null;
     
     // menber
-    private $errMsg = null;
+    private $error_msg = null;
     private $lineNum = 0;
     
     // Const
@@ -51,7 +51,7 @@ class Repository_Action_Edit_Importauthority extends RepositoryAction
         }
     }
     
-    function executeForWeko()
+    function executeApp()
     {
         // get import.tsv file
         $this->lineNum = 0;
@@ -60,7 +60,7 @@ class Repository_Action_Edit_Importauthority extends RepositoryAction
         $fileData = $this->readFile($tmpFile);
         if($fileData === false)
         {
-            $this->errMsg = "error file read";
+            $this->error_msg = "error file read";
         }
         $this->lineNum = count($fileData);
         
@@ -86,12 +86,12 @@ class Repository_Action_Edit_Importauthority extends RepositoryAction
                 {
                     continue;
                 }
-                $nameAuthority->entryNameAuthority($metadataForNameAuthority[$nCnt], $this->errMsg);
+                $nameAuthority->entryNameAuthority($metadataForNameAuthority[$nCnt], $this->error_msg);
             }
         }
         
-        if(strlen($this->errMsg) > 0) {
-            echo $this->errMsg;
+        if(strlen($this->error_msg) > 0) {
+            echo $this->error_msg;
         }
         else
         {
diff --git a/repository/action/edit/importauthority/confirm/Confirm.class.php b/repository/action/edit/importauthority/confirm/Confirm.class.php
index d8a9e86..d5b5244 100644
--- a/repository/action/edit/importauthority/confirm/Confirm.class.php
+++ b/repository/action/edit/importauthority/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Confirm.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -31,7 +31,7 @@ class Repository_Action_Edit_Importauthority_Confirm extends RepositoryAction
      * 
      * @access  public
      */
-    function executeForWeko()
+    function executeApp()
     {
         // error msg remove
         $this->Session->removeParameter("error_msg");
diff --git a/repository/action/edit/importauthority/download/Download.class.php b/repository/action/edit/importauthority/download/Download.class.php
index b48b19a..d956d30 100644
--- a/repository/action/edit/importauthority/download/Download.class.php
+++ b/repository/action/edit/importauthority/download/Download.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Download.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Download.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -33,7 +33,7 @@ class Repository_Action_Edit_Importauthority_Download extends RepositoryAction
      *
      * @access  public
      */
-    function executeForWeko()
+    function executeApp()
     {
         // 作業用ディレクトリ作成
         $query = "SELECT DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS now_date;";
diff --git a/repository/action/edit/importauthority/upload/Upload.class.php b/repository/action/edit/importauthority/upload/Upload.class.php
index 12d7803..1fda189 100644
--- a/repository/action/edit/importauthority/upload/Upload.class.php
+++ b/repository/action/edit/importauthority/upload/Upload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Upload.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Upload.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,6 +13,7 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 //require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 
 /**
  * [[機能説明]]
@@ -21,7 +22,7 @@
  * @access      public
  */
 //class Repository_Action_Edit_Importauthority_Upload extends RepositoryAction
-class Repository_Action_Edit_Importauthority_Upload
+class Repository_Action_Edit_Importauthority_Upload extends WekoAction
 {
 
     public $Session = null;
@@ -32,7 +33,7 @@ class Repository_Action_Edit_Importauthority_Upload
      *
      * @access  public
      */
-    public function execute()
+    public function executeApp()
     {
         // ガーベージフラグが"1"の場合、いつかファイル・DB共にクリアしてくれる。
         // ただし、詳細なタイミングは不明。
diff --git a/repository/action/edit/importauthority/upload/maple.ini b/repository/action/edit/importauthority/upload/maple.ini
index 5986857..0c4a8b0 100644
--- a/repository/action/edit/importauthority/upload/maple.ini
+++ b/repository/action/edit/importauthority/upload/maple.ini
@@ -4,9 +4,6 @@
 [RequestCheck]
 request = POST
 
-[DIContainer]
-filename = dicon.ini
-
 [FileUpload]
 name = upload
 maxsize = ""
diff --git a/repository/action/edit/item/doi/Doi.class.php b/repository/action/edit/item/doi/Doi.class.php
index b6bb03b..93dc766 100644
--- a/repository/action/edit/item/doi/Doi.class.php
+++ b/repository/action/edit/item/doi/Doi.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Doi.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Doi.class.php 49641 2015-03-09 07:02:34Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,8 @@
 // --------------------------------------------------------------------
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
 
 /**
  * [[アイテム管理actionアクション]]
@@ -30,6 +32,9 @@ class Repository_Action_Edit_Item_Doi extends RepositoryAction
     // JaLC DOi付与アイテムリスト
     public $registing_jalcdoi_items = null;
     public $registing_crossref_items = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --start--
+    public $registing_datacite_items = null;
+    // Add DataCite 2015/02/09 K.Sugimoto --end--
     
     const JALC_DOI_MANAGEMENT_TAB_NUMBER = 3;
     
@@ -38,7 +43,7 @@ class Repository_Action_Edit_Item_Doi extends RepositoryAction
      *
      * @access  public
      */
-    public function executeForWeko()
+    public function executeApp()
     {
         // 選択タブの保存
         $this->Session->setParameter("item_setting_active_tab", self::JALC_DOI_MANAGEMENT_TAB_NUMBER);
@@ -55,6 +60,8 @@ class Repository_Action_Edit_Item_Doi extends RepositoryAction
         $this->Session->setParameter("targetIndexId", $this->targetIndexId);
         $this->Session->setParameter("searchIndexId", $this->targetIndexId);
         
+        $doi_count = 0;
+        
         if(count($this->registing_jalcdoi_items) > 0)
         {
             $item_no = 1;
@@ -66,6 +73,7 @@ class Repository_Action_Edit_Item_Doi extends RepositoryAction
                 $repositoryHandleManager->registJalcdoiSuffix($item_id, $item_no, $suffix);
                 $repositorySearchTableProcessing->updateSelfDoiSearchTable($item_id, $item_no);
                 $this->updateModDate($item_id, $item_no);
+                $doi_count++;
             }
         }
         if(count($this->registing_crossref_items) > 0)
@@ -79,9 +87,28 @@ class Repository_Action_Edit_Item_Doi extends RepositoryAction
                 $repositoryHandleManager->registCrossrefSuffix($item_id, $item_no, $suffix);
                 $repositorySearchTableProcessing->updateSelfDoiSearchTable($item_id, $item_no);
                 $this->updateModDate($item_id, $item_no);
+                $doi_count++;
+            }
+        }
+        // Add DataCite 2015/02/09 K.Sugimoto --start--
+        if(count($this->registing_datacite_items) > 0)
+        {
+            $item_no = 1;
+            $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->dbAccess, $this->TransStartDate);
+            $repositorySearchTableProcessing = new RepositorySearchTableProcessing($this->Session, $this->Db);
+            foreach($this->registing_datacite_items as $item_id)
+            {
+                $suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
+                $repositoryHandleManager->registDataciteSuffix($item_id, $item_no, $suffix);
+                $repositorySearchTableProcessing->updateSelfDoiSearchTable($item_id, $item_no);
+                $this->updateModDate($item_id, $item_no);
+                $doi_count++;
             }
         }
         
+        $this->Session->setParameter("doi_count", $doi_count);
+        // Add DataCite 2015/02/09 K.Sugimoto --end--
+        
         // エラーメッセージ開放
         $this->Session->removeParameter("error_msg");
         return 'success';
diff --git a/repository/action/edit/item/embargo/Embargo.class.php b/repository/action/edit/item/embargo/Embargo.class.php
index 3bd8c87..0a0ef40 100644
--- a/repository/action/edit/item/embargo/Embargo.class.php
+++ b/repository/action/edit/item/embargo/Embargo.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Embargo.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: Embargo.class.php 40574 2014-08-28 00:24:04Z tatsuya_koyasu $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/adddb/Adddb.class.php b/repository/action/edit/itemtype/adddb/Adddb.class.php
index 6bca2f0..203322f 100644
--- a/repository/action/edit/itemtype/adddb/Adddb.class.php
+++ b/repository/action/edit/itemtype/adddb/Adddb.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Adddb.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Adddb.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -27,10 +27,6 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTablePr
  */
 class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 {
-	// 使用コンポーネントを受け取るため
-	//var $session = null;
-	//var $db = null;
-	
 	// リクエストパラメタ
 	var $metadata_title = null;		// メタデータ項目名配列
 	var $metadata_type = null;		// メタデータタイプ配列
@@ -94,45 +90,6 @@ class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 		    	// アイテムタイプIDを決める
 		    	//
 		    	$item_type_id = $this->Db->nextSeq("repository_item_type");
-		    	/*
-		    	while(1) {
-		    		/* 2008/03/06 クエリー変更
-					$count = $this->db->countExecute(
-						"repository_item_type",array("item_type_id" => $item_type_id)
-					);
-					if($count === false){
-						return 'error';
-					}
-		    	    if ($count == 0) {
-						break;
-		    		}
-					
-		    		$query = "SELECT * ".
-                     		 "FROM ". DATABASE_PREFIX ."repository_item_type ".
-                     		 "WHERE item_type_id = ?; ";
-		    		$params = null;
-		            $params[] = $item_type_id;
-            		//SELECT実行
-            		$result = $this->Db->execute($query, $params);
-            		if($result === false){
-		                //必要であればSQLエラー番号・メッセージ取得
-		                $errNo = $this->Db->ErrorNo();
-		                $errMsg = $this->Db->ErrorMsg();
-		                //エラー処理を行う
-		                //$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-		                //$DetailMsg = null;                              //詳細メッセージ文字列作成
-		                //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-		                //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-		                $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-		                //throw $exception;
-		                return 'error';
-            		}
-            		if(!(isset($result[0]))){
-            			break;
-            		}
-		    		$item_type_id++;
-		    	}
-		    	*/
 			    $query = "INSERT INTO ". DATABASE_PREFIX ."repository_item_type ".
 			    		 "(item_type_id, item_type_name, item_type_short_name, ".
 			    		 "explanation, mapping_info, icon_name , icon_mime_type, icon_extension, icon, ".
@@ -270,9 +227,9 @@ class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 			    			 "(item_type_id, attribute_id, show_order, ".
 			    			 " attribute_name, attribute_short_name, input_type, is_required, ".
 			    			 " plural_enable, line_feed_enable, list_view_enable, hidden, ".
-			    			 " junii2_mapping, dublin_core_mapping, lom_mapping, display_lang_type, ins_user_id, mod_user_id, ".
+			    			 " junii2_mapping, dublin_core_mapping, lom_mapping, lido_mapping, display_lang_type, ins_user_id, mod_user_id, ".
 			    			 " del_user_id, ins_date, mod_date, del_date, is_delete) ".
-	                		 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
+	                		 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
 					$params = null;
 		            $params[] = $item_type_id;				// item_type_id
 		            $params[] = $ii+1;						// attribute_id
@@ -280,14 +237,15 @@ class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 		            $params[] = $this->metadata_title[$ii];	// attribute_name
 		            $params[] = $this->metadata_title[$ii];	// attribute_short_name
 		            $params[] = $this->metadata_type[$ii];	// input_type
-		            $params[] = $this->metadata_required[$ii];	// is_required
-		            $params[] = $this->metadata_plural[$ii];	// plural_enable
-		            $params[] = $this->metadata_newline[$ii];	// line_feed_enable
-		            $params[] = $this->metadata_disp[$ii];		// list_view_enable
-		            $params[] = $this->metadata_hidden[$ii];	// hidden
+		            $params[] = (int)$this->metadata_required[$ii];	// is_required
+		            $params[] = (int)$this->metadata_plural[$ii];	// plural_enable
+		            $params[] = (int)$this->metadata_newline[$ii];	// line_feed_enable
+		            $params[] = (int)$this->metadata_disp[$ii];		// list_view_enable
+		            $params[] = (int)$this->metadata_hidden[$ii];	// hidden
 		            $params[] = "";								// junii2_mapping
 		            $params[] = "";								// dublin_core_mapping
 		            $params[] = "";                             // lom_mapping
+		            $params[] = "";                             // lido_mapping
 		            $params[] = "";								// display_lang_type
 		            $params[] = $user_id;						// ins_user_id
 		            $params[] = $user_id;						// mod_user_id
@@ -579,14 +537,14 @@ class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 								 "attribute_id = ?; ";
 						$params = null;
 						$params[] = $this->metadata_type[$nCnt];		// input_type
-						$params[] = $this->metadata_required[$nCnt];	// is_required
-						$params[] = $this->metadata_disp[$nCnt];		//　list_view_enable
+						$params[] = (int)$this->metadata_required[$nCnt];	// is_required
+						$params[] = (int)$this->metadata_disp[$nCnt];		//　list_view_enable
 						$params[] = $this->metadata_title[$nCnt];		// attribute_name
 						$params[] = $this->metadata_title[$nCnt];		// attribute_short_name
 						$params[] = $count;								// show_order
-						$params[] = $this->metadata_newline[$nCnt];		// line_feed_enable
-						$params[] = $this->metadata_plural[$nCnt];		// plural_enable
-						$params[] = $this->metadata_hidden[$nCnt];		// hidden
+						$params[] = (int)$this->metadata_newline[$nCnt];		// line_feed_enable
+						$params[] = (int)$this->metadata_plural[$nCnt];		// plural_enable
+						$params[] = (int)$this->metadata_hidden[$nCnt];		// hidden
 						$params[] = $user_id;							// mod_user_id
 						$params[] = $this->TransStartDate;				// mod_date
 						$params[] = 0;									// is_delete
@@ -776,10 +734,10 @@ class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 			    			 " attribute_name, attribute_short_name, ". 
 			    			 " input_type, is_required, ".
 			    			 " plural_enable, line_feed_enable, list_view_enable, hidden, ".
-			   				 " junii2_mapping, dublin_core_mapping, lom_mapping,".
+			   				 " junii2_mapping, dublin_core_mapping, lom_mapping, lido_mapping, display_lang_type, ".
 			   				 " ins_user_id, mod_user_id, del_user_id, ".
 			   				 " ins_date, mod_date, del_date, is_delete) ".
-	                		 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
+	                		 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
 			   			$params = null;
 			            $params[] = $item_type_id;					// item_type_id
 			            $params[] = $attr_id;						// attribute_id
@@ -787,14 +745,16 @@ class Repository_Action_Edit_Itemtype_Adddb extends RepositoryAction
 			            $params[] = $this->metadata_title[$nCnt];	// attribute_name
 			            $params[] = $this->metadata_title[$nCnt];	// attribute_short_name
 			            $params[] = $this->metadata_type[$nCnt];	// input_type
-			            $params[] = $this->metadata_required[$nCnt];// is_required
-			            $params[] = $this->metadata_plural[$nCnt];	// plural_enable
+			            $params[] = (int)$this->metadata_required[$nCnt];// is_required
+			            $params[] = (int)$this->metadata_plural[$nCnt];	// plural_enable
 			            $params[] = 0;								// line_feed_enable
-			            $params[] = $this->metadata_disp[$nCnt];	// list_view_enable
-			            $params[] = $this->metadata_hidden[$nCnt];	// hidden
+			            $params[] = (int)$this->metadata_disp[$nCnt];	// list_view_enable
+			            $params[] = (int)$this->metadata_hidden[$nCnt];	// hidden
 			            $params[] = "";								// junii2_mapping
 			            $params[] = "";								// dublin_core_mapping
 			            $params[] = "";                             // lom_mapping
+			            $params[] = "";                             // lido_mapping
+    		            $params[] = "";								// display_lang_type
 			            $params[] = $user_id;						// ins_user_id
 			            $params[] = $user_id;						// mod_user_id
 			            // user_idのString対応 2008/06/03 Y.Nakao --Start--
diff --git a/repository/action/edit/itemtype/adddb/maple.ini b/repository/action/edit/itemtype/adddb/maple.ini
index 908dfe0..6241f9d 100644
--- a/repository/action/edit/itemtype/adddb/maple.ini
+++ b/repository/action/edit/itemtype/adddb/maple.ini
@@ -2,8 +2,6 @@
 ;*.trim =
 
 [Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
 Session = "ref:Session"
 Db = "ref:DbObject"
 
diff --git a/repository/action/edit/itemtype/addmetadata/Addmetadata.class.php b/repository/action/edit/itemtype/addmetadata/Addmetadata.class.php
index a6c825f..81d216d 100644
--- a/repository/action/edit/itemtype/addmetadata/Addmetadata.class.php
+++ b/repository/action/edit/itemtype/addmetadata/Addmetadata.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Addmetadata.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Addmetadata.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,7 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * repositoryモジュール アイテムタイプ作成 編集画面でメタデータ追加時に呼ばれるアクション
@@ -23,12 +24,10 @@
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Edit_Itemtype_Addmetadata
+class Repository_Action_Edit_Itemtype_Addmetadata extends RepositoryAction
 {
 	// 使用コンポーネントを受け取るため
-	var $session = null;
 	var $request = null;
-	//var $itemtype_name = null;		//前画面で入力したアイテムタイプ名(新規作成時)
 	
 	// リクエストパラメタ
 	var $metadata_title = null;		// メタデータ項目名配列
@@ -48,24 +47,8 @@ class Repository_Action_Edit_Itemtype_Addmetadata
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
-    	// 現在のメタデータ設定値をセッションに保存
-//    	for($ii=0; $ii<1; $ii++) {
-//    		// ピクリとも反応せず。nullでなくて0文字が戻る？紛らわしい。
-//    		$tmpstr = sprintf("metadeta_title[%d]", $ii);
-//    		$tmptitle = null;
-//    		$tmptitle = $this->request->getParameter($tmpstr);
-//    		if( $tmptitle != null ) {
-//				$this->session->setParameter($tmpstr, $tmptitle);
-//    		}
-//    	}
-    
-    	// 1個ずつだがうまくいった例
-//	    for($ii=0; $ii<count($this->metadata_title); $ii++) {
-//	    	$this->session->setParameter(sprintf("metadata_title%d",$ii), $this->metadata_title[$ii]);
-//	   	}
-	   	
 	    ////////////////////////// " "をnull文字列に ///////////////////////////
     	$array_title = array();	// 項目名一時保管用 
     	$array_candidate = array();	// 選択肢一時保管用		
@@ -92,21 +75,16 @@ class Repository_Action_Edit_Itemtype_Addmetadata
     		}
     	}
     	
-    	// Add metadata name edit 2008/09/04 Y.Nakao --start--
     	// Save item type name
-    	// Mod metadata name edit 2009/12/10 K.Ando --start--
-    	//$this->session->setParameter("itemtype_name", $this->item_type_name);
-    	$this->session->setParameter("item_type_name", $this->item_type_name);
-    	// Mod metadata name edit 2009/12/10 K.Ando --end--
-    	// Add metadata name edit 2008/09/04 Y.Nakao --end--
+    	$this->Session->setParameter("item_type_name", $this->item_type_name);
     	
         // metadata_titleをまとめて配列でセッションに保存
-        $this->session->setParameter("metadata_title", $array_title);
+        $this->Session->setParameter("metadata_title", $array_title);
 	   	// metadata_typeをまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_type", $this->metadata_type);
+	   	$this->Session->setParameter("metadata_type", $this->metadata_type);
 
 	   	// 2008/02/28 選択肢をまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_candidate", $array_candidate);
+	   	$this->Session->setParameter("metadata_candidate", $array_candidate);
 
 	   	//チェックボックスはチェックの入ったnameのvalueのみが送信されるため、データを調整
 	   	// フラグもまとめてセッションに保存
@@ -153,38 +131,38 @@ class Repository_Action_Edit_Itemtype_Addmetadata
         		}
         	}
 	   	}
-	   	$this->session->setParameter("metadata_required", $array_req);
-	   	$this->session->setParameter("metadata_disp", $array_dis);
-	   	$this->session->setParameter("metadata_plural", $array_plu);
-	   	$this->session->setParameter("metadata_newline", $array_newline);
-	   	$this->session->setParameter("metadata_hidden", $array_hidden);
+	   	$this->Session->setParameter("metadata_required", $array_req);
+	   	$this->Session->setParameter("metadata_disp", $array_dis);
+	   	$this->Session->setParameter("metadata_plural", $array_plu);
+	   	$this->Session->setParameter("metadata_newline", $array_newline);
+	   	$this->Session->setParameter("metadata_hidden", $array_hidden);
 
 	   	// 既存編集時 2008/03/03
- 		if($this->session->getParameter("item_type_edit_flag") == 1) {
- 			$array_attri_id = $this->session->getParameter("attribute_id");
+ 		if($this->Session->getParameter("item_type_edit_flag") == 1) {
+ 			$array_attri_id = $this->Session->getParameter("attribute_id");
             if(!isset($array_attri_id)) {
                 $array_attri_id = array();
             }
  			array_push($array_attri_id,-1);
  			// 一行増えた場合、その分sessionにも反映
- 			$this->session->setParameter("attribute_id", $array_attri_id);
+ 			$this->Session->setParameter("attribute_id", $array_attri_id);
  		}
  		//2008/03/03
  		
     	// メタデータ数を増やす
-    	$this->session->setParameter("metadata_num", $this->session->getParameter("metadata_num") + 1);
+    	$this->Session->setParameter("metadata_num", $this->Session->getParameter("metadata_num") + 1);
     	
     	// エラーなし 2008/02/28
-    	$this->session->setParameter("error_code", 0);
+    	$this->Session->setParameter("error_code", 0);
         // Add multi language K.Matsuo 2013/07/24 --start--
-        $lang_list = $this->session->getParameter("lang_list");
-        $array_metadata_multi_title = $this->session->getParameter("metadata_multi_title");
+        $lang_list = $this->Session->getParameter("lang_list");
+        $array_metadata_multi_title = $this->Session->getParameter("metadata_multi_title");
         $multiLang = array();
         foreach($lang_list as $key => $lang){
             $multiLang[$key] = "";
         }
         array_push($array_metadata_multi_title,$multiLang);
-        $this->session->setParameter("metadata_multi_title", $array_metadata_multi_title);
+        $this->Session->setParameter("metadata_multi_title", $array_metadata_multi_title);
         // Add multi language K.Matsuo 2013/07/24 --end--
         return 'success';
 
diff --git a/repository/action/edit/itemtype/addmetadata/maple.ini b/repository/action/edit/itemtype/addmetadata/maple.ini
index 20288e0..29281a9 100644
--- a/repository/action/edit/itemtype/addmetadata/maple.ini
+++ b/repository/action/edit/itemtype/addmetadata/maple.ini
@@ -9,7 +9,8 @@ metadata_disp
 
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
+Db = "ref:DbObject"
 request = "ref:Request"
 
 [View]
diff --git a/repository/action/edit/itemtype/confirm/Confirm.class.php b/repository/action/edit/itemtype/confirm/Confirm.class.php
index ab91c50..e749cda 100644
--- a/repository/action/edit/itemtype/confirm/Confirm.class.php
+++ b/repository/action/edit/itemtype/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Confirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -22,9 +22,6 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.
  */
 class Repository_Action_Edit_Itemtype_Confirm extends RepositoryAction
 {
-	// 使用コンポーネントを受け取るため
-	var $session = null;
-	var $Db = null;
 	// リクエストパラメタ
 	var $metadata_title = null;		// メタデータ項目名配列
 	var $metadata_type = null;		// メタデータタイプ配列
@@ -43,7 +40,7 @@ class Repository_Action_Edit_Itemtype_Confirm extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     { 	
     	////////////////////////// データチェック ///////////////////////////
     	$nullError = 0;		// null文字チェック用
@@ -100,7 +97,7 @@ class Repository_Action_Edit_Itemtype_Confirm extends RepositoryAction
     	}
     	// Add metadata name edit 2008/09/04 Y.Nakao --start--
     	if($this->item_type_name!=null && $this->item_type_name!=""){
-    		if($this->session->getParameter("item_type_name") != $this->item_type_name){
+    		if($this->Session->getParameter("item_type_name") != $this->item_type_name){
     			$query = "SELECT * ".
                 	     "FROM ". DATABASE_PREFIX ."repository_item_type ".
                     	 "WHERE item_type_name = ?; ";
@@ -131,27 +128,27 @@ class Repository_Action_Edit_Itemtype_Confirm extends RepositoryAction
 	                //$DetailMsg = null;                              //詳細メッセージ文字列作成
 	                //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
 	                //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-	                $this->session->setParameter("error_code", 1); // 重複エラー 2008/02/28
+	                $this->Session->setParameter("error_code", 1); // 重複エラー 2008/02/28
 	                $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
 	                //throw $exception;
 	                return "error";
 		    	}
-		    	$this->session->setParameter("item_type_name", $this->item_type_name);
+		    	$this->Session->setParameter("item_type_name", $this->item_type_name);
     		}
     	} else {
     		// アイテムタイプ名NULLエラー
-    		$this->session->setParameter("error_code", 6);
+    		$this->Session->setParameter("error_code", 6);
     		return 'error';
     	}
     	// Add metadata name edit 2008/09/04 Y.Nakao --end--
     	
         // metadata_titleをまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_title", $array_title);
+	   	$this->Session->setParameter("metadata_title", $array_title);
 	   	// metadata_typeをまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_type", $this->metadata_type);
+	   	$this->Session->setParameter("metadata_type", $this->metadata_type);
 	   	
 	   	// 2008/02/28 選択肢をまとめて配列でセッションに保存 nakao
-	   	$this->session->setParameter("metadata_candidate",$array_candidate);
+	   	$this->Session->setParameter("metadata_candidate",$array_candidate);
 	   	
 		// フラグもまとめてセッションに保存
 	   	$array_req = array();
@@ -197,32 +194,32 @@ class Repository_Action_Edit_Itemtype_Confirm extends RepositoryAction
         		}
         	}
 	   	}
-		$this->session->setParameter("metadata_required", $array_req);
-	   	$this->session->setParameter("metadata_disp", $array_dis);
-	   	$this->session->setParameter("metadata_plural", $array_plu);
-	   	$this->session->setParameter("metadata_newline", $array_newline);
-	   	$this->session->setParameter("metadata_hidden", $array_hidden);
+		$this->Session->setParameter("metadata_required", $array_req);
+	   	$this->Session->setParameter("metadata_disp", $array_dis);
+	   	$this->Session->setParameter("metadata_plural", $array_plu);
+	   	$this->Session->setParameter("metadata_newline", $array_newline);
+	   	$this->Session->setParameter("metadata_hidden", $array_hidden);
 	   	
-	   	$this->session->setParameter("error_code", $nullError);
+	   	$this->Session->setParameter("error_code", $nullError);
 	   	
 	   	if($nullError != 0){
 	   		return 'error';
 	   	}
 	   	
 		// 編集時に起こる属性名よ属性IDのずれを修正 2008/06/19 Y.Nakao 上記バグの対処 --start--
-		$metadata_num = $this->session->getParameter("metadata_num");
-		$attribute_id = $this->session->getParameter("attribute_id");
+		$metadata_num = $this->Session->getParameter("metadata_num");
+		$attribute_id = $this->Session->getParameter("attribute_id");
 		if($metadata_num != count($attribute_id)){
 			if($metadata_num === 1 || !is_array($attribute_id)){
 				$attribute_id = array();
 			}
  			array_push($attribute_id,-1);
  			// sessionにも反映
- 			$this->session->setParameter("attribute_id", $attribute_id);
+ 			$this->Session->setParameter("attribute_id", $attribute_id);
 		}
 	   	// 2008/06/19 Y.Nakao --end--
 	   	
-		$this->session->removeParameter("error_code");
+		$this->Session->removeParameter("error_code");
 		
 	   	return 'success';
 	   	
diff --git a/repository/action/edit/itemtype/confirm/maple.ini b/repository/action/edit/itemtype/confirm/maple.ini
index 982f6fa..dbd58dd 100644
--- a/repository/action/edit/itemtype/confirm/maple.ini
+++ b/repository/action/edit/itemtype/confirm/maple.ini
@@ -15,7 +15,7 @@ metadata_candidate
 metadata_plural
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
 Db = "ref:DbObject"
 
 [View]
diff --git a/repository/action/edit/itemtype/copy/Copy.class.php b/repository/action/edit/itemtype/copy/Copy.class.php
index bf408c9..59bd008 100644
--- a/repository/action/edit/itemtype/copy/Copy.class.php
+++ b/repository/action/edit/itemtype/copy/Copy.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Copy.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: Copy.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,6 +13,8 @@
 
 /*vim:setexpandtabtabstop=4shiftwidth=4softtabstop=4:*/
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/ItemtypeManager.class.php';
+
 /**
 *Load item type metadata
 *
@@ -257,10 +259,11 @@ class Repository_Action_Edit_Itemtype_Copy extends RepositoryAction
 		    	$query = "INSERT INTO ". DATABASE_PREFIX ."repository_item_attr_type ". 
 		    			 "(item_type_id, attribute_id, show_order, ".
 		    			 " attribute_name, attribute_short_name, input_type, is_required, ".
-		    			 " plural_enable, line_feed_enable, list_view_enable, hidden, junii2_mapping, lom_mapping, ".
-		    			 " dublin_core_mapping, ins_user_id, mod_user_id, del_user_id, ".
+		    			 " plural_enable, line_feed_enable, list_view_enable, hidden, ".
+		    			 " junii2_mapping, dublin_core_mapping, lom_mapping, lido_mapping, display_lang_type, ".
+		    			 " ins_user_id, mod_user_id, del_user_id, ".
 		    			 " ins_date, mod_date, del_date, is_delete) ".
-                		 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
+                		 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
 				$params = null;
 	            $params[] = $item_type_id;	// item_type_id
 	            $params[] = $item_attr_type[$ii]['attribute_id'];			// attribute_id
@@ -274,8 +277,10 @@ class Repository_Action_Edit_Itemtype_Copy extends RepositoryAction
 	            $params[] = $item_attr_type[$ii]['list_view_enable'];		// list_view_enable
 	            $params[] = $item_attr_type[$ii]['hidden'];					// hidden
 	            $params[] = $item_attr_type[$ii]['junii2_mapping'];			// junii2_mapping
-	            $params[] = $item_attr_type[$ii]['lom_mapping'];           // lom_mapping
 	            $params[] = $item_attr_type[$ii]['dublin_core_mapping'];	// dublin_core_mapping
+	            $params[] = $item_attr_type[$ii]['lom_mapping'];            // lom_mapping
+	            $params[] = $item_attr_type[$ii]['lido_mapping'];           // lido_mapping
+	            $params[] = $item_attr_type[$ii]['display_lang_type'];      // display_lang_type
 	            $params[] = $user_id;						// ins_user_id
 	            $params[] = $user_id;						// mod_user_id
 	            $params[] = "";								// del_user_id
@@ -331,6 +336,23 @@ class Repository_Action_Edit_Itemtype_Copy extends RepositoryAction
 	                throw $exception;
 		    	}
 			}
+            // Add itemtype authority copy 2014/12/17 T.Ichikawa --start--
+            $itemtypeManager = new Repository_Components_Itemtypemanager($this->Session, $this->Db, $this->TransStartDate);
+            $base_auth = array();
+            $room_auth = array();
+            $itemtypeManager->getItemtypeAuthority($this->item_type_id, $base_auth, $room_auth);
+            // Insert itemtype auth
+            if(count($room_auth) > 0) {
+                $new_base_auth = array();
+                for($ii = 0; $ii < count($base_auth); $ii++) {
+                    $new_base_auth[] = $base_auth[$ii]["exclusive_base_auth_id"];
+                }
+                $new_room_auth = $room_auth[0]["exclusive_room_auth_id"];
+                
+                $itemtypeManager->setExclusiveItemtypeAuthority($item_type_id, $new_base_auth, $new_room_auth);
+            }
+            // Add itemtype authority copy 2014/12/17 T.Ichikawa --end--
+            
 	    	// エラーコード解除
 			$this->Session->removeParameter("error_code");
 			
diff --git a/repository/action/edit/itemtype/delete/Delete.class.php b/repository/action/edit/itemtype/delete/Delete.class.php
index ee68d8e..f088edb 100644
--- a/repository/action/edit/itemtype/delete/Delete.class.php
+++ b/repository/action/edit/itemtype/delete/Delete.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Delete.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Delete.class.php 47749 2015-02-04 04:03:14Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,6 +14,7 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/ItemtypeManager.class.php';
 
 /**
  * repositoryモジュール アイテムタイプ作成 アイテムタイプ削除アクション
@@ -99,9 +100,9 @@ class Repository_Action_Edit_Itemtype_Delete extends RepositoryAction
 					 "is_delete = ? ".
 					 "WHERE item_type_id = ?; ";
 			$params = null;
-			$params[] = $user_id;							// mod_user_id
+			$params[] = $this->Session->getParameter("_user_id");   // mod_user_id
 			$params[] = $this->TransStartDate;				// mod_date
-			$params[] = $user_id;							// del_user_id
+			$params[] = $this->Session->getParameter("_user_id");   // del_user_id
 			$params[] = $this->TransStartDate;				// del_date
 			$params[] = 1;									// is_delete
 			$params[] = $this->item_type_id;						// item_type_id
@@ -126,6 +127,11 @@ class Repository_Action_Edit_Itemtype_Delete extends RepositoryAction
             $searchTableProcessing->deleteDataFromSearchTable();
             // Add detail search 2013/11/25 K.Matsuo --end--
             
+            // Add itemtype authority 2014/12/17 T.Ichikawa --start--
+            $itemtypeManager = new Repository_Components_ItemtypeManager($this->Session, $this->Db, $this->TransStartDate);
+            $itemtypeManager->removeExclusiveItemtypeAuthority($this->item_type_id);
+            // Add itemtype authority 2014/12/17 T.Ichikawa --end--
+            
 			//exit commit
 			$result = $this->exitAction();
 			if ( $result === false ) {
diff --git a/repository/action/edit/itemtype/dellmetadata/Dellmetadata.class.php b/repository/action/edit/itemtype/dellmetadata/Dellmetadata.class.php
index a628bf8..1fac3f7 100644
--- a/repository/action/edit/itemtype/dellmetadata/Dellmetadata.class.php
+++ b/repository/action/edit/itemtype/dellmetadata/Dellmetadata.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Dellmetadata.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Dellmetadata.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,7 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * repositoryモジュール アイテムタイプ作成 編集画面でメタデータ削除時に呼ばれるアクション
@@ -23,10 +24,9 @@
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Edit_Itemtype_Dellmetadata
+class Repository_Action_Edit_Itemtype_Dellmetadata extends RepositoryAction
 {
 	// 使用コンポーネントを受け取るため
-	var $session = null;
 	var $request = null;
     // Mod metadata name edit 2009/12/10 K.Ando --start--
 	//var $itemtype_name = null;		//前画面で入力したアイテムタイプ名(新規作成時)
@@ -54,7 +54,7 @@ class Repository_Action_Edit_Itemtype_Dellmetadata
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	// 送信されたFormデータから削除対称を削除する
 		if($this->metadata_title != null && $this->metadata_type != null)
@@ -185,17 +185,17 @@ class Repository_Action_Edit_Itemtype_Dellmetadata
 			// 削除対称に非表示チェックがついていたか判定 2009/01/28 A.Suzuki --end--
 		}
 		// メタデータ数を減らす.
-		if($this->session->getParameter("metadata_num") > 0)
+		if($this->Session->getParameter("metadata_num") > 0)
 		{
-			$this->session->setParameter("metadata_num", $this->session->getParameter("metadata_num") - 1);
+			$this->Session->setParameter("metadata_num", $this->Session->getParameter("metadata_num") - 1);
 		}
 		// 既存編集時 2008/03/03
-		if($this->session->getParameter("item_type_edit_flag") == 1) {
+		if($this->Session->getParameter("item_type_edit_flag") == 1) {
 			// 削除前の属性IDのリスト
-			$array_attr_id = $this->session->getParameter("attribute_id");
+			$array_attr_id = $this->Session->getParameter("attribute_id");
 			
 			// 削除対象配列を更新
- 			$del_attr_id = $this->session->getParameter("del_attribute_id");
+ 			$del_attr_id = $this->Session->getParameter("del_attribute_id");
  			if($del_attr_id == null){
  				$del_attr_id = array($array_attr_id[$this->dell_metadata_number]);
  			}
@@ -204,10 +204,10 @@ class Repository_Action_Edit_Itemtype_Dellmetadata
 		 			array_push($del_attr_id, $array_attr_id[$this->dell_metadata_number]);
  				}
  			}
- 			$this->session->setParameter("del_attribute_id",$del_attr_id);
+ 			$this->Session->setParameter("del_attribute_id",$del_attr_id);
 			// 一行減った場合、、その行の属性IDを削除し、sessionに反映
 			array_splice($array_attr_id, $this->dell_metadata_number,1);
- 			$this->session->setParameter("attribute_id", $array_attr_id); 			
+ 			$this->Session->setParameter("attribute_id", $array_attr_id); 			
  		}
  		//2008/03/03
         
@@ -239,20 +239,15 @@ class Repository_Action_Edit_Itemtype_Dellmetadata
  		
 		// sessionの保存
 		// metadata_titleをまとめて配列でセッションに保存
-        $this->session->setParameter("metadata_title", $array_title);
+        $this->Session->setParameter("metadata_title", $array_title);
 	   	// metadata_typeをまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_type", $this->metadata_type);
+	   	$this->Session->setParameter("metadata_type", $this->metadata_type);
 	   	
-    	// Add metadata name edit 2008/09/04 Y.Nakao --start--
     	// Save item type name
-    	// Mod metadata name edit 2009/12/10 K.Ando --start--
-    	//$this->session->setParameter("itemtype_name", $this->item_type_name);
-    	$this->session->setParameter("item_type_name", $this->item_type_name);
-    	// Mod metadata name edit 2009/12/10 K.Ando --end--
-	   	// Add metadata name edit 2008/09/04 Y.Nakao --end--
+    	$this->Session->setParameter("item_type_name", $this->item_type_name);
 	   	
 	   	// 2008/02/28 選択肢をまとめて配列でセッションに保存 nakao
-	   	$this->session->setParameter("metadata_candidate", $array_candidate);
+	   	$this->Session->setParameter("metadata_candidate", $array_candidate);
 	   	
     	//チェックボックスはチェックの入ったnameのvalueのみが送信されるため、データを調整
 	   	// フラグもまとめてセッションに保存
@@ -299,16 +294,16 @@ class Repository_Action_Edit_Itemtype_Dellmetadata
         		}
         	}
 	   	}
-		$this->session->setParameter("metadata_required", $array_req);
-	   	$this->session->setParameter("metadata_disp", $array_dis);
-	   	$this->session->setParameter("metadata_plural", $array_plu);
-	   	$this->session->setParameter("metadata_newline", $array_newline);
-	   	$this->session->setParameter("metadata_hidden", $array_hidden);
+		$this->Session->setParameter("metadata_required", $array_req);
+	   	$this->Session->setParameter("metadata_disp", $array_dis);
+	   	$this->Session->setParameter("metadata_plural", $array_plu);
+	   	$this->Session->setParameter("metadata_newline", $array_newline);
+	   	$this->Session->setParameter("metadata_hidden", $array_hidden);
 	   	
         // Add multi language K.Matsuo 2013/07/24 --start--
-        $array_metadata_multi_title = $this->session->getParameter("metadata_multi_title");
+        $array_metadata_multi_title = $this->Session->getParameter("metadata_multi_title");
         array_splice($array_metadata_multi_title, $this->dell_metadata_number,1);
-        $this->session->setParameter("metadata_multi_title", $array_metadata_multi_title);
+        $this->Session->setParameter("metadata_multi_title", $array_metadata_multi_title);
         // Add multi language K.Matsuo 2013/07/24 --end--
 	   	
 	   	return 'success';
diff --git a/repository/action/edit/itemtype/dellmetadata/maple.ini b/repository/action/edit/itemtype/dellmetadata/maple.ini
index b56056b..79cd22a 100644
--- a/repository/action/edit/itemtype/dellmetadata/maple.ini
+++ b/repository/action/edit/itemtype/dellmetadata/maple.ini
@@ -17,7 +17,8 @@ dell_metadata_number.required ="1:lang._invalid_input"
 ;dell_metadata_number.required
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
+Db = "ref:DbObject"
 request = "ref:Request"
 
 [View]
diff --git a/repository/action/edit/itemtype/edit/Edit.class.php b/repository/action/edit/itemtype/edit/Edit.class.php
index fd80c56..41e7dc1 100644
--- a/repository/action/edit/itemtype/edit/Edit.class.php
+++ b/repository/action/edit/itemtype/edit/Edit.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Edit.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Edit.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -22,11 +22,6 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.
  */
 class Repository_Action_Edit_Itemtype_Edit extends RepositoryAction
 {
-	// 2008/02/25 itemtype を item_type に変更
-	// 使用コンポーネントを受け取るため
-	//var $session = null;
-	var $db = null;
-	
 	// リクエストパラメータを受け取るため
 	var $item_type_name = null;		//前画面で入力したアイテムタイプ名(新規作成時)
 	var $item_type_id = null;		//前画面で選択したアイテムタイプID(編集時)
@@ -175,15 +170,6 @@ class Repository_Action_Edit_Itemtype_Edit extends RepositoryAction
 		   		// メタデータ編集反映不具合対応 2008/06/17 Y.Nakao --end--
 	   		
 	 			// アイテムタイプを検索してセッション情報に保存
-	 			/* 2008/03/06 クエリー変更
-	    		$params = array(
-					"item_type_id" => $this->item_type_id,
-	    			"is_delete" => 0
-	    		);
-	 			// ↓ 2008/02/26 DB修正 nakao
-	 			$result = $this->db->selectExecute("repository_item_type", $params);
-	 			// ↑ 2008/02/26
-				*/
 	 			$query = "SELECT * ".
                 	     "FROM ". DATABASE_PREFIX ."repository_item_type ".
                     	 "WHERE item_type_id = ? AND ".
diff --git a/repository/action/edit/itemtype/export/Export.class.php b/repository/action/edit/itemtype/export/Export.class.php
index 32a9463..1b1eaf3 100644
--- a/repository/action/edit/itemtype/export/Export.class.php
+++ b/repository/action/edit/itemtype/export/Export.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Export.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: Export.class.php 22784 2013-05-22 02:59:13Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/export/maple.ini b/repository/action/edit/itemtype/export/maple.ini
index f83f0c4..3864afa 100644
--- a/repository/action/edit/itemtype/export/maple.ini
+++ b/repository/action/edit/itemtype/export/maple.ini
@@ -1,16 +1,3 @@
-;[Convert]
-;*.trim =
-
-;[ValidateDef]
-;item_type_id
-
-;[Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
-
-;[View]
-;success = "action:repository_view_main_export_detailconfirm"
-
 [ValidateDef]
 item_type_id
 
diff --git a/repository/action/edit/itemtype/icon/Icon.class.php b/repository/action/edit/itemtype/icon/Icon.class.php
index 65270a2..013dac9 100644
--- a/repository/action/edit/itemtype/icon/Icon.class.php
+++ b/repository/action/edit/itemtype/icon/Icon.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Icon.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Icon.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -30,7 +30,7 @@ class Repository_Action_Edit_Itemtype_Icon extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	
     	// アイテムタイプの種類を示すアイコン追加 2008/07/18 Y.Nakao --start--
diff --git a/repository/action/edit/itemtype/import/Import.class.php b/repository/action/edit/itemtype/import/Import.class.php
index c39fb75..1a48a14 100644
--- a/repository/action/edit/itemtype/import/Import.class.php
+++ b/repository/action/edit/itemtype/import/Import.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Import.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Import.class.php 42307 2014-09-29 06:18:07Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/load/Load.class.php b/repository/action/edit/itemtype/load/Load.class.php
index cc8203d..a15e438 100644
--- a/repository/action/edit/itemtype/load/Load.class.php
+++ b/repository/action/edit/itemtype/load/Load.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Load.class.php 281 2009-03-04 08:06:37Z ivis $
+// $Id: Load.class.php 3 2010-02-02 05:07:44Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/mapping/Mapping.class.php b/repository/action/edit/itemtype/mapping/Mapping.class.php
index 4625c2f..3fd7954 100644
--- a/repository/action/edit/itemtype/mapping/Mapping.class.php
+++ b/repository/action/edit/itemtype/mapping/Mapping.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Mapping.class.php 536 2013-03-25 08:44:19Z ivis $
+// $Id: Mapping.class.php 20917 2013-01-16 07:38:08Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/mappingadddb/Mappingadddb.class.php b/repository/action/edit/itemtype/mappingadddb/Mappingadddb.class.php
index 2beec21..97fa1ed 100644
--- a/repository/action/edit/itemtype/mappingadddb/Mappingadddb.class.php
+++ b/repository/action/edit/itemtype/mappingadddb/Mappingadddb.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Mappingadddb.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Mappingadddb.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/mappingconfirm/Mappingconfirm.class.php b/repository/action/edit/itemtype/mappingconfirm/Mappingconfirm.class.php
index 481955f..7fa26a5 100644
--- a/repository/action/edit/itemtype/mappingconfirm/Mappingconfirm.class.php
+++ b/repository/action/edit/itemtype/mappingconfirm/Mappingconfirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Mappingconfirm.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Mappingconfirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,7 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * [[機能説明]]
@@ -19,10 +20,8 @@
  * @package     [[package名]]
  * @access      public
  */
-class Repository_Action_Edit_Itemtype_Mappingconfirm
+class Repository_Action_Edit_Itemtype_Mappingconfirm extends RepositoryAction
 {
-	// 使用コンポーネントを受け取るため
-	var $session = null;
 	// リクエストパラメタ
 	var $niitype = null;			// type選択値
 	var $dublin_core = null;		// Dublin Core選択値
@@ -38,10 +37,10 @@ class Repository_Action_Edit_Itemtype_Mappingconfirm
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	// セッションからアイテムタイプ情報を取得
-    	$itemtype = $this->session->getParameter("itemtype");
+    	$itemtype = $this->Session->getParameter("itemtype");
         // Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -start-
         // change condition of 'if' '未設定'->"0"
     	if($this->niitype != "0"){
@@ -51,9 +50,9 @@ class Repository_Action_Edit_Itemtype_Mappingconfirm
     		$itemtype['mapping_info'] = ""; 
     	}
         // Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -end-
-    	$this->session->setParameter("itemtype", $itemtype);
+    	$this->Session->setParameter("itemtype", $itemtype);
     	// リクエストパラメタ分を置き換え
-    	$arrays = $this->session->getParameter("metadata_table");
+    	$arrays = $this->Session->getParameter("metadata_table");
     	// 書誌情報追加 2008/08/22 Y.Nakao --start--
     	$cnt_biblio = 0; // 書誌情報の個数を数える
     	for($ii=0; $ii<count($arrays); $ii++ ) {
@@ -127,7 +126,7 @@ class Repository_Action_Edit_Itemtype_Mappingconfirm
     	}
     	// 書誌情報追加 2008/08/22 Y.Nakao --start--
     	// 再セット
-    	$this->session->setParameter("metadata_table", $arrays);
+    	$this->Session->setParameter("metadata_table", $arrays);
         return 'success';
     }
 }
diff --git a/repository/action/edit/itemtype/mappingconfirm/maple.ini b/repository/action/edit/itemtype/mappingconfirm/maple.ini
index c1f9b9c..2d75779 100644
--- a/repository/action/edit/itemtype/mappingconfirm/maple.ini
+++ b/repository/action/edit/itemtype/mappingconfirm/maple.ini
@@ -8,7 +8,8 @@ junii2
 lom
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
+Db = "ref:DbObject"
 
 [View]
 success = "action:repository_view_edit_itemtype_mappingconfirm"
diff --git a/repository/action/edit/itemtype/multilang/Multilang.class.php b/repository/action/edit/itemtype/multilang/Multilang.class.php
index b1875f1..c50b5cf 100644
--- a/repository/action/edit/itemtype/multilang/Multilang.class.php
+++ b/repository/action/edit/itemtype/multilang/Multilang.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Multilang.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Multilang.class.php 15605 2012-02-20 09:30:55Z tatsuya_koyasu $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/itemtype/setting/Setting.class.php b/repository/action/edit/itemtype/setting/Setting.class.php
index 1814167..e49f461 100644
--- a/repository/action/edit/itemtype/setting/Setting.class.php
+++ b/repository/action/edit/itemtype/setting/Setting.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setting.class.php 270 2009-01-21 04:50:41Z ivis $
+// $Id: Setting.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,7 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * repositoryモジュール アイテムタイプ設定 アイテムタイプ選択
@@ -23,35 +24,32 @@
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Edit_Itemtype_Setting
+class Repository_Action_Edit_Itemtype_Setting extends RepositoryAction
 {
-	// コンポーネント用
-	var $session = null;
-	
     /**
      * [[機能説明]]
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	// セッション情報初期化 for アイテムタイプ設定
-    	$this->session->removeParameter("item_type_id");		// アイテムタイプID
-    	$this->session->removeParameter("item_type"); 		// アイテムタイプ
-    	$this->session->removeParameter("metadata_table");	// アイテムタイプ属性テーブル
+    	$this->Session->removeParameter("item_type_id");		// アイテムタイプID
+    	$this->Session->removeParameter("item_type"); 		// アイテムタイプ
+    	$this->Session->removeParameter("metadata_table");	// アイテムタイプ属性テーブル
     	
     	// セッション情報初期化 メタデータ 2008/03/04
-    	$this->session->removeParameter("metadata_num");
-    	$this->session->removeParameter("metadata_title");
-   		$this->session->removeParameter("metadata_type");
-    	$this->session->removeParameter("metadata_required");
-   		$this->session->removeParameter("metadata_disp");
-   		$this->session->removeParameter("metadata_candidate");
+    	$this->Session->removeParameter("metadata_num");
+    	$this->Session->removeParameter("metadata_title");
+   		$this->Session->removeParameter("metadata_type");
+    	$this->Session->removeParameter("metadata_required");
+   		$this->Session->removeParameter("metadata_disp");
+   		$this->Session->removeParameter("metadata_candidate");
    		
-   		$this->session->removeParameter("import_item_type_name");
+   		$this->Session->removeParameter("import_item_type_name");
    		
    		// エラーコード開放
-   		$this->session->removeParameter("error_code");
+   		$this->Session->removeParameter("error_code");
    		
         return 'success';
     }
diff --git a/repository/action/edit/itemtype/setting/maple.ini b/repository/action/edit/itemtype/setting/maple.ini
index 424bd8f..a8d53dd 100644
--- a/repository/action/edit/itemtype/setting/maple.ini
+++ b/repository/action/edit/itemtype/setting/maple.ini
@@ -2,7 +2,8 @@
 ;*.trim =
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
+Db = "ref:DbObject"
 
 [View]
 success = "action:repository_view_edit_itemtype_setting"
diff --git a/repository/action/edit/itemtype/shufflemetadata/Shufflemetadata.class.php b/repository/action/edit/itemtype/shufflemetadata/Shufflemetadata.class.php
index 454d6e8..c9cb121 100644
--- a/repository/action/edit/itemtype/shufflemetadata/Shufflemetadata.class.php
+++ b/repository/action/edit/itemtype/shufflemetadata/Shufflemetadata.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Shufflemetadata.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Shufflemetadata.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,7 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * repositoryモジュール アイテムタイプ作成 編集画面でメタデータ追入れ替えクリック時に呼ばれるアクション
@@ -23,10 +24,9 @@
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Edit_Itemtype_Shufflemetadata
+class Repository_Action_Edit_Itemtype_Shufflemetadata extends RepositoryAction
 {
 	// 使用コンポーネントを受け取るため
-	var $session = null;
 	var $request = null;
     // アイテムタイプ名保持用変数　追加 2009/12/10 K.Ando --start--
 	//var $itemtype_name = null;		//前画面で入力したアイテムタイプ名(新規作成時)
@@ -53,7 +53,7 @@ class Repository_Action_Edit_Itemtype_Shufflemetadata
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	$metadata_title = $this->metadata_title;
     	$metadata_type = $this->metadata_type;
@@ -63,7 +63,7 @@ class Repository_Action_Edit_Itemtype_Shufflemetadata
     	$metadata_plural = $this->metadata_plural;
     	$metadata_newline = $this->metadata_newline;
     	$metadata_hidden = $this->metadata_hidden;
-        $array_metadata_multi_title = $this->session->getParameter("metadata_multi_title");
+        $array_metadata_multi_title = $this->Session->getParameter("metadata_multi_title");
     	
 	    // チェックボックスはチェックの入ったnameのvalueのみが送信されるため、データを調整
 	   	$array_req = array();
@@ -153,13 +153,13 @@ class Repository_Action_Edit_Itemtype_Shufflemetadata
     				$array_metadata_multi_title[$this->shuffle_idx-1] = $tmp;
                     // アイテムタイプ項目名多言語 2013/7/24 K.Matsuo --end--
     				// 既存編集の場合
-    				if($this->session->getParameter("item_type_edit_flag") == 1){
+    				if($this->Session->getParameter("item_type_edit_flag") == 1){
     					// attribute_id配列入れ替え
-    					$array_attri_id = $this->session->getParameter("attribute_id");
+    					$array_attri_id = $this->Session->getParameter("attribute_id");
 	    				$tmp = $array_attri_id[$this->shuffle_idx];
 	    				$array_attri_id[$this->shuffle_idx] = $array_attri_id[$this->shuffle_idx-1];
 	    				$array_attri_id[$this->shuffle_idx-1] = $tmp;
-	    				$this->session->setParameter("attribute_id",$array_attri_id);
+	    				$this->Session->setParameter("attribute_id",$array_attri_id);
     				}
     				break;
     			}    			
@@ -208,13 +208,13 @@ class Repository_Action_Edit_Itemtype_Shufflemetadata
     				$array_metadata_multi_title[$this->shuffle_idx+1] = $tmp;
                     // アイテムタイプ項目名多言語 2013/7/24 K.Matsuo --end--
     				// 既存編集の場合
-    				if($this->session->getParameter("item_type_edit_flag") == 1){
+    				if($this->Session->getParameter("item_type_edit_flag") == 1){
     					// attribute_id配列入れ替え
-    					$array_attri_id = $this->session->getParameter("attribute_id");
+    					$array_attri_id = $this->Session->getParameter("attribute_id");
 	    				$tmp = $array_attri_id[$this->shuffle_idx];
 	    				$array_attri_id[$this->shuffle_idx] = $array_attri_id[$this->shuffle_idx+1];
 	    				$array_attri_id[$this->shuffle_idx+1] = $tmp;
-	    				$this->session->setParameter("attribute_id",$array_attri_id);
+	    				$this->Session->setParameter("attribute_id",$array_attri_id);
     				}
     				break;
     			}    			
@@ -246,29 +246,29 @@ class Repository_Action_Edit_Itemtype_Shufflemetadata
     		}
     	}
     	
-		// sessionの保存
+		// Sessionの保存
 		// metadata_titleをまとめて配列でセッションに保存
-        $this->session->setParameter("metadata_title", $array_title);
+        $this->Session->setParameter("metadata_title", $array_title);
 	   	// metadata_typeをまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_type", $metadata_type);
+	   	$this->Session->setParameter("metadata_type", $metadata_type);
 	   	// 選択肢をまとめて配列でセッションに保存
-	   	$this->session->setParameter("metadata_candidate",$array_candidate);
+	   	$this->Session->setParameter("metadata_candidate",$array_candidate);
     	// 必須チェック
-		$this->session->setParameter("metadata_required", $array_req);
+		$this->Session->setParameter("metadata_required", $array_req);
 		// 一覧表示チェック
-	   	$this->session->setParameter("metadata_disp", $array_dis);
+	   	$this->Session->setParameter("metadata_disp", $array_dis);
 	   	// 複数可否チェック
-	   	$this->session->setParameter("metadata_plural", $array_plu);
+	   	$this->Session->setParameter("metadata_plural", $array_plu);
 	   	// 改行指定チェック
-	   	$this->session->setParameter("metadata_newline", $array_newline);
+	   	$this->Session->setParameter("metadata_newline", $array_newline);
 	   	// 非表示指定チェック
-	   	$this->session->setParameter("metadata_hidden", $array_hidden);
+	   	$this->Session->setParameter("metadata_hidden", $array_hidden);
     	// アイテムタイプ名保存処理　追加 2009/12/10 K.Ando --start--
-    	//$this->session->setParameter("itemtype_name", $this->item_type_name);
-    	$this->session->setParameter("item_type_name", $this->item_type_name);
+    	//$this->Session->setParameter("itemtype_name", $this->item_type_name);
+    	$this->Session->setParameter("item_type_name", $this->item_type_name);
     	// アイテムタイプ名保存処理　追加 2009/12/10 K.Ando --end--	   	
     	// アイテムタイプ項目名多言語 2013/7/24 K.Matsuo --start--
-        $this->session->setParameter("metadata_multi_title", $array_metadata_multi_title);
+        $this->Session->setParameter("metadata_multi_title", $array_metadata_multi_title);
     	// アイテムタイプ項目名多言語 2013/7/24 K.Matsuo --end--
 	   	return 'success';
 		
diff --git a/repository/action/edit/itemtype/shufflemetadata/maple.ini b/repository/action/edit/itemtype/shufflemetadata/maple.ini
index 4f1d69e..e2c9b58 100644
--- a/repository/action/edit/itemtype/shufflemetadata/maple.ini
+++ b/repository/action/edit/itemtype/shufflemetadata/maple.ini
@@ -16,7 +16,8 @@ shuffle_idx.required ="1:lang._invalid_input"
 shuffle_flg.required ="1:lang._invalid_input"
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
+Db = "ref:DbObject"
 request = "ref:Request"
 
 [View]
diff --git a/repository/action/edit/itemtype/upload/Upload.class.php b/repository/action/edit/itemtype/upload/Upload.class.php
index 81723f2..498a909 100644
--- a/repository/action/edit/itemtype/upload/Upload.class.php
+++ b/repository/action/edit/itemtype/upload/Upload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Upload.class.php 270 2009-01-21 04:50:41Z ivis $
+// $Id: Upload.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -32,7 +32,7 @@ class Repository_Action_Edit_Itemtype_Upload
 	 *
 	 * @access  public
 	 */
-	function execute()
+	function executeApp()
 	{
 		// ガーベージフラグが"1"の場合、いつかファイル・DB共にクリアしてくれる。
 		// ただし、詳細なタイミングは不明。
diff --git a/repository/action/edit/itemtype/uploadIcon/UploadIcon.class.php b/repository/action/edit/itemtype/uploadIcon/UploadIcon.class.php
index 281c398..29202f0 100644
--- a/repository/action/edit/itemtype/uploadIcon/UploadIcon.class.php
+++ b/repository/action/edit/itemtype/uploadIcon/UploadIcon.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: UploadIcon.class.php 270 2009-01-21 04:50:41Z ivis $
+// $Id: UploadIcon.class.php 3 2010-02-02 05:07:44Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/log/exclusion/Exclusion.class.php b/repository/action/edit/log/exclusion/Exclusion.class.php
index 2de85ac..5676b65 100644
--- a/repository/action/edit/log/exclusion/Exclusion.class.php
+++ b/repository/action/edit/log/exclusion/Exclusion.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Exclusion.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Exclusion.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -11,7 +11,7 @@
 //
 // --------------------------------------------------------------------
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 
 /**
  * log result action
@@ -23,104 +23,30 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Edit_Log_Exclusion extends RepositoryAction
+class Repository_Action_Edit_Log_Exclusion extends WekoAction
 {
-	// component
-	var $Session = null;
-	var $smartyAssign = null;
-	var $uploadsView = null;
-
-	// out type
-	// 1:exception
-	// 2:release
-	var $queryParam = null;
-	var $log_exclusion = null;
-
-	function execute()
-	{
-		try {
-			$result = $this->initAction();
-			if ( $result === false ) {
-				$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-				$DetailMsg = null;                              //詳細メッセージ文字列作成
-				sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-				$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-				$this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-				throw $exception;
-			}
-
-			// -----------------------------------------
-			// make log exception SQL
-			// -----------------------------------------
-			$query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-					 "WHERE param_name = 'log_exclusion'; ";
-			$ip_list = $this->Db->execute($query);
-			if(ip_list === false){
-				return 'error';
-			}
-			
-			if(strcmp($this->queryParam, 1) == 0)
-			{
-				// except ip address
-				$params[0] = $ip_list[0]['param_value']."\n".$this->log_exclusion;	// param_value
-				$params[1] = $this->Session->getParameter("_user_id");	// mod_user_id
-				$params[2] = $this->TransStartDate;	// mod_date
-				$params[3] = 'log_exclusion';		// param_name
-				$result = $this->updateParamTableData($params, $Error_Msg);
-				if ($result === false) {
-					$errMsg = $this->Db->ErrorMsg();
-					$tmpstr = sprintf("log_exclusion update failed : %s", $errMsg ); 
-					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//ROLLBACK
-					return 'error';
-				}
-			}
-			else
-			{
-				$ip_list = str_replace("\r\n", "\n", $ip_list[0]["param_value"]);
-				$ip_list = str_replace("\r", "\n", $ip_list);
-				// remove ip address
-				$ip_list = str_replace("\n".$this->log_exclusion."\n", "\n", $ip_list);	
-				$ip_list = str_replace($this->log_exclusion."\n", "", $ip_list);	
-				$ip_list = str_replace("\n".$this->log_exclusion, "", $ip_list);	
-				$params[0] = $ip_list;
-				$params[1] = $this->Session->getParameter("_user_id");	// mod_user_id
-				$params[2] = $this->TransStartDate;	// mod_date
-				$params[3] = 'log_exclusion';		// param_name
-				$result = $this->updateParamTableData($params, $Error_Msg);
-				if ($result === false) {
-					$errMsg = $this->Db->ErrorMsg();
-					$tmpstr = sprintf("log_exclusion update failed : %s", $errMsg ); 
-					$this->Session->setParameter("error_msg", $tmpstr);
-					$this->failTrans();		//ROLLBACK
-					return 'error';
-				}
-			}
-				
-			// lang resource 
-			$this->smartyAssign = $this->Session->getParameter("smartyAssign");
-			print ("success"."\n");
-			
-			$this->exitAction();
-			 
-		} catch ( RepositoryException $Exception) {
-			//エラーログ出力
-			$this->logFile(
-	        	"SampleAction",					//クラス名
-	        	"execute",						//メソッド名
-			$Exception->getCode(),			//ログID
-			$Exception->getMessage(),		//主メッセージ
-			$Exception->getDetailMsg() );	//詳細メッセージ
-			 
-			//アクション終了処理
-			$this->exitAction();                   //トランザクションが失敗していればROLLBACKされる
-
-			//異常終了
-			return "error";
-		}
+    /**
+     * additional exclude ip address
+     *
+     * @var string
+     *         ex) 172.17.72.110,172.17.72.111
+     */
+    public $log_exclusion = null;
+
+    /**
+     * add excluded Ip Address List by request parameter
+     *
+     */
+    function executeApp()
+    {
+        $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+        $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+        $logManager->addExcludedIpAddrToDatabase($this->log_exclusion);
+        
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        echo $smartyAssign->getLang("repository_log_update_exclude_address"). 
+             "\n". 
+             $smartyAssign->getLang("repository_log_announce_update_clowler_list");
 	}
-
 }
-
-
 ?>
diff --git a/repository/action/edit/log/exclusion/maple.ini b/repository/action/edit/log/exclusion/maple.ini
index ca4adde..5bb3c11 100644
--- a/repository/action/edit/log/exclusion/maple.ini
+++ b/repository/action/edit/log/exclusion/maple.ini
@@ -1,8 +1,5 @@
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
-request = GET
+request = POST
 
 [Action]
 Db = "ref:DbObject"
diff --git a/repository/action/edit/log/move/Move.class.php b/repository/action/edit/log/move/Move.class.php
index 6f11e67..96edb2e 100644
--- a/repository/action/edit/log/move/Move.class.php
+++ b/repository/action/edit/log/move/Move.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Move.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Move.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -49,7 +49,7 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 	// member
 	var $log_exception = "";
 	
-	function execute()
+	function executeApp()
 	{
 		try {
 			ini_set('memory_limit', -1);
@@ -230,8 +230,9 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
             // -------------------------------------------
             // Aggregate usage statistics
             // -------------------------------------------
-            $RepositoryUsagestatistics = new RepositoryUsagestatistics($this->Session, $this->Db, $this->TransStartDate);
-            if(!$RepositoryUsagestatistics->aggregateUsagestatistics())
+            $this->infoLog("businessUsagestatistics", __FILE__, __CLASS__, __LINE__);
+            $usageStatistics = BusinessFactory::getFactory()->getBusiness("businessUsagestatistics");
+            if(!$usageStatistics->aggregateUsagestatistics())
             {
                 $this->failTrans();
                 $this->exitAction();
@@ -395,7 +396,7 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					" FROM  ".DATABASE_PREFIX."repository_log AS log ".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '1' ".
+					" AND log.operation_id = 1 ".
 					$this->log_exception.
 					" GROUP BY d1 ";
 			$result = $this->Db->execute($query);
@@ -415,10 +416,10 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					 "   SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
 					 "   ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
 					 "   FROM ". DATABASE_PREFIX ."repository_log ".
-					 "   WHERE operation_id='2' ) AS log".
+					 "   WHERE operation_id=2 ) AS log".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '2' ".
+					" AND log.operation_id = 2 ".
 					$this->log_exception.
 					" GROUP BY d1 ";
 			// Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
@@ -437,7 +438,7 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					" FROM  ".DATABASE_PREFIX."repository_log AS log ".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '3' ".
+					" AND log.operation_id = 3 ".
 					$this->log_exception.
 					" GROUP BY d1 ".
 					" ORDER BY d1 ";
@@ -453,9 +454,12 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 			// make log file(yyyy.txt)
 			// ------------------------------------------
 			$year = "";
+	        
 			foreach ($log_per_date as $date => $val){
 				if(substr($date, 0, 4) != $year){
-					fclose($fp);
+				    if (strlen($year) > 0){
+					    fclose($fp);
+				    }
 					$year = substr($date, 0, 4);
 					$fp = fopen(WEBAPP_DIR."/logs/weko/logfile/log_per_date_$year.txt", "a");
 				}
@@ -479,7 +483,7 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					" FROM  ".DATABASE_PREFIX."repository_log AS log ".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '1' ".
+					" AND log.operation_id = 1 ".
 					$this->log_exception.
 					" GROUP BY d1, addr ".
 					" ORDER BY d1, addr ";
@@ -514,10 +518,10 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					"   SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
 					"	ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent, host".
 					"   FROM ". DATABASE_PREFIX ."repository_log ".
-					"   WHERE operation_id='2' ) AS log".
+					"   WHERE operation_id=2 ) AS log".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '2' ".
+					" AND log.operation_id = 2 ".
 					$this->log_exception.
 					" GROUP BY d1, addr ".
 					" ORDER BY d1, addr ";
@@ -551,7 +555,7 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					" FROM  ".DATABASE_PREFIX."repository_log AS log ".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '3' ".
+					" AND log.operation_id = 3 ".
 					$this->log_exception.
 					" GROUP BY d1, addr ".
 					" ORDER BY d1, addr ";
@@ -581,9 +585,12 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 			// make log file(log_per_host_yyyyMM.txt)
 			// ------------------------------------------
 			$month = "";
+	        
 			foreach ($log_per_host as $date => $list){
 				if(substr($date, 0, 4).substr($date, 5, 2) != $month){
-					fclose($fp);
+					if (strlen($month) > 0){
+					    fclose($fp);
+				    }
 					$month = substr($date, 0, 4).substr($date, 5, 2);
 					$fp = fopen(WEBAPP_DIR."/logs/weko/logfile/log_per_host_".$month.".txt", "a"); 
 				}
@@ -612,10 +619,10 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					"   SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
 					"	ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
 					"   FROM ". DATABASE_PREFIX ."repository_log ".
-					"   WHERE operation_id='2' ) AS log".
+					"   WHERE operation_id=2 ) AS log".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '2' ".
+					" AND log.operation_id = 2 ".
 					$this->log_exception.
 					" GROUP BY d1, item_id, item_no ".
 					" ORDER BY d1, item_id, item_no; ";
@@ -650,7 +657,7 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 					" FROM  ".DATABASE_PREFIX."repository_log AS log ".
 					" WHERE log.record_date >= '$start_date' ".
 					" AND log.record_date <= '$end_date' ".
-					" AND log.operation_id = '3' ".
+					" AND log.operation_id = 3 ".
 					$this->log_exception.
 					" GROUP BY d1, item_id, item_no ".
 					" ORDER BY d1, item_id, item_no; ";
@@ -681,9 +688,12 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 			// make log file(log_per_host_yyyyMM.txt)
 			// ------------------------------------------
 			$month = "";
+	        
 			foreach ($log_per_item as $date => $list){
 				if(substr($date, 0, 4).substr($date, 5, 2) != $month){
-					fclose($fp);
+					if (strlen($month) > 0){
+					    fclose($fp);
+				    }
 					$month = substr($date, 0, 4).substr($date, 5, 2);
 					$fp = fopen(WEBAPP_DIR."/logs/weko/logfile/log_per_item_$month.txt", "a");
 				}
@@ -710,30 +720,39 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 	 */
 	function makeLogReport(){
 		$block_id = $this->getBlockPageId();
-		$logreport = new Repository_Logreport();
-		//$cnt_month = 0;
-		//$end_time = mktime(0, 0, 0, $this->end_month, 1, $this->end_year);
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logreport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logreport->setAdminBase($this->repository_admin_base);
+        $logreport->setAdminRoom($this->repository_admin_room);
+        $repositoryLogreport = new Repository_Logreport();
 		
 		$start_date = $this->start_year."-".$this->start_month."-01";
 		$end_date = $this->end_year."-".$this->end_month."-01";
 		$query = "SELECT DATEDIFF('".$end_date."', '".$start_date."') AS date_diff;";
 		$result = $this->Db->execute($query);
-		if($result === false || count($result) != 1){
-			return false;
+		if($result === false){
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
 		}
+        
+        if(count($result) != 1) {
+            return false;
+        }
 		$diff = $result[0]['date_diff'];
 		$tmp_date = $start_date;
-		
-		//while( ($month = mktime(0, 0, 0, $this->start_month+$cnt_month, 1, $this->start_year)) <= $end_time){
+        
 		while( $diff >= 0){
-			//$report_file = WEBAPP_DIR."/logs/weko/logreport/logReport_".date("Y", $month).date("m", $month).".zip";
-			
 			$query = "SELECT DATE_FORMAT('".$tmp_date."', '%Y') AS tmp_y, ".
 					 "DATE_FORMAT('".$tmp_date."', '%m') AS tmp_m;";
 			$result = $this->Db->execute($query);
-			if($result === false || count($result) != 1){
-				return false;
-			}
+		    if($result === false){
+                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                throw new AppException($this->Db->ErrorMsg());
+    		}
+            
+            if(count($result) != 1) {
+                return false;
+            }
 			$tmp_year = $result[0]['tmp_y'];
 			$tmp_month = $result[0]['tmp_m'];
 			$report_file = WEBAPP_DIR."/logs/weko/logreport/logReport_".$tmp_year.$tmp_month.".zip";
@@ -745,100 +764,57 @@ class Repository_Action_Edit_Log_Move extends RepositoryAction
 			// -----------------------------------------------
 			// init
 			// -----------------------------------------------
-			$logreport->smartyAssign = $this->smartyAssign;
-			$logreport->Session = $this->Session;
-			$logreport->Db = $this->Db;
-			//$logreport->sy_log = date("Y", $month);
-			//$logreport->sm_log = date("m", $month);
-			$logreport->sy_log = $tmp_year;
-			$logreport->sm_log = $tmp_month;
-			$logreport->mail = false;
 			// set start date
-			$logreport->start_date = sprintf("%d-%02d-%02d",$logreport->sy_log, $logreport->sm_log,$logreport->sd_log);
-			$logreport->disp_start_date = sprintf("%d-%02d",$logreport->sy_log, $logreport->sm_log);
-			// set end date
-			$logreport->ey_log = $logreport->sy_log;
-			$logreport->em_log = $logreport->sm_log;
-			$logreport->end_date = sprintf("%d-%02d-%02d",$logreport->ey_log, $logreport->em_log,$logreport->ed_log);
-			$logreport->disp_end_date = sprintf("%d-%02d",$logreport->ey_log, $logreport->em_log);
+            $logreport->setStartYear($tmp_year);
+            $logreport->setStartMonth($tmp_month);
+            // set end date
+            $logreport->setEndYear($tmp_year);
+            $logreport->setEndMonth($tmp_month);
+            // set parameter
+            $repositoryLogreport->Session = $this->Session;
+            $repositoryLogreport->Db = $this->Db;
+            $repositoryLogreport->sy_log = $tmp_year;
+            $repositoryLogreport->sm_log = $tmp_month;
+            $repositoryLogreport->start_date = sprintf("%d-%02d-%02d",$repositoryLogreport->sy_log, $repositoryLogreport->sm_log, $repositoryLogreport->sd_log);
+            $repositoryLogreport->disp_start_date = sprintf("%d-%02d",$repositoryLogreport->sy_log, $repositoryLogreport->sm_log);
+            $repositoryLogreport->ey_log = $repositoryLogreport->sy_log;
+            $repositoryLogreport->em_log = $repositoryLogreport->sm_log;
+            $repositoryLogreport->end_date = sprintf("%d-%02d-%02d",$repositoryLogreport->ey_log, $repositoryLogreport->em_log,$repositoryLogreport->ed_log);
+            $repositoryLogreport->disp_end_date = sprintf("%d-%02d",$repositoryLogreport->ey_log, $repositoryLogreport->em_log);
+            $repositoryLogreport->setupLanguageResourceForOtherAction();
+            $repositoryLogreport->setupGroupList();
+            
 			// add for compress files
 			$output_files = array();
 			//$date = date("YmdHis");
 			$query = "SELECT DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS now_date;";
 			$result = $this->Db->execute($query);
-			if($result === false || count($result) != 1){
-				return false;
-			}
+		    if($result === false){
+                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                throw new AppException($this->Db->ErrorMsg());
+    		}
+            
+            if(count($result) != 1) {
+                return false;
+            }
 			$date = $result[0]['now_date'];
 			$tmp_dir = WEBAPP_DIR."/uploads/repository/_".$date;
 			mkdir( $tmp_dir, 0777 );
-			// setting log ecception
-			$log_report->log_exception = $this->log_exception;
 			
 			// -----------------------------------------------
 			// make
 			// -----------------------------------------------
-			// site license
-			$log_str = $logreport->makeAccessLogReport();
-			$log_file = $tmp_dir . "/logReport_SiteAccess_".
-						str_replace("-", "", $logreport->disp_start_date).".tsv";
-			$log_report = fopen($log_file, "w");
-			fwrite($log_report, $log_str);
-			fclose($log_report);
-			array_push( $output_files, $log_file );
-			
-			// download file num
-			$log_str = $logreport->makeFilePriceDownloadLogReportStr();
-			$log_file = $tmp_dir . "/logReport_PayPerView_".
-						str_replace("-", "", $logreport->disp_start_date).".tsv";
-			$log_report = fopen($log_file, "w");
-			fwrite($log_report, $log_str);
-			fclose($log_report);
-			array_push( $output_files, $log_file );
-			
-			// detail view as index
-			$log_str = $logreport->makeIndexLogReport();
-			$log_file = $tmp_dir . "/logReport_IndexAccess_".
-						str_replace("-", "", $logreport->disp_start_date).".tsv";
-			$log_report = fopen($log_file, "w");
-			fwrite($log_report, $log_str);
-			fclose($log_report);
-			array_push( $output_files, $log_file );
-			
-			// detail view and download file num as supple items
-			$log_str = $logreport->makeSuppleLogReport();
-			$log_file = $tmp_dir . "/logReport_SuppleAccess_".
-						str_replace("-", "", $logreport->disp_start_date).".tsv";
-			$log_report = fopen($log_file, "w");
-			fwrite($log_report, $log_str);
-			fclose($log_report);
-			array_push( $output_files, $log_file );
-			
-			// host log
-			$log_str = $logreport->makeHostLogReport();
-			$log_file = $tmp_dir . "/logReport_HostAccess_".
-						str_replace("-", "", $logreport->disp_start_date).".tsv";
-			$log_report = fopen($log_file, "w");
-			fwrite($log_report, $log_str);
-			fclose($log_report);
-			array_push( $output_files, $log_file );
-			
-            // Add Flash view log 2011/03/01 Y.Nakao --start--
-            $log_str = $logreport->makeFlashViewLogReport();
-            $log_file = $tmp_dir . "/logReport_FlashView_".
-                        str_replace("-", "", $logreport->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add Flash view log 2011/03/01 Y.Nakao --end--
-			
+            // Get data
+			$logreport->execute();
+            // Make file
+            $output_files = $repositoryLogreport->createLogReport($tmp_dir);
+            
 			// -----------------------------------------------
 			// compress zip file
 			// -----------------------------------------------
 			// set zip file name
 			$zip_file = "logReport_".
-						str_replace("-", "", $logreport->disp_start_date).".zip";
+						str_replace("-", "", sprintf("%d-%02d",$tmp_year, $tmp_month)).".zip";
 			// compress zip file	
 			File_Archive::extract(
 				$output_files,
diff --git a/repository/action/edit/log/report/Report.class.php b/repository/action/edit/log/report/Report.class.php
index a78caa0..8f72002 100644
--- a/repository/action/edit/log/report/Report.class.php
+++ b/repository/action/edit/log/report/Report.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Report.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Report.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/log/result/Result.class.php b/repository/action/edit/log/result/Result.class.php
index 7b8ee84..4d79b74 100644
--- a/repository/action/edit/log/result/Result.class.php
+++ b/repository/action/edit/log/result/Result.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Result.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Result.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -11,8 +11,8 @@
 //
 // --------------------------------------------------------------------
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDownload.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 
 /**
  * log result action
@@ -24,7 +24,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDownload.clas
  * @project     NetCommons Project, supported by National Institute of Informatics
  * @access      public
  */
-class Repository_Action_Edit_Log_Result extends RepositoryAction
+class Repository_Action_Edit_Log_Result extends WekoAction
 {
     const CRLF = "\r\n";
     
@@ -32,7 +32,10 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
     // 1:insert
     // 2:download
     // 3:view
-    var $type_log=2;
+    const TYPE_LOG_REGIST_ITEM = 1;
+    const TYPE_LOG_DOWNLOAD = 2;
+    const TYPE_LOG_VIEW = 3;
+    public $type_log = null;
     // per type
     // 1:month
     // 2:week
@@ -40,142 +43,48 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
     // 4:year
     // 5:item
     // 6:host
-    var $per_log=4;
+    const PER_LOG_DAY = 1;
+    const PER_LOG_WEEK = 2;
+    const PER_LOG_MONTH = 3;
+    const PER_LOG_YEAR = 4;
+    const PER_LOG_ITEM = 5;
+    const PER_LOG_HOST = 6;
+    public $per_log = null;
     // start date
-    var $sy_log='';
-    var $sm_log='';
-    var $sd_log='';
+    public $sy_log = null;
+    public $sm_log = null;
+    public $sd_log = null;
     // end date
-    var $ey_log='';
-    var $em_log='';
-    var $ed_log='';
+    public $ey_log = null;
+    public $em_log = null;
+    public $ed_log = null;
 
     // download type
-    // 0:html
-    // 1:csv
-    // 2:tsv
-    var $is_csv_log=0;
+    const DOWNLOAD_TYPE_HTML = 0;   // 0:html
+    const DOWNLOAD_TYPE_CSV = 1;    // 1:csv
+    const DOWNLOAD_TYPE_TSV = 2;    // 2:tsv
+    public $is_csv_log = null;
 
-    var $queryParam=null;
-
-    // Add log exception from ip address 2008.11.10 Y.Nakao --start--
-    var $log_exception = "";
-    // Add log exception from ip address 2008.11.10 Y.Nakao --end--
-
-    // Add lang resource 2008/11/27 Y.Nakao --start--
-    // component
-    var $Session = null;
-    var $smartyAssign = null;
-    // Add lang resource 2008/11/27 Y.Nakao --end--
+    /**
+     * language resource object
+     *
+     * @var object
+     */
+    private $smartyAssign = null;
 
-    // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
-    var $repositoryDownload = null;
-    // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
-    
-    // Add log exclusion from user-agaent 2010/07/02 Y.Nakao --end--
-    var $robots_exclusion = "";
-    // Add log exclusion from user-agaent 2010/07/02 Y.Nakao --end--
+    /**
+     * download object
+     *
+     * @var object
+     */
+    private $repositoryDownload = null;
     
-    function execute()
-    {
-        try {
-            
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-                $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            {
-                $tmpArr1 = explode("&",$_SERVER["QUERY_STRING"]);
-                for ( $i=0; $i<count($tmpArr1); $i++ ) {
-                    $tmpArr2 = explode("=", $tmpArr1[$i]);
-                    $this->queryParam[$tmpArr2[0]] = $tmpArr2[1];
-                }
-                $this->sy_log = $this->queryParam['sy_log'];
-                $this->sm_log = $this->queryParam['sm_log'];
-                $this->sd_log = $this->queryParam['sd_log'];
-                $this->ey_log = $this->queryParam['ey_log'];
-                $this->em_log = $this->queryParam['em_log'];
-                $this->ed_log = $this->queryParam['ed_log'];
-                $this->type_log = $this->queryParam['type_log'];
-                $this->per_log = $this->queryParam['per_log'];
-                $this->is_csv_log = $this->queryParam['is_csv_log'];
-            }
-             
-            // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
-            $this->repositoryDownload = new RepositoryDownload();
-            // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
-            
-            // Add log exception from ip address 2008.11.10 Y.Nakao --start--
-            // -----------------------------------------
-            // make log exception SQL
-            // -----------------------------------------
-            $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                     "WHERE param_name = 'log_exclusion'; ";
-            $ip_list = $this->Db->execute($query);
-            if($ip_list === false){
-                return 'error';
-            }
-                
-            // Add log exclusion from user-agaent 2011/04/28 H.Ito --start--
-            $this->log_exception = $this->createLogExclusion(1);
-            $this->robots_exclusion = $this->createLogExclusion(2);
-            // Add log exclusion from user-agaent 2011/04/28 H.Ito --end--
-                
-            // Add lang resource 2008/11/27 Y.Nakao --start--
-            $this->smartyAssign = $this->Session->getParameter("smartyAssign");
-            // Add lang resource 2008/11/27 Y.Nakao --end--
-                
-            // -----------------------------------------
-            // make log result
-            // -----------------------------------------
-            // disp log result
-            if ($this->per_log==5) {
-                // per item
-                $this->getPerItem();
-                // Add host log Y.Nakao 2010/03/03 Y.Nakao --start--
-            } else if ($this->per_log == 6) {
-                // per host
-                $this->getPerHost();
-                // Add host log Y.Nakao 2010/03/03 Y.Nakao --end--
-            } else {
-                // per date
-                $this->getPerDate();
-            }
-            
-            exit();
-             
-        } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            $this->logFile(
-                "SampleAction",                 //クラス名
-                "execute",                      //メソッド名
-            $Exception->getCode(),          //ログID
-            $Exception->getMessage(),       //主メッセージ
-            $Exception->getDetailMsg() );   //詳細メッセージ
-             
-            //アクション終了処理
-            $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる
-
-            //異常終了
-            return "error";
-        }
-    }
-
-    // Add lang resource 2008/11/27 Y.Nakao --start--
     /**
-     * per date log result format HTML
+     * execute each custom report process
      *
      */
-    function getPerDate()
+    function executeApp()
     {
-        $CSV = "";
-        $TSV = "";
-        $html = "";
         // ------------------------------------------
         // set log start - end date
         // ------------------------------------------
@@ -186,400 +95,103 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
         $em = sprintf("%02d",$this->em_log);
         $ed = sprintf("%02d",$this->ed_log);
         
-//      $su = mktime(0,0,0,$sm,$sd,$sy);
-//      $eu = mktime(0,0,0,$em,$ed,$ey);
-//      // second per day
-//      $sec = 60 * 60 * 24; // 60[s] * 60[m] * 24[h]
-//      // get date
-//      $date_list = array();
-//      $log_per_date = array();
-//      for ( $i = $su;$i <= $eu;$i += $sec ) {
-//          array_push($date_list, date("Y-m-d", $i));
-//      }
-
-        // get date
-        $date_list = array();
-        $log_per_date = array();
+        $this->infoLog("businessCustomreport", __FILE__, __CLASS__, __LINE__);
+        $customReport = BusinessFactory::getFactory()->getBusiness("businessCustomreport");
         
-        $s_date = $sy."-".$sm."-".$sd;
-        $e_date = $ey."-".$em."-".$ed;
-        $query = "SELECT DATEDIFF('".$e_date."', '".$s_date."') AS date_diff;";
-        $result = $this->Db->execute($query);
-        if($result === false || count($result) != 1){
-            return false;
-        }
-        $diff = $result[0]['date_diff'];
-        for ($i=0;$i<=$diff;$i++) {
-            $query = "SELECT DATE_ADD('".$s_date."', INTERVAL ".$i." DAY) AS str_date;";
-            $result = $this->Db->execute($query);
-            if($result === false || count($result) != 1){
-                return false;
-            }
-            array_push($date_list, $result[0]['str_date']);
-        }
+        // set member
+        $customReport->setStartYear($this->sy_log);
+        $customReport->setStartMonth($this->sm_log);
+        $customReport->setStartDay($this->sd_log);
+        $customReport->setEndYear($this->ey_log);
+        $customReport->setEndMonth($this->em_log);
+        $customReport->setEndDay($this->ed_log);
+        $customReport->setCountType($this->type_log);
+        $customReport->setCountPer($this->per_log);
         
-        // ------------------------------------------
-        // read log file per date
-        // ------------------------------------------
-        $width_max = 0;     // max count
-        //$su_db = $su;
-        $su_db = $s_date;
-        for($ii=$sy; $ii<=$ey; $ii++){
-            if(file_exists(WEBAPP_DIR."/logs/weko/logfile/log_per_date_$ii.txt")){
-                $date = "";
-                $cnt = 0;
-                $now_key = "";
-                $old_key = "";
-                $fp = fopen(WEBAPP_DIR."/logs/weko/logfile/log_per_date_$ii.txt", "r");
-                $lastDateFlag = false;
-                while(!feof($fp)){
-                    // read line
-                    // record_date  year_week   item_count  download_count  view_count
-                    $file_line = fgets($fp);
-                    $file_line = str_replace("\r\n", "", $file_line);
-                    $file_line = str_replace("\n", "", $file_line);
-                    $line = split("\t", $file_line);
-                    if(in_array($line[0], $date_list)){
-                        // cntを合計するキーを取得
-                        $now_key = "";
-                        if($this->per_log == "1") {
-                            // per date
-                            $now_key = $line[0];
-                        } else if($this->per_log == "2") {
-                            // per week
-                            $now_key = $line[1];
-                        } else if($this->per_log == "3") {
-                            // per month
-                            $now_key = substr($line[0], 0, 7);
-                            // 末日を保持
-                            $tmp = explode("-", $old_key);
-                            //$date  = date("Y-m-d", mktime(0, 0, 0, $tmp[1]+1, 0, $tmp[0]));
-                            $query = "SELECT LAST_DAY('".$tmp[0]."-".($tmp[1])."-01') AS str_date;";
-                            $result = $this->Db->execute($query);
-                            if($result === false || count($result) != 1){
-                                return false;
-                            }
-                            $date = $result[0]['str_date'];
-                        } else if($this->per_log == "4") {
-                            // per year
-                            $now_key = substr($line[0], 0, 4);
-                            // 末尾を保持
-                            if(intval($old_key."1231") < intval($ey.$em.$ed)){
-                                $date = $old_key."-12-31";
-                            } else {
-                                $date = $ey."-".$em."-".$ed;
-                            }
-                        } else {
-                            // else
-                            continue;
-                        }
-                        
-                        if(strlen($old_key) == 0){
-                            // 初回のみ
-                            $old_key = $now_key;
-                            $date = $line[0];
-                        } else if($old_key != $now_key){
-                            // 合計するキーが変わった場合、前の情報を格納して初期化
-                            array_push($log_per_date, array('day'=>$date, 'day2'=> $old_key, 'cnt'=>$cnt));
-                            // cntの最大値を保持
-                            if($width_max < intval($cnt)){
-                                $width_max = intval($cnt);
-                            }
-                            $old_key = $now_key;
-                            $date = $line[0];
-                            $cnt = 0;
-                        }
-                        
-                        // cntを合計
-                        $cnt += intval($line[intval($this->type_log+1)]);
-                        
-                        //$tmp = explode("-", $line[0]);
-                        //$su_db = mktime(0,0,0,$tmp[1],$tmp[2]+1,$tmp[0]);
-                        $query = "SELECT DATE_ADD('".$line[0]."', INTERVAL 1 DAY) AS str_date;";
-                        $result = $this->Db->execute($query);
-                        if($result === false || count($result) != 1){
-                            return false;
-                        }
-                        $su_db = $result[0]['str_date'];
-                        if(intval($ey.$em.$ed) <= intval(str_replace("-", "", $line[0]))){
-                            array_push($log_per_date, array('day'=>$date, 'day2'=> $now_key, 'cnt'=>$cnt));
-                            // cntの最大値を保持
-                            if($width_max < intval($cnt)){
-                                $width_max = intval($cnt);
-                            }
-                            $lastDateFlag = true;
-                            // Excess period
-                            break;
-                        }
-                    }
-                }
-                if(!$lastDateFlag){
-                    array_push($log_per_date, array('day'=>$date, 'day2'=> $now_key, 'cnt'=>$cnt));
-                    // cntの最大値を保持
-                    if($width_max < intval($cnt)){
-                       $width_max = intval($cnt);
-                    }
-                }
-                fclose($fp);
-            }
-        }
-        
-        // ------------------------------------------
-        // make between dates
-        // ------------------------------------------
-        $query = "DROP TEMPORARY TABLE IF EXISTS ".DATABASE_PREFIX."repository_date ";
-        $ret = $this->Db->execute($query);
-        if($ret === false){
-            return "";
-        }
-        $query = "CREATE TEMPORARY TABLE ".DATABASE_PREFIX."repository_date ( ".
-                "  `day` VARCHAR(23) ".
-                " ) ";
-        $ret = $this->Db->execute($query);
-        if($ret === false){
-            exit();
-        }
+        // create custom report data
+        $customReport->execute();
         
-        //$su = mktime(0,0,0,$sm,$sd,$sy);
-        //$eu = mktime(0,0,0,$em,$ed,$ey);
-        // second per day
-        //$sec = 60 * 60 * 24; // 60[s] * 60[m] * 24[h]
-        // get date
+        $items = $customReport->getCustomReportData();
         
-        $date_query = "SELECT DATEDIFF('".$e_date."', '".$su_db."') AS date_diff;";
-        $result = $this->Db->execute($date_query);
-        if($result === false || count($result) != 1){
-            return false;
-        }
-        $diff = $result[0]['date_diff'];
-        
-//      for ( $i = $su_db;$i <= $eu;$i += $sec ) {
-//          //array_push($dates, date("Y-m-d", $i));
-//          if($i != $su_db){
-//              $query .= " , ";
-//          }
-//          $query .= " ( '".date("Y-m-d", $i)."' ) ";
-//      }
+        $this->smartyAssign = $this->Session->getParameter("smartyAssign");
+        $this->repositoryDownload = new RepositoryDownload();
         
-        if($diff > 0){
-            $query = " INSERT INTO ".DATABASE_PREFIX."repository_date VALUES ";
-            for ($i=0;$i<=$diff;$i++) {
-                if($i != 0){
-                    $query .= " , ";
-                }
-                $date_query = "SELECT DATE_ADD('".$su_db."', INTERVAL ".$i." DAY) AS str_date;";
-                $result = $this->Db->execute($date_query);
-                if($result === false || count($result) != 1){
-                    return false;
-                }
-                $query .= " ( '".$result[0]['str_date']."' ) ";
-            }
-            $ret = $this->Db->execute($query);
-            if($ret === false){
-                exit();
-            }
-        }
-        $every="";
-        $query="";
-        switch ( $this->per_log ) {
-            case 1:
-                // per day
-                $every = $this->smartyAssign->getLang("repository_log_one_day");
-                $query = "SELECT t1.day, t2.cnt ".
-                        " FROM ". DATABASE_PREFIX ."repository_date AS t1 ".
-                        " LEFT JOIN ( ".
-                        "   SELECT CAST( log.record_date AS DATE ) AS d1, count(*) AS cnt ";
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-                if($this->type_log == 2){
-                    $query .= "  FROM (".
-                              "      SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
-                              "       ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
-                              "      FROM ". DATABASE_PREFIX ."repository_log".
-                              "      WHERE operation_id=".$this->type_log." ) AS log";
-                } else {
-                    $query .= "   FROM ".DATABASE_PREFIX ."repository_log AS log ";
-                }
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
-                $query .= "     WHERE log.record_date >= '$sy-$sm-$sd 00:00:00.000' ".
-                          "     AND log.record_date <= '$ey-$em-$ed 23:59:99.999' ".
-                          "     AND log.operation_id = '".$this->type_log."' ".
-                            $this->log_exception.
-                            $this->robots_exclusion.
-                          "     GROUP BY d1 ". 
-                          " ) AS t2 ON ( t1.day = t2.d1 ) ";
-                $ret = $this->Db->execute($query." WHERE cnt IS NOT NULL ORDER BY cnt DESC LIMIT 0 , 1 ");
-                if($width_max < intval($ret[0]['cnt'])){
-                    $width_max = intval($ret[0]['cnt']);
-                }
-                $query .= " ORDER BY t1.day ";
-                break;
-            case 2:
-                // per week
-                $every = $this->smartyAssign->getLang("repository_log_one_week");
-                $query = "SELECT t1.day, t1.day2, t2.cnt ".
-                        " FROM ( ".
-                        "   SELECT `day`, YEARWEEK( CAST( `day` AS DATE ) )  AS day2 ".
-                        "   FROM ( ".
-                        "       SELECT * FROM ".DATABASE_PREFIX ."repository_date ".
-                        "       ORDER BY `day` ASC ".
-                        "   ) AS t3 ".
-                        "   GROUP BY `day2` ".
-                        " ) AS t1 ".
-                        " LEFT JOIN ( ".
-                        "   SELECT YEARWEEK( CAST( `record_date` AS DATE ) ) AS d1, count(*) AS cnt ";
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-                if($this->type_log == 2){
-                    $query .= "  FROM (".
-                              "      SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
-                              "       ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
-                              "      FROM ". DATABASE_PREFIX ."repository_log".
-                              "      WHERE operation_id=".$this->type_log." ) AS log";
-                } else {
-                    $query .= "   FROM ".DATABASE_PREFIX ."repository_log AS log ";
-                }
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
-                $query .= "     WHERE log.record_date >= '$sy-$sm-$sd 00:00:00.000' ".
-                        "   AND log.record_date <= '$ey-$em-$ed 23:59:99.999' ".
-                        "   AND log.operation_id = '".$this->type_log."' ".
-                            $this->log_exception.
-                            $this->robots_exclusion.
-                        "   GROUP BY d1 ". 
-                        " ) AS t2 ON ( t1.day2 = t2.d1 ) ";
-                $ret = $this->Db->execute($query." WHERE cnt IS NOT NULL ORDER BY cnt DESC LIMIT 0 , 1 ");
-                if($width_max < intval($ret[0]['cnt'])){
-                    $width_max = intval($ret[0]['cnt']);
-                }
-                $query .= " ORDER BY t1.day ";
+        switch($this->per_log)
+        {
+            case self::PER_LOG_DAY:
+            case self::PER_LOG_WEEK:
+            case self::PER_LOG_MONTH:
+            case self::PER_LOG_YEAR:
+                $this->createPerDateData($items);
                 break;
-            case 3:
-                // per month
-                $every = $this->smartyAssign->getLang("repository_log_one_month");
-                $query = "SELECT t1.day, t1.day2, t2.cnt ".
-                        " FROM ( ".
-                        "   SELECT `day`, SUBSTRING(CAST( day AS DATE), 1, 7) AS day2 ".
-                        "   FROM ( ".
-                        "       SELECT * FROM ".DATABASE_PREFIX ."repository_date ".
-                        "       ORDER BY `day` DESC ".
-                        "   ) AS t3 ".
-                        "   GROUP BY `day2` ".
-                        " ) AS t1 ".
-                        " LEFT JOIN ( ".
-                        "   SELECT SUBSTRING(CAST(log.record_date AS DATE), 1, 7) AS d1, count(*) AS cnt ";
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-                if($this->type_log == 2){
-                    $query .= "  FROM (".
-                              "      SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
-                              "       ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
-                              "      FROM ". DATABASE_PREFIX ."repository_log".
-                              "      WHERE operation_id=".$this->type_log." ) AS log";
-                } else {
-                    $query .= "   FROM ".DATABASE_PREFIX ."repository_log AS log ";
-                }
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
-                $query .= "     WHERE record_date >= '$sy-$sm-$sd 00:00:00.000' ".
-                          "     AND record_date <= '$ey-$em-$ed 23:59:99.999' ".
-                          "     AND log.operation_id = '".$this->type_log."' ".
-                                $this->log_exception.
-                                $this->robots_exclusion.
-                          "     GROUP BY d1 ". 
-                          " ) AS t2 ON ( t1.day2 = t2.d1 ) ";
-                $ret = $this->Db->execute($query." WHERE cnt IS NOT NULL ORDER BY cnt DESC LIMIT 0 , 1 ");
-                if(count($ret) > 0 && $width_max < intval($ret[0]['cnt'])){
-                    $width_max = intval($ret[0]['cnt']);
-                }
-                $query .= " ORDER BY t1.day2 ";
+            case self::PER_LOG_HOST:
+                $this->createPerHostData($items);
                 break;
-            case 4:
-                // per year
-                $every = $this->smartyAssign->getLang("repository_log_one_year");
-                $query = "SELECT t1.day, t1.day2, t2.cnt ".
-                        " FROM ( ".
-                        "   SELECT `day`, SUBSTRING(CAST( day AS DATE), 1, 4) AS day2 ".
-                        "   FROM ( ".
-                        "       SELECT * FROM ".DATABASE_PREFIX ."repository_date ".
-                        "       ORDER BY `day` DESC ".
-                        "   ) AS t3 ".
-                        "   GROUP BY `day2` ".
-                        " ) AS t1 ".
-                        " LEFT JOIN ( ".
-                        "   SELECT SUBSTRING(CAST(log.record_date AS DATE), 1, 4) AS d1, count(*) AS cnt ";
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-                if($this->type_log == 2){
-                    $query .= "  FROM (".
-                              "      SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
-                              "       ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
-                              "      FROM ". DATABASE_PREFIX ."repository_log".
-                              "      WHERE operation_id=".$this->type_log." ) AS log";
-                } else {
-                    $query .= "   FROM ".DATABASE_PREFIX ."repository_log AS log ";
-                }
-                // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
-                $query .= "     WHERE record_date >= '$sy-$sm-$sd 00:00:00.000' ".
-                        "   AND record_date <= '$ey-$em-$ed 23:59:99.999' ".
-                        "   AND log.operation_id = '".$this->type_log."' ".
-                            $this->log_exception.
-                            $this->robots_exclusion.
-                        "   GROUP BY d1 ". 
-                        " ) AS t2 ON ( t1.day2 = t2.d1 ) ";
-                $ret = $this->Db->execute($query." WHERE cnt IS NOT NULL ORDER BY cnt DESC LIMIT 0 , 1 ");
-                if($width_max < intval($ret[0]['cnt'])){
-                    $width_max = intval($ret[0]['cnt']);
-                }
-                $query .= " ORDER BY t1.day2 ";
+            case self::PER_LOG_ITEM:
+                $this->createPerItemData($items);
                 break;
             default:
+                $this->warnLog("input is invalid", __FILE__, __CLASS__, __LINE__);
                 break;
         }
         
-        $items = $this->Db->execute($query);
-        $query = "DROP TEMPORARY TABLE IF EXISTS ".DATABASE_PREFIX."repository_date ";
-        $ret = $this->Db->execute($query);
-        if($ret === false){
-            return "";
-        }
+        $this->exitFlag = true;
         
-        // items merge log_per_date
-//      print_r($log_per_date);
-//      echo "<br/><br/>";
-//      print_r($items);
+        return "";
+    }
+
+    /**
+     * create html, csv file or tsv file by custom report
+     *
+     * @param array $items
+     */
+    private function createPerDateData($items)
+    {
+        $sy = sprintf("%04d",$this->sy_log);
+        $sm = sprintf("%02d",$this->sm_log);
+        $sd = sprintf("%02d",$this->sd_log);
+        $ey = sprintf("%04d",$this->ey_log);
+        $em = sprintf("%02d",$this->em_log);
+        $ed = sprintf("%02d",$this->ed_log);
         
-        if($this->per_log == "2" || $this->per_log == "4"){
-            // per week, per year
-            if(count($log_per_date) > 0 && count($items) > 0){
-                // $log_per_dateの末尾と$itemsの先頭が同じ週または年だった場合加算
-                $log_cnt = count($log_per_date)-1;
-                if(intval($log_per_date[$log_cnt]['day2']) == intval($items[0]['day2'])){
-                    $items[0]['day'] = $log_per_date[$log_cnt]['day'];
-                    $items[0]['cnt'] += $log_per_date[$log_cnt]['cnt'];
-                    if($width_max < $items[0]['cnt']){
-                        $width_max = $items[0]['cnt'];
-                    }
-                    unset($log_per_date[$log_cnt]);
-                }
-            }
-        }
-        $items = array_merge($log_per_date, $items);
+        $width_max = $this->getMaxWidthByResult($items);
         
-        $type="";
-        switch ( $this->type_log ) {
-            case 1:
-                // insert item log
-                $type = $this->smartyAssign->getLang("repository_log_entry");
+        $every = "";
+        switch ( $this->per_log ) {
+            case self::PER_LOG_DAY:
+                $every = $this->smartyAssign->getLang("repository_log_one_day");
                 break;
-            case 2:
-                // download item log
-                $type = $this->smartyAssign->getLang("repository_log_download");
+            case self::PER_LOG_WEEK:
+                $every = $this->smartyAssign->getLang("repository_log_one_week");
                 break;
-            case 3:
-                // view item log
-                $type = $this->smartyAssign->getLang("repository_log_refer");
+            case self::PER_LOG_MONTH:
+                $every = $this->smartyAssign->getLang("repository_log_one_month");
+                break;
+            case self::PER_LOG_YEAR:
+                $every = $this->smartyAssign->getLang("repository_log_one_year");
                 break;
             default:
                 break;
         }
+    
+        $type = $this->getTypeByTypeLog();
+        $html = "";
+        $TSV = "";
+        $CSV = "";
         
         // add header 2014/3/6 R.Matsuura --start--
-        if($this->is_csv_log == 2){
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
+            // CSV
+            // 期間
+            $log_str_period = $this->smartyAssign->getLang("repository_log_period");
+            // 回数
+            $log_str_num = $this->smartyAssign->getLang("repository_log_num");
+            $CSV .= $log_str_period.",".$type.$log_str_num.self::CRLF;
+        }
+        // add header 2014/3/6 R.Matsuura --end--
+    
+        // add header 2014/3/6 R.Matsuura --start--
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
             // TSV
             // 期間
             $log_str_period = $this->smartyAssign->getLang("repository_log_period");
@@ -598,11 +210,11 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                 $period = "";
                 $cnt = intval($items[$ii]['cnt']);
                 switch ( $this->per_log ) {
-                    case 1:
+                    case self::PER_LOG_DAY:
                         // per day
                         $period = $items[$ii]['day'];
                         break;
-                    case 2:
+                    case self::PER_LOG_WEEK:
                         // per week
                         if(($ii+1) == count($items)){
                             $period = $items[$ii]['day']." - ".$ey."-".$em."-".$ed;
@@ -613,7 +225,8 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                             $query = "SELECT DATE_SUB('".$items[$ii+1]['day']."', INTERVAL 1 DAY) AS prev_week;";
                             $result = $this->Db->execute($query);
                             if($result === false || count($result) != 1){
-                                return false;
+                                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                                throw new AppException($this->Db->ErrorMsg());
                             }
                             $period = $items[$ii]['day']." - ".$result[0]['prev_week'];
                         } else {
@@ -623,12 +236,13 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                             $query = "SELECT DATE_ADD('".$items[$ii]['day']."', INTERVAL 6 DAY) AS next_week;";
                             $result = $this->Db->execute($query);
                             if($result === false || count($result) != 1){
-                                return false;
+                                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                                throw new AppException($this->Db->ErrorMsg());
                             }
                             $period = $items[$ii]['day']." - ".$result[0]['next_week'];
                         }
                         break;
-                    case 3:
+                    case self::PER_LOG_MONTH:
                         // per month
                         if($ii == 0){
                             $period = $sy."-".$sm."-".$sd." - ".$items[$ii]['day'];
@@ -636,7 +250,7 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                             $period = $items[$ii]['day2']."-01"." - ".$items[$ii]['day'];
                         }
                         break;
-                    case 4:
+                    case self::PER_LOG_YEAR:
                         // per year
                         if($ii == 0){
                             $period = $sy."-".$sm."-".$sd." - ".$items[$ii]['day'];
@@ -647,10 +261,10 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                     default:
                         break;
                 }
-                if($this->is_csv_log == 1){
+                if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
                     // CSV
                     $CSV = $CSV."\"".$period."\",\"".$cnt."\"".self::CRLF;
-                } else if($this->is_csv_log == 2){
+                } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
                     // TSV
                     $TSV = $TSV."\"".$period."\"\t\"".$cnt."\"".self::CRLF;
                 } else {
@@ -677,13 +291,13 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             $html .= '</tr>';
         }
 
-        if($this->is_csv_log == 1){
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
             // CSV
             // download
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
             $this->repositoryDownload->download(pack('C*',0xEF,0xBB,0xBF).$CSV, "log.csv", "text/csv");
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
-        } else if($this->is_csv_log == 2){
+        } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
             // TSV
             // download
             $this->repositoryDownload->download(pack('C*',0xEF,0xBB,0xBF).$TSV, "log.tsv", "text/tab-separated-values");
@@ -716,168 +330,80 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
         }
     }
-
+    
     /**
-     * view item log per item
+     * create html, csv file or tsv file by custom report
      *
+     * @param array $items
      */
-    function getPerItem()
+    private function createPerItemData($items)
     {
+        $width_max = $this->getMaxWidthByResult($items);
+        $html = "";
         $CSV = "";
         $TSV = "";
-        $html = "";
-        // ------------------------------------------
-        // set log start - end date
-        // ------------------------------------------
-        $sy = sprintf("%04d",$this->sy_log);
-        $sm = sprintf("%02d",$this->sm_log);
-        $sd = sprintf("%02d",$this->sd_log);
-        $ey = sprintf("%04d",$this->ey_log);
-        $em = sprintf("%02d",$this->em_log);
-        $ed = sprintf("%02d",$this->ed_log);
-        
-        // ------------------------------------------
-        // set log start - end date
-        // ------------------------------------------
-        $sy = sprintf("%04d",$this->sy_log);
-        $sm = sprintf("%02d",$this->sm_log);
-        $sd = sprintf("%02d",$this->sd_log);
-        $ey = sprintf("%04d",$this->ey_log);
-        $em = sprintf("%02d",$this->em_log);
-        $ed = sprintf("%02d",$this->ed_log);
-        
-//      $su = mktime(0,0,0,$sm,$sd,$sy);
-//      $eu = mktime(0,0,0,$em,$ed,$ey);
-//      // second per day
-//      $sec = 60 * 60 * 24; // 60[s] * 60[m] * 24[h]
-        // get date
-        $date_list = array();
-//      for ( $i = $su;$i <= $eu;$i += $sec ) {
-//          array_push($date_list, date("Y-m-d", $i));
-//      }
         
-        $s_date = $sy."-".$sm."-".$sd;
-        $e_date = $ey."-".$em."-".$ed;
-        $query = "SELECT DATEDIFF('".$e_date."', '".$s_date."') AS date_diff;";
-        $result = $this->Db->execute($query);
-        if($result === false || count($result) != 1){
-            return false;
-        }
-        $diff = $result[0]['date_diff'];
-        for ($i=0;$i<=$diff;$i++) {
-            $query = "SELECT DATE_ADD('".$s_date."', INTERVAL ".$i." DAY) AS str_date;";
-            $result = $this->Db->execute($query);
-            if($result === false || count($result) != 1){
-                return false;
-            }
-            array_push($date_list, $result[0]['str_date']);
-        }
+        $tmpDate = str_replace(" ", "", $this->accessDate);
+        $tmpDate = str_replace(":", "", $tmpDate);
+        $tmpDate = str_replace(".", "", $tmpDate);
         
-        $this->TransStartDate = str_replace(" ", "", $this->TransStartDate);
-        $this->TransStartDate = str_replace(":", "", $this->TransStartDate);
-        $this->TransStartDate = str_replace(".", "", $this->TransStartDate);
-        $query = "CREATE TEMPORARY TABLE `".DATABASE_PREFIX."repository_log_".$this->TransStartDate."` ( ".
-                " item_id INT, item_no INT, cnt INT default 0, ".
-                " PRIMARY KEY(`item_id`, `item_no`) ".
-                " ); ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return false;
-        }
-        
-        // ------------------------------------------
-        // make log from log table
-        // ------------------------------------------
-        $query=" INSERT INTO `".DATABASE_PREFIX."repository_log_".$this->TransStartDate."` ".
-                " SELECT log.item_id, log.item_no, count(*) AS cnt ";
-        // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-        if($this->type_log == 2){
-            $query .= "  FROM (".
-                      "   SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
-                      "    ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent".
-                      "   FROM ". DATABASE_PREFIX ."repository_log".
-                      "   WHERE operation_id=".$this->type_log." ) AS log";
-        } else {
-            $query .= "   FROM ".DATABASE_PREFIX ."repository_log AS log ";
-        }
-        // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
-        $query .= " WHERE log.record_date >= '$sy-$sm-$sd 00:00:00.000' ". 
-                  " AND log.record_date <= '$ey-$em-$ed 23:59:99.999' ".
-                  " AND log.operation_id='$this->type_log' ".
-                  $this->log_exception.
-                  $this->robots_exclusion.
-                  " GROUP BY item_id, item_no ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return false;
-        }
-        
-        // ------------------------------------------
-        // read log file per item
-        // ------------------------------------------
-        $width_max = 0;
-        $log_per_item = array();
-        $year = $sy;
-        $month = $sm;
-        while(intval($year.$month) <= intval($ey.$em)){
-            if(file_exists(WEBAPP_DIR."/logs/weko/logfile/log_per_item_$year$month.txt")){
-                $fp = fopen(WEBAPP_DIR."/logs/weko/logfile/log_per_item_$year$month.txt", "r");
-                while(!feof($fp)){
-                    // read line
-                    // record_date  item_id item_no download_count  view_count
-                    $file_line = fgets($fp);
-                    $file_line = str_replace("\r\n", "", $file_line);
-                    $file_line = str_replace("\n", "", $file_line);
-                    $line = split("\t", $file_line);
-                    if(in_array($line[0], $date_list)){
-                        $item_id = split("-", $line[1]);
-                        $query = " INSERT INTO `".DATABASE_PREFIX."repository_log_".$this->TransStartDate."` VALUES ".
-                                " ('".$item_id[0]."', '".$item_id[1]."', '".$line[$this->type_log]."') ".
-                                " ON DUPLICATE KEY UPDATE ".
-                                " cnt = cnt + ".intval($line[$this->type_log])." ; ";
-                        $result = $this->Db->execute($query);
-                        if($result === false){
-                            return false;
-                        }
-                    }
-                }
-                fclose($fp);
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
+            // CSV
+            $csv_file = WEBAPP_DIR."/uploads/repository/log_result_".$tmpDate.".csv";
+            $csv_fp = fopen($csv_file, "w");
+            // add header 2014/3/6 R.Matsuura --start--
+            $type="";
+            switch ( $this->type_log ) {
+                case self::TYPE_LOG_DOWNLOAD:
+                    // download item log
+                    $type = $this->smartyAssign->getLang("repository_log_download");
+                    break;
+                case self::TYPE_LOG_VIEW:
+                    // view item log
+                    $type = $this->smartyAssign->getLang("repository_log_refer");
+                    break;
+                default:
+                    break;
             }
-            //$date = mktime(0,0,0,$month+1,1,$year);
-            //$year = date("Y", $date);
-            //$month = date("m", $date);
-            
-            $query = "SELECT DATE_FORMAT(DATE_ADD('".$year."-".$month."-01', INTERVAL 1 MONTH), '%Y') AS tmp_year,".
-                     " DATE_FORMAT(DATE_ADD('".$year."-".$month."-01', INTERVAL 1 MONTH), '%m') AS tmp_month;";
-            $result = $this->Db->execute($query);
-            if($result === false || count($result) != 1){
-                return false;
+            // アイテムID
+            $log_str_itemid = $this->smartyAssign->getLang("repository_log_itemid");
+            // アイテム名
+            $log_str_itemname = $this->smartyAssign->getLang("repository_log_itemname");
+            // 回数
+            $log_str_num = $this->smartyAssign->getLang("repository_log_num");
+            $CSV .= $log_str_itemid.",".$log_str_itemname.",".$type.$log_str_num.self::CRLF;
+            fwrite($csv_fp, $CSV);
+            // add header 2014/3/6 R.Matsuura --end--
+        } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
+            // TSV
+            $tsv_file = WEBAPP_DIR."/uploads/repository/log_result_".$tmpDate.".tsv";
+            $tsv_fp = fopen($tsv_file, "w");
+            // add header 2014/3/6 R.Matsuura --start--
+            $type="";
+            switch ( $this->type_log ) {
+                case self::TYPE_LOG_DOWNLOAD:
+                    // download item log
+                    $type = $this->smartyAssign->getLang("repository_log_download");
+                    break;
+                case self::TYPE_LOG_VIEW:
+                    // view item log
+                    $type = $this->smartyAssign->getLang("repository_log_refer");
+                    break;
+                default:
+                    break;
             }
-            $year = $result[0]['tmp_year'];
-            $month = $result[0]['tmp_month'];
-        }
-        
-        /* Mod add item_id to custom report 2012/8/17 Tatsuya.Koyasu -start- */
-        $sqlCmd=" SELECT log.item_id, item.title, item.title_english, cnt ".
-                " FROM `".DATABASE_PREFIX."repository_log_".$this->TransStartDate."` AS log, ".DATABASE_PREFIX."repository_item AS item ". 
-                " WHERE log.item_id = item.item_id ".
-                " AND log.item_no = item.item_no ".
-                " AND cnt > 0 ". 
-                " ORDER BY cnt DESC, log.item_id ASC ";
-        /* Mod add item_id to custom report 2012/8/17 Tatsuya.Koyasu -start- */
-        $items = $this->Db->execute($sqlCmd);
-        if($result === false){
-            return false;
-        }
-        
-        $query = "DROP TEMPORARY TABLE `".DATABASE_PREFIX."repository_log_".$this->TransStartDate."` ;";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return false;
+            // アイテムID
+            $log_str_itemid = $this->smartyAssign->getLang("repository_log_itemid");
+            // アイテム名
+            $log_str_itemname = $this->smartyAssign->getLang("repository_log_itemname");
+            // 回数
+            $log_str_num = $this->smartyAssign->getLang("repository_log_num");
+            $TSV .= $log_str_itemid."\t".$log_str_itemname."\t".$type.$log_str_num.self::CRLF;
+            fwrite($tsv_fp, $TSV);
+            // add header 2014/3/6 R.Matsuura --end--
         }
-                
+
         if (count($items)>0) {
-            $width_max = $items[0]['cnt'];
             for ( $ii=0; $ii<count($items) && $width_max>0; $ii++ )
             {
                 $title = "";
@@ -894,46 +420,13 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                         $title = $items[$ii]['title'];
                     }
                 }
-                if($this->is_csv_log == 1){
+                if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
                     // CSV
-                    if(strlen($CSV) == 0){
-                        $csv_file = WEBAPP_DIR."/uploads/repository/log_result_".$this->TransStartDate.".csv";
-                        $csv_fp = fopen($csv_file, "w");
-                    }
-                    $CSV = "true";
                     /* Mod add item_id to custom report 2012/8/17 Tatsuya.Koyasu -start- */
                     fwrite($csv_fp, "\"".$items[$ii]['item_id']."\",\"".$title."\",\"".$items[$ii]['cnt']."\"".self::CRLF);
                     /* Mod add item_id to custom report 2012/8/17 Tatsuya.Koyasu -end- */
-                } else if($this->is_csv_log == 2){
+                } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
                     // TSV
-                    if(strlen($TSV) == 0){
-                        $tsv_file = WEBAPP_DIR."/uploads/repository/log_result_".$this->TransStartDate.".tsv";
-                        $tsv_fp = fopen($tsv_file, "w");
-                        // add header 2014/3/6 R.Matsuura --start--
-                        $type="";
-                        switch ( $this->type_log ) {
-                            case 2:
-                                // download item log
-                                $type = $this->smartyAssign->getLang("repository_log_download");
-                                break;
-                            case 3:
-                                // view item log
-                                $type = $this->smartyAssign->getLang("repository_log_refer");
-                                break;
-                            default:
-                                break;
-                        }
-                        // アイテムID
-                        $log_str_itemid = $this->smartyAssign->getLang("repository_log_itemid");
-                        // アイテム名
-                        $log_str_itemname = $this->smartyAssign->getLang("repository_log_itemname");
-                        // 回数
-                        $log_str_num = $this->smartyAssign->getLang("repository_log_num");
-                        $TSV .= $log_str_itemid."\t".$log_str_itemname."\t".$type.$log_str_num.self::CRLF;
-                        fwrite($tsv_fp, $TSV);
-                        // add header 2014/3/6 R.Matsuura --end--
-                    }
-                    $TSV = "true";
                     /* Mod add item_id to custom report 2012/8/17 Tatsuya.Koyasu -start- */
                     fwrite($tsv_fp, "\"".$items[$ii]['item_id']."\"\t\"".$title."\"\t\"".$items[$ii]['cnt']."\"".self::CRLF);
                     /* Mod add item_id to custom report 2012/8/17 Tatsuya.Koyasu -end- */
@@ -956,7 +449,7 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             $html .= '<td colspan=5 class="al">'.$this->smartyAssign->getLang("repository_log_nodata").'</td>';
             $html .= '</tr>';
         }
-        if($this->is_csv_log == 1){
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
             // CSV
             fclose($csv_fp);
             $fp = fopen( $csv_file, "rb" );
@@ -966,8 +459,8 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             $this->repositoryDownload->download(pack('C*',0xEF,0xBB,0xBF).$file, "log.csv", "text/csv");
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
             // delet CSV file
-            unlink($csv_fp);
-        } else if($this->is_csv_log == 2){
+            unlink($csv_file);
+        } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
             // TSV
             fclose($tsv_fp);
             $fp = fopen( $tsv_file, "rb" );
@@ -975,7 +468,7 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             fclose($fp);
             $this->repositoryDownload->download(pack('C*',0xEF,0xBB,0xBF).$file, "log.tsv", "text/tab-separated-values");
             // delet TSV file
-            unlink($tsv_fp);
+            unlink($tsv_file);
         } else {
             $html_tmp = $html;
             $html = "";
@@ -983,19 +476,19 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             $html .= '<div class="paging ofx_auto ofy_hidden pd02" id="print_area_repos">';
             $html .= '<table class="tb_repos text_color full">';
             $html .= '<tr><th colspan="3" style="text-align: left;"><div class="th_repos_title_bar text_color mb10">';
-            if($this->type_log == 2){
+            if($this->type_log == self::TYPE_LOG_DOWNLOAD){
                 $html .= $this->smartyAssign->getLang("repository_log_item_download");
-            } else if($this->type_log == 3){
+            } else if($this->type_log == self::TYPE_LOG_VIEW){
                 $html .= $this->smartyAssign->getLang("repository_log_item_view");
             }
             $html .= '</div></th></tr>';
             $html .= '<tr>';
             $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_log_itemname").'</th>';
             $html .= '<th class="th_col_repos ac" colspan="2">';
-            if($this->type_log == 2){
-                $html .= $this->smartyAssign->getLang("repository_log_num_download");
-            } else if($this->type_log == 3){
-                $html .= $this->smartyAssign->getLang("repository_log_num_refer");
+            if($this->type_log == self::TYPE_LOG_DOWNLOAD){
+                $html .= $this->smartyAssign->getLang("repository_log_download").$this->smartyAssign->getLang("repository_log_num");
+            } else if($this->type_log == self::TYPE_LOG_VIEW){
+                $html .= $this->smartyAssign->getLang("repository_log_refer").$this->smartyAssign->getLang("repository_log_num");
             }
             $html .= '</th>';
             $html .= '</tr>';
@@ -1012,80 +505,40 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
         }
     }
-
-    // Add lang resource 2008/11/27 Y.Nakao --end--
-
-    // Add host log 2010/02/28 Y.Nakao --start--
+    
     /**
-     * insert, download, view log result per Host format HTML
+     * create html, csv file or tsv file by custom report
      *
+     * @param array $items
      */
-    function getPerHost()
+    private function createPerHostData($items)
     {
-        $CSV = "";
-        $TSV = "";
+        $width_max = $this->getMaxWidthByResult($items);
         $html = "";
         $html_all = "";
-        $cnt_all_host = 0;
-        $cnt_host = 0;
-        // ------------------------------------------
-        // set log start - end date
-        // ------------------------------------------
-        $sy = sprintf("%04d",$this->sy_log);
-        $sm = sprintf("%02d",$this->sm_log);
-        $sd = sprintf("%02d",$this->sd_log);
-        $ey = sprintf("%04d",$this->ey_log);
-        $em = sprintf("%02d",$this->em_log);
-        $ed = sprintf("%02d",$this->ed_log);
-        
-//      $su = mktime(0,0,0,$sm,$sd,$sy);
-//      $eu = mktime(0,0,0,$em,$ed,$ey);
-//      // second per day
-//      $sec = 60 * 60 * 24; // 60[s] * 60[m] * 24[h]
-        // get date
-        $date_list = array();
-//      for ( $i = $su;$i <= $eu;$i += $sec ) {
-//          array_push($date_list, date("Y-m-d", $i));
-//      }
-        
-        $s_date = $sy."-".$sm."-".$sd;
-        $e_date = $ey."-".$em."-".$ed;
-        $query = "SELECT DATEDIFF('".$e_date."', '".$s_date."') AS date_diff;";
-        $result = $this->Db->execute($query);
-        if($result === false || count($result) != 1){
-            return false;
-        }
-        $diff = $result[0]['date_diff'];
-        for ($i=0;$i<=$diff;$i++) {
-            $query = "SELECT DATE_ADD('".$s_date."', INTERVAL ".$i." DAY) AS str_date;";
-            $result = $this->Db->execute($query);
-            if($result === false || count($result) != 1){
-                return false;
-            }
-            array_push($date_list, $result[0]['str_date']);
-        }
+        $CSV = "";
+        $TSV = "";
         
         // ------------------------------------------
         // set log result type lang resource
         // ------------------------------------------
-        switch ( $this->type_log ) {
-            case 1:
-                // insert item log
-                $type = $this->smartyAssign->getLang("repository_log_entry");
-                break;
-            case 2:
-                // download item log
-                $type = $this->smartyAssign->getLang("repository_log_download");
-                break;
-            case 3:
-                // view item log
-                $type = $this->smartyAssign->getLang("repository_log_refer");
-                break;
-            default:break;
+        $type = $this->getTypeByTypeLog();
+        
+        // add header 2014/3/6 R.Matsuura --start--
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
+            // CSV
+            // ホスト
+            $log_str_host = $this->smartyAssign->getLang("repository_log_host");
+            // IPアドレス
+            $log_str_idaddress = $this->smartyAssign->getLang("repository_log_ip_address");
+            // 回数
+            $log_str_num = $this->smartyAssign->getLang("repository_log_num");
+            $CSV .= $log_str_host.",".$log_str_idaddress.",".$type.$log_str_num.self::CRLF;
         }
+        // add header 2014/3/6 R.Matsuura --end--
         
         // add header 2014/3/6 R.Matsuura --start--
-        if($this->is_csv_log == 2){
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
             // TSV
             // ホスト
             $log_str_host = $this->smartyAssign->getLang("repository_log_host");
@@ -1097,160 +550,39 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
         }
         // add header 2014/3/6 R.Matsuura --end--
         
-        // ------------------------------------------
-        // read log file per host
-        // ------------------------------------------
-        $width_max = 0;
-        $log_per_host = array();
-        $year = $sy;
-        $month = $sm;
-        while(intval($year.$month) <= intval($ey.$em)){
-            if(file_exists(WEBAPP_DIR."/logs/weko/logfile/log_per_host_$year$month.txt")){
-                $fp = fopen(WEBAPP_DIR."/logs/weko/logfile/log_per_host_$year$month.txt", "r");
-                while(!feof($fp)){
-                    // read line
-                    // record_date  ip_address  host    item_count  download_count  view_count
-                    $file_line = fgets($fp);
-                    $file_line = str_replace("\r\n", "", $file_line);
-                    $file_line = str_replace("\n", "", $file_line);
-                    $line = split("\t", $file_line);
-                    if(in_array($line[0], $date_list)){
-                        if(array_key_exists($line[1], $log_per_host)){
-                            $log_per_host[$line[1]]['cnt'] += $line[intval($this->type_log+2)];
-                        } else if(intval($line[intval($this->type_log+2)]) > 0){
-                            $log_per_host[$line[1]] = array();
-                            $log_per_host[$line[1]]['host'] = $line[2];
-                            $log_per_host[$line[1]]['ip_address'] = $line[1];
-                            $log_per_host[$line[1]]['cnt'] += $line[intval($this->type_log+2)];
-                        }
-                    }
-                }
-                fclose($fp);
-            }
-            //$date = mktime(0,0,0,$month+1,1,$year);
-            //$year = date("Y", $date);
-            //$month = date("m", $date);
-            
-            $query = "SELECT DATE_FORMAT(DATE_ADD('".$year."-".$month."-01', INTERVAL 1 MONTH), '%Y') AS tmp_year,".
-                     " DATE_FORMAT(DATE_ADD('".$year."-".$month."-01', INTERVAL 1 MONTH), '%m') AS tmp_month;";
-            $result = $this->Db->execute($query);
-            if($result === false || count($result) != 1){
-                return false;
-            }
-            $year = $result[0]['tmp_year'];
-            $month = $result[0]['tmp_month'];
-        }
-
-        // ------------------------------------------
-        // get item download log per item
-        // ------------------------------------------
-        $sqlCmd = "SELECT host, ip_address, count(*) AS cnt ";
-        // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-        if($this->type_log == 2){
-            $sqlCmd .= "  FROM (".
-                       "      SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,".
-                       "       ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent, host".
-                       "      FROM ". DATABASE_PREFIX ."repository_log".
-                       "      WHERE operation_id=".$this->type_log." ) AS log";
-        } else {
-            $sqlCmd .= "   FROM ".DATABASE_PREFIX ."repository_log AS log ";
-        }
-        // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --end-- 
-        $sqlCmd .= " WHERE log.record_date >= '$sy-$sm-$sd 00:00:00.000' ". 
-                   " AND log.record_date <= '$ey-$em-$ed 23:59:99.999' ".
-                   " AND log.operation_id='$this->type_log' ".
-        //$this->log_exception.
-                   $this->robots_exclusion.
-                   " GROUP BY ip_address ".
-                   " ORDER BY cnt DESC , ip_address ASC; ";
-        $items = $this->Db->execute($sqlCmd);
-        
-//      print_r($log_per_host);
-//      echo "<br/><br/>";
-//      print_r($items);
-        
-        // マージ
-        for($ii=0; $ii<count($items);$ii++){
-            if(array_key_exists($items[$ii]['ip_address'], $log_per_host)){
-                $log_per_host[$items[$ii]['ip_address']]['cnt'] += $items[$ii]['cnt'];
-            } else {
-                $log_per_host[$items[$ii]['ip_address']]['ip_address'] = $items[$ii]['ip_address'];
-                $log_per_host[$items[$ii]['ip_address']]['host'] = $items[$ii]['host'];
-                $log_per_host[$items[$ii]['ip_address']]['cnt'] = $items[$ii]['cnt'];
-            }
-        }
-        
-        // ソート
-        $items = array();
-        foreach ($log_per_host as $ip => $val){
-            array_push($items, $val);
-            for($ii=count($items)-1;$ii>0;$ii--){
-                if(intval($items[$ii-1]['cnt']) < intval($items[$ii]['cnt'])){
-                    $tmp = $items[$ii-1];
-                    $items[$ii-1] = $items[$ii];
-                    $items[$ii] = $tmp;
-                } else {
-                    break;
-                }
-            }
+        // get exclude ip address list
+        $query = "SELECT param_value ". 
+                 " FROM ". DATABASE_PREFIX. "repository_parameter ". 
+                 " WHERE param_name = ?;";
+        $params = array();
+        $params[] = 'log_exclusion';
+        $result = $this->Db->execute($query, $params);
+        if($result === false)
+        {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
         }
         
-//      echo "<br/><br/>";
-//      print_r($items);
+        $cnt_host = 0;
+        $cnt_all_host = 0;
         $cnt_width = 0;
         if ( count($items)>0 ) {
             $width_max_all = $items[0]['cnt'];
-            $width_max = $items[0]['cnt'];
             $cnt_width = mb_strlen($width_max);
             for ( $ii=0; $ii<count($items) && $width_max>0; $ii++ )
             {
-                // 除外対象のホスト
-                if(is_numeric(strpos($this->log_exception, "'".$items[$ii]['ip_address']."'")) ){
-                    if($this->is_csv_log == 1){
-                        // CSV
-                        //$CSV = $CSV.$items[$ii]['host'].",".$items[$ii]['ip_address'].",".$items[$ii]['cnt']."".self::CRLF;
-                    }else if($this->is_csv_log == 2){
-                        // TSV
-                        //$TSV = $TSV.$items[$ii]['host']."\t".$items[$ii]['ip_address']."\t".$items[$ii]['cnt']."".self::CRLF;
-                    } else {
-                        // HTML
-                        $width = sprintf("%.0f",100*($items[$ii]['cnt']/$width_max_all));
-                        if($cnt_all_host%2==0){
-                            $html_all .= '<tr class="list_line_repos1">';
-                        } else {
-                            $html_all .= '<tr class="list_line_repos2">';
-                        }
-                        $html_all .= '<td class="list_paging" style="text-align: left;" ><span class="al" style="width:100px;" >'.wordwrap($items[$ii]['host'], 20, "<br />",1).'</span></td>';
-                        $html_all .= '<td class="ac">'.$items[$ii]['ip_address'].'</td>';
-                        $html_all .= '<td class="list_paging nobr" align="center">';
-                        $html_all .= '<input class="btn_white" type="button" value="'.$this->smartyAssign->getLang("repository_except")
-                            .'" onclick="javascript: ChangeHostStatus('
-                            ."'".$items[$ii]['ip_address']."'".','.'1,'. $this->type_log. ', 0, createLogErrorMsg());'.'" disabled="true" />';
-                        $html_all .= '<input class="btn_white" type="button" value="'.$this->smartyAssign->getLang("repository_release")
-                            .'" onclick="javascript: ChangeHostStatus('
-                            ."'".$items[$ii]['ip_address']."'".','.'2,'. $this->type_log. ', 0, createLogErrorMsg());'.'"/>';
-                        $html_all .= '</td>';
-                        $html_all .= '<td class="list_paging ar" style="width:'.$cnt_width.'ex;" ><span style="width:'.$cnt_width.'ex;" >'.$items[$ii]['cnt'].'</span></td>';
-                        $html_all .= '<td class="td_graph_repos list_paging" style="text-align: left;"><img src="./images/repository/default/graph_bar.gif" style="text-align: left; width: '.$width.'%; height: 10px;"></td>';
-                        $html_all .= '</tr>';
-                    }
-                    $cnt_all_host++;
-                // 除外対象でないホスト
+                if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
+                    // CSV
+                    $CSV = $CSV."\"".$items[$ii]['host']."\",\"".$items[$ii]['ip_address']."\",\"".$items[$ii]['cnt']."\"".self::CRLF;
+                } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
+                    // TSV
+                    $TSV = $TSV."\"".$items[$ii]['host']."\"\t\"".$items[$ii]['ip_address']."\"\t\"".$items[$ii]['cnt']."\"".self::CRLF;
                 } else {
-                    if($this->is_csv_log == 1){
-                        // CSV
-                        $CSV = $CSV."\"".$items[$ii]['host']."\",\"".$items[$ii]['ip_address']."\",\"".$items[$ii]['cnt']."\"".self::CRLF;
-                    } else if($this->is_csv_log == 2){
-                        // TSV
-                        $TSV = $TSV."\"".$items[$ii]['host']."\"\t\"".$items[$ii]['ip_address']."\"\t\"".$items[$ii]['cnt']."\"".self::CRLF;
-                    } else {
-                        // HTML
-                        if($cnt_host == 0 )
-                        {
-                            $width_max =  $items[$ii]['cnt'];
-                        }
-                        $width = sprintf("%.0f",100*($items[$ii]['cnt']/$width_max));
-                        if($cnt_host%2==0){
+                    $width = sprintf("%.0f",100*($items[$ii]['cnt']/$width_max));
+                    // ip address is in exclude list
+                    if(is_numeric(strpos($result[0]['param_value'], $items[$ii]['ip_address'])) === false)
+                    {
+                        if($cnt_host % 2 == 0){
                             $html .= '<tr class="list_line_repos1">';
                         } else {
                             $html .= '<tr class="list_line_repos2">';
@@ -1258,44 +590,47 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
                         $html .= '<td class="list_paging" style="text-align: left;" ><span class="al" style="width:100px" >'.wordwrap($items[$ii]['host'], 20, "<br />",1).'</span></td>';
                         $html .= '<td class="list_paging ac">'.$items[$ii]['ip_address'].'</td>';
                         $html .= '<td class="list_paging nobr" align="center">';
-                        $html .= '<input class="btn_white" type="button" value="'.$this->smartyAssign->getLang("repository_except")
-                            .'" onclick="javascript: ChangeHostStatus('
-                            ."'".$items[$ii]['ip_address']."'".','.'1,'. $this->type_log. ', 0, createLogErrorMsg());'.'"/>';
-                        $html .= '<input class="btn_white" type="button" value="'.$this->smartyAssign->getLang("repository_release")
-                            .'" onclick="javascript: ChangeHostStatus('
-                            ."'".$items[$ii]['ip_address']."'".','.'2,'. $this->type_log. ', 0, createLogErrorMsg());'.'" disabled="true" />';
+                        $html .= '<input id="check_'. $ii. '" type="checkbox" value="'. $items[$ii]['ip_address']. '"/>';
                         $html .= '</td>';
                         $html .= '<td class="list_paging ar" style="width:'.$cnt_width.'ex;" ><span style="width:'.$cnt_width.'ex;" >'.$items[$ii]['cnt'].'</span></td>';
                         //$html .= '<td class="list_paging" style="width:'.$cnt_width.'ex;">'.$items[$ii]['cnt'].'</td>';
                         $html .= '<td class="td_graph_repos list_paging" style="text-align: left;"><img src="./images/repository/default/graph_bar.gif" style="text-align: left; width: '.$width.'%; height: 10px;"></td>';
                         $html .= '</tr>';
+                    }
 
-                        // HTML (all host)
-                        $width = sprintf("%.0f",100*($items[$ii]['cnt']/$width_max_all));
-                        if($ii%2==0){
-                            $html_all .= '<tr class="list_line_repos1">';
-                        } else {
-                            $html_all .= '<tr class="list_line_repos2">';
-                        }
-                        $html_all .= '<td class="list_paging" style="text-align: left;" ><span class="al" style="width:100px" >'.wordwrap($items[$ii]['host'], 20, "<br />",1).'</span></td>';
-                        $html_all .= '<td class="list_paging ac">'.$items[$ii]['ip_address'].'</td>';
-                        $html_all .= '<td class="list_paging nobr" align="center">';
-                        $html_all .= '<input class="btn_white" type="button" value="'.$this->smartyAssign->getLang("repository_except")
-                                                    .'" onclick="javascript: ChangeHostStatus('
-                            ."'".$items[$ii]['ip_address']."'".','.'1,'. $this->type_log. ', 0, createLogErrorMsg());'.'"/>';
-                        $html_all .= '<input class="btn_white" type="button" value="'.$this->smartyAssign->getLang("repository_release")
-                                                    .'" onclick="javascript: ChangeHostStatus('
-                            ."'".$items[$ii]['ip_address']."'".','.'2,'. $this->type_log. ', 0, createLogErrorMsg());'.'" disabled="true" />';
-                        $html_all .= '</td>';
-                        $html_all .= '</td>';
-                        $html_all .= '<td class="list_paging ar" style="width:'.$cnt_width.'ex;" ><span style="width:'.$cnt_width.'ex;" >'.$items[$ii]['cnt'].'</span></td>';
-                        //$html_all .= '<td class="list_paging" style="width:'.$cnt_width.'ex;">'.$items[$ii]['cnt'].'</td>';
-                        $html_all .= '<td class="td_graph_repos list_paging" style="text-align: left;"><img src="./images/repository/default/graph_bar.gif" style="text-align: left; width: '.$width.'%; height: 10px;"></td>';
-                        $html_all .= '</tr>';
+                    // HTML (all host)
+                    $width = sprintf("%.0f",100*($items[$ii]['cnt']/$width_max_all));
+                    if($ii%2==0){
+                        $html_all .= '<tr class="list_line_repos1">';
+                    } else {
+                        $html_all .= '<tr class="list_line_repos2">';
+                    }
+                    $html_all .= '<td class="list_paging" style="text-align: left;" ><span class="al" style="width:100px" >'.wordwrap($items[$ii]['host'], 20, "<br />",1).'</span></td>';
+                    $html_all .= '<td class="list_paging ac">'.$items[$ii]['ip_address'].'</td>';
+                    $html_all .= '<td class="list_paging nobr" align="center">';
+                    $html_all .= '<input id="check_'. $ii. '" type="checkbox" value="" ';
+                    // ip address is in exclude list
+                    if(is_numeric(strpos($result[0]['param_value'], $items[$ii]['ip_address'])))
+                    {
+                        $html_all .= 'checked="true" disabled/>';
                     }
+                    else
+                    {
+                        $html_all .= ' "/>';
+                    }
+                    $html_all .= '</td>';
+                    $html_all .= '</td>';
+                    $html_all .= '<td class="list_paging ar" style="width:'.$cnt_width.'ex;" ><span style="width:'.$cnt_width.'ex;" >'.$items[$ii]['cnt'].'</span></td>';
+                    //$html_all .= '<td class="list_paging" style="width:'.$cnt_width.'ex;">'.$items[$ii]['cnt'].'</td>';
+                    $html_all .= '<td class="td_graph_repos list_paging" style="text-align: left;"><img src="./images/repository/default/graph_bar.gif" style="text-align: left; width: '.$width.'%; height: 10px;"></td>';
+                    $html_all .= '</tr>';
+                }
+                // ip address is in exclude list
+                if(is_numeric(strpos($result[0]['param_value'], $items[$ii]['ip_address'])) === false)
+                {
                     $cnt_host++;
-                    $cnt_all_host++;
                 }
+                $cnt_all_host++;
             }
         }
         else
@@ -1304,93 +639,159 @@ class Repository_Action_Edit_Log_Result extends RepositoryAction
             $html .= '<td colspan=5 class="al">'.$this->smartyAssign->getLang("repository_log_nodata").'</td>';
             $html .= '</tr>';
         }
+        
+        // no data by exclude log
+        if($cnt_host === 0)
+        {
+            $html .= '<tr class="tr_repos">';
+            $html .= '<td colspan=5 class="al">'.$this->smartyAssign->getLang("repository_log_nodata").'</td>';
+            $html .= '</tr>';
+        }
 
-        if($this->is_csv_log == 1){
+        if($this->is_csv_log == self::DOWNLOAD_TYPE_CSV){
             // CSV
             // download
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
             $this->repositoryDownload->download(pack('C*',0xEF,0xBB,0xBF).$CSV, "log.csv", "text/csv");
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
-        } else if($this->is_csv_log == 2){
+        } else if($this->is_csv_log == self::DOWNLOAD_TYPE_TSV){
             // TSV
             // download
             $this->repositoryDownload->download(pack('C*',0xEF,0xBB,0xBF).$TSV, "log.tsv", "text/tab-separated-values");
         } else {
             // HTML
-            $html_tmp = $html;
-            $html = "";
-            $html .= '<center>';
-            $html .= '<div id="print_area_repos" name="print_area_repos" class="ofx_auto ofy_hidden pd02" style="display:block;">';
-            $html .= '<table class="tb_repos text_color full">';
-            $html .= '<colgroup span="2" width="100px">';
-            $html .= '<colgroup width="160px">';
-            $html .= '<colgroup width="'.$cnt_width.'ex;">';
-            $html .= '<colgroup width="*%">';
-            //          $html .= '<tr><th colspan="5" style="text-align: left;"><div class="th_repos">';
-            $html .= '<tr><th colspan="5" style="text-align: left;"><div class="th_repos_title_bar text_color mb10">';
-            $html .= '<p class="al fl">';
-            $html .= $this->smartyAssign->getLang("repository_log_per_host").
-            $this->smartyAssign->getLang("repository_log_of").
-            $type.
-            $this->smartyAssign->getLang("repository_log_num").'</p>';
-            $html .= '<p class="ar"><a href="javascript: hostdisplayClicked()" name="host_display_all" id="host_display_all" style="text-align: left;">'.$this->smartyAssign->getLang("repository_log_host_all_show").'</a>';
-            $html .= '</p></div></th>';
-            //$html = $html.'<th class="th_col_repos" colspan="3" style="text-align: right;" >';
-            //$html = $html.'<a href="javascript: hostdisplayClicked()" name="host_display_all" id="host_display_all" style="text-align: left;">'.$this->smartyAssign->getLang("repository_log_host_all_show").'</a></th>';
-            $html .= '<tr>';
-            $html .= '<th class="th_col_repos ac" style="width:100px">'.$this->smartyAssign->getLang("repository_log_host").'</th>';
-            $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_log_ip_address").'</th>';
-            $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_except")."/".$this->smartyAssign->getLang("repository_release").'</th>';
-            $html .= '<th class="th_col_repos ac" colspan="2">'.$type.$this->smartyAssign->getLang("repository_log_num").'</th>';
-            $html .= '</tr>';
-            $html .= $html_tmp;
-            $html .= '</table>';
-            $html .= '</div>';
-            $html .= '<div class="paging" id="print_paging" name="print_paging" style="display:block;">';
-            $html .= '<a class="btn_blue white" href="javascript: printGraph_repos('."'print_area_repos'".')">'.$this->smartyAssign->getLang("repository_log_print").'</a>';
-            $html .= '</div>';
-            $html .= '</center>';
-                
+            $html = $this->createHostAccessHtml($html, $cnt_width, true, $cnt_host);
+            
             // HTML(all-host)
-            $html .= '<center>';
-            $html .= '<div id="all_print_area_repos" name="all_print_area_repos" class="ofx_auto ofy_hidden pd02" style="display:none;">';
-            $html .= '<table class="tb_repos text_color full" >';
-            $html .= '<colgroup span="2" width="100px">';
-            $html .= '<colgroup width="160px">';
-            $html .= '<colgroup width="'.$cnt_width.'ex;">';
-            $html .= '<colgroup width="*%">';
-            $html .= '<tr><th colspan="5" style="text-align: left;"><div class="th_repos_title_bar text_color mb10">';
-            $html .= '<p class="al fl">';
-            $html .= $this->smartyAssign->getLang("repository_log_per_host").
-            $this->smartyAssign->getLang("repository_log_of").$type.$this->smartyAssign->getLang("repository_log_num").'</p>';
-            $html .= '<p class="ar"><a href="javascript: hostdisplayClicked()" name="host_display" id="host_display" style="text-align: left;">';
-            $html .= $this->smartyAssign->getLang("repository_log_host_limit").'</a>';
-            $html .= '</p></div></th>';
-            //$html = $html.'<th class="th_col_repos" colspan="3" style="text-align: right;" >';
-            //$html = $html.'<a href="javascript: hostdisplayClicked()" name="host_display" id="host_display" style="text-align: left;">'.
-            //$this->smartyAssign->getLang("repository_log_host_limit").'</a></th>';
-            $html .= '<tr>';
-            $html .= '<th class="th_col_repos ac" style="width:100px">'.$this->smartyAssign->getLang("repository_log_host").'</th>';
-            $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_log_ip_address").'</th>';
-            $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_except")."/".$this->smartyAssign->getLang("repository_release").'</th>';
-            $html .= '<th class="th_col_repos ac" colspan="2">'.$type.$this->smartyAssign->getLang("repository_log_num").'</th>';
-            $html .= '</tr>';
-            $html .= $html_all;
-            $html .= '</table>';
-            $html .= '</div>';
-            $html .= '<div class="paging" id="all_print_paging" name="all_print_paging" style="display:none;">';
-            $html .= '<a class="btn_blue white" href="javascript: printGraph_repos('."'all_print_area_repos'".')">'.$this->smartyAssign->getLang("repository_log_print").'</a>';
-            $html .= '</div>';
-            $html .= '</center>';
+            $html .= $this->createHostAccessHtml($html_all, $cnt_width, false, $cnt_all_host);
+            
             // download
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
             $this->repositoryDownload->download($html, "log.html");
             // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
         }
-
     }
-    // Add host log 2010/02/28 Y.Nakao --end--
+    
+    /**
+     * create host access report table html
+     *
+     * @param array $accessHtml -> custom log report table
+     * @param int $maxWidth -> max cnt length
+     * @param boolean $isDisplay -> true : exclude by excluded ip address
+     *                              false: all host custom report
+     * @param int $rowNum -> num of custom report row
+     * @return string -> host access report table html
+     */
+    private function createHostAccessHtml($accessHtml, $maxWidth, $isDisplay, $rowNum)
+    {
+        $type = $this->getTypeByTypeLog();
+        
+        $html = "";
+        $html .= '<center>';
+        if($isDisplay)
+        {
+            $html .= '<div id="print_area_repos"     name="print_area_repos"     class="ofx_auto ofy_hidden pd02" style="display:block">';
+        }
+        else
+        {
+            $html .= '<div id="all_print_area_repos" name="all_print_area_repos" class="ofx_auto ofy_hidden pd02" style="display:none;">';
+        }
+        $html .= '<table class="tb_repos text_color full" >';
+        $html .= '<colgroup span="2" width="100px">';
+        $html .= '<colgroup width="160px">';
+        $html .= '<colgroup width="'.$maxWidth.'ex;">';
+        $html .= '<colgroup width="*%">';
+        $html .= '<tr><th colspan="5" style="text-align: left;"><div class="th_repos_title_bar text_color mb10">';
+        $html .= '<p class="al fl">';
+        $html .= $this->smartyAssign->getLang("repository_log_per_host").
+                 $this->smartyAssign->getLang("repository_log_of").
+                 $type.
+                 $this->smartyAssign->getLang("repository_log_num").'</p>';
+                 
+        if($isDisplay)
+        {
+            $html .= '<p class="ar"><a href="javascript: hostdisplayClicked()" name="host_display"     id="host_display"     style="text-align: left;">';
+            $html .= $this->smartyAssign->getLang("repository_log_host_all_show").'</a>';
+        }
+        else
+        {
+            $html .= '<p class="ar"><a href="javascript: hostdisplayClicked()" name="host_display_all" id="host_display_all" style="text-align: left;">';
+            $html .= $this->smartyAssign->getLang("repository_log_host_limit").'</a>';
+        }
+        $html .= '</p></div></th>';
+        $html .= '<tr>';
+        $html .= '<th class="th_col_repos ac" style="width:100px">'.$this->smartyAssign->getLang("repository_log_host").'</th>';
+        $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_log_ip_address").'</th>';
+        $html .= '<th class="th_col_repos ac">'.$this->smartyAssign->getLang("repository_admin_log_exclusion").'</th>';
+        $html .= '<th class="th_col_repos ac" colspan="2">'.$type.$this->smartyAssign->getLang("repository_log_num").'</th>';
+        $html .= '</tr>';
+        $html .= $accessHtml;
+        $html .= '</table>';
+        $html .= '</div>';
+        
+        if($isDisplay)
+        {
+            $html .= '<div class="paging" id="print_paging"     name="print_paging"     style="display:block">';
+            $html .= '<a class="btn_blue white" style="margin-right:5px !important;" href="javascript: setExcludeIpAddress('. $rowNum. ')">'.$this->smartyAssign->getLang("repository_log_set_exclude_address").'</a>';
+            $html .= '<a class="btn_blue white" style="margin-left:5px !important;"  href="javascript: printGraph_repos('."'print_area_repos'".')">'.$this->smartyAssign->getLang("repository_log_print").'</a>';
+        }
+        else
+        {
+            $html .= '<div class="paging" id="all_print_paging" name="all_print_paging" style="display:none;">';
+            $html .= '<a class="btn_blue white" style="margin-right:5px !important;" href="javascript: setExcludeIpAddress('. $rowNum. ')">'.$this->smartyAssign->getLang("repository_log_set_exclude_address").'</a>';
+            $html .= '<a class="btn_blue white" style="margin-left:5px !important;"  href="javascript: printGraph_repos('."'all_print_area_repos'".')">'.$this->smartyAssign->getLang("repository_log_print").'</a>';
+        }
+        $html .= '</div>';
+        $html .= '</center>';
+        
+        return $html;
+    }
+    
+    /**
+     * get max width by cnt
+     *
+     * @param array $items
+     * @return int
+     */
+    private function getMaxWidthByResult($items)
+    {
+        $width_max = 0;
+        for($cnt = 0; $cnt < count($items); $cnt++)
+        {
+            if($width_max < $items[$cnt]['cnt'])
+            {
+                $width_max = $items[$cnt]['cnt'];
+            }
+        }
+        
+        return $width_max;
+    }
+    
+    /**
+     * get message of output type
+     *
+     * @return string
+     */
+    private function getTypeByTypeLog()
+    {
+        switch ( $this->type_log )
+        {
+            case self::TYPE_LOG_REGIST_ITEM:
+                // insert item log
+                $type = $this->smartyAssign->getLang("repository_log_entry");
+                break;
+            case self::TYPE_LOG_DOWNLOAD:
+                // download item log
+                $type = $this->smartyAssign->getLang("repository_log_download");
+                break;
+            case self::TYPE_LOG_VIEW:
+                // view item log
+                $type = $this->smartyAssign->getLang("repository_log_refer");
+                break;
+            default:
+                break;
+        }
+        return $type;
+    }
 }
-
-
 ?>
diff --git a/repository/action/edit/log/result/maple.ini b/repository/action/edit/log/result/maple.ini
index 300a3e4..48871be 100644
--- a/repository/action/edit/log/result/maple.ini
+++ b/repository/action/edit/log/result/maple.ini
@@ -1,6 +1,3 @@
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
 request = GET
 
diff --git a/repository/action/edit/mailtest/Mailtest.class.php b/repository/action/edit/mailtest/Mailtest.class.php
index 681b2e5..42f7325 100644
--- a/repository/action/edit/mailtest/Mailtest.class.php
+++ b/repository/action/edit/mailtest/Mailtest.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Mailtest.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Mailtest.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/prefix/confirm/Confirm.class.php b/repository/action/edit/prefix/confirm/Confirm.class.php
index 54319ca..a223934 100644
--- a/repository/action/edit/prefix/confirm/Confirm.class.php
+++ b/repository/action/edit/prefix/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 567 2014-05-21 08:30:29Z ivis $
+// $Id: Confirm.class.php 36217 2014-05-26 04:22:11Z satoshi_arata $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/prefix/image/Image.class.php b/repository/action/edit/prefix/image/Image.class.php
index c64ac49..7c4f5b7 100644
--- a/repository/action/edit/prefix/image/Image.class.php
+++ b/repository/action/edit/prefix/image/Image.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Image.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Image.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/resetranking/Resetranking.class.php b/repository/action/edit/resetranking/Resetranking.class.php
index 3e28b88..5c9a828 100644
--- a/repository/action/edit/resetranking/Resetranking.class.php
+++ b/repository/action/edit/resetranking/Resetranking.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Resetranking.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Resetranking.class.php 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/review/Review.class.php b/repository/action/edit/review/Review.class.php
index 2263693..b8f32c0 100644
--- a/repository/action/edit/review/Review.class.php
+++ b/repository/action/edit/review/Review.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Review.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Review.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -53,7 +53,9 @@ class Repository_Action_Edit_Review extends RepositoryAction
     	try {
     		//アクション初期化処理
 	        $result = $this->initAction();
-	        
+	        $container = & DIContainerFactory::getContainer();
+	        $this->mailMain = $container->getComponent("mailMain");
+
 	        if ( $result === false ) {
 	            $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );	//主メッセージとログIDを指定して例外を作成
 	            //$DetailMsg = null;                              //詳細メッセージ文字列作成
@@ -411,114 +413,51 @@ class Repository_Action_Edit_Review extends RepositoryAction
 		            // 査読実施後に前回の更新者(編集者)の情報が消えるので保持しておく
 		            $ind_user_id = $ret[0]['ins_user_id'];
 		            $mod_user_id = $ret[0]['mod_user_id'];
-		            
-		            // UpDate OK
-		        	if($this->select_supple_review[$nCnt] == 1){
-		        		// 承認処理
-		        		$query = "UPDATE ". DATABASE_PREFIX ."repository_supple ".
-		                    	 "SET supple_review_status = ?, ".
-		        				 "supple_review_date = ?, ".
-		        				 "mod_user_id = ?, ".
-								 "mod_date = ? ".
-		                    	 "WHERE item_id = ? ".
-		        				 "AND item_no = ? ".
-		        				 "AND attribute_id = ? ".
-		            			 "AND supple_no = ?;";
-						$params = array();
-						$params[] = 1;						// supple_review_status
-						$params[] = $this->TransStartDate;	// supple_review_date
-						$params[] = $user_id;	// mod_user_id
-						$params[] = $this->TransStartDate;	// mod_date
-						$params[] = $supple_data[$nCnt]['item_id'];			// item_id
-						$params[] = $supple_data[$nCnt]['item_no'];			// item_no
-						$params[] = $supple_data[$nCnt]['attribute_id'];	// attribute_id
-						$params[] = $supple_data[$nCnt]['supple_no'];		// supple_no
-			            //UPDATE実行
-		        	    $result = $this->Db->execute($query,$params);
-						if($result === false){
-			                //必要であればSQLエラー番号・メッセージ取得
-			                $errNo = $this->Db->ErrorNo();
-			                $errMsg = $this->Db->ErrorMsg();
-			                $this->Session->setParameter("error_code", $errMsg);
-			                //エラー処理を行う
-			                $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );	//主メッセージとログIDを指定して例外を作成
-			                //$DetailMsg = null;                              //詳細メッセージ文字列作成
-			                //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1, $埋込み文字1, $埋込み文字2 );
-			                //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-			                $this->failTrans();                                 //トランザクション失敗を設定(ROLLBACK)
-			                throw $exception;
-						}
-						$update_count++;
-						
-						// メール送信用情報作成
-						array_push($review_item_supple, array(	"item_id" => $supple_data[$nCnt]['item_id'],
-																"item_no" => $supple_data[$nCnt]['item_no'],
-																"attribute_id" => $supple_data[$nCnt]['attribute_id'],
-																"supple_no" => $supple_data[$nCnt]['supple_no'],
-																"ins_user_id" => $ind_user_id,
-																"mod_user_id" => $mod_user_id,
-																"review" => 1,
-																"reject_reason" => "")
-									);
-						
-		        	} elseif($this->select_supple_review[$nCnt] == 2){
-		        		// 却下処理
-		        		$query = "UPDATE ". DATABASE_PREFIX ."repository_supple ".
-		                    	 "SET supple_review_status = ?, ".
-		        				 "supple_review_date = ?, ".
-		        				 "supple_reject_status = ?, ".
-		        				 "supple_reject_date = ?, ".
-		        				 "supple_reject_reason = ?, ".
-		        				 "mod_user_id = ?, ".
-								 "mod_date = ? ".
-		                    	 "WHERE item_id = ? ".
-		        				 "AND item_no = ? ".
-		        				 "AND attribute_id = ? ".
-		            			 "AND supple_no = ?;";
-						$params = array();
-						$params[] = 0;						// supple_review_status
-						$params[] = $this->TransStartDate;	// supple_review_date
-						$params[] = 1;						// supple_reject_status
-						$params[] = $this->TransStartDate;	// supple_reject_date
-		        		if($this->supple_reject_reason[$nCnt] == " "){
-							$params[] = "";
-						} else {
-							$params[] = $this->supple_reject_reason[$nCnt];	// supple_reject_reason
-						}
-						$params[] = $user_id;	// mod_user_id
-						$params[] = $this->TransStartDate;	// mod_date
-						$params[] = $supple_data[$nCnt]['item_id'];			// item_id
-						$params[] = $supple_data[$nCnt]['item_no'];			// item_no
-						$params[] = $supple_data[$nCnt]['attribute_id'];	// attribute_id
-						$params[] = $supple_data[$nCnt]['supple_no'];		// supple_no
-			            //UPDATE実行
-		        	    $result = $this->Db->execute($query,$params);
-						if($result === false){
-			                //必要であればSQLエラー番号・メッセージ取得
-			                $errNo = $this->Db->ErrorNo();
-			                $errMsg = $this->Db->ErrorMsg();
-			                $this->Session->setParameter("error_code", $errMsg);
-			                //エラー処理を行う
-			                $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );	//主メッセージとログIDを指定して例外を作成
-			                //$DetailMsg = null;                              //詳細メッセージ文字列作成
-			                //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1, $埋込み文字1, $埋込み文字2 );
-			                //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-			                $this->failTrans();                                 //トランザクション失敗を設定(ROLLBACK)
-			                throw $exception;
-						}
-						$update_count++;
-						
-						// メール送信用情報作成
-						array_push($review_item_supple, array(	"item_id" => $supple_data[$nCnt]['item_id'],
-																"item_no" => $supple_data[$nCnt]['item_no'],
-																"attribute_id" => $supple_data[$nCnt]['attribute_id'],
-																"supple_no" => $supple_data[$nCnt]['supple_no'],
-																"ins_user_id" => $ind_user_id,
-																"mod_user_id" => $mod_user_id,
-																"review" => 0,
-																"reject_reason" => $this->supple_reject_reason[$nCnt])
-									);
-		        	}// 0は未承認のため何もしない
+
+		            try
+		            {
+    		            // UpDate OK
+    		        	if($this->select_supple_review[$nCnt] == 1){
+    		        	    $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
+    		        	    $businessSupple->acceptReview($supple_data[$nCnt]['item_id'],$supple_data[$nCnt]['item_no'],$supple_data[$nCnt]['attribute_id'],$supple_data[$nCnt]['supple_no']);
+    						$update_count++;
+
+    						// メール送信用情報作成
+    						array_push($review_item_supple, array(	"item_id" => $supple_data[$nCnt]['item_id'],
+    																"item_no" => $supple_data[$nCnt]['item_no'],
+    																"attribute_id" => $supple_data[$nCnt]['attribute_id'],
+    																"supple_no" => $supple_data[$nCnt]['supple_no'],
+    																"ins_user_id" => $ind_user_id,
+    																"mod_user_id" => $mod_user_id,
+    																"review" => 1,
+    																"reject_reason" => "")
+    									);
+
+    		        	} elseif($this->select_supple_review[$nCnt] == 2){
+    		        	    $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
+    		        	    $businessSupple->rejectReview($supple_data[$nCnt]['item_id'],$supple_data[$nCnt]['item_no'],$supple_data[$nCnt]['attribute_id'],$supple_data[$nCnt]['supple_no'],$this->supple_reject_reason[$nCnt]);
+    						$update_count++;
+
+    						// メール送信用情報作成
+    						array_push($review_item_supple, array(	"item_id" => $supple_data[$nCnt]['item_id'],
+    																"item_no" => $supple_data[$nCnt]['item_no'],
+    																"attribute_id" => $supple_data[$nCnt]['attribute_id'],
+    																"supple_no" => $supple_data[$nCnt]['supple_no'],
+    																"ins_user_id" => $ind_user_id,
+    																"mod_user_id" => $mod_user_id,
+    																"review" => 0,
+    																"reject_reason" => $this->supple_reject_reason[$nCnt])
+    									);
+    		        	}// 0は未承認のため何もしない
+		            }
+		            catch(AppException $e)
+		            {
+		                $msg = $e->getMessage();
+                        $this->Session->setParameter("error_code", $msg);
+		                $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );	//主メッセージとログIDを指定して例外を作成
+		                $this->failTrans();                                 //トランザクション失敗を設定(ROLLBACK)
+		                throw $exception;
+		            }
 		        }
 		        // Add review mail setting 2009/09/30 Y.Nakao --start--
 		        // 査読結果通知メール送信処理
@@ -761,7 +700,7 @@ class Repository_Action_Edit_Review extends RepositoryAction
 					// set Mail body
 					if($send_mail[$ins_user_id]['review_mail_flg'] === true){
 						// ヘッダ & フッタ
-						if($send_mail[$ins_user_id]['header'] == ""){
+						if(!isset($send_mail[$ins_user_id]['header']) || $send_mail[$ins_user_id]['header'] == ""){
 							$send_mail[$ins_user_id]['header'] = $smartyAssign->getLang("repository_mail_review_contents_body")."\n\n";
 							$send_mail[$ins_user_id]['header'] .= $smartyAssign->getLang("repository_mail_review_contents")."\n";
 							$send_mail[$ins_user_id]['body'] = "";
@@ -1075,7 +1014,12 @@ class Repository_Action_Edit_Review extends RepositoryAction
     	// 査読結果メール送信処理
 		foreach($send_mail as $val){
 			// ユーザ毎にメールを送信
-			
+
+		    if($val['review_mail_flg'] === false)
+		    {
+		        continue;
+		    }
+
 			// send review mail
 			// 査読通知メールを送信する
 			// 件名
@@ -1087,7 +1031,7 @@ class Repository_Action_Edit_Review extends RepositoryAction
 			$mail_body = "";
 			$mail_body .= $val['header'];
 			$mail_body .= $val['body'];
-			if($val['reject_flag']){
+			if(isset($val['reject_flag']) && $val['reject_flag']){
 				if($this->type == "item"){
 					$mail_body .= $smartyAssign->getLang("repository_mail_review_contents_reject_close")."\n\n";
 				} else {
diff --git a/repository/action/edit/review/maple.ini b/repository/action/edit/review/maple.ini
index 1349399..1f6aa55 100644
--- a/repository/action/edit/review/maple.ini
+++ b/repository/action/edit/review/maple.ini
@@ -1,7 +1,5 @@
 ;[Convert]
 ;*.trim =
-[DIContainer]
-filename = "dicon.ini"
 
 [ValidateDef]
 select_review
diff --git a/repository/action/edit/setcmdpath/Setcmdpath.class.php b/repository/action/edit/setcmdpath/Setcmdpath.class.php
index f80141e..284e49f 100644
--- a/repository/action/edit/setcmdpath/Setcmdpath.class.php
+++ b/repository/action/edit/setcmdpath/Setcmdpath.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setcmdpath.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Setcmdpath.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/edit/tree/Tree.class.php b/repository/action/edit/tree/Tree.class.php
index f0de7f4..9c43128 100644
--- a/repository/action/edit/tree/Tree.class.php
+++ b/repository/action/edit/tree/Tree.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Tree.class.php 600 2014-08-06 04:41:16Z ivis $
+// $Id: Tree.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -45,6 +45,7 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                                     // 'update' : edit index
                                     // 'delete' : delete index
                                     // 'sort' : sort index
+                                    // 'copy_tree' : copy index tree
     // request parameter for now edit index data
     var $name_jp = null;                // now edit index japanese name
     var $name_en = null;                // now edit index english name
@@ -60,8 +61,8 @@ class Repository_Action_Edit_Tree extends RepositoryAction
     var $access_role_ids = null;        // now edit index entry item auth id
     var $not_access_role_ids = null;    // now edit index not entry item auth id
     var $mod_date = null;               // now edit index mod date
-    var $drag_id = null;                // drag index id at drag ivent
-    var $drop_id = null;                // drop index id at drop ivent
+    var $drag_id = null;                // drag index id at drag event
+    var $drop_id = null;                // drop index id at drop event
     var $drop_index = null;             // true  : index drop in index
                                         // false : index drop in sentry
     // Add child index display more 2009/01/16 Y.Nakao --start--
@@ -145,6 +146,19 @@ class Repository_Action_Edit_Tree extends RepositoryAction
     public $biblio_flag = null;
     public $online_issn = null;
     // Add issn and biblio flag 2014/04/16 T.Ichikawa --end--
+    
+    // Add recursively uppdate flag 2015/01/21 S.Suzuki --start--
+    public $pubdate_recursive = null;
+    public $create_cover_recursive = null;
+    public $aclRoleIds_recursive = null;
+    public $aclRoomAuth_recursive = null;
+    public $aclGroupIds_recursive = null;
+    // Add recursively uppdate flag 2015/01/21 S.Suzuki --end--
+    
+    // Add change view role flag 2015/03/10 T.Ichikawa --start--
+    public $changeBrowsingAuthorityFlag = false;
+    // Add change view role flag 2015/03/10 T.Ichikawa --end--
+    
     function execute()
     {
         try {
@@ -264,7 +278,7 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                 $new_index_data["access_role_id"] = $auth_data["access_role_id"];
                 $new_index_data["comment"] = "";
                 $new_index_data["display_more"] = ""; // Add child index display more 2009/01/16 Y.Nakao
-                $new_index_data["rss_display"] = "";    // Add RSS icon display 2009/07/06 A.Suzuki
+                $new_index_data["rss_display"] = 0;    // Add RSS icon display 2009/07/06 A.Suzuki
                 // Add config management authority 2010/02/23 Y.Nakao --start--
                 $new_index_data["access_role_room"] = $this->defaultAccessRoleRoom_;
                 // Add config management authority 2010/02/23 Y.Nakao --end--
@@ -282,9 +296,9 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                 $new_index_data["exclusive_acl_room_auth"] = $this->defaultExclusiveAclRoleRoom_;
                 $new_index_data["exclusive_acl_group_id"] = $this->defaultExclusiveAclGroups_;
                 // Add tree access control list 2012/02/22 T.Koyasu -end-
-                $new_index_data["repository_id"] = "";
+                $new_index_data["repository_id"] = 0;
                 $new_index_data["set_spec"] = "";
-                $new_index_data["create_cover_flag"] = "";
+                $new_index_data["create_cover_flag"] = 0;
                 // Add PrivateTree owner 2013/04/10 K.Matsuo --start--
                 $owner_user_id = "";
                 if($this->edit_id != 0){
@@ -539,7 +553,13 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                 $edit_index_data["parent_index_id"] = $this->pid;
                 $edit_index_data["show_order"] = $this->show_order;
                 $edit_index_data["mod_date"] = $this->mod_date;
-                $edit_index_data["public_state"] = $this->pub_chk;
+                // mod recursive update child index 2015/02/10 S.Arata --start--
+                if ($this->pub_chk == "true") {
+                    $edit_index_data["public_state"] = "1";
+                } else {
+                    $edit_index_data["public_state"] = "0";
+                }
+                // mod recursive update child index 2015/02/10 S.Arata  --end--
                 // Bugfix input scrutiny heck pubdate 2011/06/17 Y.Nakao --start--
                 $edit_index_data["pub_year"] = $this->pub_year;
                 $edit_index_data["pub_month"] = $this->pub_month;
@@ -594,6 +614,13 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                 // set exclusive_acl_group in repository_index
                 $edit_index_data["exclusive_acl_group_id"] = $this->exclusiveAclGroupIds;
                 // Add tree access control list 2012/02/22 T.Koyasu -end-
+                // Add change view role flag 2015/03/10 T.Ichikawa --start--
+                // 閲覧権限に変更があった場合フラグをtrueにする
+                $this->changeBrowsingAuthorityFlag = $this->checkChangeBrowsingAuthority($edit_index_data["index_id"], 
+                                                                                         $edit_index_data["exclusive_acl_role_id"], 
+                                                                                         $edit_index_data["exclusive_acl_room_auth"], 
+                                                                                         $edit_index_data["exclusive_acl_group_id"]);
+                // Add change view role flag 2015/03/10 T.Ichikawa --end--
                 // Add RSS icon display 2009/07/06 A.Suzuki --start--
                 if($this->create_cover_flag == "true"){
                     $edit_index_data["create_cover_flag"] = "1";
@@ -630,13 +657,53 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                     $this->Session->setParameter("tree_error_msg", $this->smartyAssign->getLang("repository_tree_wrongFormatIssn"));
                     return 'error';
                 }
+                
+                // Add recursively uppdate flag 2015/01/21 S.Suzuki --start--
+                if ($this->pubdate_recursive == "true") {
+                    $pubdate_recursive = true;
+                } else {
+                    $pubdate_recursive = false;
+                }
+                if ($this->create_cover_recursive == "true") {
+                    $create_cover_recursive = true;
+                } else {
+                    $create_cover_recursive = false;
+                }
+                if ($this->aclRoleIds_recursive == "true") {
+                    $aclRoleIds_recursive = true;
+                } else {
+                    $aclRoleIds_recursive = false;
+                }
+                if ($this->aclRoomAuth_recursive == "true") {
+                    $aclRoomAuth_recursive = true;
+                } else {
+                    $aclRoomAuth_recursive = false;
+                }
+                if ($this->aclGroupIds_recursive == "true") {
+                    $aclGroupIds_recursive = true;
+                } else {
+                    $aclGroupIds_recursive = false;
+                }
+                
+                if ($pubdate_recursive || $create_cover_recursive || $aclRoleIds_recursive || 
+                    $aclRoomAuth_recursive || $aclGroupIds_recursive){
+                        
+                        $indexManager->recursiveUpdate($edit_index_data, 
+                                                       $pubdate_recursive, 
+                                                       $create_cover_recursive, 
+                                                       $aclRoleIds_recursive, 
+                                                       $aclRoomAuth_recursive, 
+                                                       $aclGroupIds_recursive);
+                }
+                // Add recursively uppdate flag 2015/01/21 S.Suzuki --end--
+                
                 // Add issn and biblio flag 2014/04/18 T.Ichikawa --end--
                 // Add count contents for unpublic index 2009/02/13 A.Suzuki --start--
-                // 上位インデックスが公開のときのみコンテンツ数は変化する
+                // 上位インデックスが公開であるか閲覧権限が変更された時のみ再集計を行う
                 if($old_state != "unpublic_parent"){
                     if($old_state == "public_all"){
                         if($this->pub_chk == "false"){
-                            // 公開　->　非公開
+                            // 公開 -> 非公開
                             // 親インデックスのコンテンツ数から自身のコンテンツ数を引く
                             $result = $this->subIndexContents($parent_id, $this->edit_id);
                             if($result === false){
@@ -664,11 +731,36 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                             // Add private_contents count K.Matsuo 2013/05/07 --end--
                         } else {
                             // 公開 -> 公開
-                            // コンテンツ数に変化なし
+                            // Add private_contents count K.Matsuo 2013/05/07 --start--
+                            // 親インデックスの非公開コンテンツ数から自身の非公開コンテンツ数を引く
+                            $result = $this->subIndexContents($parent_id, $this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // 自身以下のコンテンツ数を再取得する
+                            $result = $this->recountContents($this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // このインデックス以下の非公開コンテンツ数を再計算
+                            $result = $this->recountPrivateContents($this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // 親インデックスのコンテンツ数に自身のコンテンツ数を足す
+                            $result = $this->addIndexContents($parent_id, $this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // Add private_contents count K.Matsuo 2013/05/07 --end--
                         }
                     } else if($old_state == "unpublic"){
                         if($this->pub_chk != "false"){
-                            // 非公開　->　公開
+                            // 非公開 -> 公開
                             // Add private_contents count K.Matsuo 2013/05/07 --start--
                             // 親インデックスの非公開コンテンツ数から自身の非公開コンテンツ数を引く
                             $result = $this->subIndexContents($parent_id, $this->edit_id);
@@ -697,7 +789,31 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                             // Add private_contents count K.Matsuo 2013/05/07 --end--
                         } else {
                             // 非公開 -> 非公開
-                            // コンテンツ数に変化なし
+                            // 親インデックスのコンテンツ数から自身のコンテンツ数を引く
+                            $result = $this->subIndexContents($parent_id, $this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // 自身以下のコンテンツ数をリセットする
+                            $result = $this->resetContents($this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // このインデックス以下の非公開コンテンツ数を再計算
+                            $result = $this->recountPrivateContents($this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // 上位インデックスに非公開コンテンツ数追加 add index private_contents num for after move index parent index
+                            $result = $this->addIndexContents($parent_id, $this->edit_id);
+                            if($result === false){
+                                $error = $this->Db->ErrorMsg();
+                                return false; 
+                            }
+                            // Add private_contents count K.Matsuo 2013/05/07 --end--
                         }
                     }
                 }
@@ -706,9 +822,38 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                     $this->deleteWhatsnewForIndex($this->edit_id);
                 }
                 // Add deleteWhatsnew 2009/02/09 A.Suzuki --end--
+                // Add change view role flag 2015/03/10 T.Ichikawa --start--
+                if($this->changeBrowsingAuthorityFlag) {
+                    $result = $this->subIndexContents($parent_id, $this->edit_id);
+                    if($result === false){
+                        $error = $this->Db->ErrorMsg();
+                        return false; 
+                    }
+                    // 自身以下のコンテンツ数を再取得する
+                    $result = $this->recountContents($this->edit_id);
+                    if($result === false){
+                        $error = $this->Db->ErrorMsg();
+                        return false; 
+                    }
+                    // このインデックス以下の非公開コンテンツ数を再計算
+                    $result = $this->recountPrivateContents($this->edit_id);
+                    if($result === false){
+                        $error = $this->Db->ErrorMsg();
+                        return false; 
+                    }
+                    // 親インデックスのコンテンツ数に自身のコンテンツ数を足す
+                    $result = $this->addIndexContents($parent_id, $this->edit_id);
+                    if($result === false){
+                        $error = $this->Db->ErrorMsg();
+                        return false; 
+                    }
+                }
+                // Add change view role flag 2015/03/10 T.Ichikawa --end--
                 // Add count contents for unpublic index 2009/02/13 A.Suzuki --end--
                 // $this->Session->setParameter("repository_edit_update", "update");
                 $this->Session->setParameter("redirect_flg", "tree_update");
+            } else if($this->edit_mode == "copy_tree"){
+                $indexManager->copyIndexTree($this->drag_id, $this->drop_id);
             } else { 
                 //////////////////////////////////
                 // get edit index data
@@ -786,8 +931,8 @@ class Repository_Action_Edit_Tree extends RepositoryAction
     function getShowOrder($pid){
         // get new parent index bottom's max show_order
         $query = "SELECT COUNT(show_order) FROM ". DATABASE_PREFIX ."repository_index ".
-                 "WHERE `is_delete` = '0' AND ".
-                 "parent_index_id = '". $pid ."'; ";
+                 "WHERE `is_delete` = 0 AND ".
+                 "parent_index_id = ". $pid ."; ";
         $ret_show = $this->Db->execute($query);
         if($ret_show === false || $ret_show[0]["COUNT(show_order)"]<=0){
             $show_order = 0;
@@ -1130,8 +1275,8 @@ class Repository_Action_Edit_Tree extends RepositoryAction
      */
     function hasChild($pid){
         $query = "SELECT DISTINCT index_id FROM ". DATABASE_PREFIX ."repository_index ".
-                 "WHERE parent_index_id = '". $pid ."' AND ".
-                 "is_delete = '0'; ";
+                 "WHERE parent_index_id = ". $pid ." AND ".
+                 "is_delete = 0; ";
         $result = $this->Db->execute($query);
         if($result === false) {
             return false;
@@ -1889,8 +2034,8 @@ class Repository_Action_Edit_Tree extends RepositoryAction
         // 編集に必要な情報
         // index_id、名前(日/英)、公開/非公開、公開日、投稿権限あり、投稿権限なし、下にアイテム/インデックスがあるかないか
         $query = "SELECT * FROM ". DATABASE_PREFIX ."repository_index ".
-                 "WHERE index_id = '". $id ."' AND ".
-                 "is_delete = '0'; ";
+                 "WHERE index_id = ". $id ." AND ".
+                 "is_delete = 0; ";
         $result = $this->Db->execute($query);
         if($result === false || count($result)!=1) {
             return "";
@@ -1971,8 +2116,8 @@ class Repository_Action_Edit_Tree extends RepositoryAction
         // 既存の$parent_index_id直下の子インデックス情報を取得 get parent index's child index data from DB
         $query = "SELECT * ".
                  "FROM ". DATABASE_PREFIX ."repository_index ".
-                 "WHERE `is_delete` = '0' AND ".
-                 "`parent_index_id` = '". $parent_index_id."' ".
+                 "WHERE `is_delete` = 0 AND ".
+                 "`parent_index_id` = ". $parent_index_id." ".
                  "ORDER BY `show_order`; ";
         $result = $this->Db->execute($query);
         if($result === false) {
@@ -2353,19 +2498,13 @@ class Repository_Action_Edit_Tree extends RepositoryAction
     function recountContents($index_id=0){
         $contents = 0;
         if($index_id != 0) {    // ルートインデックス以外
-            // インデックスの公開状況取得
-            $query = "SELECT public_state ".
-                     "FROM ".DATABASE_PREFIX."repository_index ".
-                     "WHERE index_id = ? ".
-                     "AND is_delete = 0;";
-            $params = array();
-            $params[] = $index_id;
-            $result = $this->Db->execute($query, $params);
-            if($result === false) {
-                $errMsg = $this->Db->ErrorMsg();
+            // インデックス公開フラグ
+            $index_public_flag = $this->checkIndexState($index_id);
+            if($index_public_flag === false) {
                 return false;
             }
-            if($result[0]['public_state'] == "1"){
+            
+            if($index_public_flag == "public"){
                 // インデックス直下のコンテンツ数取得
                 $query = "SELECT ".DATABASE_PREFIX."repository_position_index.item_id, ".
                          "       ".DATABASE_PREFIX."repository_position_index.item_no, ".
@@ -2440,20 +2579,14 @@ class Repository_Action_Edit_Tree extends RepositoryAction
     function recountPrivateContents($index_id=0){
         $contents = 0;
         if($index_id != 0) {    // ルートインデックス以外
-            // インデックスの公開状況取得
-            $query = "SELECT public_state ".
-                     "FROM ".DATABASE_PREFIX."repository_index ".
-                     "WHERE index_id = ? ".
-                     "AND is_delete = 0;";
-            $params = array();
-            $params[] = $index_id;
-            $result = $this->Db->execute($query, $params);
-            if($result === false) {
-                $errMsg = $this->Db->ErrorMsg();
+            // インデックス公開フラグ
+            $index_public_flag = $this->checkIndexState($index_id);
+            if($index_public_flag === false) {
                 return false;
             }
-            if($result[0]['public_state'] == "1" && $this->checkParentPublicState($index_id)){
-                // インデックス直下の非公開コンテンツ数取得
+            
+            if($index_public_flag == "public"){
+                // インデックスが公開状態の場合、非公開設定のアイテムのみ取得する
                 $query = "SELECT ".DATABASE_PREFIX."repository_position_index.item_id, ".
                          "       ".DATABASE_PREFIX."repository_position_index.item_no, ".
                          "       ".DATABASE_PREFIX."repository_position_index.index_id ".
@@ -2477,7 +2610,7 @@ class Repository_Action_Edit_Tree extends RepositoryAction
                     $contents++;
                 }
             } else {
-                // インデックス直下の公開・非公開コンテンツ数取得
+                // インデックスが非公開状態の場合、全てのアイテムを取得する
                 $query = "SELECT ".DATABASE_PREFIX."repository_position_index.item_id, ".
                          "       ".DATABASE_PREFIX."repository_position_index.item_no, ".
                          "       ".DATABASE_PREFIX."repository_position_index.index_id ".
@@ -2879,6 +3012,142 @@ class Repository_Action_Edit_Tree extends RepositoryAction
         $repositoryDownload->download($index_json, "index_json.txt");
     }
     // Add new prefix id 2013/12/24 T.Ichikawa --end--
+    
+    // Add change view authority flag 2015/03/10 T.Ichikawa --start--
+    /**
+     * 閲覧権限が変更されたかチェックする
+     * 
+     * @param int $indexId             インデックスID
+     * @param int $exclusiveRoleId     除外閲覧権限ID
+     * @param int $exclusiveRoomAuth   除外ルーム権限
+     * @param string $exclusiveGroupId 除外グループID
+     * @return bool
+     */
+    private function checkChangeBrowsingAuthority($indexId, $exclusiveRoleId, $exclusiveRoomAuth, $exclusiveGroupId)
+    {
+        // 閲覧除外権限情報の取得
+        $query = "SELECT exclusive_acl_role, exclusive_acl_group ".
+                 "FROM ".DATABASE_PREFIX. "repository_index ".
+                 "WHERE index_id = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = $indexId;
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            // 何か起きたら処理しない
+            return false;
+        }
+        
+        // ベース権限とルーム権限に分ける
+        $roles = explode("|", $result[0]["exclusive_acl_role"]);
+        $exclusive_acl_role_id = $roles[0];
+        $exclusive_acl_room_auth = $roles[1];
+        
+        // 画面上で設定した値とDBの値が違う場合はtrueを返す
+        // ベース権限の変更チェック
+        if($exclusive_acl_role_id != $exclusiveRoleId) {
+            return true;
+        }
+        // ルーム権限の変更チェック
+        if($exclusive_acl_room_auth != $exclusiveRoomAuth) {
+            return true;
+        }
+        
+        // 画面上で設定した除外グループ権限
+        $exclusiveGroupIds = explode(",", $exclusiveGroupId);
+        // DBに保存された除外グループ権限
+        $exclusive_acl_group_id = explode(",", $result[0]["exclusive_acl_group"]);
+        // 除外グループ数が違う場合は変更があったという事なのでtrueを返す
+        if(count($exclusive_acl_group_id) != count($exclusiveGroupIds)) {
+            return true;
+        } else {
+            for($ii = 0; $ii < count($exclusive_acl_group_id); $ii++) {
+                // DBの値と除外グループ配列の値をチェックして、一致しない値がある場合はtrueを返す
+                if(!in_array($exclusive_acl_group_id[$ii], $exclusiveGroupIds)) {
+                    return true;
+                }
+            }
+        }
+        
+        return false;
+    }
+    
+    /**
+     * 指定インデックスの公開状況をチェックする
+     *
+     * @param  int $index_id インデックスID
+     * @return string "public" "private"
+     */
+    private function checkIndexState($index_id) {
+        // インデックス自身の公開状況取得
+        $query = "SELECT public_state ".
+                 "FROM ".DATABASE_PREFIX."repository_index ".
+                 "WHERE index_id = ? ".
+                 "AND is_delete = 0;";
+        $params = array();
+        $params[] = $index_id;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            $errMsg = $this->Db->ErrorMsg();
+            return false;
+        }
+        // インデックス自身の公開フラグのチェック
+        if($result[0]["public_state"] == 0) {
+            return "private";
+        }
+        
+        // ユーザー閲覧権限取得
+        $query = "SELECT exclusive_acl_role_id, exclusive_acl_room_auth, public_state ".
+                 "FROM ". DATABASE_PREFIX. "repository_index_browsing_authority ".
+                 "WHERE index_id = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = $index_id;
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            $errMsg = $this->Db->ErrorMsg();
+            return false;
+        }
+        // インデックス閲覧権限のチェック
+        // なんらかの権限情報が存在する場合
+        if(count($result) > 0) {
+            if($result[0]["public_state"] == 0 ||          // 公開フラグが非公開状態
+               $result[0]["exclusive_acl_role_id"] > 0 ||  // 閲覧ベース権限に制限がかかっている
+               $result[0]["exclusive_acl_room_auth"] > -1) // 閲覧ルーム権限に制限がかかっている
+            {
+                return "private";
+            }
+        }
+        
+        // 閲覧グループ権限取得
+        $query = "SELECT exclusive_acl_group_id ".
+                 "FROM ". DATABASE_PREFIX. "repository_index_browsing_groups ".
+                 "WHERE index_id = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = $index_id;
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            $errMsg = $this->Db->ErrorMsg();
+            return false;
+        }
+        // インデックス閲覧権限のチェック
+        // なんらかの権限情報が存在する場合
+        if(count($result) > 0) {
+            for($ii=0; $ii < count($result); $ii++) {
+                // 「非会員」のグループ権限が除外権限に設定されている場合
+                if($result[$ii]["exclusive_acl_group_id"] == 0) {
+                    return "private";
+                }
+            }
+        }
+        
+        return "public";
+    }
+    // Add change view authority flag 2015/03/10 T.Ichikawa --end--
 }
 
 ?>
diff --git a/repository/action/edit/treethumbnail/Treethumbnail.class.php b/repository/action/edit/treethumbnail/Treethumbnail.class.php
index 975513b..231315a 100644
--- a/repository/action/edit/treethumbnail/Treethumbnail.class.php
+++ b/repository/action/edit/treethumbnail/Treethumbnail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Treethumbnail.class.php 434 2010-09-14 06:25:25Z ivis $
+// $Id: Treethumbnail.class.php 1441 2010-09-14 06:19:56Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/export/ExportCommon.class.php b/repository/action/main/export/ExportCommon.class.php
index 63afeca..7646837 100644
--- a/repository/action/main/export/ExportCommon.class.php
+++ b/repository/action/main/export/ExportCommon.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: ExportCommon.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: ExportCommon.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -618,7 +618,7 @@ class ExportCommon extends RepositoryAction
                             "item_id=\"" . $result_file_price_Table[0]["item_id"] . "\" " .         // item_id
                             "item_no=\"" .$result_file_price_Table[0]["item_no"] . "\" " .          // item_no
                             "attribute_id=\"" .$result_file_price_Table[0]["attribute_id"] . "\" " .    // attribute_id
-                            "file_no=\"" ."1" . "\" " ;          // file_no
+                            "file_no=\"" . $result_file_price_Table[0]["file_no"] . "\" " ;          // file_no
                     // Add the management value is changed from room_id to page_name. Y.Nakao 2008/10/06 --start--
                     $price_export = "";
                     $price = explode("|", $result_file_price_Table[0]["price"]);
@@ -673,14 +673,12 @@ class ExportCommon extends RepositoryAction
                 copy($file_path, $output_file);
                 // Add separate file from DB 2009/04/22 Y.Nakao --end--
                 
-                // Bug Fix WEKO-2014-047 T.Koyasu 2014/07/24 --start--
-                // restore to output download log in export
-                $this->entryLog(RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE, 
-                                $result[$ii]["item_id"], 
-                                $result[$ii]["item_no"], 
-                                $result[$ii]["attribute_id"], 
-                                $result[$ii]["file_no"]);
-                // Bug Fix WEKO-2014-047 T.Koyasu 2014/07/24 --start--
+                // Mod entryLog T.Koyasu 2015/03/06 --start--
+                $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+                BusinessFactory::initialize($this->Session, $this->Db, $this->TransStartDate);
+                $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+                $logManager->entryLogForDownload($result[$ii]["item_id"], $result[$ii]["item_no"], $result[$ii]["attribute_id"], $result[$ii]["file_no"]);
+                // Mod entryLog T.Koyasu 2015/03/06 --end--
                 
                 array_push($output_files, $output_file);
             }
diff --git a/repository/action/main/export/detailconfirm/Detailconfirm.class.php b/repository/action/main/export/detailconfirm/Detailconfirm.class.php
index 75ee8cc..b88eab1 100644
--- a/repository/action/main/export/detailconfirm/Detailconfirm.class.php
+++ b/repository/action/main/export/detailconfirm/Detailconfirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Detailconfirm.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Detailconfirm.class.php 30197 2013-12-19 09:55:45Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/export/detaildownload/Detaildownload.class.php b/repository/action/main/export/detaildownload/Detaildownload.class.php
index b525a37..e59dc5b 100644
--- a/repository/action/main/export/detaildownload/Detaildownload.class.php
+++ b/repository/action/main/export/detaildownload/Detaildownload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Detaildownload.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Detaildownload.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -140,8 +140,8 @@ class Repository_Action_Main_Export_Detaildownload extends RepositoryAction
 					if($nCnt != 0){
 						$where_clause .= " OR ";
 					}
-					$where_clause .= "(attribute_id = '" . $license_agree_file_no[$nCnt] ."' AND ";
-					$where_clause .= "file_no = '" . $license_agree_file_no[$nCnt+1] . "' )";
+					$where_clause .= "(attribute_id = " . $license_agree_file_no[$nCnt] ." AND ";
+					$where_clause .= "file_no = " . $license_agree_file_no[$nCnt+1] . " )";
 				}
 				$where_clause .= " ) ";				
 			}
diff --git a/repository/action/main/export/detaildownload/maple.ini b/repository/action/main/export/detaildownload/maple.ini
index fd30cb1..d9cf150 100644
--- a/repository/action/main/export/detaildownload/maple.ini
+++ b/repository/action/main/export/detaildownload/maple.ini
@@ -1,16 +1,3 @@
-;[Convert]
-;*.trim =
-
-;[ValidateDef]
-;item_type_id
-
-;[Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
-
-;[View]
-;success = "action:repository_view_main_export_detailconfirm"
-
 [ValidateDef]
 item_id.required = "1:lang._invalid_input"
 item_id.numeric="1:lang._invalid_input"
@@ -29,8 +16,5 @@ uploadsView = "ref:uploadsView"
 [TokenExtra]
 mode="nobuild"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
 request = GET
diff --git a/repository/action/main/export/filedownload/Filedownload.class.php b/repository/action/main/export/filedownload/Filedownload.class.php
index 4c50887..901765e 100644
--- a/repository/action/main/export/filedownload/Filedownload.class.php
+++ b/repository/action/main/export/filedownload/Filedownload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Filedownload.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Filedownload.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -216,11 +216,6 @@ class Repository_Action_Main_Export_Filedownload extends RepositoryAction
             // ワークディレクトリ削除
             $this->removeDirectory($tmp_dir);
             
-            // insert file download log
-            // Add log common action Y.Nakao 2010/03/05 --start--
-            $this->entryLog(2, $ret[$ii]["item_id"], $ret[$ii]["item_no"], $ret[$ii]["attribute_id"], $ret[$ii]["file_no"], "");
-            // Add log common action Y.Nakao 2010/03/05 --end--
-            
             // zipファイル損傷対応 2008/08/25 Y.Nakao --start--
             exit();
             // zipファイル損傷対応 2008/08/25 Y.Nakao --end--
diff --git a/repository/action/main/export/filedownload/maple.ini b/repository/action/main/export/filedownload/maple.ini
index ee2b843..49d5f02 100644
--- a/repository/action/main/export/filedownload/maple.ini
+++ b/repository/action/main/export/filedownload/maple.ini
@@ -1,16 +1,3 @@
-;[Convert]
-;*.trim =
-
-;[ValidateDef]
-;item_type_id
-
-;[Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
-
-;[View]
-;success = "action:repository_view_main_export_detailconfirm"
-
 [ValidateDef]
 item_id
 item_no
@@ -27,8 +14,5 @@ uploadsView = "ref:uploadsView"
 [TokenExtra]
 mode="nobuild"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
 request = GET
diff --git a/repository/action/main/export/list/List.class.php b/repository/action/main/export/list/List.class.php
index 115a5f0..526274f 100644
--- a/repository/action/main/export/list/List.class.php
+++ b/repository/action/main/export/list/List.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: List.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: List.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/export/listdownload/Listdownload.class.php b/repository/action/main/export/listdownload/Listdownload.class.php
index 0158cad..f1d1cc3 100644
--- a/repository/action/main/export/listdownload/Listdownload.class.php
+++ b/repository/action/main/export/listdownload/Listdownload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Listdownload.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: Listdownload.class.php 40577 2014-08-28 00:43:12Z tatsuya_koyasu $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/export/listdownload/maple.ini b/repository/action/main/export/listdownload/maple.ini
index 1808783..b226ac4 100644
--- a/repository/action/main/export/listdownload/maple.ini
+++ b/repository/action/main/export/listdownload/maple.ini
@@ -14,12 +14,5 @@ uploadsView = "ref:uploadsView"
 [TokenExtra]
 mode="nobuild"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [RequestCheck]
 request = GET
-
-
-
-
diff --git a/repository/action/main/install/Install.class.php b/repository/action/main/install/Install.class.php
index 6ff5811..29f5daa 100644
--- a/repository/action/main/install/Install.class.php
+++ b/repository/action/main/install/Install.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Install.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Install.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -334,6 +334,10 @@ class Repository_Action_main_Install extends RepositoryAction
             }
             // Add advanced search 2013/11/27 R.Matsuura --end--
             
+            // Improve Log 2015/06/22 K.Sugimoto --start--
+            $this->addRobotListData();
+            // Improve Log 2015/06/22 K.Sugimoto --end--
+            
             //////////////////////////////
             // Prefix
             //////////////////////////////
@@ -561,5 +565,31 @@ class Repository_Action_main_Install extends RepositoryAction
         $this->dbAccess->executeQuery($query);
         return true;
     }
+    
+    // Improve Log 2015/06/22 K.Sugimoto --start--
+    /**
+     * add robotlist data
+     *
+     */
+    private function addRobotListData()
+    {
+        require_once WEBAPP_DIR. '/modules/repository/components/RepositoryProcessUtility.class.php';
+        if (!isset($_SERVER["SERVER_PORT"])) // NULLの時
+        {
+            //BASE_URLの先頭をチェックしてhttps://なら443を$_SERVER["SERVER_PORT"]に入力
+            if ( preg_match("/^https\:\/\//", BASE_URL) ) {
+                $_SERVER["SERVER_PORT"] = 443;
+            }
+            //BASE_URLの先頭をチェックしてhttp://なら80を$_SERVER["SERVER_PORT"]に入力
+            else if ( preg_match("/^http\:\/\//", BASE_URL) ){
+                $_SERVER["SERVER_PORT"] = 80;
+            }
+        }
+        
+        // Request parameter for next URL
+        $nextRequest = BASE_URL."/?action=repository_action_common_robotlist";
+        RepositoryProcessUtility::callAsyncProcess($nextRequest);
+    }
+    // Improve Log 2015/06/22 K.Sugimoto --end--
 }
 ?>
diff --git a/repository/action/main/item/confirm/Confirm.class.php b/repository/action/main/item/confirm/Confirm.class.php
index dbedf9f..98207d2 100644
--- a/repository/action/main/item/confirm/Confirm.class.php
+++ b/repository/action/main/item/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Confirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,68 +13,779 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/IDServer.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryPdfCover.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryCheckFileTypeUtility.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
- * [[機能説明]]
- *
- * @package     [[package名]]
+ * アイテム登録：リンク設定画面からの入力処理アクション
+ * 
  * @access      public
  */
 class Repository_Action_Main_Item_Confirm extends RepositoryAction
 {
-    // JaLC DOI
-    public $entry_jalcdoi_checkbox = null;
-    public $entry_jalcdoi_hidden = null;
-    public $entry_crossref_checkbox = null;
-    public $entry_crossref_hidden = null;
-    public $entry_library_jalcdoi_text = null;
-    public $entry_library_jalcdoi_hidden = null;
+    // 使用コンポーネントを受け取るため
+    public $mailMain = null;
     
-    public $save_mode = null;      // 'stay' : save
-                                // 'next' : go next page
-    // Add registered info save action 2009/02/13 Y.Nakao --end--
+    // リクエストパラメーター
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     * @var string
+     */
+    public $save_mode = null;
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
     
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * 実行処理
+     * @see RepositoryAction::executeApp()
      */
-    public function executeForWeko()
-    {                        
-            $item_id = intval($this->Session->getParameter("edit_item_id"));
-            $item_no = intval($this->Session->getParameter("edit_item_no"));
+    protected function executeApp()
+    {
+        // ------------------------------------------------------------------
+        // 準備処理, セッション情報の取得
+        // ------------------------------------------------------------------
+        // セッション情報取得
+        $item_type_all = $this->Session->getParameter("item_type_all");                 // 1.アイテムタイプ,  アイテムタイプのレコードをそのまま保存したものである。
+        $item_attr_type = $this->Session->getParameter("item_attr_type");               // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
+        $item_num_cand = $this->Session->getParameter("item_num_cand");                 // 3.アイテム属性選択肢数 (N) : "item_num_cand"[N], 選択肢のない属性タイプは0を設定
+        $option_data = $this->Session->getParameter("option_data");                     // 4.アイテム属性選択肢 (N): "option_data"[N][M], N属性タイプごとの選択肢。Mはアイテム属性選択肢数に対応。0～                
+        // ユーザ入力値＆変数
+        $item_num_attr = $this->Session->getParameter("item_num_attr");                 // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
+        $item_attr_session = $this->Session->getParameter("item_attr");                 // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
+        $base_attr = $this->Session->getParameter("base_attr");                         // 7.アイテム基本属性(今のところタイトルと言語のユーザー入力値)
+        $license_master = $this->Session->getParameter("license_master");               // ライセンスマスタ
+        $indice = $this->Session->getParameter("indice");                               // X.関連インデックス
+        $link = $this->Session->getParameter("link");                                   // X.リンクリスト
+        $edit_flag = $this->Session->getParameter("edit_flag");                         // X.処理モード(0:新規作成, 1:既存編集)
+        $edit_flag = $this->Session->getParameter("edit_flag");                         // X.処理モード(0:新規作成, 1:既存編集)
+        $delete_file_list = $this->Session->getParameter("delete_file_list");           // X.DB登録済み削除ファイルリスト : delete_file_list (既存編集時のみ)
+        $item_pub_date = $this->Session->getParameter('item_pub_date');                 // X.アイテム公開日
+        $item_keyword = $this->Session->getParameter('item_keyword');                   // X.アイテムキーワード
+        $item_keyword_english = $this->Session->getParameter('item_keyword_english');   // X.アイテムキーワード(英)
+        $contributorUserId = $this->Session->getParameter("contributorUserId");         // Contributor user_id
+        
+        // 登録情報
+        $user_id = $this->Session->getParameter("_user_id");    // ユーザID
+        $edit_start_date = $this->Session->getParameter("edit_start_date");
+        
+        // ------------------------------------------------------------------
+        // 準備処理, アイテムID, NO決定
+        // ------------------------------------------------------------------
+        $item_id = intval($this->Session->getParameter("edit_item_id"));
+        $item_no = intval($this->Session->getParameter("edit_item_no"));
+        
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "confirm",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+        );
+        $returnString = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
+        }
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
+        
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
+        }
+        
+        // 登録処理以外の画面へ遷移する場合はここで終了
+        if($returnString!="redirect"){
+            return $returnString;
+        }
+        
+        // ------------------------------------------------------------------
+        // 準備処理, アイテム管理パラメータ取得
+        // 査読対象が登録された場合メールを送信するかどうかのパラメータ取得追加 2009/09/16 
+        // ------------------------------------------------------------------
+        // 査読・承認を行うか否か
+        $query = "SELECT `param_value` ".
+                 "FROM `{repository_parameter}` ".
+                 "WHERE `param_name` = ?;";
+        $params = array();
+        $params[] = 'review_flg';
+        $ret = $this->Db->execute($query, $params);
+        if ($ret === false) {
+            $tmpErrorMsg = $this->Db->ErrorMsg();
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $review_flg = $ret[0]['param_value'];
+        // 承認済みアイテムを自動公開するか否か
+        $query = "SELECT `param_value` ".
+                 "FROM `{repository_parameter}` ".
+                 "WHERE `param_name` = ?;";
+        $params = array();
+        $params[] = 'item_auto_public';
+        $ret = $this->Db->execute($query, $params);
+        if ($ret === false) {
+            $tmpErrorMsg = $this->Db->ErrorMsg();
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $shown_flg = $ret[0]['param_value'];
+        
+        // Add review mail setting 2009/09/24 Y.Nakao --start--
+        // 新規査読アイテム登録メール送信処理
+        // 査読・承認を行うか否か
+        $query = "SELECT `param_value` ".
+                 "FROM `{repository_parameter}` ".
+                 "WHERE `param_name` = ?;";
+        $params = array();
+        $params[] = 'review_mail_flg';
+        $ret = $this->Db->execute($query, $params);
+        if ($ret === false) {
+            $tmpErrorMsg = $this->Db->ErrorMsg();
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $review_mail_flg = $ret[0]['param_value'];
+        // Add review mail setting 2009/09/24 Y.Nakao --end--
+        
+        if($this->Session->getParameter('item_entry_flg') == 'true'){
+            // Add new prefix 2013/12/24 T.Ichiakwa --start--
+            $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->accessDate);
+            $prefix_id = $repositoryHandleManager->getPrefix(RepositoryHandleManager::ID_Y_HANDLE);
+            $uri = $repositoryHandleManager->getSubstanceUri($item_id, $item_no);
+            $detail_uri = BASE_URL."/?action=repository_uri&item_id=".$item_id;
+            // Add new prefix 2013/12/24 T.Ichiakwa --end--
+            if(strlen($uri) == 0){
+                // when uri is null, maybe this is new item
+                // check log exist
+                $query = "SELECT count(*) FROM {repository_log} ".
+                         "WHERE operation_id = 1 AND ".
+                         "item_id = ". $item_id ." AND ".
+                         "item_no = ". $item_no ."; ";
+                $result = $this->Db->execute($query);
+                if ($result === false) {
+                    $tmpErrorMsg = $this->Db->ErrorMsg();
+                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($tmpErrorMsg);
+                    $exception->addError($tmpErrorMsg);
+                    throw $exception;
+                }
+                if(count($result) == 0 || $result[0]['count(*)'] == 0){
+                    // ------------------------------------------------------------------
+                    // insert item entry log
+                    // ------------------------------------------------------------------
+                    // Mod entryLog T.Koyasu 2015/03/06 --start--
+                    $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+                    $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+                    $logManager->entryLogForRegistItem($item_id, $item_no);
+                    // Mod entryLog T.Koyasu 2015/03/06 --end--
+                }
+            }
             
-            $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->dbAccess, $this->TransStartDate);
-            $suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
-            // Add Library JaLC DOI
-            if(isset($this->entry_library_jalcdoi_text) && strlen($this->entry_library_jalcdoi_text) > 0)
-            {
-                $repositoryHandleManager->registLibraryJalcdoiSuffix($item_id, $item_no, $this->entry_library_jalcdoi_text);
+            // Check shown_status
+            $query = "SELECT shown_status ".
+                     "FROM {repository_item} ".
+                     "WHERE item_id = ? ".
+                     "AND item_no = ?;";
+            $params = array();
+            $params[] = $item_id;   // item_id
+            $params[] = $item_no;   // item_no
+            $result = $this->Db->execute($query, $params);
+            if ($result === false) {
+                $tmpErrorMsg = $this->Db->ErrorMsg();
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
             }
-            // Add JaLC DOI
-            else if(isset($this->entry_jalcdoi_checkbox) && strlen($this->entry_jalcdoi_checkbox) > 0 && strlen($suffix) > 0)
-            {
-                $repositoryHandleManager->registJalcdoiSuffix($item_id, $item_no, $suffix);
+            $old_shown_status = $result[0]["shown_status"];
+            
+            // アイテムの査読、公開状態を変更する
+            $query = "UPDATE {repository_item} ".
+                     "SET uri = ?, ".
+                     "review_status = ?, ".
+                     "review_date = ?, ".
+                     "shown_status = ?, ".
+                     "shown_date = ?, ".
+                     "reject_status = ?, ".
+                     "reject_date = ?, ".
+                     "reject_reason = ?, ".
+                     "mod_user_id = ?, ".
+                     "mod_date = ? ";
+            $params = array();
+            $params[] = $detail_uri;
+            if($review_flg == 1){
+                // 査読を行う(承認しない)
+                $params[] = 0;      // review_status
+                $params[] = "";     // review_date
+                $params[] = 0;      // shown_status
+            } else {
+                // 査読を行わない(承認する)
+                $params[] = "1";                    // "review_status"
+                $params[] = $this->accessDate;      // review_date
+                $params[] = $shown_flg;             // shown_status
             }
-            // Add Cross Ref
-            else if(isset($this->entry_crossref_checkbox) && strlen($this->entry_crossref_checkbox) > 0 && strlen($suffix) > 0)
+            $params[] = $this->generateDateStr($item_pub_date['year'], $item_pub_date['month'], $item_pub_date['day']); // "shown_date"
+            $params[] = 0;                  // reject_status
+            $params[] = "";                 // reject_date
+            $params[] = "";                 // reject_reason
+            $params[] = $user_id;           // mod_user_id
+            $params[] = $edit_start_date;   // mod_date
+            if($contributorUserId != $user_id)
             {
-                $repositoryHandleManager->registCrossrefSuffix($item_id, $item_no, $suffix);
+                $query .= ", ins_user_id = ? ";
+                $params[] = $contributorUserId;
+            }
+            $query .= "WHERE item_id = ? AND ".
+                      "item_no = ?; ";
+            $params[] = $item_id;       // item_id
+            $params[] = $item_no;       // item_no
+            //UPDATE実行
+            $result = $this->Db->execute($query, $params);
+            if ($result === false) {
+                $tmpErrorMsg = $this->Db->ErrorMsg();
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
             }
             
-            if($this->save_mode == "stay")
-            {
-                return 'stay';
+            // PDF Cover page 2012/06/15 A.Suzuki --start--
+            // Mod PDF Cover page timing 2015/01/26 K.Matsushita --start--
+            $cover_error_flg = "";
+            $cover_error = "";
+            // Mod PDF Cover page timing 2015/01/26 K.Matsushita --end--
+            // Add PDF Cover page 2012/06/15 A.Suzuki --end--
+            
+            // Add PDF flash 2010/02/04 A.Suzuki --start--
+            $ItemRegister = new ItemRegister($this->Session, $this->Db);
+            $ItemRegister->setInsUserId($contributorUserId);
+            $flash_error_flg = "";
+            for($ii=0; $ii<count($item_attr_type); $ii++) {
+                for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                    // アップロード済みファイルのライセンス設定
+                    if( ($item_attr_type[$ii]['input_type']=='file' || 
+                        $item_attr_type[$ii]['input_type']=='file_price') 
+                         && isset($item_attr_session[$ii][$jj]["upload"]))
+                    {
+                        // Add PDF Cover page 2012/06/15 A.Suzuki --start--
+                        // Mod PDF Cover page timing 2015/01/26 K.Matsushita --start--
+                        $coverCreatedFlag = false;
+                        if(strtolower($item_attr_session[$ii][$jj]["upload"]["extension"])=="pdf")
+                        {
+                            $pdfCover = new RepositoryPdfCover(
+                                                $this->Session,
+                                                $this->Db,
+                                                $this->TransStartDate,
+                                                $user_id,
+                                                $item_attr_session[$ii][$jj]["item_id"],
+                                                $item_attr_session[$ii][$jj]["item_no"],
+                                                $item_attr_session[$ii][$jj]["attribute_id"],
+                                                $item_attr_session[$ii][$jj]["file_no"],
+                                                null
+                                            );
+                            if( $pdfCover->deleteCoverPage() )
+                            {
+                                // Delete this file's flash
+                                $this->removeDirectory(
+                                    $this->getFlashFolder(
+                                            $item_attr_session[$ii][$jj]["item_id"],
+                                            $item_attr_session[$ii][$jj]["attribute_id"],
+                                            $item_attr_session[$ii][$jj]["file_no"]
+                                        )
+                                    );
+                            }
+                            else
+                            {
+                                $cover_error_flg = "true";
+                                $cover_error = $pdfCover->getErrorMsg();
+                            }
+                        }
+                        // Mod PDF Cover page timing 2015/01/26 K.Matsushita --end--
+                        // Add PDF Cover page 2012/06/15 A.Suzuki --end--
+                        
+                        // check flash save directory exists
+                        $flashDir = $this->getFlashFolder(  $item_attr_session[$ii][$jj]["item_id"],
+                                                            $item_attr_session[$ii][$jj]["attribute_id"],
+                                                            $item_attr_session[$ii][$jj]["file_no"]);
+                        // check flash file exists
+                        // すでに該当するフラッシュファイルがある場合は作成しない。
+                        if( $item_attr_session[$ii][$jj]['display_type'] == 2 &&
+                            (strlen($flashDir) == 0 || 
+                                (!(file_exists($flashDir)) || 
+                                    (
+                                        !(file_exists($flashDir.'/weko.swf')) && 
+                                        !(file_exists($flashDir.'/weko1.swf')) && 
+                                        // Mod multimedia support 2012/10/09 T.Koyasu -start-
+                                        // if exists multimedia file, is not execute pdf convert to flash
+                                        !(file_exists($flashDir.'/weko.flv'))
+                                        // Mod multimedia support 2012/10/09 T.Koyasu -end-
+                                    )
+                                )
+                            )
+                        ){
+                            if($this->isMultimediaFile(
+                                    $item_attr_session[$ii][$jj]["upload"]["mimetype"],
+                                    strtolower($item_attr_session[$ii][$jj]["upload"]["extension"])))
+                            {
+                                if(strtolower($item_attr_session[$ii][$jj]["upload"]["extension"])=="swf" ||
+                                   strtolower($item_attr_session[$ii][$jj]["upload"]["extension"])=="flv")
+                                {
+                                    // swf, flv のファイルはそのままコピー
+                                    // check flash save directory exists
+                                    $flashDir = $this->makeFlashFolder( $item_attr_session[$ii][$jj]["item_id"],
+                                                                        $item_attr_session[$ii][$jj]["attribute_id"],
+                                                                        $item_attr_session[$ii][$jj]["file_no"]);
+                                    if(strlen($flashDir) > 0){
+                                        $flashContentsPath = $flashDir."/weko.".strtolower($item_attr_session[$ii][$jj]["upload"]["extension"]);
+                                        
+                                        // コピー元ファイル取得
+                                        $fileContentsPath = $this->getFileSavePath("file");
+                                        if(strlen($fileContentsPath) == 0){
+                                            // default directory
+                                            $fileContentsPath = BASE_DIR.'/webapp/uploads/repository/files';
+                                        }
+                                        $fileContentsPath .= "/".$item_attr_session[$ii][$jj]["item_id"];
+                                        $fileContentsPath .= "_".$item_attr_session[$ii][$jj]["attribute_id"];
+                                        $fileContentsPath .= "_".$item_attr_session[$ii][$jj]["file_no"];
+                                        $fileContentsPath .= ".".$item_attr_session[$ii][$jj]['upload']['extension'];
+                                        if( file_exists($fileContentsPath) ){
+                                            // file copy
+                                            copy($fileContentsPath, $flashContentsPath);
+                                        } else {
+                                            // Not found file
+                                            $item_attr_session[$ii][$jj]['display_type'] = 0;
+                                            $result = $ItemRegister->updateFileLicense($item_attr_session[$ii][$jj], $error);
+                                        }
+                                    }
+                                }
+                                else
+                                {
+                                    // マルチメディアファイルを flv へ変換
+                                    // 変換元ファイル取得
+                                    $fileContentsPath = $this->getFileSavePath("file");
+                                    if(strlen($fileContentsPath) == 0){
+                                    // default directory
+                                        $fileContentsPath = BASE_DIR.'/webapp/uploads/repository/files';
+                                    }
+                                    $fileContentsPath .= "/".$item_attr_session[$ii][$jj]["item_id"];
+                                    $fileContentsPath .= "_".$item_attr_session[$ii][$jj]["attribute_id"];
+                                    $fileContentsPath .= "_".$item_attr_session[$ii][$jj]["file_no"];
+                                    $fileContentsPath .= ".".$item_attr_session[$ii][$jj]['upload']['extension'];
+                                    $result = $ItemRegister->convertFileToFlv($item_attr_session[$ii][$jj], $error, $fileContentsPath);
+                                    if($result == false)
+                                    {
+                                        // Convert failed
+                                        $item_attr_session[$ii][$jj]['display_type'] = 0;
+                                        $result = $ItemRegister->updateFileLicense($item_attr_session[$ii][$jj], $error);
+                                    }
+                                }
+                            }
+                            else if(!RepositoryCheckFileTypeUtility::isImageFile(
+                                    $item_attr_session[$ii][$jj]["upload"]["mimetype"],
+                                    strtolower($item_attr_session[$ii][$jj]["upload"]["extension"])))
+                            {
+                                if(strlen($prefix_id) > 0){
+                                    // IDサーバと連携している
+                                    // PDFのフラッシュ化処理
+                                    $flash_error = "";
+                                    $url = BASE_URL . "/?action=repository_uri&item_id=".$item_id;
+                                    $id_server = new IDServer($this->Session, $this->Db);
+                                    $result = $id_server->convertToFlash($item_attr_session[$ii][$jj], $url, $flash_error);
+                                    if($result === "true"){
+                                        // フラッシュ化成功
+                                        //$item_attr_session[$ii][$jj]['display_type'] = 2;
+                                    } else {
+                                        // フラッシュ化失敗
+                                        $item_attr_session[$ii][$jj]['display_type'] = 0;
+                                        $result = $ItemRegister->updateFileLicense($item_attr_session[$ii][$jj], $error);
+                                        $flash_error_flg = "true";
+                                        $flash_error = "\"".$item_attr_session[$ii][$jj]['upload']['file_name']."\"";
+                                    }
+                                } else {
+                                    // IDサーバと連携していないためフラッシュ作成不可
+                                    $item_attr_session[$ii][$jj]['display_type'] = 0;
+                                    $result = $ItemRegister->updateFileLicense($item_attr_session[$ii][$jj], $error);
+                                    $flash_error_flg = "true";
+                                    $flash_error = "\"".$item_attr_session[$ii][$jj]['upload']['file_name']."\"";
+                                }
+                            }
+                        }
+                    }
+                }
+            }
+            // Add PDF flash 2010/02/04 A.Suzuki --end--
+            
+            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+            $ItemRegister->updateInsertUserIdForContributor(
+                    intval($this->Session->getParameter("edit_item_id")),
+                    $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
+            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+            
+            // update search table S.Suzuki 2013/11/29 --start--
+            $repositorySearchTableProcessing = new RepositorySearchTableProcessing($this->Session, $this->Db);
+            
+            $repositorySearchTableProcessing->updateSearchTableForItem($item_id, $item_no);
+            // update search table S.Suzuki 2013/11/29 --end--
+            
+            // Add count contents and add whatsnew 2009/02/17 A.Suzuki --start--
+            $whatsnew_flag = false;
+            for($ii=0; $ii<count($indice); $ii++) {
+                // 査読を行わない
+                if($review_flg == 0){
+                    // 自動公開する
+                    if($shown_flg == 1 && $old_shown_status != 1){
+                        // 登録先インデックスの公開状態を取得
+                        // Add tree access control list 2012/02/29 T.Koyasu -start-
+                        // get index to regist is not set access control
+                        $query = "SELECT public_state ".
+                                 "FROM {repository_index} ".
+                                 "WHERE index_id = ? ".
+                                 "AND is_delete = 0 ".
+                                 "AND exclusive_acl_role = ? ". 
+                                 "AND exclusive_acl_group = ? ; ";
+                        $param = array();
+                        $param[] = $indice[$ii]['index_id'];
+                        $param[] = '|-1';
+                        $param[] = '';
+                        // Add tree access control list 2012/02/29 T.Koyasu -end-
+                        $result = $this->Db->execute($query, $param);
+                        if($result === false){
+                            $tmpErrorMsg = $this->Db->ErrorMsg();
+                            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($tmpErrorMsg);
+                            $exception->addError($tmpErrorMsg);
+                            throw $exception;
+                        }
+                        
+                        // インデックスが公開中であるか
+                        if(count($result) == 1 && $result[0]['public_state'] == "1"){
+                            // 親インデックスが公開されているか
+                            if($this->checkParentPublicState($indice[$ii]['index_id'])){
+                                // 所属する公開中インデックスのコンテンツ数を増やす
+                                $whatsnew_flag = true;
+                                $result = $this->addContents($indice[$ii]['index_id']);
+                                if($result === false){
+                                    $tmpErrorMsg = $this->Db->ErrorMsg();
+                                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                                    $exception = new AppException($tmpErrorMsg);
+                                    $exception->addError($tmpErrorMsg);
+                                    throw $exception;
+                                }
+                                // Add private_contents count K.Matsuo 2013/05/07 --start--
+                                // 編集中に非公開コンテンツ数を増やしているので公開コンテンツの場合非公開コンテンツ数を減らす
+                                $result = $this->deletePrivateContents($indice[$ii]['index_id']);
+                                if($result === false){
+                                    $tmpErrorMsg = $this->Db->ErrorMsg();
+                                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                                    $exception = new AppException($tmpErrorMsg);
+                                    $exception->addError($tmpErrorMsg);
+                                    throw $exception;
+                                }
+                                // Add private_contents count K.Matsuo 2013/05/07 --end--
+                            }
+                        }
+                    }
+                }
+            }
+            
+            // 新着情報に追加
+            if($whatsnew_flag){
+                $result = $this->addWhatsnew($item_id, $item_no);
+                if($result === false){
+                    $tmpErrorMsg = $this->Db->ErrorMsg();
+                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($tmpErrorMsg);
+                    $exception->addError($tmpErrorMsg);
+                    throw $exception;
+                }
+            }
+            // Add count contents and add whatsnew 2009/02/17 A.Suzuki --end--
+            
+            // Add review mail setting 2009/09/24 Y.Nakao --start--
+            // 新規査読アイテム登録メール送信処理
+            if($review_flg == 1){
+                // 査読を行う
+                if($review_mail_flg == 1){
+                    // 言語リソース取得
+                    $smartyAssign = $this->Session->getParameter("smartyAssign");
+                    // send review mail
+                    // 査読通知メールを送信する
+                    // 件名
+                    // set subject
+                    $subj = $smartyAssign->getLang("repository_mail_review_subject");
+                    $this->mailMain->setSubject($subj);
+                    
+                    // page_idおよびblock_idを取得
+                    $block_info = $this->getBlockPageId();
+                    // メール本文をリソースから読み込む
+                    // set Mail body
+                    $body = '';
+                    $body .= $smartyAssign->getLang("repository_mail_review_body")."\n\n";
+                    $body .= $smartyAssign->getLang("repository_mail_review_contents")."\n";
+                    $body .= $smartyAssign->getLang("repository_mail_review_title");
+                    if($this->Session->getParameter("_lang") == "japanese"){
+                        if(strlen($base_attr['title']) > 0){
+                            $body .= $base_attr['title'];
+                        } else if(strlen($base_attr['title_english']) > 0){
+                            $body .= $base_attr['title_english'];
+                        } else {
+                            $body .= "no title";
+                        }
+                    } else {
+                        if(strlen($base_attr['title_english']) > 0){
+                            $body .= $base_attr['title_english'];
+                        } else if(strlen($base_attr['title']) > 0){
+                            $body .= $base_attr['title'];
+                        } else {
+                            $body .= "no title";
+                        }
+                    }
+                    
+                    $body .= "\n";
+                    $body .= $smartyAssign->getLang("repository_mail_review_detailurl").$detail_uri."\n";
+                    $body .= "\n";
+                    $body .= $smartyAssign->getLang("repository_mail_review_reviewurl")."\n";
+                    $body .= BASE_URL;
+                    if(substr(BASE_URL,-1,1) != "/"){
+                        $body .= "/";
+                    }
+                    $body .= "?active_action=repository_view_edit_review&page_id=".$block_info["page_id"]."&block_id=".$block_info["block_id"];
+                    $body .= "\n\n".$smartyAssign->getLang("repository_mail_review_close");
+                    $this->mailMain->setBody($body);
+                    // ---------------------------------------------
+                    // 送信メール情報取得
+                    //   送信者のメールアドレス
+                    //   送り主の名前
+                    //   送信先ユーザを取得
+                    // create mail body
+                    //   get send from user mail address
+                    //   get send from user name
+                    //   get send to user
+                    // ---------------------------------------------
+                    $users = array();
+                    $this->getReviewMailInfo($users);
+                    // ---------------------------------------------
+                    // 送信先を設定
+                    // set send to user
+                    // ---------------------------------------------
+                    // 送信ユーザを設定
+                    // $usersの中身
+                    // $users["email"] : 送信先メールアドレス
+                    // $user["handle"] : ハンドルネーム
+                    //                   なければ空白が自動設定される
+                    // $user["type"]   : type (html(email) or text(mobile_email))
+                    //                   なければhtmlが自動設定される
+                    // $user["lang_dirname"] : 言語
+                    //                         なければ現在の選択言語が自動設定される
+                    $this->mailMain->setToUsers($users);
+                    
+                    // ---------------------------------------------
+                    // メール送信
+                    // send confirm mail
+                    // ---------------------------------------------
+                    if(count($users) > 0){
+                        // 送信者がいる場合は送信
+                        $return = $this->mailMain->send();
+                    }
+                     
+                    // 言語リソース開放
+                    $this->Session->removeParameter("smartyAssign");
+                    
+                }
             }
-            else if($this->save_mode == "next")
+            // Add review mail setting 2009/09/24 Y.Nakao --end--
+        }
+        $this->Session->removeParameter('item_entry_flg');
+        
+        // Add new supple item regist 2009/09/01 A.Suzuki --start--
+        // このアイテムのWEKOIDを取得
+        if($this->Session->getParameter("add_supple_flag") == "true"){
+            // Bug Fix WEKO-2014-063 2014/08/07 T.Koyasu --start--
+            if(!isset($repositoryHandleManager))
             {
-                return 'success';
+                $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->accessDate);
             }
-            else
+            $weko_id = $repositoryHandleManager->getSuffix($item_id, $item_no, RepositoryHandleManager::ID_Y_HANDLE);
+            if(strlen($weko_id) == 0)
             {
-                return 'error';
+                $this->Session->setParameter("add_supple_flag", "false");
+            }
+            // Bug Fix WEKO-2014-063 2014/08/07 T.Koyasu --end--
+        }
+        // Add new supple item regist 2009/09/01 A.Suzuki --end--
+        // Add detail search 2013/11/21 K.Matsuo --start--
+        $searchTableProcessing = new RepositorySearchTableProcessing($this->Session, $this->Db);
+        $searchTableProcessing->updateSearchTableForItem($item_id, $item_no);
+        // Add detail search 2013/11/21 K.Matsuo --end--
+        //セッションの初期化
+        $this->Session->removeParameter("edit_flag");
+        $this->Session->removeParameter("edit_item_id");
+        $this->Session->removeParameter("edit_item_no");
+        $this->Session->removeParameter("edit_start_date");
+        $this->Session->removeParameter("delete_file_list");
+        $this->Session->removeParameter('item_pub_date');
+        $this->Session->removeParameter('item_keyword');
+        $this->Session->removeParameter('item_keyword_english');
+        $this->Session->removeParameter("item_type_all");
+        $this->Session->removeParameter("item_attr_type");
+        $this->Session->removeParameter("item_num_cand");
+        $this->Session->removeParameter("option_data");
+        $this->Session->removeParameter("isfile");
+        $this->Session->removeParameter("item_num_attr");
+        $this->Session->removeParameter("item_attr");
+        $this->Session->removeParameter("base_attr");
+        $this->Session->removeParameter("indice");
+        $this->Session->removeParameter("link");
+        $this->Session->removeParameter("link_search");
+        $this->Session->removeParameter("link_searchkeyword");
+        $this->Session->removeParameter("link_searchtype");
+        $this->Session->removeParameter("open_node_index_id_link");
+        $this->Session->removeParameter("open_node_index_id_index");
+        $this->Session->removeParameter("license_master");
+        $this->Session->removeParameter("error_msg");
+        $this->Session->removeParameter("warning");
+        
+        // Add e-person 2013/11/20 R.Matsuura --start--
+        $this->Session->removeParameter("feedback_mailaddress_str");
+        $this->Session->removeParameter("feedback_mailaddress_author_str");
+        $this->Session->removeParameter("feedback_mailaddress_array");
+        $this->Session->removeParameter("feedback_mailaddress_author_array");
+        // Add e-person 2013/11/20 R.Matsuura --end--
+        
+        $this->Session->removeParameter("all_group");
+        $this->Session->removeParameter("user_group");
+        
+        // change index tree 2008/12/03 Y.Nakao --start--
+        $this->Session->removeParameter("view_open_node_index_id_insert_item");
+        $this->Session->removeParameter("view_open_node_index_id_item_link");
+        // change index tree 2008/12/03 Y.Nakao --end--
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+        $this->Session->removeParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID);
+        $this->Session->removeParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID);
+        $this->Session->removeParameter(RepositoryConst::SESSION_PARAM_ITEM_CONTRIBUTOR);
+        $this->Session->removeParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_ERROR_MSG);
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+        
+        $this->Session->removeParameter("edit_jalc_flag");
+        
+        if($cover_error_flg === "true" || $flash_error_flg === "true"){
+            // 詳細画面を表示させるための設定
+            $this->Session->setParameter("item_id_for_detail", $this->Session->getParameter("edit_item_id"));
+            $this->Session->setParameter("item_no_for_detail", $this->Session->getParameter("edit_item_no"));
+            $this->Session->setParameter("search_flg","true");
+            $this->Session->setParameter("workflow_flg", "false");
+            $this->Session->setParameter("serach_screen", "1");
+            $this->Session->setParameter("redirect_flg", "detail");
+            $this->Session->setParameter("redirect_item_id", $item_id);
+            
+            // Add PDF cover page 2012/06/15 A.Suzuki --start--
+            // PDF Cover create failed flag
+            if($cover_error_flg == "true"){
+                $this->Session->setParameter("cover_error", $cover_error);
             }
+            // Add PDF cover page 2012/06/15 A.Suzuki --end--
+            
+            // Flash変換失敗を示すフラグ
+            if($flash_error_flg == "true"){
+                $this->Session->setParameter("flash_error", $flash_error);
+            }
+            
+            // Session情報開放
+            $this->Session->removeParameter("edit_flag");
+            $this->Session->removeParameter("edit_item_id");
+            $this->Session->removeParameter("edit_item_no");
+            $this->Session->removeParameter("return_screen");
+            $this->Session->removeParameter("add_supple_flag");
+            $this->Session->removeParameter("item_id_for_detail");
+            $this->Session->removeParameter("item_no_for_detail");
+        } else {
+            if($this->Session->getParameter("return_screen") != null){
+                // 詳細画面を表示させるための設定
+                $this->Session->setParameter("item_id_for_detail", $this->Session->getParameter("edit_item_id"));
+                $this->Session->setParameter("item_no_for_detail", $this->Session->getParameter("edit_item_no"));
+                $this->Session->setParameter("search_flg","true");
+                // Session情報開放
+                $this->Session->removeParameter("edit_flag");
+                $this->Session->removeParameter("edit_item_id");
+                $this->Session->removeParameter("edit_item_no");
+                if($this->Session->getParameter("return_screen") === "1"){
+                    $this->Session->removeParameter("return_screen");
+                    // ワークフロー画面でないことを示すフラグ
+                    $this->Session->setParameter("workflow_flg", "false");
+                    // 画面右に詳細表示を表示させるフラグ
+                    $this->Session->setParameter("serach_screen", "1");
+                    $this->Session->setParameter("redirect_flg", "detail");
+                    $this->Session->setParameter("redirect_item_id", $item_id);
+
+                } else if($this->Session->getParameter("return_screen") === "2"){
+                    $this->Session->removeParameter("return_screen");
+                    // ワークフロー画面であることを示すフラグ
+                    $this->Session->setParameter("workflow_flg", "true");
+                    $this->Session->setParameter("redirect_flg", "workflow");
+                }
+            } else {
+                $this->Session->removeParameter("edit_flag");
+                $this->Session->removeParameter("edit_item_id");
+                $this->Session->removeParameter("edit_item_no");
+                $this->Session->removeParameter("error_msg");
+                $this->Session->setParameter("redirect_flg", "selecttype");
+            }
+            
+            // Add new supple item regist 2009/09/01 A.Suzuki --start--
+            if($this->Session->getParameter("add_supple_flag") == "true"){
+                $this->Session->setParameter("supple_weko_id", $weko_id);
+                $this->Session->setParameter("redirect_flg", "supple");
+                $this->Session->removeParameter("item_id_for_detail");
+                $this->Session->removeParameter("item_no_for_detail");
+                $this->Session->removeParameter("search_flg","true");
+            }
+            // Add new supple item regist 2009/09/01 A.Suzuki --end--
+        }
+        
+        return $returnString;
+    }
+    
+    /**
+     * [[機能説明]]
+     * 年月日のデータ(int)を日付文字列にして返す
+     */
+    private function generateDateStr($year, $month, $day){
+        $str_year = strval($year);
+        $str_month = strval($month);
+        $str_day = strval($day);
+        // 0付加
+        if(intval($month)<10){ $str_month = '0' . $str_month; }
+        if(intval($day)<10){ $str_day = '0' . $str_day; }
+        // 結合
+        return $str_year . '-' . $str_month . '-' . $str_day . ' ' . '00:00:00.000';
     }
 }
 ?>
diff --git a/repository/action/main/item/confirm/maple.ini b/repository/action/main/item/confirm/maple.ini
index f653fab..25822f5 100644
--- a/repository/action/main/item/confirm/maple.ini
+++ b/repository/action/main/item/confirm/maple.ini
@@ -4,14 +4,18 @@ request = POST
 
 [ValidateDef]
 authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
-linkitem_name
-linkitem_id
 
-[action]
+[Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
+mailMain = "ref:mailMain"
 
 [View]
-success = "action:repository_view_main_item_confirm"
-stay = "action:repository_view_main_item_editdoi"
-error = "action:repository_view_main_item_editdoi"
+selecttype = "action:repository_view_main_item_selecttype"
+files = "action:repository_view_main_item_editfiles"
+texts = "action:repository_view_main_item_edittexts"
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+redirect = "action:repository_view_common_redirect"
+error = "action:repository_view_main_item_confirm"
diff --git a/repository/action/main/item/detail/Detail.class.php b/repository/action/main/item/detail/Detail.class.php
index 69613e0..a3ba5f7 100644
--- a/repository/action/main/item/detail/Detail.class.php
+++ b/repository/action/main/item/detail/Detail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Detail.class.php 567 2014-05-21 08:30:29Z ivis $
+// $Id: Detail.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -15,6 +15,7 @@
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/IDServer.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
  * [[機能説明]]
@@ -214,76 +215,18 @@ class Repository_Action_Main_Item_Detail extends RepositoryAction
                 // Add get suffixID button for detail page 2009/09/03 A.Suzuki --end--
                 
                 // Add count contents 2008/12/22 A.Suzuki --start--
-                // check shown_status
-                $query = "SELECT shown_status ".
-                         "FROM ". DATABASE_PREFIX ."repository_item ".
-                         "WHERE item_id = ? AND ".
-                         "item_no = ? AND ".
-                         "is_delete = 0; ";
-                $params = null;
-                $params[] = $item_id;   // item_id
-                $params[] = $item_no;   // item_no
-                $result = $this->Db->execute($query,$params);
-                if($result === false){
-                    $errNo = $this->Db->ErrorNo();
-                    $errMsg = $this->Db->ErrorMsg();
-                    $this->Session->setParameter("error_code", $errMsg);
-                    return false;
-                }
-                $shown_status = $result[0]['shown_status'];
-                // 公開中である場合コンテンツ数を減らす
-                $query = "SELECT pos.index_id, idx.public_state ".
-                         "FROM ". DATABASE_PREFIX ."repository_position_index AS pos, ".
-                         DATABASE_PREFIX."repository_index AS idx ".
-                         "WHERE pos.item_id = ? ".
-                         "AND pos.item_no = ? ".
-                         "AND pos.is_delete = ? ".
-                         "AND pos.index_id = idx.index_id ".
-                         "AND idx.is_delete = ? ";
-                $params = null;
-                $params[] = $item_id;   // item_id
-                $params[] = $item_no;   // item_no
-                $params[] = 0;
-                $params[] = 0;
-                $result = $this->Db->execute($query,$params);
-                if($result === false){
-                    $errNo = $this->Db->ErrorNo();
-                    $errMsg = $this->Db->ErrorMsg();
-                    $this->Session->setParameter("error_code", $errMsg);
-                    return false;
-                }
-                if($shown_status == 1){
-                    // Fix contents update action 2010/07/02 Y.Nakao --start--
-                    for($ii=0; $ii<count($result); $ii++){
-                        // check public status
-                        if($result[$ii]['public_state'] == "1" && $this->checkParentPublicState($result[$ii]['index_id'])){
-                            $this->deleteContents($result[$ii]['index_id']);
-                        } else {
-                            $this->deletePrivateContents($result[$ii]['index_id']);
-                        }
-                    }
-                    // Fix contents update action 2010/07/02 Y.Nakao --end--
-                    
-                    // Add send item infomation to whatsnew module 2009/01/27 A.Suzuki --start--
-                    // 新着情報から削除する
-                    $result = $this->deleteWhatsnew($this->item_id);
-                    // Add send item infomation to whatsnew module 2009/01/27 A.Suzuki --end--
-                    
-                    if($result === false){
-                        $this->Session->setParameter("error_msg",$error_msg);
-                        //エラー処理を行う
-                        $exception = new RepositoryException( "ERR_MSG_xxx-xxx1", 001 );    //主メッセージとログIDを指定して例外を作成
-                        //$DetailMsg = null;                              //詳細メッセージ文字列作成
-                        //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1, $埋込み文字1, $埋込み文字2 );
-                        //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-                        $this->failTrans();                                 //トランザクション失敗を設定(ROLLBACK)
-                        throw $exception;
-                    }
-                } else {
-                    for($ii=0; $ii<count($result); $ii++){
-                    	$this->deletePrivateContents($result[$ii]['index_id']);
-                    }
-                }
+                
+                // Fix contents num of index 2015/05/15 K.Matsushita --start --
+                $this->infoLog("businessItemdelete", __FILE__, __CLASS__, __LINE__);
+                BusinessFactory::initialize($this->Session, $this->Db, $this->TransStartDate);
+                $itemDelete = BusinessFactory::getFactory()->getBusiness("businessItemdelete");
+                
+                // 公開インデックス取得クエリ
+                $itemDelete->repository_admin_base = $this->repository_admin_base;
+                $itemDelete->repository_admin_room = $this->repository_admin_room;
+                $itemDelete->updateContentsOfIndex($this->item_id, $this->item_no, $this->Session);
+                // Fix contents num of index 2015/05/15 K.Matsushita --end --
+                
                 // Add count contents 2008/12/22 A.Suzuki --end--
                 
                 // 削除実行
@@ -395,12 +338,30 @@ class Repository_Action_Main_Item_Detail extends RepositoryAction
             return false;
         }
         
+        // Add check browsing rights of index K.Matsushita 2015/05/15 --start--
+        // ビジネスクラスのアイテム削除処理のインスタンス生成
+        $this->infoLog("businessItemdelete", __FILE__, __CLASS__, __LINE__);
+        BusinessFactory::initialize($this->Session, $this->Db, $this->TransStartDate);
+        $itemDelete = BusinessFactory::getFactory()->getBusiness("businessItemdelete");
+        
+        $itemDelete->repository_admin_base = $this->repository_admin_base;
+        $itemDelete->repository_admin_room = $this->repository_admin_room;
+        
+        // 公開インデックスを探すクエリを作成する
+        $publicIndexQuery = $itemDelete->getPublicIndexQuery($this->Session);
+        
         if($this->shown_status == 1){
             // Add check unpublic index 2009/02/05 A.Suzuki --start--
+            
+            // アイテムの公開状況が公開に変更された
             $pub_index_flag = false;
             for($ii=0; $ii<count($result); $ii++){
+                
+                $index_status = $this->checkIndexStatus( $result[$ii]['index_id'], $publicIndexQuery );
+                
                 // 公開中のインデックスがあるか
-                if($result[$ii]['public_state'] == "1"){
+                if( $result[$ii]['public_state'] == "1" && count($index_status) > 0 ){
+                    
                     // 親インデックスが公開されているか
                     if($this->checkParentPublicState($result[$ii]['index_id'])){
                         $pub_index_flag = true;
@@ -417,10 +378,15 @@ class Repository_Action_Main_Item_Detail extends RepositoryAction
                 $this->deleteWhatsnew($this->item_id);
             }
             // Add check unpublic index 2009/02/05 A.Suzuki --end--
-        }else{
+        }
+        else
+        {
             for($ii=0; $ii<count($result); $ii++){
+                
+                $index_status = $this->checkIndexStatus( $result[$ii]['index_id'], $publicIndexQuery );
+                
                 // 公開中のインデックスがあるか
-                if($result[$ii]['public_state'] == "1"){
+                if($result[$ii]['public_state'] == "1" && count($index_status) > 0 ){
                     // 親インデックスが公開されているか
                     if($this->checkParentPublicState($result[$ii]['index_id'])){
                         $this->deleteContents($result[$ii]['index_id']);
@@ -431,9 +397,37 @@ class Repository_Action_Main_Item_Detail extends RepositoryAction
             // Add send item infomation to whatsnew module 2009/01/27 A.Suzuki
             $this->deleteWhatsnew($this->item_id);
         }
+        
+        // Add check browsing rights of index K.Matsushita 2015/05/15 --end--
+        
         // Add count contents 2008/12/22 A.Suzuki --end--
         
         return true;
     }
+    
+    /**
+     * ベース権限、ルーム権限、グループ権限なども含めてインデックスの公開状況を確認する
+     * @param $index_id インデックスID
+     * @return $result クエリ実行結果
+     */
+    private function checkIndexStatus( $index_id, $publicIndexQuery ){
+        
+        $query = " SELECT index_id ".
+                " FROM ". DATABASE_PREFIX ."repository_index ".
+                " WHERE index_id = ".$index_id.
+                " AND index_id IN(".$publicIndexQuery.") ; ";
+        
+        $result = $this->Db->execute($query);
+        if( $result === false )
+        {
+            $errNo = $this->Db->ErrorNo();
+            $errMsg = $this->Db->ErrorMsg();
+            $this->Session->setParameter("error_code", $errMsg);
+            return false;
+        }
+        
+        return $result;
+    }
+    
 }
 ?>
diff --git a/repository/action/main/item/editdoi/Editdoi.class.php b/repository/action/main/item/editdoi/Editdoi.class.php
index d48765c..af0c609 100644
--- a/repository/action/main/item/editdoi/Editdoi.class.php
+++ b/repository/action/main/item/editdoi/Editdoi.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editdoi.class.php 600 2014-08-06 04:41:16Z ivis $
+// $Id: Editdoi.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,152 +13,147 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：DOI付与画面からの入力処理アクション
  *
- * @package     [[package名]]
  * @access      public
  */
 class Repository_Action_Main_Item_Editdoi extends RepositoryAction
 {
-    // 使用コンポーネントを受け取るため
-    public $Session = null;
-    public $Db = null;
+    // リクエストパラメーター
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     * @var string
+     */
+    public $save_mode = null;
+    
+    /**
+     * JaLC DOI チェック情報
+     * @var string
+     */
+    public $entry_jalcdoi_checkbox = null;
+    
+    /**
+     * JaLC DOI URI
+     * @var string
+     */
+    public $entry_jalcdoi_hidden = null;
+    
+    /**
+     * Cross Ref チェック情報
+     * @var string
+     */
+    public $entry_crossref_checkbox = null;
     
-    public $item_relation_select = null;   // アイテム間リンク：関係性
+    /**
+     * Cross Ref URI
+     * @var string
+     */
+    public $entry_crossref_hidden = null;
+    
+    /**
+     * DataCite チェック情報
+     * @var string
+     */
+    public $entry_datacite_checkbox = null;
     
-    public $OpendIds = null;       // open index ids(delemit is ",")
-    public $CheckedIds = null;     // check index ids(delemit is "|")
-    public $CheckedNames = null;   // check index names(delemit is "|")
+    /**
+     * DataCite URI
+     * @var string
+     */
+    public $entry_datacite_hidden = null;
     
-    public $save_mode = null;      // 'stay' : save
-                                // 'next' : go next page
+    /**
+     * Library JaLC DOI 入力値
+     * @var string
+     */
+    public $entry_library_jalcdoi_text = null;
     
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * Library JaLC DOI URI
+     * @var string
      */
-    function executeForWeko()
+    public $entry_library_jalcdoi_hidden = null;
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
+    
+    /**
+     * 実行処理
+     * @see RepositoryAction::executeApp()
+     */
+    public function executeApp()
     {
-        $smarty_assign = $this->Session->getParameter("smartyAssign");
-        $err_msg = array();
-        $warning = "";
-        $ItemRegister = new ItemRegister($this->Session, $this->Db);
-        
-        $link = $this->Session->getParameter("link");
-        $relation = '';
+        // セッション情報取得
+        $item_id = intval($this->Session->getParameter("edit_item_id"));
+        $item_no = intval($this->Session->getParameter("edit_item_no"));
         
-        for($ii=0; $ii<count($link); $ii++){
-            if($this->item_relation_select[$ii]!=' ') {
-                $relation = $this->item_relation_select[$ii];
-            }else{
-                $relation = '';
-            }
-            $link[$ii]['relation'] = $relation;
+        // インスタンス作成
+        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->accessDate);
+        $suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
+        // Add Library JaLC DOI
+        if(isset($this->entry_library_jalcdoi_text) && strlen($this->entry_library_jalcdoi_text) > 0)
+        {
+            $repositoryHandleManager->registLibraryJalcdoiSuffix($item_id, $item_no, $this->entry_library_jalcdoi_text);
         }
-        $this->Session->setParameter("link", $link);
-        
-        // Add join set insert index and set item links 2008/12/17 Y.Nakao --start--
-        // set session to index open info
-        if($this->OpendIds != null && $this->OpendIds != '') {  
-            $arOpenIndexId = array();
-            $arOpenIndexId = explode(",", $this->OpendIds);
-            $this->Session->removeParameter("open_node_index_id_index");
-            $this->Session->setParameter("open_node_index_id_index", $arOpenIndexId);
+        // Add JaLC DOI
+        else if(isset($this->entry_jalcdoi_checkbox) && strlen($this->entry_jalcdoi_checkbox) > 0 && strlen($suffix) > 0)
+        {
+            $repositoryHandleManager->registJalcdoiSuffix($item_id, $item_no, $suffix);
         }
-        // set session to check index info
-        $indice = array();
-        if( $this->CheckedIds != null && $this->CheckedIds != '' ){
-            $checked_ids = explode('|', $this->CheckedIds);
-            $checked_names = explode('|', str_replace("&#039;", "'", html_entity_decode($this->CheckedNames)));
-            for($ii=0; $ii<count($checked_ids); $ii++) {
-                array_push($indice, array(
-                        'index_id' => $checked_ids[$ii],
-                        'index_name' => $checked_names[$ii])
-                        );
-            }
+        // Add Cross Ref
+        else if(isset($this->entry_crossref_checkbox) && strlen($this->entry_crossref_checkbox) > 0 && strlen($suffix) > 0)
+        {
+            $repositoryHandleManager->registCrossrefSuffix($item_id, $item_no, $suffix);
         }
-        
-        $ItemRegister->setInsUserId($this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
-        $indice = $this->addPrivateTreeInPositionIndex($indice, $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
-        
-        $this->Session->setParameter("indice", $indice);
-        // check index, you most check index 1 more
-        if(count($indice) < 1) {
-            $msg = $smarty_assign->getLang("repository_item_error_index");
-            array_push($err_msg, $msg);
+        // Add DataCite 2015/02/09 K.Sugimoto --start--
+        // Add DataCite
+        else if(isset($this->entry_datacite_checkbox) && strlen($this->entry_datacite_checkbox) > 0 && strlen($suffix) > 0)
+        {
+            $repositoryHandleManager->registDataciteSuffix($item_id, $item_no, $suffix);
         }
-        // Add join set insert index and set item links 2008/12/17 Y.Nakao --end--
-        
-        $item["item_id"] = intval($this->Session->getParameter("edit_item_id"));
-        $item["item_no"] = intval($this->Session->getParameter("edit_item_no"));
+        // Add DataCite 2015/02/09 K.Sugimoto --end--
         
-        $result = $ItemRegister->entryPositionIndex($item, $indice, $error);
-        if($result === false){
-            array_push($err_msg, $error);
-            $this->Session->setParameter("error_msg", $err_msg);
-            return 'error';
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "doi",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+        );
+        $ret = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
         }
-        $result = $ItemRegister->entryReference($item, $link, $error);
-        if($result === false){
-            array_push($err_msg, $error);
-            $this->Session->setParameter("error_msg", $err_msg);
-            return 'error';
-        }
-        
-        $ItemRegister->updateInsertUserIdForContributor(
-                intval($this->Session->getParameter("edit_item_id")),
-                $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
         
-        
-        $item_id = $item["item_id"];
-        $item_no = $item["item_no"];
-        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
-        // set y handle suffix
-        $base_attr = $this->Session->getParameter("base_attr");
-        $repositoryHandleManager->setSuffix($base_attr['title'], $item_id, $item_no);
-        // check this item can be granted doi
-        $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
-        $displays_jalcdoi_flag = $CheckDoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_JALC_DOI);
-        $displays_crossref_flag = $CheckDoi->checkDoiGrant($item_id, $item_no, Repository_Components_Checkdoi::TYPE_CROSS_REF);
-        // check this item was already granted doi or not
-        $doi_status = $CheckDoi->getDoiStatus($item_id, $item_no);
-        if($this->save_mode == "next" && ($displays_jalcdoi_flag || $displays_crossref_flag || $doi_status >= 1))
-        {
-            // next is doi grant display
-            $this->save_mode = "next_doi";
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
         }
         
-        $this->Session->removeParameter("error_msg");
-        $this->Session->removeParameter("warning");
-        if(count($err_msg)>0){
-            // 入力にエラーがあるときは画面遷移しない
-            $this->save_mode = "stay";
-        }
-        if($this->save_mode == "stay"){
-            $this->Session->setParameter("error_msg", $err_msg);
-            $this->Session->setParameter("warning", $warning);
-            return 'stay';
-        } else if($this->save_mode == "next" || $this->save_mode == "next_doi"){
-            $this->Session->removeParameter("search_index_id_link");
-            $this->Session->removeParameter("link_searchkeyword");
-            $this->Session->removeParameter("link_search");
-            $this->Session->removeParameter("view_open_node_index_id_item_link");
-            if($this->save_mode == "next_doi")
-            {
-                return 'editdoi';
-            }
-            else
-            {
-                return 'success';
-            }
-        } else {
-            return 'error';
-        }
+        return $ret;
     }
 }
 ?>
diff --git a/repository/action/main/item/editdoi/maple.ini b/repository/action/main/item/editdoi/maple.ini
index 152a95b..ade4ede 100644
--- a/repository/action/main/item/editdoi/maple.ini
+++ b/repository/action/main/item/editdoi/maple.ini
@@ -7,12 +7,15 @@ authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
 linkitem_name
 linkitem_id
 
-[action]
+[Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
 
 [View]
-success = "action:repository_view_main_item_confirm"
-editdoi = "action:repository_view_main_item_editdoi"
-stay = "action:repository_view_main_item_editlinks"
-error = "action:repository_view_main_item_editlinks"
+selecttype = "action:repository_view_main_item_selecttype"
+files = "action:repository_view_main_item_editfiles"
+texts = "action:repository_view_main_item_edittexts"
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+error = "action:repository_view_main_item_editdoi"
diff --git a/repository/action/main/item/editfiles/Editfiles.class.php b/repository/action/main/item/editfiles/Editfiles.class.php
index 751d987..290b02d 100644
--- a/repository/action/main/item/editfiles/Editfiles.class.php
+++ b/repository/action/main/item/editfiles/Editfiles.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editfiles.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Editfiles.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,1104 +12,743 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
-
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
 
 /**
- * [[アイテム登録：ファイル編集画面、もしくは詳細情報入力画面へ遷移する]]
+ * アイテム登録：ファイル選択画面からの入力処理アクション
  *
  * @package     [[package名]]
  * @access      public
- * @version 1.0 新規作成
- *          2.0 登録フロー表示改善対応 2008/06/26 Y.Nakao  
  */
 class Repository_Action_Main_Item_Editfiles extends RepositoryAction
 {
-    // 使用コンポーネントを受け取るため
-    var $usersView = null;
+    // リクエストパラメーター
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     *   'add_row'      : 属性の数を増やす
+     *   'up_row'       : 属性を入れ替える (attridx-th属性が上に)
+     *   'down_row'     : 属性を入れ替える (attridx-th属性が下に)
+     *   'delete_file'  : アップロード済みのファイルを削除
+     * @var string
+     */
+    public $save_mode = null;
     
-    var $itemtype_id = null;    // アイテムタイプID(新規作成時)
-    var $item_id = null;        // アイテムID(既存編集時)
-    var $item_no = null;        // アイテムNo(既存編集時)
-    var $filelist = null;
-    // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --start--
-    var $return_screen = null;  // アイテム詳細画面から来た場合：1、ワークフロー画面から来た場合：2
-    // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --end--
+    /**
+     * 処理対象のメタデータ番号
+     * @var string
+     */
+    public $target = null;
     
-    // ワークフローの表示タブ情報 2009/07/13 A.Suzuki --start--
-    var $workflow_active_tab = null;
-    // ワークフローの表示タブ情報 2009/07/13 A.Suzuki --end--
+    /**
+     * 処理対象の属性番号
+     * @var string
+     */
+    public $attridx = null;
     
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * ファイルのid配列
+     *   ("TILL", "NO", "YES"), ファイル入力欄の数と対応
+     * @var array
      */
-    function execute()
-    {   
-        $istest = false;        // テスト用フラグ
-        //-----------------------------------------------------------------------
-        // セッション情報一覧
-        // 【★新規作成･編集中で普遍な情報】 : 本アクションで初期設定して以降、DB登録もしくは更新まで普遍な情報である。
-        // 1.アイテムタイプ (1レコード) : "item_type_all"[''], アイテムタイプのレコードをそのまま保存したものである。
-        // 2.アイテム属性タイプ (Nレコード, Order順) : "item_attr_type"[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
-        // 3.アイテム属性選択肢数 (N) : "item_num_cand"[N], 選択肢のない属性タイプは0を設定
-        // 4.アイテム属性選択肢 (N): "option_data"[N][M], N属性タイプごとの選択肢。Mはアイテム属性選択肢数に対応。0～        
-        // X.ファイル属性フラグ : "isfile", 0:file, thumbnailなし, 1:thumbnailのみあり, 2:"file"あり     
-        // 【★アイテム編集で変化するメタデータ情報】 : 編集過程で逐次変化していく情報である。
-        // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
-        // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
-        // 【★アイテム編集で変化するアイテム基本情報】 : 編集過程で逐次変化していく情報である。
-        // X.現在のアイテム基本情報のデータ : "base_attr"[2], (今のところタイトルと言語のユーザー入力値)
-        // 【★インデックス選択とリンク設定情報】 : アイテムファミリー外の設定に必要
-        // X.現在選択中のインデックス配列    : "indice"[L], L : 関連付けるインデックスの数, キーワードとインデックスIDをおさえておけばよいか。
-        // X.現在選択中のリンクアイテム配列 : "link"[L], L : リンクを張るアイテムの数, アイテム名とアイテムIDをおさえておけばよいか。(いや、どうせDB検索と絡むのでレコード全部)
-        // 【★その他】
-        // X.ライセンスマスタ  : license_master
-        // X.処理モード : edit_flag (0:新規作成, 1:既存編集)
-        // X.編集中のアイテムID : edit_item_id (既存編集時のみ)
-        // X.編集中のアイテムNO : edit_item_no (既存編集時のみ)
-        // X.DB登録済み削除ファイルリスト : delete_file_list (既存編集時のみ)
-        // X.アイテム公開日 : item_pub_date
-        // X.アイテムキーワード : item_keyword
-        // X.インデックス選択画面のツリー開閉情報 : open_node_index_id_link
-        // X.アイテム間リンク設定画面のツリー開閉情報 : open_node_index_id_index
-        // ---------------------------------------------------------------------- 
-        try {
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                throw $exception;
-            }
-            
-            // Set NameAuthority Class
-            $NameAuthority = new NameAuthority($this->Session, $this->Db);
-            
-            // Init Session
-            $this->Session->removeParameter("filelist");
-            
-            // リクエストパラメタから処理モード設定
-            // ※ただし、セッションに処理フラグがある場合は読み込まない
-            $item_type = null;
-            $item_attr_type = null;
-            $Result_List = array();     // DBから取得したレコードの集合
-            $Error_Msg = '';            // エラーメッセージ
-            $edit_flag = 0;     // 処理モード (0:新規作成, 1:既存編集)
-            $user_id = $this->Session->getParameter("_user_id");
-            if($this->itemtype_id != null){
-                // 新規登録モード
-                $edit_flag = 0;     
-                // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --start--
-                // DB登録後に戻る画面情報
-                $this->Session->removeParameter("return_screen");
-                // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --end--
-                // リクエストパラメタにアイテムタイプIDがあれば、アイテムタイプ情報を取得してセッションに保存
-                //アイテムタイプ名をDBから取得
-                $params = array("item_type_id" => $this->itemtype_id, 'is_delete'=>0);
-                $item_type = $this->Db->selectExecute("repository_item_type",$params);          
-                // アイテムタイプレコードをセッションに保存 (kawa)
-                $item_type_info = array('item_type_name' => $item_type[0]['item_type_name'],
-                                        'item_type_id' => $item_type[0]['item_type_id']
-                                  );
-                $this->Session->setParameter("item_type_all", $item_type_info);
-                // アイテム属性タイプをDBから取得
-                $item_attr_type = $this->Db->selectExecute("repository_item_attr_type",$params);            
-                if ($item_attr_type === false) {
-                    if($istest) { echo $Error_Msg . "<br>"; }
-                    return 'error';
-                }
-                $this->Session->setParameter("edit_start_date", $this->TransStartDate);     // 編集基準時間を保存
-            } elseif($this->item_id != null && $this->item_no != null) {
-                // 既存編集モード
-                $edit_flag = 1;
-                
-                // Add check edit user auth 2011/06/02 A.Suzuki --start--
-                $smartyAssign = $this->Session->getParameter("smartyAssign");
-                if(!$this->checkAuthForEditItem($user_id, $this->item_id)){
-                     // uneditable user
-                     echo $smartyAssign->getLang("_invalid_auth");
-                     $this->exitAction();
-                     exit();
-                }
-                // Add check edit user auth 2011/06/02 A.Suzuki --end--
-                
-                // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --start--
-                // DB登録後に戻る画面情報
-                $this->Session->setParameter("return_screen", $this->return_screen);
-                // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --end--
-                // ワークフローの表示タブ情報 2009/07/13 A.Suzuki --start--
-                $this->Session->setParameter("repository_workflow_active_tab", $this->workflow_active_tab);
-                // ワークフローの表示タブ情報 2009/07/13 A.Suzuki --end--
-                // アイテム情報を取得
-                $result = $this->getItemData($this->item_id, $this->item_no, $Result_List, $Error_Msg, true);
-                if($result === false){
-                    $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                    $exception->setDetailMsg( $ErrorMsg );         //詳細メッセージ設定
-                    throw $exception;
-                }
-                // Add e-person R.Matsuura 2013/11/21 --start--
-                // get author send feedback mail
-                $authorData = $this->getFeedbackAuthor($this->item_id, $this->item_no);
-                if(count($authorData) > 0)
-                {
-                    $result = $this->setFeedbackAuthor($authorData);
+    public $input_ids_file = null;
+    
+    /**
+     * サムネイルのid配列
+     *   ("TILL", "NO", "YES"), サムネイル入力欄の数と対応
+     * @var array
+     */
+    public $input_ids_thumbnail = null; 
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
+    
+    /**
+     * 実行処理
+     * @see RepositoryAction::executeApp()
+     */
+    protected function executeApp()
+    {
+        // Uploadアクションでサーバに上げたファイルのUploadレコードを取得
+        // これは前ページのファイル入力項の数だけ渡る(空白、エラー分を含む)
+        $filelist = $this->Session->getParameter("filelist");
+        
+        // セッション情報取得
+        $item_attr_type = $this->Session->getParameter("item_attr_type");   // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
+        $item_num_attr = $this->Session->getParameter("item_num_attr");     // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
+        $item_attr = $this->Session->getParameter("item_attr");             // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
+        $edit_start_date = $this->Session->getParameter("edit_start_date"); // X.アイテム公開日 : item_pub_date
+        $edit_flag = $this->Session->getParameter("edit_flag");
+        $ItemRegister = new ItemRegister($this->Session, $this->Db);
+        $base_attr = $this->Session->getParameter("base_attr");
+        $item_type_all = $this->Session->getParameter("item_type_all");
+        $smarty_assign = $this->Session->getParameter("smartyAssign");
+        $license_master = $this->Session->getParameter("license_master");
+        $delete_file_list = $this->Session->getParameter("delete_file_list");
+        if(!isset($delete_file_list) || !is_array($delete_file_list))
+        {
+            $delete_file_list = array();
+        }
+        
+        // delete file recorde
+        $error_flg = false;
+        // sort file no
+        //2013/6/17 A.Jin --実ファイルファイル削除処理は「保存」「次へ」ボタン押下時に行うように修正
+        if($this->save_mode != 'add_row' && $this->save_mode != 'up_row' && $this->save_mode != 'down_row' && $this->save_mode != 'delete_file'){
+            for($ii=0; $ii<count($delete_file_list); $ii++){
+                if($delete_file_list[$ii]["input_type"] == "file"){
+                    $result = $ItemRegister->deleteFile($delete_file_list[$ii], false, $error);
+                } else if($delete_file_list[$ii]["input_type"] == "file_price"){
+                    $result = $ItemRegister->deleteFile($delete_file_list[$ii], true, $error);
+                } else if($delete_file_list[$ii]["input_type"] == "thumbnail"){
+                    $result = $ItemRegister->deleteThumbnail($delete_file_list[$ii], $error);
                 }
-                // Add e-person R.Matsuura 2013/11/21 --end--
-                
-                // 所属インデックス取得
-                $result = $this->getItemIndexData($this->item_id, $this->item_no, $Result_List,$Error_Msg);
-                if($result === false){
-                    $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                    $exception->setDetailMsg( $ErrorMsg );         //詳細メッセージ設定
-                    throw $exception;
-                } 
-                // 参照取得
-                $result = $this->getItemReference($this->item_id, $this->item_no, $Result_List,$Error_Msg);
                 if($result === false){
-                    $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                    $exception->setDetailMsg( $ErrorMsg );         //詳細メッセージ設定
-                    throw $exception;
+                    $this->addErrMsg($error);
+                    $error_flg = true;
                 }
-                // アイテム更新日精査
-                if( $this->TransStartDate < $Result_List['item'][0]['mod_date'] ) {
-                    $this->Session->setParameter("error_msg", "error : probably this item was updated by other admin."); 
-                    $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                    $exception->setDetailMsg( "error : probably this item was updated by other admin.");         //詳細メッセージ設定
-                    throw $exception;
-                }
-                // 値のコピー
-                $this->itemtype_id = $Result_List['item_type'][0]['item_type_id'];
-                $item_type_info = array('item_type_name' => $Result_List['item_type'][0]['item_type_name'],
-                                        'item_type_id' => $Result_List['item_type'][0]['item_type_id']
-                                  );
-                $this->Session->setParameter("item_type_all", $item_type_info);
-                $item_attr_type = $Result_List['item_attr_type'];
-                // 編集中のアイテムID, NOを保存
-                $this->Session->setParameter("edit_item_id", $this->item_id);
-                $this->Session->setParameter("edit_item_no", $this->item_no);
-                $this->Session->setParameter("delete_file_list", array());
-                //$this->Session->setParameter("edit_start_date", $Result_List['item'][0]['mod_date']);     // 編集基準時間 = 編集開始時のアイテムの最終更新日
-                $this->Session->setParameter("edit_start_date", $this->TransStartDate); // 編集開始時間
-            } else {
-                // イリーガルな遷移
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                throw $exception;
-            }
-            $this->Session->setParameter("edit_flag", $edit_flag);
-                        
-            // ライセンスマスタを保存
-            $license_master = $this->Db->selectExecute("repository_license_master", array('is_delete'=>0));         
-            if ($license_master === false) {
-                return 'error';
-            }
-            $this->Session->setParameter("license_master",$license_master);
-            // 現在のアイテム基本情報のデータ : "base_attr"[2(今のところタイトルと言語)](kawa)
-            $lang = 'en';
-            if($this->Session->getParameter("_lang") == "japanese"){
-                $lang = 'ja';
             }
-            $base_attr = array(
-                "title" => '',
-                "title_english" => '',
-                "language" => $lang
-            );
-//          $now = mktime();            // 現在時刻(タイムスタンプ)
-//          $item_pub_date = array(
-//                          'year' => intval(date('Y',$now)),
-//                          'month' => intval(date('m',$now)),
-//                          'day' => intval(date('d',$now)));
-            $DATE = new Date();
-            $item_pub_date = array(
-                            'year' => $DATE->getYear(),
-                            'month' => $DATE->getMonth(),
-                            'day' => $DATE->getDay());
-            
-            $item_keyword = '';         // アイテムキーワード
-            $item_keyword_english = ''; // アイテムキーワード
-            $item_element = array();    // アイテム属性タイプ
-            $item_num_cand = array();   // アイテム属性選択肢数
-            $option_data = array();     // アイテム属性選択肢
-            $item_contributor = null;   // Contributor
-            $show_no = 1;
-            // アイテム属性タイプ情報を表示順に並び換える。
-            // またselect, radioの場合は選択肢の数と
-            for ($ii = 0; $ii < count($item_attr_type); $ii++) {
-                for ($ii2 = 0; $ii2 < count($item_attr_type); $ii2++) {
-                    if ($item_attr_type[$ii2]['show_order'] == $show_no) {
-                        $num_cand = 0;      // 選択肢の数
-                        $options = array(); // 選択肢
-                        // アイテム属性タイプの共通項目の設定
-                        $params_attr = array(
-                                'attribute_id' => $item_attr_type[$ii2]['attribute_id'],
-                                'attribute_name' => $item_attr_type[$ii2]['attribute_name'],
-                                'input_type' => $item_attr_type[$ii2]['input_type'],
-                                'is_required' => $item_attr_type[$ii2]['is_required'],
-                                'plural_enable' => $item_attr_type[$ii2]['plural_enable'],
-                                'line_feed_enable' => $item_attr_type[$ii2]['line_feed_enable'],
-                                'plural_enable' => $item_attr_type[$ii2]['plural_enable'],
-                                'dublin_core_mapping' => $item_attr_type[$ii2]['dublin_core_mapping'],
-                                'junii2_mapping' => $item_attr_type[$ii2]['junii2_mapping'],
-                                'lom_mapping' => $item_attr_type[$ii2]['lom_mapping'],
-                                'display_lang_type' => $item_attr_type[$ii2]['display_lang_type']
-                        );
-                        // check, radioは選択肢とその数を取得
-                        if($item_attr_type[$ii2]['input_type'] == "select" ||
-                           $item_attr_type[$ii2]['input_type'] == "checkbox" ||
-                           $item_attr_type[$ii2]['input_type'] == "radio") {
-                            $params_cand = array(
-                                    'item_type_id'=>$this->itemtype_id,
-                                    'attribute_id'=>$item_attr_type[$ii2]['attribute_id'],
-                                    'is_delete'=>0);
-                            $option = $this->Db->selectExecute("repository_item_attr_candidate",$params_cand);
-                            if ($option === false) {
-                                return 'error';
+            $this->Session->removeParameter("delete_file_list");
+            $delete_file_list = array();
+        }
+        
+        // ファイルのデフォルト公開日計算 (編集開始日)
+        $def_pub_year = '';
+        $def_pub_month = '';
+        $def_pub_day = '';
+        $list = split(' ', $edit_start_date);
+        $list = split('[/.-]', $list[0]);
+        $def_pub_year = $list[0];
+        $def_pub_month = $list[1];
+        $def_pub_day = $list[2];
+        // 今回新たなファイル入力があったか否か検査
+        if($filelist != null &&
+           (($this->input_ids_file != null && count($this->input_ids_file)>0 ) ||
+           ($this->input_ids_thumbnail != null && count($this->input_ids_thumbnail)>0)))
+        {
+            // カウンタ
+            $cntUpdFileThumb = 0;
+            $cntTotalFile = 0;
+            $cntTotalThumb = 0;
+            $cntTotalFreeword = 0;
+            // アイテム追加属性(メタデータ)をセッションに保存
+            // ii-thメタデータのリクエストを保存
+            for($ii=0; $ii<count($item_attr_type); $ii++) {
+                // ii-thメタデータのjj-th属性値のリクエストを保存
+                for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                    // 新規登録ファイルのID照合
+                    // ii-thメタデータの入力形式ごとのリクエストを保存
+                    if(    $item_attr_type[$ii]['input_type']=='file' || 
+                        $item_attr_type[$ii]['input_type']=='file_price'){ // Add file price Y.Nakao 2008/08/28
+                        // input_ids[] : [i][j]個送信。入力済みは"TILL", 未入力は"NO", 入力は"YES"
+                        if(    $this->input_ids_file[$cntTotalFile] == 'YES' ||
+                            $this->input_ids_file[$cntTotalFile] == 'NO'){
+                            // アップロード失敗=falseでなく、空レコードで戻る。
+                            // Bug Fix use null key 2014/09/05 T.Ichiakwa --start--
+                            if(isset($filelist[$cntUpdFileThumb])) {
+                                // Bug Fix use null key 2014/09/05 T.Ichiakwa --end--
+                                if($filelist[$cntUpdFileThumb]['file_name']!='' ) {
+                                    // Add file price Y.Nakao 2008/08/28 --start--
+                                    // Add registered info save action 2009/01/29 Y.Nakao --start--
+                                    // registered new file
+                                    $file = array();
+                                    $item = array();
+                                    if($edit_flag == 0){
+                                        // 新規登録時
+                                        $file["item_id"] = intval($this->Db->nextSeq("repository_item"));
+                                        $file["item_no"] = 1;
+                                        $item["item_id"] = $file["item_id"];
+                                        $item["item_no"] = 1;
+                                        $item["title"] = $filelist[$cntUpdFileThumb]["file_name"];
+                                        $item["title_english"] = "";
+                                        $item["language"] = $base_attr["language"];
+                                        $item["item_type_id"] = $item_type_all["item_type_id"];
+                                        $item["serch_key"] = "";
+                                        $item["serch_key_english"] = "";
+                                        $item["pub_year"] = "";
+                                        $item["pub_month"] = "";
+                                        $item["pub_day"] = "";
+                                        $result = $ItemRegister->entryItem($item, $error);
+                                        if($result === false){
+                                            // upload faild
+                                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                            $exception = new AppException($error);
+                                            $exception->addError($error);
+                                            throw $exception;
+                                        }
+                                        $this->Session->setParameter("edit_item_id", $file["item_id"]);
+                                        $this->Session->setParameter("edit_item_no", $file["item_no"]);
+                                        $this->Session->setParameter("edit_flag", 1);
+                                        $edit_flag = 1;
+                                    } else if($edit_flag == 1){
+                                        //既存編集時
+                                        // 編集中のアイテムIDをセッションから取得
+                                        $file["item_id"] = intval($this->Session->getParameter("edit_item_id"));
+                                        $file["item_no"] = intval($this->Session->getParameter("edit_item_no"));
+                                        $result = $ItemRegister->editItem($file["item_id"], $file["item_no"], $error);
+                                        if($result === false){
+                                            // upload faild
+                                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                            $exception = new AppException($error);
+                                            $exception->addError($error);
+                                            throw $exception;
+                                        }
+                                    }
+                                    $file["item_type_id"] = $item_type_all["item_type_id"];
+                                    $file["attribute_id"] = $item_attr_type[$ii]['attribute_id'];
+                                    $file["file_no"] = $item_attr[$ii][$jj]['file_no'];
+                                    $file["show_order"] = $item_attr[$ii][$jj]['show_order'];
+                                    $file["upload"] = $filelist[$cntUpdFileThumb];
+                                    
+                                    // Add confirm that array's index exists 2013/09/11 K.Matsushita --start--
+                                    if (!isset($item_attr[$ii][$jj]['display_name'] )) {
+                                        $item_attr[$ii][$jj]['display_name'] = "";
+                                    }
+                                    $file["display_name"] = $item_attr[$ii][$jj]['display_name'];
+                                    
+                                    if (!isset($item_attr[$ii][$jj]['display_type'])){
+                                        $item_attr[$ii][$jj]['display_type'] = "";
+                                    }
+                                    $file["display_type"] = $item_attr[$ii][$jj]['display_type'];
+                                    // Add confirm that array's index exists 2013/09/11 K.Matsushita --end--
+                                    
+                                    $file["pub_year"] = $def_pub_year;
+                                    $file["pub_month"] = $def_pub_month;
+                                    $file["pub_day"] = $def_pub_day;
+                                    $file["license_id"] = '0';
+                                    $file["license_notation"] = '';
+                                    $result = $ItemRegister->entryFile($file, $error);
+                                    if($result === false){
+                                        // upload faild
+                                        $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                        $exception = new AppException($error);
+                                        $exception->addError($error);
+                                        throw $exception;
+                                    }
+                                    if($item_attr_type[$ii]['input_type']=='file'){
+                                        $newfile = array(
+                                            'item_id'  => $file["item_id"],
+                                            'item_no'  => $file["item_no"],
+                                            'attribute_id'  => $file["attribute_id"],
+                                            'file_no'  => $file["file_no"],
+                                            'upload'   => $filelist[$cntUpdFileThumb],
+                                            'display_name'  => $file["display_name"],
+                                            'show_order' => $file["show_order"],
+                                            'display_type'  => $file["display_type"],
+                                            'licence'  => 'licence_free',
+                                            'freeword' => '',
+                                            'embargo_flag' => '1',        // 1.オープンアクセス
+                                            'embargo_year' => $def_pub_year,
+                                            'embargo_month' => $def_pub_month,
+                                            'embargo_day' => $def_pub_day,
+                                            'is_db_exist' => 0,        // DBにこのレコードが登録されていないという証
+                                            // Add file authority 2015/03/18 T.Ichikawa --start--
+                                            'auth_room_id' => array(0 => 0),
+                                            'auth_num' => 1,
+                                            // Add file authority 2015/03/18 T.Ichikawa --end--
+                                            'flash_embargo_flag' => '1',        // 1.オープンアクセス
+                                            'flash_embargo_year' => $def_pub_year,
+                                            'flash_embargo_month' => $def_pub_month,
+                                            'flash_embargo_day' => $def_pub_day
+                                        );
+                                    } else if($item_attr_type[$ii]['input_type']=='file_price'){
+                                        // Add registered info save action 2009/01/29 Y.Nakao --start--
+                                        $newfile = array(
+                                            'item_id'  => $file["item_id"],
+                                            'item_no'  => $file["item_no"],
+                                            'attribute_id'  => $file["attribute_id"],
+                                            'file_no'  => $file["file_no"],
+                                            'upload'   => $filelist[$cntUpdFileThumb],
+                                            'display_name'  => $file["display_name"],
+                                            'show_order' => $file["show_order"],
+                                            'display_type'  => $file["display_type"],
+                                            'licence'  => 'licence_free',
+                                            'freeword' => '',
+                                            'embargo_flag' => '3',        // 3.login user only
+                                            'embargo_year' => $def_pub_year,
+                                            'embargo_month' => $def_pub_month,
+                                            'embargo_day' => $def_pub_day,
+                                            'is_db_exist' => 0,        // DBにこのレコードが登録されていないという証
+                                            'price_value' => array(0 => 0),
+                                            'room_id' => array(0 => 0),
+                                            'price_num' => 1,
+                                            'flash_embargo_flag' => '1',        // 1.オープンアクセス
+                                            'flash_embargo_year' => $def_pub_year,
+                                            'flash_embargo_month' => $def_pub_month,
+                                            'flash_embargo_day' => $def_pub_day
+                                        );
+                                        // registered new file
+                                        // Add registered info save action 2009/01/29 Y.Nakao --end--
+                                        // Add registered info save action 2009/02/04 Y.Nakao --start--
+                                        $result = $ItemRegister->entryFilePrice($newfile, $error);
+                                        if($result === false){
+                                            // set file price error
+                                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                            $exception = new AppException($error);
+                                            $exception->addError($error);
+                                            throw $exception;
+                                        }
+                                        // Add registered info save action 2009/02/04 Y.Nakao --end--
+                                    }
+                                // Add file price Y.Nakao 2008/08/28 --end--
+                                // uploadレコード を保存
+                                $item_attr[$ii][$jj] = $newfile;
+                                } else {
+                                    // ファイルアップロードに失敗もしくは未入力の分
+                                    //$item_attr[$ii][$jj] = null;
+                                }
                             }
-                            $num_cand = count($option);
-                            for($ii3=0; $ii3<$num_cand ; $ii3++) {
-                                array_push($options, $option[$ii3]['candidate_value']);
-                            }                       
-                        } else {
+                            $cntUpdFileThumb++;
                         }
-                        array_push( $item_num_cand, $num_cand);     // アイテム属性タイプごとの選択支の数を設定
-                        array_push( $option_data, $options);    
-                        array_push( $item_element, $params_attr);
-                        $show_no++;
-                        break;
+                        $cntTotalFile++;
+                    // サムネイルの場合
+                    } else if( $item_attr_type[$ii]['input_type']=='thumbnail'){ 
+                        // input_ids[] : [i][j]個送信。入力済みは"TILL", 未入力は"NO", 入力は"YES"
+                        if( $this->input_ids_thumbnail[$cntTotalThumb] == 'YES' ||
+                            $this->input_ids_thumbnail[$cntTotalThumb] == 'NO')
+                        {
+                            if(isset($filelist[$cntUpdFileThumb])) {
+                                if($filelist[$cntUpdFileThumb]['file_name']!='') {
+                                    // 画像が入力されたか検査
+                                    $mimetype = $filelist[$cntUpdFileThumb]['mimetype'];
+                                       if(strpos($mimetype,"image")===false) {
+                                        // 画像でない場合, ファイルを破棄して警告メッセージ設定
+                                        // (===falseでないとひっかからないため、注意)
+                                        $msg = $smarty_assign->getLang("repository_item_not_img");
+                                        $this->addErrMsg(sprintf($msg, $item_attr_type[$ii]['attribute_name'])." : ".$mimetype);
+                                        $item_attr[$ii][$jj] = null;
+                                    } else {
+                                        // Add registered info save action 2009/01/29 Y.Nakao --start--
+                                        // registered new thumbnail
+                                        $file = array();
+                                        $item = array();
+                                        if($edit_flag == 0){
+                                            // 新規登録時
+                                            $file["item_id"] = intval($this->Db->nextSeq("repository_item"));
+                                            $file["item_no"] = 1;
+                                            $item["item_id"] = $file["item_id"];
+                                            $item["item_no"] = 1;
+                                            $item["title"] = $filelist[$cntUpdFileThumb]["file_name"];
+                                            $item["title_english"] = "";
+                                            $item["language"] = $base_attr["language"];
+                                            $item["item_type_id"] = $item_type_all["item_type_id"];
+                                            $item["serch_key"] ="";
+                                            $item["serch_key_english"] = "";
+                                            $item["pub_year"] = "";
+                                            $result = $ItemRegister->entryItem($item, $error);
+                                            if($result === false){
+                                                // upload faild
+                                                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                                $exception = new AppException($error);
+                                                $exception->addError($error);
+                                                throw $exception;
+                                            }
+                                            $this->Session->setParameter("edit_item_id", $file["item_id"]);
+                                            $this->Session->setParameter("edit_item_no", $file["item_no"]);
+                                            $this->Session->setParameter("edit_flag", 1);
+                                            $edit_flag = 1;
+                                        } else if($edit_flag == 1){
+                                            //既存編集時
+                                            // 編集中のアイテムIDをセッションから取得
+                                            $file["item_id"] = intval($this->Session->getParameter("edit_item_id"));
+                                            $file["item_no"] = intval($this->Session->getParameter("edit_item_no"));
+                                            $result = $ItemRegister->editItem($file["item_id"], $file["item_no"], $error);
+                                            if($result === false){
+                                                // upload faild
+                                                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                                $exception = new AppException($error);
+                                                $exception->addError($error);
+                                                throw $exception;
+                                            }
+                                        }
+                                        $file["item_type_id"] = $item_type_all["item_type_id"];
+                                        $file["attribute_id"] = $item_attr_type[$ii]['attribute_id'];
+                                        $file["file_no"] = $item_attr[$ii][$jj]['file_no'];
+                                        $file["show_order"] = $item_attr[$ii][$jj]['show_order'];
+                                        $file["upload"] = $filelist[$cntUpdFileThumb];
+                                        $file["pub_year"] = $def_pub_year;
+                                        $file["pub_month"] = $def_pub_month;
+                                        $file["pub_day"] = $def_pub_day;
+                                        $file["width"] = 0;
+                                        $file["height"] = 0;
+                                        $result = $ItemRegister->entryThumbnail($file, $error);
+                                        if($result === false){
+                                            // upload faild
+                                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                            $exception = new AppException($error);
+                                            $exception->addError($error);
+                                            throw $exception;
+                                        }
+                                        // Add registered info save action 2009/01/29 Y.Nakao --end--
+                                        // 画像の場合, ファイル情報を保存
+                                        $newfile = array(
+                                            'item_id'  => $file["item_id"],
+                                            'item_no'  => $file["item_no"],
+                                            'attribute_id'  => $file["attribute_id"],
+                                            'file_no'  => $file["file_no"],
+                                            'upload'   => $filelist[$cntUpdFileThumb],
+                                            'show_order' => $file["show_order"],
+                                            'is_db_exist' => 0,        // DBにこのレコードが登録されていないという証
+                                            'width'=>$file["width"],
+                                            'height'=>$file["height"]
+                                        );
+                                        // uploadレコードを保存
+                                        $item_attr[$ii][$jj] = $newfile;
+                                    }
+                                } else {
+                                    // ファイルアップロードに失敗もしくは未入力の分
+                                    //$item_attr[$ii][$jj] = null;
+                                }
+                            }
+                            $cntUpdFileThumb++;
+                        }
+                        $cntTotalThumb++;
                     }
                 }
             }
-            // Add item type multi-language 2013/07/25 K.Matsuo --start--
-            $this->setItemtypeNameMultiLanguage($this->itemtype_id, $item_element);
-            // Add item type multi-language 2013/07/25 K.Matsuo --end--
-            // アイテム属性タイプ情報をセッションに保存
-            $this->Session->setParameter("item_attr_type",$item_element);   // アイテム属性タイプ
-            $this->Session->setParameter("item_num_cand",$item_num_cand);   // アイテム属性選択肢数
-            $this->Session->setParameter("option_data",$option_data);       // アイテム属性選択肢
+        }
+        // item_attrに移し変えたら、もう不要
+        $this->Session->removeParameter("filelist");
         
-            // アイテム属性数／アイテム属性を初期設定
-            $item_num_attr = array();
-            if(count($item_attr_type) > 0)
-            {
-                $item_num_attr = array_fill(0, count($item_attr_type), 1);      // アイテム属性数 [N]
-            }
-            $item_attr = array();
-            if(count($item_attr_type) > 0)
-            {
-                $item_attr = array_fill(0, count($item_attr_type), array(''));  // アイテム属性 [N][L]
-            }
-            // 現在のアイテム属性を初期設定 (kawa)
-            // 新規作成 ⇒ 空文字列 or ON/OFF
-            $isfile = 0;        // file存在フラグ
-            $file_num = 0;      // 'file'メタデータ数
-            $thumbnail_num = 0; // 'thumbnail'メタデータ数
-            for ($ii = 0; $ii < count($item_attr); $ii++) {
-                // チェックボックス : 初期値OFF
-                if( $item_element[$ii]['input_type'] == "checkbox" ) {
-                    $check_init = array();
-                    for ($jj = 0; $jj < count($option_data[$ii]); $jj++) {
-                        array_push($check_init, "0");   // "0":OFF
-                    }
-                    $item_attr[$ii] = $check_init;
-                }
-                // ラジオボタン : 初期値は最初の選択肢
-                if( $item_element[$ii]['input_type'] == "radio" ) {
-                    $item_attr[$ii][0] = 0;     // 0-th candidate is checked.
-                }
-                // 氏名 : 姓、名、Emailの初期値をセット
-                if( $item_element[$ii]['input_type'] == "name" ) {
-                    $name_init = array(array(
-                            'family' => '',
-                            'given' => '',
-                            'family_ruby' => '',
-                            'given_ruby' => '',
-                            'email' => '',
-                            'author_id' => '',
-                            'external_author_id' => array(array('prefix_id'=>'', 'suffix'=>''))
-                        )
-                    );
-                    $item_attr[$ii] = $name_init;
-                }
-                // ファイル : null = 未登録
-                if( $item_element[$ii]['input_type'] == "file"){
-                    // Add registered info save action 2009/02/12 Y.Nakao --start--
-                    //$item_attr[$ii][0] = null;        // 0-th file is not uploaded yet.
-                    $file_no = 1;
-                    if($edit_flag == 1){
-                        $file_no = $this->getFileNo($this->item_id, $this->item_no, $ii + 1, $err_msg);
-                    }
-                    $item_attr[$ii][0] = array('file_no' => $file_no, 'show_order' => $file_no, 'display_name' => "", 'display_type' => "");
-                    // Add registered info save action 2009/02/12 Y.Nakao --end--
-                    $file_num++;
-                }
-                // Add file price Y.Nakao 2008/08/28 --start--
-                if($item_element[$ii]['input_type'] == "file_price") {
-                    // Add registered info save action 2009/02/12 Y.Nakao --start--
-                    //$item_attr[$ii][0] = null;        // 0-th file is not uploaded yet.
-                    $file_no = 1;
-                    if($edit_flag == 1){
-                        $file_no = $this->getFileNo($this->item_id, $this->item_no, $ii + 1, $err_msg);
-                    }
-                    $item_attr[$ii][0] = array('file_no' => $file_no, 'show_order' => $file_no);
-                    // Add registered info save action 2009/02/12 Y.Nakao --end--
-                    $file_num++;
-                }
-                // Add file price Y.Nakao 2008/08/28 --end--
-                // サムネイル : null = 未登録
-                if( $item_element[$ii]['input_type'] == "thumbnail" ) {
-                    // Add registered info save action 2009/02/12 Y.Nakao --start--
-                    //$item_attr[$ii][0] = null;        // 0-th file is not uploaded yet.
+        // Add toll file 2008/08/12 Y.Nakao --start--
+        // ------------------------------------------------------------
+        // 課金ファイル設定のため、すべてのグループを取得する
+        // ------------------------------------------------------------
+        // get group list
+        $all_group = array();
+        $user_error_msg = "";
+        $result = $this->getGroupList($all_group, $user_error_msg);
+        if($result === false){
+            $this->errorLog($user_error_msg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($user_error_msg);
+            $exception->addError($user_error_msg);
+            throw $exception;
+        }
+        // Sessionに保持
+        $this->Session->setParameter("all_group", $all_group);
+        // Add toll file 2008/08/12 Y.Nakao --end--
+        
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+        if($this->save_mode == 'stay' || $this->save_mode == 'next')
+        {
+            $ItemRegister->updateInsertUserIdForContributor(
+                intval($this->Session->getParameter("edit_item_id")),
+                $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
+        }
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+        
+        // Add error input Screen changes  K.Matsuo 2013/5/30 --start--
+        if(!is_null($this->errMsg) && count($this->errMsg)>0){
+            // 入力にエラーがあるときは画面遷移しない
+            $this->save_mode = "stay";
+        }
+        // Add error input Screen changes  K.Matsuo 2013/5/30 --end--
+        // ------------------------------------------------------------
+        // オプション個別処理
+        // ------------------------------------------------------------
+        $blankCheckFlag = true;
+        if ($this->save_mode != null) {
+            $idx = (int)($this->target);
+            switch($this->save_mode) {
+                case "add_row":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // Add registered info save action 2009/02/05 Y.Nakao --start--
+                    $attridx = intval($item_num_attr[$idx])-1;
+                    $item_id = '';
+                    $item_no = '';
+                    $attribute_id = '';
                     $file_no = 1;
-                    if($edit_flag == 1){
-                        $file_no = $this->calcMaxThumbnailNo($this->item_id, $this->item_no, $ii + 1, $err_msg)+1;
-                    }
-                    $item_attr[$ii][0] = array('file_no' => $file_no, 'show_order' => $file_no);
-                    // Add registered info save action 2009/02/12 Y.Nakao --end--
-                    $thumbnail_num++;
-                }               
-            }
-            // isfile設定
-            if($file_num>0){            
-                $isfile = 2;
-            } elseif($thumbnail_num>0){
-                $isfile = 1;
-            }  
-            // インデックス設定／リンク設定用変数の設定
-            $indice = array();
-            $link = array();
-            
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID, $user_id);
-            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID, $user_id);
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-            
-            // 編集の場合は既存属性を検査してセットする必要あり
-            if( $edit_flag == 1 ) {
-                // 基本情報
-                $base_attr = array(
-                    "title" => $Result_List['item'][0]['title'],
-                    "title_english" => $Result_List['item'][0]['title_english'],
-                    "language" => $Result_List['item'][0]['language']
-                );
-                // アイテムの公開日が設定されている場合、年月日に分解
-                if( $Result_List['item'][0]['shown_date'] != null &&
-                    $Result_List['item'][0]['shown_date'] != '' ) {
-                    $pub_date = split('[ ]', $Result_List['item'][0]['shown_date']);
-                    list($pub_year, $pub_month, $pub_day) = split('[/.-]', $pub_date[0]);               
-                    $item_pub_date = array(
-                                'year' => intval($pub_year),
-                                'month' => intval($pub_month),
-                                'day' => intval($pub_day));
-                }
-                // アイテムキーワード
-                $item_keyword = $Result_List['item'][0]['serch_key'];
-                $item_keyword_english = $Result_List['item'][0]['serch_key_english'];
-                
-                // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-                $insUserId = $Result_List['item'][0][RepositoryConst::DBCOL_COMMON_INS_USER_ID];
-                $this->Session->setParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID, $insUserId);
-                $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID, $insUserId);
-                
-                // Only admin user
-                $user_auth_id = $this->Session->getParameter("_user_auth_id");
-                $auth_id = $this->getRoomAuthorityID();
-                if($user_auth_id >= $this->repository_admin_base && $auth_id >= $this->repository_admin_room)
-                {
-                    // Check insert user
-                    if(strlen($insUserId) > 0 && strlen($user_id) > 0 && $insUserId != $user_id)
-                    {
-                        // This item's insert user is difference to this user
-                        // Get insert user data
-                        $user = null;
-                        $userItemLink = null;
-                        $user =& $this->usersView->getUserById($insUserId);
-                        $userItemLink =& $this->usersView->getUserItemLinkById($insUserId);
-                        $item_contributor = array();
-                        
-                        // Handle
-                        if(is_array($user) && array_key_exists("handle", $user))
+                    for($ii=0; $ii<count($item_attr[$idx]); $ii++){
+                        if(isset($item_attr[$idx][$ii]['item_id']))
                         {
-                            $item_contributor[RepositoryConst::ITEM_CONTRIBUTOR_HANDLE] = $user["handle"];
+                            $item_id = $item_attr[$idx][$ii]['item_id'];
                         }
-                        if(is_array($userItemLink))
+                        if(isset($item_attr[$idx][$ii]['item_no']))
                         {
-                            // UserName
-                            if(array_key_exists("4", $userItemLink))
+                            $item_no = $item_attr[$idx][$ii]['item_no'];
+                        }
+                        if(isset($item_attr[$idx][$ii]['attribute_id']))
+                        {
+                            $attribute_id = $item_attr[$idx][$ii]['attribute_id'];
+                        }
+                        if($file_no <= $item_attr[$idx][$ii]["file_no"]){
+                            $tmp1_file_no = $item_attr[$idx][$ii]["file_no"] + 1;
+                            if(isset($item_attr[$idx][$attridx]['item_id']))
                             {
-                                $item_contributor[RepositoryConst::ITEM_CONTRIBUTOR_NAME] = $userItemLink["4"]["content"];
+                                $tmp2_file_no = $this->getFileNo($item_attr[$idx][$attridx]['item_id'], 
+                                                                 $item_attr[$idx][$attridx]['item_no'], 
+                                                                 $item_attr[$idx][$attridx]['attribute_id'], 
+                                                                 $error);
+                                if($tmp2_file_no===false){
+                                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                    $exception = new AppException($error);
+                                    $exception->addError($error);
+                                    throw $exception;
+                                }
+                                if($tmp1_file_no > $tmp2_file_no)
+                                {
+                                    $file_no = $tmp1_file_no;
+                                }
+                                else
+                                {
+                                    $file_no = $tmp2_file_no;
+                                }
                             }
-                            
-                            // Email
-                            if(array_key_exists("5", $userItemLink))
+                            else 
                             {
-                                $item_contributor[RepositoryConst::ITEM_CONTRIBUTOR_EMAIL] = $userItemLink["5"]["content"];
+                                $file_no = $tmp1_file_no;
                             }
                         }
                     }
-                }
-                // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
-                
-                // メタデータ
-                for ($ii = 0; $ii < count($item_element); $ii++) {
-                    // 属性未登録のメタデータは初期設定でOK
-                    if(count($Result_List['item_attr'][$ii]) <= 0) {
-                        continue;
-                    }   
-                    $edit_attr = array();
-                    
-                    // チェックボックス : 属性にはチェックの入った選択肢の文字列が入っている
-                    // 選択肢と同数の配列を確保。チェックの入った選択肢に1を、入ってない選択肢に0を設定。
-                    if( $item_element[$ii]['input_type'] == "checkbox" ) {
-                        for ($kk = 0; $kk < count($option_data[$ii]); $kk++) {
-                            $isGot = false;
-                            for ($jj = 0; $jj < count($Result_List['item_attr'][$ii]); $jj++) {
-                                if($option_data[$ii][$kk] == $Result_List['item_attr'][$ii][$jj]['attribute_value']) {
-                                    array_push($edit_attr, 1);      // kk-th選択肢は選択済み
-                                    $isGot = true;
-                                    break;
-                                }
-                            }
-                            if(!$isGot) {
-                                array_push($edit_attr, 0);      // kk-th選択肢は未選択
-                            }
-                        }
-                        // 初期属性の再セット
-                        $item_attr[$ii] = $edit_attr;
-                        continue;
+                    array_push($item_attr[$idx], array( 'item_id' => $item_id,
+                                                        'item_no' => $item_no,
+                                                        'attribute_id' => $attribute_id,
+                                                        'file_no' => $file_no,
+                                                        'show_order' => $file_no));
+                    // Add registered info save action 2009/02/05 Y.Nakao --end--
+                    // target-thメタデータの属性数を増やす    
+                    $item_num_attr[$idx] = $item_num_attr[$idx] + 1;
+                    break;
+                case "up_row":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
+                    // ※target == 0(一番上)の場合は無効
+                    $attridx = (int)($this->attridx);
+                    if( $attridx == 0) {
+                        break;
                     }
-                    // プルダウン : 選択肢に存在しない値がセットされていた場合、空文字をセットする
-                    if( $item_element[$ii]['input_type'] == "select" ) {
-                        for ($jj = 0; $jj < count($Result_List['item_attr'][$ii]); $jj++) {
-                            $isTrue = false;
-                            for ($kk = 0; $kk < count($option_data[$ii]); $kk++) {
-                                if($Result_List['item_attr'][$ii][$jj]['attribute_value'] == $option_data[$ii][$kk]) {
-                                    $isTrue = true;
-                                    break;
-                                }
-                            }
-                            
-                            // 不正な値が入っていた場合の処理
-                            $option_value = "";
-                            if($isTrue == false) {
-                                // 必須項目だった場合は選択肢の最初の項目を設定する
-                                if($item_element[$ii]['is_required'] == 1) {
-                                    $option_value = $option_data[$ii][0];
-                                }
-                            } else {
-                                // 選択肢と一致した値だった場合、その値を再設定する
-                                $option_value = $Result_List['item_attr'][$ii][$jj]['attribute_value'];
-                            }
-                            array_push($edit_attr, $option_value);
+                    // Add registered info save action 2009/02/05 Y.Nakao --start--
+                    $tmpShowOrder = $item_attr[$idx][$attridx-1]['show_order'];
+                    $item_attr[$idx][$attridx-1]['show_order'] = $item_attr[$idx][$attridx]['show_order'];
+                    $item_attr[$idx][$attridx]['show_order'] = $tmpShowOrder;
+                    // Add registered info save action 2009/02/05 Y.Nakao --end--
+                    if($item_attr_type[$idx]['input_type'] == 'file' || $item_attr_type[$idx]['input_type'] == 'file_price'){
+                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx-1], $item_attr[$idx][$attridx],
+                                                        RepositoryConst::DBTABLE_REPOSITORY_FILE, 
+                                                        $error);
+                        if($result===false){
+                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($error);
+                            $exception->addError($error);
+                            throw $exception;
+                        }
+                    } else if($item_attr_type[$idx]['input_type'] == 'thumbnail'){
+                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx-1], $item_attr[$idx][$attridx],
+                                                        RepositoryConst::DBTABLE_REPOSITORY_THUMBNAIL, 
+                                                        $error);
+                        if($result===false){
+                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($error);
+                            $exception->addError($error);
+                            throw $exception;
                         }
-                        // 属性の再セット
-                        $item_attr[$ii] = $edit_attr;
-                        continue;
                     }
-                    
-                    // ii-thメタデータのjj-th属性をコピー
-                    for ($jj = 0; $jj < count($Result_List['item_attr'][$ii]); $jj++) {
-                        // ラジオボタン : 
-                        if( $item_element[$ii]['input_type'] == "radio" ) {
-                            // 値の一致したオプションのインデックスをセット
-                            for ($kk = 0; $kk < count($option_data[$ii]); $kk++) {
-                                if($option_data[$ii][$kk] == $Result_List['item_attr'][$ii][$jj]['attribute_value']) {
-                                    array_push($edit_attr, $kk);        // 0-th candidate is checked.
-                                    break;
-                                }
-                            }
+                    // 配列の入替
+                    $bufarray = $item_attr[$idx][$attridx];
+                    $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx-1];
+                    $item_attr[$idx][$attridx-1] = $bufarray;
+                    break;
+                case "down_row":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
+                    // ※target == $item_num_attr[$idx]-1(一番下)の場合は無効
+                    $attridx = (int)($this->attridx);
+                    if( $attridx >= $item_num_attr[$idx]-1) {
+                        break;
+                    }
+                    // Add registered info save action 2009/02/05 Y.Nakao --start--
+                    $tmpShowOrder = $item_attr[$idx][$attridx]['show_order'];
+                    $item_attr[$idx][$attridx]['show_order'] = $item_attr[$idx][$attridx+1]['show_order'];
+                    $item_attr[$idx][$attridx+1]['show_order'] = $tmpShowOrder;
+                    // Add registered info save action 2009/02/05 Y.Nakao --end--
+                    // Modify registered underrow null 2013/04/17 K,Matsuo --start--
+                    // sort file no
+                    if($item_attr_type[$idx]['input_type'] == 'file' || $item_attr_type[$idx]['input_type'] == 'file_price'){
+                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx+1], $item_attr[$idx][$attridx],
+                                                        RepositoryConst::DBTABLE_REPOSITORY_FILE, 
+                                                        $error);
+                        if($result===false){
+                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($error);
+                            $exception->addError($error);
+                            throw $exception;
                         }
-                        // 氏名 : 姓、名、Emailの初期値をセット
-                        elseif( $item_element[$ii]['input_type'] == "name" ) {
-                            $external_author_id = $NameAuthority->getExternalAuthorIdPrefixAndSuffix($Result_List['item_attr'][$ii][$jj]['author_id']);
-                            if($external_author_id === false){
-                                $this->failTrans();
-                                return false;
-                            }
-                            $external_author_id_without_email = array();
-                            for($cnt = 0; $cnt < count($external_author_id); $cnt++)
-                            {
-                                if($external_author_id[$cnt]["prefix_id"] == 0)
-                                {
-                                    $email = $external_author_id[$cnt]["suffix"];
-                                }
-                                else
-                                {
-                                    $tmp_array = array("prefix_id" => $external_author_id[$cnt]["prefix_id"], "suffix" => $external_author_id[$cnt]["suffix"]);
-                                    array_push($external_author_id_without_email, $tmp_array);
-                                }
-                            }
-                            $name_init = array(
-                                'family' => $Result_List['item_attr'][$ii][$jj]['family'],
-                                'given' => $Result_List['item_attr'][$ii][$jj]['name'],
-                                'family_ruby' => $Result_List['item_attr'][$ii][$jj]['family_ruby'],
-                                'given_ruby' => $Result_List['item_attr'][$ii][$jj]['name_ruby'],
-                                'email' => $Result_List['item_attr'][$ii][$jj]['e_mail_address'],
-                                'author_id' => $Result_List['item_attr'][$ii][$jj]['author_id'],
-                                'external_author_id' => $external_author_id_without_email
-                            );
-                            array_push($edit_attr, $name_init);
+                    } else if($item_attr_type[$idx]['input_type'] == 'thumbnail'){
+                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx+1], $item_attr[$idx][$attridx],
+                                                        RepositoryConst::DBTABLE_REPOSITORY_THUMBNAIL, 
+                                                        $error);
+                        if($result===false){
+                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($error);
+                            $exception->addError($error);
+                            throw $exception;
                         }
-                        // Add biblio info 2008/08/11 Y.Nakao --start--
-                        // 書誌情報：雑誌名、巻、号、ページ、発行年の初期値をセット
-                        elseif( $item_element[$ii]['input_type'] == "biblio_info" ) {
-                            $date = explode("-", $Result_List['item_attr'][$ii][$jj]['date_of_issued']);
-                            if(count($date) == 2){
-                                array_push($date, "");
-                            } else if(count($date) == 1){
-                                array_push($date, "");
-                                array_push($date, "");
-                            }
-
-                            if(strlen($date[1]) == 2){
-                                $temp_month = str_split($date[1]);
-                                if($temp_month[0] == "0"){
-                                    $date[1] = $temp_month[1];
-                                }
+                    }
+                    // 配列の入替
+                    $bufarray = $item_attr[$idx][$attridx];
+                    $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx+1];
+                    $item_attr[$idx][$attridx+1] = $bufarray;
+                    // Modify registered underrow null 2013/04/17 K,Matsuo --end--
+                    break;
+                case "delete_file":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // 20136/12 A.Jin $delete_file_listに削除対象のファイルを設定し、実ファイルを削除している。
+                    // 登録済みファイルを削除 
+                    $attridx = (int)($this->attridx);
+                    // Add registered info save action 2009/02/05 Y.Nakao --start--
+                    $item_attr[$idx][$attridx]['input_type'] = $item_attr_type[$idx]['input_type'];
+                    array_push($delete_file_list, $item_attr[$idx][$attridx]);
+                    $this->Session->setParameter("delete_file_list", $delete_file_list);
+                    // Add registered info save action 2009/02/05 Y.Nakao --end--
+                    $item_num_attr[$idx] = $item_num_attr[$idx] - 1;
+                    if($item_num_attr[$idx] == 0){
+                        $file_no = 1;
+                        if($item_attr_type[$idx]['input_type']=='thumbnail'){
+                            $file_no = $this->calcMaxThumbnailNo( $item_attr[$idx][$attridx]['item_id'], $item_attr[$idx][$attridx]['item_no']
+                                                                 , $item_attr[$idx][$attridx]['attribute_id'], $error)+1;
+                            if($file_no===false){
+                                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                $exception = new AppException($error);
+                                $exception->addError($error);
+                                throw $exception;
                             }
-                            if(strlen($date[2]) == 2){
-                                $temp_day = str_split($date[2]);
-                                if($temp_day[0] == "0"){
-                                    $date[2] = $temp_day[1];
-                                }
+                        } else {
+                            $file_no = $this->getFileNo( $item_attr[$idx][$attridx]['item_id'], $item_attr[$idx][$attridx]['item_no']
+                                                                 , $item_attr[$idx][$attridx]['attribute_id'], $error);
+                            if($file_no===false){
+                                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                $exception = new AppException($error);
+                                $exception->addError($error);
+                                throw $exception;
                             }
-
-                            $biblio_init = array(
-                                'biblio_name' => $Result_List['item_attr'][$ii][$jj]['biblio_name'],
-                                'biblio_name_english' => $Result_List['item_attr'][$ii][$jj]['biblio_name_english'],
-                                'volume' => $Result_List['item_attr'][$ii][$jj]['volume'],
-                                'issue' => $Result_List['item_attr'][$ii][$jj]['issue'],
-                                'spage' => $Result_List['item_attr'][$ii][$jj]['start_page'],
-                                'epage' => $Result_List['item_attr'][$ii][$jj]['end_page'],
-                                'date_of_issued' => $Result_List['item_attr'][$ii][$jj]['date_of_issued'],
-                                'year' =>$date[0], 
-                                'month' =>$date[1],
-                                'day' =>$date[2]
-                            );
-                            array_push($edit_attr, $biblio_init);
                         }
-                        // Add biblio info 2008/08/11 Y.Nakao --end--
-                        
-                        // Add item attribute:date 2008/10/14 A.Suzuki --start--
-                        // 日付：年月日の初期値をセット
-                        elseif( $item_element[$ii]['input_type'] == "date" ) {
-                            $date = explode("-", $Result_List['item_attr'][$ii][$jj]['attribute_value']);
-                            if(count($date) == 2){
-                                array_push($date, "");
-                            } else if(count($date) == 1){
-                                array_push($date, "");
-                                array_push($date, "");
-                            }
-
-                            if(strlen($date[1]) == 2){
-                                $temp_month = str_split($date[1]);
-                                if($temp_month[0] == "0"){
-                                    $date[1] = $temp_month[1];
-                                }
+                        $item_num_attr[$idx] = 1;
+                        $item_attr[$idx][$attridx] = array( 'item_id' => $item_attr[$idx][$attridx]['item_id'],
+                                                            'item_no' => $item_attr[$idx][$attridx]['item_no'],
+                                                            'attribute_id' => $item_attr[$idx][$attridx]['attribute_id'],
+                                                            'file_no' => $file_no,
+                                                            'show_order' => $file_no);
+                    } else {
+                        array_splice($item_attr[$idx], $attridx, 1);
+                    }
+                    for($jj=0; $jj<count($item_attr[$idx]); $jj++){
+                        if(isset($item_attr[$idx][$jj]['new_file_no']) && 
+                            $item_attr[$idx][$jj]['new_file_no'] != ''){
+                            if($item_attr[$idx][$jj]['new_file_no'] > $attridx){
+                                $item_attr[$idx][$jj]['new_file_no'] -= 1;
                             }
-                            if(strlen($date[2]) == 2){
-                                $temp_day = str_split($date[2]);
-                                if($temp_day[0] == "0"){
-                                    $date[2] = $temp_day[1];
-                                }
+                        } else {
+                            if($item_attr[$idx][$jj]['file_no'] > $attridx){
+                                $item_attr[$idx][$jj]['new_file_no'] = $item_attr[$idx][$jj]['file_no']-1;
                             }
-                            
-                            $date_init = array(
-                                'date' => $Result_List['item_attr'][$ii][$jj]['attribute_value'],
-                                'date_year' =>$date[0],
-                                'date_month' =>$date[1],
-                                'date_day' =>$date[2],
-                            );
-                            array_push($edit_attr, $date_init);
                         }
-                        // Add item attribute:date 2008/10/14 A.Suzuki --end--
-                        
-                        // ファイル : エンバーゴ、ライセンスなどセット
-                        elseif( $item_element[$ii]['input_type'] == "file" || 
-                            $item_element[$ii]['input_type'] == "file_price") { // Add file price Y.Nakao 2008/08/28
-                            // upload情報を作成
-                            $upload = array(
-                                'file_name' => $Result_List['item_attr'][$ii][$jj]['file_name'],
-                                'mimetype' => $Result_List['item_attr'][$ii][$jj]['mime_type'],
-                                'extension' => $Result_List['item_attr'][$ii][$jj]['extension']
-                            );
-                            // 2008/03/21 エンバーゴフラグ設定
-                            // 既存編集の場合は既にファイルの公開日は一意に決まっているため、"オープンアクセス日を指定する"扱いとする
-                            // file情報作成
-                            if($item_element[$ii]['input_type'] == "file"){
-                                $file_init = array(
-                                    'upload' => $upload,
-                                    'display_name' => $Result_List['item_attr'][$ii][$jj]['display_name'],
-                                    'display_type' => $Result_List['item_attr'][$ii][$jj]['display_type'],
-                                    'licence' => 'licence_free',
-                                    'freeword' => '',
-                                    'embargo_flag' => 2,    // オープンアクセス日を指定する
-                                    'embargo_year' => '',
-                                    'embargo_month' => '',
-                                    'embargo_day' => '',
-                                    'is_db_exist' => 1,     // DBにこのレコードが登録されている証
-                                    // プライマリキー保存(削除用)
-                                    'item_id' => $Result_List['item_attr'][$ii][$jj]['item_id'],
-                                    'item_no' => $Result_List['item_attr'][$ii][$jj]['item_no'],
-                                    'attribute_id' => $Result_List['item_attr'][$ii][$jj]['attribute_id'],
-                                    'file_no' => $Result_List['item_attr'][$ii][$jj]['file_no'],
-                                    'show_order' => $Result_List['item_attr'][$ii][$jj]['show_order'],
-                                    'input_type' => 'file',
-                                    'flash_embargo_flag' => 2,  // オープンアクセス日を指定する
-                                    'flash_embargo_year' => '',
-                                    'flash_embargo_month' => '',
-                                    'flash_embargo_day' => ''
-                                );
-                            } else if($item_element[$ii]['input_type'] == "file_price"){
-                                // room_idとpriceを分解する
-                                // room_id,price|room_id,price|room_id,price|...で格納されている
-                                $room_price = explode("|",$Result_List['item_attr'][$ii][$jj]['price']);
-                                $price_num = 0;
-                                $price_value = array();
-                                $room_id = array();
-                                for($price_Cnt=0;$price_Cnt<count($room_price);$price_Cnt++){
-                                    $price = split(",", $room_price[$price_Cnt]);
-                                    // room_idと価格のペアがあり、価格が数字であるか判定
-                                    if($price!=null && count($price)==2)
-                                    {
-                                        array_push($room_id, $price[0]);
-                                        array_push($price_value, $price[1]);
-                                        $price_num++;
-                                    }
+                    }
+                    break;
+                default:
+                    break;
+            }
+        }
+        
+        if($blankCheckFlag){
+            // ------------------------------------------------------------
+            // 次の画面に行く前に、未入力欄を削除して整理
+            // ------------------------------------------------------------ 
+            for($ii=0; $ii<count($item_attr_type); $ii++) {
+                // ファイル／サムネイル以外はスルー
+                if( $item_attr_type[$ii]['input_type']=='file' ||
+                    $item_attr_type[$ii]['input_type']=='file_price' || // Add file price Y.Nakao 2008/08/28
+                    $item_attr_type[$ii]['input_type']=='thumbnail')
+                { 
+                    $array_cleaned = array();
+                    // 未入力欄を除外
+                    for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                        if( $item_attr[$ii][$jj] != null &&
+                            array_key_exists('upload', $item_attr[$ii][$jj]) == true &&
+                            $item_attr[$ii][$jj]['upload'] != null)
+                        {
+                            array_push($array_cleaned, $item_attr[$ii][$jj]);
+                        }
+                    }
+                    $item_num_attr[$ii] = count($array_cleaned);
+                    // 0になってしまった場合は戻ったときのことを考えて救済措置
+                    if($item_num_attr[$ii]<=0) {
+                        $item_id = $this->Session->getParameter("edit_item_id");
+                        $item_no = $this->Session->getParameter("edit_item_no");
+                        $file_no = 1;
+                        if($item_id != null && $item_no != null){
+                            if($item_attr_type[$ii]['input_type']=='thumbnail'){
+                                $file_no = $this->calcMaxThumbnailNo($item_id, $item_no, $ii + 1, $error)+1;
+                                if($file_no===false){
+                                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                    $exception = new AppException($error);
+                                    $exception->addError($error);
+                                    throw $exception;
                                 }
-                                // ファイル情報格納
-                                $file_init = array(
-                                    'upload' => $upload,
-                                    'display_name' => $Result_List['item_attr'][$ii][$jj]['display_name'],
-                                    'display_type' => $Result_List['item_attr'][$ii][$jj]['display_type'],
-                                    'licence' => 'licence_free',
-                                    'freeword' => '',
-                                    'embargo_flag' => 2,    // オープンアクセス日を指定する
-                                    'embargo_year' => '',
-                                    'embargo_month' => '',
-                                    'embargo_day' => '',
-                                    'is_db_exist' => 1,     // DBにこのレコードが登録されている証
-                                    // プライマリキー保存(削除用)
-                                    'item_id' => $Result_List['item_attr'][$ii][$jj]['item_id'],
-                                    'item_no' => $Result_List['item_attr'][$ii][$jj]['item_no'],
-                                    'attribute_id' => $Result_List['item_attr'][$ii][$jj]['attribute_id'],
-                                    'file_no' => $Result_List['item_attr'][$ii][$jj]['file_no'],
-                                    'show_order' => $Result_List['item_attr'][$ii][$jj]['show_order'],
-                                    'input_type' => 'file_price',
-                                    'room_id' => $room_id,
-                                    'price_value' => $price_value,
-                                    'price_num' => $price_num,
-                                    'flash_embargo_flag' => 2,  // オープンアクセス日を指定する
-                                    'flash_embargo_year' => '',
-                                    'flash_embargo_month' => '',
-                                    'flash_embargo_day' => ''
-                                );
-                            }
-                            // ライセンス設定
-                            if($Result_List['item_attr'][$ii][$jj]['license_id'] == 0) {
-                                $file_init['licence'] = 'licence_free';
-                                $file_init['freeword'] = $Result_List['item_attr'][$ii][$jj]['license_notation'];
                             } else {
-                                // CreativeCommonsの場合, ライセンスIDの一致したライセンスマスタインデックス
-                                for ($kk = 0; $kk < count($license_master); $kk++) {
-                                    if($license_master[$kk]['license_id'] == $Result_List['item_attr'][$ii][$jj]['license_id']) {
-                                        $file_init['licence'] = $kk;
-                                        break;
-                                    }
+                                $file_no = $this->getFileNo($item_id, $item_no, $ii + 1, $error);
+                                if($file_no===false){
+                                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                    $exception = new AppException($error);
+                                    $exception->addError($error);
+                                    throw $exception;
                                 }
                             }
-                            if($Result_List['item_attr'][$ii][$jj]['display_type'] == ''){
-                                $file_init['display_type'] = '0';
-                            }
-                            // エンバーゴ設定
-                            // XXXX-XX-XX 形式の日付を年月日に分解
-                            $year = '';
-                            $month = '';
-                            $day = '';
-                            // embargo date 2008/08/18 --start--
-                            // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --start--
-                            if(strlen($Result_List['item_attr'][$ii][$jj]['pub_date']) == 0)
-                            {
-                                $Result_List['item_attr'][$ii][$jj]['pub_date'] = $this->TransStartDate;
-                            }
-                            // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --end--
-                            $embargo = split(' ', $Result_List['item_attr'][$ii][$jj]['pub_date']); 
-                            $embargo = split('[/.-]', $embargo[0]);             
-                            //$embargo = split('[/.-]', $Result_List['item_attr'][$ii][$jj]['pub_date']);
-                            // embargo date 2008/08/18 --end--
-//                          list($year,$month,$day) = split('[/.-]', $Result_List['item_attr'][$ii][$jj]['pub_date']);              
-                            if(count($embargo) > 0) { $year = $embargo[0]; }
-                            if(count($embargo) > 1) { $month = $embargo[1]; }
-                            if(count($embargo) > 2) { $day = $embargo[2]; }
-                            $file_init['embargo_year'] = $year;
-                            $file_init['embargo_month'] = $month;
-                            $file_init['embargo_day'] = $day;
-                            // Add detail file license 2008/10/23 Y.Nakao --start--
-                            $now_date = explode( " ", $this->TransStartDate );
-                            $now_date_array = explode( "-", $now_date[0] );
-                            // Add detail file license 2008/10/23 Y.Nakao --end--
-                            // 会員のみの場合は"会員のみ"とする 2008/08/19 --start--
-                            if($year == "9999" && $month == "1" && $day == "1"){
-                                // 会員のみ
-                                $file_init['embargo_flag'] = 3;
-                                // 表示されるオープンアクセス日指定日時は表示日時
-                                $file_init['embargo_year'] = $item_pub_date["year"];
-                                $file_init['embargo_month'] = $item_pub_date["month"];
-                                $file_init['embargo_day'] = $item_pub_date["day"];
-                            }
-                            else if($year == "9999" && $month == "12" && $day == "31" && $Result_List['item_attr'][$ii][$jj]['display_type'] == 2){
-                                // Do not download file.
-                                $file_init['embargo_flag'] = 4;
-                                // 表示されるオープンアクセス日指定日時は表示日時
-                                $file_init['embargo_year'] = $item_pub_date["year"];
-                                $file_init['embargo_month'] = $item_pub_date["month"];
-                                $file_init['embargo_day'] = $item_pub_date["day"];
-                            }
-                            // Modify file, flash immovable. Y.Nakao 2012/02/13 --start--
-                            else {
-                                $file_init['embargo_flag'] = 2;
-                            }
-                            
-                            // Modify file, flash immovable. Y.Nakao 2012/02/13 --end--
-                            
-                            // Add flash embargo 2010/02/08 A.Suzuki --start--
-                            // フラッシュファイルエンバーゴ設定
-                            // XXXX-XX-XX 形式の日付を年月日に分解
-                            $year = '';
-                            $month = '';
-                            $day = '';
-                            // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --start--
-                            if(strlen($Result_List['item_attr'][$ii][$jj]['flash_pub_date']) == 0)
-                            {
-                                $Result_List['item_attr'][$ii][$jj]['flash_pub_date'] = $this->TransStartDate;
-                            }
-                            // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --end--
-                            $flash_embargo = split(' ', $Result_List['item_attr'][$ii][$jj]['flash_pub_date']); 
-                            $flash_embargo = split('[/.-]', $flash_embargo[0]);             
-                            if(count($flash_embargo) > 0) { $year = $flash_embargo[0]; }
-                            if(count($flash_embargo) > 1) { $month = $flash_embargo[1]; }
-                            if(count($flash_embargo) > 2) { $day = $flash_embargo[2]; }
-                            $file_init['flash_embargo_year'] = $year;
-                            $file_init['flash_embargo_month'] = $month;
-                            $file_init['flash_embargo_day'] = $day;
-                            //$pub_time = mktime( 0, 0, 0, intval( $month ), intval( $day ), intval( $year ) );
-                            $diff = Date_Calc::compareDates(intval($now_date_array[2]),intval($now_date_array[1]),intval($now_date_array[0]),intval($day),intval($month),intval($year));
-                            if($year == "9999" && $month == "1" && $day == "1"){
-                                // 会員のみ
-                                $file_init['flash_embargo_flag'] = 3;
-                                // 表示されるオープンアクセス日指定日時は表示日時
-                                $file_init['flash_embargo_year'] = $item_pub_date["year"];
-                                $file_init['flash_embargo_month'] = $item_pub_date["month"];
-                                $file_init['flash_embargo_day'] = $item_pub_date["day"];
-                            }
-                            // Modify file, flash immovable. Y.Nakao 2012/02/13 --start--
-                            // when today after file's pub_date, this file is open access
-                            // get flash's pub date
-                            else
-                            {
-                                $file_init['flash_embargo_flag'] = 2;
-                            }
-                            // Modify file, flash immovable. Y.Nakao 2012/02/13 --start--
-                            // Add flash embargo 2010/02/08 A.Suzuki --start--
-                            
-                            // 会員のみの場合は"会員のみ"とする 2008/08/19 --end--
-                            array_push($edit_attr, $file_init);
-                        }
-                        // サムネイル : null = 未登録
-                        elseif( $item_element[$ii]['input_type'] == "thumbnail" ) {
-                            // file情報作成
-                            $file_init = array(
-                                'upload' => array(
-                                    'file_name' => $Result_List['item_attr'][$ii][$jj]['file_name'],
-                                    'mimetype' => $Result_List['item_attr'][$ii][$jj]['mime_type'],
-                                    'extension' => $Result_List['item_attr'][$ii][$jj]['extension']
-                                ),
-                                'is_db_exist' => 1,     // DBにこのレコードが登録されている証
-                                // プライマリキー保存(削除用)
-                                'item_id' => $Result_List['item_attr'][$ii][$jj]['item_id'],
-                                'item_no' => $Result_List['item_attr'][$ii][$jj]['item_no'],
-                                'attribute_id' => $Result_List['item_attr'][$ii][$jj]['attribute_id'],
-                                'file_no' => $Result_List['item_attr'][$ii][$jj]['file_no'],
-                                'show_order' => $Result_List['item_attr'][$ii][$jj]['show_order'],
-                                'input_type' => 'thumbnail'
-                            );                      
-                            array_push($edit_attr, $file_init);
-                        }
-                        // BugFix add when input type is supple T.Koyasu 2014/09/16 --start--
-                        // サプリメンタルコンテンツ(PHP Notice対応)
-                        else if( $item_element[$ii]['input_type'] == "supple"){
-                            // アイテム編集時には特に修正の必要なし
-                        }
-                        // BugFix add when input type is supple T.Koyasu 2014/09/16 --end--
-                        // その他テキスト系
-                        else {
-                            array_push($edit_attr, $Result_List['item_attr'][$ii][$jj]['attribute_value']);                         
-                        }
-                    }
-                    // 初期属性の再セット
-                    $item_attr[$ii] = $edit_attr;
-                    $item_num_attr[$ii] = count($edit_attr);
-                }
-                // 登録INDEXと表示インデックスが異なる不具合対応 2008/07/02 Y.Nakao --start-- 
-                $indice = $Result_List['position_index'];
-                
-                // change index tree 2008/12/03 Y.Nakao --start--
-                for($ii=0; $ii<count($indice); $ii++){  
-                    $query = "SELECT index_name, index_name_english FROM ".DATABASE_PREFIX."repository_index ".
-                             "WHERE index_id = '".$indice[$ii]["index_id"]."';";
-                    $ret = $this->Db->execute($query);
-                    if($ret === false || count($ret)!=1){
-                        return false;
-                    }                   
-                    if($this->Session->getParameter("_lang") == "japanese"){
-                        $indice[$ii]["index_name"] = $ret[0]["index_name"];
-                    } else {
-                        $indice[$ii]["index_name"] = $ret[0]["index_name_english"];
-                    }
-                }
-                // change index tree 2008/12/03 Y.Nakao --end--
-                
-                // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --start--
-                $indice = $this->addPrivateTreeInPositionIndex($indice, $insUserId);
-                // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --end--
-                
-                // インデックスの読み込み(インデックスIDがあればよい)
-                //$indice = array();
-                //for ($ii = 0; $ii < count($Result_List['position_index']); $ii++) {
-                    //array_push($indice, $Result_List['position_index'][$ii]['index_id']);
-                //}
-                // 登録INDEXと表示インデックスが異なる不具合対応 2008/07/02 Y.Nakao --end--
-                // リンクの読み込み(リンク先のアイテムID, アイテムNo, タイトルを保存・・・いや全部持っておけばいいか)
-                $link = array();
-                for ($ii = 0; $ii < count($Result_List['reference']); $ii++) {
-                    // リンク先アイテム情報取得
-                    $dest_item = array();
-                    $result = $this->getItemTableData(
-                                    $Result_List['reference'][$ii]['dest_reference_item_id'],
-                                    $Result_List['reference'][$ii]['dest_reference_item_no'],
-                                    $dest_item, $Error_Msg);
-                    if($result === false){
-                        if($istest) { echo $Error_Msg . "<br>"; }
-                        return 'error';  
-                    }                   
-                    // リンク先アイテムレコード+αを保存
-                    if($istest) { echo "index_item_cnt ". count($dest_item['item']) . "<br>"; }
-                    if( count($dest_item['item']) > 0) {
-                        // リンク先アイテムのアイテムタイプを取得
-                        $query = "SELECT * ".
-                                 "FROM ". DATABASE_PREFIX ."repository_item_type ".     // アイテムタイプ
-                                 "WHERE item_type_id = ? AND ".
-                                 "is_delete = ?; ";         // 削除フラグ
-                        $params = null;
-                        $params[] = $dest_item['item'][0]['item_type_id'];
-                        $params[] = 0;
-                        //　SELECT実行
-                        $dest_item_type = $this->Db->execute($query, $params);
-                        if($dest_item_type === false){
-                            $error_msg = $this->Db->ErrorMsg();
-                            $this->Session->setParameter("error_cord",-1);
-                            return 'error';  
                         }
-                        $dest_item['item'][0]['item_type_name'] = $dest_item_type[0]['item_type_name'];
-                        $dest_item['item'][0]['relation'] = $Result_List['reference'][$ii]['reference'];
-                        array_push($link , $dest_item['item'][0]);
+                        $item_num_attr[$ii] = 1;
+                        array_push($array_cleaned, array('file_no' => $file_no, 'show_order' => $file_no));
                     }
-                            
-                    
-//                  array_push($link, array(
-//                          'dest_reference_item_id' => $dest_item['item'][0]['item_id'],
-//                          'dest_reference_item_no' => $dest_item['item'][0]['item_no'],
-//                          'title' => $dest_item['item'][0]['title']
-//                      )
-//                  );
+                    // クリンナップした配列を保存
+                    $item_attr[$ii] = $array_cleaned;
                 }
             }
-            
-            // アイテム属性数／アイテム属性をセッションに保存
-            $this->Session->setParameter("isfile",$isfile);
-            $this->Session->setParameter("item_num_attr",$item_num_attr);
-            $this->Session->setParameter("item_attr",$item_attr);
-            $this->Session->setParameter("base_attr",$base_attr);
-            $this->Session->setParameter("item_pub_date",$item_pub_date);
-            $this->Session->setParameter("item_keyword",$item_keyword);
-            $this->Session->setParameter("item_keyword_english",$item_keyword_english);
-            $this->Session->setParameter("indice",$indice);
-            $this->Session->setParameter("link",$link);
-            $this->Session->setParameter("item_contributor", $item_contributor);
-            
-            /// ツリー設定処理
-            // change index tree view action 2008/12/04 Y.Nakao --start--
-            /*
-            $result = $this->setIndexTreeData2Session();           
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-                $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }*/
-            // change index tree view action 2008/12/04 Y.Nakao --end--
-            
-            // DOI付与可能フラグ
-            $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
-            $doi_itemtype_flag = false;
-            if($CheckDoi->checkDoiGrantItemtype($this->itemtype_id, Repository_Components_Checkdoi::TYPE_JALC_DOI) || 
-               $CheckDoi->checkDoiGrantItemtype($this->itemtype_id, Repository_Components_Checkdoi::TYPE_CROSS_REF))
-            {
-                $doi_itemtype_flag = true;
-            }
-            $this->Session->setParameter("doi_itemtype_flag", $doi_itemtype_flag);
-            
-            // アクション終了処理
-            $result = $this->exitAction();  // トランザクションが成功していればCOMMITされる
-            if ( $result == false ){
-                //print "終了処理失敗";
-            }
-            // 登録フローに表示されるファイル登録部分の改善対応 update 2008/06/26 Y.Nakao --start--
-            // ファイル属性が無ければメタデータ登録画面に遷移
-            if ($isfile==0) {
-                $this->Session->setParameter("attr_file_flg", 0);
-                return 'texts';
-            }
-            $this->Session->setParameter("attr_file_flg", 1);
-            // 登録フローに表示されるファイル登録部分の改善対応 update 2008/06/26 Y.Nakao --end--
-            return 'files';
-        } catch ( RepositoryException $Exception) {
-            //トランザクション失敗を設定(ROLLBACK)
-            if($this->Db != null){
-                $this->failTrans();
-            }
-            //エラーログ出力
-            $this->logFile(
-                get_class($this),                 //クラス名
-                "execute",                      //メソッド名
-                $Exception->getCode(),          //ログID
-                $Exception->getMessage(),       //主メッセージ
-                $Exception->getDetailMsg() );   //詳細メッセージ           
-            //アクション終了処理
-            $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_error_msg);
-            $this->setRedirectScreen($this->item_id, $this->item_no);
-            return "error";
+            $delete_file_list = array();
+            $this->Session->setParameter("delete_file_list", $delete_file_list);
         }
-    }
-    
-    /**
-     * set redirect screen
-     *
-     * @param $item_id
-     * @param $item_no
-     * @access  private
-     */
-    private function setRedirectScreen($item_id, $item_no){
-        if($this->Session->getParameter("return_screen") != null){
-            // 詳細画面を表示させるための設定
-            $this->Session->setParameter("item_id_for_detail", $item_id);
-            $this->Session->setParameter("item_no_for_detail", $item_no);
-            $this->Session->setParameter("search_flg","true");
-            if($this->Session->getParameter("return_screen") === "1"){
-                $this->Session->removeParameter("return_screen");
-                // ワークフロー画面でないことを示すフラグ
-                $this->Session->setParameter("workflow_flg", "false");
-                // 画面右に詳細表示を表示させるフラグ
-                $this->Session->setParameter("serach_screen", "1");
-                $this->Session->setParameter("redirect_flg", "detail");
-                $this->Session->setParameter("redirect_item_id", $item_id);
-            } else if($this->Session->getParameter("return_screen") === "2"){
-                $this->Session->removeParameter("return_screen");
-                // ワークフロー画面であることを示すフラグ
-                $this->Session->setParameter("workflow_flg", "true");
-                $this->Session->setParameter("redirect_flg", "workflow");
-            }
-        } else {
-            $this->Session->setParameter("redirect_flg", "selecttype");
-        }
-    }
-    
-    /**
-     * get Feedback author
-     *
-     * @param $item_id
-     * @param $item_no
-     * @return  array
-     */
-    private function getFeedbackAuthor($itemId, $itemNo)
-    {
-            // get author id
-        $query = "SELECT author_id " .
-                 "FROM ". DATABASE_PREFIX ."repository_send_feedbackmail_author_id " .
-                 "WHERE item_id = ? " .
-                 "AND item_no = ? " .
-                 "order by author_id_no ;";
-        $params = array();
-        $params[] = $itemId;
-        $params[] = $itemNo;
-        // Run query
-        $result_get_author = $this->dbAccess->executeQuery( $query, $params );
+        $this->Session->setParameter("item_num_attr", $item_num_attr);  // 属性の数を更新
+        $this->Session->setParameter("item_attr", $item_attr);          // 属性を更新
         
-        // get mail address
-        $query = "SELECT AUTHOR.name, AUTHOR.family, SUFFIX.suffix " .
-                 "FROM ". DATABASE_PREFIX ."repository_external_author_id_suffix AS SUFFIX " .
-                 "INNER JOIN ". DATABASE_PREFIX ."repository_name_authority AS AUTHOR ".
-                 "ON SUFFIX.author_id = AUTHOR.author_id ".
-                 "WHERE SUFFIX.prefix_id = 0 " .
-                 "AND SUFFIX.author_id IN ( " ;
-        $params = array();
-        for($ii = 0; $ii < count($result_get_author); $ii++) {
-            $params[] = $result_get_author[$ii]["author_id"];
-            if($ii == 0) {
-                $query .= "?";
-            }
-            else
-            {
-                $query .= ", ?";
-            }
-        }
-        $query .= " ) AND SUFFIX.is_delete = 0 ".
-                  "AND AUTHOR.is_delete = 0 ;";
-        // Run query
-        $result = array();
-        if(count($result_get_author) > 0) {
-            $result = $this->dbAccess->executeQuery( $query, $params );
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "files",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+                            );
+        $ret = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
         }
-        return $result;
-    }
-    
-    /**
-     * set Session Feedback author
-     *
-     * @param $authorData
-     */
-    private function setFeedbackAuthor($authorData)
-    {
-        $feedback_author_str = "";
-        $feedback_mail_address_str = "";
-        $feedback_mail_author_array = array();
-        $feedback_mail_array = array();
-        for($cnt = 0; $cnt < count($authorData); $cnt++)
-        {
-            if($cnt > 0)
-            {
-                $feedback_author_str .= ",";
-                $feedback_mail_address_str .= ",";
-            }
-            $feedback_author_str .= $authorData[$cnt]["name"]. " " .$authorData[$cnt]["family"]. " " .$authorData[$cnt]["suffix"];
-            $feedback_mail_address_str .= $authorData[$cnt]["suffix"];
-            $feedback_mail_author_array[$cnt] = $authorData[$cnt]["name"]. " " .$authorData[$cnt]["family"]. " " .$authorData[$cnt]["suffix"];
-            $feedback_mail_array[$cnt] = $authorData[$cnt]["suffix"];
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
+        
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
         }
-        $this->Session->setParameter("feedback_mailaddress_str", $feedback_mail_address_str);
-        $this->Session->setParameter("feedback_mailaddress_author_str", $feedback_author_str);
-        $this->Session->setParameter("feedback_mailaddress_array", $feedback_mail_array);
-        $this->Session->setParameter("feedback_mailaddress_author_array", $feedback_mail_author_array);
         
-        return true;
+        return $ret;
     }
 }
 ?>
diff --git a/repository/action/main/item/editfiles/maple.ini b/repository/action/main/item/editfiles/maple.ini
index c1e44be..f7e6cb9 100644
--- a/repository/action/main/item/editfiles/maple.ini
+++ b/repository/action/main/item/editfiles/maple.ini
@@ -4,14 +4,17 @@ request = POST
 
 [ValidateDef]
 authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
-itemtype_id
-return_screen
 
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
-usersView = "ref:usersView"
 
 [View]
+selecttype = "action:repository_view_main_item_selecttype"
 files = "action:repository_view_main_item_editfiles"
+license = "action:repository_view_main_item_editfileslicense"
 texts = "action:repository_view_main_item_edittexts"
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+error = "action:repository_view_main_item_editfiles"
\ No newline at end of file
diff --git a/repository/action/main/item/editfileslicense/Editfileslicense.class.php b/repository/action/main/item/editfileslicense/Editfileslicense.class.php
index 55c91b6..7cbc4f8 100644
--- a/repository/action/main/item/editfileslicense/Editfileslicense.class.php
+++ b/repository/action/main/item/editfileslicense/Editfileslicense.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editfileslicense.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Editfileslicense.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,719 +14,396 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/IDServer.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：ファイルライセンス設定画面からの入力処理アクション
  *
- * @package     [[package名]]
  * @access      public
  */
 class Repository_Action_Main_Item_Editfileslicense extends RepositoryAction
-{    
-    // 使用コンポーネントを受け取るため
-    var $upload = null;
+{   
+    // リクエストパラメーター
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     * @var string
+     */
+    public $save_mode = null;
     
-    // オプション用
-    var $save_mode = null;        // 処理モード
-                                // "next" : リンク設定画面へ (デフォルト)
-                                // "stay" : セッションのみ保存してファイル入力画面に残る
-                                // "add_row" : 属性の数を増やす
-                                // "up_row" : 属性を入れ替える (attridx-th属性が上に)
-                                // "down_row" : 属性を入れ替える (attridx-th属性が下に)
-                                // "delete_file" : アップロード済みのファイルを削除
-    var $target = null;            // 処理対象のメタデータ番号
-    var $attridx = null;        // 処理対象の属性番号
+    /**
+     * ファイルのライセンス配列
+     *   アップロード済みアイテムの数に対応
+     * @var array
+     */
+    public $licence = null;
     
-    // リクエストパラメタ
-    // ファイル以外のパラメタは本コールバック関数で処理する。
-    var $input_ids_file = null;            // ファイルのid配列("TILL", "NO", "YES"), ファイル入力欄の数と対応
-    var $input_ids_thumbnail = null;    // サムネイルのid配列("TILL", "NO", "YES"), サムネイル入力欄の数と対応
-
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * ファイルのライセンス自由記述欄配列
+     *   " "の場合、未入力
+     * @var array
      */
-    function execute()
-    {    
-        try {
-            //アクション初期化処理
-            $result = $this->initAction();
-            
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-                $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
+    public $freeword = null;
+    
+    /**
+     * エンバーゴ年配列
+     * @var array
+     */
+    public $embargo_year = null;
+    
+    /**
+     * エンバーゴ月配列
+     * @var array
+     */
+    public $embargo_month = null;
+    
+    /**
+     * エンバーゴ日配列
+     * @var array
+     */
+    public $embargo_day = null;
+    
+    /**
+     * エンバーゴフラグ配列
+     *   0:公開日をアイテム公開日に合わせる
+     *   1:公開日を独自に設定する
+     * @var array
+     */
+    public $embargo_flag = null;
+    
+    /**
+     * 選択されたグループのID配列
+     * @var array
+     */
+    public $room_ids = null;
+    
+    /**
+     * 設定された価格配列
+     * @var array
+     */
+    public $price_value = null;
+    
+    /**
+     * 表示形式配列
+     * @var array
+     */
+    public $display_type = null;
+    
+    /**
+     * 表示名配列
+     * @var array
+     */
+    public $display_name = null;
+    
+    /**
+     * ダウンロード許可グループID配列
+     * @var array
+     */
+    public $auth_room_ids = null;
+    
+    /**
+     * フラッシュファイルエンバーゴ年配列
+     * @var array
+     */
+    public $flash_embargo_year = null;
+    
+    /**
+     * フラッシュファイルエンバーゴ月配列
+     * @var array
+     */
+    public $flash_embargo_month = null;
+    
+    /**
+     * フラッシュファイルエンバーゴ日配列
+     * @var array
+     */
+    public $flash_embargo_day = null;
+    
+    /**
+     * フラッシュファイルエンバーゴフラ配列
+     *   0:公開日をアイテム公開日に合わせる
+     *   1:公開日を独自に設定する
+     * @var array
+     */
+    public $flash_embargo_flag = null;
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
 
-            $err_msg = array();        // エラーメッセージ
-            // Uploadアクションでサーバに上げたファイルのUploadレコードを取得
-            $filelist = null;
-            $filelist = $this->Session->getParameter("filelist");                    // これは前ページのファイル入力項の数だけ渡る(空白、エラー分を含む)
-            // セッション情報取得
-            $item_attr_type = $this->Session->getParameter("item_attr_type");        // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
-            // ユーザ入力値＆変数
-            $item_num_attr = $this->Session->getParameter("item_num_attr");            // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
-            $item_attr = $this->Session->getParameter("item_attr");                    // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
-            $edit_start_date = $this->Session->getParameter("edit_start_date");        // X.アイテム公開日 : item_pub_date
-            // Add registered info save action 2009/01/29 Y.Nakao --start--
-            $edit_flag = $this->Session->getParameter("edit_flag");
-            $ItemRegister = new ItemRegister($this->Session, $this->Db);
-            $base_attr = $this->Session->getParameter("base_attr");
-            $item_type_all = $this->Session->getParameter("item_type_all");
-            $smarty_assign = $this->Session->getParameter("smartyAssign");
-            $license_master = $this->Session->getParameter("license_master");
-            $delete_file_list = $this->Session->getParameter("delete_file_list");
-            if(!isset($delete_file_list) || !is_array($delete_file_list))
-            {
-                $delete_file_list = array();
-            }
-            // delete file recorde
-            $error_flg = false;
-            // sort file no
-            //2013/6/17 A.Jin --実ファイルファイル削除処理は「保存」「次へ」ボタン押下時に行うように修正
-            if($this->save_mode == 'stay' || $this->save_mode == '' ){
-                for($ii=0; $ii<count($delete_file_list); $ii++){
-                    if($delete_file_list[$ii]["input_type"] == "file"){
-                        $result = $ItemRegister->deleteFile($delete_file_list[$ii], false, $error);
-                    } else if($delete_file_list[$ii]["input_type"] == "file_price"){
-                        $result = $ItemRegister->deleteFile($delete_file_list[$ii], true, $error);
-                    } else if($delete_file_list[$ii]["input_type"] == "thumbnail"){
-                        $result = $ItemRegister->deleteThumbnail($delete_file_list[$ii], $error);
-                    }
-                    if($result === false){
-                        array_push($err_msg, $error);
-                        $error_flg = true;
+    /**
+     * 実行処理
+     * @see RepositoryAction::executeApp()
+     */
+    protected function executeApp()
+    {
+        // インスタンス作成
+        $ItemRegister = new ItemRegister($this->Session, $this->Db);
+        $IDServer = new IDServer($this->Session, $this->Db);
+        
+        // セッション情報取得
+        $item_attr_type = $this->Session->getParameter("item_attr_type");       // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
+        $item_num_attr = $this->Session->getParameter("item_num_attr");         // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
+        $item_attr = $this->Session->getParameter("item_attr");                 // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
+        $license_master = $this->Session->getParameter("license_master");       // ライセンスマスタ
+        $item_pub_date = $this->Session->getParameter("item_pub_date");
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        
+        // アップロード済みファイルのライセンスを取得
+        $cntUpd = 0;    // アップロード済みアイテムカウンタ
+        $price_Cnt = 0; // 価格用リクエストパラメタのカウンタ
+        $auth_Cnt = 0;  // ファイル権限リクエストパラメータ用のカウンタ Add file authority T.Ichikawa 2015/03/20
+        // ii-thメタデータのリクエストを保存
+        for($ii=0; $ii<count($item_attr_type); $ii++) {
+            // 1ファイルに付くルームIDごとの価格
+            $price = array();
+            // ii-thメタデータのjj-th属性値のリクエストを保存
+            for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                // アップロード済みファイルのライセンス設定
+                if( ($item_attr_type[$ii]['input_type']=='file' || $item_attr_type[$ii]['input_type']=='file_price') &&
+                    array_key_exists("upload", $item_attr[$ii][$jj]) == true &&
+                    $item_attr[$ii][$jj]["upload"] != null)
+                {
+                    $item_attr[$ii][$jj]["item_id"] = $this->Session->getParameter("edit_item_id");
+                    $item_attr[$ii][$jj]["item_no"] = $this->Session->getParameter("edit_item_no");
+                    $item_attr[$ii][$jj]["attribute_id"] = $item_attr_type[$ii]['attribute_id']; 
+                    // ライセンス保存 : CreativeCommonsの場合はライセンスマスタ配列のインデックス
+                    // 自由記述は"licence_free"
+                    $item_attr[$ii][$jj]['embargo_flag'] = $this->embargo_flag[$cntUpd];
+                    
+                    // ファイル公開日
+                    $this->embargo_year[$cntUpd] = trim($this->embargo_year[$cntUpd]);
+                    if($this->checkDate($this->embargo_year[$cntUpd], $this->embargo_month[$cntUpd], $this->embargo_day[$cntUpd])){
+                        $item_attr[$ii][$jj]['embargo_year'] = $this->embargo_year[$cntUpd];
+                        $item_attr[$ii][$jj]['embargo_month'] = $this->embargo_month[$cntUpd];
+                        $item_attr[$ii][$jj]['embargo_day'] = $this->embargo_day[$cntUpd];
+                    } else {
+                        // invalid date
+                        // Set item_pub_date
+                        $item_attr[$ii][$jj]['embargo_year'] = $item_pub_date["year"];
+                        $item_attr[$ii][$jj]['embargo_month'] = $item_pub_date["month"];
+                        $item_attr[$ii][$jj]['embargo_day'] = $item_pub_date["day"];
+                        if($this->embargo_flag[$cntUpd] == "2"){
+                            $this->addErrMsg("repository_item_file_pub_date_illegal");
+                        }
                     }
-                }
-                $this->Session->removeParameter("delete_file_list");
-                $delete_file_list = array();
-            }
-            // Modify version up for entry file UI 2012/03/09 Y.Nakao --end--
-            // Add registered info save action 2009/01/29 Y.Nakao --end--
-            
-            // ファイルのデフォルト公開日計算 (編集開始日)
-            $def_pub_year = '';
-            $def_pub_month = '';
-            $def_pub_day = '';
-            $list = split(' ', $edit_start_date);    
-            $list = split('[/.-]', $list[0]);                  
-            $def_pub_year = $list[0];
-            $def_pub_month = $list[1];
-            $def_pub_day = $list[2];
-            // 今回新たなファイル入力があったか否か検査
-            if($filelist != null &&
-               (($this->input_ids_file != null && count($this->input_ids_file)>0 ) ||
-               ($this->input_ids_thumbnail != null && count($this->input_ids_thumbnail)>0))) {          
-                // カウンタ
-                $cntUpdFileThumb = 0;
-                $cntTotalFile = 0;
-                $cntTotalThumb = 0;
-                $cntTotalFreeword = 0;
-                // アイテム追加属性(メタデータ)をセッションに保存
-                // ii-thメタデータのリクエストを保存
-                for($ii=0; $ii<count($item_attr_type); $ii++) {
-                    // ii-thメタデータのjj-th属性値のリクエストを保存
-                    for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
-                        // 新規登録ファイルのID照合
-                        // ii-thメタデータの入力形式ごとのリクエストを保存
-                        if(    $item_attr_type[$ii]['input_type']=='file' || 
-                            $item_attr_type[$ii]['input_type']=='file_price'){ // Add file price Y.Nakao 2008/08/28
-                            // input_ids[] : [i][j]個送信。入力済みは"TILL", 未入力は"NO", 入力は"YES"
-                            if(    $this->input_ids_file[$cntTotalFile] == 'YES' ||
-                                $this->input_ids_file[$cntTotalFile] == 'NO'){
-                                // アップロード失敗=falseでなく、空レコードで戻る。
-                                // Bug Fix use null key 2014/09/05 T.Ichiakwa --start--
-                                if(isset($filelist[$cntUpdFileThumb])) {
-                                    // Bug Fix use null key 2014/09/05 T.Ichiakwa --end--
-                                    if($filelist[$cntUpdFileThumb]['file_name']!='' ) {
-                                        // Add file price Y.Nakao 2008/08/28 --start--
-                                        // Add registered info save action 2009/01/29 Y.Nakao --start--
-                                        // registered new file
-                                        $file = array();
-                                        $item = array();
-                                        if($edit_flag == 0){
-                                            // 新規登録時
-                                            $file["item_id"] = intval($this->Db->nextSeq("repository_item"));
-                                            $file["item_no"] = 1;
-                                            $item["item_id"] = $file["item_id"];
-                                            $item["item_no"] = 1;
-                                            $item["title"] = $filelist[$cntUpdFileThumb]["file_name"];
-                                            $item["title_english"] = "";
-                                            $item["language"] = $base_attr["language"];
-                                            $item["item_type_id"] = $item_type_all["item_type_id"];
-                                            $item["serch_key"] = "";
-                                            $item["serch_key_english"] = "";
-                                            $item["pub_year"] = "";
-                                            $item["pub_month"] = "";
-                                            $item["pub_day"] = "";
-                                            $result = $ItemRegister->entryItem($item, $error);
-                                            if($result === false){
-                                                // upload faild
-                                                array_push($err_msg, $error);
-                                                $this->Session->setParameter("error_msg", $err_msg);
-                                                return 'error';
-                                            }
-                                            $this->Session->setParameter("edit_item_id", $file["item_id"]);
-                                            $this->Session->setParameter("edit_item_no", $file["item_no"]);
-                                            $this->Session->setParameter("edit_flag", 1);
-                                            $edit_flag = 1;
-                                        } elseif($edit_flag == 1){
-                                            //既存編集時
-                                            // 編集中のアイテムIDをセッションから取得
-                                            $file["item_id"] = intval($this->Session->getParameter("edit_item_id"));
-                                            $file["item_no"] = intval($this->Session->getParameter("edit_item_no"));
-                                            $result = $ItemRegister->editItem($file["item_id"], $file["item_no"], $error);
-                                            if($result === false){
-                                                // upload faild
-                                                array_push($err_msg, $error);
-                                                $this->Session->setParameter("error_msg", $err_msg);
-                                                return 'error';
-                                            }
-                                        }
-                                        $file["item_type_id"] = $item_type_all["item_type_id"];
-                                        $file["attribute_id"] = $item_attr_type[$ii]['attribute_id'];
-                                        $file["file_no"] = $item_attr[$ii][$jj]['file_no'];
-                                        $file["show_order"] = $item_attr[$ii][$jj]['show_order'];
-                                        $file["upload"] = $filelist[$cntUpdFileThumb];
-                                        
-                                        // Add confirm that array's index exists 2013/09/11 K.Matsushita --start--
-                                        if (!isset($item_attr[$ii][$jj]['display_name'] )) {
-                                            $item_attr[$ii][$jj]['display_name'] = "";
-                                        }
-                                        $file["display_name"] = $item_attr[$ii][$jj]['display_name'];
-                                        
-                                        if (!isset($item_attr[$ii][$jj]['display_type'])){
-                                            $item_attr[$ii][$jj]['display_type'] = "";
-                                        }
-                                        $file["display_type"] = $item_attr[$ii][$jj]['display_type'];
-                                        // Add confirm that array's index exists 2013/09/11 K.Matsushita --end--
-                                        
-                                        $file["pub_year"] = $def_pub_year;
-                                        $file["pub_month"] = $def_pub_month;
-                                        $file["pub_day"] = $def_pub_day;
-                                        $file["license_id"] = '0';
-                                        $file["license_notation"] = '';
-                                        $result = $ItemRegister->entryFile($file, $error);
-                                        if($result === false){
-                                            // upload faild
-                                            array_push($err_msg, $error);
-                                            $this->Session->setParameter("error_msg", $err_msg);
-                                            return 'error';
-                                        }
-                                        if($item_attr_type[$ii]['input_type']=='file'){
-                                            $newfile = array(
-                                                'item_id'  => $file["item_id"],
-                                                'item_no'  => $file["item_no"],
-                                                'attribute_id'  => $file["attribute_id"],
-                                                'file_no'  => $file["file_no"],
-                                                'upload'   => $filelist[$cntUpdFileThumb],
-                                                'display_name'  => $file["display_name"],
-                                                'show_order' => $file["show_order"],
-                                                'display_type'  => $file["display_type"],
-                                                'licence'  => 'licence_free',
-                                                'freeword' => '',
-                                                'embargo_flag' => '1',        // 1.オープンアクセス
-                                                'embargo_year' => $def_pub_year,
-                                                'embargo_month' => $def_pub_month,
-                                                'embargo_day' => $def_pub_day,
-                                                'is_db_exist' => 0,        // DBにこのレコードが登録されていないという証
-                                                'flash_embargo_flag' => '1',        // 1.オープンアクセス
-                                                'flash_embargo_year' => $def_pub_year,
-                                                'flash_embargo_month' => $def_pub_month,
-                                                'flash_embargo_day' => $def_pub_day
-                                            );
-                                        } else if($item_attr_type[$ii]['input_type']=='file_price'){
-                                            // Add registered info save action 2009/01/29 Y.Nakao --start--
-                                            $newfile = array(
-                                                'item_id'  => $file["item_id"],
-                                                'item_no'  => $file["item_no"],
-                                                'attribute_id'  => $file["attribute_id"],
-                                                'file_no'  => $file["file_no"],
-                                                'upload'   => $filelist[$cntUpdFileThumb],
-                                                'display_name'  => $file["display_name"],
-                                                'show_order' => $file["show_order"],
-                                                'display_type'  => $file["display_type"],
-                                                'licence'  => 'licence_free',
-                                                'freeword' => '',
-                                                'embargo_flag' => '3',        // 3.login user only
-                                                'embargo_year' => $def_pub_year,
-                                                'embargo_month' => $def_pub_month,
-                                                'embargo_day' => $def_pub_day,
-                                                'is_db_exist' => 0,        // DBにこのレコードが登録されていないという証
-                                                'price_value' => array(0 => 0),
-                                                'room_id' => array(0 => 0),
-                                                'price_num' => 1,
-                                                'flash_embargo_flag' => '1',        // 1.オープンアクセス
-                                                'flash_embargo_year' => $def_pub_year,
-                                                'flash_embargo_month' => $def_pub_month,
-                                                'flash_embargo_day' => $def_pub_day
-                                            );
-                                            // registered new file
-                                            // Add registered info save action 2009/01/29 Y.Nakao --end--
-                                            // Add registered info save action 2009/02/04 Y.Nakao --start--
-                                            $result = $ItemRegister->entryFilePrice($newfile, $error);
-                                            if($result === false){
-                                                // set file price error
-                                                array_push($err_msg, $error);
-                                                $this->Session->setParameter("error_msg", $err_msg);
-                                                return 'error';
-                                            }
-                                            // Add registered info save action 2009/02/04 Y.Nakao --end--
-                                        }
-                                        // Add file price Y.Nakao 2008/08/28 --end--
-                                        // uploadレコード を保存
-                                        $item_attr[$ii][$jj] = $newfile;
-                                    } else {
-                                        // ファイルアップロードに失敗もしくは未入力の分
-                                        //$item_attr[$ii][$jj] = null;
-                                    }
-                                }
-                                $cntUpdFileThumb++;
-                            }
-                            $cntTotalFile++;
-                        // サムネイルの場合
-                        } elseif( $item_attr_type[$ii]['input_type']=='thumbnail'){ 
-                            // input_ids[] : [i][j]個送信。入力済みは"TILL", 未入力は"NO", 入力は"YES"
-                            if(    $this->input_ids_thumbnail[$cntTotalThumb] == 'YES' ||
-                                $this->input_ids_thumbnail[$cntTotalThumb] == 'NO') {
-                                // Bug Fix use null key 2014/09/05 T.Ichiakwa --start--
-                                if(isset($filelist[$cntUpdFileThumb])) {
-                                // Bug Fix use null key 2014/09/05 T.Ichiakwa --end--
-                                    if(    $filelist[$cntUpdFileThumb]['file_name']!='') {
-                                        // 画像が入力されたか検査
-                                        $mimetype = $filelist[$cntUpdFileThumb]['mimetype'];
-                                           if(strpos($mimetype,"image")===false) {
-                                            // 画像でない場合, ファイルを破棄して警告メッセージ設定
-                                            // (===falseでないとひっかからないため、注意)
-                                            $msg = $smarty_assign->getLang("repository_item_not_img");
-                                            array_push($err_msg,  sprintf($msg, $item_attr_type[$ii]['attribute_name'])." : ".$mimetype);
-                                            $this->Session->setParameter("error_msg", $err_msg);
-                                            $item_attr[$ii][$jj] = null;
-                                        } else {
-                                            // Add registered info save action 2009/01/29 Y.Nakao --start--
-                                            // registered new thumbnail
-                                            $file = array();
-                                            $item = array();
-                                            if($edit_flag == 0){
-                                                // 新規登録時
-                                                $file["item_id"] = intval($this->Db->nextSeq("repository_item"));
-                                                $file["item_no"] = 1;
-                                                $item["item_id"] = $file["item_id"];
-                                                $item["item_no"] = 1;
-                                                $item["title"] = $filelist[$cntUpdFileThumb]["file_name"];
-                                                $item["title_english"] = "";
-                                                $item["language"] = $base_attr["language"];
-                                                $item["item_type_id"] = $item_type_all["item_type_id"];
-                                                $item["serch_key"] ="";
-                                                $item["serch_key_english"] = "";
-                                                $item["pub_year"] = "";
-                                                $result = $ItemRegister->entryItem($item, $error);
-                                                if($result === false){
-                                                    // upload faild
-                                                    array_push($err_msg, $error);
-                                                    $this->Session->setParameter("error_msg", $err_msg);
-                                                    return 'error';
-                                                }
-                                                $this->Session->setParameter("edit_item_id", $file["item_id"]);
-                                                $this->Session->setParameter("edit_item_no", $file["item_no"]);
-                                                $this->Session->setParameter("edit_flag", 1);
-                                                $edit_flag = 1;
-                                            } elseif($edit_flag == 1){
-                                                //既存編集時
-                                                // 編集中のアイテムIDをセッションから取得
-                                                $file["item_id"] = intval($this->Session->getParameter("edit_item_id"));
-                                                $file["item_no"] = intval($this->Session->getParameter("edit_item_no"));
-                                                $result = $ItemRegister->editItem($file["item_id"], $file["item_no"], $error);
-                                                if($result === false){
-                                                    // upload faild
-                                                    array_push($err_msg, $error);
-                                                    $this->Session->setParameter("error_msg", $err_msg);
-                                                    return 'error';
-                                                }
-                                            }
-                                            $file["item_type_id"] = $item_type_all["item_type_id"];
-                                            $file["attribute_id"] = $item_attr_type[$ii]['attribute_id'];
-                                            $file["file_no"] = $item_attr[$ii][$jj]['file_no'];
-                                            $file["show_order"] = $item_attr[$ii][$jj]['show_order'];
-                                            $file["upload"] = $filelist[$cntUpdFileThumb];
-                                            $file["pub_year"] = $def_pub_year;
-                                            $file["pub_month"] = $def_pub_month;
-                                            $file["pub_day"] = $def_pub_day;
-                                            // Fix thumbnail width, height 2012/02/03 Y.Nakao --start--
-                                            $file["width"] = 0;
-                                            $file["height"] = 0;
-                                            // Fix thumbnail width, height 2012/02/03 Y.Nakao --end--
-                                            $result = $ItemRegister->entryThumbnail($file, $error);
-                                            if($result === false){
-                                                // upload faild
-                                                array_push($err_msg, $error);
-                                                $this->Session->setParameter("error_msg", $err_msg);
-                                                return 'error';
-                                            }
-                                            // Add registered info save action 2009/01/29 Y.Nakao --end--
-                                            // 画像の場合, ファイル情報を保存
-                                            $newfile = array(
-                                                'item_id'  => $file["item_id"],
-                                                'item_no'  => $file["item_no"],
-                                                'attribute_id'  => $file["attribute_id"],
-                                                'file_no'  => $file["file_no"],
-                                                'upload'   => $filelist[$cntUpdFileThumb],
-                                                'show_order' => $file["show_order"],
-                                                'is_db_exist' => 0,        // DBにこのレコードが登録されていないという証
-                                            // thumbnail width, height
-                                                'width'=>$file["width"],
-                                                'height'=>$file["height"]
-                                            );
-                                            // uploadレコードを保存
-                                            $item_attr[$ii][$jj] = $newfile;
-                                        }
-                                    } else {
-                                        // ファイルアップロードに失敗もしくは未入力の分
-                                        //$item_attr[$ii][$jj] = null;
-                                    }
-                                }
-                                $cntUpdFileThumb++;
-                            }
-                            $cntTotalThumb++;
-                        }                
+                    // 月が未定義の場合、日も未定義にする ('00' = 未定義)
+                    if($item_attr[$ii][$jj]['embargo_month'] == '00') {
+                        $item_attr[$ii][$jj]['embargo_day'] == '00';
                     }
-                }
-            }
-            // item_attrに移し変えたら、もう不要
-            $this->Session->removeParameter("filelist");
-            
-            // Add registered info save action 2009/01/29 Y.Nakao --start--
-            // 必須入力検査
-            $ItemRegister->checkEntryInfo($item_attr_type, $item_num_attr, $item_attr, 'file', $err_msg, $warning);
-            // Add registered info save action 2009/01/29 Y.Nakao --end--
-            
-            // Add toll file 2008/08/12 Y.Nakao --start--
-            // ------------------------------------------------------------
-            // 課金ファイル設定のため、すべてのグループを取得する
-            // ------------------------------------------------------------
-            // get group list
-            $result = $this->getGroupList($all_group, $user_error_msg);
-            if($result === false){
-                //エラーログ出力
-                $this->logFile(
-                    "SampleAction",                    //クラス名
-                    "execute",                        //メソッド名
-                    $Exception->getCode(),            //ログID
-                    $Exception->getMessage(),        //主メッセージ
-                    $Exception->getDetailMsg() );    //詳細メッセージ            
-                //アクション終了処理
-                  $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-                //異常終了
-                $this->Session->setParameter("error_msg", $user_error_msg);
-                return "error";
-            }
-            // Sessionに保持
-            $this->Session->setParameter("all_group", $all_group);
-            // Add toll file 2008/08/12 Y.Nakao --end--
-            
-            
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-            if($this->save_mode == 'stay' || $this->save_mode == '')
-            {
-                $ItemRegister->updateInsertUserIdForContributor(
-                    intval($this->Session->getParameter("edit_item_id")),
-                    $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
-            }
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
-            
-            // Add error input Screen changes  K.Matsuo 2013/5/30 --start--
-            if(count($err_msg)>0){
-                // 入力にエラーがあるときは画面遷移しない
-                $this->save_mode = "stay";
-            }
-            // Add error input Screen changes  K.Matsuo 2013/5/30 --end--
-            // ------------------------------------------------------------
-            // オプション個別処理
-            // ------------------------------------------------------------    
-            if ($this->save_mode != null) {
-                // commit
-                $result = $this->exitAction();
-                if ( $result == false ){
-                    $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );
-                    $DetailMsg = null;
-                    sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                    $exception->setDetailMsg( $DetailMsg );
-                    $this->failTrans();
-                    throw $exception;
-                }
-                $idx = (int)($this->target);
-                switch($this->save_mode) {
-                case "stay":
-                    // Add registered info save action 2009/02/05 Y.Nakao --start--
-                    $delete_file_list = array();
-                    $this->Session->setParameter("delete_file_list", $delete_file_list);
-                    // Add registered info save action 2009/02/05 Y.Nakao --end--
-                    // 画面遷移せず
-                    $this->Session->setParameter("item_attr", $item_attr);
-                    $this->Session->removeParameter("error_msg");
-                    $this->Session->setParameter("error_msg",$err_msg);
-                    return "stay";
-                case "add_row":
-                    // Add registered info save action 2009/02/05 Y.Nakao --start--
-                    $attridx = intval($item_num_attr[$idx])-1;
-                    $item_id = '';
-                    $item_no = '';
-                    $attribute_id = '';
-                    $file_no = 1;
-                    for($ii=0; $ii<count($item_attr[$idx]); $ii++){
-                        if(isset($item_attr[$idx][$ii]['item_id']))
-                        {
-                            $item_id = $item_attr[$idx][$ii]['item_id'];
-                        }
-                        if(isset($item_attr[$idx][$ii]['item_no']))
-                        {
-                            $item_no = $item_attr[$idx][$ii]['item_no'];
-                        }
-                        if(isset($item_attr[$idx][$ii]['attribute_id']))
-                        {
-                            $attribute_id = $item_attr[$idx][$ii]['attribute_id'];
-                        }
-                        if($file_no <= $item_attr[$idx][$ii]["file_no"]){
-                            $tmp1_file_no = $item_attr[$idx][$ii]["file_no"] + 1;
-                            if(isset($item_attr[$idx][$attridx]['item_id']))
-                            {
-                                $tmp2_file_no = $this->getFileNo($item_attr[$idx][$attridx]['item_id'], 
-                                                                 $item_attr[$idx][$attridx]['item_no'], 
-                                                                 $item_attr[$idx][$attridx]['attribute_id'], 
-                                                                 $err_msg);
-                                if($tmp1_file_no > $tmp2_file_no)
-                                {
-                                    $file_no = $tmp1_file_no;
-                                }
-                                else
-                                {
-                                    $file_no = $tmp2_file_no;
-                                }
-                            }
-                            else 
-                            {
-                                $file_no = $tmp1_file_no;
-                            }
+                    
+                    // フラッシュ公開日
+                    $item_attr[$ii][$jj]['flash_embargo_flag'] = $this->flash_embargo_flag[$cntUpd];
+                    $this->flash_embargo_year[$cntUpd] = trim($this->flash_embargo_year[$cntUpd]);
+                    if($this->checkDate($this->flash_embargo_year[$cntUpd], $this->flash_embargo_month[$cntUpd], $this->flash_embargo_day[$cntUpd])){
+                        $item_attr[$ii][$jj]['flash_embargo_year'] = $this->flash_embargo_year[$cntUpd];
+                        $item_attr[$ii][$jj]['flash_embargo_month'] = $this->flash_embargo_month[$cntUpd];
+                        $item_attr[$ii][$jj]['flash_embargo_day'] = $this->flash_embargo_day[$cntUpd];
+                    } else {
+                        // invalid date
+                        // Set item_pub_date
+                        $item_attr[$ii][$jj]['flash_embargo_year'] = $item_pub_date["year"];
+                        $item_attr[$ii][$jj]['flash_embargo_month'] = $item_pub_date["month"];
+                        $item_attr[$ii][$jj]['flash_embargo_day'] = $item_pub_date["day"];
+                        if($this->flash_embargo_flag[$cntUpd] == "2"){
+                            $this->addErrMsg("repository_item_flash_pub_date_illegal");
                         }
                     }
-                    array_push($item_attr[$idx], array( 'item_id' => $item_id,
-                                                        'item_no' => $item_no,
-                                                        'attribute_id' => $attribute_id,
-                                                        'file_no' => $file_no,
-                                                        'show_order' => $file_no));
-                    // Add registered info save action 2009/02/05 Y.Nakao --end--
-                    // target-thメタデータの属性数を増やす    
-                    $item_num_attr[$idx] = $item_num_attr[$idx] + 1;
-                    $this->Session->setParameter("item_num_attr", $item_num_attr);
-                    $this->Session->setParameter("item_attr", $item_attr);
-                    return "stay";
-                case "up_row":
-                    // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
-                    // ※target == 0(一番上)の場合は無効
-                    $attridx = (int)($this->attridx);
-                    if( $attridx == 0) {
-                        break;
-                    }
-                    // Add registered info save action 2009/02/05 Y.Nakao --start--
-                    $tmpShowOrder = $item_attr[$idx][$attridx-1]['show_order'];
-                    $item_attr[$idx][$attridx-1]['show_order'] = $item_attr[$idx][$attridx]['show_order'];
-                    $item_attr[$idx][$attridx]['show_order'] = $tmpShowOrder;
-                    // Add registered info save action 2009/02/05 Y.Nakao --end--
-                    if($item_attr_type[$idx]['input_type'] == 'file' || $item_attr_type[$idx]['input_type'] == 'file_price'){
-                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx-1], $item_attr[$idx][$attridx],
-                                                        RepositoryConst::DBTABLE_REPOSITORY_FILE, 
-                                                        $error);
-                    } else if($item_attr_type[$idx]['input_type'] == 'thumbnail'){
-                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx-1], $item_attr[$idx][$attridx],
-                                                        RepositoryConst::DBTABLE_REPOSITORY_THUMBNAIL, 
-                                                        $error);
+                    // 月が未定義の場合、日も未定義にする ('00' = 未定義)
+                    if($item_attr[$ii][$jj]['flash_embargo_month'] == '00') {
+                        $item_attr[$ii][$jj]['flash_embargo_day'] == '00';
                     }
-                    // sort file no
-                    if($result === false){
-                        array_push($err_msg, $error);
-                        return 'error';
+                    
+                    if($this->licence[$cntUpd] == 'licence_free') {
+                        $item_attr[$ii][$jj]['licence'] = 'licence_free';
+                        $item_attr[$ii][$jj]['freeword'] = ($this->freeword[$cntUpd]==' ')?'':$this->freeword[$cntUpd];
+                        $item_attr[$ii][$jj]['license_id'] = '0';
+                        $item_attr[$ii][$jj]['license_notation'] = $item_attr[$ii][$jj]['freeword'];
+                    } else {
+                        $item_attr[$ii][$jj]['licence'] = $this->licence[$cntUpd];
+                        $item_attr[$ii][$jj]['license_id'] = $license_master[$this->licence[$cntUpd]]['license_id'];
+                        $item_attr[$ii][$jj]['license_notation'] = $license_master[$this->licence[$cntUpd]]['license_notation'];
                     }
-                    // 配列の入替
-                    $bufarray = $item_attr[$idx][$attridx];
-                    $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx-1];
-                    $item_attr[$idx][$attridx-1] = $bufarray;
-                    $this->Session->setParameter("item_attr", $item_attr);
-                    return "stay";
-                case "down_row":
-                    // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
-                    // ※target == $item_num_attr[$idx]-1(一番下)の場合は無効
-                    $attridx = (int)($this->attridx);
-                    if( $attridx >= $item_num_attr[$idx]-1) {
-                        break;
+                    
+                    $item_attr[$ii][$jj]['display_name'] = ($this->display_name[$cntUpd]==' ')?'':$this->display_name[$cntUpd];
+                    if($item_attr[$ii][$jj]['display_name'] == ""){
+                        // if display_name is null, put in filename without extension
+                        $item_attr[$ii][$jj]['display_name'] = str_ireplace(".".$item_attr[$ii][$jj]['upload']['extension'], "", $item_attr[$ii][$jj]['upload']['file_name']);
                     }
-                    // Add registered info save action 2009/02/05 Y.Nakao --start--
-                    $tmpShowOrder = $item_attr[$idx][$attridx]['show_order'];
-                    $item_attr[$idx][$attridx]['show_order'] = $item_attr[$idx][$attridx+1]['show_order'];
-                    $item_attr[$idx][$attridx+1]['show_order'] = $tmpShowOrder;
-                    // Add registered info save action 2009/02/05 Y.Nakao --end--
-                    // Modify registered underrow null 2013/04/17 K,Matsuo --start--
-                    // sort file no
-                    if($item_attr_type[$idx]['input_type'] == 'file' || $item_attr_type[$idx]['input_type'] == 'file_price'){
-                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx+1], $item_attr[$idx][$attridx],
-                                                        RepositoryConst::DBTABLE_REPOSITORY_FILE, 
-                                                        $error);
-                    } else if($item_attr_type[$idx]['input_type'] == 'thumbnail'){
-                        $result = $ItemRegister->swapFileShowOrder($item_attr[$idx][$attridx+1], $item_attr[$idx][$attridx],
-                                                        RepositoryConst::DBTABLE_REPOSITORY_THUMBNAIL, 
-                                                        $error);
+                    if($this->display_type[$cntUpd] == 'simple'){
+                        $item_attr[$ii][$jj]['display_type'] = 1;
+                    } else if($this->display_type[$cntUpd] == 'flash'){
+                        $item_attr[$ii][$jj]['display_type'] = 2;
+                    } else {
+                        $item_attr[$ii][$jj]['display_type'] = 0;
                     }
+                    
+                    // ライセンス情報をDBに保存
+                    $result = $ItemRegister->updateFileLicense($item_attr[$ii][$jj], $error);
                     if($result === false){
-                        array_push($err_msg, $error);
-                        return 'error';
+                        // update faild
+                        $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                        $exception = new AppException($error);
+                        $exception->addError($error);
+                        throw $exception;
                     }
-                    // 配列の入替
-                    $bufarray = $item_attr[$idx][$attridx];
-                    $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx+1];
-                    $item_attr[$idx][$attridx+1] = $bufarray;
-                    // Modify registered underrow null 2013/04/17 K,Matsuo --end--
-                    
-                    $this->Session->setParameter("item_attr", $item_attr);
-                    return "stay";
-                   case "delete_file":
-                       // 20136/12 A.Jin $delete_file_listに削除対象のファイルを設定し、実ファイルを削除している。
-                       
-                    // 登録済みファイルを削除 
-                    $attridx = (int)($this->attridx);
-                       // Add registered info save action 2009/02/05 Y.Nakao --start--
-                       $item_attr[$idx][$attridx]['input_type'] = $item_attr_type[$idx]['input_type'];
-                       array_push($delete_file_list, $item_attr[$idx][$attridx]);
-                       $this->Session->setParameter("delete_file_list", $delete_file_list);
-                       // Add registered info save action 2009/02/05 Y.Nakao --end--
-                    
                     
-                    
-                    $item_num_attr[$idx] = $item_num_attr[$idx] - 1;
-                    if($item_num_attr[$idx] == 0){
-                        $file_no = 1;
-                        if($item_attr_type[$idx]['input_type']=='thumbnail'){
-                            $file_no = $this->calcMaxThumbnailNo( $item_attr[$idx][$attridx]['item_id'], $item_attr[$idx][$attridx]['item_no']
-                                                                 , $item_attr[$idx][$attridx]['attribute_id'], $err_msg)+1;
-                        } else {
-                            $file_no = $this->getFileNo( $item_attr[$idx][$attridx]['item_id'], $item_attr[$idx][$attridx]['item_no']
-                                                                 , $item_attr[$idx][$attridx]['attribute_id'], $err_msg);
+                    // Add file authority 2015/03/18 T.Ichikawa --start--
+                    if($item_attr_type[$ii]['input_type']=='file'){
+                        // 一度権限情報を削除する
+                        $params = array();
+                        $params[] = $item_attr[$ii][$jj]["file_no"];          // ファイルNo
+                        $params[] = "0,0";                                    // 価格
+                        $params[] = $this->Session->getParameter("_user_id"); // 更新者
+                        $params[] = $this->TransStartDate;                    // 更新日
+                        $params[] = 1;                                        // 削除フラグ
+                        $params[] = $item_attr[$ii][$jj]["item_id"];          // アイテムID
+                        $params[] = $item_attr[$ii][$jj]["item_no"];          // アイテムNo
+                        $params[] = $item_attr[$ii][$jj]["attribute_id"];     // アイテム属性ID
+                        $params[] = $item_attr[$ii][$jj]["file_no"];          // ファイルNo
+                        $result = $this->updateFilePrice($params, $error);
+                        if($result === false) {
+                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($error);
+                            $exception->addError($error);
+                            throw $exception;
                         }
-                        $item_num_attr[$idx] = 1;
-                        $item_attr[$idx][$attridx] = array( 'item_id' => $item_attr[$idx][$attridx]['item_id'],
-                                                            'item_no' => $item_attr[$idx][$attridx]['item_no'],
-                                                            'attribute_id' => $item_attr[$idx][$attridx]['attribute_id'],
-                                                            'file_no' => $file_no,
-                                                            'show_order' => $file_no);
-                    } else {
-                        array_splice($item_attr[$idx], $attridx, 1);
-                    }
-                    for($jj=0; $jj<count($item_attr[$idx]); $jj++){
-                        if(isset($item_attr[$idx][$jj]['new_file_no']) && 
-                            $item_attr[$idx][$jj]['new_file_no'] != ''){
-                            if($item_attr[$idx][$jj]['new_file_no'] > $attridx){
-                                $item_attr[$idx][$jj]['new_file_no'] -= 1;
+                        
+                        // 「オープンアクセス日を指定」か「ログインユーザーのみ」の時だけ権限情報を更新する
+                        if($item_attr[$ii][$jj]['embargo_flag'] == 2 || $item_attr[$ii][$jj]['embargo_flag'] == 3) {
+                            // 維持用の配列の更新
+                            $auth_room_id_array = array();
+                            
+                            $loop_num = $item_attr[$ii][$jj]['auth_num'];
+                            // 設定されている権限情報を格納する
+                            for($auth_num = 0; $auth_num < $loop_num; $auth_num++){
+                                // ルームIDを保持する
+                                    array_push($auth_room_id_array, $this->auth_room_ids[$auth_Cnt]);
+                                // カウンタを次へ
+                                $auth_Cnt++;
                             }
-                        } else {
-                            if($item_attr[$idx][$jj]['file_no'] > $attridx){
-                                $item_attr[$idx][$jj]['new_file_no'] = $item_attr[$idx][$jj]['file_no']-1;
+                            $item_attr[$ii][$jj]['auth_room_id'] = $auth_room_id_array;
+                            
+                            // 権限文字列を作成する
+                            // 権限が無い場合は空文字がテーブルに登録される
+                            $auth_param = "";
+                            if($loop_num > 0) {
+                                for($loop_auth = 0; $loop_auth < $loop_num; $loop_auth++) {
+                                    if($loop_auth > 0) {
+                                        $auth_param .= "|";
+                                    }
+                                    $auth_param .= $item_attr[$ii][$jj]['auth_room_id'][$loop_auth]. ",0";
+                                }
+                            }
+                            
+                            // 権限(≒課金)情報をテーブルに登録・更新
+                            $params = array();
+                            $params[] = $item_attr[$ii][$jj]["item_id"];          // アイテムID
+                            $params[] = $item_attr[$ii][$jj]["item_no"];          // アイテムNo
+                            $params[] = $item_attr[$ii][$jj]["attribute_id"];     // アイテム属性ID
+                            $params[] = $item_attr[$ii][$jj]["file_no"];          // ファイルNo
+                            $params[] = $auth_param;                              // 価格
+                            $params[] = $this->Session->getParameter("_user_id"); // 登録者
+                            $params[] = $this->Session->getParameter("_user_id"); // 更新者
+                            $params[] = "";                                       // 削除者
+                            $params[] = $this->TransStartDate;                    // 登録日時
+                            $params[] = $this->TransStartDate;                    // 更新日時
+                            $params[] = "";                                       // 削除日時
+                            $params[] = 0;                                        // 削除フラグ
+                            $result = $this->insertOrUpdatePrice($params, $error);
+                            if($result === false){
+                                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                $exception = new AppException($error);
+                                $exception->addError($error);
+                                throw $exception;
                             }
                         }
                     }
-                    $this->Session->setParameter("item_attr", $item_attr);
-                    $this->Session->setParameter("item_num_attr", $item_num_attr);
-                    return "stay";
-                default:
-                    break;
-                }
-            }
-            
-            // ------------------------------------------------------------
-            // 次の画面に行く前に、未入力欄を削除して整理
-            // ------------------------------------------------------------ 
-               for($ii=0; $ii<count($item_attr_type); $ii++) {
-                // ファイル／サムネイル以外はスルー
-                if(    $item_attr_type[$ii]['input_type']=='file' ||
-                    $item_attr_type[$ii]['input_type']=='file_price' || // Add file price Y.Nakao 2008/08/28
-                    $item_attr_type[$ii]['input_type']=='thumbnail'){ 
-                    $array_cleaned = array();
-                    // 未入力欄を除外
-                    for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
-                        if(
-                        $item_attr[$ii][$jj] != null 
-                        && array_key_exists('upload', $item_attr[$ii][$jj]) == true
-                        && $item_attr[$ii][$jj]['upload'] != null
-                        ) {
-                            array_push($array_cleaned, $item_attr[$ii][$jj]);
-                        }
-                    }
+                    // Add file authority 2015/03/18 T.Ichikawa --end--
                     
-                    $item_num_attr[$ii] = count($array_cleaned);
-                    // 0になってしまった場合は戻ったときのことを考えて救済措置
-                    if($item_num_attr[$ii]<=0) {
-                        $item_id = $this->Session->getParameter("edit_item_id");
-                        $item_no = $this->Session->getParameter("edit_item_no");
-                        $file_no = 1;
-                        if($item_id != null && $item_no != null){
-                            if($item_attr_type[$ii]['input_type']=='thumbnail'){
-                                $file_no = $this->calcMaxThumbnailNo($item_id, $item_no
-                                                                     , $ii + 1, $err_msg)+1;
-                            } else {
-                                $file_no = $this->getFileNo($item_id, $item_no
-                                                                     , $ii + 1, $err_msg);
-                            }
+                    // 価格をDBに保存
+                    if($item_attr_type[$ii]['input_type']=='file_price'){
+                        // 初期化
+                        $price_array = array();
+                        $room_id_array = array();
+                        // 個数保持
+                        $loop_num = $item_attr[$ii][$jj]['price_num'];
+                        // 設定されている価格情報を格納する
+                        for($price_num=0;$price_num<$loop_num;$price_num++){
+                            // ルームIDと価格を保持する
+                            array_push($room_id_array, $this->room_ids[$price_Cnt]);
+                            array_push($price_array, $this->price_value[$price_Cnt]);
+                            // カウンタを次へ
+                            $price_Cnt++;
+                        }
+                        $item_attr[$ii][$jj]['price_value'] = $price_array;
+                        $item_attr[$ii][$jj]['room_id'] = $room_id_array;
+                        // Add registered info save action 2009/02/04 Y.Nakao --start--
+                        $result = $ItemRegister->updatePrice($item_attr[$ii][$jj], $error);
+                        if($result === false){
+                            // update faild
+                            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($error);
+                            $exception->addError($error);
+                            throw $exception;
                         }
-                        $item_num_attr[$ii] = 1;
-                        array_push($array_cleaned, array('file_no' => $file_no));
+                        // Add registered info save action 2009/02/04 Y.Nakao --end--
                     }
-                    // クリンナップした配列を保存
-                    $item_attr[$ii] = $array_cleaned;
+                    $cntUpd++;
                 }
             }
-            $this->Session->setParameter("item_num_attr", $item_num_attr);        // 属性の数を更新
-            $this->Session->setParameter("item_attr", $item_attr);                // 属性を更新
-            
-            $delete_file_list = array();
-            $this->Session->setParameter("delete_file_list", $delete_file_list);
-            
-            // 次の画面へ
-            $this->Session->removeParameter("error_msg");
-            $this->Session->setParameter("error_msg",$err_msg);
+        }
         
-             // アクション終了処理
-            $result = $this->exitAction();    // トランザクションが成功していればCOMMITされる
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            
-            // Add When file is thumbnail only 2009/02/03 Y.Nakao --start--
-            if($this->Session->getParameter("isfile") == "1"){
-                return 'texts';
-            }
-            // Add When file is thumbnail only 2009/02/03 Y.Nakao --end--
-            
-            return 'success';
-        } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            $this->logFile(
-                "SampleAction",                    //クラス名
-                "execute",                        //メソッド名
-                $Exception->getCode(),            //ログID
-                $Exception->getMessage(),        //主メッセージ
-                $Exception->getDetailMsg() );    //詳細メッセージ            
-            //アクション終了処理
-              $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_error_msg);
-            return "error";
-        }   
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+        $ItemRegister->updateInsertUserIdForContributor(
+            intval($this->Session->getParameter("edit_item_id")),
+            $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+        
+        // セッションのアイテム情報を更新
+        $this->Session->setParameter("item_attr", $item_attr);
+        
+        if(!is_null($this->errMsg) && count($this->errMsg)>0){
+            // 入力にエラーがあるときは画面遷移しない
+            $this->save_mode = "stay";
+        }
+        
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "license",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+        );
+        $ret = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
+        }
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
+        
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
+        }
+        
+        return $ret;
     }
 }
 ?>
diff --git a/repository/action/main/item/editfileslicense/maple.ini b/repository/action/main/item/editfileslicense/maple.ini
index 79a8d00..9a5169f 100644
--- a/repository/action/main/item/editfileslicense/maple.ini
+++ b/repository/action/main/item/editfileslicense/maple.ini
@@ -11,8 +11,11 @@ Session = "ref:Session"
 Db = "ref:DbObject"
 
 [View]
-success = "action:repository_view_main_item_editfileslicense"
-stay = "action:repository_view_main_item_editfiles"
-error = "action:repository_view_main_item_editfiles"
+selecttype = "action:repository_view_main_item_selecttype"
+files = "action:repository_view_main_item_editfiles"
+license = "action:repository_view_main_item_editfileslicense"
 texts = "action:repository_view_main_item_edittexts"
- 
\ No newline at end of file
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+error = "action:repository_view_main_item_editfileslicense"
diff --git a/repository/action/main/item/editlinks/Editlinks.class.php b/repository/action/main/item/editlinks/Editlinks.class.php
index dcbd00b..78c7b5f 100644
--- a/repository/action/main/item/editlinks/Editlinks.class.php
+++ b/repository/action/main/item/editlinks/Editlinks.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editlinks.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Editlinks.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,1415 +14,171 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
- * [[機能説明]]
- *
- * @package     [[package名]]
+ * アイテム登録：リンク設定画面からの入力処理アクション
+ * 
  * @access      public
  */
 class Repository_Action_Main_Item_Editlinks extends RepositoryAction
 {
-    var $Session = null;
-    var $Db = null;
-    
-    // リクエストパラメタ, 入力形式別(2008/03/06)
-    var $base_attr = null;                  // 基本情報部分のリクエストパラメタ配列
-    var $item_attr_text = null;             // "text"属性
-    var $item_attr_textarea = null;         // "textarea"属性
-    var $item_attr_checkbox = null;         // "checkbox"属性
-    var $item_attr_name_family = null;      // "name"属性, 姓
-    var $item_attr_name_given = null;       // "name"属性, 名
-    var $item_attr_name_email = null;       // "name"属性, E-mail
-    var $item_attr_select = null;           // "select"属性
-    var $item_attr_link = null;             // "link"属性
-    var $item_attr_link_name = null;        // "link"属性 Add link display name 2009/03/19 A.Suzuki
-    var $item_attr_radio = null;            // "radio"属性
-//  var $item_index_ids = null;             // インデックスid列
-//  var $item_index_names = null;           // インデックス名列
-    
-    var $item_pub_date_year = null;         // アイテム公開日 : 年
-    var $item_pub_date_month = null;        // アイテム公開日 : 月
-    var $item_pub_date_day = null;          // アイテム公開日 : 日  
-    var $item_keyword = null;               // アイテムキーワード
-    var $item_keyword_english = null;       // アイテムキーワード(英)
-    //var $OpendIds = null;                 // 開いているインデックスのID列(,区切り)
-    //var $CheckedIds = null;                   // チェックされているインデックスのID列(|区切り)
-    //var $CheckedNames = null;             // チェックされているインデックスの名前列(|区切り)
-    
-    // オプション用
-    var $save_mode = null;      // 処理モード
-                                // "next" : リンク設定画面へ (デフォルト)
-                                // "add_row" : 属性の数を増やす
-                                // "up_row" : 属性を入れ替える (attridx-th属性が上に)
-                                // "down_row" : 属性を入れ替える (attridx-th属性が下に)
-                                // "add_author_id" : 氏名属性の外部著者IDの入力欄を増やす
-                                // "clear_author" : 氏名属性情報を削除する
-                                // "stay" : 保存 Add registered info save action 2009/02/09 Y.Nakao
-    var $target = null;         // 処理対象のメタデータ番号
-    var $attridx = null;        // 処理対象の属性番号
-    
-    // Add biblio info 2008/08/11 Y.Nakao --start--
-    var $item_attr_biblio_name = null;      // 書誌情報 : 雑誌名
-    var $item_attr_biblio_name_english = null;  // 書誌情報 : 雑誌名(英)
-    var $item_attr_biblio_volume = null;    // 書誌情報 : 巻
-    var $item_attr_biblio_issue = null;     // 書誌情報 : 号
-    var $item_attr_biblio_spage = null;     // 書誌情報 : 開始ページ
-    var $item_attr_biblio_epage = null;     // 書誌情報 : 終了ページ
-    // 2008/10/06 A.Suzuki --start--
-    var $item_attr_biblio_dateofissued = null;          // 書誌情報 : 発行年月日
-    var $item_attr_biblio_dateofissued_year = null;     // 書誌情報 : 発行年
-    var $item_attr_biblio_dateofissued_month = null;    // 書誌情報 : 発行月
-    var $item_attr_biblio_dateofissued_day = null;      // 書誌情報 : 発行日
-    // 2008/10/06 A.Suzuki --end--
-    // Add biblio info 2008/08/11 Y.Nakao --end--
-    
-    // Add item attribute:date 2008/10/14 A.Suzuki --start--
-    var $item_attr_date = null;         // 日付
-    var $item_attr_date_year = null;    // 日付 : 年
-    var $item_attr_date_month = null;   // 日付 : 月
-    var $item_attr_date_day = null;     // 日付 : 日
-    // Add item attribute:date 2008/10/14 A.Suzuki --end--
-    
-    // Add contents page 2010/08/06 Y.Nakao --start--
-    var $item_attr_heading = null;          // heading
-    var $item_attr_heading_en = null;       // heading(english)
-    var $item_attr_heading_sub = null;      // subheading
-    var $item_attr_heading_sub_en = null;   // subheading(english)
-    // Add contents page 2010/08/06 Y.Nakao --end--
+    // リクエストパラメーター
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     * @var string
+     */
+    public $save_mode = null;
     
-    // Add author ruby 2010/11/01 A.Suzuki --start--
-    var $item_attr_name_family_ruby = null; // "name", surname ruby
-    var $item_attr_name_given_ruby = null;  // "name", given name ruby
-    var $item_attr_name_author_id_prefix = null; // "name", authorID prefix
-    var $item_attr_name_author_id_suffix = null; // "name", authorID suffix
-    // Add author ruby 2010/11/01 A.Suzuki --end--
+    /**
+     * アイテム間リンク：関係性 入力値配列
+     * @var array
+     */
+    public $item_relation_select = null;
     
-    // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-    public $item_contributor = null;
-    public $item_contributor_handle = null;
-    public $item_contributor_name= null;
-    public $item_contributor_email = null;
-    // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+    /**
+     * インデックス開閉情報
+     *   delemit is ","
+     * @var string
+     */
+    public $OpendIds = null;
     
-    // Add Send Feedback Mail R.Matsuura 2013/11/12 --start--
-    public $send_feedback_mail_address_mailaddresses = null;
-    public $send_feedback_mail_address_authors = null;
-    // Add Send Feedback Mail R.Matsuura 2013/11/12 --end--
+    /**
+     * インデックスチェック情報：ID
+     *   delemit is "|"
+     * @var string
+     */
+    public $CheckedIds = null;
     
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * インデックスチェック情報：インデックス名
+     *   delemit is "|"
+     * @var string
      */
-    function execute()
-    {
-        $user_error_msg = '';       // GUI表示エラーメッセージ
-        try {
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                $user_error_msg = 'initで既に・・・';
-                throw $exception;
-            }      
-            
-            // セッション情報取得
-            $item_type_all = $this->Session->getParameter("item_type_all");         // 1.アイテムタイプ,  アイテムタイプのレコードをそのまま保存したものである。
-            $item_attr_type = $this->Session->getParameter("item_attr_type");       // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
-            $item_num_cand = $this->Session->getParameter("item_num_cand");         // 3.アイテム属性選択肢数 (N) : "item_num_cand"[N], 選択肢のない属性タイプは0を設定
-            $option_data = $this->Session->getParameter("option_data");             // 4.アイテム属性選択肢 (N): "option_data"[N][M], N属性タイプごとの選択肢。Mはアイテム属性選択肢数に対応。0～
-            $smartyAssign = $this->Session->getParameter("smartyAssign");
-            // ユーザ入力値＆変数
-            $item_num_attr = $this->Session->getParameter("item_num_attr");         // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
-            $item_attr_old = $this->Session->getParameter("item_attr");             // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
-            $item_attr = array();       // 6.アイテム属性 。これはリクエストから全部作り直す
-            $edit_flag = $this->Session->getParameter("edit_flag");                 // X.処理モード : edit_flag (0:新規作成, 1:既存編集)
-            
-            $sfmam = $this->Session->getParameter("feedback_mailaddress_str");
-            $sfmaa = $this->Session->getParameter("feedback_mailaddress_author_str");
-            $fma = $this->Session->getParameter("feedback_mailaddress_array");
-            $fmaa = $this->Session->getParameter("feedback_mailaddress_author_array");
-
-            // Add registered info save action 2009/02/03 Y.Nakao --start--
-            $smarty_assign = $this->Session->getParameter("smartyAssign");
-            $err_msg = array();
-            $ItemRegister = new ItemRegister($this->Session, $this->Db);
-            // Add registered info save action 2009/02/03 Y.Nakao --end--
-            
-            $NameAuthority = new NameAuthority($this->Session, $this->Db);
-            
-            // カウンタ
-            $cnt_text = 0;      // "text"属性カウンタ
-            $cnt_textarea = 0;  // "textarea"属性カウンタ
-            $cnt_name = 0;      // "name"属性カウンタ
-            $cnt_link = 0;      // "link"属性カウンタ
-            $cnt_select = 0;    // "select"属性カウンタ
-            $cnt_checkbox = 0;  // "checkbox"属性カウンタ
-            $cnt_radio = 0;     // "radio"属性カウンタ
-            $cnt_biblio = 0;    // "biblio_info"属性カウンタ 2008/08/11
-            $cnt_date = 0;      // "date"属性カウンタ 2008/10/14
-            $cnt_author_id = 0; // "name"属性外部著者IDカウンタ
-            
-            // ------------------------------------------------------------
-            // セッション情報保存 (全オプション共通)
-            // ------------------------------------------------------------     
-            
-            // Add LIDO 2014/05/20 S.Suzuki --start--
-            $warning = "";
-            // タイトルに空白文字列が入力されたら空文字に変換
-            if ($this->base_attr[0]===RepositoryConst::BLANK_WORD) {
-                $warning = $smarty_assign->getLang("repository_item_error_empty_title");
-                $this->base_attr[0] = '';
-            }
-            
-            if ($this->base_attr[1]===RepositoryConst::BLANK_WORD) {
-                $warning = $smarty_assign->getLang("repository_item_error_empty_title");
-                $this->base_attr[1] = '';
-            }
-            // Add LIDO 2014/05/20 S.Suzuki --end--
-            
-            // アイテム基本属性をセッションに保存        
-            $this->Session->setParameter("base_attr", array( 
-                "title" => ($this->base_attr[0]==' ') ? '' : $this->base_attr[0],   // ?3項演算子OK.
-                "title_english" => ($this->base_attr[1]==' ') ? '' : $this->base_attr[1],
-                "language" => $this->base_attr[2])
-            );      
-            // アイテム公開日ををセッションに保存
-            $tmp_item_pub_date = $this->Session->getParameter("item_pub_date");
-            $this->Session->setParameter("item_pub_date", array(
-                    "year" => ($this->item_pub_date_year == ' ') ? '' : $this->item_pub_date_year,
-                    "month" => $this->item_pub_date_month,
-                    "day" => $this->item_pub_date_day
-                )
-            );
-            // アイテムキーワードをセッションに保存
-            // ------------------------------------------------------------------
-            // キーワード精査 (空白除去)
-            // ------------------------------------------------------------------
-            $keywords = split("[|]", $this->item_keyword);
-            $keywords_en = split("[|]", $this->item_keyword_english);
-            $item_keyword_new = '';
-            $item_keyword_en_new = '';
-            for($ii=0; $ii<count($keywords); $ii++) {
-                $keywords[$ii] = trim($keywords[$ii]);
-                $item_keyword_new = $item_keyword_new . $keywords[$ii];
-                if($ii != count($keywords)-1) {
-                    $item_keyword_new = $item_keyword_new . '|';
-                }               
-            }
-            for($ii=0; $ii<count($keywords_en); $ii++) {
-                $keywords_en[$ii] = trim($keywords_en[$ii]);
-                $item_keyword_en_new = $item_keyword_en_new . $keywords_en[$ii];
-                if($ii != count($keywords_en)-1) {
-                    $item_keyword_en_new = $item_keyword_en_new . '|';
-                }               
-            }
-            $item_keyword = $item_keyword_new;
-            $item_keyword_english = $item_keyword_en_new;
-            $this->Session->setParameter("item_keyword", $item_keyword);
-            $this->Session->setParameter("item_keyword_english", $item_keyword_english);
-            
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-            // ------------------------------------------------------------------
-            // Contributor
-            // ------------------------------------------------------------------
-            $contributorUserId = "";
-            $contributorErrorMsg = "";
-            $item_contributor = null;
-            if($this->item_contributor_handle == " ")
-            {
-                $this->item_contributor_handle = "";
-            }
-            if($this->item_contributor_name == " ")
-            {
-                $this->item_contributor_name = "";
-            }
-            if($this->item_contributor_email == " ")
-            {
-                $this->item_contributor_email = "";
-            }
-            
-            if(strlen($this->item_contributor) > 0 && $this->item_contributor == "1")
-            {
-                // Get contributor's user_id
-                $contributorFlag = false;
-                $retStatus = $this->getUserIdForContributor(
-                                        $this->item_contributor_handle,
-                                        $this->item_contributor_name,
-                                        $this->item_contributor_email,
-                                        $contributorUserId);
-                if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_SUCCESS)
-                {
-                    $contributorFlag = true;
-                }
-                else if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST)
-                {
-                    if($this->save_mode == "next" || $this->save_mode == "stay")
-                    {
-                        $contributorErrorMsg = $smarty_assign->getLang("repository_item_contributor_error_not_exist");
-                        array_push($err_msg, $contributorErrorMsg);
-                    }
-                }
-                else if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT)
-                {
-                    if($this->save_mode == "next" || $this->save_mode == "stay")
-                    {
-                        $contributorErrorMsg = $smarty_assign->getLang("repository_item_contributor_error_conflict");
-                        array_push($err_msg, $contributorErrorMsg);
-                    }
-                }
-                else if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOAUTH)
-                {
-                    if($this->save_mode == "next" || $this->save_mode == "stay")
-                    {
-                        $contributorErrorMsg = $smarty_assign->getLang("repository_item_contributor_error_no_authority");
-                        array_push($err_msg, $contributorErrorMsg);
-                    }
-                }
-                
-                $item_contributor = array(
-                    RepositoryConst::ITEM_CONTRIBUTOR_HANDLE => $this->item_contributor_handle,
-                    RepositoryConst::ITEM_CONTRIBUTOR_NAME => $this->item_contributor_name,
-                    RepositoryConst::ITEM_CONTRIBUTOR_EMAIL => $this->item_contributor_email);
-                    
-                if(!$contributorFlag)
-                {
-                    $contributorUserId = $this->Session->getParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID);
-                }
-            }
-            else
-            {
-                $contributorUserId = $this->Session->getParameter("_user_id");
-            }
-            
-            // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --start--
-            $indice = $this->Session->getParameter("indice");
-            $indice = $this->addPrivateTreeInPositionIndex($indice, $contributorUserId);
-            $this->Session->setParameter("indice", $indice);
-            // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --end--
-            
-            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID, $contributorUserId);
-            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_ITEM_CONTRIBUTOR, $item_contributor);
-            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_ERROR_MSG, $contributorErrorMsg);
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
-            
-            
-            // Fix PHP Notice 2014/06/06 Y.Nakao --start--
-            $item = array("item_id"=>"", "item_no"=>"");
-            // Add registered info save action 2009/02/09 Y.Nakao --start--
-            if($this->save_mode == "stay" || $this->save_mode == "next"){
-                if($edit_flag == 0){
-                    // 新規登録時
-                    $item["item_id"] = intval($this->Db->nextSeq("repository_item"));
-                    $item["item_no"] = 1;
-                } elseif($edit_flag == 1){
-                    //既存編集時
-                    // 編集中のアイテムIDをセッションから取得
-                    $item["item_id"] = intval($this->Session->getParameter("edit_item_id"));
-                    $item["item_no"] = intval($this->Session->getParameter("edit_item_no"));
-                }
-                //タイトルの空チェックと設定 2009/08/26 K.Ito --start--
-                if((trim($this->base_attr[0]) == "") && (trim($this->base_attr[1]) == "") || (trim($this->base_attr[0]) == "タイトル無し") && (trim($this->base_attr[1]) != "no titile")){
-                    if($this->base_attr[2] == "ja"){
-                        //WEKOの設定言語に依存せず、論文の言語で決めるので仮タイトル文字列はベタ書きです
-                        $item["title"] = "タイトル無し";  
-                        $item["title_english"] = "";
-                    }else{
-                        $item["title"] = "";
-                        $item["title_english"] = "no title";
-                    }
-                //片方がタイトル無し、もう一方が入力があったら、タイトル無しを空に戻す
-                }else if((trim($this->base_attr[0]) == "タイトル無し") && (trim($this->base_attr[1]) != "")){
-                    $item["title"] = "";    
-                    $item["title_english"] = (trim($this->base_attr[1]));
-                //片方がno title、もう一方が入力があったら、タイトル無しを空に戻す
-                }else if((trim($this->base_attr[0]) != "") && (trim($this->base_attr[1]) == "no title")){
-                    $item["title"] = (trim($this->base_attr[0]));
-                    $item["title_english"] = "";
-                //タイトル無しのままで、言語だけ変更した場合
-                }else if((trim($this->base_attr[0]) == "タイトル無し") && (trim($this->base_attr[1]) == "")){
-                    if($this->base_attr[2] == "ja"){
-                        $item["title"] = (trim($this->base_attr[0]));
-                        $item["title_english"] = (trim($this->base_attr[1]));
-                    }else{
-                        $item["title"] = "";
-                        $item["title_english"] = "no title";
-                    }
-                //no titleのままで、言語だけ変更した場合
-                }else if((trim($this->base_attr[0]) == "") && (trim($this->base_attr[1]) == "no title")){
-                    if($this->base_attr[2] == "ja"){
-                        $item["title"] = "タイトル無し";
-                        $item["title_english"] = "";
-                    }else{
-                        $item["title"] = (trim($this->base_attr[0]));
-                        $item["title_english"] = (trim($this->base_attr[1]));
-                    }
-                }else{
-                    $item["title"] = (trim($this->base_attr[0]));
-                    $item["title_english"] = (trim($this->base_attr[1]));
-                }
-                /*
-                $item["title"] = ($this->base_attr[0]==' ') ? '' : $this->base_attr[0];
-                $item["title_english"] = ($this->base_attr[1]==' ') ? '' : $this->base_attr[1];
-                */
-                //タイトルの空チェックと設定 2009/08/26 K.Ito --end--
-                
-                $item["language"] = $this->base_attr[2];
-                $item["serch_key"] = $this->item_keyword;
-                $item["serch_key_english"] = $this->item_keyword_english;
-                if($edit_flag == 0){
-                    // new item
-                    $item["revision_no"] = 1;
-                    $item["prev_revision_no"] = 0;
-                } else if($edit_flag == 1){
-                    // edit item
-                    $result = $this->getItemTableData($item["item_id"], $item["item_no"], $Result_List, $error);
-                    if($result === false){
-                        array_push($err_msg, $error);
-                        $this->Session->setParameter("error_msg", $err_msg);
-                        $this->failTrans(); // rollback
-                        return 'error';
-                    }
-                    // Add add ["item"] to $Result_List[0]["revision_no"] 2013/09/11 K.Matsushita --start--
-                    $item["revision_no"] = $Result_List["item"][0]["revision_no"];
-                    $item["prev_revision_no"] = $Result_List["item"][0]["revision_no"];
-                    // Add add ["item"] to $Result_List[0]["revision_no"] 2013/09/11 K.Matsushita --end--
-                }
-                
-                // Fix check invalid date 2011/06/17 A.Suzuki --start--
-                $this->item_pub_date_year = trim($this->item_pub_date_year);
-                if($this->checkDate($this->item_pub_date_year, $this->item_pub_date_month, $this->item_pub_date_day)){
-                    $item["pub_year"] = $this->item_pub_date_year;
-                    $item["pub_month"] = $this->item_pub_date_month;
-                    $item["pub_day"] = $this->item_pub_date_day;
-                } else {
-                    // invalid date
-                    // Set item_pub_date
-                    $item["pub_year"] = $tmp_item_pub_date["year"];
-                    $item["pub_month"] = $tmp_item_pub_date["month"];
-                    $item["pub_day"] = $tmp_item_pub_date["day"];
-                    if($this->save_mode == "next" || $this->save_mode == "stay"){
-                        $this->Session->setParameter("item_pub_date", array(
-                                "year" => $tmp_item_pub_date["year"],
-                                "month" => $tmp_item_pub_date["month"],
-                                "day" => $tmp_item_pub_date["day"]
-                            )
-                        );
-                        $msg = $smarty_assign->getLang("repository_item_error_date");
-                        $tmp = $smarty_assign->getLang("repository_search_item");
-                        array_push($err_msg, sprintf($msg, $tmp));
-                    }
-                }
-                // Fix check invalid date 2011/06/17 A.Suzuki --end--
-                
-                $item["item_type_id"] = $item_type_all["item_type_id"];
-                $item["serch_key"] = $item_keyword;
-                $item["serch_key_english"] = $item_keyword_english;
-                if($edit_flag == 0){
-                    $result = $ItemRegister->entryItem($item, $error);
-                    if($result === false){
-                        // upload faild
-                        array_push($err_msg, $error);
-                        $this->Session->setParameter("error_msg", $err_msg);
-                        $this->failTrans(); // rollback
-                        return 'error';
-                    }
-                    $this->Session->setParameter("edit_item_id", $item["item_id"]);
-                    $this->Session->setParameter("edit_item_no", $item["item_no"]);
-                    $this->Session->setParameter("edit_flag", 1);
-                    $edit_flag = 1;
-                } else if($edit_flag == 1){
-                    $result = $ItemRegister->editItem($item["item_id"], $item["item_no"], $error);
-                    if($result === false){
-                        // upload faild
-                        array_push($err_msg, $error);
-                        $this->Session->setParameter("error_msg", $err_msg);
-                        return 'error';
-                    }
-                    $result = $ItemRegister->updateItem($item, $error);
-                    if($result === false){
-                        // upload faild
-                        array_push($err_msg, $error);
-                        $this->Session->setParameter("error_msg", $err_msg);
-                        $this->failTrans(); // rollback
-                        return 'error';
-                    }
-                }
-                // ------------------------------------------------------------------
-                // ファイル(サムネイル)以外の属性を全て論理削除
-                // ------------------------------------------------------------------
-                $result = $this->deleteItemAttrData($item["item_id"], $item["item_no"], $this->Session->getParameter("_user_id"), $error);
-                if($result === false){
-                    array_push($err_msg, $error);
-                    $this->Session->setParameter("error_msg", $err_msg);
-                    return 'error';
-                }
-            }
-            // Add join set insert index and set item links 2008/12/17 Y.Nakao
-            
-            // アイテム追加属性(メタデータ)をセッションに保存
-            // ii-thメタデータのリクエストを保存
-            for($ii=0; $ii<count($item_attr_type); $ii++) {
-                $attr_elm = array();        // 1メタデータの値列
-                $nCnt_attr = 0;             // 空白以外の属性個数
-                $nCnt_attr_flg = 0;         // 空白精査用
-                // ii-thメタデータのjj-th属性値のリクエストを保存
-                for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
-                    $metadata = array();
-                    $metadata["item_id"] = "";
-                    if(isset($item["item_id"]))
-                    {
-                        $metadata["item_id"] = $item["item_id"];
-                    }
-                    $metadata["item_no"] = "";
-                    if(isset($item["item_no"]))
-                    {
-                        $metadata["item_no"] = $item["item_no"];
-                    }
-                    $metadata["attribute_id"] = $item_attr_type[$ii]["attribute_id"];
-                    $metadata["item_type_id"] = $item_type_all["item_type_id"];
-                    $metadata["input_type"] = $item_attr_type[$ii]['input_type'];
-                    // ii-thメタデータの入力形式ごとのリクエストを保存
-                    switch($item_attr_type[$ii]['input_type']) {
-                    case 'text':
-                        $metadata["attribute_no"] = $jj+1;
-                        // 空白チェック
-                        if($this->item_attr_text[$cnt_text]==' ') {
-                            array_push($attr_elm, '');
-                            $metadata["attribute_value"] = '';
-                        } else {
-                            if($this->save_mode == "next" || $this->save_mode == "stay"){
-                                $nCnt_attr++;
-                                $metadata["attribute_no"] = $nCnt_attr;
-                            }
-                            array_push($attr_elm, $this->item_attr_text[$cnt_text]);
-                            $metadata["attribute_value"] = $this->item_attr_text[$cnt_text];
-                        }
-                        $cnt_text++;
-                        break;
-                    case 'link':
-                        $metadata["attribute_no"] = $jj+1;
-                        // 空白チェック
-                        // URL
-                        if($this->item_attr_link[$cnt_link]==' ') {
-                            $link_url = "";
-                        } else {
-                            $link_url = $this->item_attr_link[$cnt_link];
-                            $link_url = str_replace("|", "", $link_url);
-                        }
-                        // 表示名
-                        if($this->item_attr_link_name[$cnt_link]==' ') {
-                            $link_name = "";
-                        } else {
-                            $link_name = $this->item_attr_link_name[$cnt_link];
-                            $link_name = str_replace("|", "", $link_name);
-                        }
-
-                        if($link_url != ""){
-                            if($this->save_mode == "next" || $this->save_mode == "stay"){
-                                $nCnt_attr++;
-                                $metadata["attribute_no"] = $nCnt_attr;
-                            }
-                        }
-                        
-                        if($link_name != ""){
-                            array_push($attr_elm, $link_url."|".$link_name);
-                            $metadata["attribute_value"] = $link_url."|".$link_name;
-                        } else {
-                            array_push($attr_elm, $link_url);
-                            $metadata["attribute_value"] = $link_url;
-                        }
-
-                        $cnt_link++;
-                        break;
-                    case 'name':
-                        $metadata["personal_name_no"] = $jj+1;
-                        $family = '';
-                        $given = '';
-                        $family_ruby = '';
-                        $given_ruby = '';
-                        $email = '';
-                        $author_id = 0;
-                        $language = $item_attr_type[$ii]['display_lang_type'];
-                        $external_author_id = array();
-                        
-                        // 空白チェック
-                        if($this->item_attr_name_family[$cnt_name]!=' ') {
-                            $family = $this->item_attr_name_family[$cnt_name];
-                        }
-                        if($this->item_attr_name_given[$cnt_name]!=' ') {
-                            $given = $this->item_attr_name_given[$cnt_name];
-                        }
-                        if($language == "japanese"){
-                            if($this->item_attr_name_family_ruby[$cnt_name]!=' ') {
-                                $family_ruby = $this->item_attr_name_family_ruby[$cnt_name];
-                            }
-                            if($this->item_attr_name_given_ruby[$cnt_name]!=' ') {
-                                $given_ruby = $this->item_attr_name_given_ruby[$cnt_name];
-                            }
-                        }
-                        
-                        if($this->item_attr_name_email[$cnt_name]!=' ') {
-                            $email = $this->item_attr_name_email[$cnt_name];
-                        }
-                        
-                        for($kk=0; $kk<count($item_attr_old[$ii][$jj]["external_author_id"]); $kk++){
-                            $external_author_id_prefix = '';
-                            $external_author_id_suffix = '';
-                            $external_author_id_prefix_name = '';
-                            if($this->item_attr_name_author_id_prefix[$kk+$cnt_author_id]!=0) {
-                                $external_author_id_prefix = $this->item_attr_name_author_id_prefix[$kk+$cnt_author_id];
-                                $external_author_id_prefix_name = $NameAuthority->getExternalAuthorIdPrefixName($external_author_id_prefix);
-                                if($this->item_attr_name_author_id_suffix[$kk+$cnt_author_id]!=' ') {
-                                    $external_author_id_suffix = $this->item_attr_name_author_id_suffix[$kk+$cnt_author_id];
-                                }
-                            }
-                            
-                            if(strlen($external_author_id_prefix) > 0 && strlen($external_author_id_suffix) > 0)
-                            {
-                                array_push($external_author_id, array('prefix_id'=>$external_author_id_prefix, 'suffix'=>$external_author_id_suffix, 'old_prefix_id'=>$item_attr_old[$ii][$jj]["external_author_id"][$kk]["prefix_id"], 'old_suffix'=>$item_attr_old[$ii][$jj]["external_author_id"][$kk]["suffix"], 'prefix_name'=>$external_author_id_prefix_name));
-                            }
-                        }
-                        
-                        // Add external_author_id merge 2011/02/24 A.Suzuki --start--
-                        if(count($external_author_id)!=0
-                           && ($this->save_mode=="next" || $this->save_mode=="stay")
-                           && (strlen($family)!=0 || strlen($given)!=0 || strlen($email)!=0) )
-                        {
-                            $result = $NameAuthority->mergeExtAuthorId($external_author_id, $item_attr_old[$ii][$jj]["author_id"], true);
-                        }
-                        // Add external_author_id merge 2011/02/24 A.Suzuki --end--
-                        
-                        $cnt_author_id = $cnt_author_id + $kk;
-                        
-                        // Check old author_id 2010/11/02 A.Suzuki --start--
-                        // author_id をチェック(author_id == 0 : 新規, author_id > 0: 既存)
-                        if(intval($item_attr_old[$ii][$jj]["author_id"])==0
-                           && ($this->save_mode=="next" || $this->save_mode=="stay")
-                           && (strlen($family)!=0 || strlen($given)!=0 || strlen($email)!=0) )
-                        {
-                            // author_id 発番
-                            $author_id = $NameAuthority->getNewAuthorId();
-                        } else {
-                            // 既存のauthor_id
-                            $author_id = intval($item_attr_old[$ii][$jj]["author_id"]);
-                        }
-                        // Check old author_id 2010/11/02 A.Suzuki --end--
-                        // 氏名属性は1属性につき姓、名、E-mailを保存
-                        array_push($attr_elm, array(
-                                'family' => $family,
-                                'given' => $given,
-                                'family_ruby' => $family_ruby,
-                                'given_ruby' => $given_ruby,
-                                'email' => $email,
-                                'author_id' => $author_id,
-                                'language' => $language,
-                                'external_author_id' => $external_author_id
-                            )
-                        );
-                        
-                        // Add e-person 2013/11/07 R.Matsuura --start--
-                        if(strlen($email)>0)
-                        {
-                            array_push($external_author_id, array('prefix_id'=>'0', 'suffix'=>$this->item_attr_name_email[$cnt_name], 'old_prefix_id'=>'0', 'old_suffix'=>$item_attr_old[$ii][$jj]["email"], 'prefix_name'=>'e_mail_address'));
-                        }
-                        // Add e-person 2013/11/07 R.Matsuura --end--
-                        
-                        $metadata["family"] = $family;
-                        $metadata["name"] = $given;
-                        $metadata["family_ruby"] = $family_ruby;
-                        $metadata["name_ruby"] = $given_ruby;
-                        $metadata["e_mail_address"] = $email;
-                        $metadata["author_id"] = $author_id;
-                        $metadata["language"] = $language;
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            if($family != "" || $given != "" || $email != ""){
-                                $nCnt_attr++;
-                                $metadata["personal_name_no"] = $nCnt_attr;
-                            }
-                        }
-                        $metadata["external_author_id"] = $external_author_id;
-                        $cnt_name++;
-                        break;
-                    case 'textarea':
-                        $metadata["attribute_no"] = $jj+1;
-                        // 空白チェック
-                        if($this->item_attr_textarea[$cnt_textarea]==' ') {
-                            array_push($attr_elm, '');
-                            $metadata["attribute_value"] = '';
-                        } else {
-                            if($this->save_mode == "next" || $this->save_mode == "stay"){
-                                $nCnt_attr++;
-                                $metadata["attribute_no"] = $nCnt_attr;
-                            }
-                            array_push($attr_elm, $this->item_attr_textarea[$cnt_textarea]);
-                            $metadata["attribute_value"] = $this->item_attr_textarea[$cnt_textarea];
-                        }
-                        $cnt_textarea++;
-                        break;
-                    case 'select':
-                        $metadata["attribute_no"] = $jj+1;
-                        // S.Nonomura 2010/04/01 --start--
-                        // Blank Check
-                        if($this->item_attr_select[$cnt_select]==' ') {
-                            array_push($attr_elm, '');
-                            $metadata["attribute_value"] = '';
-                        // S.Nonomura 2010/04/01 --end--
-                        } else {
-                            array_push($attr_elm, $this->item_attr_select[$cnt_select]);
-                            $metadata["attribute_value"] = $this->item_attr_select[$cnt_select];
-                        }
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            $nCnt_attr++;
-                            $metadata["attribute_no"] = $nCnt_attr;
-                        }
-                        $cnt_select++;
-                        break;
-                    case 'checkbox':
-                        $metadata["attribute_no"] = array();
-                        // 0 or 1で還ってくる(チェックボックスの数だけ)
-                        $metadata["attribute_value"] = array();
-                        for($kk=0; $kk<count($option_data[$ii]); $kk++){
-                            array_push($attr_elm, $this->item_attr_checkbox[$cnt_checkbox]);    // チェックON
-                            if($this->item_attr_checkbox[$cnt_checkbox] == 1){
-                                $metadata["attribute_no"] = $jj + $kk + 1;
-                                $metadata["attribute_value"] = $option_data[$ii][$kk];
-                                if($this->save_mode == "stay" || $this->save_mode == "next"){
-                                    $result = $ItemRegister->entryMetadata($metadata, $error);
-                                    if($result === false){
-                                        array_push($err_msg, $error);
-                                        $this->Session->setParameter("error_msg", $err_msg);
-                                        $this->failTrans(); // rollback
-                                        return 'error';
-                                    }
-                                }
-                            }
-                            $cnt_checkbox++;
-                        }
-                        break;
-                    case 'radio':
-                        $metadata["attribute_no"] = $jj+1;
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            $nCnt_attr++;
-                            $metadata["attribute_no"] = $nCnt_attr;
-                        }
-                        // 選択番号が還ってくる。
-                        array_push($attr_elm, $this->item_attr_radio[$cnt_radio]);
-                        $metadata["attribute_value"] = $option_data[$ii][$this->item_attr_radio[$cnt_radio]];
-                        $cnt_radio++;
-                        break;
-                    case 'biblio_info':
-                        $biblio_name = '';
-                        $biblio_name_english = '';
-                        $volume = '';
-                        $issue = '';
-                        $spage = '';
-                        $epage = '';
-                        $year = '';
-                        $month = '';
-                        $day = '';
-                        $dateofissued = '';
-                        
-                        // 空白チェック
-                        if($this->item_attr_biblio_name[$cnt_biblio]!=' ') {
-                            $biblio_name = $this->item_attr_biblio_name[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_name_english[$cnt_biblio]!=' ') {
-                            $biblio_name_english = $this->item_attr_biblio_name_english[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_volume[$cnt_biblio]!=' ') {
-                            $volume = $this->item_attr_biblio_volume[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_issue[$cnt_biblio]!=' ') {
-                            $issue = $this->item_attr_biblio_issue[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_spage[$cnt_biblio]!=' ') {
-                            $spage = $this->item_attr_biblio_spage[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_epage[$cnt_biblio]!=' ') {
-                            $epage = $this->item_attr_biblio_epage[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_dateofissued_year[$cnt_biblio]!=' ') {
-                            $year = trim($this->item_attr_biblio_dateofissued_year[$cnt_biblio]);
-                        }
-                        if($this->item_attr_biblio_dateofissued_month[$cnt_biblio]!=' ') {
-                            $month = $this->item_attr_biblio_dateofissued_month[$cnt_biblio];
-                        }
-                        if($this->item_attr_biblio_dateofissued_day[$cnt_biblio]!=' ') {
-                            $day = $this->item_attr_biblio_dateofissued_day[$cnt_biblio];
-                        }
-
-                        // A.Suzuki 2008/10/06 --start--
-                        // 発行年月日を連結する
-                        if($year != '') {
-                            $dateofissued = $year;
-                            if($month != '') {
-                                if (strlen($month) == 1) {
-                                    $dateofissued = $dateofissued.'-0'.$month;
-                                } else {
-                                    $dateofissued = $dateofissued.'-'.$month;
-                                }
-                                if($day != '') {
-                                    if (strlen($day) == 1) {
-                                        $dateofissued = $dateofissued.'-0'.$day;
-                                    } else {
-                                        $dateofissued = $dateofissued.'-'.$day;
-                                    }
-                                }
-                            }
-                        }
-                        // A.Suzuki 2008/10/06 --end--
-                        
-                        // 書誌情報属性は1属性につき雑誌名、巻、号、ページ、発行年を保存
-                        array_push($attr_elm, array(
-                                'biblio_name' => $biblio_name,
-                                'biblio_name_english' => $biblio_name_english,
-                                'volume' => $volume,
-                                'issue' => $issue,
-                                'spage' => $spage,
-                                'epage' => $epage,
-                                'date_of_issued' => $dateofissued,
-                                'year' => $year,
-                                'month' => $month,
-                                'day' => $day
-                            )
-                        );
-                        $metadata["biblio_no"] = $jj+1;
-                        $metadata["biblio_name"] = $biblio_name;
-                        $metadata["biblio_name_english"] = $biblio_name_english;
-                        $metadata["volume"] = $volume;
-                        $metadata["issue"] = $issue;
-                        $metadata["start_page"] = $spage;
-                        $metadata["end_page"] = $epage;
-                        $metadata["date_of_issued"] = $dateofissued;
-                        $cnt_biblio++;
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            if($biblio_name!="" || $biblio_name_english!="" ||
-                                $volume!="" || $issue!="" || $spage!="" ||
-                                $epage!="" || $dateofissued!=""){
-                                $nCnt_attr++;
-                                $metadata["biblio_no"] = $nCnt_attr;
-                            }
-                        }
-                        break;
-                        
-                    // Add item attribute:date A.Suzuki 2008/10/14 --start--
-                    case 'date':
-                        $date_year = '';
-                        $date_month = '';
-                        $date_day = '';
-                        $date = '';
-                        
-                        // 空白チェック
-                        if($this->item_attr_date_year[$cnt_date]!=' ') {
-                            $date_year = trim($this->item_attr_date_year[$cnt_date]);
-                        }
-                        if($this->item_attr_date_month[$cnt_date]!=' ') {
-                            $date_month = $this->item_attr_date_month[$cnt_date];
-                        }
-                        if($this->item_attr_date_day[$cnt_date]!=' ') {
-                            $date_day = $this->item_attr_date_day[$cnt_date];
-                        }
-
-                        // 年月日を連結する
-                        if($date_year != '') {
-                            $date = $date_year;
-                            if($date_month != '') {
-                                if (strlen($date_month) == 1) {
-                                    $date = $date.'-0'.$date_month;
-                                } else {
-                                    $date = $date.'-'.$date_month;
-                                }
-                                if($date_day != '') {
-                                    if (strlen($date_day) == 1) {
-                                        $date = $date.'-0'.$date_day;
-                                    } else {
-                                        $date = $date.'-'.$date_day;
-                                    }
-                                }
-                            }
-                        }
-
-                        array_push($attr_elm, array(
-                                'date' => $date,
-                                'date_year' => $date_year,
-                                'date_month' => $date_month,
-                                'date_day' => $date_day
-                            )
-                        );
-                        $metadata["attribute_no"] = $jj+1;
-                        $metadata["attribute_value"] = $date;
-                        $cnt_date++;
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            if($date!=""){
-                                $nCnt_attr++;
-                                $metadata["attribute_no"] = $nCnt_attr;
-                            }
-                        }
-                        break;
-                    // Add item attribute:date A.Suzuki 2008/10/14 --start--
-                    // Add contents page Y.Nakao 2010/08/06 --start--
-                    case 'heading':
-                        $metadata["attribute_no"] = $jj+1;
-                        $heading = "";
-                        $heading_en = "";
-                        $heading_sub = "";
-                        $heading_sub_en = "";
-                        // check string empty
-                        $this->item_attr_heading = str_replace("|", "", $this->item_attr_heading);
-                        if($this->item_attr_heading!=' ') {
-                            $heading = $this->item_attr_heading; 
-                        }
-                        $this->item_attr_heading_en = str_replace("|", "", $this->item_attr_heading_en);
-                        if($this->item_attr_heading_en!=' ') {
-                            $heading_en = $this->item_attr_heading_en;
-                        }
-                        $this->item_attr_heading_sub = str_replace("|", "", $this->item_attr_heading_sub);
-                        if($this->item_attr_heading_sub!=' ') {
-                            $heading_sub = $this->item_attr_heading_sub;
-                        }
-                        $this->item_attr_heading_sub_en = str_replace("|", "", $this->item_attr_heading_sub_en);
-                        if($this->item_attr_heading_sub_en!=' ') {
-                            $heading_sub_en = $this->item_attr_heading_sub_en;
-                        }
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            $nCnt_attr++;
-                            $metadata["attribute_no"] = $nCnt_attr;
-                        }
-                        $metadata["attribute_value"] = $heading."|".$heading_en."|".$heading_sub."|".$heading_sub_en; 
-                        array_push($attr_elm, $metadata["attribute_value"]);
-                        break;
-                    // Add contents page Y.Nakao 2010/08/06 --end--
-                    default :
-                        // ファイルとサムネイルはセッション情報をそのままコピー
-                        array_push($attr_elm, $item_attr_old[$ii][$jj]);                    
-                        break;
-                    }
-                    if($item_attr_type[$ii]['input_type'] != 'checkbox'){
-                        if($this->save_mode == "next" || $this->save_mode == "stay"){
-                            if($nCnt_attr > $nCnt_attr_flg){
-                                $result = $ItemRegister->entryMetadata($metadata, $error);
-                                if($result === false){
-                                    array_push($err_msg, $error);
-                                    $this->Session->setParameter("error_msg", $err_msg);
-                                    $this->failTrans(); // rollback
-                                    return 'error';
-                                }
-                                $nCnt_attr_flg = $nCnt_attr;
-                            }
-                        }
-                    }
-                }
-                array_push($item_attr, $attr_elm);      // 1メタデータ分のユーザ入力値をセット
-            }
-            
-            if($this->save_mode == "stay" || $this->save_mode == "next"){
-                // 基本情報チェック
-                $ItemRegister->checkBaseInfo($item, $err_msg, $warning);
-                // 必須入力検査
-                $ItemRegister->checkEntryInfo($item_attr_type, $item_num_attr, $item_attr, 'meta', $err_msg, $warning);
-                
-                // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-                $ItemRegister->updateInsertUserIdForContributor(
-                        intval($this->Session->getParameter("edit_item_id")),
-                        $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
-                // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
-            }
-            // Add registered info save action 2009/02/09 Y.Nakao --end--
-            
-            $this->Session->setParameter("error_msg", $err_msg);
-            $this->Session->setParameter("warning", $warning);
-            
-            // Fix PHP Notice 2014/06/06 Y.Nakao --end--
-            
-            // Add error input Screen changes  K.Matsuo 2013/5/30 --start--
-            if(count($err_msg)>0){
-                // 入力にエラーがあるときは画面遷移しない
-                $this->save_mode = "stay";
-            }
-            // Add error input Screen changes  K.Matsuo 2013/5/30 --end--
-            
-            // Add e-person R.Matsuura 2013/11/18 --start--
-            // feedback mail送信先を設定
-            $feedback_mail_array = explode(",", $this->send_feedback_mail_address_mailaddresses[0]);
-            $ret = $ItemRegister->deleteFeedbackMailAuthorId($item["item_id"], $item["item_no"]);
-            if($ret === false)
-            {
-                return "error";
-            }
-            $authorIdNo = 1;
-            for ($cnt = 0; $cnt < count($feedback_mail_array); $cnt++){
-                // check mail address
-                if ( $feedback_mail_array[$cnt] == "") {
-                    continue;
-                }
-                
-                // get author_id
-                $authorId = $ItemRegister->getAuthorIdByMailAddress($feedback_mail_array[$cnt]);
-                if($authorId === false){
-                    continue;
-                }
-                
-                // insert send feedback mail author id
-                $ItemRegister->insertFeedbackMailAuthorId( $item["item_id"], $item["item_no"], $authorIdNo, $authorId);
-                if($result === false){
-                    return "error";
-                }
-                
-                // set author id no
-                $authorIdNo++;
-            }
-            $feedback_mail_authors_array = explode(",", $this->send_feedback_mail_address_authors[0]);
-            $this->Session->setParameter("feedback_mailaddress_str", $this->send_feedback_mail_address_mailaddresses[0]);
-            $this->Session->setParameter("feedback_mailaddress_author_str", $this->send_feedback_mail_address_authors[0]);
-            $this->Session->setParameter("feedback_mailaddress_array", $feedback_mail_array);
-            $this->Session->setParameter("feedback_mailaddress_author_array", $feedback_mail_authors_array);
-            // Add e-person R.Matsuura 2013/11/18 --end--
-            
-            // ------------------------------------------------------------
-            // オプション個別処理
-            // ------------------------------------------------------------    
-            //
-            // オプション処理用
-            if ($this->save_mode != "next") {
-                $idx = (int)($this->target);
-                switch($this->save_mode) {
-                    case "add_row":
-                        // target-thメタデータの属性数を増やす               
-                        $item_num_attr[$idx] = $item_num_attr[$idx] + 1;
-                        $this->Session->setParameter("item_num_attr", $item_num_attr);
-                        // 入力形式ごとに分岐
-                        switch($item_attr_type[$idx]['input_type']) {
-                            case "text":
-                            case "textarea":
-                            case "link":
-                                array_push($item_attr[$idx], '');
-                                break;
-                            case "name":
-                                $new_name = array(
-                                    'family' => '',
-                                    'given' => '',
-                                    'family_ruby' => '',
-                                    'given_ruby' => '',
-                                    'email' => '',
-                                    'author_id' => '',
-                                    'external_author_id' => array(array('prefix_id'=>'', 'suffix'=>''))
-                                );
-                                array_push($item_attr[$idx], $new_name);
-                                break;
-                            // Add biblio info 2008/08/11 Y.Nakao --start--
-                            case "biblio_info":
-                                $new_biblio = array(
-                                    'biblio_name' => '',
-                                    'biblio_name_english' => '',
-                                    'volume' => '',
-                                    'issue' => '',
-                                    'spage' => '',
-                                    'epage' => '',
-                                    'year' => '',
-                                    'month' => '',
-                                    'day' => '',
-                                    'date_of_issued' => ''
-                                );
-                                array_push($item_attr[$idx], $new_biblio);
-                                break;
-                            // Add biblio info 2008/08/11 Y.Nakao --end--
-                            // Add item attribute:date 2008/10/14 A.Suzuki --start--
-                            case "date":
-                                $new_date = array(
-                                    'date_year' => '',
-                                    'date_month' => '',
-                                    'date_day' => '',
-                                    'date' => ''
-                                );
-                                array_push($item_attr[$idx], $new_date);
-                                break;
-                            // Add item attribute:date 2008/10/14 A.Suzuki --end--
-                            default:
-                                break;
-                        }
-                    case "up_row":
-                        // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
-                        // ※target == 0(一番上)の場合は無効
-                        $attridx = (int)($this->attridx);
-                        if( $attridx == 0) {
-                            break;
-                        }
-                        // 配列の入替
-                        $bufarray = $item_attr[$idx][$attridx];
-                        $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx-1];
-                        $item_attr[$idx][$attridx-1] = $bufarray;
-                        break;
-                    case "down_row":
-                        // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
-                        // ※target == $item_num_attr[$idx]-1(一番下)の場合は無効
-                        $attridx = (int)($this->attridx);
-                        if( $attridx >= $item_num_attr[$idx]-1) {
-                            break;
-                        }
-                        // 配列の入替
-                        $bufarray = $item_attr[$idx][$attridx];
-                        $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx+1];
-                        $item_attr[$idx][$attridx+1] = $bufarray;
-                        break;
-                    case "add_author_id":
-                        // Add author_id input space
-                        $attridx = (int)($this->attridx);
-                        $new_author_id = array('prefix_id'=>'', 'suffix'=>'');
-                        array_push($item_attr[$idx][$attridx]["external_author_id"], $new_author_id);
-                        break;
-                    case "clear_author":
-                        // Clear author data
-                        $attridx = (int)($this->attridx);
-                        $new_name = array(
-                                    'family' => '',
-                                    'given' => '',
-                                    'family_ruby' => '',
-                                    'given_ruby' => '',
-                                    'email' => '',
-                                    'author_id' => '',
-                                    'external_author_id' => array(array('prefix_id'=>'', 'suffix'=>''))
-                                );
-                        $item_attr[$idx][$attridx] = $new_name;
-                        break;
-                    default:
-                        break;
-                }
-                $this->Session->setParameter("item_attr", $item_attr);
-                // end action
-                $result = $this->exitAction(); //COMMIT
-                if ( $result == false ){
-                    $this->failTrans(); // rollback
-                    return 'error';
-                }
-                
-                return "stay";
-            }
-            
-            // ------------------------------------------------------------
-            // 属性情報を更新 (この時点では歯抜け状態。)
-            // ------------------------------------------------------------   
-            $this->Session->setParameter("item_attr", $item_attr);
-            
-            // Add registered info save action 2009/02/09 Y.Nakao --start--
-            
-            // Add registered info save action 2009/02/09 Y.Nakao --end--
-            
-            // ------------------------------------------------------------
-            // 次の画面に進む前に、テキスト入力の空白入力を詰める
-            // ※複数可能、かつ空白入力1以上の場合
-            // ------------------------------------------------------------           
-            for($ii=0; $ii<count($item_attr_type); $ii++) {
-                // 複数指定不可のメタデータはスルー
-                if( $item_attr_type[$ii]['plural_enable']!=1){
-                    continue;
-                }
-                // ファイル／サムネイルはスルー
-                // ラジオボックス, セレクトボックスは初期値が設定されているのでスルー
-                // チェックボックスはチェックしなくてもＯＫなのでスルー
-                if( $item_attr_type[$ii]['input_type']=='file' ||
-                    $item_attr_type[$ii]['input_type']=='thumbnail' ||
-                    $item_attr_type[$ii]['input_type']=='checkbox' ||
-                    $item_attr_type[$ii]['input_type']=='radio' ||
-                    $item_attr_type[$ii]['input_type']=='select'){ 
-                    continue;
-                }
-                // ii-thメタデータの空白でない入力数を計算
-                $cnt = 0;
-                for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
-                    if($item_attr_type[$ii]['input_type']=='name'){
-                        if( $item_attr[$ii][$jj]['family'] != '' ||
-                            $item_attr[$ii][$jj]['given'] != '') {
-                            $cnt++;
-                        }
-                    // Add biblio info 2008/08/11 --start--
-                    } else if($item_attr_type[$ii]['input_type']=='biblio_info'){
-                        // 書誌情報の有効条件は、一応何かしら値が入っていることとする
-                        if( $item_attr[$ii][$jj]['biblio_name'] != '' || 
-                            $item_attr[$ii][$jj]['biblio_name_english'] != '' || 
-                            $item_attr[$ii][$jj]['volume'] != '' ||
-                            $item_attr[$ii][$jj]['issue'] != '' || 
-                            ($item_attr[$ii][$jj]['spage'] != '' || 
-                            $item_attr[$ii][$jj]['epage'] != '') ||
-                            $item_attr[$ii][$jj]['date_of_issued'] != '' ) {
-                            $cnt++;
-                        }
-                    // Add biblio info 2008/08/11 --end--
-                    // Add link name 2009/03/19 --start--
-                    } else if($item_attr_type[$ii]['input_type']=='link'){
-                        // リンク有効条件は、URLに何かしら値が入っていることとする
-                        $link_data = explode("|", $item_attr[$ii][$jj]);
-                        if($link_data[0] != '') {
-                            $cnt++;
-                        }
-                    // Add link name 2009/03/19 --end--
-                    } else {
-                        if($item_attr[$ii][$jj] != '') {
-                            $cnt++; 
-                        }
-                    }
-                }
-                $array_effective = array();
-                // 有効入力無し=>0-th要素のみ残し、削除
-                if( $cnt == 0 ) {
-                    // Add php notice T.Koyasu 2014/09/16 --start--
-                    if(isset($item_attr[$ii]) && count($item_attr[$ii]) > 0){
-                        array_push($array_effective, $item_attr[$ii][0]);
-                    }
-                    // Add php notice T.Koyasu 2014/09/16 --end--
-                    $item_num_attr[$ii] = 1;
-                    $item_attr[$ii] = $array_effective;
-                // 有効入力あり=>無効な入力を削除 
-                } else {
-                    for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
-                        if($item_attr_type[$ii]['input_type']=='name'){
-                            if( $item_attr[$ii][$jj]['family'] != '' ||
-                                $item_attr[$ii][$jj]['given'] != '') {
-                                if(count($item_attr[$ii][$jj]['external_author_id'])>=2){
-                                    $external_author_id_array = array();
-                                    for($kk=0;$kk<count($item_attr[$ii][$jj]['external_author_id']);$kk++){
-                                        $author_id_add_flag = true;
-                                        if($kk!=0){
-                                            for($ll=0;$ll<count($external_author_id_array);$ll++){
-                                                if($item_attr[$ii][$jj]['external_author_id'][$kk]['prefix_id']==$external_author_id_array[$ll]['prefix_id']
-                                                    && $item_attr[$ii][$jj]['external_author_id'][$kk]['suffix']==$external_author_id_array[$ll]['suffix']){
-                                                    $author_id_add_flag = false;
-                                                    break;
-                                                }
-                                            }
-                                        }
-                                        if($author_id_add_flag){
-                                            array_push($external_author_id_array, $item_attr[$ii][$jj]['external_author_id'][$kk]);
-                                        }
-                                    }
-                                    $item_attr[$ii][$jj]['external_author_id'] = $external_author_id_array;
-                                }
-                                array_push($array_effective, $item_attr[$ii][$jj]);
-                            }
-                        // Add biblio info 2008/08/11 --start--
-                        } else if($item_attr_type[$ii]['input_type']=='biblio_info'){
-                            if( $item_attr[$ii][$jj]['biblio_name'] != '' || 
-                                $item_attr[$ii][$jj]['biblio_name_english'] != '' || 
-                                $item_attr[$ii][$jj]['volume'] != '' ||
-                                $item_attr[$ii][$jj]['issue'] != '' || 
-                                ($item_attr[$ii][$jj]['spage'] != '' || 
-                                $item_attr[$ii][$jj]['epage'] != '') ||
-                                $item_attr[$ii][$jj]['date_of_issued'] != '' ) {
-                                array_push($array_effective, $item_attr[$ii][$jj]);
-                            }
-                        // Add biblio info 2008/08/11 --end--
-                        // Add link name 2009/03/19 --start--
-                        } else if($item_attr_type[$ii]['input_type']=='link'){
-                            $link_data = explode("|", $item_attr[$ii][$jj]);
-                            if($link_data[0] != '') {
-                                array_push($array_effective, $item_attr[$ii][$jj]);
-                            }
-                        // Add link name 2009/03/19 --end--
-                        } else {
-                            if($item_attr[$ii][$jj] != '') {
-                                array_push($array_effective, $item_attr[$ii][$jj]);
-                            }
-                        }
-                    }
-                    $item_num_attr[$ii] = count($array_effective);
-                    $item_attr[$ii] = $array_effective;                 
-                }
-            }
-            
-            // ------------------------------------------------------------
-            // 属性情報を更新 (この時点では空入力は間引かれている)
-            // ------------------------------------------------------------   
-            $this->Session->setParameter("item_attr", $item_attr);
-            $this->Session->setParameter("item_num_attr", $item_num_attr);          
-            
-            // 次の画面へ
-            
-            // アクション終了処理
-            $result = $this->exitAction();  // トランザクションが成功していればCOMMITされる
-            if ( $result == false ){
-                //print "終了処理失敗";
-            }
-            
-            return 'success';
-        } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            $this->logFile(
-                "SampleAction",                 //クラス名
-                "execute",                      //メソッド名
-                $Exception->getCode(),          //ログID
-                $Exception->getMessage(),       //主メッセージ
-                $Exception->getDetailMsg() );   //詳細メッセージ           
-            //アクション終了処理
-            $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_);
-            return "error";
-        }    
-    }
+    public $CheckedNames = null;
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
     
-    // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
     /**
-     * Get contributor's user_id by handle, name and email
-     *
-     * @param string $handle
-     * @param string $name
-     * @param string $email
-     * @param string &$outContributorUserId
-     * @return string "Success", "NotExist", "Conflict"
-     * @access private
+     * 実行処理
+     * @see RepositoryAction::executeApp()
      */
-    private function getUserIdForContributor($handle, $name, $email, &$outContributorUserId)
+    protected function executeApp()
     {
-        $outContributorUserId = "";
+        // インスタンス作成
+        $ItemRegister = new ItemRegister($this->Session, $this->Db);
         
-        // Check handle
-        if(strlen($handle) > 0)
-        {
-            // Execute select
-            $query = "SELECT user_id ".
-                     "FROM ".DATABASE_PREFIX."users ".
-                     "WHERE handle = ? ;";
-            $params = array();
-            $params[] = $handle;
-            $result = $this->Db->execute($query, $params);
-            if($result == false || count($result) < 1 || !array_key_exists("user_id", $result[0]))
-            {
-                // Return "NotExist"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
-            }
-            else if(count($result) != 1)
-            {
-                // Return "Conflict"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
+        // セッション情報取得
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        $link = $this->Session->getParameter("link");
+        $base_attr = $this->Session->getParameter("base_attr");
+        $item_id = intval($this->Session->getParameter("edit_item_id"));
+        $item_no = intval($this->Session->getParameter("edit_item_no"));
+        
+        for($ii=0; $ii<count($link); $ii++){
+            $relation = '';
+            if($this->item_relation_select[$ii]!=' ') {
+                $relation = $this->item_relation_select[$ii];
             }
-            
-            // Get user_id
-            $outContributorUserId = $result[0]["user_id"];
+            $link[$ii]['relation'] = $relation;
         }
         
-        // Check name
-        if(strlen($name) > 0)
-        {
-            // Execute select
-            $query = "SELECT user_id ".
-                     "FROM ".DATABASE_PREFIX."users_items_link ".
-                     "WHERE item_id = ? ".
-                     "AND content = ? ;";
-            $params = array();
-            $params[] = 4;
-            $params[] = $name;
-            $result = $this->Db->execute($query, $params);
-            if($result == false || count($result) < 1 || !array_key_exists("user_id", $result[0]))
-            {
-                // Return "NotExist"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
-            }
-            else if(count($result) != 1 && strlen($outContributorUserId) <= 0)
-            {
-                // Return "Conflict"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
-            }
-            else if(count($result) != 1 && strlen($outContributorUserId) > 0)
-            {
-                $isMatch = false;
-                for($ii=0; $ii<count($result); $ii++)
-                {
-                    if($result[$ii]["user_id"] == $outContributorUserId)
-                    {
-                        $isMatch = true;
-                        break;
-                    }
-                }
-                
-                if(!$isMatch)
-                {
-                    // Return "Conflict"
-                    $outContributorUserId = "";
-                    return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
-                }
-            }
-            else if(count($result) == 1)
-            {
-                $tmpUserId = $result[0]["user_id"];
-                if($outContributorUserId > 0 && $outContributorUserId != $tmpUserId)
-                {
-                    // Return "Conflict"
-                    $outContributorUserId = "";
-                    return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
-                }
-                else
-                {
-                    // Get user_id
-                    $outContributorUserId = $tmpUserId;
-                }
+        // set session to index open info
+        if($this->OpendIds != null && $this->OpendIds != '') {  
+            $arOpenIndexId = array();
+            $arOpenIndexId = explode(",", $this->OpendIds);
+            $this->Session->removeParameter("open_node_index_id_index");
+            $this->Session->setParameter("open_node_index_id_index", $arOpenIndexId);
+        }
+        // set session to check index info
+        $indice = array();
+        if( $this->CheckedIds != null && $this->CheckedIds != '' ){
+            $checked_ids = explode('|', $this->CheckedIds);
+            $checked_names = explode('|', str_replace("&#039;", "'", html_entity_decode($this->CheckedNames)));
+            for($ii=0; $ii<count($checked_ids); $ii++) {
+                array_push($indice, array(
+                        'index_id' => $checked_ids[$ii],
+                        'index_name' => $checked_names[$ii])
+                        );
             }
         }
+        $ItemRegister->setInsUserId($this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
+        $indice = $this->addPrivateTreeInPositionIndex($indice, $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
         
-        // Check email
-        if(strlen($email) > 0)
-        {
-        // Execute select
-            $query = "SELECT user_id ".
-                     "FROM ".DATABASE_PREFIX."users_items_link ".
-                     "WHERE item_id = ? ".
-                     "AND content = ? ;";
-            $params = array();
-            $params[] = 5;
-            $params[] = $email;
-            $result = $this->Db->execute($query, $params);
-            if($result == false || count($result) < 1 || !array_key_exists("user_id", $result[0]))
-            {
-                // Return "NotExist"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
-            }
-            else if(count($result) != 1 && strlen($outContributorUserId) <= 0)
-            {
-                // Return "Conflict"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
-            }
-            
-            // Get user_id
-            $tmpUserId = $result[0]["user_id"];
-            if($outContributorUserId != $tmpUserId)
-            {
-                // Return "Conflict"
-                $outContributorUserId = "";
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
-            }
+        $item = array("item_id"=>$item_id, "item_no"=>$item_no);
+        $result = $ItemRegister->entryPositionIndex($item, $indice, $error);
+        if($result === false){
+            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($error);
+            $exception->addError($error);
+            throw $exception;
+        }
+        $result = $ItemRegister->entryReference($item, $link, $error);
+        if($result === false){
+            $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($error);
+            $exception->addError($error);
+            throw $exception;
         }
+        $ItemRegister->updateInsertUserIdForContributor(
+                intval($this->Session->getParameter("edit_item_id")),
+                $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
         
-        if(strlen($outContributorUserId) > 0)
-        {
-            $authId = $this->getRoomAuthorityID($outContributorUserId);
-            if($authId >= REPOSITORY_ITEM_REGIST_AUTH)
-            {
-                // Return "Success"
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_SUCCESS;
-            }
-            else
-            {
-                // Return "NoAuth"
-                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOAUTH;
-            }
+        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
+        // set y handle suffix
+        $repositoryHandleManager->setSuffix($base_attr['title'], $item_id, $item_no);
+        
+        // セッション情報更新
+        $this->Session->setParameter("link", $link);
+        $this->Session->setParameter("indice", $indice);
+        
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "links",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+        );
+        $ret = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
         }
-        else
-        {
-            // Return "NotExist"
-            return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
+        
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
+        }
+        
+        if($ret != "links"){
+            $this->Session->removeParameter("search_index_id_link");
+            $this->Session->removeParameter("link_searchkeyword");
+            $this->Session->removeParameter("link_search");
+            $this->Session->removeParameter("link_searchtype");
+            $this->Session->removeParameter("view_open_node_index_id_item_link");
         }
+        
+        return $ret;
     }
-    // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
 }
 ?>
diff --git a/repository/action/main/item/editlinks/maple.ini b/repository/action/main/item/editlinks/maple.ini
index b8606dc..5150c7e 100644
--- a/repository/action/main/item/editlinks/maple.ini
+++ b/repository/action/main/item/editlinks/maple.ini
@@ -4,15 +4,18 @@ request = POST
 
 [ValidateDef]
 authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
-base_attr
-item_attr_texts
-save_mode
+linkitem_name
+linkitem_id
 
 [Action]
-Db = "ref:DbObject"
 Session = "ref:Session"
+Db = "ref:DbObject"
 
 [View]
-success = "action:repository_view_main_item_editlinks"
-stay = "action:repository_view_main_item_edittexts"
-error = "action:repository_view_main_item_edittexts"
+selecttype = "action:repository_view_main_item_selecttype"
+files = "action:repository_view_main_item_editfiles"
+texts = "action:repository_view_main_item_edittexts"
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+error = "action:repository_view_main_item_editlinks"
diff --git a/repository/action/main/item/edittexts/Edittexts.class.php b/repository/action/main/item/edittexts/Edittexts.class.php
index bdec060..60ff87e 100644
--- a/repository/action/main/item/edittexts/Edittexts.class.php
+++ b/repository/action/main/item/edittexts/Edittexts.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Edittexts.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Edittexts.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,273 +14,1568 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/IDServer.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：メタデータ入力画面からの入力処理アクション
  *
- * @package     [[package名]]
  * @access      public
  */
 class Repository_Action_Main_Item_Edittexts extends RepositoryAction
-{   
-    // リクエストパラメタ
-    // ファイル以外のパラメタは本コールバック関数で処理する。
-    var $licence = null;                // ファイルのライセンス配列, アップロード済みアイテムの数に対応
-    var $freeword = null;               // ファイルのライセンス自由記述欄配列, " "の場合、未入力
-    var $embargo_year = null;           // エンバーゴ年
-    var $embargo_month = null;          // エンバーゴ月
-    var $embargo_day = null;            // エンバーゴ日
-    var $embargo_flag = null;           // エンバーゴフラグ(0:公開日をアイテム公開日に合わせる, 1:公開日を独自に設定する)
-    
-    // Add file price Y.Nakao 2008/08/28 --start--
-    var $room_ids = null;               // 選択されたグループのID配列
-    var $price_value = null;            // 設定された価格配列
-    var $save_mode = null;              // 保存か次へか
-    // Add file price Y.Nakao 2008/08/28 --end--
-    
-    // Extend file type A.Suzuki 2009/12/15 --start--
-    var $display_type = null;
-    var $display_name = null;
-    var $flash_embargo_year = null;         // フラッシュファイルエンバーゴ年
-    var $flash_embargo_month = null;        // フラッシュファイルエンバーゴ月
-    var $flash_embargo_day = null;          // フラッシュファイルエンバーゴ日
-    var $flash_embargo_flag = null;         // フラッシュファイルエンバーゴフラグ(0:公開日をアイテム公開日に合わせる, 1:公開日を独自に設定する)
-    // Extend file type A.Suzuki 2009/12/15 --end--
-
+{
+    // リクエストパラメーター
     /**
-     * [[機能説明]]
-     *
-     * @access  public
-     */
-    function execute()
-    {   
-        $istest = true;             // テスト用フラグ
-        // Add registered info save action 2009/02/03 Y.Nakao --start--
-        $smarty_assign = $this->Session->getParameter("smartyAssign");
-        $err_msg = array();
+     * 基本情報部分のリクエストパラメタ配列
+     * @var array
+     */
+    public $base_attr = null;
+    
+    /**
+     * アイテム公開日：年
+     * @var string
+     */
+    public $item_pub_date_year = null;
+    
+    /**
+     * アイテム公開日：月
+     * @var string
+     */
+    public $item_pub_date_month = null;
+    
+    /**
+     * アイテム公開日：日
+     * @var string
+     */
+    public $item_pub_date_day = null;
+    
+    /**
+     * キーワード
+     * @var string
+     */
+    public $item_keyword = null;
+    
+    /**
+     * キーワード(英)
+     * @var string
+     */
+    public $item_keyword_english = null;
+    
+    /**
+     * "text"属性入力値配列
+     * @var array
+     */
+    public $item_attr_text = null;
+    
+    /**
+     * "textarea"属性入力値配列
+     * @var array
+     */
+    public $item_attr_textarea = null;
+    
+    /**
+     * "checkbox"属性入力値配列
+     * @var array
+     */
+    public $item_attr_checkbox = null;
+    
+    /**
+     * "name"属性：姓 入力値配列
+     * @var array
+     */
+    public $item_attr_name_family = null;
+    
+    /**
+     * "name"属性：名 入力値配列
+     * @var array
+     */
+    public $item_attr_name_given = null;
+    
+    /**
+     * "name"属性：姓(英語) 入力値配列
+     * @var array
+     */
+    public $item_attr_name_family_ruby = null;
+    
+    /**
+     * "name"属性：名(英語) 入力値配列
+     * @var array
+     */
+    public $item_attr_name_given_ruby = null;
+    
+    /**
+     * "name"属性：E-mail 入力値配列
+     * @var array
+     */
+    public $item_attr_name_email = null;
+    
+    /**
+     * "name"属性：著者ID prefix 入力値配列
+     * @var array
+     */
+    public $item_attr_name_author_id_prefix = null;
+    
+    /**
+     * "name"属性：著者ID suffix 入力値配列
+     * @var array
+     */
+    public $item_attr_name_author_id_suffix = null;
+    
+    /**
+     * "select"属性入力値配列
+     * @var array
+     */
+    public $item_attr_select = null;
+    
+    /**
+     * "link"属性：URL 入力値配列
+     * @var array
+     */
+    public $item_attr_link = null;
+    
+    /**
+     * "link"属性：表示名 入力値配列
+     * @var array
+     */
+    public $item_attr_link_name = null;
+    
+    /**
+     * "radio"属性入力値配列
+     * @var array
+     */
+    public $item_attr_radio = null;
+    
+    /**
+     * 書誌情報：雑誌名 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_name = null;
+    
+    /**
+     * 書誌情報：雑誌名(英) 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_name_english = null;
+    
+    /**
+     * 書誌情報：巻 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_volume = null;
+    
+    /**
+     * 書誌情報：号 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_issue = null;
+    
+    /**
+     * 書誌情報：開始ページ 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_spage = null;
+    
+    /**
+     * 書誌情報：終了ページ 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_epage = null;
+    
+    /**
+     * 書誌情報：発行年月日 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_dateofissued = null;
+    
+    /**
+     * 書誌情報：発行年 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_dateofissued_year = null;
+    
+    /**
+     * 書誌情報：発行月 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_dateofissued_month = null;
+    
+    /**
+     * 書誌情報：発行日 入力値配列
+     * @var array
+     */
+    public $item_attr_biblio_dateofissued_day = null;
+    
+    /**
+     * 日付 入力値配列
+     * @var array
+     */
+    public $item_attr_date = null;
+    
+    /**
+     * 日付：年 入力値配列
+     * @var array
+     */
+    public $item_attr_date_year = null;
+    
+    /**
+     * 日付：月 入力値配列
+     * @var array
+     */
+    public $item_attr_date_month = null;
+    
+    /**
+     * 日付：日 入力値配列
+     * @var array
+     */
+    public $item_attr_date_day = null;
+    
+    /**
+     * 見出し：大見出し 入力値配列
+     * @var array
+     */
+    public $item_attr_heading = null;
+    
+    /**
+     * 見出し：大見出し(英) 入力値配列
+     * @var array
+     */
+    public $item_attr_heading_en = null;
+    
+    /**
+     * 見出し：小見出し 入力値配列
+     * @var array
+     */
+    public $item_attr_heading_sub = null;
+    
+    /**
+     * 見出し：小見出し(英) 入力値配列
+     * @var array
+     */
+    public $item_attr_heading_sub_en = null;
+    
+    /**
+     * Contributor：フラグ
+     * @var string
+     */
+    public $item_contributor = null;
+    
+    /**
+     * Contributor：ハンドル名
+     * @var string
+     */
+    public $item_contributor_handle = null;
+    
+    /**
+     * Contributor：会員氏名
+     * @var string
+     */
+    public $item_contributor_name= null;
+    
+    /**
+     * Contributor：e-mailアドレス
+     * @var string
+     */
+    public $item_contributor_email = null;
+    
+    /**
+     * フィードバックメール送信先メールアドレス
+     * @var string
+     */
+    public $send_feedback_mail_address_mailaddresses = null;
+    
+    /**
+     * フィードバックメール送信先ユーザー名
+     * @var string
+     */
+    public $send_feedback_mail_address_authors = null;
+    
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     *   'add_row'      : 属性の数を増やす
+     *   'up_row'       : 属性を入れ替える (attridx-th属性が上に)
+     *   'down_row'     : 属性を入れ替える (attridx-th属性が下に)
+     *   'add_author_id': 氏名属性の外部著者IDの入力欄を増やす
+     *   'clear_author' : 氏名属性情報を削除する
+     * @var string
+     */
+    public $save_mode = null;
+    
+    /**
+     * 処理対象のメタデータ番号
+     * @var string
+     */
+    public $target = null;
+    
+    /**
+     * 処理対象の属性番号
+     * @var string
+     */
+    public $attridx = null;
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
+    
+    /**
+     * 実行処理
+     * @see RepositoryAction::executeApp()
+     */
+    protected function executeApp()
+    {
+        $saveFlag = false;
+        if( $this->save_mode=="selecttype" || $this->save_mode=="files" || $this->save_mode=="texts" || $this->save_mode=="links" ||
+            $this->save_mode=="doi" || $this->save_mode=="confirm" || $this->save_mode=="stay" || $this->save_mode=="next")
+        {
+            $saveFlag = true;
+        }
+        $errorMsgList = array();
+        
+        // インスタンス作成
         $ItemRegister = new ItemRegister($this->Session, $this->Db);
-        $license_master = $this->Session->getParameter("license_master");
-        // Add registered info save action 2009/02/03 Y.Nakao --end--
-        // Add PDF flash 2010/02/04 A.Suzuki --start--
-        $IDServer = new IDServer($this->Session, $this->Db);
-        // Add PDF flash 2010/02/04 A.Suzuki --end--
+        $NameAuthority = new NameAuthority($this->Session, $this->Db);
         
-        try {           
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
+        // セッション情報取得
+        $item_type_all = $this->Session->getParameter("item_type_all");         // 1.アイテムタイプ,  アイテムタイプのレコードをそのまま保存したものである。
+        $item_attr_type = $this->Session->getParameter("item_attr_type");       // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
+        $item_num_cand = $this->Session->getParameter("item_num_cand");         // 3.アイテム属性選択肢数 (N) : "item_num_cand"[N], 選択肢のない属性タイプは0を設定
+        $option_data = $this->Session->getParameter("option_data");             // 4.アイテム属性選択肢 (N): "option_data"[N][M], N属性タイプごとの選択肢。Mはアイテム属性選択肢数に対応。0～
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        $item_num_attr = $this->Session->getParameter("item_num_attr");         // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
+        $item_attr_old = $this->Session->getParameter("item_attr");             // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
+        $item_attr = array();       // 6.アイテム属性 。これはリクエストから全部作り直す
+        $edit_flag = $this->Session->getParameter("edit_flag");                 // X.処理モード : edit_flag (0:新規作成, 1:既存編集)
+        $sfmam = $this->Session->getParameter("feedback_mailaddress_str");
+        $sfmaa = $this->Session->getParameter("feedback_mailaddress_author_str");
+        $fma = $this->Session->getParameter("feedback_mailaddress_array");
+        $fmaa = $this->Session->getParameter("feedback_mailaddress_author_array");
+        
+        // カウンタ
+        $cnt_text = 0;      // "text"属性カウンタ
+        $cnt_textarea = 0;  // "textarea"属性カウンタ
+        $cnt_name = 0;      // "name"属性カウンタ
+        $cnt_link = 0;      // "link"属性カウンタ
+        $cnt_select = 0;    // "select"属性カウンタ
+        $cnt_checkbox = 0;  // "checkbox"属性カウンタ
+        $cnt_radio = 0;     // "radio"属性カウンタ
+        $cnt_biblio = 0;    // "biblio_info"属性カウンタ
+        $cnt_date = 0;      // "date"属性カウンタ
+        $cnt_author_id = 0; // "name"属性外部著者IDカウンタ
+        
+        // ------------------------------------------------------------
+        // セッション情報保存 (全オプション共通)
+        // ------------------------------------------------------------     
+        // タイトルに空白文字列が入力されたら空文字に変換
+        if ($this->base_attr[0]===RepositoryConst::BLANK_WORD) {
+            arra_push($this->warningMsg, $smartyAssign->getLang("repository_item_error_empty_title"));
+            $this->base_attr[0] = '';
+        }
+        if ($this->base_attr[1]===RepositoryConst::BLANK_WORD) {
+            arra_push($this->warningMsg, $smartyAssign->getLang("repository_item_error_empty_title"));
+            $this->base_attr[1] = '';
+        }
+        
+        // アイテム基本属性をセッションに保存
+        $this->Session->setParameter("base_attr",  array( 
+                "title" => ($this->base_attr[0]==' ') ? '' : $this->base_attr[0],
+                "title_english" => ($this->base_attr[1]==' ') ? '' : $this->base_attr[1],
+                "language" => $this->base_attr[2]
+            )
+        );
+        
+        // アイテム公開日ををセッションに保存
+        $tmp_item_pub_date = $this->Session->getParameter("item_pub_date");
+        $this->Session->setParameter("item_pub_date", array(
+                "year" => ($this->item_pub_date_year == ' ') ? '' : $this->item_pub_date_year,
+                "month" => $this->item_pub_date_month,
+                "day" => $this->item_pub_date_day
+            )
+        );
+        
+        // アイテムキーワードをセッションに保存
+        // ------------------------------------------------------------------
+        // キーワード精査 (空白除去)
+        // ------------------------------------------------------------------
+        $keywords = split("[|]", $this->item_keyword);
+        $keywords_en = split("[|]", $this->item_keyword_english);
+        $item_keyword_new = '';
+        $item_keyword_en_new = '';
+        for($ii=0; $ii<count($keywords); $ii++) {
+            $keywords[$ii] = trim($keywords[$ii]);
+            $item_keyword_new = $item_keyword_new . $keywords[$ii];
+            if($ii != count($keywords)-1) {
+                $item_keyword_new = $item_keyword_new . '|';
+            }
+        }
+        for($ii=0; $ii<count($keywords_en); $ii++) {
+            $keywords_en[$ii] = trim($keywords_en[$ii]);
+            $item_keyword_en_new = $item_keyword_en_new . $keywords_en[$ii];
+            if($ii != count($keywords_en)-1) {
+                $item_keyword_en_new = $item_keyword_en_new . '|';
+            }               
+        }
+        $item_keyword = $item_keyword_new;
+        $item_keyword_english = $item_keyword_en_new;
+        $this->Session->setParameter("item_keyword", $item_keyword);
+        $this->Session->setParameter("item_keyword_english", $item_keyword_english);
+        
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+        // ------------------------------------------------------------------
+        // Contributor
+        // ------------------------------------------------------------------
+        $contributorUserId = "";
+        $contributorErrorMsg = "";
+        $item_contributor = null;
+        if($this->item_contributor_handle == " ")
+        {
+            $this->item_contributor_handle = "";
+        }
+        if($this->item_contributor_name == " ")
+        {
+            $this->item_contributor_name = "";
+        }
+        if($this->item_contributor_email == " ")
+        {
+            $this->item_contributor_email = "";
+        }
+        
+        if(strlen($this->item_contributor) > 0 && $this->item_contributor == "1")
+        {
+            // Get contributor's user_id
+            $contributorFlag = false;
+            $retStatus = $this->getUserIdForContributor(
+                                    $this->item_contributor_handle,
+                                    $this->item_contributor_name,
+                                    $this->item_contributor_email,
+                                    $contributorUserId);
+            if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_SUCCESS)
+            {
+                $contributorFlag = true;
+            }
+            else if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST)
+            {
+                if($saveFlag)
+                {
+                    $contributorErrorMsg = $smartyAssign->getLang("repository_item_contributor_error_not_exist");
+                }
+            }
+            else if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT)
+            {
+                if($saveFlag)
+                {
+                    $contributorErrorMsg = $smartyAssign->getLang("repository_item_contributor_error_conflict");
+                }
+            }
+            else if($retStatus == RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOAUTH)
+            {
+                if($saveFlag)
+                {
+                    $contributorErrorMsg = $smartyAssign->getLang("repository_item_contributor_error_no_authority");
+                }
+            }
+            $item_contributor = array(
+                    RepositoryConst::ITEM_CONTRIBUTOR_HANDLE => $this->item_contributor_handle,
+                    RepositoryConst::ITEM_CONTRIBUTOR_NAME => $this->item_contributor_name,
+                    RepositoryConst::ITEM_CONTRIBUTOR_EMAIL => $this->item_contributor_email
+            );
+            if(!$contributorFlag)
+            {
+                $contributorUserId = $this->Session->getParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID);
+            }
+        }
+        else
+        {
+            $contributorUserId = $this->Session->getParameter("_user_id");
+        }
+        
+        // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --start--
+        $indice = $this->Session->getParameter("indice");
+        $indice = $this->addPrivateTreeInPositionIndex($indice, $contributorUserId);
+        $this->Session->setParameter("indice", $indice);
+        // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --end--
+        
+        $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID, $contributorUserId);
+        $this->Session->setParameter(RepositoryConst::SESSION_PARAM_ITEM_CONTRIBUTOR, $item_contributor);
+        $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_ERROR_MSG, $contributorErrorMsg);
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+        
+        // Fix PHP Notice 2014/06/06 Y.Nakao --start--
+        $item = array("item_id"=>"", "item_no"=>"");
+        // Add registered info save action 2009/02/09 Y.Nakao --start--
+        if($saveFlag){
+            if($edit_flag == 0){
+                // 新規登録時
+                $item["item_id"] = intval($this->Db->nextSeq("repository_item"));
+                $item["item_no"] = 1;
+            } else if($edit_flag == 1){
+                //既存編集時
+                // 編集中のアイテムIDをセッションから取得
+                $item["item_id"] = intval($this->Session->getParameter("edit_item_id"));
+                $item["item_no"] = intval($this->Session->getParameter("edit_item_no"));
+            }
+            if(trim($this->base_attr[0]) == "" && trim($this->base_attr[1]) == ""){
+                if($this->base_attr[2] == "ja"){
+                    //WEKOの設定言語に依存せず、論文の言語で決めるので仮タイトル文字列はベタ書きです
+                    $item["title"] = "タイトル無し";
+                    $item["title_english"] = "";
+                }else{
+                    $item["title"] = "";
+                    $item["title_english"] = "no title";
+                }
+            }else{
+                $item["title"] = (trim($this->base_attr[0]));
+                $item["title_english"] = (trim($this->base_attr[1]));
+            }
+            $item["language"] = $this->base_attr[2];
+            $item["serch_key"] = $this->item_keyword;
+            $item["serch_key_english"] = $this->item_keyword_english;
+            if($edit_flag == 0){
+                // new item
+                $item["revision_no"] = 1;
+                $item["prev_revision_no"] = 0;
+            } else if($edit_flag == 1){
+                // edit item
+                $result = $this->getItemTableData($item["item_id"], $item["item_no"], $Result_List, $error);
+                if($result === false){
+                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($error);
+                    $exception->addError($error);
+                    throw $exception;
+                }
+                $item["revision_no"] = $Result_List["item"][0]["revision_no"];
+                $item["prev_revision_no"] = $Result_List["item"][0]["revision_no"];
             }
-            // セッション情報取得
-            $item_attr_type = $this->Session->getParameter("item_attr_type");       // 2.アイテム属性タイプ (Nレコード, Order順) : ""[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
-            // ユーザ入力値＆変数
-            $item_num_attr = $this->Session->getParameter("item_num_attr");         // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
-            $item_attr = $this->Session->getParameter("item_attr");                 // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
-            $license_master = $this->Session->getParameter("license_master");       // ライセンスマスタ
-            $item_pub_date = $this->Session->getParameter("item_pub_date");
-            $smartyAssign = $this->Session->getParameter("smartyAssign");
             
-            // アップロード済みファイルのライセンスを取得
-            $cntUpd = 0;            // アップロード済みアイテムカウンタ
-            // 価格用リクエストパラメタのカウンタ
-            $price_Cnt = 0;     // Add file price Y.Nakao 2008/08/29
-            // ii-thメタデータのリクエストを保存
-            for($ii=0; $ii<count($item_attr_type); $ii++) {
-                // 1ファイルに付くルームIDごとの価格
-                $price = array();   // Add file price Y.Nakao 2008/08/29
-                // ii-thメタデータのjj-th属性値のリクエストを保存
-                for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
-                    // アップロード済みファイルのライセンス設定
-                    if( ($item_attr_type[$ii]['input_type']=='file' || 
-                        $item_attr_type[$ii]['input_type']=='file_price') // Add file price Y.Nakao 2008/08/28
-                         && array_key_exists("upload", $item_attr[$ii][$jj]) == true
-                         && $item_attr[$ii][$jj]["upload"] != null){
-                         $item_attr[$ii][$jj]["item_id"] = $this->Session->getParameter("edit_item_id");
-                         $item_attr[$ii][$jj]["item_no"] = $this->Session->getParameter("edit_item_no");
-                         $item_attr[$ii][$jj]["attribute_id"] = $item_attr_type[$ii]['attribute_id']; 
-                        // ライセンス保存 : CreativeCommonsの場合はライセンスマスタ配列のインデックス
-                        // 自由記述は"licence_free"
-                        $item_attr[$ii][$jj]['embargo_flag'] = $this->embargo_flag[$cntUpd];
-                        
-                        // Fix check invalid date 2011/06/17 A.Suzuki --start--
-                        $this->embargo_year[$cntUpd] = trim($this->embargo_year[$cntUpd]);
-                        if($this->checkDate($this->embargo_year[$cntUpd], $this->embargo_month[$cntUpd], $this->embargo_day[$cntUpd])){
-                            $item_attr[$ii][$jj]['embargo_year'] = $this->embargo_year[$cntUpd];
-                            $item_attr[$ii][$jj]['embargo_month'] = $this->embargo_month[$cntUpd];
-                            $item_attr[$ii][$jj]['embargo_day'] = $this->embargo_day[$cntUpd];
+            // Fix check invalid date 2011/06/17 A.Suzuki --start--
+            $this->item_pub_date_year = trim($this->item_pub_date_year);
+            if($this->checkDate($this->item_pub_date_year, $this->item_pub_date_month, $this->item_pub_date_day)){
+                $item["pub_year"] = $this->item_pub_date_year;
+                $item["pub_month"] = $this->item_pub_date_month;
+                $item["pub_day"] = $this->item_pub_date_day;
+            } else {
+                // invalid date
+                // Set item_pub_date
+                $item["pub_year"] = $tmp_item_pub_date["year"];
+                $item["pub_month"] = $tmp_item_pub_date["month"];
+                $item["pub_day"] = $tmp_item_pub_date["day"];
+                if($saveFlag){
+                    $this->Session->setParameter("item_pub_date", array(
+                            "year" => $tmp_item_pub_date["year"],
+                            "month" => $tmp_item_pub_date["month"],
+                            "day" => $tmp_item_pub_date["day"]
+                        )
+                    );
+                }
+            }
+            // Fix check invalid date 2011/06/17 A.Suzuki --end--
+            
+            $item["item_type_id"] = $item_type_all["item_type_id"];
+            $item["serch_key"] = $item_keyword;
+            $item["serch_key_english"] = $item_keyword_english;
+            if($edit_flag == 0){
+                $result = $ItemRegister->entryItem($item, $error);
+                if($result === false){
+                    // update faild
+                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($error);
+                    $exception->addError($error);
+                    throw $exception;
+                }
+                $this->Session->setParameter("edit_item_id", $item["item_id"]);
+                $this->Session->setParameter("edit_item_no", $item["item_no"]);
+                $this->Session->setParameter("edit_flag", 1);
+                $edit_flag = 1;
+            } else if($edit_flag == 1){
+                $result = $ItemRegister->editItem($item["item_id"], $item["item_no"], $error);
+                if($result === false){
+                    // update faild
+                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($error);
+                    $exception->addError($error);
+                    throw $exception;
+                }
+                $result = $ItemRegister->updateItem($item, $error);
+                if($result === false){
+                    // update faild
+                    $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($error);
+                    $exception->addError($error);
+                    throw $exception;
+                }
+            }
+            // ------------------------------------------------------------------
+            // ファイル(サムネイル)以外の属性を全て論理削除
+            // ------------------------------------------------------------------
+            $result = $this->deleteItemAttrData($item["item_id"], $item["item_no"], $this->Session->getParameter("_user_id"), $error);
+            if($result === false){
+                // update faild
+                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($error);
+                $exception->addError($error);
+                throw $exception;
+            }
+        }
+        
+        // アイテム追加属性(メタデータ)をセッションに保存
+        // ii-thメタデータのリクエストを保存
+        for($ii=0; $ii<count($item_attr_type); $ii++) {
+            $attr_elm = array();        // 1メタデータの値列
+            $nCnt_attr = 0;             // 空白以外の属性個数
+            $nCnt_attr_flg = 0;         // 空白精査用
+            // ii-thメタデータのjj-th属性値のリクエストを保存
+            for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                $metadata = array();
+                $metadata["item_id"] = "";
+                if(isset($item["item_id"]))
+                {
+                    $metadata["item_id"] = $item["item_id"];
+                }
+                $metadata["item_no"] = "";
+                if(isset($item["item_no"]))
+                {
+                    $metadata["item_no"] = $item["item_no"];
+                }
+                $metadata["attribute_id"] = $item_attr_type[$ii]["attribute_id"];
+                $metadata["item_type_id"] = $item_type_all["item_type_id"];
+                $metadata["input_type"] = $item_attr_type[$ii]['input_type'];
+                // ii-thメタデータの入力形式ごとのリクエストを保存
+                switch($item_attr_type[$ii]['input_type']) {
+                    case 'text':
+                        $metadata["attribute_no"] = $jj+1;
+                        // 空白チェック
+                        if($this->item_attr_text[$cnt_text]==' ') {
+                            array_push($attr_elm, '');
+                            $metadata["attribute_value"] = '';
                         } else {
-                            // invalid date
-                            // Set item_pub_date
-                            $item_attr[$ii][$jj]['embargo_year'] = $item_pub_date["year"];
-                            $item_attr[$ii][$jj]['embargo_month'] = $item_pub_date["month"];
-                            $item_attr[$ii][$jj]['embargo_day'] = $item_pub_date["day"];
-                            if($this->embargo_flag[$cntUpd] == "2"){
-                                array_push($err_msg, $smartyAssign->getLang("repository_item_file_pub_date_illegal"));
+                            if($saveFlag){
+                                $nCnt_attr++;
+                                $metadata["attribute_no"] = $nCnt_attr;
                             }
+                            array_push($attr_elm, $this->item_attr_text[$cnt_text]);
+                            $metadata["attribute_value"] = $this->item_attr_text[$cnt_text];
+                        }
+                        $cnt_text++;
+                        break;
+                    case 'link':
+                        $metadata["attribute_no"] = $jj+1;
+                        // 空白チェック
+                        // URL
+                        if($this->item_attr_link[$cnt_link]==' ') {
+                            $link_url = "";
+                        } else {
+                            $link_url = $this->item_attr_link[$cnt_link];
+                            $link_url = str_replace("|", "", $link_url);
+                        }
+                        // 表示名
+                        if($this->item_attr_link_name[$cnt_link]==' ') {
+                            $link_name = "";
+                        } else {
+                            $link_name = $this->item_attr_link_name[$cnt_link];
+                            $link_name = str_replace("|", "", $link_name);
                         }
-                        // Fix check invalid date 2011/06/17 A.Suzuki --end--
                         
-//                      echo 'embargo : ' .$item_attr[$ii][$jj]['embargo_flag'].'<br>';
-                        // 月が未定義の場合、日も未定義にする ('00' = 未定義)
-                        if($item_attr[$ii][$jj]['embargo_month'] == '00') {     
-                            $item_attr[$ii][$jj]['embargo_day'] == '00';        
+                        if($link_url != ""){
+                            if($saveFlag){
+                                $nCnt_attr++;
+                                $metadata["attribute_no"] = $nCnt_attr;
+                            }
                         }
-                        // Add flash file embargo 2010/02/08 A.Suzuki --start--
-                        $item_attr[$ii][$jj]['flash_embargo_flag'] = $this->flash_embargo_flag[$cntUpd];
                         
-                        // Fix check invalid date 2011/06/17 A.Suzuki --start--
-                        $this->flash_embargo_year[$cntUpd] = trim($this->flash_embargo_year[$cntUpd]);
-                        if($this->checkDate($this->flash_embargo_year[$cntUpd], $this->flash_embargo_month[$cntUpd], $this->flash_embargo_day[$cntUpd])){
-                            $item_attr[$ii][$jj]['flash_embargo_year'] = $this->flash_embargo_year[$cntUpd];
-                            $item_attr[$ii][$jj]['flash_embargo_month'] = $this->flash_embargo_month[$cntUpd];
-                            $item_attr[$ii][$jj]['flash_embargo_day'] = $this->flash_embargo_day[$cntUpd];
+                        if($link_name != ""){
+                            array_push($attr_elm, $link_url."|".$link_name);
+                            $metadata["attribute_value"] = $link_url."|".$link_name;
                         } else {
-                            // invalid date
-                            // Set item_pub_date
-                            $item_attr[$ii][$jj]['flash_embargo_year'] = $item_pub_date["year"];
-                            $item_attr[$ii][$jj]['flash_embargo_month'] = $item_pub_date["month"];
-                            $item_attr[$ii][$jj]['flash_embargo_day'] = $item_pub_date["day"];
-                            if($this->flash_embargo_flag[$cntUpd] == "2"){
-                                array_push($err_msg, $smartyAssign->getLang("repository_item_flash_pub_date_illegal"));
+                            array_push($attr_elm, $link_url);
+                            $metadata["attribute_value"] = $link_url;
+                        }
+
+                        $cnt_link++;
+                        break;
+                    case 'name':
+                        $metadata["personal_name_no"] = $jj+1;
+                        $family = '';
+                        $given = '';
+                        $family_ruby = '';
+                        $given_ruby = '';
+                        $email = '';
+                        $author_id = 0;
+                        $language = $item_attr_type[$ii]['display_lang_type'];
+                        $external_author_id = array();
+                        
+                        // 空白チェック
+                        if($this->item_attr_name_family[$cnt_name]!=' ') {
+                            $family = $this->item_attr_name_family[$cnt_name];
+                        }
+                        if($this->item_attr_name_given[$cnt_name]!=' ') {
+                            $given = $this->item_attr_name_given[$cnt_name];
+                        }
+                        if($language == "japanese"){
+                            if($this->item_attr_name_family_ruby[$cnt_name]!=' ') {
+                                $family_ruby = $this->item_attr_name_family_ruby[$cnt_name];
+                            }
+                            if($this->item_attr_name_given_ruby[$cnt_name]!=' ') {
+                                $given_ruby = $this->item_attr_name_given_ruby[$cnt_name];
+                            }
+                        }
+                        
+                        if($this->item_attr_name_email[$cnt_name]!=' ') {
+                            $email = $this->item_attr_name_email[$cnt_name];
+                        }
+                        
+                        // Bug Fix WEKO-2015-001 2015/06/15 K.Sugimoto --start--
+                        array_push($merge_external_author_id, array('prefix_id'=>0, 
+                                                                    'suffix'=>$this->item_attr_name_email[$cnt_name], 
+                                                                    'old_prefix_id'=>0, 
+                                                                    'old_suffix'=>$item_attr_old[$ii][$jj]["email"], 
+                                                                    'prefix_name'=>$NameAuthority->getExternalAuthorIdPrefixName(0)));
+                        // Bug Fix WEKO-2015-001 2015/06/15 K.Sugimoto --end--
+                        
+                        for($kk=0; $kk<count($item_attr_old[$ii][$jj]["external_author_id"]); $kk++){
+                            $external_author_id_prefix = '';
+                            $external_author_id_suffix = '';
+                            $external_author_id_prefix_name = '';
+                            if($this->item_attr_name_author_id_prefix[$kk+$cnt_author_id]!=0) {
+                                $external_author_id_prefix = $this->item_attr_name_author_id_prefix[$kk+$cnt_author_id];
+                                $external_author_id_prefix_name = $NameAuthority->getExternalAuthorIdPrefixName($external_author_id_prefix);
+                                if($this->item_attr_name_author_id_suffix[$kk+$cnt_author_id]!=' ') {
+                                    $external_author_id_suffix = $this->item_attr_name_author_id_suffix[$kk+$cnt_author_id];
+                                }
+                            }
+                            
+                            if(strlen($external_author_id_prefix) > 0 && strlen($external_author_id_suffix) > 0)
+                            {
+                                array_push($external_author_id, array('prefix_id'=>$external_author_id_prefix, 'suffix'=>$external_author_id_suffix, 'old_prefix_id'=>$item_attr_old[$ii][$jj]["external_author_id"][$kk]["prefix_id"], 'old_suffix'=>$item_attr_old[$ii][$jj]["external_author_id"][$kk]["suffix"], 'prefix_name'=>$external_author_id_prefix_name));
                             }
                         }
-                        // Fix check invalid date 2011/06/17 A.Suzuki --end--
                         
-                        // 月が未定義の場合、日も未定義にする ('00' = 未定義)
-                        if($item_attr[$ii][$jj]['flash_embargo_month'] == '00') {       
-                            $item_attr[$ii][$jj]['flash_embargo_day'] == '00';      
-                        }
-                        // Add flash file embargo 2010/02/08 A.Suzuki --start--
-                        if($this->licence[$cntUpd] == 'licence_free') {
-                            $item_attr[$ii][$jj]['licence'] = 'licence_free';
-                            $item_attr[$ii][$jj]['freeword'] = ($this->freeword[$cntUpd]==' ')?'':$this->freeword[$cntUpd];
-                            $item_attr[$ii][$jj]['license_id'] = '0';
-                            $item_attr[$ii][$jj]['license_notation'] = $item_attr[$ii][$jj]['freeword'];
+                        // Add external_author_id merge 2011/02/24 A.Suzuki --start--
+                        if(count($external_author_id)!=0 && $saveFlag && (strlen($family)!=0 || strlen($given)!=0 || strlen($email)!=0) )
+                        {
+                            // Bug Fix WEKO-2015-001 2015/06/15 K.Sugimoto --start--
+                            array_push($merge_external_author_id, $external_author_id);
+                            $result = $NameAuthority->mergeExtAuthorId($merge_external_author_id, $item_attr_old[$ii][$jj]["author_id"], true);
+                            // Bug Fix WEKO-2015-001 2015/06/15 K.Sugimoto --end--
+                        }
+                        // Add external_author_id merge 2011/02/24 A.Suzuki --end--
+                        
+                        $cnt_author_id = $cnt_author_id + $kk;
+                        
+                        // Check old author_id 2010/11/02 A.Suzuki --start--
+                        // author_id をチェック(author_id == 0 : 新規, author_id > 0: 既存)
+                        if(intval($item_attr_old[$ii][$jj]["author_id"])==0 && $saveFlag && (strlen($family)!=0 || strlen($given)!=0 || strlen($email)!=0) )
+                        {
+                            // author_id 発番
+                            $author_id = $NameAuthority->getNewAuthorId();
                         } else {
-                            $item_attr[$ii][$jj]['licence'] = $this->licence[$cntUpd];
-                            $item_attr[$ii][$jj]['license_id'] = $license_master[$this->licence[$cntUpd]]['license_id'];
-                            $item_attr[$ii][$jj]['license_notation'] = $license_master[$this->licence[$cntUpd]]['license_notation'];
-                        }
-                        // Extend file type A.Suzuki 2009/12/15 --start--
-                        $item_attr[$ii][$jj]['display_name'] = ($this->display_name[$cntUpd]==' ')?'':$this->display_name[$cntUpd];
-                        if($item_attr[$ii][$jj]['display_name'] == ""){
-                            // if display_name is null, put in filename without extension
-                            $item_attr[$ii][$jj]['display_name'] = str_ireplace(".".$item_attr[$ii][$jj]['upload']['extension'], "", $item_attr[$ii][$jj]['upload']['file_name']);
-                        }
-                        if($this->display_type[$cntUpd] == 'simple'){
-                            $item_attr[$ii][$jj]['display_type'] = 1;
-                        } else if($this->display_type[$cntUpd] == 'flash'){
-                            // Add PDF flash 2010/02/04 A.Suzuki --start--
-                            $item_attr[$ii][$jj]['display_type'] = 2;
+                            // 既存のauthor_id
+                            $author_id = intval($item_attr_old[$ii][$jj]["author_id"]);
+                        }
+                        // Check old author_id 2010/11/02 A.Suzuki --end--
+                        // 氏名属性は1属性につき姓、名、E-mailを保存
+                        array_push($attr_elm, array(
+                                'family' => $family,
+                                'given' => $given,
+                                'family_ruby' => $family_ruby,
+                                'given_ruby' => $given_ruby,
+                                'email' => $email,
+                                'author_id' => $author_id,
+                                'language' => $language,
+                                'external_author_id' => $external_author_id
+                            )
+                        );
+                        
+                        // Add e-person 2013/11/07 R.Matsuura --start--
+                        if(strlen($email)>0)
+                        {
+                            array_push($external_author_id, array('prefix_id'=>'0', 'suffix'=>$this->item_attr_name_email[$cnt_name], 'old_prefix_id'=>'0', 'old_suffix'=>$item_attr_old[$ii][$jj]["email"], 'prefix_name'=>'e_mail_address'));
+                        }
+                        // Add e-person 2013/11/07 R.Matsuura --end--
+                        
+                        $metadata["family"] = $family;
+                        $metadata["name"] = $given;
+                        $metadata["family_ruby"] = $family_ruby;
+                        $metadata["name_ruby"] = $given_ruby;
+                        $metadata["e_mail_address"] = $email;
+                        $metadata["author_id"] = $author_id;
+                        $metadata["language"] = $language;
+                        if($saveFlag){
+                            if($family != "" || $given != "" || $email != ""){
+                                $nCnt_attr++;
+                                $metadata["personal_name_no"] = $nCnt_attr;
+                            }
+                        }
+                        $metadata["external_author_id"] = $external_author_id;
+                        $cnt_name++;
+                        break;
+                    case 'textarea':
+                        $metadata["attribute_no"] = $jj+1;
+                        // 空白チェック
+                        if($this->item_attr_textarea[$cnt_textarea]==' ') {
+                            array_push($attr_elm, '');
+                            $metadata["attribute_value"] = '';
+                        } else {
+                            if($saveFlag){
+                                $nCnt_attr++;
+                                $metadata["attribute_no"] = $nCnt_attr;
+                            }
+                            array_push($attr_elm, $this->item_attr_textarea[$cnt_textarea]);
+                            $metadata["attribute_value"] = $this->item_attr_textarea[$cnt_textarea];
+                        }
+                        $cnt_textarea++;
+                        break;
+                    case 'select':
+                        $metadata["attribute_no"] = $jj+1;
+                        // S.Nonomura 2010/04/01 --start--
+                        // Blank Check
+                        if($this->item_attr_select[$cnt_select]==' ') {
+                            array_push($attr_elm, '');
+                            $metadata["attribute_value"] = '';
+                        // S.Nonomura 2010/04/01 --end--
                         } else {
-                            $item_attr[$ii][$jj]['display_type'] = 0;
-                        }
-                        // Extend file type A.Suzuki 2009/12/15 --end--
-                        // Add registered info save action 2009/02/03 Y.Nakao --start--
-                        $result = $ItemRegister->updateFileLicense($item_attr[$ii][$jj], $error);
-                        if($result === false){
-                            array_push($err_msg, $error);
-                            $this->Session->setParameter("error_msg", $err_msg);
-                            return 'error';
-                        }
-                        // Add registered info save action 2009/02/03 Y.Nakao --end--
-                        // Add file price Y.Nakao 2008/08/29 --start--
-                        if($item_attr_type[$ii]['input_type']=='file_price'){
-                            // 初期化
-                            $price_array = array();
-                            $room_id_array = array();
-                            // 個数保持
-                            $loop_num = $item_attr[$ii][$jj]['price_num'];
-                            // 設定されている価格情報を格納する
-                            for($price_num=0;$price_num<$loop_num;$price_num++){
-                                // ルームIDと価格を保持する
-                                // Bugfix price input scrutiny 2011/06/27 Y.Nakao --start--
-                                if(!is_numeric($this->price_value[$price_Cnt])){
-                                    array_push($room_id_array, $this->room_ids[$price_Cnt]);
-                                    array_push($price_array, "0");
-                                    array_push($err_msg, $smarty_assign->getLang("repository_item_error_price"));
+                            array_push($attr_elm, $this->item_attr_select[$cnt_select]);
+                            $metadata["attribute_value"] = $this->item_attr_select[$cnt_select];
+                        }
+                        if($saveFlag){
+                            $nCnt_attr++;
+                            $metadata["attribute_no"] = $nCnt_attr;
+                        }
+                        $cnt_select++;
+                        break;
+                    case 'checkbox':
+                        $metadata["attribute_no"] = array();
+                        // 0 or 1で還ってくる(チェックボックスの数だけ)
+                        $metadata["attribute_value"] = array();
+                        for($kk=0; $kk<count($option_data[$ii]); $kk++){
+                            array_push($attr_elm, $this->item_attr_checkbox[$cnt_checkbox]);    // チェックON
+                            if($this->item_attr_checkbox[$cnt_checkbox] == 1){
+                                $metadata["attribute_no"] = $jj + $kk + 1;
+                                $metadata["attribute_value"] = $option_data[$ii][$kk];
+                                if($saveFlag){
+                                    $result = $ItemRegister->entryMetadata($metadata, $error);
+                                    if($result === false){
+                                        $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                        $exception = new AppException($error);
+                                        $exception->addError($error);
+                                        throw $exception;
+                                    }
+                                }
+                            }
+                            $cnt_checkbox++;
+                        }
+                        break;
+                    case 'radio':
+                        $metadata["attribute_no"] = $jj+1;
+                        if($saveFlag){
+                            $nCnt_attr++;
+                            $metadata["attribute_no"] = $nCnt_attr;
+                        }
+                        // 選択番号が還ってくる。
+                        array_push($attr_elm, $this->item_attr_radio[$cnt_radio]);
+                        $metadata["attribute_value"] = $option_data[$ii][$this->item_attr_radio[$cnt_radio]];
+                        $cnt_radio++;
+                        break;
+                    case 'biblio_info':
+                        $biblio_name = '';
+                        $biblio_name_english = '';
+                        $volume = '';
+                        $issue = '';
+                        $spage = '';
+                        $epage = '';
+                        $year = '';
+                        $month = '';
+                        $day = '';
+                        $dateofissued = '';
+                        
+                        // 空白チェック
+                        if($this->item_attr_biblio_name[$cnt_biblio]!=' ') {
+                            $biblio_name = $this->item_attr_biblio_name[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_name_english[$cnt_biblio]!=' ') {
+                            $biblio_name_english = $this->item_attr_biblio_name_english[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_volume[$cnt_biblio]!=' ') {
+                            $volume = $this->item_attr_biblio_volume[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_issue[$cnt_biblio]!=' ') {
+                            $issue = $this->item_attr_biblio_issue[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_spage[$cnt_biblio]!=' ') {
+                            $spage = $this->item_attr_biblio_spage[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_epage[$cnt_biblio]!=' ') {
+                            $epage = $this->item_attr_biblio_epage[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_dateofissued_year[$cnt_biblio]!=' ') {
+                            $year = trim($this->item_attr_biblio_dateofissued_year[$cnt_biblio]);
+                        }
+                        if($this->item_attr_biblio_dateofissued_month[$cnt_biblio]!=' ') {
+                            $month = $this->item_attr_biblio_dateofissued_month[$cnt_biblio];
+                        }
+                        if($this->item_attr_biblio_dateofissued_day[$cnt_biblio]!=' ') {
+                            $day = $this->item_attr_biblio_dateofissued_day[$cnt_biblio];
+                        }
+                        
+                        // 発行年月日を連結する
+                        if($year != '') {
+                            $dateofissued = $year;
+                            if($month != '') {
+                                if (strlen($month) == 1) {
+                                    $dateofissued = $dateofissued.'-0'.$month;
                                 } else {
-                                    array_push($room_id_array, $this->room_ids[$price_Cnt]);
-                                    array_push($price_array, $this->price_value[$price_Cnt]);
+                                    $dateofissued = $dateofissued.'-'.$month;
+                                }
+                                if($day != '') {
+                                    if (strlen($day) == 1) {
+                                        $dateofissued = $dateofissued.'-0'.$day;
+                                    } else {
+                                        $dateofissued = $dateofissued.'-'.$day;
+                                    }
+                                }
+                            }
+                        }
+                        
+                        // 書誌情報属性は1属性につき雑誌名、巻、号、ページ、発行年を保存
+                        array_push($attr_elm, array(
+                                'biblio_name' => $biblio_name,
+                                'biblio_name_english' => $biblio_name_english,
+                                'volume' => $volume,
+                                'issue' => $issue,
+                                'spage' => $spage,
+                                'epage' => $epage,
+                                'date_of_issued' => $dateofissued,
+                                'year' => $year,
+                                'month' => $month,
+                                'day' => $day
+                            )
+                        );
+                        $metadata["biblio_no"] = $jj+1;
+                        $metadata["biblio_name"] = $biblio_name;
+                        $metadata["biblio_name_english"] = $biblio_name_english;
+                        $metadata["volume"] = $volume;
+                        $metadata["issue"] = $issue;
+                        $metadata["start_page"] = $spage;
+                        $metadata["end_page"] = $epage;
+                        $metadata["date_of_issued"] = $dateofissued;
+                        $cnt_biblio++;
+                        if($saveFlag){
+                            if($biblio_name!="" || $biblio_name_english!="" ||
+                                $volume!="" || $issue!="" || $spage!="" ||
+                                $epage!="" || $dateofissued!=""){
+                                $nCnt_attr++;
+                                $metadata["biblio_no"] = $nCnt_attr;
+                            }
+                        }
+                        break;
+                    case 'date':
+                        $date_year = '';
+                        $date_month = '';
+                        $date_day = '';
+                        $date = '';
+                        
+                        // 空白チェック
+                        if($this->item_attr_date_year[$cnt_date]!=' ') {
+                            $date_year = trim($this->item_attr_date_year[$cnt_date]);
+                        }
+                        if($this->item_attr_date_month[$cnt_date]!=' ') {
+                            $date_month = $this->item_attr_date_month[$cnt_date];
+                        }
+                        if($this->item_attr_date_day[$cnt_date]!=' ') {
+                            $date_day = $this->item_attr_date_day[$cnt_date];
+                        }
+
+                        // 年月日を連結する
+                        if($date_year != '') {
+                            $date = $date_year;
+                            if($date_month != '') {
+                                if (strlen($date_month) == 1) {
+                                    $date = $date.'-0'.$date_month;
+                                } else {
+                                    $date = $date.'-'.$date_month;
+                                }
+                                if($date_day != '') {
+                                    if (strlen($date_day) == 1) {
+                                        $date = $date.'-0'.$date_day;
+                                    } else {
+                                        $date = $date.'-'.$date_day;
+                                    }
                                 }
-                                // Bugfix price input scrutiny 2011/06/27 Y.Nakao --end--
-                                // カウンタを次へ
-                                $price_Cnt++;
                             }
-                            $item_attr[$ii][$jj]['price_value'] = $price_array;
-                            $item_attr[$ii][$jj]['room_id'] = $room_id_array;
-                            // Add registered info save action 2009/02/04 Y.Nakao --start--
-                            $result = $ItemRegister->updatePrice($item_attr[$ii][$jj], $error);
+                        }
+
+                        array_push($attr_elm, array(
+                                'date' => $date,
+                                'date_year' => $date_year,
+                                'date_month' => $date_month,
+                                'date_day' => $date_day
+                            )
+                        );
+                        $metadata["attribute_no"] = $jj+1;
+                        $metadata["attribute_value"] = $date;
+                        $cnt_date++;
+                        if($saveFlag){
+                            if($date!=""){
+                                $nCnt_attr++;
+                                $metadata["attribute_no"] = $nCnt_attr;
+                            }
+                        }
+                        break;
+                    case 'heading':
+                        $metadata["attribute_no"] = $jj+1;
+                        $heading = "";
+                        $heading_en = "";
+                        $heading_sub = "";
+                        $heading_sub_en = "";
+                        // check string empty
+                        $this->item_attr_heading = str_replace("|", "", $this->item_attr_heading);
+                        if($this->item_attr_heading!=' ') {
+                            $heading = $this->item_attr_heading; 
+                        }
+                        $this->item_attr_heading_en = str_replace("|", "", $this->item_attr_heading_en);
+                        if($this->item_attr_heading_en!=' ') {
+                            $heading_en = $this->item_attr_heading_en;
+                        }
+                        $this->item_attr_heading_sub = str_replace("|", "", $this->item_attr_heading_sub);
+                        if($this->item_attr_heading_sub!=' ') {
+                            $heading_sub = $this->item_attr_heading_sub;
+                        }
+                        $this->item_attr_heading_sub_en = str_replace("|", "", $this->item_attr_heading_sub_en);
+                        if($this->item_attr_heading_sub_en!=' ') {
+                            $heading_sub_en = $this->item_attr_heading_sub_en;
+                        }
+                        if($saveFlag){
+                            $nCnt_attr++;
+                            $metadata["attribute_no"] = $nCnt_attr;
+                        }
+                        $metadata["attribute_value"] = $heading."|".$heading_en."|".$heading_sub."|".$heading_sub_en; 
+                        array_push($attr_elm, $metadata["attribute_value"]);
+                        break;
+                    default :
+                        // ファイルとサムネイルはセッション情報をそのままコピー
+                        array_push($attr_elm, $item_attr_old[$ii][$jj]);
+                        break;
+                }
+                if($item_attr_type[$ii]['input_type'] != 'checkbox'){
+                    if($saveFlag){
+                        if($nCnt_attr > $nCnt_attr_flg){
+                            $result = $ItemRegister->entryMetadata($metadata, $error);
                             if($result === false){
-                                array_push($err_msg, $error);
-                                $this->Session->setParameter("error_msg", $err_msg);
-                                return 'error';
+                                $this->errorLog($error, __FILE__, __CLASS__, __LINE__);
+                                $exception = new AppException($error);
+                                $exception->addError($error);
+                                throw $exception;
                             }
-                            // Add registered info save action 2009/02/04 Y.Nakao --end--
+                            $nCnt_attr_flg = $nCnt_attr;
                         }
-                        // Add file price Y.Nakao 2008/08/29 --end--
-                        $cntUpd++;
                     }
                 }
             }
+            array_push($item_attr, $attr_elm);      // 1メタデータ分のユーザ入力値をセット
+        }
+        
+        if($saveFlag){
+            if(strlen($contributorErrorMsg)==0){
+                // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+                $result = $ItemRegister->updateInsertUserIdForContributor(
+                            intval($this->Session->getParameter("edit_item_id")),
+                            $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
+                if($result === false)
+                {
+                    $tmpErrorMsg = "Cannot update contributor.";
+                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($tmpErrorMsg);
+                    $exception->addError($tmpErrorMsg);
+                    throw $exception;
+                }
+                // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+            } else {
+                $this->save_mode = "stay";
+                $this->addErrMsg($contributorErrorMsg);
+            }
+        }
+        // Add registered info save action 2009/02/09 Y.Nakao --end--
+        
+        // Add e-person R.Matsuura 2013/11/18 --start--
+        // feedback mail送信先を設定
+        $feedback_mail_array = explode(",", $this->send_feedback_mail_address_mailaddresses);
+        $ret = $ItemRegister->deleteFeedbackMailAuthorId($item["item_id"], $item["item_no"]);
+        if($ret === false)
+        {
+            $tmpErrorMsg = "Cannot delete record from send_feedback_author_id table.";
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $authorIdNo = 1;
+        for ($cnt = 0; $cnt < count($feedback_mail_array); $cnt++){
+            // check mail address
+            if ( $feedback_mail_array[$cnt] == "") {
+                continue;
+            }
             
-            $ItemRegister->checkEntryInfo($item_attr_type, $item_num_attr, $item_attr, 'license', $err_msg, $warning);
+            // get author_id
+            $authorId = $ItemRegister->getAuthorIdByMailAddress($feedback_mail_array[$cnt]);
+            if($authorId === false){
+                continue;
+            }
             
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-            $ItemRegister->updateInsertUserIdForContributor(
-                    intval($this->Session->getParameter("edit_item_id")),
-                    $this->Session->getParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID));
-            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+            // insert send feedback mail author id
+            $ItemRegister->insertFeedbackMailAuthorId( $item["item_id"], $item["item_no"], $authorIdNo, $authorId);
+            if($result === false){
+                $tmpErrorMsg = "Cannot insert send feedback mail author id.";
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            }
             
-            // 次の画面へ
-            $this->Session->setParameter("item_attr", $item_attr);  // 属性を更新
+            // set author id no
+            $authorIdNo++;
+        }
+        $feedback_mail_authors_array = explode(",", $this->send_feedback_mail_address_authors);
+        $this->Session->setParameter("feedback_mailaddress_str", $this->send_feedback_mail_address_mailaddresses);
+        $this->Session->setParameter("feedback_mailaddress_author_str", $this->send_feedback_mail_address_authors);
+        $this->Session->setParameter("feedback_mailaddress_array", $feedback_mail_array);
+        $this->Session->setParameter("feedback_mailaddress_author_array", $feedback_mail_authors_array);
+        // Add e-person R.Matsuura 2013/11/18 --end--
+        
+        // ------------------------------------------------------------
+        // オプション個別処理
+        // ------------------------------------------------------------
+        $blankCheckFlag = true;
+        if ($this->save_mode != null) {
+            $idx = (int)($this->target);
+            switch($this->save_mode) {
+                case "stay":
+                    $blankCheckFlag = false;
+                    break;
+                case "add_row":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // target-thメタデータの属性数を増やす
+                    $item_num_attr[$idx] = $item_num_attr[$idx] + 1;
+                    $this->Session->setParameter("item_num_attr", $item_num_attr);
+                    // 入力形式ごとに分岐
+                    switch($item_attr_type[$idx]['input_type']) {
+                        case "text":
+                        case "textarea":
+                        case "link":
+                            array_push($item_attr[$idx], '');
+                            break;
+                        case "name":
+                            $new_name = array(
+                                'family' => '',
+                                'given' => '',
+                                'family_ruby' => '',
+                                'given_ruby' => '',
+                                'email' => '',
+                                'author_id' => '',
+                                'external_author_id' => array(array('prefix_id'=>'', 'suffix'=>''))
+                            );
+                            array_push($item_attr[$idx], $new_name);
+                            break;
+                        case "biblio_info":
+                            $new_biblio = array(
+                                'biblio_name' => '',
+                                'biblio_name_english' => '',
+                                'volume' => '',
+                                'issue' => '',
+                                'spage' => '',
+                                'epage' => '',
+                                'year' => '',
+                                'month' => '',
+                                'day' => '',
+                                'date_of_issued' => ''
+                            );
+                            array_push($item_attr[$idx], $new_biblio);
+                            break;
+                        case "date":
+                            $new_date = array(
+                                'date_year' => '',
+                                'date_month' => '',
+                                'date_day' => '',
+                                'date' => ''
+                            );
+                            array_push($item_attr[$idx], $new_date);
+                            break;
+                        default:
+                            break;
+                    }
+                    break;
+                case "up_row":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
+                    // ※target == 0(一番上)の場合は無効
+                    $attridx = (int)($this->attridx);
+                    if( $attridx == 0) {
+                        break;
+                    }
+                    // 配列の入替
+                    $bufarray = $item_attr[$idx][$attridx];
+                    $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx-1];
+                    $item_attr[$idx][$attridx-1] = $bufarray;
+                    break;
+                case "down_row":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // attridx-thメタデータとattridx-1-thメタデータの属性を入れ替える
+                    // ※target == $item_num_attr[$idx]-1(一番下)の場合は無効
+                    $attridx = (int)($this->attridx);
+                    if( $attridx >= $item_num_attr[$idx]-1) {
+                        break;
+                    }
+                    // 配列の入替
+                    $bufarray = $item_attr[$idx][$attridx];
+                    $item_attr[$idx][$attridx] = $item_attr[$idx][$attridx+1];
+                    $item_attr[$idx][$attridx+1] = $bufarray;
+                    break;
+                case "add_author_id":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // Add author_id input space
+                    $attridx = (int)($this->attridx);
+                    $new_author_id = array('prefix_id'=>'', 'suffix'=>'');
+                    array_push($item_attr[$idx][$attridx]["external_author_id"], $new_author_id);
+                    break;
+                case "clear_author":
+                    $blankCheckFlag = false;
+                    $this->save_mode = "stay";
+                    // Clear author data
+                    $attridx = (int)($this->attridx);
+                    $new_name = array(
+                                'family' => '',
+                                'given' => '',
+                                'family_ruby' => '',
+                                'given_ruby' => '',
+                                'email' => '',
+                                'author_id' => '',
+                                'external_author_id' => array(array('prefix_id'=>'', 'suffix'=>''))
+                            );
+                    $item_attr[$idx][$attridx] = $new_name;
+                    break;
+                default:
+                    break;
+            }
+        }
+        
+        if($blankCheckFlag){
+            // ------------------------------------------------------------
+            // 次の画面に進む前に、テキスト入力の空白入力を詰める
+            // ※複数可能、かつ空白入力1以上の場合
+            // ------------------------------------------------------------
+            for($ii=0; $ii<count($item_attr_type); $ii++) {
+                // 複数指定不可のメタデータはスルー
+                if( $item_attr_type[$ii]['plural_enable']!=1){
+                    continue;
+                }
+                // ファイル／サムネイルはスルー
+                // ラジオボックス, セレクトボックスは初期値が設定されているのでスルー
+                // チェックボックスはチェックしなくてもＯＫなのでスルー
+                if( $item_attr_type[$ii]['input_type']=='file' ||
+                    $item_attr_type[$ii]['input_type']=='thumbnail' ||
+                    $item_attr_type[$ii]['input_type']=='checkbox' ||
+                    $item_attr_type[$ii]['input_type']=='radio' ||
+                    $item_attr_type[$ii]['input_type']=='select'){ 
+                    continue;
+                }
+                // ii-thメタデータの空白でない入力数を計算
+                $cnt = 0;
+                for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                    if($item_attr_type[$ii]['input_type']=='name'){
+                        if( $item_attr[$ii][$jj]['family'] != '' ||
+                            $item_attr[$ii][$jj]['given'] != '') {
+                            $cnt++;
+                        }
+                    // Add biblio info 2008/08/11 --start--
+                    } else if($item_attr_type[$ii]['input_type']=='biblio_info'){
+                        // 書誌情報の有効条件は、一応何かしら値が入っていることとする
+                        if( $item_attr[$ii][$jj]['biblio_name'] != '' || 
+                            $item_attr[$ii][$jj]['biblio_name_english'] != '' || 
+                            $item_attr[$ii][$jj]['volume'] != '' ||
+                            $item_attr[$ii][$jj]['issue'] != '' || 
+                            ($item_attr[$ii][$jj]['spage'] != '' || 
+                            $item_attr[$ii][$jj]['epage'] != '') ||
+                            $item_attr[$ii][$jj]['date_of_issued'] != '' ) {
+                            $cnt++;
+                        }
+                    // Add biblio info 2008/08/11 --end--
+                    // Add link name 2009/03/19 --start--
+                    } else if($item_attr_type[$ii]['input_type']=='link'){
+                        // リンク有効条件は、URLに何かしら値が入っていることとする
+                        $link_data = explode("|", $item_attr[$ii][$jj]);
+                        if($link_data[0] != '') {
+                            $cnt++;
+                        }
+                    // Add link name 2009/03/19 --end--
+                    } else {
+                        if($item_attr[$ii][$jj] != '') {
+                            $cnt++; 
+                        }
+                    }
+                }
+                $array_effective = array();
+                // 有効入力無し=>0-th要素のみ残し、削除
+                if( $cnt == 0 ) {
+                    // Add php notice T.Koyasu 2014/09/16 --start--
+                    if(isset($item_attr[$ii]) && count($item_attr[$ii]) > 0){
+                        array_push($array_effective, $item_attr[$ii][0]);
+                    }
+                    // Add php notice T.Koyasu 2014/09/16 --end--
+                    $item_num_attr[$ii] = 1;
+                    $item_attr[$ii] = $array_effective;
+                // 有効入力あり=>無効な入力を削除 
+                } else {
+                    for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                        if($item_attr_type[$ii]['input_type']=='name'){
+                            if( $item_attr[$ii][$jj]['family'] != '' ||
+                                $item_attr[$ii][$jj]['given'] != '') {
+                                if(count($item_attr[$ii][$jj]['external_author_id'])>=2){
+                                    $external_author_id_array = array();
+                                    for($kk=0;$kk<count($item_attr[$ii][$jj]['external_author_id']);$kk++){
+                                        $author_id_add_flag = true;
+                                        if($kk!=0){
+                                            for($ll=0;$ll<count($external_author_id_array);$ll++){
+                                                if($item_attr[$ii][$jj]['external_author_id'][$kk]['prefix_id']==$external_author_id_array[$ll]['prefix_id']
+                                                    && $item_attr[$ii][$jj]['external_author_id'][$kk]['suffix']==$external_author_id_array[$ll]['suffix']){
+                                                    $author_id_add_flag = false;
+                                                    break;
+                                                }
+                                            }
+                                        }
+                                        if($author_id_add_flag){
+                                            array_push($external_author_id_array, $item_attr[$ii][$jj]['external_author_id'][$kk]);
+                                        }
+                                    }
+                                    $item_attr[$ii][$jj]['external_author_id'] = $external_author_id_array;
+                                }
+                                array_push($array_effective, $item_attr[$ii][$jj]);
+                            }
+                        } else if($item_attr_type[$ii]['input_type']=='biblio_info'){
+                            if( $item_attr[$ii][$jj]['biblio_name'] != '' || 
+                                $item_attr[$ii][$jj]['biblio_name_english'] != '' || 
+                                $item_attr[$ii][$jj]['volume'] != '' ||
+                                $item_attr[$ii][$jj]['issue'] != '' || 
+                                ($item_attr[$ii][$jj]['spage'] != '' || 
+                                $item_attr[$ii][$jj]['epage'] != '') ||
+                                $item_attr[$ii][$jj]['date_of_issued'] != '' ) {
+                                array_push($array_effective, $item_attr[$ii][$jj]);
+                            }
+                        } else if($item_attr_type[$ii]['input_type']=='link'){
+                            $link_data = explode("|", $item_attr[$ii][$jj]);
+                            if($link_data[0] != '') {
+                                array_push($array_effective, $item_attr[$ii][$jj]);
+                            }
+                        } else {
+                            if($item_attr[$ii][$jj] != '') {
+                                array_push($array_effective, $item_attr[$ii][$jj]);
+                            }
+                        }
+                    }
+                    $item_num_attr[$ii] = count($array_effective);
+                    $item_attr[$ii] = $array_effective;
+                }
+            }
             
-            $this->Session->removeParameter("error_msg");
-            $this->Session->setParameter("error_msg", $err_msg);
+        }
+        // 属性情報を更新
+        $this->Session->setParameter("item_attr", $item_attr);
+        $this->Session->setParameter("item_num_attr", $item_num_attr);
+        
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "texts",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+        );
+        $ret = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
+        }
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
+        
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
+        }
+        
+        return $ret;
+    }
+    
+    // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+    /**
+     * Get contributor's user_id by handle, name and email
+     *
+     * @param string $handle
+     * @param string $name
+     * @param string $email
+     * @param string &$outContributorUserId
+     * @return string "Success", "NotExist", "Conflict"
+     * @access private
+     */
+    private function getUserIdForContributor($handle, $name, $email, &$outContributorUserId)
+    {
+        $outContributorUserId = "";
+        
+        // Check handle
+        if(strlen($handle) > 0)
+        {
+            // Execute select
+            $query = "SELECT user_id ".
+                     "FROM ".DATABASE_PREFIX."users ".
+                     "WHERE handle = ? ;";
+            $params = array();
+            $params[] = $handle;
+            $result = $this->Db->execute($query, $params);
+            if($result == false || count($result) < 1 || !array_key_exists("user_id", $result[0]))
+            {
+                // Return "NotExist"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
+            }
+            else if(count($result) != 1)
+            {
+                // Return "Conflict"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
+            }
             
-            // アクション終了処理
-            $result = $this->exitAction();  // トランザクションが成功していればCOMMITされる
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
+            // Get user_id
+            $outContributorUserId = $result[0]["user_id"];
+        }
+        
+        // Check name
+        if(strlen($name) > 0)
+        {
+            // Execute select
+            $query = "SELECT user_id ".
+                     "FROM ".DATABASE_PREFIX."users_items_link ".
+                     "WHERE item_id = ? ".
+                     "AND content = ? ;";
+            $params = array();
+            $params[] = 4;
+            $params[] = $name;
+            $result = $this->Db->execute($query, $params);
+            if($result == false || count($result) < 1 || !array_key_exists("user_id", $result[0]))
+            {
+                // Return "NotExist"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
             }
-            // Add error input Screen changes  K.Matsuo 2013/5/30 --start--
-            if(count($err_msg)>0){
-                // 入力にエラーがあるときは画面遷移しない
-                $this->save_mode = "stay";
+            else if(count($result) != 1 && strlen($outContributorUserId) <= 0)
+            {
+                // Return "Conflict"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
             }
-            // Add error input Screen changes  K.Matsuo 2013/5/30 --end--
-            // Add registered info save action 2009/02/02 Y.Nakao --start--
-            if($this->save_mode == 'stay'){
-                return 'stay';
+            else if(count($result) != 1 && strlen($outContributorUserId) > 0)
+            {
+                $isMatch = false;
+                for($ii=0; $ii<count($result); $ii++)
+                {
+                    if($result[$ii]["user_id"] == $outContributorUserId)
+                    {
+                        $isMatch = true;
+                        break;
+                    }
+                }
+                
+                if(!$isMatch)
+                {
+                    // Return "Conflict"
+                    $outContributorUserId = "";
+                    return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
+                }
+            }
+            else if(count($result) == 1)
+            {
+                $tmpUserId = $result[0]["user_id"];
+                if($outContributorUserId > 0 && $outContributorUserId != $tmpUserId)
+                {
+                    // Return "Conflict"
+                    $outContributorUserId = "";
+                    return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
+                }
+                else
+                {
+                    // Get user_id
+                    $outContributorUserId = $tmpUserId;
+                }
+            }
+        }
+        
+        // Check email
+        if(strlen($email) > 0)
+        {
+        // Execute select
+            $query = "SELECT user_id ".
+                     "FROM ".DATABASE_PREFIX."users_items_link ".
+                     "WHERE item_id = ? ".
+                     "AND content = ? ;";
+            $params = array();
+            $params[] = 5;
+            $params[] = $email;
+            $result = $this->Db->execute($query, $params);
+            if($result == false || count($result) < 1 || !array_key_exists("user_id", $result[0]))
+            {
+                // Return "NotExist"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
+            }
+            else if(count($result) != 1 && strlen($outContributorUserId) <= 0)
+            {
+                // Return "Conflict"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
             }
-            // Add registered info save action 2009/02/02 Y.Nakao --end--
             
-            return 'success';
-        } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            $this->logFile(
-                "SampleAction",                 //クラス名
-                "execute",                      //メソッド名
-                $Exception->getCode(),          //ログID
-                $Exception->getMessage(),       //主メッセージ
-                $Exception->getDetailMsg() );   //詳細メッセージ           
-            //アクション終了処理
-            $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_error_msg);
-            return "error";
+            // Get user_id
+            $tmpUserId = $result[0]["user_id"];
+            if($outContributorUserId != $tmpUserId)
+            {
+                // Return "Conflict"
+                $outContributorUserId = "";
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_CONFLICT;
+            }
+        }
+        
+        if(strlen($outContributorUserId) > 0)
+        {
+            $authId = $this->getRoomAuthorityID($outContributorUserId);
+            if($authId >= REPOSITORY_ITEM_REGIST_AUTH)
+            {
+                // Return "Success"
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_SUCCESS;
+            }
+            else
+            {
+                // Return "NoAuth"
+                return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOAUTH;
+            }
+        }
+        else
+        {
+            // Return "NotExist"
+            return RepositoryConst::ITEM_CONTRIBUTOR_STATUS_NOTEXIST;
         }
     }
+    // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
 }
 ?>
diff --git a/repository/action/main/item/edittexts/maple.ini b/repository/action/main/item/edittexts/maple.ini
index da17bce..8f13edc 100644
--- a/repository/action/main/item/edittexts/maple.ini
+++ b/repository/action/main/item/edittexts/maple.ini
@@ -4,13 +4,20 @@ request = POST
 
 [ValidateDef]
 authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
-upload
+base_attr
+item_attr_texts
+save_mode
 
 [Action]
-Session = "ref:Session"
 Db = "ref:DbObject"
+Session = "ref:Session"
 
 [View]
-success = "action:repository_view_main_item_edittexts"
-stay = "action:repository_view_main_item_editfileslicense"
-error = "action:repository_view_main_item_editfileslicense"
+selecttype = "action:repository_view_main_item_selecttype"
+files = "action:repository_view_main_item_editfiles"
+license = "action:repository_view_main_item_editfileslicense"
+texts = "action:repository_view_main_item_edittexts"
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+error = "action:repository_view_main_item_edittexts"
diff --git a/repository/action/main/item/fillauthor/Fillauthor.class.php b/repository/action/main/item/fillauthor/Fillauthor.class.php
index 8701956..d465ba9 100644
--- a/repository/action/main/item/fillauthor/Fillauthor.class.php
+++ b/repository/action/main/item/fillauthor/Fillauthor.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Fillauthor.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Fillauthor.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/item/fillcontributor/Fillcontributor.class.php b/repository/action/main/item/fillcontributor/Fillcontributor.class.php
index 13f833e..6a13b39 100644
--- a/repository/action/main/item/fillcontributor/Fillcontributor.class.php
+++ b/repository/action/main/item/fillcontributor/Fillcontributor.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Fillcontributor.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Fillcontributor.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/item/filldata/Filldata.class.php b/repository/action/main/item/filldata/Filldata.class.php
index 385fc00..b44496a 100644
--- a/repository/action/main/item/filldata/Filldata.class.php
+++ b/repository/action/main/item/filldata/Filldata.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Filldata.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Filldata.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -29,6 +29,7 @@ class Repository_Action_Main_Item_Filldata extends RepositoryAction
 {
     // const
     const DOI_URI_PREFIX = "http://dx.doi.org/";
+    const CROSSREF_URI = "http://www.crossref.org/openurl/";
     
     // requestparameter of fill
     var $type_fill = null;                    // site name for data get
@@ -263,6 +264,11 @@ class Repository_Action_Main_Item_Filldata extends RepositoryAction
                 case "ichushi":
                     $result = $this->fillIchushi($this->id_fill);
                     break;
+			    // Auto Input Metadata by CrossRef DOI 2015/03/04 K.Sugimoto --start--
+                case "crossref":
+                    $result = $this->fillCrossRef($this->id_fill);
+                    break;
+			    // Auto Input Metadata by CrossRef DOI 2015/03/04 K.Sugimoto --end--
                 default:
                     break;
             }
@@ -1342,6 +1348,320 @@ class Repository_Action_Main_Item_Filldata extends RepositoryAction
         return true;
     }
         
+    // Auto Input Metadata by CrossRef DOI 2015/03/04 K.Sugimoto --start--
+    /**
+     * fill from CrossRef
+     *  + title (english)
+     *  + language
+     *  + creator (english)
+     *  + contributor (english)
+     *  + jtitle (english)
+     *  + issn
+     *  + isbn
+     *  + volume
+     *  + issue
+     *  + spage
+     *  + epage
+     *  + dateofissued
+     */
+    function fillCrossRef( $crossref_doi ){
+        // get CrossRef account
+        $crossref_query_services_account = "";
+        $query = "SELECT param_value ".
+                "FROM ".DATABASE_PREFIX."repository_parameter ".
+                "WHERE param_name = ? ".
+                "AND is_delete = ? ;";
+        $params = array();
+        $params[] = "crossref_query_service_account";
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if(count($result) > 0 && strlen($result[0]['param_value']) > 0)
+        {
+            $crossref_query_services_account = $result[0]['param_value'];
+        }
+        $crossref_query_services_account = urlencode($crossref_query_services_account);
+        
+        // check space
+        $crossref_doi = str_replace(" ", "", $crossref_doi); // str replace space
+        $crossref_doi = str_replace("　", "", $crossref_doi); // str replace 2byte spase
+        if(!isset($crossref_doi) || strlen($crossref_doi) == 0){
+            $error = $this->smartyAssign->getLang("repository_item_fill_data_type_crossref")
+                    .$this->smartyAssign->getLang("repository_item_fill_data_no_metadata_error");
+            array_push($this->error_msg, $error );
+            return false;
+        }
+        
+        // request URL send for CrossRef
+        if(preg_match("/^info:doi\//", $crossref_doi))
+        {
+	        $crossref_doi = str_replace("info:doi/", "", $crossref_doi);
+        }
+        else if(preg_match("/^http:\/\/dx\.doi\.org\//", $crossref_doi))
+        {
+	        $crossref_doi = str_replace("http://dx.doi.org/", "", $crossref_doi);
+        }
+        else if(preg_match("/^http:\/\/doi\.org\//", $crossref_doi))
+        {
+	        $crossref_doi = str_replace("http://doi.org/", "", $crossref_doi);
+        }
+        $crossref_doi = urlencode($crossref_doi);
+        
+        $send_param = "";
+        $send_param .= self::CROSSREF_URI;
+        $send_param .= '?id=doi:';
+        $send_param .= $crossref_doi;
+        $send_param .= '&noredirect=true';
+        $send_param .= '&pid=';
+        $send_param .= $crossref_query_services_account;
+        $send_param .= '&format=xsd-xml';
+        
+        /////////////////////////////
+        // HTTP_Request init
+        /////////////////////////////
+        // send http request
+        $option = array( 
+            "timeout" => "10",
+            "allowRedirects" => true, 
+            "maxRedirects" => 3, 
+        );
+        
+        // Modfy proxy 2011/12/06 Y.Nakao --start--
+        if($this->proxy['proxy_mode'] == 1)
+        {
+            $option = array( 
+                    "timeout" => "10",
+                    "allowRedirects" => true, 
+                    "maxRedirects" => 3,
+                    "proxy_host"=>$this->proxy['proxy_host'],
+                    "proxy_port"=>$this->proxy['proxy_port'],
+                    "proxy_user"=>$this->proxy['proxy_user'],
+                    "proxy_pass"=>$this->proxy['proxy_pass']
+                );
+        }
+        // Modfy proxy 2011/12/06 Y.Nakao --end--
+        
+        $http = new HTTP_Request($send_param, $option);
+        // setting HTTP header
+        $http->addHeader("User-Agent", $_SERVER['HTTP_USER_AGENT']); 
+        $http->addHeader("Referer", $_SERVER['HTTP_REFERER']);
+        
+        /////////////////////////////
+        // run HTTP request 
+        /////////////////////////////
+        $response = $http->sendRequest(); 
+        if (!PEAR::isError($response)) { 
+            $charge_code = $http->getResponseCode();// ResponseCode(200等)を取得 
+            $charge_header = $http->getResponseHeader();// ResponseHeader(レスポンスヘッダ)を取得 
+            $charge_body = $http->getResponseBody();// ResponseBody(レスポンステキスト)を取得 
+            $charge_Cookies = $http->getResponseCookies();// クッキーを取得 
+        }
+        // get response
+        if(isset($charge_body))
+        {
+        	$response_xml = $charge_body;
+        }
+        else
+        {
+        	$response_xml = null;
+        }
+        
+        /////////////////////////////
+        // parse response XML
+        /////////////////////////////
+        try{
+            $xml_parser = xml_parser_create();
+            $rtn = xml_parse_into_struct( $xml_parser, $response_xml, $vals );
+            if($rtn == 0 || $vals[0]['tag'] !== "CROSSREF_RESULT" || ($vals[11]['tag'] === "MSG" && urlencode($vals[11]['value']) === urlencode("unreasonable DOI found: doi=").$crossref_doi)){
+                $error = $this->smartyAssign->getLang("repository_item_fill_data_type_crossref")
+                        .$this->smartyAssign->getLang("repository_item_fill_data_no_metadata_error");
+                array_push($this->error_msg, $error );
+                return false;
+            }
+            xml_parser_free($xml_parser);
+        } catch(Exception $ex){
+            $error = $this->smartyAssign->getLang("repository_item_fill_data_type_crossref")
+                    .$this->smartyAssign->getLang("repository_item_fill_data_no_metadata_error");
+            array_push($this->error_msg, $error );
+            return false;
+        }
+        
+        /////////////////////////////
+        // get fill data
+        /////////////////////////////
+        $contributors_flg = false;
+        $contributor_flg = false;
+        $creator_flg = false;
+        $family_surname = null;
+        $family_suffix = null;
+        
+        foreach($vals as $val){
+            switch($val['tag']){
+                case "ISSN":
+                    if(strlen($this->issn) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->issn = $val['value'];
+                        }
+                    }
+                    break;
+                case "ISBN":
+                    if(strlen($this->isbn) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->isbn = $val['value'];
+                        }
+                    }
+                    break;
+                case "JOURNAL_TITLE":
+                    if(strlen($this->jtitle_english) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->jtitle_english = $val['value'];
+                        }
+                    }
+                    break;
+                case "AUTHOR":
+                    if(isset($val['value']) && strlen($val['value']) > 0){
+                        // 著者名
+                        $author = array("family"=>"","given"=>"","family_ruby"=>"","given_ruby"=>"","email"=>"","author_id"=>"","language"=>"","external_author_id"=>array(array("prefix_id"=>"", "suffix"=>"", "old_prefix_id"=>"", "old_suffix"=>"", "prefix_name"=>"")));
+                        $author["family"] = $val['value'];
+                        array_push($this->creator_english, $author);
+                    }
+                    break;
+                case "CONTRIBUTORS":
+                    if(isset($val['type']) && $val['type'] === "open") {
+                    	$contributors_flg = true;
+                    } else if(isset($val['type']) && $val['type'] === "close") {
+                    	$contributors_flg = false;
+                    }
+                    break;
+                case "CONTRIBUTOR":
+                    if($contributors_flg) {
+	                    if(isset($val['type']) && $val['type'] === "open") {
+	                        // 著者名
+	                        $author = array("family"=>"","given"=>"","family_ruby"=>"","given_ruby"=>"","email"=>"","author_id"=>"","language"=>"","external_author_id"=>array(array("prefix_id"=>"", "suffix"=>"", "old_prefix_id"=>"", "old_suffix"=>"", "prefix_name"=>"")));
+		                    
+		                    if($val['attributes']['CONTRIBUTOR_ROLE'] != null && ($val['attributes']['CONTRIBUTOR_ROLE'] === "editor" || $val['attributes']['CONTRIBUTOR_ROLE'] === "chair" || $val['attributes']['CONTRIBUTOR_ROLE'] === "translator")){
+		                        $contributor_flg = true;
+
+		                    } else {
+		                        $creator_flg = true;
+		                    }
+	                    } else if(isset($val['type']) && $val['type'] === "close") {
+		                    if($contributor_flg) {
+		                        array_push($this->contributor_english, $author);
+		                    } else if($creator_flg) {
+		                        array_push($this->creator_english, $author);
+	                        }
+		                    $contributor_flg = false;
+	                        $creator_flg = false;
+	                    }
+                    }
+                    break;
+                case "GIVEN_NAME":
+                    if($contributors_flg) {
+	                    if($contributor_flg || $creator_flg) {
+	                        $author["given"] = $val['value'];
+                        }
+                    }
+                    break;
+                case "SURNAME":
+                    if($contributors_flg) {
+	                    if($contributor_flg || $creator_flg) {
+	                        $family_surname = $val['value'];
+
+		                    if(isset($family_surname) && isset($family_suffix)) {
+			                    $author["family"] = $family_surname." ".$family_suffix;
+			                    $family_surname = null;
+			                    $family_suffix = null;
+		                    }
+		                    else
+		                    {
+		                        $author["family"] = $family_surname;
+		                        $family_surname = null;
+		                    }
+	                    }
+                    }
+                    break;
+                case "SUFFIX":
+                    if($contributors_flg) {
+	                    if($contributor_flg || $creator_flg) {
+	                        $family_suffix = $val['value'];
+
+		                    if(isset($family_surname) && isset($family_suffix)) {
+			                    $author["family"] = $family_surname." ".$family_suffix;
+			                    $family_surname = null;
+			                    $family_suffix = null;
+		                    }
+	                    }
+                    }
+                    break;
+                case "ORGANIZATION":
+                    if($contributors_flg) {
+	                    if(isset($val['attributes']['CONTRIBUTOR_ROLE']) && ($val['attributes']['CONTRIBUTOR_ROLE'] === "editor" || $val['attributes']['CONTRIBUTOR_ROLE'] === "chair" || $val['attributes']['CONTRIBUTOR_ROLE'] === "translator")){
+	                        // 著者名
+	                        $author = array("family"=>"","given"=>"","family_ruby"=>"","given_ruby"=>"","email"=>"","author_id"=>"","language"=>"","external_author_id"=>array(array("prefix_id"=>"", "suffix"=>"", "old_prefix_id"=>"", "old_suffix"=>"", "prefix_name"=>"")));
+	                        $author["family"] = $val['value'];
+
+	                        array_push($this->contributor_english, $author);
+	                    } else {
+	                        // 著者名
+	                        $author = array("family"=>"","given"=>"","family_ruby"=>"","given_ruby"=>"","email"=>"","author_id"=>"","language"=>"","external_author_id"=>array(array("prefix_id"=>"", "suffix"=>"", "old_prefix_id"=>"", "old_suffix"=>"", "prefix_name"=>"")));
+	                        $author["family"] = $val['value'];
+
+	                        array_push($this->creator_english, $author);
+	                    }
+                    }
+                    break;
+                case "VOLUME":
+                    if(strlen($this->volume) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->volume = $val['value'];
+                        }
+                    }
+                    break;
+                case "ISSUE":
+                    if(strlen($this->issue) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->issue = $val['value'];
+                        }
+                    }
+                    break;
+                case "FIRST_PAGE":
+                    if(strlen($this->spage) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->spage = $val['value'];
+                        }
+                    }
+                    break;
+                case "LAST_PAGE":
+                    if(strlen($this->epage) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->epage = $val['value'];
+                        }
+                    }
+                    break;
+                case "YEAR":
+                    if(strlen($this->dateofissued) == 0){
+                        if(isset($val['value']) && strlen($val['value']) > 0){
+                            $this->dateofissued = $val['value'];
+                        }
+                    }
+                    break;
+                case "ARTICLE_TITLE":
+                    if(isset($val['value']) && strlen($val['value']) > 0){
+                        if(strlen($this->title_english) == 0){
+                            $this->title_english = $val['value'];
+                        }
+                    }
+                    break;
+                default:
+            }
+        }
+        
+        $this->language = "en";
+        
+        return true;
+    }
+    // Auto Input Metadata by CrossRef DOI 2015/03/04 K.Sugimoto --end--
+        
     /**
      * Edit data fill in session
      */
@@ -2734,6 +3054,26 @@ class Repository_Action_Main_Item_Filldata extends RepositoryAction
                     array_push($edit_attr, $name_init);
                     $item_attr[$ii] = $edit_attr;
                     $item_num_attr[$ii] = count($edit_attr);
+                } else if( $item_element[$ii]['input_type'] == "biblio_info" ){
+                    $item_attr[$ii][0] = array(
+                        'biblio_name' => '',
+                        'biblio_name_english' => '',
+                        'volume' => '',
+                        'issue' => '',
+                        'spage' => '',
+                        'epage' => '',
+                        'date_of_issued' => '',
+                        'year' => '',
+                        'month' => '',
+                        'day' => ''
+                    );
+                } else if( $item_element[$ii]['input_type'] == "date" ){
+                    $item_attr[$ii][0] = array(
+                        'date' => '',
+                        'date_year' => '',
+                        'date_month' => '',
+                        'date_day' => ''
+                    );
                 }
                 // Fix initialize for name Y.Nakao 2013.12.17 --end--
                 continue;
@@ -2958,8 +3298,39 @@ class Repository_Action_Main_Item_Filldata extends RepositoryAction
                     }
                 }
                 continue;
+            } else if($item_attr_type[$ii]['input_type'] === "name"){
+                $new_item_attr[$ii][0] = array(
+                    "family" => "",
+                    "given" => "",
+                    "family_ruby" => "",
+                    "given_ruby" => "",
+                    "email" => "",
+                    "author_id" => "",
+                    "language" => "",
+                    "external_author_id" => array(array('prefix_id'=>'', 'suffix'=>'', 'old_prefix_id'=>'', 'old_suffix'=>'', 'prefix_name'=>''))
+                );
+            } else if($item_attr_type[$ii]['input_type'] === "biblio_info"){
+                $new_item_attr[$ii][0] = array(
+                    'biblio_name' => '',
+                    'biblio_name_english' => '',
+                    'volume' => '',
+                    'issue' => '',
+                    'spage' => '',
+                    'epage' => '',
+                    'date_of_issued' => '',
+                    'year' => '',
+                    'month' => '',
+                    'day' => ''
+                );
+            } else if($item_attr_type[$ii]['input_type'] === "date"){
+                $new_item_attr[$ii][0] = array(
+                    "date" => "",
+                    "date_year" => "",
+                    "date_month" => "",
+                    "date_day" => ""
+                );
             }
-
+            
             //create Dummy array
             $edit_biblio_info = array(
                                       'biblio_name' => '',
diff --git a/repository/action/main/item/linkact/Linkact.class.php b/repository/action/main/item/linkact/Linkact.class.php
index 26fb134..48354a1 100644
--- a/repository/action/main/item/linkact/Linkact.class.php
+++ b/repository/action/main/item/linkact/Linkact.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Linkact.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Linkact.class.php 45650 2014-12-24 09:40:34Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -304,17 +304,22 @@ class Repository_Action_Main_Item_Linkact extends RepositoryAction
             return false;
         }
         
-        if($lang == "japanese"){
-            $index_name = $result[0]["index_name"];
-            if($index_name == ""){
-                $index_name = $result[0]["index_name_english"];
-            }
+        if(count($result) > 0){
+        	if($lang == "japanese"){
+            	$index_name = $result[0]["index_name"];
+            	if($index_name == ""){
+                	$index_name = $result[0]["index_name_english"];
+            	}
+        	} else {
+            	$index_name = $result[0]["index_name_english"];
+            	if($index_name == ""){
+                	$index_name = $result[0]["index_name"];
+            	}
+        	}
         } else {
-            $index_name = $result[0]["index_name_english"];
-            if($index_name == ""){
-                $index_name = $result[0]["index_name"];
-            }
+        	$index_name = null;
         }
+        
         return $index_name;
     }
     
diff --git a/repository/action/main/item/selecttype/Selecttype.class.php b/repository/action/main/item/selecttype/Selecttype.class.php
index a7f5311..5005125 100644
--- a/repository/action/main/item/selecttype/Selecttype.class.php
+++ b/repository/action/main/item/selecttype/Selecttype.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Selecttype.class.php 270 2009-01-21 04:50:41Z ivis $
+// $Id: Selecttype.class.php 53145 2015-05-13 10:58:06Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,43 +13,1204 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
+
 /**
- * [[機能説明]]
+ * アイテム登録：アイテムタイプ選択画面からの入力処理アクション
  *
  * @package     [[package名]]
  * @access      public
+ * @version 1.0 新規作成
+ *          2.0 登録フロー表示改善対応 2008/06/26 Y.Nakao  
  */
-class Repository_Action_Main_Item_Selecttype
+class Repository_Action_Main_Item_Selecttype extends RepositoryAction
 {
-	// 使用コンポーネントを受け取るため
-	var $session = null;
-	
+    // 使用コンポーネントを受け取るため
+    /**
+     * usersViewコンポーネント
+     * @var Users_View
+     */
+    public $usersView = null;
+    
+    // リクエストパラメーター
+    /**
+     * アイテムタイプID(新規作成時)
+     * @var int
+     */
+    public $itemtype_id = null;
+    
+    /**
+     * アイテムID(既存編集時)
+     * @var int
+     */
+    public $item_id = null;
+    
+    /**
+     * アイテムNo(既存編集時)
+     * @var int
+     */
+    public $item_no = null;
+    
+    /**
+     * 呼び出し元画面番号
+     *  アイテム詳細画面から来た場合："1"
+     *  ワークフロー画面から来た場合："2"
+     * @var string
+     */
+    public $return_screen = null;
+    
+    /**
+     * ワークフロータブ番号
+     * @var string
+     */
+    public $workflow_active_tab = null;
+    
+    /**
+     * 処理モード
+     *   'selecttype'   : アイテムタイプ選択画面
+     *   'files'        : ファイル選択画面
+     *   'texts'        : メタデータ入力画面
+     *   'links'        : リンク設定画面
+     *   'doi'          : DOI設定画面
+     *   'confirm'      : 確認画面
+     *   'stay'         : save
+     *   'next'         : go next page
+     * @var string
+     */
+    public $save_mode = null;
+    
+    // メンバ変数
+    private $warningMsg = array();  // 警告メッセージ
+    
+    /**
+     * 実行処理
+     * @see RepositoryAction::executeApp()
+     */
+    protected function executeApp()
+    {
+        //-----------------------------------------------------------------------
+        // セッション情報一覧
+        // 【★新規作成･編集中で普遍な情報】 : 本アクションで初期設定して以降、DB登録もしくは更新まで普遍な情報である。
+        // 1.アイテムタイプ (1レコード) : "item_type_all"[''], アイテムタイプのレコードをそのまま保存したものである。
+        // 2.アイテム属性タイプ (Nレコード, Order順) : "item_attr_type"[N][''], アイテム属性タイプの必要部分を連想配列で保持したものである。
+        // 3.アイテム属性選択肢数 (N) : "item_num_cand"[N], 選択肢のない属性タイプは0を設定
+        // 4.アイテム属性選択肢 (N): "option_data"[N][M], N属性タイプごとの選択肢。Mはアイテム属性選択肢数に対応。0～        
+        // X.ファイル属性フラグ : "isfile", 0:file, thumbnailなし, 1:thumbnailのみあり, 2:"file"あり     
+        // 【★アイテム編集で変化するメタデータ情報】 : 編集過程で逐次変化していく情報である。
+        // 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
+        // 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～        
+        // 【★アイテム編集で変化するアイテム基本情報】 : 編集過程で逐次変化していく情報である。
+        // X.現在のアイテム基本情報のデータ : "base_attr"[2], (今のところタイトルと言語のユーザー入力値)
+        // 【★インデックス選択とリンク設定情報】 : アイテムファミリー外の設定に必要
+        // X.現在選択中のインデックス配列    : "indice"[L], L : 関連付けるインデックスの数, キーワードとインデックスIDをおさえておけばよいか。
+        // X.現在選択中のリンクアイテム配列 : "link"[L], L : リンクを張るアイテムの数, アイテム名とアイテムIDをおさえておけばよいか。(いや、どうせDB検索と絡むのでレコード全部)
+        // 【★その他】
+        // X.ライセンスマスタ  : license_master
+        // X.処理モード : edit_flag (0:新規作成, 1:既存編集)
+        // X.編集中のアイテムID : edit_item_id (既存編集時のみ)
+        // X.編集中のアイテムNO : edit_item_no (既存編集時のみ)
+        // X.DB登録済み削除ファイルリスト : delete_file_list (既存編集時のみ)
+        // X.アイテム公開日 : item_pub_date
+        // X.アイテムキーワード : item_keyword
+        // X.インデックス選択画面のツリー開閉情報 : open_node_index_id_link
+        // X.アイテム間リンク設定画面のツリー開閉情報 : open_node_index_id_index
+        // ---------------------------------------------------------------------- 
+        
+        // Set NameAuthority Class
+        $NameAuthority = new NameAuthority($this->Session, $this->Db);
+        
+        // リクエストパラメタから処理モード設定
+        // ※ただし、セッションに処理フラグがある場合は読み込まない
+        $item_type = null;
+        $item_attr_type = null;
+        $Result_List = array();     // DBから取得したレコードの集合
+        $Error_Msg = '';            // エラーメッセージ
+        $edit_flag = 0;     // 処理モード (0:新規作成, 1:既存編集)
+        $user_id = $this->Session->getParameter("_user_id");
+        if($this->itemtype_id != null){
+            // 新規登録モード
+            $edit_flag = 0;     
+            // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --start--
+            // DB登録後に戻る画面情報
+            $this->Session->removeParameter("return_screen");
+            // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --end--
+            // リクエストパラメタにアイテムタイプIDがあれば、アイテムタイプ情報を取得してセッションに保存
+            //アイテムタイプ名をDBから取得
+            $params = array("item_type_id" => $this->itemtype_id, 'is_delete'=>0);
+            $item_type = $this->Db->selectExecute("repository_item_type",$params);
+            // アイテムタイプレコードをセッションに保存 (kawa)
+            $item_type_info = array('item_type_name' => $item_type[0]['item_type_name'],
+                                    'item_type_id' => $item_type[0]['item_type_id']
+                              );
+            $this->Session->setParameter("item_type_all", $item_type_info);
+            // アイテム属性タイプをDBから取得
+            $item_attr_type = $this->Db->selectExecute("repository_item_attr_type",$params);
+            if ($item_attr_type === false) {
+                $tmpErrorMsg = $this->Db->ErrorMsg();
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            }
+            $this->Session->setParameter("edit_start_date", $this->TransStartDate);     // 編集基準時間を保存
+        } else if($this->item_id != null && $this->item_no != null) {
+            // 既存編集モード
+            $edit_flag = 1;
+            
+            // Add check edit user auth 2011/06/02 A.Suzuki --start--
+            $smartyAssign = $this->Session->getParameter("smartyAssign");
+            if(!$this->checkAuthForEditItem($user_id, $this->item_id)){
+                // uneditable user
+                $tmpErrorMsg = "_invalid_auth";
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            }
+            // Add check edit user auth 2011/06/02 A.Suzuki --end--
+            
+            // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --start--
+            // DB登録後に戻る画面情報
+            $this->Session->setParameter("return_screen", $this->return_screen);
+            // アイテム修正時のページ遷移改善対応 2008/06/30 Y.Nakao --end--
+            // ワークフローの表示タブ情報 2009/07/13 A.Suzuki --start--
+            $this->Session->setParameter("repository_workflow_active_tab", $this->workflow_active_tab);
+            // ワークフローの表示タブ情報 2009/07/13 A.Suzuki --end--
+            // アイテム情報を取得
+            $result = $this->getItemData($this->item_id, $this->item_no, $Result_List, $Error_Msg, true);
+            if($result === false){
+                $tmpErrorMsg = $Error_Msg;
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            }
+            // Add e-person R.Matsuura 2013/11/21 --start--
+            // get author send feedback mail
+            $authorData = $this->getFeedbackAuthor($this->item_id, $this->item_no);
+            if(count($authorData) > 0)
+            {
+                $result = $this->setFeedbackAuthor($authorData);
+            }
+            // Add e-person R.Matsuura 2013/11/21 --end--
+            
+            // 所属インデックス取得
+            $result = $this->getItemIndexData($this->item_id, $this->item_no, $Result_List,$Error_Msg);
+            if($result === false){
+                $tmpErrorMsg = $Error_Msg;
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            } 
+            // 参照取得
+            $result = $this->getItemReference($this->item_id, $this->item_no, $Result_List,$Error_Msg);
+            if($result === false){
+                $tmpErrorMsg = $Error_Msg;
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            }
+            // アイテム更新日精査
+            if( $this->TransStartDate < $Result_List['item'][0]['mod_date'] ) {
+                $tmpErrorMsg = "error : probably this item was updated by other admin.";
+                $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($tmpErrorMsg);
+                $exception->addError($tmpErrorMsg);
+                throw $exception;
+            }
+            // 値のコピー
+            $this->itemtype_id = $Result_List['item_type'][0]['item_type_id'];
+            $item_type_info = array('item_type_name' => $Result_List['item_type'][0]['item_type_name'],
+                                    'item_type_id' => $Result_List['item_type'][0]['item_type_id']
+                              );
+            $this->Session->setParameter("item_type_all", $item_type_info);
+            $item_attr_type = $Result_List['item_attr_type'];
+            // 編集中のアイテムID, NOを保存
+            $this->Session->setParameter("edit_item_id", $this->item_id);
+            $this->Session->setParameter("edit_item_no", $this->item_no);
+            $this->Session->setParameter("delete_file_list", array());
+            //$this->Session->setParameter("edit_start_date", $Result_List['item'][0]['mod_date']);     // 編集基準時間 = 編集開始時のアイテムの最終更新日
+            $this->Session->setParameter("edit_start_date", $this->TransStartDate); // 編集開始時間
+        } else {
+            // イリーガルな遷移
+            $tmpErrorMsg = "Illegal parameter.";
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $this->Session->setParameter("edit_flag", $edit_flag);
+                    
+        // ライセンスマスタを保存
+        $license_master = $this->Db->selectExecute("repository_license_master", array('is_delete'=>0));         
+        if ($license_master === false) {
+            $tmpErrorMsg = $this->Db->ErrorMsg();
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $this->Session->setParameter("license_master",$license_master);
+        // 現在のアイテム基本情報のデータ : "base_attr"[2(今のところタイトルと言語)](kawa)
+        $lang = 'en';
+        if($this->Session->getParameter("_lang") == "japanese"){
+            $lang = 'ja';
+        }
+        $base_attr = array(
+            "title" => '',
+            "title_english" => '',
+            "language" => $lang
+        );
+        $DATE = new Date();
+        $item_pub_date = array(
+                        'year' => $DATE->getYear(),
+                        'month' => $DATE->getMonth(),
+                        'day' => $DATE->getDay());
+        
+        $item_keyword = '';         // アイテムキーワード
+        $item_keyword_english = ''; // アイテムキーワード
+        $item_element = array();    // アイテム属性タイプ
+        $item_num_cand = array();   // アイテム属性選択肢数
+        $option_data = array();     // アイテム属性選択肢
+        $item_contributor = null;   // Contributor
+        $show_no = 1;
+        // アイテム属性タイプ情報を表示順に並び換える。
+        // またselect, radioの場合は選択肢の数と
+        for ($ii = 0; $ii < count($item_attr_type); $ii++) {
+            for ($ii2 = 0; $ii2 < count($item_attr_type); $ii2++) {
+                if ($item_attr_type[$ii2]['show_order'] == $show_no) {
+                    $num_cand = 0;      // 選択肢の数
+                    $options = array(); // 選択肢
+                    // アイテム属性タイプの共通項目の設定
+                    $params_attr = array(
+                            'attribute_id' => $item_attr_type[$ii2]['attribute_id'],
+                            'attribute_name' => $item_attr_type[$ii2]['attribute_name'],
+                            'input_type' => $item_attr_type[$ii2]['input_type'],
+                            'is_required' => $item_attr_type[$ii2]['is_required'],
+                            'plural_enable' => $item_attr_type[$ii2]['plural_enable'],
+                            'line_feed_enable' => $item_attr_type[$ii2]['line_feed_enable'],
+                            'plural_enable' => $item_attr_type[$ii2]['plural_enable'],
+                            'dublin_core_mapping' => $item_attr_type[$ii2]['dublin_core_mapping'],
+                            'junii2_mapping' => $item_attr_type[$ii2]['junii2_mapping'],
+                            'lom_mapping' => $item_attr_type[$ii2]['lom_mapping'],
+                            'display_lang_type' => $item_attr_type[$ii2]['display_lang_type']
+                    );
+                    // check, radioは選択肢とその数を取得
+                    if($item_attr_type[$ii2]['input_type'] == "select" ||
+                       $item_attr_type[$ii2]['input_type'] == "checkbox" ||
+                       $item_attr_type[$ii2]['input_type'] == "radio") {
+                        $params_cand = array(
+                                'item_type_id'=>$this->itemtype_id,
+                                'attribute_id'=>$item_attr_type[$ii2]['attribute_id'],
+                                'is_delete'=>0);
+                        $option = $this->Db->selectExecute("repository_item_attr_candidate",$params_cand);
+                        if ($option === false) {
+                            $tmpErrorMsg = $this->Db->ErrorMsg();
+                            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                            $exception = new AppException($tmpErrorMsg);
+                            $exception->addError($tmpErrorMsg);
+                            throw $exception;
+                        }
+                        $num_cand = count($option);
+                        for($ii3=0; $ii3<$num_cand ; $ii3++) {
+                            array_push($options, $option[$ii3]['candidate_value']);
+                        }                       
+                    } else {
+                    }
+                    array_push( $item_num_cand, $num_cand);     // アイテム属性タイプごとの選択支の数を設定
+                    array_push( $option_data, $options);    
+                    array_push( $item_element, $params_attr);
+                    $show_no++;
+                    break;
+                }
+            }
+        }
+        // Add item type multi-language 2013/07/25 K.Matsuo --start--
+        $this->setItemtypeNameMultiLanguage($this->itemtype_id, $item_element);
+        // Add item type multi-language 2013/07/25 K.Matsuo --end--
+        // アイテム属性タイプ情報をセッションに保存
+        $this->Session->setParameter("item_attr_type",$item_element);   // アイテム属性タイプ
+        $this->Session->setParameter("item_num_cand",$item_num_cand);   // アイテム属性選択肢数
+        $this->Session->setParameter("option_data",$option_data);       // アイテム属性選択肢
+    
+        // アイテム属性数／アイテム属性を初期設定
+        $item_num_attr = array();
+        if(count($item_attr_type) > 0)
+        {
+            $item_num_attr = array_fill(0, count($item_attr_type), 1);      // アイテム属性数 [N]
+        }
+        $item_attr = array();
+        if(count($item_attr_type) > 0)
+        {
+            $item_attr = array_fill(0, count($item_attr_type), array(''));  // アイテム属性 [N][L]
+        }
+        // 現在のアイテム属性を初期設定 (kawa)
+        // 新規作成 ⇒ 空文字列 or ON/OFF
+        $isfile = 0;        // file存在フラグ
+        $file_num = 0;      // 'file'メタデータ数
+        $thumbnail_num = 0; // 'thumbnail'メタデータ数
+        for ($ii = 0; $ii < count($item_attr); $ii++) {
+            // チェックボックス : 初期値OFF
+            if( $item_element[$ii]['input_type'] == "checkbox" ) {
+                $check_init = array();
+                for ($jj = 0; $jj < count($option_data[$ii]); $jj++) {
+                    array_push($check_init, "0");   // "0":OFF
+                }
+                $item_attr[$ii] = $check_init;
+            }
+            // ラジオボタン : 初期値は最初の選択肢
+            if( $item_element[$ii]['input_type'] == "radio" ) {
+                $item_attr[$ii][0] = 0;     // 0-th candidate is checked.
+            }
+            // 氏名 : 姓、名、Emailの初期値をセット
+            if( $item_element[$ii]['input_type'] == "name" ) {
+                $name_init = array(array(
+                        'family' => '',
+                        'given' => '',
+                        'family_ruby' => '',
+                        'given_ruby' => '',
+                        'email' => '',
+                        'author_id' => '',
+                        'external_author_id' => array(array('prefix_id'=>'', 'suffix'=>''))
+                    )
+                );
+                $item_attr[$ii] = $name_init;
+            }
+            // ファイル : null = 未登録
+            if( $item_element[$ii]['input_type'] == "file"){
+                // Add registered info save action 2009/02/12 Y.Nakao --start--
+                //$item_attr[$ii][0] = null;        // 0-th file is not uploaded yet.
+                $file_no = 1;
+                if($edit_flag == 1){
+                    $file_no = $this->getFileNo($this->item_id, $this->item_no, $ii + 1, $err_msg);
+                }
+                $item_attr[$ii][0] = array('file_no' => $file_no, 'show_order' => $file_no, 'display_name' => "", 'display_type' => "");
+                // Add registered info save action 2009/02/12 Y.Nakao --end--
+                $file_num++;
+            }
+            // Add file price Y.Nakao 2008/08/28 --start--
+            if($item_element[$ii]['input_type'] == "file_price") {
+                // Add registered info save action 2009/02/12 Y.Nakao --start--
+                //$item_attr[$ii][0] = null;        // 0-th file is not uploaded yet.
+                $file_no = 1;
+                if($edit_flag == 1){
+                    $file_no = $this->getFileNo($this->item_id, $this->item_no, $ii + 1, $err_msg);
+                }
+                $item_attr[$ii][0] = array('file_no' => $file_no, 'show_order' => $file_no);
+                // Add registered info save action 2009/02/12 Y.Nakao --end--
+                $file_num++;
+            }
+            // Add file price Y.Nakao 2008/08/28 --end--
+            // サムネイル : null = 未登録
+            if( $item_element[$ii]['input_type'] == "thumbnail" ) {
+                // Add registered info save action 2009/02/12 Y.Nakao --start--
+                //$item_attr[$ii][0] = null;        // 0-th file is not uploaded yet.
+                $file_no = 1;
+                if($edit_flag == 1){
+                    $file_no = $this->calcMaxThumbnailNo($this->item_id, $this->item_no, $ii + 1, $err_msg)+1;
+                }
+                $item_attr[$ii][0] = array('file_no' => $file_no, 'show_order' => $file_no);
+                // Add registered info save action 2009/02/12 Y.Nakao --end--
+                $thumbnail_num++;
+            }
+            if($item_element[$ii]['input_type'] == "biblio_info"){
+                $biblio_init = array(
+                    array(
+                        'biblio_name' => '',
+                        'biblio_name_english' => '',
+                        'volume' => '',
+                        'issue' => '',
+                        'spage' => '',
+                        'epage' => '',
+                        'date_of_issued' => '',
+                        'year' => '',
+                        'month' => '',
+                        'day' => ''
+                    )
+                );
+                $item_attr[$ii] = $biblio_init;
+            }
+            if($item_element[$ii]['input_type'] == "date"){
+                $date_init = array(
+                    array(
+                        'date' => '',
+                        'date_year' => '',
+                        'date_month' => '',
+                        'date_day' => ''
+                    )
+                );
+                $item_attr[$ii] = $date_init;
+            }
+        }
+        // isfile設定
+        if($file_num>0){
+            $isfile = 2;
+        } elseif($thumbnail_num>0){
+            $isfile = 1;
+        }  
+        // インデックス設定／リンク設定用変数の設定
+        $indice = array();
+        $link = array();
+        
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+        $this->Session->setParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID, $user_id);
+        $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID, $user_id);
+        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+        
+        // 編集の場合は既存属性を検査してセットする必要あり
+        if( $edit_flag == 1 ) {
+            // 基本情報
+            $base_attr = array(
+                "title" => $Result_List['item'][0]['title'],
+                "title_english" => $Result_List['item'][0]['title_english'],
+                "language" => $Result_List['item'][0]['language']
+            );
+            // アイテムの公開日が設定されている場合、年月日に分解
+            if( $Result_List['item'][0]['shown_date'] != null &&
+                $Result_List['item'][0]['shown_date'] != '' ) {
+                $pub_date = split('[ ]', $Result_List['item'][0]['shown_date']);
+                list($pub_year, $pub_month, $pub_day) = split('[/.-]', $pub_date[0]);               
+                $item_pub_date = array(
+                            'year' => intval($pub_year),
+                            'month' => intval($pub_month),
+                            'day' => intval($pub_day));
+            }
+            // アイテムキーワード
+            $item_keyword = $Result_List['item'][0]['serch_key'];
+            $item_keyword_english = $Result_List['item'][0]['serch_key_english'];
+            
+            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
+            $insUserId = $Result_List['item'][0][RepositoryConst::DBCOL_COMMON_INS_USER_ID];
+            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_ORG_CONTRIBUTOR_USER_ID, $insUserId);
+            $this->Session->setParameter(RepositoryConst::SESSION_PARAM_CONTRIBUTOR_USER_ID, $insUserId);
+            
+            // Only admin user
+            $user_auth_id = $this->Session->getParameter("_user_auth_id");
+            $auth_id = $this->getRoomAuthorityID();
+            if($user_auth_id >= $this->repository_admin_base && $auth_id >= $this->repository_admin_room)
+            {
+                // Check insert user
+                if(strlen($insUserId) > 0 && strlen($user_id) > 0 && $insUserId != $user_id)
+                {
+                    // This item's insert user is difference to this user
+                    // Get insert user data
+                    $user = null;
+                    $userItemLink = null;
+                    $user =& $this->usersView->getUserById($insUserId);
+                    $userItemLink =& $this->usersView->getUserItemLinkById($insUserId);
+                    $item_contributor = array();
+                    
+                    // Handle
+                    if(is_array($user) && array_key_exists("handle", $user))
+                    {
+                        $item_contributor[RepositoryConst::ITEM_CONTRIBUTOR_HANDLE] = $user["handle"];
+                    }
+                    if(is_array($userItemLink))
+                    {
+                        // UserName
+                        if(array_key_exists("4", $userItemLink))
+                        {
+                            $item_contributor[RepositoryConst::ITEM_CONTRIBUTOR_NAME] = $userItemLink["4"]["content"];
+                        }
+                        
+                        // Email
+                        if(array_key_exists("5", $userItemLink))
+                        {
+                            $item_contributor[RepositoryConst::ITEM_CONTRIBUTOR_EMAIL] = $userItemLink["5"]["content"];
+                        }
+                    }
+                }
+            }
+            // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
+            
+            // メタデータ
+            for ($ii = 0; $ii < count($item_element); $ii++) {
+                // 属性未登録のメタデータは初期設定でOK
+                if(count($Result_List['item_attr'][$ii]) <= 0) {
+                    continue;
+                }   
+                $edit_attr = array();
+                
+                // チェックボックス : 属性にはチェックの入った選択肢の文字列が入っている
+                // 選択肢と同数の配列を確保。チェックの入った選択肢に1を、入ってない選択肢に0を設定。
+                if( $item_element[$ii]['input_type'] == "checkbox" ) {
+                    for ($kk = 0; $kk < count($option_data[$ii]); $kk++) {
+                        $isGot = false;
+                        for ($jj = 0; $jj < count($Result_List['item_attr'][$ii]); $jj++) {
+                            if($option_data[$ii][$kk] == $Result_List['item_attr'][$ii][$jj]['attribute_value']) {
+                                array_push($edit_attr, 1);      // kk-th選択肢は選択済み
+                                $isGot = true;
+                                break;
+                            }
+                        }
+                        if(!$isGot) {
+                            array_push($edit_attr, 0);      // kk-th選択肢は未選択
+                        }
+                    }
+                    // 初期属性の再セット
+                    $item_attr[$ii] = $edit_attr;
+                    continue;
+                }
+                // プルダウン : 選択肢に存在しない値がセットされていた場合、空文字をセットする
+                if( $item_element[$ii]['input_type'] == "select" ) {
+                    for ($jj = 0; $jj < count($Result_List['item_attr'][$ii]); $jj++) {
+                        $isTrue = false;
+                        for ($kk = 0; $kk < count($option_data[$ii]); $kk++) {
+                            if($Result_List['item_attr'][$ii][$jj]['attribute_value'] == $option_data[$ii][$kk]) {
+                                $isTrue = true;
+                                break;
+                            }
+                        }
+                        
+                        // 不正な値が入っていた場合の処理
+                        $option_value = "";
+                        if($isTrue == false) {
+                            // 必須項目だった場合は選択肢の最初の項目を設定する
+                            if($item_element[$ii]['is_required'] == 1) {
+                                $option_value = $option_data[$ii][0];
+                            }
+                        } else {
+                            // 選択肢と一致した値だった場合、その値を再設定する
+                            $option_value = $Result_List['item_attr'][$ii][$jj]['attribute_value'];
+                        }
+                        array_push($edit_attr, $option_value);
+                    }
+                    // 属性の再セット
+                    $item_attr[$ii] = $edit_attr;
+                    continue;
+                }
+                
+                // ii-thメタデータのjj-th属性をコピー
+                for ($jj = 0; $jj < count($Result_List['item_attr'][$ii]); $jj++) {
+                    // ラジオボタン : 
+                    if( $item_element[$ii]['input_type'] == "radio" ) {
+                        // 値の一致したオプションのインデックスをセット
+                        for ($kk = 0; $kk < count($option_data[$ii]); $kk++) {
+                            if($option_data[$ii][$kk] == $Result_List['item_attr'][$ii][$jj]['attribute_value']) {
+                                array_push($edit_attr, $kk);        // 0-th candidate is checked.
+                                break;
+                            }
+                        }
+                    }
+                    // 氏名 : 姓、名、Emailの初期値をセット
+                    else if( $item_element[$ii]['input_type'] == "name" ) {
+                        $external_author_id = $NameAuthority->getExternalAuthorIdPrefixAndSuffix($Result_List['item_attr'][$ii][$jj]['author_id']);
+                        if($external_author_id === false){
+                            $this->errorLog("Error occurred.", __FILE__, __CLASS__, __LINE__);
+                            throw new AppException("Error occurred.");
+                        }
+                        $external_author_id_without_email = array();
+                        for($cnt = 0; $cnt < count($external_author_id); $cnt++)
+                        {
+                            if($external_author_id[$cnt]["prefix_id"] == 0)
+                            {
+                                $email = $external_author_id[$cnt]["suffix"];
+                            }
+                            else
+                            {
+                                $tmp_array = array("prefix_id" => $external_author_id[$cnt]["prefix_id"], "suffix" => $external_author_id[$cnt]["suffix"]);
+                                array_push($external_author_id_without_email, $tmp_array);
+                            }
+                        }
+                        $name_init = array(
+                            'family' => $Result_List['item_attr'][$ii][$jj]['family'],
+                            'given' => $Result_List['item_attr'][$ii][$jj]['name'],
+                            'family_ruby' => $Result_List['item_attr'][$ii][$jj]['family_ruby'],
+                            'given_ruby' => $Result_List['item_attr'][$ii][$jj]['name_ruby'],
+                            'email' => $Result_List['item_attr'][$ii][$jj]['e_mail_address'],
+                            'author_id' => $Result_List['item_attr'][$ii][$jj]['author_id'],
+                            'external_author_id' => $external_author_id_without_email
+                        );
+                        array_push($edit_attr, $name_init);
+                    }
+                    // Add biblio info 2008/08/11 Y.Nakao --start--
+                    // 書誌情報：雑誌名、巻、号、ページ、発行年の初期値をセット
+                    else if( $item_element[$ii]['input_type'] == "biblio_info" ) {
+                        $date = explode("-", $Result_List['item_attr'][$ii][$jj]['date_of_issued']);
+                        if(count($date) == 2){
+                            array_push($date, "");
+                        } else if(count($date) == 1){
+                            array_push($date, "");
+                            array_push($date, "");
+                        }
+
+                        if(strlen($date[1]) == 2){
+                            $temp_month = str_split($date[1]);
+                            if($temp_month[0] == "0"){
+                                $date[1] = $temp_month[1];
+                            }
+                        }
+                        if(strlen($date[2]) == 2){
+                            $temp_day = str_split($date[2]);
+                            if($temp_day[0] == "0"){
+                                $date[2] = $temp_day[1];
+                            }
+                        }
+
+                        $biblio_init = array(
+                            'biblio_name' => $Result_List['item_attr'][$ii][$jj]['biblio_name'],
+                            'biblio_name_english' => $Result_List['item_attr'][$ii][$jj]['biblio_name_english'],
+                            'volume' => $Result_List['item_attr'][$ii][$jj]['volume'],
+                            'issue' => $Result_List['item_attr'][$ii][$jj]['issue'],
+                            'spage' => $Result_List['item_attr'][$ii][$jj]['start_page'],
+                            'epage' => $Result_List['item_attr'][$ii][$jj]['end_page'],
+                            'date_of_issued' => $Result_List['item_attr'][$ii][$jj]['date_of_issued'],
+                            'year' =>$date[0], 
+                            'month' =>$date[1],
+                            'day' =>$date[2]
+                        );
+                        array_push($edit_attr, $biblio_init);
+                    }
+                    // Add biblio info 2008/08/11 Y.Nakao --end--
+                    
+                    // Add item attribute:date 2008/10/14 A.Suzuki --start--
+                    // 日付：年月日の初期値をセット
+                    else if( $item_element[$ii]['input_type'] == "date" ) {
+                        $date = explode("-", $Result_List['item_attr'][$ii][$jj]['attribute_value']);
+                        if(count($date) == 2){
+                            array_push($date, "");
+                        } else if(count($date) == 1){
+                            array_push($date, "");
+                            array_push($date, "");
+                        }
+
+                        if(strlen($date[1]) == 2){
+                            $temp_month = str_split($date[1]);
+                            if($temp_month[0] == "0"){
+                                $date[1] = $temp_month[1];
+                            }
+                        }
+                        if(strlen($date[2]) == 2){
+                            $temp_day = str_split($date[2]);
+                            if($temp_day[0] == "0"){
+                                $date[2] = $temp_day[1];
+                            }
+                        }
+                        
+                        $date_init = array(
+                            'date' => $Result_List['item_attr'][$ii][$jj]['attribute_value'],
+                            'date_year' =>$date[0],
+                            'date_month' =>$date[1],
+                            'date_day' =>$date[2],
+                        );
+                        array_push($edit_attr, $date_init);
+                    }
+                    // Add item attribute:date 2008/10/14 A.Suzuki --end--
+                    
+                    // ファイル : エンバーゴ、ライセンスなどセット
+                    else if( $item_element[$ii]['input_type'] == "file" || 
+                        $item_element[$ii]['input_type'] == "file_price") { // Add file price Y.Nakao 2008/08/28
+                        // upload情報を作成
+                        $upload = array(
+                            'file_name' => $Result_List['item_attr'][$ii][$jj]['file_name'],
+                            'mimetype' => $Result_List['item_attr'][$ii][$jj]['mime_type'],
+                            'extension' => $Result_List['item_attr'][$ii][$jj]['extension']
+                        );
+                        // 2008/03/21 エンバーゴフラグ設定
+                        // 既存編集の場合は既にファイルの公開日は一意に決まっているため、"オープンアクセス日を指定する"扱いとする
+                        // file情報作成
+                        if($item_element[$ii]['input_type'] == "file"){
+                            // Add file author 2015/03/20 T.Ichikawa --start--
+                            // 権限初期値
+                            $auth_room_id = array();
+                            $auth_num = 0;
+                            // 権限情報を課金テーブルから取得する
+                            $query = "SELECT price FROM ". DATABASE_PREFIX. "repository_file_price ".
+                                     "WHERE item_id = ? ".
+                                     "AND item_no = ? ".
+                                     "AND attribute_id = ? ".
+                                     "AND file_no = ? ".
+                                     "AND is_delete = ? ;";
+                            $params = array();
+                            $params[] = $Result_List['item_attr'][$ii][$jj]['item_id'];
+                            $params[] = $Result_List['item_attr'][$ii][$jj]['item_no'];
+                            $params[] = $Result_List['item_attr'][$ii][$jj]['attribute_id'];
+                            $params[] = $Result_List['item_attr'][$ii][$jj]['file_no'];
+                            $params[] = 0;
+                            $result = $this->Db->execute($query, $params);
+                            if($result === false) {
+                                $error_msg = $this->Db->ErrorMsg();
+                                return 'error'; 
+                            }
+                            
+                            if(count($result) > 0) {
+                                // 権限が複数ある場合はパイプ区切りでレコードに入っている
+                                $room_auth = explode("|", $result[0]['price']);
+                                for($auth_cnt = 0; $auth_cnt < count($room_auth); $auth_cnt++) {
+                                    // "[ルームID],[価格]"の形式で設定されている（価格部分はいらない）
+                                    $auth = split(",", $room_auth[$auth_cnt]);
+                                    if(isset($auth) && count($auth) == 2) {
+                                        array_push($auth_room_id, $auth[0]);
+                                        $auth_num++;
+                                    }
+                                }
+                            }
+                            // Add file author 2015/03/20 T.Ichikawa --end--
+                            // ファイル情報格納
+                            $file_init = array(
+                                'upload' => $upload,
+                                'display_name' => $Result_List['item_attr'][$ii][$jj]['display_name'],
+                                'display_type' => $Result_List['item_attr'][$ii][$jj]['display_type'],
+                                'licence' => 'licence_free',
+                                'freeword' => '',
+                                'embargo_flag' => 2,    // オープンアクセス日を指定する
+                                'embargo_year' => '',
+                                'embargo_month' => '',
+                                'embargo_day' => '',
+                                'is_db_exist' => 1,     // DBにこのレコードが登録されている証
+                                // プライマリキー保存(削除用)
+                                'item_id' => $Result_List['item_attr'][$ii][$jj]['item_id'],
+                                'item_no' => $Result_List['item_attr'][$ii][$jj]['item_no'],
+                                'attribute_id' => $Result_List['item_attr'][$ii][$jj]['attribute_id'],
+                                'file_no' => $Result_List['item_attr'][$ii][$jj]['file_no'],
+                                'show_order' => $Result_List['item_attr'][$ii][$jj]['show_order'],
+                                'input_type' => 'file',
+                                'auth_room_id' => $auth_room_id,
+                                'auth_num' => $auth_num,
+                                'flash_embargo_flag' => 2,  // オープンアクセス日を指定する
+                                'flash_embargo_year' => '',
+                                'flash_embargo_month' => '',
+                                'flash_embargo_day' => ''
+                            );
+                        } else if($item_element[$ii]['input_type'] == "file_price"){
+                            // room_idとpriceを分解する
+                            // room_id,price|room_id,price|room_id,price|...で格納されている
+                            $room_price = explode("|",$Result_List['item_attr'][$ii][$jj]['price']);
+                            $price_num = 0;
+                            $price_value = array();
+                            $room_id = array();
+                            for($price_Cnt=0;$price_Cnt<count($room_price);$price_Cnt++){
+                                $price = split(",", $room_price[$price_Cnt]);
+                                // room_idと価格のペアがあり、価格が数字であるか判定
+                                if($price!=null && count($price)==2)
+                                {
+                                    array_push($room_id, $price[0]);
+                                    array_push($price_value, $price[1]);
+                                    $price_num++;
+                                }
+                            }
+                            // ファイル情報格納
+                            $file_init = array(
+                                'upload' => $upload,
+                                'display_name' => $Result_List['item_attr'][$ii][$jj]['display_name'],
+                                'display_type' => $Result_List['item_attr'][$ii][$jj]['display_type'],
+                                'licence' => 'licence_free',
+                                'freeword' => '',
+                                'embargo_flag' => 2,    // オープンアクセス日を指定する
+                                'embargo_year' => '',
+                                'embargo_month' => '',
+                                'embargo_day' => '',
+                                'is_db_exist' => 1,     // DBにこのレコードが登録されている証
+                                // プライマリキー保存(削除用)
+                                'item_id' => $Result_List['item_attr'][$ii][$jj]['item_id'],
+                                'item_no' => $Result_List['item_attr'][$ii][$jj]['item_no'],
+                                'attribute_id' => $Result_List['item_attr'][$ii][$jj]['attribute_id'],
+                                'file_no' => $Result_List['item_attr'][$ii][$jj]['file_no'],
+                                'show_order' => $Result_List['item_attr'][$ii][$jj]['show_order'],
+                                'input_type' => 'file_price',
+                                'room_id' => $room_id,
+                                'price_value' => $price_value,
+                                'price_num' => $price_num,
+                                'flash_embargo_flag' => 2,  // オープンアクセス日を指定する
+                                'flash_embargo_year' => '',
+                                'flash_embargo_month' => '',
+                                'flash_embargo_day' => ''
+                            );
+                        }
+                        // ライセンス設定
+                        if($Result_List['item_attr'][$ii][$jj]['license_id'] == 0) {
+                            $file_init['licence'] = 'licence_free';
+                            $file_init['freeword'] = $Result_List['item_attr'][$ii][$jj]['license_notation'];
+                            $file_init['license_id'] = '0';
+                            $file_init['license_notation'] = $file_init['freeword'];
+                        } else {
+                            // CreativeCommonsの場合, ライセンスIDの一致したライセンスマスタインデックス
+                            for ($kk = 0; $kk < count($license_master); $kk++) {
+                                if($license_master[$kk]['license_id'] == $Result_List['item_attr'][$ii][$jj]['license_id']) {
+                                    $file_init['licence'] = $kk;
+                                    $file_init['license_id'] = $license_master[$kk]['license_id'];
+                                    $file_init['license_notation'] = $license_master[$kk]['license_notation'];
+                                    break;
+                                }
+                            }
+                        }
+                        if($Result_List['item_attr'][$ii][$jj]['display_type'] == ''){
+                            $file_init['display_type'] = '0';
+                        }
+                        // エンバーゴ設定
+                        // XXXX-XX-XX 形式の日付を年月日に分解
+                        $year = '';
+                        $month = '';
+                        $day = '';
+                        // embargo date 2008/08/18 --start--
+                        // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --start--
+                        if(strlen($Result_List['item_attr'][$ii][$jj]['pub_date']) == 0)
+                        {
+                            $Result_List['item_attr'][$ii][$jj]['pub_date'] = $this->TransStartDate;
+                        }
+                        // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --end--
+                        $embargo = split(' ', $Result_List['item_attr'][$ii][$jj]['pub_date']); 
+                        $embargo = split('[/.-]', $embargo[0]);
+                        if(count($embargo) > 0) { $year = $embargo[0]; }
+                        if(count($embargo) > 1) { $month = $embargo[1]; }
+                        if(count($embargo) > 2) { $day = $embargo[2]; }
+                        $file_init['embargo_year'] = $year;
+                        $file_init['embargo_month'] = $month;
+                        $file_init['embargo_day'] = $day;
+                        // Add detail file license 2008/10/23 Y.Nakao --start--
+                        $now_date = explode( " ", $this->TransStartDate );
+                        $now_date_array = explode( "-", $now_date[0] );
+                        // Add detail file license 2008/10/23 Y.Nakao --end--
+                        // 会員のみの場合は"会員のみ"とする 2008/08/19 --start--
+                        if($year == "9999" && $month == "1" && $day == "1"){
+                            // 会員のみ
+                            $file_init['embargo_flag'] = 3;
+                            // 表示されるオープンアクセス日指定日時は表示日時
+                            $file_init['embargo_year'] = $item_pub_date["year"];
+                            $file_init['embargo_month'] = $item_pub_date["month"];
+                            $file_init['embargo_day'] = $item_pub_date["day"];
+                        }
+                        else if($year == "9999" && $month == "12" && $day == "31" && $Result_List['item_attr'][$ii][$jj]['display_type'] == 2){
+                            // Do not download file.
+                            $file_init['embargo_flag'] = 4;
+                            // 表示されるオープンアクセス日指定日時は表示日時
+                            $file_init['embargo_year'] = $item_pub_date["year"];
+                            $file_init['embargo_month'] = $item_pub_date["month"];
+                            $file_init['embargo_day'] = $item_pub_date["day"];
+                        }
+                        // Modify file, flash immovable. Y.Nakao 2012/02/13 --start--
+                        else {
+                            $file_init['embargo_flag'] = 2;
+                        }
+                        
+                        // Modify file, flash immovable. Y.Nakao 2012/02/13 --end--
+                        
+                        // Add flash embargo 2010/02/08 A.Suzuki --start--
+                        // フラッシュファイルエンバーゴ設定
+                        // XXXX-XX-XX 形式の日付を年月日に分解
+                        $year = '';
+                        $month = '';
+                        $day = '';
+                        // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --start--
+                        if(strlen($Result_List['item_attr'][$ii][$jj]['flash_pub_date']) == 0)
+                        {
+                            $Result_List['item_attr'][$ii][$jj]['flash_pub_date'] = $this->TransStartDate;
+                        }
+                        // Modify file, flash, item pubdate immovable. Y.Nakao 2012/02/13 --end--
+                        $flash_embargo = split(' ', $Result_List['item_attr'][$ii][$jj]['flash_pub_date']); 
+                        $flash_embargo = split('[/.-]', $flash_embargo[0]);             
+                        if(count($flash_embargo) > 0) { $year = $flash_embargo[0]; }
+                        if(count($flash_embargo) > 1) { $month = $flash_embargo[1]; }
+                        if(count($flash_embargo) > 2) { $day = $flash_embargo[2]; }
+                        $file_init['flash_embargo_year'] = $year;
+                        $file_init['flash_embargo_month'] = $month;
+                        $file_init['flash_embargo_day'] = $day;
+                        //$pub_time = mktime( 0, 0, 0, intval( $month ), intval( $day ), intval( $year ) );
+                        $diff = Date_Calc::compareDates(intval($now_date_array[2]),intval($now_date_array[1]),intval($now_date_array[0]),intval($day),intval($month),intval($year));
+                        if($year == "9999" && $month == "1" && $day == "1"){
+                            // 会員のみ
+                            $file_init['flash_embargo_flag'] = 3;
+                            // 表示されるオープンアクセス日指定日時は表示日時
+                            $file_init['flash_embargo_year'] = $item_pub_date["year"];
+                            $file_init['flash_embargo_month'] = $item_pub_date["month"];
+                            $file_init['flash_embargo_day'] = $item_pub_date["day"];
+                        }
+                        // Modify file, flash immovable. Y.Nakao 2012/02/13 --start--
+                        // when today after file's pub_date, this file is open access
+                        // get flash's pub date
+                        else
+                        {
+                            $file_init['flash_embargo_flag'] = 2;
+                        }
+                        // Modify file, flash immovable. Y.Nakao 2012/02/13 --start--
+                        // Add flash embargo 2010/02/08 A.Suzuki --start--
+                        
+                        // 会員のみの場合は"会員のみ"とする 2008/08/19 --end--
+                        array_push($edit_attr, $file_init);
+                    }
+                    // サムネイル : null = 未登録
+                    else if( $item_element[$ii]['input_type'] == "thumbnail" ) {
+                        // file情報作成
+                        $file_init = array(
+                            'upload' => array(
+                                'file_name' => $Result_List['item_attr'][$ii][$jj]['file_name'],
+                                'mimetype' => $Result_List['item_attr'][$ii][$jj]['mime_type'],
+                                'extension' => $Result_List['item_attr'][$ii][$jj]['extension']
+                            ),
+                            'is_db_exist' => 1,     // DBにこのレコードが登録されている証
+                            // プライマリキー保存(削除用)
+                            'item_id' => $Result_List['item_attr'][$ii][$jj]['item_id'],
+                            'item_no' => $Result_List['item_attr'][$ii][$jj]['item_no'],
+                            'attribute_id' => $Result_List['item_attr'][$ii][$jj]['attribute_id'],
+                            'file_no' => $Result_List['item_attr'][$ii][$jj]['file_no'],
+                            'show_order' => $Result_List['item_attr'][$ii][$jj]['show_order'],
+                            'input_type' => 'thumbnail'
+                        );                      
+                        array_push($edit_attr, $file_init);
+                    }
+                    // BugFix add when input type is supple T.Koyasu 2014/09/16 --start--
+                    // サプリメンタルコンテンツ(PHP Notice対応)
+                    else if( $item_element[$ii]['input_type'] == "supple"){
+                        // アイテム編集時には特に修正の必要なし
+                    }
+                    // BugFix add when input type is supple T.Koyasu 2014/09/16 --end--
+                    // その他テキスト系
+                    else {
+                        array_push($edit_attr, $Result_List['item_attr'][$ii][$jj]['attribute_value']);                         
+                    }
+                }
+                // 初期属性の再セット
+                $item_attr[$ii] = $edit_attr;
+                $item_num_attr[$ii] = count($edit_attr);
+            }
+            // 登録INDEXと表示インデックスが異なる不具合対応 2008/07/02 Y.Nakao --start-- 
+            $indice = $Result_List['position_index'];
+            
+            // change index tree 2008/12/03 Y.Nakao --start--
+            for($ii=0; $ii<count($indice); $ii++){  
+                $query = "SELECT index_name, index_name_english FROM ".DATABASE_PREFIX."repository_index ".
+                         "WHERE index_id = ".$indice[$ii]["index_id"].";";
+                $ret = $this->Db->execute($query);
+                if($ret === false || count($ret)!=1){
+                    $tmpErrorMsg = "Select index error.";
+                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($tmpErrorMsg);
+                    $exception->addError($tmpErrorMsg);
+                    throw $exception;
+                }
+                if($this->Session->getParameter("_lang") == "japanese"){
+                    $indice[$ii]["index_name"] = $ret[0]["index_name"];
+                } else {
+                    $indice[$ii]["index_name"] = $ret[0]["index_name_english"];
+                }
+            }
+            // change index tree 2008/12/03 Y.Nakao --end--
+            
+            // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --start--
+            $indice = $this->addPrivateTreeInPositionIndex($indice, $insUserId);
+            // Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/21 --end--
+            
+            // 登録INDEXと表示インデックスが異なる不具合対応 2008/07/02 Y.Nakao --end--
+            // リンクの読み込み(リンク先のアイテムID, アイテムNo, タイトルを保存・・・いや全部持っておけばいいか)
+            $link = array();
+            for ($ii = 0; $ii < count($Result_List['reference']); $ii++) {
+                // リンク先アイテム情報取得
+                $dest_item = array();
+                $result = $this->getItemTableData(
+                                $Result_List['reference'][$ii]['dest_reference_item_id'],
+                                $Result_List['reference'][$ii]['dest_reference_item_no'],
+                                $dest_item, $Error_Msg);
+                if($result === false){
+                    $tmpErrorMsg = $Error_Msg;
+                    $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                    $exception = new AppException($tmpErrorMsg);
+                    $exception->addError($tmpErrorMsg);
+                    throw $exception;
+                }                   
+                // リンク先アイテムレコード+αを保存
+                if( count($dest_item['item']) > 0) {
+                    // リンク先アイテムのアイテムタイプを取得
+                    $query = "SELECT * ".
+                             "FROM ". DATABASE_PREFIX ."repository_item_type ".     // アイテムタイプ
+                             "WHERE item_type_id = ? AND ".
+                             "is_delete = ?; ";         // 削除フラグ
+                    $params = null;
+                    $params[] = $dest_item['item'][0]['item_type_id'];
+                    $params[] = 0;
+                    // SELECT実行
+                    $dest_item_type = $this->Db->execute($query, $params);
+                    if($dest_item_type === false){
+                        $tmpErrorMsg = $this->Db->ErrorMsg();
+                        $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+                        $exception = new AppException($tmpErrorMsg);
+                        $exception->addError($tmpErrorMsg);
+                        throw $exception;
+                    }
+                    $dest_item['item'][0]['item_type_name'] = $dest_item_type[0]['item_type_name'];
+                    $dest_item['item'][0]['relation'] = $Result_List['reference'][$ii]['reference'];
+                    array_push($link , $dest_item['item'][0]);
+                }
+            }
+        }
+        
+        // アイテム属性数／アイテム属性をセッションに保存
+        $this->Session->setParameter("isfile",$isfile);
+        $this->Session->setParameter("item_num_attr",$item_num_attr);
+        $this->Session->setParameter("item_attr",$item_attr);
+        $this->Session->setParameter("base_attr",$base_attr);
+        $this->Session->setParameter("item_pub_date",$item_pub_date);
+        $this->Session->setParameter("item_keyword",$item_keyword);
+        $this->Session->setParameter("item_keyword_english",$item_keyword_english);
+        $this->Session->setParameter("indice",$indice);
+        $this->Session->setParameter("link",$link);
+        $this->Session->setParameter("item_contributor", $item_contributor);
+        
+        // DOI付与可能フラグ
+        $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
+        $doi_itemtype_flag = false;
+        if($CheckDoi->checkDoiGrantItemtype($this->itemtype_id, Repository_Components_Checkdoi::TYPE_JALC_DOI) || 
+           $CheckDoi->checkDoiGrantItemtype($this->itemtype_id, Repository_Components_Checkdoi::TYPE_CROSS_REF) ||
+           $CheckDoi->checkDoiGrantItemtype($this->itemtype_id, Repository_Components_Checkdoi::TYPE_LIBRARY_JALC_DOI) ||
+           $CheckDoi->checkDoiGrantItemtype($this->itemtype_id, Repository_Components_Checkdoi::TYPE_DATACITE) ||
+           $CheckDoi->getDoiStatus($this->item_id, $this->item_no) >= 1)
+        {
+            $doi_itemtype_flag = true;
+        }
+        $this->Session->setParameter("doi_itemtype_flag", $doi_itemtype_flag);
+        
+        // ファイル属性が無ければメタデータ登録画面に遷移
+        if ($isfile==0) {
+            $this->Session->setParameter("attr_file_flg", 0);
+        } else {
+            $this->Session->setParameter("attr_file_flg", 1);
+        }
+        
+        // 指定遷移先へ遷移可能かチェック＆遷移先の決定
+        $this->infoLog("Get instance: businessItemedittranscheck", __FILE__, __CLASS__, __LINE__);
+        $transCheck = BusinessFactory::getFactory()->getBusiness("businessItemedittranscheck");
+        $transCheck->setData(   "selecttype",
+                                $this->save_mode,
+                                $this->Session->getParameter("isfile"),
+                                $this->Session->getParameter("doi_itemtype_flag"),
+                                $this->Session->getParameter("base_attr"),
+                                $this->Session->getParameter("item_pub_date"),
+                                $this->Session->getParameter("item_attr_type"),
+                                $this->Session->getParameter("item_attr"),
+                                $this->Session->getParameter("item_num_attr"),
+                                $this->Session->getParameter("indice"),
+                                $this->Session->getParameter("edit_item_id"),
+                                $this->Session->getParameter("edit_item_no")
+                            );
+        $ret = $transCheck->getDestination();
+        foreach($transCheck->getErrorMsg() as $msg){
+            $this->addErrMsg($msg);
+        }
+        $this->warningMsg = array_merge($this->warningMsg, $transCheck->getWarningMsg());
+        
+        // warningをViewに渡す処理
+        if(count($this->warningMsg) > 0){
+            $container =& DIContainerFactory::getContainer();
+            $request =& $container->getComponent("Request");
+            $request->setParameter("warningMsg", $this->warningMsg);
+        }
+        
+        return $ret;
+    }
+    
+    /**
+     * set redirect screen
+     *
+     * @param $item_id
+     * @param $item_no
+     * @access  private
+     */
+    private function setRedirectScreen($item_id, $item_no){
+        if($this->Session->getParameter("return_screen") != null){
+            // 詳細画面を表示させるための設定
+            $this->Session->setParameter("item_id_for_detail", $item_id);
+            $this->Session->setParameter("item_no_for_detail", $item_no);
+            $this->Session->setParameter("search_flg","true");
+            if($this->Session->getParameter("return_screen") === "1"){
+                $this->Session->removeParameter("return_screen");
+                // ワークフロー画面でないことを示すフラグ
+                $this->Session->setParameter("workflow_flg", "false");
+                // 画面右に詳細表示を表示させるフラグ
+                $this->Session->setParameter("serach_screen", "1");
+                $this->Session->setParameter("redirect_flg", "detail");
+                $this->Session->setParameter("redirect_item_id", $item_id);
+            } else if($this->Session->getParameter("return_screen") === "2"){
+                $this->Session->removeParameter("return_screen");
+                // ワークフロー画面であることを示すフラグ
+                $this->Session->setParameter("workflow_flg", "true");
+                $this->Session->setParameter("redirect_flg", "workflow");
+            }
+        } else {
+            $this->Session->setParameter("redirect_flg", "selecttype");
+        }
+    }
+    
+    /**
+     * get Feedback author
+     *
+     * @param $item_id
+     * @param $item_no
+     * @return  array
+     */
+    private function getFeedbackAuthor($itemId, $itemNo)
+    {
+            // get author id
+        $query = "SELECT author_id " .
+                 "FROM ". DATABASE_PREFIX ."repository_send_feedbackmail_author_id " .
+                 "WHERE item_id = ? " .
+                 "AND item_no = ? " .
+                 "order by author_id_no ;";
+        $params = array();
+        $params[] = $itemId;
+        $params[] = $itemNo;
+        // Run query
+        $result_get_author = $this->dbAccess->executeQuery( $query, $params );
+        
+        // get mail address
+        $query = "SELECT AUTHOR.name, AUTHOR.family, SUFFIX.suffix " .
+                 "FROM ". DATABASE_PREFIX ."repository_external_author_id_suffix AS SUFFIX " .
+                 "INNER JOIN ". DATABASE_PREFIX ."repository_name_authority AS AUTHOR ".
+                 "ON SUFFIX.author_id = AUTHOR.author_id ".
+                 "WHERE SUFFIX.prefix_id = 0 " .
+                 "AND SUFFIX.author_id IN ( " ;
+        $params = array();
+        for($ii = 0; $ii < count($result_get_author); $ii++) {
+            $params[] = $result_get_author[$ii]["author_id"];
+            if($ii == 0) {
+                $query .= "?";
+            }
+            else
+            {
+                $query .= ", ?";
+            }
+        }
+        $query .= " ) AND SUFFIX.is_delete = 0 ".
+                  "AND AUTHOR.is_delete = 0 ;";
+        // Run query
+        $result = array();
+        if(count($result_get_author) > 0) {
+            $result = $this->dbAccess->executeQuery( $query, $params );
+        }
+        return $result;
+    }
+    
     /**
-     * [[機能説明]]
+     * set Session Feedback author
      *
-     * @access  public
+     * @param $authorData
      */
-    function execute()
+    private function setFeedbackAuthor($authorData)
     {
-    	//セッションの初期化
-    	$this->session->removeParameter("item_type_all");
-    	$this->session->removeParameter("item_attr_type");
-    	$this->session->removeParameter("item_num_cand");
-    	$this->session->removeParameter("option_data");
-    	$this->session->removeParameter("item_num_attr");
-    	$this->session->removeParameter("item_attr");
-    	$this->session->removeParameter("base_attr");
-    	$this->session->removeParameter("error_msg");  	
-    	
-    	$this->Session->removeParameter("all_group"); // 2008/08/12
-    	$this->Session->removeParameter("user_group"); // 2008/08/12
-    	
-    	// change index tree 2008/12/03 Y.Nakao --start--
-    	$this->Session->removeParameter("view_open_node_index_id_insert_item");
-    	$this->Session->removeParameter("view_open_node_index_id_item_link");
-    	// change index tree 2008/12/03 Y.Nakao --end--
-    	
-        return 'success';
+        $feedback_author_str = "";
+        $feedback_mail_address_str = "";
+        $feedback_mail_author_array = array();
+        $feedback_mail_array = array();
+        for($cnt = 0; $cnt < count($authorData); $cnt++)
+        {
+            if($cnt > 0)
+            {
+                $feedback_author_str .= ",";
+                $feedback_mail_address_str .= ",";
+            }
+            $feedback_author_str .= $authorData[$cnt]["name"]. " " .$authorData[$cnt]["family"]. " " .$authorData[$cnt]["suffix"];
+            $feedback_mail_address_str .= $authorData[$cnt]["suffix"];
+            $feedback_mail_author_array[$cnt] = $authorData[$cnt]["name"]. " " .$authorData[$cnt]["family"]. " " .$authorData[$cnt]["suffix"];
+            $feedback_mail_array[$cnt] = $authorData[$cnt]["suffix"];
+        }
+        $this->Session->setParameter("feedback_mailaddress_str", $feedback_mail_address_str);
+        $this->Session->setParameter("feedback_mailaddress_author_str", $feedback_author_str);
+        $this->Session->setParameter("feedback_mailaddress_array", $feedback_mail_array);
+        $this->Session->setParameter("feedback_mailaddress_author_array", $feedback_mail_author_array);
+        
+        return true;
     }
 }
 ?>
diff --git a/repository/action/main/item/selecttype/maple.ini b/repository/action/main/item/selecttype/maple.ini
index 06151c5..3bd0112 100644
--- a/repository/action/main/item/selecttype/maple.ini
+++ b/repository/action/main/item/selecttype/maple.ini
@@ -1,8 +1,22 @@
-;[Convert]
-;*.trim =
+;直アクセス防止のためRequestCheckにはGETを指定しないこと
+[RequestCheck]
+request = POST
+
+[ValidateDef]
+authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
+itemtype_id
+return_screen
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
+Db = "ref:DbObject"
+usersView = "ref:usersView"
 
 [View]
-success = "action:repository_view_main_item_selecttype"
+selecttype = "action:repository_view_main_item_selecttype"
+files = "action:repository_view_main_item_editfiles"
+texts = "action:repository_view_main_item_edittexts"
+links = "action:repository_view_main_item_editlinks"
+doi = "action:repository_view_main_item_editdoi"
+confirm = "action:repository_view_main_item_confirm"
+error = "action:repository_view_main_item_selecttype"
\ No newline at end of file
diff --git a/repository/action/main/item/setprice/Setprice.class.php b/repository/action/main/item/setprice/Setprice.class.php
index e61dec5..c0769c3 100644
--- a/repository/action/main/item/setprice/Setprice.class.php
+++ b/repository/action/main/item/setprice/Setprice.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setprice.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Setprice.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -39,6 +39,10 @@ class Repository_Action_Main_Item_Setprice extends RepositoryAction
 	var $target_row = null;				// 削除対象
 	// Add file price Y.Nakao 2008/08/28 --end--
 	
+    // Add file authority T.Ichikawa 2015/03/20 --start--
+    var $auth_room_ids = null;
+    // Add file authority T.Ichikawa 2015/03/20 --end--
+	
 	// Extend file type A.Suzuki 2010/02/04 --start--
 	var $display_type = null;
 	var $display_name = null;
@@ -47,7 +51,7 @@ class Repository_Action_Main_Item_Setprice extends RepositoryAction
 	var $flash_embargo_day = null;			// フラッシュファイルエンバーゴ日
 	var $flash_embargo_flag = null;			// フラッシュファイルエンバーゴフラグ(0:公開日をアイテム公開日に合わせる, 1:公開日を独自に設定する)
 	// Extend file type A.Suzuki 2010/02/04 --end--
-
+    
     /**
      * action/main/item/edittextから流用
      *
@@ -81,10 +85,11 @@ class Repository_Action_Main_Item_Setprice extends RepositoryAction
 	    	$cntUpd = 0;			// アップロード済みアイテムカウンタ
 	    	// 価格用リクエストパラメタのカウンタ
 	   		$price_Cnt = 0;
+            // ファイル権限リクエストパラメタ用のカウンタ
+            $auth_Cnt = 0;
 	   		
 	   		// エラーメッセージ配列
 	   		$err_msg = array();
-	   		
 		   	// ii-thメタデータのリクエストを保存
 		   	for($ii=0; $ii<count($item_attr_type); $ii++) {
 		   		// ii-thメタデータのjj-th属性値のリクエストを保存
@@ -135,6 +140,87 @@ class Repository_Action_Main_Item_Setprice extends RepositoryAction
 		   					$item_attr[$ii][$jj]['display_type'] = 0;
 		   				}
 		   				// Extend file type A.Suzuki 2009/12/15 --end--
+                        // Add file authority 2015/03/20 T.Ichikawa --start--
+                        if($item_attr_type[$ii]['input_type']=='file'){
+                            // 初期化
+                            $auth_array = array();
+                            $auth_room_id_array = array();
+                            // 個数保持
+                            $loop_num = $item_attr[$ii][$jj]['auth_num'];
+                            // 削除対象の位置を取得する
+                            if($this->setting_flg == "2"){
+                            	$del_row = split("_", $this->target_row);
+                            }
+                            // 設定されている権限情報を格納する
+                            for($auth_num = 0; $auth_num < $loop_num; $auth_num++){
+                                if($this->setting_flg == "2"){
+                                    // 削除対象かどうか判定
+                                    if($ii==$del_row[0] && $jj==$del_row[1] && $auth_num==$del_row[2]){
+                                        // 削除対象のため設定されている権限の数を-1し、ルームIDなどは保持しない
+                                        if($item_attr[$ii][$jj]['auth_num'] > 0){
+                                            $item_attr[$ii][$jj]['auth_num'] = $item_attr[$ii][$jj]['auth_num'] - 1;
+                                        }
+                                        // カウンタを次へ
+                                        $auth_Cnt++;
+                                        continue;
+                                    }
+                                }
+                                // 権限情報を保持する
+                                array_push($auth_room_id_array, $this->auth_room_ids[$auth_Cnt]);
+                                // カウンタを次へ
+                                $auth_Cnt++;
+                            }
+                            
+                            // 権限情報が追加された時
+                            if($this->setting_flg == "1"){
+                                $add_row = split("_", $this->target_row);
+                                if($ii==$add_row[0] && $jj==$add_row[1]){
+                                    // 全グループ取得
+                                    $all_group = $this->Session->getParameter("all_group");
+                                    // 非会員の情報を先頭に追加
+                                    array_unshift($all_group,array("room_id" => 0));
+                                    // 権限が設定されていないグループを検索し、あれば権限設定用の行を追加する
+                                    for($group_cnt=0;$group_cnt<count($all_group);$group_cnt++){
+                                        // 価格が設定済みのグループかどうかを判定する
+                                        $set_flg = false;
+                                        for($auth_num = 0; $auth_num < count($auth_room_id_array); $auth_num++){
+                                            if($all_group[$group_cnt]["room_id"] == $auth_room_id_array[$auth_num]){
+                                                // 全てのグループのうち、現在権限が設定されているグループである
+                                                $set_flg = true;
+                                            }
+                                        }
+                                        if( !$set_flg ){
+                                            array_push($auth_room_id_array, $all_group[$group_cnt]["room_id"]);
+                                            // 個数+1
+                                            $item_attr[$ii][$jj]['auth_num'] = $item_attr[$ii][$jj]['auth_num'] + 1;
+                                            break;
+                                        }
+                                    }
+                                }
+                            }
+                            $item_attr[$ii][$jj]['auth_room_id'] = $auth_room_id_array;
+                            // 権限情報が削除された時
+                            if($this->setting_flg == "2"){
+                                // 一度権限情報を削除する
+                                $params = array();
+                                $params[] = $item_attr[$ii][$jj]["file_no"];          // ファイルNo
+                                $params[] = "0,0";                                    // 価格
+                                $params[] = $this->Session->getParameter("_user_id"); // 更新者
+                                $params[] = $this->TransStartDate;                    // 更新日
+                                $params[] = 1;                                        // 削除フラグ
+                                $params[] = $item_attr[$ii][$jj]["item_id"];          // アイテムID
+                                $params[] = $item_attr[$ii][$jj]["item_no"];          // アイテムNo
+                                $params[] = $item_attr[$ii][$jj]["attribute_id"];     // アイテム属性ID
+                                $params[] = $item_attr[$ii][$jj]["file_no"];          // ファイルNo
+                                $result = $this->updateFilePrice($params, $error);
+                                if($result === false) {
+                                    array_push($err_msg, $error);
+                                    $this->Session->setParameter("error_msg", $err_msg);
+                                    return 'error';
+                                }
+                            }
+                        }
+                        // Add file authority 2015/03/20 T.Ichikawa --end--
 		   				// Add file price Y.Nakao 2008/08/28 --start--
 		   				if($item_attr_type[$ii]['input_type']=='file_price'){
 		   					// 初期化
diff --git a/repository/action/main/item/supple/Supple.class.php b/repository/action/main/item/supple/Supple.class.php
index d169199..1c1ca37 100644
--- a/repository/action/main/item/supple/Supple.class.php
+++ b/repository/action/main/item/supple/Supple.class.php
@@ -1,9 +1,9 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Supple.class.php 377 2009-10-15 04:30:23Z ivis $
+// $Id: Supple.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
-// Copyright (c) 2007 - 2008, National Institute of Informatics, 
+// Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
 //
 // This program is licensed under a Creative Commons BSD Licence
@@ -12,393 +12,114 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR.'/modules/repository/components/common/WekoAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
 
 /**
  * サプリアイテム既存登録＆削除用アクション
  *
- * @package     [[package名]]
- * @access      public
+ @author IVIS
  */
-class Repository_Action_Main_Item_Supple extends RepositoryAction
+class Repository_Action_Main_Item_Supple extends WekoAction
 {
 	// 使用コンポーネントを受け取るため
-	var $Session = null;
-	var $Db = null;
-	var $mailMain = null;
-	
+	/**
+	 * mailMainのコンポーネント
+	 * @var Mail_Main
+	 */
+	public $mailMain = null;
+
 	// リクエストパラメータ
-	var $item_id = null;
-	var $item_no = null;
-	var $mode = null;
-	var $weko_key = null;
-	var $supple_no = null;
-	var $workflow_flag = null;
-	var $workflow_active_tab = null;
-	
+	/**
+	 * アイテムID
+	 * @var number
+	 */
+	public $item_id = null;
+
+	/**
+	 * アイテムNo
+	 * @var number
+	 */
+	public $item_no = null;
+
+	/**
+	 * サプリコンテンツのモード(登録or削除)
+	 * @var string
+	 */
+	public $mode = null;
+
+	/**
+	 * サプリコンテンツURL
+	 * @var string
+	 */
+	public $weko_key = null;
+
+	/**
+	 * サプリNo
+	 * @var unknown
+	 */
+	public $supple_no = null;
+
+	/**
+	 * ワークフローフラグ
+	 * @var unknown
+	 */
+	public $workflow_flag = null;
+
+	/**
+	 * ワークフローアクティブタブ
+	 * @var string
+	 */
+	public $workflow_active_tab = null;
+
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * 1.既存登録ボタン押下の場合
+     * 1-1.サプリコンテンツの登録を行う
+     * 2.削除ボタン押下の場合
+     * 2-2.サプリコンテンツの削除を行う
+     * @see ActionBase::executeApp()
      */
-    function execute()
+    protected function executeApp()
     {
-        try {
-	        //アクション初期化処理
-	        $result = $this->initAction();
-	        
-	        if ( $result === false ) {
-	            $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-	            $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-        	}
-        	
+        // Update suppleContentsEntry Y.Yamazawa --start-- 2015/03/17 --start--
+        try{
+            // デコード
+            $this->weko_key = rawurldecode($this->weko_key);// Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/23 --start--
+
         	// サプリアクションからの遷移を示すフラグ
             $this->Session->setParameter("supple_flag", "true");
-            
-            // ユーザID取得
-            $user_id = $this->Session->getParameter("_user_id");
-        	
-        	// 既存サプリアイテム登録
+
+            $this->infoLog("businessSupple", __FILE__, __CLASS__, __LINE__);
+            $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
         	if($this->mode == "add_existing"){
-        		// IDサーバのアドレスを取得
-        		$query = "SELECT param_value ".
-        				 "FROM ".DATABASE_PREFIX."repository_parameter ".
-        				 "WHERE param_name = 'IDServer';";
-        		$result = $this->Db->execute($query);
-        		if($result === false){
-                	return "error";
-                }
-                $id_server = $result[0]['param_value'];
-                
-                // サプリWEKOのPrefixIDを取得
-                $prefix_id = $this->getSupplePrefixIDFromOpenSearch();
-                if($prefix_id === false){
-                	return "error";
-                } else if($prefix_id == "") {
-                	// no url error
-					$this->Session->setParameter("supple_error", 2);
-					return "error";
-                }
-        		
-        		// 入力値精査
-        		$this->weko_key = str_replace(" ", "", $this->weko_key);
-        		// パーマリンク用アドレス入力の場合
-        		if(ereg($id_server.$prefix_id, $this->weko_key)){
-        			// 入力されたアドレスからsuffixを取得
-        			$this->weko_key = str_replace("Permalink:", "", $this->weko_key);
-        			$this->weko_key = str_replace($id_server.$prefix_id, "", $this->weko_key);
-        			$this->weko_key = str_replace("/", "", $this->weko_key);
-        		}
-        		// "Prefix/Suffix"形式で入力の場合
-        		else if(ereg($prefix_id."/[0-9]{8}", $this->weko_key)){
-        			// 入力値からsuffixを取得
-        			$this->weko_key = str_replace($prefix_id, "", $this->weko_key);
-        			$this->weko_key = str_replace("/", "", $this->weko_key);
-        		}
-        		// その他: "Suffix"のみでの入力の場合
-        		else {
-        			$this->weko_key = str_replace("/", "", $this->weko_key);
-        		}
-        		
-        		// 整数に整形
-        		$this->weko_key = (int)$this->weko_key;
-        		
-	        	if($this->weko_key != "" && $this->weko_key != null){
-					// 0詰めの8桁に揃える ex)673 -> 00000673
-					if($this->weko_key != 0){
-						if(strlen($this->weko_key) <= 8){
-							$this->weko_key = sprintf("%08d", $this->weko_key);
-						} else {
-							// 不正な値
-							$this->weko_key = 0;
-						}
-					}
-				}
-        		
-        		$supple_data = array();
-                $supple_data = $this->getSuppleDataFromOpenSearch("weko_id", $this->weko_key);
-                if($supple_data === false){
-                	return "error";
-                }
-				
-				// 該当サプリアイテムなし
-				if(count($supple_data) == 0){
-					// no item error
-					$this->Session->setParameter("supple_error", 3);
-					return "error";
-				}
-				
-				// アイテムタイプ情報を取得
-				$query = "SELECT attr_type.item_type_id, attr_type.attribute_id, item.uri, item.title, item.title_english ".
-						 "FROM ".DATABASE_PREFIX."repository_item_attr_type AS attr_type, ".DATABASE_PREFIX."repository_item AS item ".
-						 "WHERE item.item_id = ? ".
-						 "AND item.item_no = ? ".
-						 "AND item.item_type_id = attr_type.item_type_id ".
-						 "AND attr_type.input_type = 'supple' ".
-						 "AND item.is_delete = 0 ".
-						 "AND attr_type.is_delete = 0;";
-				$params = array();
-				$params[] = $this->item_id;	// item_id
-				$params[] = $this->item_no;	// item_no
-				$item_type_result = $this->Db->execute($query, $params);
-				if($item_type_result === false){
-					return "error";
-				}
-				
-				// サプリテーブルを検索
-	        	$query = "SELECT MAX(supple_no) FROM ".DATABASE_PREFIX."repository_supple ".
-	        			 "WHERE item_id = ? ".
-	        			 "AND item_no = ? ".
-	        			 "AND attribute_id = ? ".
-	        			 "AND item_type_id = ?;";
-	        	$params = array();
-				$params[] = $this->item_id;	// item_id
-				$params[] = $this->item_no;	// item_no
-				$params[] = $item_type_result[0]['attribute_id'];	// attribute_id
-				$params[] = $item_type_result[0]['item_type_id'];	// item_type_id
-				$result = $this->Db->execute($query, $params);
-				if($result === false){
-					return "error";
-				}
-	        	
-				if($result[0]['MAX(supple_no)'] == null){
-					$supple_num = 1;
-				} else {
-					$supple_num = $result[0]['MAX(supple_no)'] + 1;
-				}
-				
-				// 新規査読アイテム登録メール送信処理
-				// 査読通知メールを送るか否か
-	    	    $query = "SELECT param_value ".
-						 "FROM ".DATABASE_PREFIX."repository_parameter ".
-						 "WHERE param_name = 'review_mail_flg';";
-				$result = $this->Db->execute($query);
-				if ($result === false) {
-					array_push($error_msg, $this->Db->ErrorMsg());
-					// roll back
-					$this->failTrans();
-					return 'error';
-				}
-				$review_mail_flg = $result[0]['param_value'];
-				
-				// サプリコンテンツの査読を行うか否か
-        		$query = "SELECT param_value ".
-        				 "FROM ".DATABASE_PREFIX."repository_parameter ".
-        				 "WHERE param_name = 'review_flg_supple';";
-        		$result = $this->Db->execute($query);
-        		if($result === false){
-                	return "error";
-                }
-                $review_flg_supple = $result[0]['param_value'];
-				
-				// サプリアイテム登録
-				$query = "INSERT INTO ". DATABASE_PREFIX ."repository_supple ".
-						 "(item_id, item_no, attribute_id, supple_no, ".
-						 " item_type_id, supple_weko_item_id, supple_title, supple_title_en,".
-						 " uri, supple_item_type_name, mime_type, file_id, supple_review_status,".
-						 " supple_review_date, ins_user_id, mod_user_id, ins_date, mod_date, del_date, is_delete) ".
-						 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);";
-	        	$params = array();
-				$params[] = $this->item_id;	// item_id
-				$params[] = $this->item_no;	// item_no
-				$params[] = $item_type_result[0]['attribute_id'];	// attribute_id
-				$params[] = $supple_num;		// supple_no
-				$params[] = $item_type_result[0]['item_type_id'];	// item_type_id
-				$params[] = $supple_data["supple_weko_item_id"];	// supple_weko_item_id
-				$params[] = $supple_data["supple_title"];	// supple_title
-				$params[] = $supple_data["supple_title_en"];	// supple_title_en
-				$params[] = $supple_data["uri"];	// uri
-				$params[] = $supple_data["supple_item_type_name"];	// supple_item_type_name
-				$params[] = $supple_data["mime_type"];	// mime_type
-				$params[] = $supple_data["file_id"];	// file_id
-				if($review_flg_supple == 1){
-					// 査読を行う
-					$params[] = 0;	// supple_review_status
-					$params[] = "";	// supple_review_date
-				} else {
-					// 査読を行わない（自動的に承認する）
-					$params[] = 1;	// supple_review_status
-					$params[] = $this->TransStartDate;	// supple_review_date
-				}
-				$params[] = $user_id;	// ins_user_id
-				$params[] = $user_id;	// mod_user_id
-				$params[] = $this->TransStartDate;	// ins_date
-				$params[] = $this->TransStartDate;	// mod_date
-				$params[] = null;	// del_date
-				$params[] = 0;	// is_delete
-				$result = $this->Db->execute($query, $params);
-				if($result === false){
-					return "error";
-				}
-				
-	        	// 新規査読サプリコンテンツ登録メール送信処理
-				if($review_flg_supple == 1){
-					// 査読を行う
-					if($review_mail_flg == 1){
-						// 言語リソース取得
-						$smartyAssign = $this->Session->getParameter("smartyAssign");
-						// send review mail
-						// 査読通知メールを送信する
-						// 件名
-						// set subject
-						$subj = $smartyAssign->getLang("repository_mail_review_subject");
-						$this->mailMain->setSubject($subj);
-						
-						// page_idおよびblock_idを取得
-						$block_info = $this->getBlockPageId();
-						// メール本文をリソースから読み込む
-						// set Mail body
-						$body = '';
-						$body .= $smartyAssign->getLang("repository_mail_review_body")."\n\n";
-						$body .= $smartyAssign->getLang("repository_mail_review_suppple_contents")."\n";
-						$body .= $smartyAssign->getLang("repository_mail_review_supple_title");
-						if($this->Session->getParameter("_lang") == "japanese"){
-							if($supple_data["supple_title"] != ""){
-								$body .= $supple_data["supple_title"];
-							} else if($supple_data["supple_title_en"] != ""){
-								$body .= $supple_data["supple_title_en"];
-							} else {
-								$body .= "no title";
-							}
-						} else {
-							if($supple_data["supple_title_en"] != ""){
-								$body .= $supple_data["supple_title_en"];
-							} else if($supple_data["supple_title"] != ""){
-								$body .= $supple_data["supple_title"];
-							} else {
-								$body .= "no title";
-							}
-						}
-						
-						$body .= "\n";
-						$body .= $smartyAssign->getLang("repository_mail_review_supple_detailurl").$supple_data["uri"]."\n";
-						$body .= $smartyAssign->getLang("repository_mail_review_supple_title_is_registed");
-						if($this->Session->getParameter("_lang") == "japanese"){
-							if($item_type_result[0]['title'] != ""){
-								$body .= $item_type_result[0]['title'];
-							} else if($item_type_result[0]['title_english'] != ""){
-								$body .= $item_type_result[0]['title_english'];
-							} else {
-								$body .= "no title";
-							}
-						} else {
-							if($item_type_result[0]['title_english'] != ""){
-								$body .= $item_type_result[0]['title_english'];
-							} else if($item_type_result[0]['title'] != ""){
-								$body .= $item_type_result[0]['title'];
-							} else {
-								$body .= "no title";
-							}
-						}
-						$body .= "\n";
-						$body .= $smartyAssign->getLang("repository_mail_review_supple_detailurl_is_registed").$item_type_result[0]['uri']."\n";
-						$body .= "\n";
-						$body .= $smartyAssign->getLang("repository_mail_review_reviewurl")."\n";
-						$body .= BASE_URL;
-						if(substr(BASE_URL,-1,1) != "/"){
-							$body .= "/";
-						}
-						$body .= "?active_action=repository_view_edit_review&review_active_tab=1&page_id=".$block_info["page_id"]."&block_id=".$block_info["block_id"];
-						$body .= "\n\n".$smartyAssign->getLang("repository_mail_review_close");
-						$this->mailMain->setBody($body);
-						// ---------------------------------------------
-						// 送信メール情報取得
-						//   送信者のメールアドレス
-						//   送り主の名前
-						//   送信先ユーザを取得
-						// create mail body
-						//   get send from user mail address
-						//   get send from user name
-						//   get send to user
-						// ---------------------------------------------
-						$users = array();
-						$this->getReviewMailInfo($users);
-						// ---------------------------------------------
-						// 送信先を設定
-						// set send to user
-						// ---------------------------------------------
-						// 送信ユーザを設定
-						// $usersの中身
-						// $users["email"] : 送信先メールアドレス
-						// $user["handle"] : ハンドルネーム
-						//                   なければ空白が自動設定される
-						// $user["type"]   : type (html(email) or text(mobile_email))
-						//                   なければhtmlが自動設定される
-						// $user["lang_dirname"] : 言語
-						//                         なければ現在の選択言語が自動設定される
-						$this->mailMain->setToUsers($users);
-						
-						// ---------------------------------------------
-						// メール送信
-						// send confirm mail
-						// ---------------------------------------------
-						if(count($users) > 0){
-							// 送信者がいる場合は送信
-							$return = $this->mailMain->send();
-						}
-						 
-						// 言語リソース開放
-						$this->Session->removeParameter("smartyAssign");
-						
-					}
-				}
-        	}
-        	
-        	// サプリアイテム削除
-        	else if($this->mode == "delete"){
-        		$query = "UPDATE ".DATABASE_PREFIX."repository_supple ".
-        				 "SET mod_user_id = ?, del_user_id = ?, mod_date = ?, del_date = ?, is_delete = ? ".
-        				 "WHERE item_id = ? ".
-        				 "AND item_no = ? ".
-        				 "AND supple_no = ?;";
-        		$params = array();
-        		$params[] = $user_id;				// mod_user_id
-        		$params[] = $user_id;				// del_user_id
-        		$params[] = $this->TransStartDate;	// mod_date
-        		$params[] = $this->TransStartDate;	// del_date
-        		$params[] = 1;						// is_delete
-        		$params[] = $this->item_id;			// item_id
-        		$params[] = $this->item_no;			// item_no
-        		$params[] = $this->supple_no;		// supple_no
-        		
-        		$result = $this->Db->execute($query, $params);
-        		if($result === false){
-        			return "error";
-        		}
-        		if($this->workflow_flag == "true"){
-        			$this->Session->setParameter("supple_workflow_active_tab", $this->workflow_active_tab);
-        		}
+            	// 既存サプリアイテム登録
+    	        $businessSupple->entrySuppleContents($this->item_id,$this->item_no,$this->weko_key);
+
+        	}else if($this->mode == "delete"){
+        	    // サプリアイテム削除
+        	    $businessSupple->deleteSuppleContents($this->item_id,$this->item_no,$this->supple_no);
+        	    if($this->workflow_flag == "true"){
+        	        $this->Session->setParameter("supple_workflow_active_tab", $this->workflow_active_tab);
+        	    }
         	}
-        	
-        	//アクション終了処理
-			$result = $this->exitAction();     // トランザクションが成功していればCOMMITされる
-        	
-			if($this->workflow_flag == "true"){
+            
+            // TODO：検索テーブル再作成のビジネスロジックを作る
+            $searchTableProcessing = new RepositorySearchTableProcessing($this->Session, $this->Db);
+            $searchTableProcessing->updateSearchTableForItem($this->item_id, $this->item_no);
+            
+    		if($this->workflow_flag == "true"){
         		return "workflow";
         	} else {
-	    		return "success";
+        		return "success";
         	}
         }
-		catch ( RepositoryException $Exception) {
-    	    //エラーログ出力
-        	/*
-			logFile(
-	        	"SampleAction",					//クラス名
-	        	"execute",						//メソッド名
-	        	$Exception->getCode(),			//ログID
-	        	$Exception->getMessage(),		//主メッセージ
-	        	$Exception->getDetailMsg() );	//詳細メッセージ
-	        */
-        	//アクション終了処理
-      		$this->exitAction();                   //トランザクションが失敗していればROLLBACKされる
-      		        				
-	        //異常終了
-    	    return "error";
-		}
+        catch(AppException $e){
+            $msg = $e->getMessage();
+            $this->Session->setParameter("supple_error",$msg);
+            return "error";
+    	}
+        // Update suppleContentsEntry Y.Yamazawa --end-- 2015/03/17 --end--
     }
 }
 ?>
diff --git a/repository/action/main/item/supple/maple.ini b/repository/action/main/item/supple/maple.ini
index aed5a37..e6681f0 100644
--- a/repository/action/main/item/supple/maple.ini
+++ b/repository/action/main/item/supple/maple.ini
@@ -3,7 +3,7 @@
 request = POST
 
 [ValidateDef]
-authcheck = "1,_auth_id>=_AUTH_GENERAL:lang._invalid_auth"
+authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
 item_id.required ="1:lang._invalid_input"
 item_id.numeric ="1:lang._invalid_input"
 item_id.minvalue ="1, 1:lang._invalid_input"
@@ -12,9 +12,6 @@ item_no.numeric ="1:lang._invalid_input"
 item_no.range ="1, 1, 1:lang._invalid_input"
 mode.required ="1:lang._invalid_input"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
@@ -24,3 +21,4 @@ mailMain = "ref:mailMain"
 success = "action:repository_view_main_item_detail"
 error = "action:repository_view_main_item_detail"
 workflow = "action:repository_view_main_suppleworkflow"
+exception = "action:repository_view_main_item_detail"
diff --git a/repository/action/main/item/uploadfiles/Uploadfiles.class.php b/repository/action/main/item/uploadfiles/Uploadfiles.class.php
index 6064007..a4f4524 100644
--- a/repository/action/main/item/uploadfiles/Uploadfiles.class.php
+++ b/repository/action/main/item/uploadfiles/Uploadfiles.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Uploadfiles.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Uploadfiles.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,6 +12,7 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * [[機能説明]]
@@ -19,13 +20,10 @@
  * @package     [[package名]]
  * @access      public
  */
-class Repository_Action_Main_Item_Uploadfiles
+class Repository_Action_Main_Item_Uploadfiles extends RepositoryAction
 {	
 	// 使用コンポーネントを受け取るため
-	var $session = null;
-	var $db = null;
 	var $uploadsAction = null;
-//	var $upload = null;
 
 	// リクエスト
 	var $mode = null;	// mode 
@@ -37,7 +35,7 @@ class Repository_Action_Main_Item_Uploadfiles
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {	
 //   	return true;
 		//ガーベージフラグが"1"の場合、いつかファイル・DB共にクリアしてくれる。
@@ -45,8 +43,8 @@ class Repository_Action_Main_Item_Uploadfiles
 		
 		
 		if($this->mode == "drop"){
-			$item_num_attr = $this->session->getParameter("item_num_attr");			// 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
-			$item_attr = $this->session->getParameter("item_attr");					// 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～		
+			$item_num_attr = $this->Session->getParameter("item_num_attr");			// 5.アイテム属性数 (N): "item_num_attr"[N], N属性タイプごとの属性数-。複数可な属性タイプのみ>1の値をとる。
+			$item_attr = $this->Session->getParameter("item_attr");					// 6.アイテム属性 (N) : "item_attr"[N][L], N属性タイプごとの属性。Lはアイテム属性数に対応。1～		
 			
 			$idx = (int)($this->target);
 			$attridx = intval($item_num_attr[$idx])-1;
@@ -86,8 +84,8 @@ class Repository_Action_Main_Item_Uploadfiles
 			}
 			// target-thメタデータの属性数を増やす	
 			$item_num_attr[$idx] = $item_num_attr[$idx] + $this->drop_num;
-			$this->session->setParameter("item_num_attr", $item_num_attr);
-			$this->session->setParameter("item_attr", $item_attr);
+			$this->Session->setParameter("item_num_attr", $item_num_attr);
+			$this->Session->setParameter("item_attr", $item_attr);
 		}
 		$garbage_flag = 1;
 		//アップロードしたファイルの情報を取得する。
@@ -103,8 +101,8 @@ class Repository_Action_Main_Item_Uploadfiles
 		}
 		// Bug Fix null key 2014/09/05 T.Ichikawa --end--
 		//sessionにアップロードしたファイルの情報を設定
-		$this->session->removeParameter("filelist");
-		$this->session->setParameter("filelist",$filelist);
+		$this->Session->removeParameter("filelist");
+		$this->Session->setParameter("filelist",$filelist);
 
 		//'success'ではなく、trueを返す
 		return true;
diff --git a/repository/action/main/item/uploadfiles/maple.ini b/repository/action/main/item/uploadfiles/maple.ini
index f711040..a2c372b 100644
--- a/repository/action/main/item/uploadfiles/maple.ini
+++ b/repository/action/main/item/uploadfiles/maple.ini
@@ -22,9 +22,9 @@ maxsize = ""
 ;allow_mimetype="true"
 
 [Action]
-session = "ref:Session"
+Session = "ref:Session"
 uploadsAction = "ref:uploadsAction"
-db = "ref:DbObject"
+Db = "ref:DbObject"
 
 [TokenExtra]
 
diff --git a/repository/action/main/print/Print.class.php b/repository/action/main/print/Print.class.php
index c26339c..b1c9327 100644
--- a/repository/action/main/print/Print.class.php
+++ b/repository/action/main/print/Print.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Print.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: Print.class.php 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/privatetree/Privatetree.class.php b/repository/action/main/privatetree/Privatetree.class.php
index ab6f6ce..9b773b4 100644
--- a/repository/action/main/privatetree/Privatetree.class.php
+++ b/repository/action/main/privatetree/Privatetree.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Privatetree.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Tree.class.php 20897 2013-01-11 07:26:13Z ayumi_jin $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/sword/SwordDelete.class.php b/repository/action/main/sword/SwordDelete.class.php
index 68bdde4..f478604 100644
--- a/repository/action/main/sword/SwordDelete.class.php
+++ b/repository/action/main/sword/SwordDelete.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: SwordDelete.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: SwordDelete.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -330,7 +330,7 @@ class SwordDelete extends RepositoryAction
             return false;
         }
         $query = "SELECT user_authority_id FROM ".DATABASE_PREFIX."authorities ".
-                 "WHERE role_authority_id = '".$result[0]["role_authority_id"]."' ";
+                 "WHERE role_authority_id = ".$result[0]["role_authority_id"]." ";
         $result = $this->Db->execute($query);
         if($result === false || count($result) != 1){
             return false;
diff --git a/repository/action/main/sword/SwordUpdate.class.php b/repository/action/main/sword/SwordUpdate.class.php
index 06d4fb8..aaea39e 100644
--- a/repository/action/main/sword/SwordUpdate.class.php
+++ b/repository/action/main/sword/SwordUpdate.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: SwordUpdate.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: SwordUpdate.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -21,6 +21,8 @@ require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php
 require_once WEBAPP_DIR. '/components/mail/Main.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryOutputFilter.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/util/ZipUtility.class.php';
 
 /**
  * Sword update class
@@ -368,7 +370,7 @@ class SwordUpdate extends RepositoryAction
             }
 
             // 5. Update item
-            if(!$this->executeUpdateFromXmlData($xmlData, $tmpDir, $userId, $this->itemId, $this->itemNo, $insIndexArray))
+            if(!$this->executeUpdateFromXmlData($xmlData, $tmpDir, $userId, $this->itemId, $this->itemNo, $insIndexArray,$error_list))
             {
                 // Error
                 $statusCode = 500;
@@ -428,11 +430,12 @@ class SwordUpdate extends RepositoryAction
      * @param array $item_type_info
      * @param string $detailUrl
      * @param string $errorMsg
+     * @param string $waringMsg
      * @return bool
      */
     public function executeUpdate(
                 $xmlItemData, $xmlItemTypeData, $tmpDir, $userId,
-                $itemId, $itemNo, &$itemInfo, $insIndexArray, $item_type_info, &$detailUrl, &$errorMsg)
+                $itemId, $itemNo, &$itemInfo, $insIndexArray, $item_type_info, &$detailUrl, &$errorMsg, &$warningMsg)
     {
         $this->writeLog("-- Start executeUpdate (".date("Y/m/d H:i:s").") --\n");
 
@@ -493,6 +496,10 @@ class SwordUpdate extends RepositoryAction
         }
         $this->writeLog("  executeUpdateByItemRegister complete.\n");
 
+        // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
+        $this->entrySupple($itemId,$itemNo,$xmlItemData['supple_info_array'], $warningMsg);
+        // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/24 --end--
+
         // Update review status
         $itemInfo[count($itemInfo)-1]["review_status"] = $reviewStatus;
         $itemInfo[count($itemInfo)-1]["status"] = "success";
@@ -637,40 +644,12 @@ class SwordUpdate extends RepositoryAction
         }
         if($code != 200 && $code != 204)
         {
-            header("X-Error-Code: ". $text);
-            
-            // responce body
-            $response = "<?xml version=\"1.0\" encoding=\"utf-8\"?>" . "\n";
-            $response.= "<sword:error xmlns=\"". htmlspecialchars_self("http://www.w3.org/2005/Atom").
-                        "\" xmlns:sword=\""    . htmlspecialchars_self("http://purl.org/net/sword/terms/") .
-                        "\" xmlns:arxiv=\""    . htmlspecialchars_self("http://arxiv.org/schemas/atom") .
-                        "\" href=\""           . htmlspecialchars_self("http://example.org/errors/BadManifest"). "\">" . "\n";
-            // title
-            $response.= "  <title>" . "ERROR" . "</title>" . "\n";
-            // date
-            $time = date("Y-m-dTH:i:sZ");
-            $response.= "  <updated>" . htmlspecialchars_self($time) . "</updated>" . "\n";
-            // ユーザー（設定しない）
-            $response.= "  <author>" . "\n";
-            $response.= "    <name></name>" . "\n";
-            $response.= "    <email></email>" . "\n";
-            $response.= "  </author>" . "\n";
-            // treatment
-            $response.= "  <sword:treatment>" . "processing failed" . "</sword:treatment>" . "\n";
-            // summary
-            $response.= "  <summary>" . "Contents update failed" . "</summary>" . "\n";
-            // description
-            $description = "";
-            for($ii = 0; $ii < count($error_list); $ii++) {
-                $description .= "ERROR: ".$error_list[$ii]->error." ";
-                if($error_list[$ii]->item_id > 0) {
-                    $description .= "at Item ID ".$error_list[$ii]->item_id.";";
-                }
-            }
-            $response.= "  <sword:verboseDescription>" . htmlspecialchars_self($description) . "</sword:verboseDescription>" . "\n";
-            $response.= "</sword:error>" . "\n";
-            
-            print $response;
+            // Update suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
+            $this->outputErrorXML($error_list,$text);
+        }
+
+        if($code == 200){
+            $this->outputSuccessXML($this->itemId,$error_list);
         }
         return;
     }
@@ -711,12 +690,14 @@ class SwordUpdate extends RepositoryAction
         $filePath = $filedata["upload_dir"].DIRECTORY_SEPARATOR.$filedata["physical_file_name"];
         if(!$this->extraction($filePath, $tmpDir))
         {
+            $this->errorLog("Failed extraction", __FILE__, __CLASS__, __LINE__);
             return false;
         }
 
         // Get update data by xml
         if(!$this->importCommon_->XMLAnalysis($tmpDir, $xmlData, $error_list))
         {
+            $this->errorLog("Failed XMLAnalysis", __FILE__, __CLASS__, __LINE__);
             return false;
         }
 
@@ -733,7 +714,7 @@ class SwordUpdate extends RepositoryAction
      * @param array $insIndexArray
      * @return bool
      */
-    private function executeUpdateFromXmlData($xmlData, $tmpDir, $userId, $itemId, $itemNo, $insIndexArray)
+    private function executeUpdateFromXmlData($xmlData, $tmpDir, $userId, $itemId, $itemNo, $insIndexArray,&$error_list)
     {
         $this->writeLog("-- Start executeUpdateFromXmlData (".date("Y/m/d H:i:s").") --\n");
 
@@ -747,23 +728,32 @@ class SwordUpdate extends RepositoryAction
             // アップデートに成功したらループを抜ける
             $detailUrl = "";
             $errorMsg = "";
+            $warningMsg = "";
             $itemInfo = array();
 
+            // Update SuppleContentsEntry Y.Yamazawa 2015/04/06 --start--
             $result = $this->executeUpdate(
                                 $xmlData['item'][$nCnt], $xmlData['item_type'][$nCnt], $tmpDir,
-                                $userId, $itemId, $itemNo, $itemInfo, $insIndexArray, $item_type_info[$nCnt], $detailUrl, $errorMsg);
+                                $userId, $itemId, $itemNo, $itemInfo, $insIndexArray, $item_type_info[$nCnt], $detailUrl, $errorMsg, $warningMsg);
             if($result && strlen($errorMsg)==0)
             {
                 $updateFlag = true;
                 $this->writeLog("  Success update and no error.\n");
                 break;
             }
-            else if($result)
+            else if($result && strlen($warningMsg) > 0){
+                $updateFlag = true;
+                array_push($error_list, $errorMsg);
+                $this->writeLog("  Success update and error.\n");
+                break;
+            }
+            else if(!$result)
             {
                 $this->writeLog("  Update error:\n");
                 $this->writeLog("    XML_item_id:".$xmlData['item'][$nCnt]["item_array"][0]["ITEM_ID"]."\n");
                 $this->writeLog("    ".$errorMsg."\n");
             }
+            // Update SuppleContentsEntry Y.Yamazawa 2015/04/06 --end--
         }
 
         if($updateFlag)
@@ -1081,7 +1071,7 @@ class SwordUpdate extends RepositoryAction
             return false;
         }
         $query = "SELECT user_authority_id FROM ".DATABASE_PREFIX."authorities ".
-                 "WHERE role_authority_id = '".$result[0]["role_authority_id"]."' ";
+                 "WHERE role_authority_id = ".$result[0]["role_authority_id"]." ";
         $result = $this->Db->execute($query);
         if($result === false || count($result) != 1)
         {
@@ -1371,7 +1361,7 @@ class SwordUpdate extends RepositoryAction
             // when exist mail address
             if(strlen($xmlItemData["personal_name_array"][$ii]["E_MAIL_ADDRESS"]) > 0) {
                 $extAuthorIds = array(
-                                        self::KEY_PREFIX_ID => '0',
+                                        self::KEY_PREFIX_ID => 0,
                                         self::KEY_SUFFIX => $xmlItemData["personal_name_array"][$ii]["E_MAIL_ADDRESS"]
                                     );
                 array_push($externalAuthorIds, $extAuthorIds);
@@ -1388,7 +1378,7 @@ class SwordUpdate extends RepositoryAction
                                 self::KEY_FAMILY_RUBY => $xmlItemData["personal_name_array"][$ii]["FAMILY_RUBY"],
                                 self::KEY_NAME_RUBY => $xmlItemData["personal_name_array"][$ii]["NAME_RUBY"],
                                 self::KEY_EMAIL => $xmlItemData["personal_name_array"][$ii]["E_MAIL_ADDRESS"],
-                                self::KEY_AUTHOR_ID => '0',
+                                self::KEY_AUTHOR_ID => 0,
                                 self::KEY_LANGUAGE => $dispLangTypeList[$attrId],
                                 self::KEY_EX_AUTHOR_ID => $externalAuthorIds,
                                 self::KEY_INPUT_TYPE => $inputTypeList[$attrId]);
@@ -1493,8 +1483,9 @@ class SwordUpdate extends RepositoryAction
 
             // 1. XML内のfile_nameと一致するファイルが存在するかどうかをチェック
             //    -> 該当ファイルが無い場合はエラーとする。
-            $fileName = mb_convert_encoding($xmlItemData["thumbnail_array"][$ii]["FILE_NAME"], $this->encode_, "auto");
+            $fileName = mb_convert_encoding($xmlItemData["thumbnail_array"][$ii]["FILE_NAME"], $this->getEncodeByOS(), "auto");
             $tmpPath = $tmpDir.DIRECTORY_SEPARATOR.$fileName;
+            
             if(!file_exists($tmpPath))
             {
                 // [Warning]該当ファイルが無いためこのアイテムは更新しない
@@ -1606,8 +1597,9 @@ class SwordUpdate extends RepositoryAction
 
             // 1. XML内のfile_nameと一致するファイルが存在するかどうかをチェック
             //    -> 該当ファイルが無い場合はエラーとする。
-            $fileName = mb_convert_encoding($xmlItemData["file_array"][$ii]["FILE_NAME"], $this->encode_, "auto");
+            $fileName = mb_convert_encoding($xmlItemData["file_array"][$ii]["FILE_NAME"], $this->getEncodeByOS(), "auto");
             $tmpPath = $tmpDir.DIRECTORY_SEPARATOR.$fileName;
+            
             if(!file_exists($tmpPath))
             {
                 // [Warning]該当ファイルが無いためこのアイテムは更新しない
@@ -1945,6 +1937,12 @@ class SwordUpdate extends RepositoryAction
             }
         }
         $this->writeLog("  End loop for metadata regist.\n");
+        
+        // BugFix when before and after update, assignment doi is failed T.Koyasu 2015/03/09 --start--
+        // must check self_doi when after update item metadatas
+        $this->writeLog("  Check self doi and Add self doi");
+        $this->itemRegister_->updateSelfDoi($irBasic);
+        // BugFix when before and after update, assignment doi is failed T.Koyasu 2015/03/09 --end--
 
         // attribute_no 振り直し
         $this->writeLog("  Call reissueAttrNo at importCommon.");
@@ -2274,6 +2272,11 @@ class SwordUpdate extends RepositoryAction
         $swordImport = new Repository_Action_Main_Sword_Import($this->Session, $this->Db, $this->TransStartDate);
         $swordImport->setConfigAuthority();
 
+        // Add SuppleContents Y.Yamazawa 2015/04/06 --start--
+        $logName = WEBAPP_DIR."/logs/weko/sword/sword_import_update_log.txt";
+        $swordImport->createSwordUpdateLogFile($logName);
+        // Add SuppleContents Y.Yamazawa 2015/04/06 --end--
+
         // Fix check index authority 2013/06/12 Y.Nakao --start--
         // Set user_id
         if($swordImport->setSessionUserAuthority($this->loginId) === false)
@@ -2289,6 +2292,10 @@ class SwordUpdate extends RepositoryAction
         $result = $swordImport->insertNewIndexAndSelectCheckIndex(
                         $newIndex, $checkedIds, $insIndexArray, $errorMsg, $userId, false);
 
+        // Add SuppleContents Y.Yamazawa 2015/04/06 --start--
+        $swordImport->closeLogFile();
+        // Add SuppleContents Y.Yamazawa 2015/04/06 --end--
+
         // Fix for private tree 2014/3/5 R.Matsuura --start--
         // get index_id and owner user id before update
         $itemIndexIdAndOwnerUser = array();
@@ -2327,6 +2334,9 @@ class SwordUpdate extends RepositoryAction
 
     /*
      * zip file extract to tmpDirPath
+     * @param ファイルパス $filePath string
+     * @param 出力先パス $tmpDirPath string
+     * @return ファイルの出力の成功失敗
      */
     private function extraction($filePath, $tmpDirPath){
 
@@ -2341,11 +2351,14 @@ class SwordUpdate extends RepositoryAction
         }
         mkdir($tmpDirPath, 0777);
 
+        // Update SuppleContentsEntry Y.Yamazawa 2015/04/07 --satrt--
         // extract zip file
-        File_Archive::extract(
-            File_Archive::read($filePath . "/"),
-            File_Archive::appender($tmpDirPath)
-        );
+        $result = Repository_Components_Util_ZipUtility::extract($filePath, $tmpDirPath);
+        if($result === false){
+            unlink($filePath);
+            return false;
+        }
+        // Update SuppleContentsEntry Y.Yamazawa 2015/04/07 --end--
 
         unlink($filePath);
 
@@ -2447,5 +2460,224 @@ class SwordUpdate extends RepositoryAction
             $itemIndexData = $this->dbAccess->executeQuery($query, $params);
         }
     }
+
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/30 --start--
+    /**
+     * サプリコンテンツを登録する
+     *
+     * @param アイテムID $itemId string
+     * @param アイテムNo $itemNo string
+     * @param XML内のサプリコンテンツ情報 $supple_info_array array
+     * @param エラーメッセージ string
+     */
+    private function entrySupple($itemId,$itemNo,$supple_info_array,&$error_msg)
+    {
+        // サプリコンテンツ情報を取得する。この時点では、ユーザーがサプリコンテンツの登録を行うか判断できないため
+        // ビジネスロジック内のメソッドは使用しない。
+        $suppleInfoList = $this->suppleContentInfo($itemId);
+
+        // サプリコンテンツURLが空か確認
+        if(((!isset($supple_info_array[0]) || !(strlen($supple_info_array[0]) > 0)) && count($suppleInfoList) == 0))
+        {
+            return false;
+        }
+
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        try{
+            $this->writeLog("businessSupple", __FILE__, __CLASS__, __LINE__);
+            $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
+        }
+        catch (AppException $e){
+            $msg = $e->getMessage();
+            $msg = $smartyAssign->getLang($msg);
+            $this->writeLog($msg, __FILE__, __CLASS__, __LINE__);
+            $error_msg .= $msg;
+            return false;
+        }
+
+        try {
+            $businessSupple->updateAllSuppleContentsOfOneItemForImport($itemId,$itemNo,$supple_info_array);
+        }
+        catch(AppException $e)
+        {
+            // サプリWEKO側のPrefixID情報の取得及びサプリコンテンツ登録・更新・削除に必要な情報の取得に失敗した場合
+            // 失敗した場合はcatchする
+            $code = $e->getMessage();
+            $msg = $smartyAssign->getLang($code);
+            $this->errorLog($msg, __FILE__, __CLASS__, __LINE__);
+            $error_msg .= $msg;
+
+            return false;
+        }
+        return true;
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/30 --end--
+
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/30 --start--
+    /**
+     * エラー時のXML出力
+     *
+     * @param エラー情報 $error_list array array
+     */
+    private function outputErrorXML($error_list,$text)
+    {
+        header("X-Error-Code: ". $text);
+
+        // header
+        header("Content-Type: text/xml; charset=utf-8");
+        // -------------------------
+        // XML
+        // -------------------------
+        $ret_xml = '<?xml version="1.0" encoding="UTF-8" ?>'."\n";
+        $ret_xml .= '<sword:error xmlns="http://www.w3.org/2005/Atom" xmlns:sword="http://purl.org/net/sword/" xmlns:arxiv="http://arxiv.org/schemas/atom" href="http://example.org/errors/BadManifest">'."\n";
+        $ret_xml .= '<title>ERROR</title>'."\n";
+        $ret_xml .= '<version>2.0</version>'."\n";
+        $ret_xml .= '<updated>2013-08-20JST16:46:0432400</updated>'."\n";
+        $ret_xml .= '<author>'."\n";
+        $ret_xml .= '<name></name>'."\n";
+        $ret_xml .= '<email></email>'."\n";
+        $ret_xml .= '</author>'."\n";
+        $ret_xml .= '<source>'."\n";
+        $ret_xml .= '<generator uri="'.BASE_URL.'/weko/sword/deposit.php" version="2"/>'."\n";
+        $ret_xml .= '</source>'."\n";
+        $ret_xml .= '<sword:treatment>Deposited items(zip) will be treated as WEKO import file which contains any WEKO contents information, and will be imported to WEKO.</sword:treatment>'."\n";
+        $ret_xml .= '<summary>Contents update failed</summary>'."\n";
+        if(count($error_list) > 0) {
+            // sword description
+            $description = "";
+            for($ii = 0; $ii < count($error_list); $ii++) {
+                $description .= "ERROR: ".$error_list[$ii]->error." ";
+                if($error_list[$ii]->item_id > 0) {
+                    $description .= "at Item ID ".$error_list[$ii]->item_id.";";
+                }
+            }
+            $ret_xml .= '<sword:verboseDescription>'.$description.'</sword:verboseDescription>';
+        }
+        $ret_xml .= "</sword:error>" . "\n";
+        
+        print $ret_xml;
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/30 --end--
+
+    /**
+     * アイテム更新成功時のXML出力
+     *
+     * @param アイテムID $item_id string
+     * @param 警告 $warning_msg array
+     */
+    private function outputSuccessXML($item_id,$warning_msg)
+    {
+        // header
+        header("Content-Type: text/xml; charset=utf-8");
+        // -------------------------
+        // XML
+        // -------------------------
+        $ret_xml = '<?xml version="1.0" encoding="UTF-8" ?>'."\n";
+        $ret_xml .= '<entry xmlns="http://www.w3.org/2005/Atom" xmlns:sword="http://purl.org/net/sword/">'."\n";
+        $ret_xml .= '<title>Repository Review</title>'."\n";
+        $ret_xml .= '<version>2.0</version>'."\n";
+        $ret_xml .= '<id>'.$item_id.'-'.$item_id.'</id>'."\n";
+        $ret_xml .= '<updated>2013-08-20JST16:46:0432400</updated>'."\n";
+        $ret_xml .= '<author>'."\n";
+
+        // ユーザーIDの取得
+        $user_id = $this->Session->getParameter("_user_id");
+        $ret_xml .= '<name>'.$user_id.'</name>'."\n";
+
+        // Emailアドレスの取得
+        $result = $this->emailAddress($user_id, $login_email);
+        if($result === false){
+            $login_email = "";
+        }
+        $ret_xml .= '<email>'.$login_email.'</email>'."\n";
+        $ret_xml .= '</author>'."\n";
+
+        // アイテム詳細画面のURLと警告のメッセージ
+        foreach ($warning_msg as $msg){
+            $ret_xml .= '<content type="text/html" src="'.BASE_URL.'/?action=repository_uri&amp;item_id='.$item_id.'" message="'.$msg.'"/>'."\n";
+        }
+
+        $ret_xml .= '<source>'."\n";
+        $ret_xml .= '<generator uri="'.BASE_URL.'/weko/sword/deposit.php" version="2"/>'."\n";
+        $ret_xml .= '</source>'."\n";
+        $ret_xml .= '<sword:treatment>Deposited items(zip) will be treated as WEKO import file which contains any WEKO contents information, and will be imported to WEKO.</sword:treatment>'."\n";
+        $ret_xml .= '<sword:formatNamespace>WEKO</sword:formatNamespace>'."\n";
+        $ret_xml .= '<sword:userAgent>SWORD Client for WEKO V2.0</sword:userAgent>'."\n";
+        $ret_xml .= '</entry>';
+
+        print $ret_xml;
+    }
+
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
+    /**
+     * Emailアドレスの取得
+     *
+     * @param ユーザーID $user_id string
+     * @param メールアドレス $email string
+     * @return boolean 取得結果
+     */
+    private function emailAddress($user_id, &$email)
+    {
+        // init
+        $email = "";
+        // SQL query for get email address from user_id
+        $query = "SELECT links.content ".
+                 "FROM ". DATABASE_PREFIX ."items AS items, ".
+                          DATABASE_PREFIX ."users_items_link AS links ".
+                 "WHERE items.type = 'email' ".
+                 "  AND items.item_id = links.item_id ".
+                 "  AND links.user_id = ?; ";
+        // get login user's email address
+        $params = array();
+        $params = $user_id;
+        $result = $this->Db->execute( $query, $params );
+        if($result === false){
+        // not user?
+            return false;
+        }
+        if(count($result) == 1){
+        // get email address
+            $email = $result[0]["content"];
+        }
+
+        return true;
+    }
+        // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/24 --end--
+
+    /**
+     * アイテムIDをキーとしてサプリコンテンツ情報を取得する
+     * @param string $itemID アイテムID
+     * @throws AppException
+     * @return boolean|mixed
+     */
+    private function suppleContentInfo($itemID)
+    {
+        $query = "SELECT uri FROM ".DATABASE_PREFIX."repository_supple ".
+                "WHERE item_id = ? " .
+                "AND is_delete = 0 ";
+        $params = array();
+        $params[] = $itemID;	// item_id
+        $result = $this->Db->execute($query,$params);
+        if($result === false){
+            return false;
+        }
+
+        return $result;
+    }
+    
+    /**
+     * get OS's encode
+     *
+     * @return string
+     */
+    private function getEncodeByOS(){
+        if(stristr(php_uname(), "Linux")){
+            return "UTF-8";
+        } else if(stristr(php_uname(), "Windows")){
+            return "SJIS";
+        } else {
+            return _CHARSET;
+        }
+    }
 }
 ?>
diff --git a/repository/action/main/sword/SwordUtility.class.php b/repository/action/main/sword/SwordUtility.class.php
index ff76286..d3c628b 100644
--- a/repository/action/main/sword/SwordUtility.class.php
+++ b/repository/action/main/sword/SwordUtility.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: SwordUtility.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: SwordUtility.class.php 24783 2013-08-20 07:31:46Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -127,8 +127,7 @@ class SwordUtility extends RepositoryAction
 		// V1.2 => V1.3 : <sword:level> removed...
 //	    $root['level']           = '1';								// Server Level	
 		// V1.2 => V1.3 : <sword:version> added.(mandately)
-		// V2.0 : The SWORD server MUST specify the sword:version element with a value of 2.0
-	    $root['version']         = '2.0';								// Server Version
+	    $root['version']         = 2.0;								// Server Version
 	    // V1.2 => V1.3 : <sword:maxUploadSize> added.(option)
 	    $root['maxUploadSize']   = intval($upload_max_capacity_group)/1024;	// maxUploadSize (KB)	
 		
diff --git a/repository/action/main/sword/import/Import.class.php b/repository/action/main/sword/import/Import.class.php
index 43fe8ec..18699c2 100644
--- a/repository/action/main/sword/import/Import.class.php
+++ b/repository/action/main/sword/import/Import.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Import.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Import.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -20,6 +20,8 @@ require_once WEBAPP_DIR. '/components/mail/Main.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexAuthorityManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryOutputFilter.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/util/ZipUtility.class.php';
+
 
 /**
  * **********************************************
@@ -96,6 +98,10 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
     function execute()
     {
         try {
+            // Add suppleContentsEntry  Y.Yamazawa --start-- 2015/04/01 --start--
+            $this->setLangResource();
+            // Add suppleContentsEntry  Y.Yamazawa --end-- 2015/04/01 --end--
+
             // Create log file
             if($this->isCreateLog)
             {
@@ -531,7 +537,59 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                 $this->exitAction();
                 exit();
             }
+            // check itemtype authority
+            // 権限IDを取得する
+            $query = "SELECT role_authority_id ".
+                     "FROM ".DATABASE_PREFIX. "users ".
+                     "WHERE user_id = ? ;";
+            $params = array();
+            $params[] = $this->Session->getParameter("_user_id");
+            $role_auth = $this->Db->execute($query, $params);
+            // ルーム権限を取得する
+            $room_auth = $this->getRoomAuthorityID($this->Session->getParameter("_user_id"));
+            // アイテムタイプIDリストを作成する
+            $item_type_id_list = array();
+            for($ii = 0; $ii < count($item_type_info); $ii++) {
+                $item_type_id_list[] = $item_type_info[$ii]["item_type_id"];
+            }
+            $result = $import_common->canUseItemtype($item_type_id_list, $role_auth[0]["role_authority_id"], $room_auth);
+            // アイテムタイプ使用チェック結果を確認する
+            $error_list = array();
+            $error_cnt = 0;
+            for($ii = 0; $ii < count($result); $ii++) {
+                if($result[$ii] == false) {
+                    // タイトル設定
+                    if(strlen($array_item_data["item"][$ii]["item_array"][0]["TITLE"]) > 0) {
+                        $title = $error_list[$error_cnt]["title"] = $array_item_data["item"][$ii]["item_array"][0]["TITLE"]; 
+                    } else {
+                        $title = $error_list[$error_cnt]["title"] = $array_item_data["item"][$ii]["item_array"][0]["TITLE_ENGLISH"]; 
+                    }
+                    // エラー情報
+                    $error_list[$error_cnt] = new DetailErrorInfo(-1,                                                        // item id
+                                                                  $title,                                                    // title
+                                                                  "You do not have permission to use the item type",         // error
+                                                                  "",                                                        // attr name
+                                                                  $item_type_info[$ii]["item_type_name"],                    // input value
+                                                                  "",                                                        // regist value
+                                                                  20                                                         // error number
+                                                                  );
+                    $error_cnt++;
+                }
+            }
+            if(count($error_list) > 0){
+                $this->outputError("ErrorXML", "ERROR XML : User do not have permission to use the item type.", $error_list);
+                $this->removeDirectory($tmp_dir);
+                if(isset($this->logFh))
+                {
+                    fwrite($this->logFh, "ERROR XML : User do not have permission to use the item type. (".date("Y/m/d H:i:s").")\n");
 
+                    fclose($this->logFh);
+                }
+                $this->failTrans();
+                $this->exitAction();
+                exit();
+            }
+            
             ////////////////////////////////////////
             // insert item
             ////////////////////////////////////////
@@ -549,6 +607,7 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
             for($nCnt=0;$nCnt<count($array_item_data['item']);$nCnt++){
                 // insert 1 item
                 $msg = "";
+                $warningMsg = "";
                 $ret = $import_common->itemEntry($array_item_data['item'][$nCnt],
                                                 $tmp_dir,
                                                 $array_item,
@@ -557,7 +616,8 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                                                 $array_item_data['item_type'][$nCnt],
                                                 $msg,
                                                 $ins_item_id,
-                                                $uri);
+                                                $uri, 
+                                                $warningMsg);
                 if($ret === false){
                     $this->outputError("ErrorInsertItem", $msg);
                     $this->removeDirectory($tmp_dir);
@@ -572,7 +632,12 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                     exit();
                 }
 
-                array_push($error_msg, $msg);
+                if(strlen($warningMsg) > 0){
+                    array_push($error_msg, $warningMsg);
+                } else {
+                    array_push($error_msg, $msg);
+                }
+                
                 if($start_item_id == ""){
                     $start_item_id = $ins_item_id;
                 }
@@ -696,10 +761,25 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                 if(isset($this->logFh))
                 {
                     fwrite($this->logFh, "Check Point 12-A1: Before send ReviewMail. (".date("Y/m/d H:i:s").")\n");
-                    fwrite($this->logFh, "  email: ".$users["email"]."\n");
-                    fwrite($this->logFh, "  handle: ".$users["handle"]."\n");
-                    fwrite($this->logFh, "  type: ".$users["type"]."\n");
-                    fwrite($this->logFh, "  lang_dirname: ".$users["lang_dirname"]."\n");
+                    foreach ($users as $user)
+                    {
+                        if(isset($user))
+                        {
+                            fwrite($this->logFh, "  email: ".$user["email"]."\n");
+                        }
+                        if(isset($users["handle"]))
+                        {
+                            fwrite($this->logFh, "  handle: ".$users["handle"]."\n");
+                        }
+                        if(isset($users["type"]))
+                        {
+                            fwrite($this->logFh, "  type: ".$users["type"]."\n");
+                        }
+                        if(isset($users["lang_dirname"]))
+                        {
+                            fwrite($this->logFh, "  lang_dirname: ".$users["lang_dirname"]."\n");
+                        }
+                    }
                 }
                 // ---------------------------------------------
                 // 送信先を設定
@@ -742,25 +822,10 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                 fwrite($this->logFh, "  start_item_id: ".$start_item_id."\n");
                 fwrite($this->logFh, "  end_item_id: ".$end_item_id."\n");
             }
-            // header
-            header("Content-Type: text/xml; charset=utf-8");
-            // XML
-            $ret_xml = '<?xml version="1.0" encoding="UTF-8" ?>';
-            $ret_xml .= '<result>';
-            $ret_xml .= '<status>success</status>';
-            $ret_xml .= '<start_id>'.$start_item_id.'</start_id>';
-            $ret_xml .= '<end_id>'.$end_item_id.'</end_id>';
-            // detail uri list
-            for($ii=0; $ii<count($detail_uri); $ii++){
-                $ret_xml .= '<contents_uri>'.htmlspecialchars($detail_uri[$ii], ENT_QUOTES, 'UTF-8').'</contents_uri>';
-                if(isset($this->logFh))
-                {
-                    fwrite($this->logFh, "  contents_uri: ".$detail_uri[$ii]."\n");
-                }
-            }
-            $ret_xml .= '</result>';
 
-            print $ret_xml;
+            // Update suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
+            $this->outputSuccess($detail_uri,$start_item_id,$end_item_id,$error_msg);
+            // Update suppleContentsEntry Y.Yamazawa --end-- 2015/03/24 --end--
 
             if(isset($this->logFh))
             {
@@ -786,7 +851,7 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
     /*
      * zip file extract
      */
-    function extraction($tmp_file){
+    private function extraction($tmp_file){
 
         // check file kind
         //if($tmp_file != "zip"){
@@ -806,11 +871,14 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
         }
         mkdir($dir, 0777);
 
+        // Update SuppleContentsEntry Y.Yamazawa 2015/04/02 --satrt--
         // extract zip file
-        File_Archive::extract(
-        File_Archive::read($file_path . "/"),
-        File_Archive::appender($dir)
-        );
+        $result = Repository_Components_Util_ZipUtility::extract($file_path, $dir);
+        if($result === false){
+            $this->errorLog("Not found zip file. File name : ".$tmp_file.".zip", __FILE__, __CLASS__, __LINE__);
+            return false;
+        }
+        // Update SuppleContentsEntry Y.Yamazawa 2015/04/02 --end--
 
         // delete upload file
         if($this->deleteUploadFile)
@@ -822,54 +890,33 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
     }
 
     /**
-     * get New Index ID
-     *
-     * transplant from getNewId function in tree_repository.js
-     *
-     */
-    function getNewIndexID(){
-        // get ID list
-        $query = "SELECT index_id FROM ". DATABASE_PREFIX ."repository_index; ";
-        $result = $this->Db->execute($query);
-        if($result == false){
-            return "";
-        }
-
-        $cnt_id = 1;
-        $len = count($result);
-        for ( $ii=0; $ii<$len+2; $ii++ ) {
-            $flag=0;
-            for ( $jj=0; $jj<$len; $jj++ ) {
-                $node_id = $result[$jj]["index_id"];
-                if ( $node_id == $cnt_id )
-                {
-                    $flag = 1;
-                    break;
-                }
-            }
-            if ($flag == 0) {
-                return $cnt_id;
-            }
-            $cnt_id++;
-        }
-        return -1;
-    }
-
-    /**
-     * output error xml
+     * エラー内容をXML出力
+     * @param エラーステータス $error_msg string
+     * @param エラーに応じたサマリー $summary string
+     * @param 区切で登録アイテムごとのエラー情報 $error_list array
      */
-    function outputError($error_msg, $summary, $error_list=array()){
+    private function outputError($error_msg, $summary, $error_list=array()){
+        // Update suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
         // header
         header("Content-Type: text/xml; charset=utf-8");
+        // -------------------------
         // XML
-        $ret_xml = '<?xml version="1.0" encoding="UTF-8" ?>';
-        $ret_xml .= '<result>';
-        $ret_xml .= '<status>'. $error_msg .'</status>';
-        $ret_xml .= '<summary>'. $summary .'</summary>';
-        // Add for error check 2014/09/12 T.Ichikawa --start--
+        // -------------------------
+        $ret_xml = '<?xml version="1.0" encoding="UTF-8" ?>'."\n";
+        $ret_xml .= '<sword:error xmlns="http://www.w3.org/2005/Atom" xmlns:sword="http://purl.org/net/sword/" xmlns:arxiv="http://arxiv.org/schemas/atom" href="http://example.org/errors/BadManifest">'."\n";
+        $ret_xml .= '<title>ERROR</title>'."\n";
+        $ret_xml .= '<version>2.0</version>'."\n";
+        $ret_xml .= '<updated>2013-08-20JST16:46:0432400</updated>'."\n";
+        $ret_xml .= '<author>'."\n";
+        $ret_xml .= '<name></name>'."\n";
+        $ret_xml .= '<email></email>'."\n";
+        $ret_xml .= '</author>'."\n";
+        $ret_xml .= '<source>'."\n";
+        $ret_xml .= '<generator uri="'.BASE_URL.'/weko/sword/deposit.php" version="2"/>'."\n";
+        $ret_xml .= '</source>'."\n";
+        $ret_xml .= '<sword:treatment>Deposited items(zip) will be treated as WEKO import file which contains any WEKO contents information, and will be imported to WEKO.</sword:treatment>'."\n";
+        $ret_xml .= '<summary>'.$error_msg.'</summary>'."\n";
         if(count($error_list) > 0) {
-            // sword treatment
-            $ret_xml .= '<treatment>XML Analysis Failed</treatment>';
             // sword description
             $description = "";
             for($ii = 0; $ii < count($error_list); $ii++) {
@@ -878,16 +925,108 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                     $description .= "at Item ID ".$error_list[$ii]->item_id.";";
                 }
             }
-            $ret_xml .= '<description>'.$description.'</description>';
+            $ret_xml .= '<sword:verboseDescription>'.$description.'</sword:verboseDescription>'."\n";
         }
-        // Add for error check 2014/09/12 T.Ichikawa --end--
-        $ret_xml .= '</result>';
-
+        $ret_xml .= '</sword:error>';
+        // Update suppleContentsEntry Y.Yamazawa --end-- 2015/03/24 --end--
         print $ret_xml;
 
         return;
     }
 
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
+    /**
+     * アイテム登録成功時のXML作成
+     * @param アイテムID（配列） $item_id_array
+     * @param 最初に登録したアイテムのアイテムID $start_item_id string
+     * @param 最後に登録したアイテムのアイテムID $end_item_id string
+     * @param 警告メッセージ（配列） $warning_msg array
+     */
+    private function outputSuccess($detail_uri,$start_item_id,$end_item_id,$warning_msg)
+    {
+        // header
+        header("Content-Type: text/xml; charset=utf-8");
+        // -------------------------
+        // XML
+        // -------------------------
+        $ret_xml = '<?xml version="1.0" encoding="UTF-8" ?>'."\n";
+        $ret_xml .= '<entry xmlns="http://www.w3.org/2005/Atom" xmlns:sword="http://purl.org/net/sword/">'."\n";
+        $ret_xml .= '<title>Repository Review</title>'."\n";
+        $ret_xml .= '<version>2.0</version>'."\n";
+        $ret_xml .= '<id>'.$start_item_id.'-'.$end_item_id.'</id>'."\n";
+        $ret_xml .= '<updated>2013-08-20JST16:46:0432400</updated>'."\n";
+        $ret_xml .= '<author>'."\n";
+
+        // ユーザーIDの取得
+        $user_id = $this->Session->getParameter("_user_id");
+        $ret_xml .= '<name>'.$user_id.'</name>'."\n";
+
+        // Emailアドレスの取得
+        $result = $this->emailAddress($user_id, $login_email);
+        if($result === false){
+            $login_email = "";
+        }
+
+        $ret_xml .= '<email>'.$login_email.'</email>'."\n";
+
+        $ret_xml .= '</author>'."\n";
+
+        // アイテム詳細画面のURLと警告のメッセージ
+        for($ii = 0; $ii < count($detail_uri); $ii++) {
+            $msg = "";
+            if(isset($warning_msg[$ii])){
+                $msg = $warning_msg[$ii];
+            }
+            $ret_xml .= '<content type="text/html" src="'.htmlspecialchars($detail_uri[$ii], ENT_QUOTES, 'UTF-8').'" message="'.$msg.'"/>'."\n";
+        }
+
+        $ret_xml .= '<source>'."\n";
+        $ret_xml .= '<generator uri="'.BASE_URL.'/weko/sword/deposit.php" version="2"/>'."\n";
+        $ret_xml .= '</source>'."\n";
+        $ret_xml .= '<sword:treatment>Deposited items(zip) will be treated as WEKO import file which contains any WEKO contents information, and will be imported to WEKO.</sword:treatment>'."\n";
+        $ret_xml .= '<sword:formatNamespace>WEKO</sword:formatNamespace>'."\n";
+        $ret_xml .= '<sword:userAgent>SWORD Client for WEKO V2.0</sword:userAgent>'."\n";
+        $ret_xml .= '</entry>';
+
+        print $ret_xml;
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/24 --end--
+
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/24 --start--
+    /**
+     * Emailアドレスの取得
+     *
+     * @param ユーザーID $user_id string
+     * @param メールアドレス $email string
+     * @return boolean
+     */
+    private function emailAddress($user_id, &$email){
+        // init
+        $email = "";
+        // SQL query for get email address from user_id
+        $query = "SELECT links.content ".
+                "FROM ". DATABASE_PREFIX ."items AS items, ".
+                DATABASE_PREFIX ."users_items_link AS links ".
+                "WHERE items.type = 'email' ".
+                "  AND items.item_id = links.item_id ".
+                "  AND links.user_id = ?; ";
+        // get login user's email address
+        $params = array();
+        $params = $user_id;
+        $result = $this->Db->execute( $query, $params );
+        if($result === false){
+            // not user?
+            return false;
+        }
+        if(count($result) == 1){
+            // get email address
+            $email = $result[0]["content"];
+        }
+
+        return true;
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/24 --end--
+
     /**
      * check access right for insert item
      *
@@ -1090,7 +1229,7 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                         // check index name = "import" from parent index is root
                         $query = "SELECT index_id FROM ". DATABASE_PREFIX ."repository_index ".
                                  "WHERE index_name = 'import' ".
-                                 "AND parent_index_id = '0' ".
+                                 "AND parent_index_id = 0 ".
                                 " AND is_delete = 0; ";
                         $result = $this->Db->execute( $query );
                         if($result === false){
@@ -1105,8 +1244,8 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                             $index = array(
                                 "index_name"              => "import",
                                 "index_name_english"      => "import",
-                                "parent_index_id"         => "0",
-                                "public_state"            => "1",
+                                "parent_index_id"         => 0,
+                                "public_state"            => 1,
                                 "pub_date"                => $pubDate,
                                 "access_role"             => $this->getInsertAuthIds()."|".$this->Session->getParameter("_auth_id"),
                                 "access_group"            => "",
@@ -1154,7 +1293,7 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
                         "index_name"              => $index_info[1],
                         "index_name_english"      => $index_info[1],
                         "parent_index_id"         => $index_info[0],
-                        "public_state"            => "1",
+                        "public_state"            => 1,
                         "pub_date"                => $pubDate,
                         "access_role"             => $this->getInsertAuthIds()."|".$this->Session->getParameter("_auth_id"),
                         "access_group"            => "",
@@ -1221,9 +1360,9 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
             }
             $query = " SELECT index_id, access_role, access_group, owner_user_id ".
                     " FROM ". DATABASE_PREFIX ."repository_index ".
-                     " WHERE index_id = '". $indexIdList[$ii]. "' ".
-                     // " AND public_state = '1' ". // 後で閲覧権限および投稿権限を参照するのでここの判定は削除（ゆくゆくは非公開インデックスも指定可能にするため） 2013/06/07 Y.Nakao// TODO
-                     " AND is_delete = '0'; ";
+                     " WHERE index_id = ". $indexIdList[$ii]. " ".
+                     // " AND public_state = 1 ". // 後で閲覧権限および投稿権限を参照するのでここの判定は削除（ゆくゆくは非公開インデックスも指定可能にするため） 2013/06/07 Y.Nakao// TODO
+                     " AND is_delete = 0; ";
             $result = $this->Db->execute( $query );
             if($result === false){
                 // not select index
@@ -1312,7 +1451,9 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
             }
             return false;
         }
-        $this->Session->setParameter("_user_id", $result[0]["user_id"]);
+        // Update SuppleContentsEntry 2015/04/01 --start --
+        $userId = $result[0]["user_id"];
+        $this->Session->setParameter("_user_id", $userId);
         $this->Session->setParameter("_role_authority_id", $result[0]["role_authority_id"]);
         // get user user_authority_id
         $query = "SELECT user_authority_id FROM ". DATABASE_PREFIX ."authorities ".
@@ -1332,12 +1473,36 @@ class Repository_Action_Main_Sword_Import extends RepositoryAction
 
         $user_auth_id = $result[0]["user_authority_id"];
         $this->Session->setParameter("_user_auth_id", $user_auth_id);
-        $auth_id = $this->getRoomAuthorityID($result[0]["user_id"]);
+        $auth_id = $this->getRoomAuthorityID($userId);
         $this->Session->setParameter("_auth_id", $auth_id);
+        // Update SuppleContentsEntry 2015/04/01 --end --
 
         return true;
     }
     // Fix check index_id Y.Nakao 2013/06/07 --end--
 
+    // Add SuppleContentsEntry Y.Yamazawa --start--
+    /**
+     * ログファイルの作成
+     * @param ログファイルのパス $logName
+     */
+    public function createSwordUpdateLogFile($logName)
+    {
+        $this->logFh = fopen($logName, "w");
+        chmod($logName, 0600);
+        fwrite($this->logFh, "Start SWORD update. (".date("Y/m/d H:i:s").")\n");
+        fwrite($this->logFh, "\n");
+        fwrite($this->logFh, "[Sword Update]\n");
+    }
+
+    /**
+     * ログファイルを閉じる
+     */
+    public function closeLogFile()
+    {
+        fclose($this->logFh);
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end--
+
 }
 ?>
diff --git a/repository/action/main/sword/index/Index.class.php b/repository/action/main/sword/index/Index.class.php
index 84b15be..a861e1e 100644
--- a/repository/action/main/sword/index/Index.class.php
+++ b/repository/action/main/sword/index/Index.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Index.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Index.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -215,7 +215,7 @@ class Repository_Action_Main_Sword_Index extends RepositoryAction
                 $this->Session->setParameter("_role_authority_id", $result[0]["role_authority_id"]);
                 // get user user_authority_id
                 $query = "SELECT user_authority_id FROM ". DATABASE_PREFIX ."authorities ".
-                        " WHERE role_authority_id = '".$result[0]["role_authority_id"]."' ";
+                        " WHERE role_authority_id = ".$result[0]["role_authority_id"]." ";
                 if(isset($this->logFh))
                 {
                     fwrite($this->logFh, "  Execute query: ". $query."\n");
@@ -318,7 +318,7 @@ class Repository_Action_Main_Sword_Index extends RepositoryAction
                 // check index name = "import" from parent index is root
                 $query = "SELECT index_id FROM ". DATABASE_PREFIX ."repository_index ".
                          "WHERE index_name = 'import' ".
-                         "AND parent_index_id = '0' ".
+                         "AND parent_index_id = 0 ".
                         " AND is_delete = 0; ";
                 if(isset($this->logFh))
                 {
@@ -348,9 +348,9 @@ class Repository_Action_Main_Sword_Index extends RepositoryAction
                     $index = array(
                                 "index_name"              => "import",
                                 "index_name_english"      => "import",
-                                "parent_index_id"         => "0",
+                                "parent_index_id"         => 0,
                                 "comment"                 => "",
-                                "public_state"            => "1",
+                                "public_state"            => 1,
                                 "pub_date"                => $pubDate,
                                 "access_role"             => $insert_auth_ids."|".$this->Session->getParameter("_auth_id"),
                                 "access_group"            => "",
@@ -531,7 +531,7 @@ class Repository_Action_Main_Sword_Index extends RepositoryAction
                             "index_name_english"      => $val['title_en'],
                             "parent_index_id"         => $val['pid'],
                             "comment"                 => $val['comment'],
-                            "public_state"            => "1",
+                            "public_state"            => 1,
                             "pub_date"                => $pubDate,
                             "access_role"             => $insert_auth_ids."|".$this->Session->getParameter("_auth_id"),
                             "access_group"            => "",
diff --git a/repository/action/main/sword/login/Login.class.php b/repository/action/main/sword/login/Login.class.php
index 76d6a1b..9472274 100644
--- a/repository/action/main/sword/login/Login.class.php
+++ b/repository/action/main/sword/login/Login.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Login.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Login.class.php 36294 2014-05-27 06:29:14Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/action/main/sword/servicedocument/Servicedocument.class.php b/repository/action/main/sword/servicedocument/Servicedocument.class.php
index 4b49b80..cfb8538 100644
--- a/repository/action/main/sword/servicedocument/Servicedocument.class.php
+++ b/repository/action/main/sword/servicedocument/Servicedocument.class.php
@@ -124,7 +124,7 @@ class Repository_Action_Main_Sword_Servicedocument extends RepositoryAction
         //   Full level 1 compliance REQUIRES implementation of the full set of extension elements and compliance with APP [ATOMPUB] as indicated by the SWORD profile of APP specified in this document.
         //  sword:verbose (true or false): Verbose Supported
         //  sword:noOp (true or false)   : no-Op Supported
-        $str .="<service xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns=\"http://www.w3.org/2007/app\" xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:sword=\"http://purl.org/net/sword/terms/\">" . "\n";
+        $str .="<service xmlns:dcterms=\"http://purl.org/dc/terms/\" xmlns=\"http://www.w3.org/2007/app\" xmlns:atom=\"http://www.w3.org/2005/Atom\" xmlns:sword=\"http://purl.org/net/sword/\">" . "\n";
         // V1.2 => V1.3 : <sword:level> removed.
 //      $str .="  <sword:level>" . $workspace['workspace']['level']  ."</sword:level>\n";
         // V1.2 => V1.3 : <sword:version> added.
@@ -207,7 +207,7 @@ class Repository_Action_Main_Sword_Servicedocument extends RepositoryAction
                 " FROM ".DATABASE_PREFIX."repository_index AS idx ";
         //検索特化対応
         if(_REPOSITORY_HIGH_SPEED){
-            $query .= " WHERE owner_user_id = '".$user_id."' AND idx.is_delete = '0' ";
+            $query .= " WHERE owner_user_id = '".$user_id."' AND idx.is_delete = 0 ";
         }else{
             // Mod OpenDepo 2014/01/31 S.Arata --start--
             if($user_auth_id >= $this->repository_admin_base && $auth_id >= $this->repository_admin_room)
@@ -224,7 +224,7 @@ class Repository_Action_Main_Sword_Servicedocument extends RepositoryAction
                 // Add OpenDepo 2013/12/02 R.Matsuura --end--
                 $query .= " INNER JOIN (".$publicIndexQuery.") pub ON idx.index_id = pub.index_id ";
             }
-            $query .= " WHERE idx.is_delete = '0' ";
+            $query .= " WHERE idx.is_delete = 0 ";
             // Mod OpenDepo 2014/01/31 S.Arata --end--
         }
         $query .= " ORDER BY show_order, index_id ";
diff --git a/repository/action/main/sword/serviceitemtype/Serviceitemtype.class.php b/repository/action/main/sword/serviceitemtype/Serviceitemtype.class.php
index c213ecf..cc7b367 100644
--- a/repository/action/main/sword/serviceitemtype/Serviceitemtype.class.php
+++ b/repository/action/main/sword/serviceitemtype/Serviceitemtype.class.php
@@ -20,7 +20,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/Factory.class.php';
 class Repository_Action_Main_Sword_Serviceitemtype extends RepositoryAction
 {
     
-    function executeForWeko()
+    function executeApp()
     {
         $swordManager = Repository_Components_Factory::getComponent('Repository_Components_Swordmanager');
         
diff --git a/repository/action/main/tree/Tree.class.php b/repository/action/main/tree/Tree.class.php
index 3cab0b0..006a941 100644
--- a/repository/action/main/tree/Tree.class.php
+++ b/repository/action/main/tree/Tree.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Tree.class.php 663 2014-12-18 02:25:06Z ivis $
+// $Id: Tree.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -459,8 +459,8 @@ class Repository_Action_Main_Tree extends RepositoryAction
     function getIndexData($id){
         // get click node data for make html
         $query = "SELECT * FROM ". DATABASE_PREFIX ."repository_index ".
-                 "WHERE index_id = '". $id ."' AND ".
-                 "is_delete = '0'; ";
+                 "WHERE index_id = ". $id ." AND ".
+                 "is_delete = 0; ";
         $result = $this->Db->execute($query);
         if($result === false || count($result)==0) {
             return "";
@@ -619,8 +619,8 @@ class Repository_Action_Main_Tree extends RepositoryAction
      */
     function checkPublic($idx_id){
         $query = "SELECT index_id FROM ". DATABASE_PREFIX ."repository_index ".
-                " WHERE index_id = '".$idx_id."' ".
-                " AND `public_state` = '1' ".
+                " WHERE index_id = ".$idx_id." ".
+                " AND `public_state` = 1 ".
                 //" AND `pub_date` <= '".date('Y-m-d 00:00:00.000',mktime())."'; ";
                 " AND `pub_date` <= NOW() ".
                 " AND `owner_user_id` = '';";   // Add not show privateTree K.Matsuo 2013/04/10
diff --git a/repository/action/main/uninstall/Uninstall.class.php b/repository/action/main/uninstall/Uninstall.class.php
index 259a99f..338bccc 100644
--- a/repository/action/main/uninstall/Uninstall.class.php
+++ b/repository/action/main/uninstall/Uninstall.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Uninstall.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Uninstall.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -90,11 +90,11 @@ class Repository_Action_main_Uninstall extends RepositoryAction
 		if(is_writable($define_inc_file_path)){
 			// Add file rewrite for privatetree edit tab authority K.Matsuo 2013/04/24 --start--
 			$fp = fopen($define_inc_file_path, "r");
-			$define_inc_text = array();
+			$define_inc_text = array();
 			while ($line = fgets($fp)) {
-				$define_inc_text[] = $line;
-			}
-			fclose($fp);
+				$define_inc_text[] = $line;
+			}
+			fclose($fp);
 			$fp = fopen($define_inc_file_path, "w");
 			for($ii = 0; $ii < count($define_inc_text); $ii++){
 				if(strpos($define_inc_text[$ii], "CHANGE_TEXT_PRIVATETREE") !== false){
diff --git a/repository/action/main/update/Update.class.php b/repository/action/main/update/Update.class.php
index b594b42..e075e4b 100644
--- a/repository/action/main/update/Update.class.php
+++ b/repository/action/main/update/Update.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Update.class.php 645 2014-10-29 12:39:52Z ivis $
+// $Id: Update.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -31,6 +31,9 @@ class Repository_Action_Main_Update extends RepositoryAction
     const KEY_REPOSITORY_SEARCH_TABLE_PROCESSING = "keyRepositorySearchTableProccessing";
     const KEY_REPOSITORY_INDEX_MANAGER = "KeyRepositoryIndexManager";
     const KEY_REPOSITORY_CLEANUP_DELETED_FILE = "KeyRepositoryCleanupDeletedFile";
+    const KEY_REPOSITORY_SEARCH_LOG = "KeyRepositorySearchLog";
+    const KEY_REPOSITORY_ELAPSEDTIME_LOG = "KeyRepositoryElapsedtimeLog";
+    const KEY_REPOSITORY_EXCLUDE_LOG = "KeyRepositoryExcludeLog";
     
     function execute()
     {
@@ -400,7 +403,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     // make file from BLOB
                     $query = "SELECT count(*) ".
                             " FROM ".DATABASE_PREFIX."repository_file; ";
-                    //      " WHERE is_delete = '0'; ";
+                    //      " WHERE is_delete = 0; ";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         fclose($pointer);
@@ -421,7 +424,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                         $pointer=fopen(WEBAPP_DIR.'/logs/weko/update_log.txt', "w");
                         $query = "SELECT item_id, attribute_id, file_no, extension, file ".
                                 " FROM ".DATABASE_PREFIX."repository_file ".
-                        //      " WHERE is_delete = '0' ".
+                        //      " WHERE is_delete = 0 ".
                                 " ORDER BY item_id ".
                                 " LIMIT ".$cnt_file.", 10; ";
                         fputs($pointer, 'query : '.$query."\n");
@@ -620,7 +623,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     // Add alternative language data 2009/07/17 A.Suzuki --start--
                     // repository_item : "title_english" 追加
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_item ".
-                             "ADD `title_english` TEXT default '' AFTER `title`;";
+                             "ADD `title_english` TEXT NOT NULL AFTER `title`;";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -630,7 +633,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     }
                     // repository_item : "title" 属性変更 [TEXT NOT NULL => TEXT default '']
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_item ".
-                             "MODIFY `title` TEXT default '';";
+                             "MODIFY `title` TEXT NOT NULL ;";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -640,7 +643,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     }
                     // repository_item : "serch_key_english" 追加
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_item ".
-                             "ADD `serch_key_english` TEXT default '' AFTER `serch_key`;";
+                             "ADD `serch_key_english` TEXT NOT NULL AFTER `serch_key`;";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -660,7 +663,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     }
                     // repository_biblio_info : "biblio_name_english" 追加
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_biblio_info ".
-                             "ADD `biblio_name_english` TEXT AFTER `biblio_name`;";
+                             "ADD `biblio_name_english` TEXT NOT NULL AFTER `biblio_name`;";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -670,7 +673,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     }
                     // repository_ranking : "disp_name_english" 追加
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_ranking ".
-                             "ADD `disp_name_english` TEXT AFTER `disp_name`;";
+                             "ADD `disp_name_english` TEXT NOT NULL AFTER `disp_name`;";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -751,7 +754,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                              " `supple_weko_item_id` INT, ".
                              " `supple_title` TEXT, ".
                              " `supple_title_en` TEXT, ".
-                             " `uri` TEXT default '', ".
+                             " `uri` TEXT, ".
                              " `supple_item_type_name` TEXT, ".
                              " `mime_type` TEXT, ".
                              " `file_id` INT, ".
@@ -1247,7 +1250,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                 case 141:
                     // Extend file type 2009/12/10 A.Suzuki --start--
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_file ".
-                             "ADD `display_name` TEXT default '' AFTER `file_name`;";
+                             "ADD `display_name` TEXT NOT NULL AFTER `file_name`;";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -1423,7 +1426,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                 case 144:
                     // Add host in log table Y.Nakao 2010/03/05 --start--
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_log ".
-                            " ADD `host` TEXT default '' AFTER `ip_address`; ";
+                            " ADD `host` TEXT NOT NULL AFTER `ip_address`; ";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -1464,7 +1467,7 @@ class Repository_Action_Main_Update extends RepositoryAction
 
                     // Add simple keyword search 2010/04/12 A.Suzuki --start--
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_fulltext_data ".
-                            " ADD `metadata` LONGTEXT default '' AFTER `extracted_text`; ";
+                            " ADD `metadata` LONGTEXT NOT NULL AFTER `extracted_text`; ";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -1559,7 +1562,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                         throw $exception;
                     }
                     $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_log ".
-                            " ADD `user_agent` TEXT default '' AFTER `host`; ";
+                            " ADD `user_agent` TEXT NOT NULL AFTER `host`; ";
                     $ret = $this->Db->execute($query);
                     if($ret === false){
                         $errMsg = "Error case 145<br/>";
@@ -1648,7 +1651,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                              " `name` VARCHAR(255), ".
                              " `family_ruby` VARCHAR(255), ".
                              " `name_ruby` VARCHAR(255), ".
-                             " `e_mail_address` TEXT default '', ".
+                             " `e_mail_address` TEXT NOT NULL, ".
                              " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
                              " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
                              " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
@@ -1750,7 +1753,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                         throw $exception;
                     }
                     $query = "INSERT INTO ". DATABASE_PREFIX. "repository_external_author_id_prefix_seq_id ".
-                             " (`id`) VALUES ('3'); ";
+                             " (`id`) VALUES (3); ";
                     $retRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
                         $errMsg = $this->Db->ErrorMsg();
@@ -1915,7 +1918,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                         throw $exception;
                     }
                     $query = "ALTER TABLE ".DATABASE_PREFIX."repository_index ".
-                             "ADD select_index_list_name_english text NOT NULL default '' ".
+                             "ADD select_index_list_name_english text NOT NULL ".
                              "AFTER rss_display;";
                     $refRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
@@ -1925,7 +1928,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                         throw $exception;
                     }
                     $query = "ALTER TABLE ".DATABASE_PREFIX."repository_index ".
-                             "ADD select_index_list_name text NOT NULL default '' ".
+                             "ADD select_index_list_name text NOT NULL ".
                              "AFTER rss_display;";
                     $refRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
@@ -1992,7 +1995,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                 case 164:
                     // Add tree access control list 2011/12/28 Y.Nakao --start--
                     $query = "ALTER TABLE ".DATABASE_PREFIX."repository_index ".
-                             "ADD `exclusive_acl_group` TEXT NOT NULL default '' ".
+                             "ADD `exclusive_acl_group` TEXT NOT NULL ".
                              "AFTER access_group;";
                     $refRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
@@ -2002,7 +2005,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                         throw $exception;
                     }
                     $query = "ALTER TABLE ".DATABASE_PREFIX."repository_index ".
-                             "ADD `exclusive_acl_role` TEXT NOT NULL default '' ".
+                             "ADD `exclusive_acl_role` TEXT NOT NULL ".
                              "AFTER access_group;";
                     $refRef = $this->Db->execute($query);
                     if($retRef === false || count($retRef)!=1){
@@ -2127,21 +2130,21 @@ class Repository_Action_Main_Update extends RepositoryAction
 
                     // itemtype for harvesting
                     $query = "INSERT INTO ".DATABASE_PREFIX."repository_item_type VALUE ".
-                             "('20001', 'DublinCore', 'DublinCore', 'harvesting item type', 'Journal Article', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20002', 'Journal Article', 'Journal Article', 'harvesting item type', 'Journal Article', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20003', 'Thesis or Dissertation', 'Thesis or Dissertation', 'harvesting item type', 'Thesis or Dissertation', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20004', 'Departmental Bulletin Paper', 'Departmental Bulletin Paper', 'harvesting item type', 'Departmental Bulletin Paper', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20005', 'Conference Paper', 'Conference Paper', 'harvesting item type', 'Conference Paper', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20006', 'Presentation', 'Presentation', 'harvesting item type', 'Presentation', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20007', 'Book', 'Book', 'harvesting item type', 'Book', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20008', 'Technical Report', 'Technical Report', 'harvesting item type', 'Technical Report', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20009', 'Research Paper', 'Research Paper', 'harvesting item type', 'Research Paper', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20010', 'Article', 'Article', 'harvesting item type', 'Article', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20011', 'Preprint', 'Preprint', 'harvesting item type', 'Preprint', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20012', 'Learning Material', 'Learning Material', 'harvesting item type', 'Learning Material', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20013', 'Data or Dataset', 'Data or Dataset', 'harvesting item type', 'Data or Dataset', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20014', 'Software', 'Software', 'harvesting item type', 'Software', '', '', '', '', ?, ?, '0', ?, ?, '', '0'), ".
-                             "('20015', 'Others', 'Others', 'harvesting item type', 'Others', '', '', '', '', ?, ?, '0', ?, ?, '', '0')";
+                             "(20001, 'DublinCore', 'DublinCore', 'harvesting item type', 'Journal Article', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20002, 'Journal Article', 'Journal Article', 'harvesting item type', 'Journal Article', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20003, 'Thesis or Dissertation', 'Thesis or Dissertation', 'harvesting item type', 'Thesis or Dissertation', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20004, 'Departmental Bulletin Paper', 'Departmental Bulletin Paper', 'harvesting item type', 'Departmental Bulletin Paper', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20005, 'Conference Paper', 'Conference Paper', 'harvesting item type', 'Conference Paper', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20006, 'Presentation', 'Presentation', 'harvesting item type', 'Presentation', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20007, 'Book', 'Book', 'harvesting item type', 'Book', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20008, 'Technical Report', 'Technical Report', 'harvesting item type', 'Technical Report', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20009, 'Research Paper', 'Research Paper', 'harvesting item type', 'Research Paper', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20010, 'Article', 'Article', 'harvesting item type', 'Article', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20011, 'Preprint', 'Preprint', 'harvesting item type', 'Preprint', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20012, 'Learning Material', 'Learning Material', 'harvesting item type', 'Learning Material', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20013, 'Data or Dataset', 'Data or Dataset', 'harvesting item type', 'Data or Dataset', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20014, 'Software', 'Software', 'harvesting item type', 'Software', '', '', '', '', ?, ?, '0', ?, ?, '', 0), ".
+                             "(20015, 'Others', 'Others', 'harvesting item type', 'Others', '', '', '', '', ?, ?, '0', ?, ?, '', 0)";
                     $params = array();
                     for($ii=20001; $ii<=20015; $ii++)
                     {
@@ -2165,23 +2168,23 @@ class Repository_Action_Main_Update extends RepositoryAction
                              "`dublin_core_mapping`, `display_lang_type`, `ins_user_id`, `mod_user_id`, ".
                              "`del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES ";
                     $params = array();
-                    $query .= "('20001', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '2', '2', '著者名', '著者名', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '3', '3', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '4', '4', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '5', '5', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '6', '6', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '7', '7', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '8', '8', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '9', '9', '資源識別子', '資源識別子', 'link', '0', '1', '0', '0', '0', 'URI', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '10', '10', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '11', '11', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '12', '12', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '13', '13', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '14', '14', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '15', '15', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '16', '16', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('20001', '17', '17', 'コンテンツ更新日時', 'コンテンツ更新日時', 'date', '1', '0', '0', '0', '1', '', '', '', ?, ?, '', ?, ?, '', '0')";
+                    $query .= "(20001, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 2, 2, '著者名', '著者名', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 3, 3, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 4, 4, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 5, 5, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 6, 6, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 7, 7, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 8, 8, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 9, 9, '資源識別子', '資源識別子', 'link', 0, 1, 0, 0, 0, 'URI', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 10, 10, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 11, 11, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 12, 12, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 13, 13, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 14, 14, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 15, 15, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 16, 16, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(20001, 17, 17, 'コンテンツ更新日時', 'コンテンツ更新日時', 'date', 1, 0, 0, 0, 1, '', '', '', ?, ?, '', ?, ?, '', 0)";
                     for($ii=1; $ii<=17; $ii++)
                     {
                         $params[] = $user_id;   // ins_user_id
@@ -2192,60 +2195,60 @@ class Repository_Action_Main_Update extends RepositoryAction
                     for($ii=20002; $ii<=20015; $ii++)
                     {
                         $query .= ", ";
-                        $query .= "(?, '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'japanese', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'japanese', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'japanese', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '25', '25', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '26', '26', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '27', '27', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '28', '28', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '29', '29', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '30', '30', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '31', '31', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '32', '32', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '33', '33', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '34', '34', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '35', '35', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '36', '36', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '37', '37', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '38', '38', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '39', '39', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '40', '40', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '41', '41', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '42', '42', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '43', '43', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '44', '44', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '45', '45', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '46', '46', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '47', '47', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '48', '48', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '49', '49', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '50', '50', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '51', '51', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '52', '52', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '53', '53', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '54', '54', 'コンテンツ更新日時', 'コンテンツ更新日時', 'date', '1', '0', '0', '0', '1', '', '', '', ?, ?, '', ?, ?, '', '0')";
+                        $query .= "(?, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'japanese', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'japanese', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'japanese', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 25, 25, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 26, 26, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 27, 27, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 28, 28, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 29, 29, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 30, 30, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 31, 31, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 32, 32, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 33, 33, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 34, 34, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 35, 35, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 36, 36, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 37, 37, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 38, 38, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 39, 39, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 40, 40, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 41, 41, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 42, 42, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 43, 43, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 44, 44, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 45, 45, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 46, 46, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 47, 47, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 48, 48, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 49, 49, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 50, 50, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 51, 51, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 52, 52, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 53, 53, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 54, 54, 'コンテンツ更新日時', 'コンテンツ更新日時', 'date', 1, 0, 0, 0, 1, '', '', '', ?, ?, '', ?, ?, '', 0)";
                         if($ii==20015)
                         {
                             $query .= ";";
@@ -2271,9 +2274,9 @@ class Repository_Action_Main_Update extends RepositoryAction
                     $params = array();
                     for($ii=20002; $ii<=20015; $ii++)
                     {
-                        $query .= "(?, '51', '1', 'author', 'author', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '51', '2', 'publisher', 'publisher', ?, ?, '', ?, ?, '', '0'), ".
-                                  "(?, '51', '3', 'none', 'none', ?, ?, '', ?, ?, '', '0')";
+                        $query .= "(?, 51, 1, 'author', 'author', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 51, 2, 'publisher', 'publisher', ?, ?, '', ?, ?, '', 0), ".
+                                  "(?, 51, 3, 'none', 'none', ?, ?, '', ?, ?, '', 0)";
                         if($ii==20015)
                         {
                             $query .= ";";
@@ -2369,21 +2372,21 @@ class Repository_Action_Main_Update extends RepositoryAction
                             $params[] = "見出し"; // attribute_name
                             $params[] = "見出し"; // attribute_short_name
                             $params[] = "heading"; // input_type
-                            $params[] = "0"; // is_required
-                            $params[] = "0"; // plural_enable
-                            $params[] = "0"; // line_feed_enable
-                            $params[] = "0"; // list_view_enable
-                            $params[] = "0"; // hidden
+                            $params[] = 0; // is_required
+                            $params[] = 0; // plural_enable
+                            $params[] = 0; // line_feed_enable
+                            $params[] = 0; // list_view_enable
+                            $params[] = 0; // hidden
                             $params[] = ""; // junii2_mapping
                             $params[] = ""; // dublin_core_mapping
                             $params[] = ""; // display_lang_type
                             $params[] = $attr["ins_user_id"]; // ins_user_id
                             $params[] = $attr["ins_user_id"]; // mod_user_id
-                            $params[] = "0"; // del_user_id
+                            $params[] = 0; // del_user_id
                             $params[] = $attr["ins_date"]; // ins_date
                             $params[] = $attr["ins_date"]; // mod_date
                             $params[] = ""; // del_date
-                            $params[] = "0"; // is_delete
+                            $params[] = 0; // is_delete
                             $result = $this->Db->execute($query, $params);
                             if($result === false){
                                 $errMsg = $this->Db->ErrorMsg();
@@ -2426,7 +2429,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     // Add default item type 'Others' --start--
                     // Insert to repository_item_type table
                     $query = "INSERT INTO ".DATABASE_PREFIX."repository_item_type VALUE ".
-                             "('10010', 'その他 / Others', 'その他 / Others', 'default item type', 'Others', '', '', '', '', ?, ?, '0', ?, ?, '', '0'); ";
+                             "(10010, 'その他 / Others', 'その他 / Others', 'default item type', 'Others', '', '', '', '', ?, ?, '0', ?, ?, '', 0); ";
                     $params = array();
                     $params[] = $user_id;   // ins_user_id
                     $params[] = $user_id;   // mod_user_id
@@ -2448,29 +2451,29 @@ class Repository_Action_Main_Update extends RepositoryAction
                              "`dublin_core_mapping`, `display_lang_type`, `ins_user_id`, `mod_user_id`, ".
                              "`del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES ";
                     $params = array();
-                    $query .= "('10010', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '2', '2', '著者', '著者', 'name', '1', '1', '1', '1', '0', 'creator', 'creator', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '3', '3', '著者別名', '著者別名', 'name', '0', '1', '0', '0', '0', '', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '7', '7', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '12', '12', '論文ID（NAID）', '論文ID（NAID）', 'text', '0', '0', '0', '0', '0', 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '13', '13', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '14', '14', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', '', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', ?, ?, '', ?, ?, '', '0')";
+                    $query .= "(10010, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 2, 2, '著者', '著者', 'name', 1, 1, 1, 1, 0, 'creator', 'creator', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 3, 3, '著者別名', '著者別名', 'name', 0, 1, 0, 0, 0, '', '', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 7, 7, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 12, 12, '論文ID（NAID）', '論文ID（NAID）', 'text', 0, 0, 0, 0, 0, 'identifier', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 13, 13, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 14, 14, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', '', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', ?, ?, '', ?, ?, '', 0)";
                     for($ii=1; $ii<=23; $ii++)
                     {
                         $params[] = $user_id;   // ins_user_id
@@ -2490,9 +2493,9 @@ class Repository_Action_Main_Update extends RepositoryAction
                              "`candidate_short_value`, `ins_user_id`, `mod_user_id`, ".
                              "`del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES ";
                     $params = array();
-                    $query .= "('10010', '20', '1', 'author', 'author', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '20', '2', 'publisher', 'publisher', ?, ?, '', ?, ?, '', '0'), ".
-                              "('10010', '20', '3', 'none', 'none', ?, ?, '', ?, ?, '', '0');";
+                    $query .= "(10010, 20, 1, 'author', 'author', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 20, 2, 'publisher', 'publisher', ?, ?, '', ?, ?, '', 0), ".
+                              "(10010, 20, 3, 'none', 'none', ?, ?, '', ?, ?, '', 0);";
                     for($ii=1; $ii<=3; $ii++)
                     {
                         $params[] = $user_id;   // ins_user_id
@@ -2529,7 +2532,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     }
                     $query = "CREATE TABLE ".DATABASE_PREFIX."repository_pdf_cover_parameter ( ".
                              " `param_name` TEXT(255), ".
-                             " `text` TEXT default '', ".
+                             " `text` TEXT NOT NULL, ".
                              " `image` LONGBLOB NOT NULL, ".
                              " `extension` TEXT NOT NULL, ".
                              " `mimetype` TEXT NOT NULL, ".
@@ -3100,7 +3103,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                     if(count($retRef) == 0){
                         $query = "INSERT INTO ".DATABASE_PREFIX."repository_item_type ".
                                  "VALUE".
-                                "('20016', 'Learning Object Matadata', 'Learning Object Matadata', 'harvesting item type', 'Learning Material', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');";
+                                "(20016, 'Learning Object Matadata', 'Learning Object Matadata', 'harvesting item type', 'Learning Material', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0);";
                         $retRef = $this->Db->execute($query);
                         if($retRef === false){
                             $errMsg = $this->Db->ErrorMsg();
@@ -3129,92 +3132,92 @@ class Repository_Action_Main_Update extends RepositoryAction
                                 "input_type, is_required, plural_enable, line_feed_enable, list_view_enable, hidden, ".
                                 "junii2_mapping, dublin_core_mapping, lom_mapping, display_lang_type, ".
                                 "ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) VALUES ".
-                                "('20016', '1', '1', 'URI', 'URI', 'link', '0', '1', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '2', '2', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '3', '3', 'NCID', 'NCID', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '4', '4', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '5', '5', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '6', '6', 'その他の識別子', 'その他の識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '7', '7', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '8', '8', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '9', '9', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '10', '10', '構成', '構成', 'select', '0', '0', '0', '0', '0', '', '', 'generalStructure', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '11', '11', '粒度', '粒度', 'select', '0', '0', '0', '0', '0', '', '', 'generalAggregationLevel', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '12', '12', 'エディション', 'エディション', 'text', '0', '0', '0', '0', '0', '', '', 'lifeCycleVersion', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '13', '13', 'ステータス', 'ステータス', 'select', '0', '0', '0', '0', '0', '', '', 'lifeCycleStatus', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '14', '14', '著者(creator)', '著者(creator)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '15', '15', '公開者(publisher)', '公開者(publisher)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '16', '16', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '17', '17', '作成者(initiator)', '作成者(initiator)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeInitiator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '18', '18', '更新者(terminator)', '更新者(terminator)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeTerminator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '19', '19', '校閲者(validator)', '校閲者(validator)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeValidator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '20', '20', '編集者(editor)', '編集者(editor)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeEditor', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '21', '21', '装丁(graphical designer)', '装丁(graphical designer)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeGraphicalDesigner', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '22', '22', '技術(technical implementer)', '技術(technical implementer)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeTechnicalImplementer', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '23', '23', 'コンテンツプロバイダー(content provider)', 'コンテンツプロバイダー(content provider)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeContentProvider', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '24', '24', '技術監修(technical validator)', '技術監修(technical validator)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeTechnicalValidator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '25', '25', '教育監修(educational validator)', '教育監修(educational validator)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeEducationalValidator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '26', '26', '台本(script writer)', '台本(script writer)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeScriptWriter', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '27', '27', '教育デザイン(instructional designer)', '教育デザイン(instructional designer)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeInstructionalDesigner', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '28', '28', '専門家(subject matter expert)', '専門家(subject matter expert)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeSubjectMatterExpert', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '29', '29', 'その他の関係者(unknown)', 'その他の関係者(unknown)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeUnknown', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '30', '30', 'その他の関係者', 'その他の関係者', 'text', '0', '1', '0', '0', '0', '', '', 'lifeCycleContribute', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '31', '31', 'メタデータ識別子', 'メタデータ識別子', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataIdentifer', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '32', '32', 'メタデータ作成者(creator)', 'メタデータ作成者(creator)', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataContributeCreator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '33', '33', 'メタデータ校閲者(validator)', 'メタデータ校閲者(validator)', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataContributeValidator', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '34', '34', 'その他のメタデータ関係者', 'その他のメタデータ関係者', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataContribute', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '35', '35', 'メタデータスキーマ', 'メタデータスキーマ', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataMetadataSchema', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '36', '36', 'メタデータ言語', 'メタデータ言語', 'text', '0', '0', '0', '0', '0', '', '', 'metaMetadataLanguage', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '37', '37', 'ファイルフォーマット', 'ファイルフォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '38', '38', 'ファイルサイズ', 'ファイルサイズ', 'text', '0', '0', '0', '0', '0', '', '', 'technicalSize', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '39', '39', 'ファイルリンク', 'ファイルリンク', 'text', '0', '1', '0', '0', '0', '', '', 'technicalLocation', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '40', '40', '動作環境', '動作環境', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeType', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '41', '41', '動作条件', '動作条件', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeName', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '42', '42', '推奨バージョン(下限)', '推奨バージョン(下限)', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeMinimumVersion', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '43', '43', '推奨バージョン(上限)', '推奨バージョン(上限)', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeMaximumVersion', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '44', '44', 'インストール手順', 'インストール手順', 'text', '0', '0', '0', '0', '0', '', '', 'technicalInstallationRemarks', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '45', '45', 'その他の技術要件', 'その他の技術要件', 'text', '0', '0', '0', '0', '0', '', '', 'technicalOtherPlatformRequirements', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '46', '46', '再生時間', '再生時間', 'text', '0', '0', '0', '0', '0', '', '', 'technicalDuration', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '47', '47', '授業形態', '授業形態', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalInteractivityType', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '48', 'リソースタイプ', 'リソースタイプ', 'checkbox', '0', '0', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '49', '49', '双方向性度合(interactivity level)', '双方向性度合(interactivity level)', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalInteractivityLevel', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '50', '50', '情報量(sematic density)', '情報量(sematic density)', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalSemanticDensity', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '51', '51', '利用者', '利用者', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalIntendedEndUserRole', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '52', '52', '利用環境', '利用環境', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalContext', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '53', '53', '対象年齢', '対象年齢', 'text', '0', '1', '0', '0', '0', '', '', 'educationalTypicalAgeRange', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '54', '54', '難易度', '難易度', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalDifficulty', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '55', '55', '授業時間', '授業時間', 'text', '0', '1', '0', '0', '0', '', '', 'educationalTypicalLearningTime', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '56', '56', '備考', '備考', 'textarea', '0', '1', '0', '0', '0', '', '', 'educationalDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '57', '57', '言語', '言語', 'text', '0', '1', '0', '0', '0', '', '', 'educationalLanguage', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '58', '58', '有料', '有料', 'select', '0', '0', '0', '0', '0', '', '', 'rightsCost', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '59', '59', '利用形態', '利用形態', 'select', '0', '0', '0', '0', '0', '', '', 'rightsCopyrightAndOtherRestrictions', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '60', '60', '権利', '権利', 'textarea', '0', '0', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '61', '61', 'PubMed番号', 'PubMed番号', 'text', '0', '1', '0', '0', '0', 'pmid', 'relation', 'relation', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '62', '62', 'DOI', 'DOI', 'text', '0', '1', '0', '0', '0', 'doi', 'relation', 'relation', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '63', '63', '異版である', '異版である', 'text', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '64', '64', '異版あり', '異版あり', 'text', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '65', '65', '要件とされる', '要件とされる', 'text', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '66', '66', '要件とする', '要件とする', 'text', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '67', '67', '部分である', '部分である', 'text', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '68', '68', '部分を持つ', '部分を持つ', 'text', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '69', '69', '参照される', '参照される', 'text', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '70', '70', '参照する', '参照する', 'text', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '71', '71', '別フォーマットである', '別フォーマットである', 'text', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '72', '72', '別フォーマットあり', '別フォーマットあり', 'text', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '73', '73', '基になる', '基になる', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relationIsBasisFor', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '74', '74', '基づいている', '基づいている', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relationIsBasedOn', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '75', '75', '他の資源との関係', '他の資源との関係', 'textarea', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '76', '76', 'コメント(件名)', 'コメント(件名)', 'text', '0', '1', '0', '0', '0', '', '', 'annotationEntity', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '77', '77', 'コメント(日付)', 'コメント(日付)', 'date', '0', '1', '0', '0', '0', '', '', 'annotationDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '78', '78', 'コメント', 'コメント', 'textarea', '0', '1', '0', '0', '0', '', '', 'annotationDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '79', '分類目的', '分類目的', 'checkbox', '0', '0', '0', '0', '0', '', '', 'classificationPurpose', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '80', '80', '分類ソース', '分類ソース', 'text', '0', '1', '0', '0', '0', '', '', 'classificationTaxonPathSource', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '81', '81', '分類', '分類', 'text', '0', '1', '0', '0', '0', '', '', 'classificationTaxon', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '82', '82', '分類説明', '分類説明', 'textarea', '0', '1', '0', '0', '0', '', '', 'classificationDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '83', '83', '分類キーワード', '分類キーワード', 'text', '0', '1', '0', '0', '0', '', '', 'classificationKeyword', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '84', '84', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '85', '85', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '86', '86', 'コンテンツ更新日時', 'コンテンツ更新日時', 'date', '1', '0', '0', '0', '1', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');";
+                                "(20016, 1, 1, 'URI', 'URI', 'link', 0, 1, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 2, 2, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 3, 3, 'NCID', 'NCID', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 4, 4, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 5, 5, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 6, 6, 'その他の識別子', 'その他の識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 7, 7, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 8, 8, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 9, 9, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 10, 10, '構成', '構成', 'select', 0, 0, 0, 0, 0, '', '', 'generalStructure', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 11, 11, '粒度', '粒度', 'select', 0, 0, 0, 0, 0, '', '', 'generalAggregationLevel', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 12, 12, 'エディション', 'エディション', 'text', 0, 0, 0, 0, 0, '', '', 'lifeCycleVersion', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 13, 13, 'ステータス', 'ステータス', 'select', 0, 0, 0, 0, 0, '', '', 'lifeCycleStatus', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 14, 14, '著者(creator)', '著者(creator)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 15, 15, '公開者(publisher)', '公開者(publisher)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 16, 16, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 17, 17, '作成者(initiator)', '作成者(initiator)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeInitiator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 18, 18, '更新者(terminator)', '更新者(terminator)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeTerminator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 19, 19, '校閲者(validator)', '校閲者(validator)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeValidator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 20, 20, '編集者(editor)', '編集者(editor)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeEditor', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 21, 21, '装丁(graphical designer)', '装丁(graphical designer)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeGraphicalDesigner', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 22, 22, '技術(technical implementer)', '技術(technical implementer)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeTechnicalImplementer', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 23, 23, 'コンテンツプロバイダー(content provider)', 'コンテンツプロバイダー(content provider)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeContentProvider', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 24, 24, '技術監修(technical validator)', '技術監修(technical validator)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeTechnicalValidator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 25, 25, '教育監修(educational validator)', '教育監修(educational validator)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeEducationalValidator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 26, 26, '台本(script writer)', '台本(script writer)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeScriptWriter', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 27, 27, '教育デザイン(instructional designer)', '教育デザイン(instructional designer)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeInstructionalDesigner', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 28, 28, '専門家(subject matter expert)', '専門家(subject matter expert)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeSubjectMatterExpert', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 29, 29, 'その他の関係者(unknown)', 'その他の関係者(unknown)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeUnknown', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 30, 30, 'その他の関係者', 'その他の関係者', 'text', 0, 1, 0, 0, 0, '', '', 'lifeCycleContribute', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 31, 31, 'メタデータ識別子', 'メタデータ識別子', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataIdentifer', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 32, 32, 'メタデータ作成者(creator)', 'メタデータ作成者(creator)', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataContributeCreator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 33, 33, 'メタデータ校閲者(validator)', 'メタデータ校閲者(validator)', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataContributeValidator', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 34, 34, 'その他のメタデータ関係者', 'その他のメタデータ関係者', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataContribute', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 35, 35, 'メタデータスキーマ', 'メタデータスキーマ', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataMetadataSchema', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 36, 36, 'メタデータ言語', 'メタデータ言語', 'text', 0, 0, 0, 0, 0, '', '', 'metaMetadataLanguage', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 37, 37, 'ファイルフォーマット', 'ファイルフォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 38, 38, 'ファイルサイズ', 'ファイルサイズ', 'text', 0, 0, 0, 0, 0, '', '', 'technicalSize', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 39, 39, 'ファイルリンク', 'ファイルリンク', 'text', 0, 1, 0, 0, 0, '', '', 'technicalLocation', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 40, 40, '動作環境', '動作環境', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeType', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 41, 41, '動作条件', '動作条件', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeName', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 42, 42, '推奨バージョン(下限)', '推奨バージョン(下限)', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeMinimumVersion', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 43, 43, '推奨バージョン(上限)', '推奨バージョン(上限)', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeMaximumVersion', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 44, 44, 'インストール手順', 'インストール手順', 'text', 0, 0, 0, 0, 0, '', '', 'technicalInstallationRemarks', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 45, 45, 'その他の技術要件', 'その他の技術要件', 'text', 0, 0, 0, 0, 0, '', '', 'technicalOtherPlatformRequirements', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 46, 46, '再生時間', '再生時間', 'text', 0, 0, 0, 0, 0, '', '', 'technicalDuration', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 47, 47, '授業形態', '授業形態', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalInteractivityType', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 48, 'リソースタイプ', 'リソースタイプ', 'checkbox', 0, 0, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 49, 49, '双方向性度合(interactivity level)', '双方向性度合(interactivity level)', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalInteractivityLevel', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 50, 50, '情報量(sematic density)', '情報量(sematic density)', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalSemanticDensity', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 51, 51, '利用者', '利用者', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalIntendedEndUserRole', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 52, 52, '利用環境', '利用環境', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalContext', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 53, 53, '対象年齢', '対象年齢', 'text', 0, 1, 0, 0, 0, '', '', 'educationalTypicalAgeRange', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 54, 54, '難易度', '難易度', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalDifficulty', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 55, 55, '授業時間', '授業時間', 'text', 0, 1, 0, 0, 0, '', '', 'educationalTypicalLearningTime', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 56, 56, '備考', '備考', 'textarea', 0, 1, 0, 0, 0, '', '', 'educationalDescription', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 57, 57, '言語', '言語', 'text', 0, 1, 0, 0, 0, '', '', 'educationalLanguage', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 58, 58, '有料', '有料', 'select', 0, 0, 0, 0, 0, '', '', 'rightsCost', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 59, 59, '利用形態', '利用形態', 'select', 0, 0, 0, 0, 0, '', '', 'rightsCopyrightAndOtherRestrictions', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 60, 60, '権利', '権利', 'textarea', 0, 0, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 61, 61, 'PubMed番号', 'PubMed番号', 'text', 0, 1, 0, 0, 0, 'pmid', 'relation', 'relation', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 62, 62, 'DOI', 'DOI', 'text', 0, 1, 0, 0, 0, 'doi', 'relation', 'relation', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 63, 63, '異版である', '異版である', 'text', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 64, 64, '異版あり', '異版あり', 'text', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 65, 65, '要件とされる', '要件とされる', 'text', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 66, 66, '要件とする', '要件とする', 'text', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 67, 67, '部分である', '部分である', 'text', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 68, 68, '部分を持つ', '部分を持つ', 'text', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 69, 69, '参照される', '参照される', 'text', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 70, 70, '参照する', '参照する', 'text', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 71, 71, '別フォーマットである', '別フォーマットである', 'text', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 72, 72, '別フォーマットあり', '別フォーマットあり', 'text', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 73, 73, '基になる', '基になる', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relationIsBasisFor', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 74, 74, '基づいている', '基づいている', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relationIsBasedOn', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 75, 75, '他の資源との関係', '他の資源との関係', 'textarea', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 76, 76, 'コメント(件名)', 'コメント(件名)', 'text', 0, 1, 0, 0, 0, '', '', 'annotationEntity', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 77, 77, 'コメント(日付)', 'コメント(日付)', 'date', 0, 1, 0, 0, 0, '', '', 'annotationDate', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 78, 78, 'コメント', 'コメント', 'textarea', 0, 1, 0, 0, 0, '', '', 'annotationDescription', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 79, '分類目的', '分類目的', 'checkbox', 0, 0, 0, 0, 0, '', '', 'classificationPurpose', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 80, 80, '分類ソース', '分類ソース', 'text', 0, 1, 0, 0, 0, '', '', 'classificationTaxonPathSource', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 81, 81, '分類', '分類', 'text', 0, 1, 0, 0, 0, '', '', 'classificationTaxon', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 82, 82, '分類説明', '分類説明', 'textarea', 0, 1, 0, 0, 0, '', '', 'classificationDescription', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 83, 83, '分類キーワード', '分類キーワード', 'text', 0, 1, 0, 0, 0, '', '', 'classificationKeyword', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 84, 84, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 85, 85, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 86, 86, 'コンテンツ更新日時', 'コンテンツ更新日時', 'date', 1, 0, 0, 0, 1, '', '', '', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0);";
                         $retRef = $this->Db->execute($query);
                         if($retRef === false){
                             $errMsg = $this->Db->ErrorMsg();
@@ -3242,76 +3245,76 @@ class Repository_Action_Main_Update extends RepositoryAction
 
                         $query = "INSERT INTO ".DATABASE_PREFIX."repository_item_attr_candidate ".
                                 "VALUE ".
-                                "('20016', '5', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '5', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '5', '3', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '10', '1', 'atomic', 'atomic', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '10', '2', 'collection', 'collection', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '10', '3', 'networked', 'networked', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '10', '4', 'hierarchical', 'hierarchical', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '10', '5', 'linear', 'linear', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '11', '1', '1', '1', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '11', '2', '2', '2', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '11', '3', '3', '3', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '11', '4', '4', '4', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '13', '1', 'draft', 'draft', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '13', '2', 'final', 'final', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '13', '3', 'revised', 'revised', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '13', '4', 'unavailable', 'unavailable', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '47', '1', 'active', 'active', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '47', '2', 'expositive', 'expositive', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '47', '3', 'mixed', 'mixed', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '1', 'exercise', 'exercise', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '2', 'simulation', 'simulation', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '3', 'questionnaire', 'questionnaire', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '4', 'diagram', 'diagram', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '5', 'figure', 'figure', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '6', 'graph', 'graph', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '7', 'index', 'index', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '8', 'slide', 'slide', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '9', 'table', 'table', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '10', 'narrative text', 'narrative text', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '11', 'exam', 'exam', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '12', 'experiment', 'experiment', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '13', 'problem statement', 'problem statement', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '14', 'self assessment', 'self assessment', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '48', '15', 'lecture', 'lecture', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '49', '1', 'very low', 'very low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '49', '2', 'low', 'low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '49', '3', 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '49', '4', 'high', 'high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '49', '5', 'very high', 'very high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '50', '1', 'very low', 'very low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '50', '2', 'low', 'low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '50', '3', 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '50', '4', 'high', 'high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '50', '5', 'very high', 'very high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '51', '1', 'teacher', 'teacher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '51', '2', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '51', '3', 'learner', 'learner', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '51', '4', 'manager', 'manager', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '52', '1', 'school', 'school', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '52', '2', 'higher education', 'higher education', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '52', '3', 'training', 'training', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '52', '4', 'other', 'other', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '54', '1', 'very easy', 'very easy', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '54', '2', 'easy', 'easy', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '54', '3', 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '54', '4', 'difficult', 'difficult', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '54', '5', 'very difficult', 'very difficult', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '58', '1', 'yes', 'yes', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '58', '2', 'no', 'no', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '59', '1', 'yes', 'yes', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '59', '2', 'no', 'no', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '1', 'discipline', 'discipline', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '2', 'idea', 'idea', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '3', 'prerequisite', 'prerequisite', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '4', 'educational objective', 'educational objective', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '5', 'accessibility restrictions', 'accessibility restrictions', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '6', 'educational level', 'educational level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '7', 'skill level', 'skill level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '8', 'security level', 'security level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                                "('20016', '79', '9', 'competency', 'competency', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');";
+                                "(20016, 5, 1, 'author', 'author', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 5, 2, 'publisher', 'publisher', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 5, 3, 'none', 'none', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 10, 1, 'atomic', 'atomic', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 10, 2, 'collection', 'collection', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 10, 3, 'networked', 'networked', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 10, 4, 'hierarchical', 'hierarchical', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 10, 5, 'linear', 'linear', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 11, 1, 1, 1, 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 11, 2, 2, 2, 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 11, 3, 3, 3, 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 11, 4, 4, 4, 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 13, 1, 'draft', 'draft', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 13, 2, 'final', 'final', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 13, 3, 'revised', 'revised', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 13, 4, 'unavailable', 'unavailable', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 47, 1, 'active', 'active', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 47, 2, 'expositive', 'expositive', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 47, 3, 'mixed', 'mixed', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 1, 'exercise', 'exercise', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 2, 'simulation', 'simulation', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 3, 'questionnaire', 'questionnaire', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 4, 'diagram', 'diagram', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 5, 'figure', 'figure', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 6, 'graph', 'graph', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 7, 'index', 'index', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 8, 'slide', 'slide', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 9, 'table', 'table', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 10, 'narrative text', 'narrative text', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 11, 'exam', 'exam', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 12, 'experiment', 'experiment', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 13, 'problem statement', 'problem statement', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 14, 'self assessment', 'self assessment', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 48, 15, 'lecture', 'lecture', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 49, 1, 'very low', 'very low', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 49, 2, 'low', 'low', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 49, 3, 'medium', 'medium', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 49, 4, 'high', 'high', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 49, 5, 'very high', 'very high', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 50, 1, 'very low', 'very low', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 50, 2, 'low', 'low', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 50, 3, 'medium', 'medium', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 50, 4, 'high', 'high', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 50, 5, 'very high', 'very high', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 51, 1, 'teacher', 'teacher', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 51, 2, 'author', 'author', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 51, 3, 'learner', 'learner', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 51, 4, 'manager', 'manager', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 52, 1, 'school', 'school', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 52, 2, 'higher education', 'higher education', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 52, 3, 'training', 'training', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 52, 4, 'other', 'other', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 54, 1, 'very easy', 'very easy', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 54, 2, 'easy', 'easy', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 54, 3, 'medium', 'medium', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 54, 4, 'difficult', 'difficult', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 54, 5, 'very difficult', 'very difficult', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 58, 1, 'yes', 'yes', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 58, 2, 'no', 'no', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 59, 1, 'yes', 'yes', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 59, 2, 'no', 'no', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 1, 'discipline', 'discipline', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 2, 'idea', 'idea', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 3, 'prerequisite', 'prerequisite', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 4, 'educational objective', 'educational objective', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 5, 'accessibility restrictions', 'accessibility restrictions', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 6, 'educational level', 'educational level', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 7, 'skill level', 'skill level', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 8, 'security level', 'security level', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                                "(20016, 79, 9, 'competency', 'competency', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0);";
                         $retRef = $this->Db->execute($query);
                         if($retRef === false){
                             $errMsg = $this->Db->ErrorMsg();
@@ -3367,10 +3370,10 @@ class Repository_Action_Main_Update extends RepositoryAction
                         {
                             $indertQuery .= ", ";
                         }
-                        $indertQuery .= " (?, ?, '1', 'author', 'author', ?, ?, '', ?, ?, '', '0'), ";
-                        $indertQuery .= " (?, ?, '2', 'publisher', 'publisher', ?, ?, '', ?, ?, '', '0'), ";
-                        $indertQuery .= " (?, ?, '3', 'ETD', 'ETD', ?, ?, '', ?, ?, '', '0'), ";
-                        $indertQuery .= " (?, ?, '4', 'none', 'none', ?, ?, '', ?, ?, '', '0') ";
+                        $indertQuery .= " (?, ?, 1, 'author', 'author', ?, ?, '', ?, ?, '', 0), ";
+                        $indertQuery .= " (?, ?, 2, 'publisher', 'publisher', ?, ?, '', ?, ?, '', 0), ";
+                        $indertQuery .= " (?, ?, 3, 'ETD', 'ETD', ?, ?, '', ?, ?, '', 0), ";
+                        $indertQuery .= " (?, ?, 4, 'none', 'none', ?, ?, '', ?, ?, '', 0) ";
                         for($jj=0; $jj<4; $jj++)
                         {
                             $insertParam[] = $result[$ii]['item_type_id'];
@@ -3602,7 +3605,7 @@ class Repository_Action_Main_Update extends RepositoryAction
                              " `item_type_id` INT NOT NULL default 0, ".
                              " `attribute_id` INT NOT NULL default 0, ".
                              " `language` VARCHAR(64) NOT NULL default '', ".
-                             " `item_type_name` TEXT NOT NULL default '', ".
+                             " `item_type_name` TEXT NOT NULL, ".
                              " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
                              " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
                              " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
@@ -3805,6 +3808,14 @@ class Repository_Action_Main_Update extends RepositoryAction
                     $this->updateWekoVersion215To216();
                 case 216:
                     $this->updateWekoVersion216To217();
+                // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+                case 217:
+                    $this->updateWekoVersion217To218();
+                // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+                // Add Gakunin 2015/01/16 T.Ichikawa --start--
+                case 218:
+                    $this->updateWekoVersion218To220();
+                // Add Gakunin 2015/01/16 T.Ichikawa --end--
                 default :
                     break;
             }
@@ -4007,7 +4018,7 @@ class Repository_Action_Main_Update extends RepositoryAction
             }
             $query .= "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
             $params[] = 20016;
-            $params[] = $key;
+            $params[] = intval($key);
             $params[] = "japanese";
             $params[] = $value;
             $params[] = $user_id;
@@ -4055,7 +4066,7 @@ class Repository_Action_Main_Update extends RepositoryAction
             }
             $query .= "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
             $params[] = 20016;
-            $params[] = $key;
+            $params[] = intval($key);
             $params[] = "english";
             $params[] = $value;
             $params[] = $user_id;
@@ -4098,7 +4109,7 @@ class Repository_Action_Main_Update extends RepositoryAction
             }
             $query .= "(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
             $params[] = 20016;
-            $params[] = $key;
+            $params[] = intval($key);
             $params[] = "chinese";
             $params[] = $value;
             $params[] = $user_id;
@@ -4597,10 +4608,10 @@ class Repository_Action_Main_Update extends RepositoryAction
 
         // create 'repository_send_feedbackmail_author_id' table
         $query = "CREATE TABLE ".DATABASE_PREFIX. RepositoryConst::DBTABLE_REPOSITORY_SEND_FEEDBACKMAIL_AUTHOR_ID." ( ".
-                " `item_id` int(11) NOT NULL default '0', ".
-                " `item_no` int(11) NOT NULL default '0', ".
-                " `author_id_no` int(11) NOT NULL default '0', ".
-                " `author_id` int(11) NOT NULL default '0', ".
+                " `item_id` int(11) NOT NULL default 0, ".
+                " `item_no` int(11) NOT NULL default 0, ".
+                " `author_id_no` int(11) NOT NULL default 0, ".
+                " `author_id` int(11) NOT NULL default 0, ".
                 " PRIMARY KEY  (`item_id`,`item_no`,`author_id_no`) ".
                 " ) ENGINE=MyISAM; ";
         $params = array();
@@ -4638,38 +4649,38 @@ class Repository_Action_Main_Update extends RepositoryAction
         }
         // create table
         $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_search_update_item ( ".
-                " `item_id` int(11) NOT NULL default '0', ".
-                " `item_no` int(11) NOT NULL default '0', ".
+                " `item_id` int(11) NOT NULL default 0, ".
+                " `item_no` int(11) NOT NULL default 0, ".
                 " PRIMARY KEY  (`item_id`,`item_no`) ".
                 " ) ENGINE=MyISAM; ";
         $this->dbAccess->executeQuery($query);
 
         $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_lock ( ".
                 " `process_name` varchar(60) NOT NULL default '', ".
-                " `status` int NOT NULL default '0', ".
-                " `comment` text NOT NULL default '', ".
+                " `status` int NOT NULL default 0, ".
+                " `comment` text NOT NULL, ".
                 " PRIMARY KEY  (`process_name`) ".
                 " ) ENGINE=innodb; ";
         $this->dbAccess->executeQuery($query);
 
         $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_search_item_setup ( ".
-                " `type_id` int NOT NULL default '0', ".
-                " `search_type` text NOT NULL default '', ".
-                " `use_search` int(1) NOT NULL default '0', ".
-                " `default_show` int(1) NOT NULL default '0', ".
-                " `junii2_mapping` text NOT NULL default '', ".
+                " `type_id` int NOT NULL default 0, ".
+                " `search_type` text NOT NULL, ".
+                " `use_search` int(1) NOT NULL default 0, ".
+                " `default_show` int(1) NOT NULL default 0, ".
+                " `junii2_mapping` text NOT NULL, ".
                 " PRIMARY KEY  (`type_id`) ".
                 " ) ENGINE=innodb; ";
         $this->dbAccess->executeQuery($query);
 
         $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_search_sort ( ".
-                " `item_id` int NOT NULL default '0', ".
-                " `item_no` int NOT NULL default '0', ".
-                " `item_type_id` int NOT NULL default '0', ".
+                " `item_id` int NOT NULL default 0, ".
+                " `item_no` int NOT NULL default 0, ".
+                " `item_type_id` int NOT NULL default 0, ".
                 " `weko_id` varchar(9) NOT NULL default '0', ".
-                " `title` text NOT NULL default '', ".
-                " `title_en` text NOT NULL default '', ".
-                " `uri` text NOT NULL default '', ".
+                " `title` text NOT NULL, ".
+                " `title_en` text NOT NULL, ".
+                " `uri` text NOT NULL, ".
                 " `review_date` varchar(23) NOT NULL default '', ".
                 " `ins_user_id` varchar(40) NOT NULL default '', ".
                 " `mod_date` varchar(23) NOT NULL default '', ".
@@ -4756,9 +4767,9 @@ class Repository_Action_Main_Update extends RepositoryAction
     private function createFullTextSearchTable($tableName, $isMroongaExist)
     {
         $query = "CREATE TABLE ".DATABASE_PREFIX. $tableName. " ( ".
-                " `item_id` int NOT NULL default '0', ".
-                " `item_no` int NOT NULL default '0', ".
-                " `metadata` longtext NOT NULL default '', ".
+                " `item_id` int NOT NULL default 0, ".
+                " `item_no` int NOT NULL default 0, ".
+                " `metadata` longtext NOT NULL, ".
                 " PRIMARY KEY  (`item_id`,`item_no`), ".
                 " FULLTEXT KEY `metadata` (`metadata`) ";
         if($isMroongaExist)
@@ -4780,9 +4791,9 @@ class Repository_Action_Main_Update extends RepositoryAction
     private function createDateSearchTable($tableName)
     {
         $query = "CREATE TABLE ".DATABASE_PREFIX. $tableName. " ( ".
-                " `item_id` int NOT NULL default '0', ".
-                " `item_no` int NOT NULL default '0', ".
-                " `data_no` int NOT NULL default '0', ".
+                " `item_id` int NOT NULL default 0, ".
+                " `item_no` int NOT NULL default 0, ".
+                " `data_no` int NOT NULL default 0, ".
                 " `metadata` varchar(23) NOT NULL default '', ".
                 " PRIMARY KEY  (`item_id`,`item_no`,`data_no`), ".
                 " INDEX `metadata` (`metadata`) ".
@@ -4818,30 +4829,30 @@ class Repository_Action_Main_Update extends RepositoryAction
     {
         $query = "INSERT INTO ". DATABASE_PREFIX. "repository_search_item_setup ".
                  "(`type_id`, `search_type`, `use_search`, `default_show`, `junii2_mapping` ) ".
-                 "VALUES ('1', 'repository_detail_search_show_name_title', 1, 1, 'title,alternative'), ".
-                 "('2', 'repository_detail_search_show_name_creator', 1, 1, 'creator'), ".
-                 "('3', 'repository_detail_search_show_name_subject', 0, 0, 'subject'), ".
-                 "('4', 'repository_detail_search_show_name_niisubject', 0, 0, 'NIIsubject,NDC,NDLC,BSH,NDLSH,MeSH,DDC,LCC,UDC,LCSH'), ".
-                 "('5', 'repository_detail_search_show_name_description', 0, 0, 'description'), ".
-                 "('6', 'repository_detail_search_show_name_publisher', 0, 0, 'publisher'), ".
-                 "('7', 'repository_detail_search_show_name_contributor', 0, 0, 'contributor'), ".
-                 "('8', 'repository_detail_search_show_name_date', 0, 0, 'date'), ".
-                 "('9', 'repository_detail_search_show_name_item_type', 0, 0, ''), ".
-                 "('10', 'repository_detail_search_show_name_type', 1, 1, 'type'), ".
-                 "('11', 'repository_detail_search_show_name_format', 0, 0, 'format'), ".
-                 "('12', 'repository_detail_search_show_name_id', 0, 0, 'identifier,URI,fullTextURL,selfDOI,ISBN,ISSN,NCID,pmid,doi,NAID,ichushi'), ".
-                 "('13', 'repository_detail_search_show_name_jtitle', 0, 0, 'jtitle'), ".
-                 "('14', 'repository_detail_search_show_name_dateofissued', 1, 1, 'dateofissued'), ".
-                 "('15', 'repository_detail_search_show_name_language', 0, 0, 'language'), ".
-                 "('16', 'repository_detail_search_show_name_spatial', 0, 0, 'spatial,NIIspatial'), ".
-                 "('17', 'repository_detail_search_show_name_temporal', 0, 0, 'temporal,NIItemporal'), ".
-                 "('18', 'repository_detail_search_show_name_rights', 0, 0, 'rights'), ".
-                 "('19', 'repository_detail_search_show_name_textversion', 0, 0, 'textversion'), ".
-                 "('20', 'repository_detail_search_show_name_grantid', 0, 0, 'grantid'), ".
-                 "('21', 'repository_detail_search_show_name_dateofgranted', 0, 0, 'dateofgranted'), ".
-                 "('22', 'repository_detail_search_show_name_degreename', 0, 0, 'degreename'), ".
-                 "('23', 'repository_detail_search_show_name_grantor', 0, 0, 'grantor'), ".
-                 "('24', 'repository_detail_search_show_name_index', 1, 1, ''); ";
+                 "VALUES (1, 'repository_detail_search_show_name_title', 1, 1, 'title,alternative'), ".
+                 "(2, 'repository_detail_search_show_name_creator', 1, 1, 'creator'), ".
+                 "(3, 'repository_detail_search_show_name_subject', 0, 0, 'subject'), ".
+                 "(4, 'repository_detail_search_show_name_niisubject', 0, 0, 'NIIsubject,NDC,NDLC,BSH,NDLSH,MeSH,DDC,LCC,UDC,LCSH'), ".
+                 "(5, 'repository_detail_search_show_name_description', 0, 0, 'description'), ".
+                 "(6, 'repository_detail_search_show_name_publisher', 0, 0, 'publisher'), ".
+                 "(7, 'repository_detail_search_show_name_contributor', 0, 0, 'contributor'), ".
+                 "(8, 'repository_detail_search_show_name_date', 0, 0, 'date'), ".
+                 "(9, 'repository_detail_search_show_name_item_type', 0, 0, ''), ".
+                 "(10, 'repository_detail_search_show_name_type', 1, 1, 'type'), ".
+                 "(11, 'repository_detail_search_show_name_format', 0, 0, 'format'), ".
+                 "(12, 'repository_detail_search_show_name_id', 0, 0, 'identifier,URI,fullTextURL,selfDOI,ISBN,ISSN,NCID,pmid,doi,NAID,ichushi'), ".
+                 "(13, 'repository_detail_search_show_name_jtitle', 0, 0, 'jtitle'), ".
+                 "(14, 'repository_detail_search_show_name_dateofissued', 1, 1, 'dateofissued'), ".
+                 "(15, 'repository_detail_search_show_name_language', 0, 0, 'language'), ".
+                 "(16, 'repository_detail_search_show_name_spatial', 0, 0, 'spatial,NIIspatial'), ".
+                 "(17, 'repository_detail_search_show_name_temporal', 0, 0, 'temporal,NIItemporal'), ".
+                 "(18, 'repository_detail_search_show_name_rights', 0, 0, 'rights'), ".
+                 "(19, 'repository_detail_search_show_name_textversion', 0, 0, 'textversion'), ".
+                 "(20, 'repository_detail_search_show_name_grantid', 0, 0, 'grantid'), ".
+                 "(21, 'repository_detail_search_show_name_dateofgranted', 0, 0, 'dateofgranted'), ".
+                 "(22, 'repository_detail_search_show_name_degreename', 0, 0, 'degreename'), ".
+                 "(23, 'repository_detail_search_show_name_grantor', 0, 0, 'grantor'), ".
+                 "(24, 'repository_detail_search_show_name_index', 1, 1, ''); ";
         $this->dbAccess->executeQuery($query);
         return true;
     }
@@ -4864,12 +4875,12 @@ class Repository_Action_Main_Update extends RepositoryAction
 
         // create new table
         $query = "CREATE TABLE ". DATABASE_PREFIX. "repository_index_browsing_authority ( ".
-                 "`index_id` int NOT NULL default '0', ".
-                 "`exclusive_acl_role_id` int NOT NULL default '0', ".
-                 "`exclusive_acl_room_auth` int NOT NULL default '0', ".
-                 "`public_state` INT(1) NOT NULL default '0', ".
+                 "`index_id` int NOT NULL default 0, ".
+                 "`exclusive_acl_role_id` int NOT NULL default 0, ".
+                 "`exclusive_acl_room_auth` int NOT NULL default 0, ".
+                 "`public_state` INT(1) NOT NULL default 0, ".
                  "`pub_date` VARCHAR(23), ".
-                 "`harvest_public_state` INT(1) NOT NULL default '1', ".
+                 "`harvest_public_state` INT(1) NOT NULL default 1, ".
                  "`ins_user_id` VARCHAR(40) NOT NULL default 0, ".
                  "`mod_user_id` VARCHAR(40) NOT NULL default 0, ".
                  "`del_user_id` VARCHAR(40) NOT NULL default 0, ".
@@ -4882,8 +4893,8 @@ class Repository_Action_Main_Update extends RepositoryAction
                  " ) ENGINE=MyISAM; ";
         $this->dbAccess->executeQuery($query);
         $query = "CREATE TABLE ". DATABASE_PREFIX. "repository_index_browsing_groups ( ".
-                 "`index_id` int NOT NULL default '0', ".
-                 "`exclusive_acl_group_id` int NOT NULL default '0', ".
+                 "`index_id` int NOT NULL default 0, ".
+                 "`exclusive_acl_group_id` int NOT NULL default 0, ".
                  "`ins_user_id` VARCHAR(40) NOT NULL default 0, ".
                  "`mod_user_id` VARCHAR(40) NOT NULL default 0, ".
                  "`del_user_id` VARCHAR(40) NOT NULL default 0, ".
@@ -4909,9 +4920,9 @@ class Repository_Action_Main_Update extends RepositoryAction
     {
         // create new table
         $query = "CREATE TABLE ". DATABASE_PREFIX. "repository_prefix ( ".
-                 "`id` int NOT NULL default '0', ".
-                 "`prefix_name` text NOT NULL default '', ".
-                 "`prefix_id` text NOT NULL default '', ".
+                 "`id` int NOT NULL default 0, ".
+                 "`prefix_name` text NOT NULL, ".
+                 "`prefix_id` text NOT NULL, ".
                  "`ins_user_id` VARCHAR(40) NOT NULL default '', ".
                  "`mod_user_id` VARCHAR(40) NOT NULL default '', ".
                  "`del_user_id` VARCHAR(40) NOT NULL default '', ".
@@ -4923,10 +4934,10 @@ class Repository_Action_Main_Update extends RepositoryAction
                  " ) ENGINE=innodb; ";
         $this->dbAccess->executeQuery($query);
         $query = "CREATE TABLE ". DATABASE_PREFIX. "repository_suffix ( ".
-                 "`item_id` int NOT NULL default '0', ".
-                 "`item_no` int NOT NULL default '0', ".
-                 "`id` int NOT NULL default '0', ".
-                 "`suffix` text NOT NULL default '', ".
+                 "`item_id` int NOT NULL default 0, ".
+                 "`item_no` int NOT NULL default 0, ".
+                 "`id` int NOT NULL default 0, ".
+                 "`suffix` text NOT NULL, ".
                  "`ins_user_id` VARCHAR(40) NOT NULL default '', ".
                  "`mod_user_id` VARCHAR(40) NOT NULL default '', ".
                  "`del_user_id` VARCHAR(40) NOT NULL default '', ".
@@ -4976,7 +4987,7 @@ class Repository_Action_Main_Update extends RepositoryAction
         
         $query = "UPDATE ". DATABASE_PREFIX. "repository_prefix".
                  " SET prefix_id = '". $YHandlePrefixParam[0]["param_value"]."'".
-                 " WHERE id = '10' ;";
+                 " WHERE id = 10 ;";
         $this->dbAccess->executeQuery($query);
         
         //JaLC DOI設定値をインデックスに追加する処理
@@ -5078,6 +5089,28 @@ class Repository_Action_Main_Update extends RepositoryAction
                         $this->cleanupDeletedFiles();
                     }
                     break;
+                 // Improve Search Log 2015/03/19 K.Sugimoto --start--
+                case self::KEY_REPOSITORY_SEARCH_LOG:
+                    if($value === true)
+                    {
+                        $this->addDetailSearchItemForExistSearchLog();
+                    }
+                    break;
+                 // Improve Search Log 2015/03/19 K.Sugimoto --end--
+                case self::KEY_REPOSITORY_ELAPSEDTIME_LOG:
+                    if($value === true)
+                    {
+                        $this->insertElapsedLogs();
+                    }
+                    break;
+                 // Improve Log 2015/06/17 K.Sugimoto --start--
+                case self::KEY_REPOSITORY_EXCLUDE_LOG:
+                    if($value === true)
+                    {
+                        $this->excludeLogOfRobotList();
+                    }
+                    break;
+                 // Improve Log 2015/06/17 K.Sugimoto --end--
                 default:
                     break;
             }
@@ -5091,9 +5124,9 @@ class Repository_Action_Main_Update extends RepositoryAction
     private function cleanupDeletedFiles()
     {
         $query = "CREATE TABLE IF NOT EXISTS ".DATABASE_PREFIX. "repository_filecleanup_deleted_file ( ".
-                " `item_id` int(11) NOT NULL default '0', ".
-                " `attribute_id` int(11) NOT NULL default '0', ".
-                " `file_no` int(11) NOT NULL default '0', ".
+                " `item_id` int(11) NOT NULL default 0, ".
+                " `attribute_id` int(11) NOT NULL default 0, ".
+                " `file_no` int(11) NOT NULL default 0, ".
                 " `extension` TEXT NOT NULL, ".
                 " PRIMARY KEY  (`item_id`,`attribute_id`,`file_no`) ".
                 " ) ENGINE=MyISAM; ";
@@ -5170,11 +5203,12 @@ class Repository_Action_Main_Update extends RepositoryAction
     private function insertLockTable($process_name, $status)
     {
         $query = "INSERT INTO ". DATABASE_PREFIX. "repository_lock ".
-                "(`process_name`, `status`) ".
-                "VALUES (?, ?); ";
+                "(`process_name`, `status`, `comment`) ".
+                "VALUES (?, ?, ?); ";
         $params = array();
         $params[] = $process_name;
         $params[] = $status;
+        $params[] = "";
         $this->dbAccess->executeQuery($query, $params);
         return true;
     }
@@ -5236,10 +5270,10 @@ class Repository_Action_Main_Update extends RepositoryAction
      private function createSiteLicenseMailTable() {
          $query = "CREATE TABLE ". DATABASE_PREFIX ."repository_send_mail_sitelicense (".
                   " `no` INT NOT NULL default 0, ".
-                  " `organization_name` TEXT NOT NULL default '', ".
+                  " `organization_name` TEXT NOT NULL, ".
                   " `start_ip_address` BIGINT default 0, ".
                   " `finish_ip_address` BIGINT default 0, ".
-                  " `mail_address` TEXT NOT NULL default '', ".
+                  " `mail_address` TEXT NOT NULL, ".
                   " PRIMARY KEY(`no`) ".
                   ") ENGINE=innodb;";
          $result = $this->dbAccess->executeQuery($query);
@@ -5252,9 +5286,9 @@ class Repository_Action_Main_Update extends RepositoryAction
      private function createIssnTable() {
          $query = "CREATE TABLE ". DATABASE_PREFIX ."repository_issn (".
                   " `issn` VARCHAR(9) NOT NULL default '', ".
-                  " `jtitle` TEXT NOT NULL default '', ".
-                  " `jtitle_en` TEXT NOT NULL default '', ".
-                  " `set_spec` TEXT NOT NULL default '', ".
+                  " `jtitle` TEXT NOT NULL, ".
+                  " `jtitle_en` TEXT NOT NULL, ".
+                  " `set_spec` TEXT NOT NULL, ".
                   " `ins_user_id` VARCHAR(40) NOT NULL default '0', ".
                   " `mod_user_id` VARCHAR(40) NOT NULL default '0', ".
                   " `del_user_id` VARCHAR(40) NOT NULL default '0', ".
@@ -5351,7 +5385,7 @@ class Repository_Action_Main_Update extends RepositoryAction
         $this->dbAccess->executeQuery($query);
         // Add referer
         $query = "ALTER TABLE ". DATABASE_PREFIX. "repository_log ".
-                 "ADD referer TEXT NOT NULL DEFAULT '' ".
+                 "ADD referer TEXT NOT NULL ".
                  "AFTER user_agent; ";
         $this->dbAccess->executeQuery($query);
      }
@@ -5413,7 +5447,7 @@ class Repository_Action_Main_Update extends RepositoryAction
     private function addLidoMapping()
     {
         $query = "ALTER TABLE ".DATABASE_PREFIX."repository_item_attr_type ".
-                 "ADD `lido_mapping` TEXT NOT NULL default '' ".
+                 "ADD `lido_mapping` TEXT NOT NULL ".
                  "AFTER `lom_mapping` ;";
         $this->dbAccess->executeQuery($query);
     }
@@ -5437,7 +5471,7 @@ class Repository_Action_Main_Update extends RepositoryAction
         {
             $query = "INSERT INTO ".DATABASE_PREFIX."repository_item_type ".
                      "VALUE".
-                    "('20017', 'LIDO', 'LIDO', 'harvesting item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');";
+                    "(20017, 'LIDO', 'LIDO', 'harvesting item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0);";
             $retRef = $this->dbAccess->executeQuery($query);
         }
         
@@ -5456,43 +5490,43 @@ class Repository_Action_Main_Update extends RepositoryAction
                     "input_type, is_required, plural_enable, line_feed_enable, list_view_enable, hidden, ".
                     "junii2_mapping, dublin_core_mapping, lom_mapping, lido_mapping, display_lang_type, ".
                     "ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) VALUES ".
-                    "('20017', '1', '1', 'lidoレコードID', 'lidoレコードID', 'text', '1', '1', '0', '0', '0', 'identifier', 'identifier', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '2', '2', '作品タイプID', '作品タイプID', 'text', '1', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '3', '3', '作品タイプ（語）', '作品タイプ（語）', 'text', '1', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '4', '4', '分類ID', '分類ID', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '5', '5', '分類（語）', '分類（語）', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '6', '6', '資料/作品名（値）', '資料/作品名（値）', 'text', '0', '1', '0', '0', '0', 'title', 'title', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '7', '7', '銘/題辞写', '銘/題辞写', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '8', '8', '所蔵者名（値）', '所蔵者名（値）', 'name', '0', '1', '0', '0', '0', 'rights', 'rights', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '9', '9', '所蔵者ウェブリンク', '所蔵者ウェブリンク', 'link', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '10', '10', '所蔵者資料/作品ID', '所蔵者資料/作品ID', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '11', '11', '資料/作品状態（状態）', '資料/作品状態（状態）', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '12', '12', '記述ノート（値）', '記述ノート（値）', 'text', '0', '1', '0', '0', '0', 'description', 'description', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '13', '13', '測定（表示用）', '測定（表示用）', 'text', '0', '1', '0', '0', '0', 'description', 'description', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '14', '14', 'イベント内容（表示用）', 'イベント内容（表示用）', 'textarea', '0', '1', '0', '0', '0', 'coverage', 'coverage', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '15', '15', 'イベントタイプ（語）', 'イベントタイプ（語）', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '16', '16', 'イベント行為者／役割（表示用）', 'イベント行為者／役割（表示用）', 'text', '0', '1', '0', '0', '0', 'description', 'description', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '17', '17', 'イベント発生期間(表示用)', 'イベント発生期間(表示用)', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '18', '18', 'イベント発生期間（西暦）（開始日）', 'イベント発生期間（西暦）（開始日）', 'date', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '19', '19', 'イベント発生期間（西暦）（終了日）', 'イベント発生期間（西暦）（終了日）', 'date', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '20', '20', 'イベント発生時代・年代（語）', 'イベント発生時代・年代（語）', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '21', '21', 'イベント発生地（表示用）', 'イベント発生地（表示用）', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '22', '22', 'イベント発生地緯度・経度', 'イベント発生地緯度・経度', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '23', '23', 'イベント素材/技術(表示用)', 'イベント素材/技術(表示用)', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '24', '24', '主題(表示用)', '主題(表示用)', 'text', '0', '1', '0', '0', '0', 'subject', 'subject', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '25', '25', '関連作品(表示用)', '関連作品(表示用)', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '26', '26', '記録ID', '記録ID', 'text', '1', '1', '0', '0', '0', 'source', 'source', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '27', '27', '記録タイプ（語）', '記録タイプ（語）', 'text', '1', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '28', '28', '記録者名（値）', '記録者名（値）', 'name', '1', '1', '0', '0', '0', 'creator', 'creator', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '29', '29', '記録情報リンク', '記録情報リンク', 'link', '0', '1', '0', '0', '0', 'URI', 'identifier', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '30', '30', '記録情報メタデータ記録日', '記録情報メタデータ記録日', 'date', '0', '1', '0', '0', '0', 'date', 'date', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '31', '31', 'リソースURL', 'リソースURL', 'link', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '32', '32', 'リソース説明/記述', 'リソース説明/記述', 'textarea', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '33', '33', 'リソース所有者名（値）', 'リソース所有者名（値）', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '34', '34', 'リソース権利クレジットライン', 'メタデータ校閲者(validator)リソース権利クレジットライン', 'text', '0', '1', '0', '0', '0', '', '', '', ?, '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '35', '35', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '36', '36', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),".
-                    "('20017', '37', '37', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0') ; ";
+                    "(20017, 1, 1, 'lidoレコードID', 'lidoレコードID', 'text', 1, 1, 0, 0, 0, 'identifier', 'identifier', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 2, 2, '作品タイプID', '作品タイプID', 'text', 1, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 3, 3, '作品タイプ（語）', '作品タイプ（語）', 'text', 1, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 4, 4, '分類ID', '分類ID', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 5, 5, '分類（語）', '分類（語）', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 6, 6, '資料/作品名（値）', '資料/作品名（値）', 'text', 0, 1, 0, 0, 0, 'title', 'title', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 7, 7, '銘/題辞写', '銘/題辞写', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 8, 8, '所蔵者名（値）', '所蔵者名（値）', 'name', 0, 1, 0, 0, 0, 'rights', 'rights', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 9, 9, '所蔵者ウェブリンク', '所蔵者ウェブリンク', 'link', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 10, 10, '所蔵者資料/作品ID', '所蔵者資料/作品ID', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 11, 11, '資料/作品状態（状態）', '資料/作品状態（状態）', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 12, 12, '記述ノート（値）', '記述ノート（値）', 'text', 0, 1, 0, 0, 0, 'description', 'description', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 13, 13, '測定（表示用）', '測定（表示用）', 'text', 0, 1, 0, 0, 0, 'description', 'description', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 14, 14, 'イベント内容（表示用）', 'イベント内容（表示用）', 'textarea', 0, 1, 0, 0, 0, 'coverage', 'coverage', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 15, 15, 'イベントタイプ（語）', 'イベントタイプ（語）', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 16, 16, 'イベント行為者／役割（表示用）', 'イベント行為者／役割（表示用）', 'text', 0, 1, 0, 0, 0, 'description', 'description', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 17, 17, 'イベント発生期間(表示用)', 'イベント発生期間(表示用)', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 18, 18, 'イベント発生期間（西暦）（開始日）', 'イベント発生期間（西暦）（開始日）', 'date', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 19, 19, 'イベント発生期間（西暦）（終了日）', 'イベント発生期間（西暦）（終了日）', 'date', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 20, 20, 'イベント発生時代・年代（語）', 'イベント発生時代・年代（語）', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 21, 21, 'イベント発生地（表示用）', 'イベント発生地（表示用）', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 22, 22, 'イベント発生地緯度・経度', 'イベント発生地緯度・経度', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 23, 23, 'イベント素材/技術(表示用)', 'イベント素材/技術(表示用)', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 24, 24, '主題(表示用)', '主題(表示用)', 'text', 0, 1, 0, 0, 0, 'subject', 'subject', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 25, 25, '関連作品(表示用)', '関連作品(表示用)', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 26, 26, '記録ID', '記録ID', 'text', 1, 1, 0, 0, 0, 'source', 'source', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 27, 27, '記録タイプ（語）', '記録タイプ（語）', 'text', 1, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 28, 28, '記録者名（値）', '記録者名（値）', 'name', 1, 1, 0, 0, 0, 'creator', 'creator', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 29, 29, '記録情報リンク', '記録情報リンク', 'link', 0, 1, 0, 0, 0, 'URI', 'identifier', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 30, 30, '記録情報メタデータ記録日', '記録情報メタデータ記録日', 'date', 0, 1, 0, 0, 0, 'date', 'date', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 31, 31, 'リソースURL', 'リソースURL', 'link', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 32, 32, 'リソース説明/記述', 'リソース説明/記述', 'textarea', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 33, 33, 'リソース所有者名（値）', 'リソース所有者名（値）', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 34, 34, 'リソース権利クレジットライン', 'メタデータ校閲者(validator)リソース権利クレジットライン', 'text', 0, 1, 0, 0, 0, '', '', '', ?, '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 35, 35, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 36, 36, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0),".
+                    "(20017, 37, 37, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', 1, 1, '', 2008-03-18 00:00:00.000, 2008-03-18 00:00:00.000, '', 0) ; ";
             
             $params = array();
             $params[] = RepositoryConst::LIDO_TAG_LIDO_REC_ID;
@@ -5608,10 +5642,10 @@ class Repository_Action_Main_Update extends RepositoryAction
         // create search engines url analyze rule table
         $query = "CREATE TABLE ". DATABASE_PREFIX. "repository_external_searchengine_analyticalrule ( ".
                  " `engine_id` INT NOT NULL default 0, ".
-                 " `engine_name` TEXT NOT NULL default '', ".
-                 " `domain` TEXT NOT NULL default '', ".
-                 " `search_word` TEXT NOT NULL default '', ".
-                 " `delimiter` TEXT NOT NULL default '', ".
+                 " `engine_name` TEXT NOT NULL, ".
+                 " `domain` TEXT NOT NULL, ".
+                 " `search_word` TEXT NOT NULL, ".
+                 " `delimiter` TEXT NOT NULL, ".
                  " `ins_user_id` VARCHAR(40) NOT NULL default '0', ".
                  " `mod_user_id` VARCHAR(40) NOT NULL default '0', ".
                  " `del_user_id` VARCHAR(40) NOT NULL default '0', ".
@@ -5990,5 +6024,869 @@ class Repository_Action_Main_Update extends RepositoryAction
         $query .= ";";
         $this->dbAccess->executeQuery($query, $params);
     }
+
+    // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+    /**
+     * update Weko Version 2.1.7 To 2.1.8
+     *
+     */
+    private function updateWekoVersion217To218()
+    {
+        // add Default Search Type
+        $this->addDefaultSearchTypeParameter();
+        
+        // add Usage Statistics link display setting
+        $this->addUsageStatisticsLinkDisplayParameter();
+
+        // add ranking tab display
+        $this->addRankingTabDisplayParameter();
+        
+        // add Institution Name
+        $this->addInstitutionName();
+
+        // add Itemtype Exclusive Authority Tables
+        $this->createItemtypeAuthorityTable();
+        
+        // version up to 2.1.8
+        $this->versionUp('2.1.8');
+    }
+    
+    /**
+     * add Default Search Type
+     *
+     */
+    private function addDefaultSearchTypeParameter()
+    {
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_parameter ".
+                 "(param_name, param_value, explanation, ".
+                 " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                 "VALUES ";
+        $params = array();
+        $query .= "(?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+        $params[] = "default_search_type"; // param_name
+        $params[] = 0; // param_value
+        $params[] = "検索設定のデフォルト値設定 0:全文検索 1:キーワード検索"; // explanation
+        $params[] = $this->Session->getParameter("_user_id");;   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");;   // mod_user_id
+        $params[] = $this->TransStartDate;  // ins_date
+        $params[] = $this->TransStartDate;  // mod_date
+        $params[] = 0; // is delete
+        $query .= ";";
+        $this->dbAccess->executeQuery($query, $params);
+    }
+    // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+    
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+    /**
+     * add Usage Statistics link display setting
+     */
+    private function addUsageStatisticsLinkDisplayParameter()
+    {
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_parameter ".
+                "(param_name, param_value, explanation, ".
+                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                "VALUES ";
+        $params = array();
+        $query .= "(?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+        $params[] = "usagestatistics_link_display"; // param_name
+        $params[] = 1; // param_value
+        $params[] = "利用統計リンク表示設定 0:表示しない 1:表示する"; // explanation
+        $params[] = $this->Session->getParameter("_user_id");;   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");;   // mod_user_id
+        $params[] = $this->TransStartDate;  // ins_date
+        $params[] = $this->TransStartDate;  // mod_date
+        $params[] = 0; // is delete
+        $query .= ";";
+        $this->dbAccess->executeQuery($query, $params);
+    }
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+    /**
+     * add ranking tab display
+     *
+     */
+    private function addRankingTabDisplayParameter()
+    {
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_parameter ".
+                "(param_name, param_value, explanation, ".
+                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                "VALUES ";
+        $params = array();
+        $query .= "(?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+        $params[] = "ranking_tab_display"; // param_name
+        $params[] = 1; // param_value
+        $params[] = "ランキングタブ表示値設定 0:表示しない 1:表示する"; // explanation
+        $params[] = $this->Session->getParameter("_user_id");;   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");;   // mod_user_id
+        $params[] = $this->TransStartDate;  // ins_date
+        $params[] = $this->TransStartDate;  // mod_date
+        $params[] = 0; // is delete
+        $query .= ";";
+        $this->dbAccess->executeQuery($query, $params);
+    }
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+    
+    /**
+     * add Institution Name
+     *
+     */
+    private function addInstitutionName()
+    {
+        $user_id = $this->Session->getParameter("_user_id");
+        // Add new record to parameter table
+        $query = "INSERT INTO " . DATABASE_PREFIX. "repository_parameter ".
+        "(param_name, param_value, explanation, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) " . 
+        "VALUES (?, '', ?, ?, ?, ?, ?, ?, '', ?)";
+        
+        $params = array();
+        $params[] = "institution_name";
+        $params[] = "Google Scholar メタタグ出力用機関名称設定値";
+        $params[] = $user_id;
+        $params[] = $user_id;
+        $params[] = "0";
+        $params[] = $this->TransStartDate;
+        $params[] = $this->TransStartDate;
+        $params[] = 0;
+        
+        $this->dbAccess->executeQuery($query, $params);
+    }
+    
+    /**
+     * create itemtype authority tables
+     *
+     */
+    private function createItemtypeAuthorityTable()
+    {
+        // create exclusive base authority table
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_item_type_exclusive_base_auth ( ".
+                " `item_type_id` int(11) NOT NULL default 0, ".
+                " `exclusive_base_auth_id` int(11) NOT NULL default 0, ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default '0', ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default '0', ".
+                " `del_user_id` VARCHAR(40) NOT NULL default '0', ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`item_type_id`,`exclusive_base_auth_id`) ".
+                " ) ENGINE=innodb; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // create exclusive room authority table
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_item_type_exclusive_room_auth ( ".
+                " `item_type_id` int(11) NOT NULL default 0, ".
+                " `exclusive_room_auth_id` int(11) NOT NULL default 0, ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default '0', ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default '0', ".
+                " `del_user_id` VARCHAR(40) NOT NULL default '0', ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`item_type_id`) ".
+                " ) ENGINE=innodb; ";
+        $this->dbAccess->executeQuery($query);
+    }
+    
+    /**
+     * update Weko Version 2.1.8 To 2.2.0
+     *
+     */
+    private function updateWekoVersion218To220()
+    {
+        // add Sitelicense Information Tables
+        $this->createSitelicenseInfoTable();
+        
+        // Add CrossRef Metadata Auto Input and Add DataCite 2015/02/03 K.Sugimoto --start--
+        // add CrossRef Metadata Auto Input
+        $this->addCrossrefQueryService();
+        
+        // add DataCite
+        $this->addDataCite();
+        // Add CrossRef Metadata Auto Input and Add DataCite 2015/02/03 K.Sugimoto --end--
+        
+	    // Extend Search Keyword 2015/02/20 K.Sugimoto --start--
+        // convert search table hankaku
+        $this->convertSearchTableKana();
+	    // Extend Search Keyword 2015/02/20 K.Sugimoto --end--
+        
+        // add operation_log table
+        $this->addOperationlog();
+        
+        // add elapsed time log table
+        $this->addElapsedTimeLog();
+        
+        // create exclusion list tables
+        $this->createLogExclusionListTables();
+        
+        // Improve Search Log 2015/03/19 K.Sugimoto --start--
+        // add detail search item
+        $this->addDetailSearchItem();
+        // Improve Search Log 2015/03/19 K.Sugimoto --end--
+        
+        // bug fix external searchword empty 2015/04/09 K.Sugimoto --start--
+        // delete external searchword empty
+        $this->deleteExternalSearchwordEmpty();
+        // bug fix external searchword empty 2015/04/09 K.Sugimoto --end--
+        
+        // update licence master creative common's link
+        $this->updateLicenseMasterLinks();
+        
+        $this->recursiveProcessingFlgList[self::KEY_REPOSITORY_ELAPSEDTIME_LOG] = true;
+        
+        // version up to 2.2.0
+        $this->versionUp('2.2.0');
+    }
+    
+    /**
+     * update licence master creative common's link
+     *
+     */
+    private function updateLicenseMasterLinks()
+    {
+        $query = "SELECT * ".
+                 "FROM ".DATABASE_PREFIX. "repository_license_master ";
+        
+        $result = $this->dbAccess->executeQuery($query);
+        
+        for ($ii = 0; $ii < count($result); $ii++) 
+        {
+            $query = "UPDATE ".DATABASE_PREFIX. "repository_license_master ". 
+                     "SET text_url = ?".
+                     "WHERE license_id = ?";
+            
+            $params = array();
+            if ($result[$ii]["license_id"] == 101) {
+                $params[] = "http://creativecommons.org/licenses/by/3.0/deed.ja";
+            }
+            else if ($result[$ii]["license_id"] == 102) {
+                $params[] = "http://creativecommons.org/licenses/by-sa/3.0/deed.ja";
+            }
+            else if ($result[$ii]["license_id"] == 103) {
+                $params[] = "http://creativecommons.org/licenses/by-nd/3.0/deed.ja";
+            }
+            else if ($result[$ii]["license_id"] == 104) {
+                $params[] = "http://creativecommons.org/licenses/by-nc/3.0/deed.ja";
+            }
+            else if ($result[$ii]["license_id"] == 105) {
+                $params[] = "http://creativecommons.org/licenses/by-nc-sa/3.0/deed.ja";
+            }
+            else {
+                $params[] = "http://creativecommons.org/licenses/by-nc-nd/3.0/deed.ja";
+            }
+            
+            $params[] = $result[$ii]["license_id"];
+            
+            $this->dbAccess->executeQuery($query, $params);
+        }
+    }
+    
+    /**
+     * create log exclusion list tables of ip_address and user_agent
+     *
+     */
+    private function createLogExclusionListTables()
+    {
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_robotlist_master (". 
+                 "robotlist_id int(4) NOT NULL, ".
+                 "robotlist_url text, ".
+                 "is_robotlist_use int(1) NOT NULL, ".
+                 "del_column varchar(40) NOT NULL, ".
+                 "robotlist_version varchar(40) NOT NULL, ".
+                 "robotlist_date varchar(100) NOT NULL, ".
+                 "robotlist_revision varchar(40) NOT NULL, ".
+                 "robotlist_author varchar(100) NOT NULL, ".
+                 "ins_user_id varchar(40) NOT NULL default '0', ".
+                 "mod_user_id varchar(40) NOT NULL default '0', ".
+                 "del_user_id varchar(40) NOT NULL default '0', ".
+                 "ins_date varchar(23) default NULL, ".
+                 "mod_date varchar(23) default NULL, ".
+                 "del_date varchar(23) default NULL, ".
+                 "is_delete int(1) default NULL, ".
+                 "PRIMARY KEY  (`robotlist_id`) ".
+                 ") ENGINE=InnoDb DEFAULT CHARSET=utf8; ";
+        $this->dbAccess->executeQuery($query);
+        
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_robotlist_data (". 
+                 "list_id int(10) NOT NULL AUTO_INCREMENT, ".
+                 "robotlist_id int(4) NOT NULL, ".
+                 "word text, ".
+                 "status varchar(2) NOT NULL default '0', ".
+                 "ins_user_id varchar(40) NOT NULL default '0', ".
+                 "mod_user_id varchar(40) NOT NULL default '0', ".
+                 "del_user_id varchar(40) NOT NULL default '0', ".
+                 "ins_date varchar(23) default NULL, ".
+                 "mod_date varchar(23) default NULL, ".
+                 "del_date varchar(23) default NULL, ".
+                 "is_delete int(1) default NULL, ".
+                 "PRIMARY KEY  (`list_id`) ".
+                 ") ENGINE=InnoDb DEFAULT CHARSET=utf8; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // Improve Log 2015/06/17 K.Sugimoto --start--
+        $ipAddressCrawlerList = 'https://bitbucket.org/niijp/jairo-crawler-list/raw/master/JAIRO_Crawler-List_ip_blacklist.txt';
+        $userAgentCrawlerList = 'https://bitbucket.org/niijp/jairo-crawler-list/raw/master/JAIRO_Crawler-List_useragent.txt';
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_robotlist_master ".
+                 "(robotlist_id, robotlist_url, is_robotlist_use, del_column, robotlist_version, robotlist_date, robotlist_revision, robotlist_author, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                 "VALUES (?, ?, ?, ?, '', '', '', '', ?, ?, ?, ?, ?, ?, ?),".
+                 "(?, ?, ?, ?, '', '', '', '', ?, ?, ?, ?, ?, ?, ?) ;";
+        $params = array();
+        $params[] = 1;                                          // robotlist_id
+        $params[] = $ipAddressCrawlerList;                      // robotlist_url
+        $params[] = 1;                                          // is_robotlist_use
+        $params[] = 'ip_address';                               // del_column
+        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+        $params[] = "";                                         // del_user_id
+        $params[] = $this->TransStartDate;                      // ins_date
+        $params[] = $this->TransStartDate;                      // mod_date
+        $params[] = "";                                         // del_date
+        $params[] = 0;                                          // is_delete
+        
+        $params[] = 2;                                          // robotlist_id
+        $params[] = $userAgentCrawlerList;                      // robotlist_url
+        $params[] = 1;                                          // is_robotlist_use
+        $params[] = 'user_agent';                               // del_column
+        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+        $params[] = "";                                         // del_user_id
+        $params[] = $this->TransStartDate;                      // ins_date
+        $params[] = $this->TransStartDate;                      // mod_date
+        $params[] = "";                                         // del_date
+        $params[] = 0;                                          // is_delete
+        $this->dbAccess->executeQuery($query, $params);
+        
+        $this->insertLockTable('Repository_Action_Common_Robotlist', 0);
+        $this->insertLockTable('Repository_Action_Common_Background_Deleterobotlist', 0);
+        
+        $this->recursiveProcessingFlgList[self::KEY_REPOSITORY_EXCLUDE_LOG] = true;
+        // Improve Log 2015/06/17 K.Sugimoto --end--
+    }
+    
+    /**
+     * create elapsed log table
+     *
+     */
+    private function addElapsedTimeLog()
+    {
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_log_elapsed_time (". 
+                     "`log_no` INT, ". 
+                     "`elapsed_time` INT, ". 
+                     "`ins_user_id` VARCHAR(40) NOT NULL default '0',". 
+                     "`mod_user_id` VARCHAR(40) NOT NULL default '0',". 
+                     "`del_user_id` VARCHAR(40) NOT NULL default '0',". 
+                     "`ins_date` VARCHAR(23),". 
+                     "`mod_date` VARCHAR(23),". 
+                     "`del_date` VARCHAR(23),". 
+                     "`is_delete` INT(1),". 
+                     "PRIMARY KEY(`log_no`)". 
+                 ") ENGINE=MyISAM;";
+         $this->dbAccess->executeQuery($query);
+        
+        $this->insertLockTable('Repository_Action_Common_Background_Elapsedtime', 0);
+        
+        // Improve Log 2015/06/17 K.Sugimoto --start--
+        $query = "ALTER TABLE ".DATABASE_PREFIX. RepositoryConst::DBTABLE_REPOSITORY_LOG. " ".
+                 "ADD INDEX ". RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE. " (".
+                 RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE. "); ";
+        $this->dbAccess->executeQuery($query);
+        // Improve Log 2015/06/17 K.Sugimoto --end--
+    }
+    
+    /**
+     * create sitelicense tables
+     *
+     */
+    private function createSitelicenseInfoTable()
+    {
+        // create info table
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_sitelicense_info ( ".
+                " `organization_id` int(11) NOT NULL default 0, ".
+                " `show_order` int default 0, ".
+                " `organization_name` text NOT NULL, ".
+                " `group_name` text NOT NULL, ".
+                " `mail_address` VARCHAR(255) NOT NULL, ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`organization_id`) ".
+                " ) ENGINE=innodb; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // create ip address table
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_sitelicense_ip_address ( ".
+                " `organization_id` int(11) NOT NULL default 0, ".
+                " `organization_no` int(11) NOT NULL default 0, ".
+                " `start_ip_address` VARCHAR(16) NOT NULL, ".
+                " `finish_ip_address` VARCHAR(16) NOT NULL, ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`organization_id`, `organization_no`) ".
+                " ) ENGINE=innodb; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // insert data
+        $query = "SELECT param_value FROM ". DATABASE_PREFIX. "repository_parameter ".
+                 "WHERE param_name = ? ;";
+        $params = array();
+        $params[] = "site_license";
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if(strlen($result[0]["param_value"]) > 0) {
+            // 機関毎に分割する
+            $sitelicenses = explode("|", $result[0]["param_value"]);
+            // データを「機関名」「開始IP」「終了IP」「メールアドレス」に分割する
+            $organization_id = 0; // 機関ID
+            $show_order = 0;      // ソート順番
+            for($ii = 0; $ii < count($sitelicenses); $ii++) {
+                $sitelicense_data = explode(",", $sitelicenses[$ii]);
+                // 機関ID
+                $organization_id++;
+                $show_order++;
+                // 機関名
+                $organization_name = $sitelicense_data[0];
+                $organization_name = str_replace("&#124;", "|", $organization_name);
+                $organization_name = str_replace("&#44;", ",", $organization_name);
+                $organization_name = str_replace("&#46;", ".", $organization_name);
+                // 開始IPアドレス
+                $start_ip_address = $sitelicense_data[1];
+                // 終了IPアドレス
+                $finish_ip_address = $sitelicense_data[2];
+                // メールアドレス
+                $mail_address = $sitelicense_data[3];
+                $mail_address = str_replace("&#124;", "|", $mail_address);
+                $mail_address = str_replace("&#44;", ",", $mail_address);
+                $mail_address = str_replace("&#46;", ".", $mail_address);
+                
+                // insert base info
+                $query = "INSERT INTO ". DATABASE_PREFIX. "repository_sitelicense_info ".
+                         "(organization_id, show_order, organization_name, group_name, mail_address, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                         "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ;";
+                $params = array();
+                $params[] = $organization_id;                           // organization_id
+                $params[] = $show_order;                                // show order
+                $params[] = $organization_name;                         // organization_name
+                $params[] = "";                                         // group_name
+                $params[] = $mail_address;                              // mail_address
+                $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+                $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+                $params[] = "";                                         // del_user_id
+                $params[] = $this->TransStartDate;                      // ins_date
+                $params[] = $this->TransStartDate;                      // mod_date
+                $params[] = "";                                         // del_date
+                $params[] = 0;                                          // is_delete
+                $this->dbAccess->executeQuery($query, $params);
+                
+                // insert ip address
+                $query = "INSERT INTO ". DATABASE_PREFIX. "repository_sitelicense_ip_address ".
+                         "(organization_id, organization_no, start_ip_address, finish_ip_address, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                         "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ;";
+                $params = array();
+                $params[] = $organization_id;                           // organization_id
+                $params[] = 1;                                          // organization_no
+                $params[] = $start_ip_address;                          // start_ip_address
+                $params[] = $finish_ip_address;                         // finish_ip_address
+                $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+                $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+                $params[] = "";                                         // del_user_id
+                $params[] = $this->TransStartDate;                      // ins_date
+                $params[] = $this->TransStartDate;                      // mod_date
+                $params[] = "";                                         // del_date
+                $params[] = 0;                                          // is_delete
+                $this->dbAccess->executeQuery($query, $params);
+            }
+            
+            // delete sitelicense data from parameter table
+            $query = "DELETE FROM ". DATABASE_PREFIX. "repository_parameter ".
+                     "WHERE param_name = ? ;";
+            $params = array();
+            $params[] = "site_license";
+            $this->dbAccess->executeQuery($query, $params);
+        }
+        // サイトライセンスメール送信先テーブル
+        // IPアドレス情報カラムを削除し、組織名カラムを追加する
+        $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_send_mail_sitelicense ".
+                 "DROP `start_ip_address` ; ";
+        $this->dbAccess->executeQuery($query);
+        $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_send_mail_sitelicense ".
+                 "DROP `finish_ip_address` ; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // ログテーブルにサイトライセンス機関情報保存用カラムを作成する
+        $query = "ALTER TABLE ". DATABASE_PREFIX ."repository_log ".
+                 "ADD `site_license_id` INT(11) default 0 ".
+                 "AFTER `site_license` ;";
+        $this->dbAccess->executeQuery($query);
+        
+    }
+    
+    // Add CrossRef Metadata Auto Input and Add DataCite 2015/02/03 K.Sugimoto --start--
+    /**
+     * add CrossRef metadata auto input
+     *
+     */
+    private function addCrossrefQueryService()
+    {
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_parameter ".
+                "(param_name, param_value, explanation, ".
+                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                "VALUES ";
+        $params = array();
+        $query .= "(?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+        $params[] = "crossref_query_service_account"; // param_name
+        $params[] = ""; // param_value
+        $params[] = "CrossRef APIにアクセスするための設定値(メールアドレス)"; // explanation
+        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+        $params[] = $this->TransStartDate;  // ins_date
+        $params[] = $this->TransStartDate;  // mod_date
+        $params[] = 0; // is delete
+        $query .= ";";
+        $this->dbAccess->executeQuery($query, $params);
+    }
+
+    /**
+     * add DataCite
+     *
+     */
+    private function addDataCite()
+    {
+    	// プレフィックステーブルにDataCite DOIプレフィックスレコードを追加
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_prefix ".
+                "(id, prefix_name, prefix_id, ".
+                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                "VALUES ";
+        $params = array();
+        $query .= "(?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+        $params[] = 25; // id
+        $params[] = "DataCite"; // prefix_name
+        $params[] = ""; // prefix_id
+        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+        $params[] = $this->TransStartDate;  // ins_date
+        $params[] = $this->TransStartDate;  // mod_date
+        $params[] = 0; // is delete
+        $query .= ";";
+        $this->dbAccess->executeQuery($query, $params);
+        
+        // パラメータテーブルにYハンドルPrefixフラグレコードを追加
+        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_parameter ".
+                "(param_name, param_value, explanation, ".
+                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+                "VALUES ";
+        $params = array();
+        $query .= "(?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+        $params[] = "prefix_flag"; // param_name
+        $params[] = 0; // param_value
+        $params[] = "DOI付与時、YハンドルのPrefixIDをSuffixに付与するか否か(0:付与しない,1:付与する) すでにDOIを付与されている場合は変更できない"; // explanation
+        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+        $params[] = $this->TransStartDate;  // ins_date
+        $params[] = $this->TransStartDate;  // mod_date
+        $params[] = 0; // is delete
+        $query .= ";";
+        $this->dbAccess->executeQuery($query, $params);
+
+        // DOI付与フラグを取得
+        $query = "SELECT param_name ".
+                 "FROM ".DATABASE_PREFIX."repository_parameter ".
+                 "WHERE param_name LIKE ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = "edit_doi_flag_%";
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+
+        // パラメータテーブルからDOI付与フラグを削除
+        $query = "DELETE FROM ".DATABASE_PREFIX."repository_parameter ".
+                 "WHERE param_name LIKE ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = "edit_doi_flag_%";
+        $params[] = 0;
+        $this->dbAccess->executeQuery($query, $params);
+        
+        // DOI付与判定テーブルを作成
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_doi_flag ( ".
+                " `doi_flag_id` INT NOT NULL, ".
+                " `nii_type` text NOT NULL, ".
+                " `jalc` INT(2) NOT NULL default '0', ".
+                " `multiple_resolution` INT(2) NOT NULL default '0', ".
+                " `crossref` INT(2) NOT NULL default '0', ".
+                " `datacite` INT(2) NOT NULL default '0', ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`doi_flag_id`) ".
+                " ) ENGINE=innodb; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // DOI付与判定フラグを追加
+        for($i = 0; $i < count($result); $i++)
+        {
+	        if(isset($result[$i]["param_name"]))
+	        {
+		        $niiType = str_replace("edit_doi_flag_", "", $result[$i]["param_name"]);
+		        $niiType = str_replace("_", " ", $niiType);
+		        
+		        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_doi_flag ".
+		                "(doi_flag_id, nii_type, jalc, multiple_resolution, crossref, datacite, ".
+		                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+		                "VALUES ";
+		        $params = array();
+		        $query .= "(?, ?, ?, ?, ?, ?, ?, ?, '', ?, ?, '', ?)";
+		        $params[] = $i + 1; // doi_flag_id
+		        $params[] = $niiType; // nii_type
+		        if($niiType === "others")
+		        {
+			        $params[] = 0; // jalc
+		        }
+		        else
+		        {
+			        $params[] = 1; // jalc
+		        }
+		        if($niiType === "thesis or dissertation")
+		        {
+		        	$params[] = 1; // multiple_resolution
+		        }
+		        else
+		        {
+		        	$params[] = 0; // multiple_resolution
+		        }
+		        if(($niiType === "data or dataset") 
+		           || ($niiType === "learning material") 
+		           || ($niiType === "others") 
+		           || ($niiType === "presentation") 
+		           || ($niiType === "software") 
+		           || ($niiType === "thesis or dissertation"))
+		        {
+			        $params[] = 0; // crossref
+		        }
+		        else
+		        {
+			        $params[] = 1; // crossref
+		        }
+		        if(($niiType === "data or dataset") || ($niiType === "software"))
+		        {
+			        $params[] = 1; // datacite
+		        }
+		        else
+		        {
+			        $params[] = 0; // datacite
+		        }
+		        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+		        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+		        $params[] = $this->TransStartDate;  // ins_date
+		        $params[] = $this->TransStartDate;  // mod_date
+		        $params[] = 0; // is delete
+		        $query .= ";";
+		        $this->dbAccess->executeQuery($query, $params);
+	        }
+        }
+    }
+    // Add CrossRef Metadata Auto Input and Add DataCite 2015/02/03 K.Sugimoto --end--
+    
+    // Improve Search Log 2015/03/19 K.Sugimoto --start--
+    /**
+     * improve search log
+     *
+     */
+    private function addDetailSearchItem()
+    {
+        // 詳細検索項目テーブルを作成
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_log_detail_search ( ".
+                " `log_no` INT NOT NULL, ".
+                " `advanced_search_id` INT(2) NOT NULL, ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`log_no`,`advanced_search_id`) ".
+                " ) ENGINE=MyISAM; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // 集計対象詳細検索項目テーブルを作成
+        $query = "CREATE TABLE ".DATABASE_PREFIX. "repository_target_search_item ( ".
+                " `search_item_id` INT(2) NOT NULL, ".
+                " `ranking_flag` INT NOT NULL, ".
+                " `ins_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `mod_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `del_user_id` VARCHAR(40) NOT NULL default 0, ".
+                " `ins_date` VARCHAR(23), ".
+                " `mod_date` VARCHAR(23), ".
+                " `del_date` VARCHAR(23), ".
+                " `is_delete` INT(1), ".
+                " PRIMARY KEY  (`search_item_id`) ".
+                " ) ENGINE=innodb; ";
+        $this->dbAccess->executeQuery($query);
+        
+        // 既存キーワード検索ログ検索項目追加
+        $this->recursiveProcessingFlgList[self::KEY_REPOSITORY_SEARCH_LOG] = true;
+        
+    	// 集計対象の詳細検索項目を追加
+    	for($ii = 0; $ii < 26; $ii++)
+    	{
+	        $query = "INSERT INTO ". DATABASE_PREFIX. "repository_target_search_item ".
+	                "(search_item_id, ranking_flag, ".
+	                " ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) ".
+	                "VALUES ";
+	        $params = array();
+	        $query .= "(?, ?, ?, ?, '', ?, ?, '', ?)";
+	        $params[] = $ii; // search_item_id
+	        if($ii == 0 || $ii == 1 || $ii == 2 || $ii == 3 || $ii == 5 || $ii == 6 || $ii == 7 || $ii == 13)
+	        {
+		        $params[] = 1; // ranking_flag
+	        }
+	        else
+	        {
+		        $params[] = 0; // ranking_flag
+	        }
+	        $params[] = $this->Session->getParameter("_user_id");   // ins_user_id
+	        $params[] = $this->Session->getParameter("_user_id");   // mod_user_id
+	        $params[] = $this->TransStartDate;  // ins_date
+	        $params[] = $this->TransStartDate;  // mod_date
+	        $params[] = 0; // is delete
+	        $query .= ";";
+	        $this->dbAccess->executeQuery($query, $params);
+        }
+        
+        // ロックテーブルに既存検索ログ検索項目追加クラスを追加
+        $this->insertLockTable('Repository_Action_Common_Background_Detailsearchitem', 0);
+    }
+    
+    /**
+     * execute recursive proccessing of DetailSearchItem
+     *
+     */
+    private function addDetailSearchItemForExistSearchLog()
+    {
+        if (!isset($_SERVER["SERVER_PORT"])) // NULLの時
+        {
+            //BASE_URLの先頭をチェックしてhttps://なら443を$_SERVER["SERVER_PORT"]に入力
+            if ( preg_match("/^https\:\/\//", BASE_URL) ) {
+                $_SERVER["SERVER_PORT"] = 443;
+            }
+            //BASE_URLの先頭をチェックしてhttp://なら80を$_SERVER["SERVER_PORT"]に入力
+            else if ( preg_match("/^http\:\/\//", BASE_URL) ){
+                $_SERVER["SERVER_PORT"] = 80;
+            }
+        }
+        
+        $startLogNo = 1;
+        
+        // Request parameter for next URL
+        $nextRequest = BASE_URL."/?action=repository_action_common_background_detailsearchitem&log_no=".$startLogNo;
+        $result = RepositoryProcessUtility::callAsyncProcess($nextRequest);
+        return $result;
+    }
+    // Improve Search Log 2015/03/19 K.Sugimoto --end--
+    
+    /**
+     * execute recursive proccessing of ElapsedtimeLog
+     *
+     */
+    private function insertElapsedLogs()
+    {
+        if (!isset($_SERVER["SERVER_PORT"])) // NULLの時
+        {
+            //BASE_URLの先頭をチェックしてhttps://なら443を$_SERVER["SERVER_PORT"]に入力
+            if ( preg_match("/^https\:\/\//", BASE_URL) ) {
+                $_SERVER["SERVER_PORT"] = 443;
+            }
+            //BASE_URLの先頭をチェックしてhttp://なら80を$_SERVER["SERVER_PORT"]に入力
+            else if ( preg_match("/^http\:\/\//", BASE_URL) ){
+                $_SERVER["SERVER_PORT"] = 80;
+            }
+        }
+        
+        // Request parameter for next URL
+        $nextRequest = BASE_URL."/?action=repository_action_common_background_elapsedtime";
+        $result = RepositoryProcessUtility::callAsyncProcess($nextRequest);
+        return $result;
+    }
+    
+    /**
+     * add operation_log table
+     */
+    private function addOperationlog()
+    {
+        // create repository_operation_log table
+        $query = "CREATE TABLE {repository_operation_log} ( ".
+            " `log_id` INT, ".
+            " `record_date` VARCHAR(23) NOT NULL, ".
+            " `user_id` VARCHAR(40) NOT NULL default 0, ".
+            " `request_parameter` TEXT, ".
+            " `start_log_id` INT default 0, ".
+            " PRIMARY KEY(`log_id`) ".
+            ") ENGINE=MyISAM;";
+        $this->dbAccess->executeQuery($query);
+    }
+
+    // Extend Search Keyword 2015/02/20 K.Sugimoto --start--
+    /**
+     * Convert Search Table Hankaku
+     *
+     */
+    private function convertSearchTableKana()
+    {
+        $this->recursiveProcessingFlgList[self::KEY_REPOSITORY_SEARCH_TABLE_PROCESSING] = true;
+    }
+    // Extend Search Keyword 2015/02/20 K.Sugimoto --end--
+    
+    // bug fix external searchword empty 2015/04/09 K.Sugimoto --start--
+    /**
+     * delete external searchword empty
+     */
+    private function deleteExternalSearchwordEmpty()
+    {
+        $query = "DELETE FROM ". DATABASE_PREFIX. "repository_item_external_searchword ".
+                 "WHERE word = ? ;";
+        $params = array();
+        $params[] = '';
+        $this->dbAccess->executeQuery($query, $params);
+    }
+    // bug fix external searchword empty 2015/04/09 K.Sugimoto --end--
+    
+    // ImproveLog 2015/06/17 K.Sugimoto --start--
+    /**
+     * execute recursive proccessing of RobotList
+     *
+     */
+    private function excludeLogOfRobotList()
+    {
+        if (!isset($_SERVER["SERVER_PORT"])) // NULLの時
+        {
+            //BASE_URLの先頭をチェックしてhttps://なら443を$_SERVER["SERVER_PORT"]に入力
+            if ( preg_match("/^https\:\/\//", BASE_URL) ) {
+                $_SERVER["SERVER_PORT"] = 443;
+            }
+            //BASE_URLの先頭をチェックしてhttp://なら80を$_SERVER["SERVER_PORT"]に入力
+            else if ( preg_match("/^http\:\/\//", BASE_URL) ){
+                $_SERVER["SERVER_PORT"] = 80;
+            }
+        }
+        
+        // Request parameter for next URL
+        $nextRequest = BASE_URL."/?action=repository_action_common_robotlist";
+        $result = RepositoryProcessUtility::callAsyncProcess($nextRequest);
+        return $result;
+    }
+    // ImproveLog 2015/06/17 K.Sugimoto --end--
 }
 ?>
diff --git a/repository/action/main/user/User.class.php b/repository/action/main/user/User.class.php
index 61e7318..74c16b2 100644
--- a/repository/action/main/user/User.class.php
+++ b/repository/action/main/user/User.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: User.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: User.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/bibtex/Bibtex.class.php b/repository/bibtex/Bibtex.class.php
index b759191..02d1efd 100644
--- a/repository/bibtex/Bibtex.class.php
+++ b/repository/bibtex/Bibtex.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Bibtex.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Bibtex.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -27,10 +27,6 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryOutputFilter.
  */
 class Repository_Bibtex extends RepositoryAction
 {
-	// 使用コンポーネントを受け取るため
-	//var $session = null;
-	var $db = null;
-	
 	// リクエストパラメータを受け取るため
 	var $verb = null;
 	var $itemId = null;
diff --git a/repository/bibtex/maple.ini b/repository/bibtex/maple.ini
index e9d12bf..d39a6bb 100644
--- a/repository/bibtex/maple.ini
+++ b/repository/bibtex/maple.ini
@@ -1,18 +1,3 @@
-;[Convert]
-;*.trim =
-
-;[ValidateDef]
-;item_type_id
-
-;[Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
-
-;[View]
-;success = "action:repository_view_main_export_detailconfirm"
-
-
-
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
diff --git a/repository/components/BackgroundProcess.class.php b/repository/components/BackgroundProcess.class.php
index 38617e5..eaf5ff2 100644
--- a/repository/components/BackgroundProcess.class.php
+++ b/repository/components/BackgroundProcess.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: BackgroundProcess.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: BackgroundProcess.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -36,8 +36,10 @@ class BackgroundProcess extends RepositoryAction
     /**
      * execute
      */
-    protected function executeForWeko()
+    protected function executeApp()
     {
+        $this->exitFlag = true;
+        
         // check process
         $status = $this->lockProcess();
         
@@ -59,9 +61,16 @@ class BackgroundProcess extends RepositoryAction
         
         // execute next process
         $this->unlockProcess();
+    }
+    
+    /**
+     * gUNVO㏈
+     * 
+     * ̏Ăяo
+     */
+    final protected function afterTrans()
+    {
         $this->callAsyncProcess();
-        
-        exit();
     }
     
     /**
diff --git a/repository/components/Checkdoi.class.php b/repository/components/Checkdoi.class.php
index 9546906..888bc72 100644
--- a/repository/components/Checkdoi.class.php
+++ b/repository/components/Checkdoi.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Checkdoi.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Checkdoi.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -29,6 +29,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
     const JUNII2_MAPPING_PUBLISHER = RepositoryConst::JUNII2_PUBLISHER;
     const JUNII2_MAPPING_LANGUAGE = RepositoryConst::JUNII2_LANGUAGE;
     const JUNII2_MAPPING_FULL_TEXT_URL = RepositoryConst::JUNII2_FULL_TEXT_URL;
+    const JUNII2_MAPPING_CREATOR = RepositoryConst::JUNII2_CREATOR;
     const JUNII2_MAPPING_BIBLIO = 'jtitle,volume,issue,spage,epage,dateofissued';
     const PARAMETER_REVIEW_FLG = 'review_flg';
     const PARAMETER_ITEM_AUTO_PUBLIC = 'item_auto_public';
@@ -42,6 +43,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
     const TYPE_JALC_DOI = 0;
     const TYPE_CROSS_REF = 1;
     const TYPE_LIBRARY_JALC_DOI = 2;
+    const TYPE_DATACITE = 3;
     
     const CAN_GRANT_DOI = 0;
     const CANNOT_GRANT_DOI = 1;
@@ -58,12 +60,13 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         parent::__construct($session, $Db, $transStartDate);
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
     /**
      * check being able to give the item JaLC DOI for Departmental Bulletin Paper
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -71,131 +74,67 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
     {
         $item_type_id = $this->getItemTypeId($item_id, $item_no);
         $nii_type = $this->getNiiType($item_type_id);
+        $result = $this->canRegistDoi($nii_type, $type);
+        if(!$result)
+        {
+        	return false;
+        }
+       
         switch($nii_type)
         {
             case RepositoryConst::NIITYPE_JOURNAL_ARTICLE:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_journal_article");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForJournalArticle($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_ARTICLE:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_article");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForArticle($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_PREPRINT:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_preprint");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForPreprint($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_DEPARTMENTAL_BULLETIN_PAPER:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_departmental_bulletin_paper");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForDepartmentalBulletinPaper($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_THESIS_OR_DISSERTATION:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_thesis_or_dissertation");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForThesisOrDissertation($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_CONFERENCE_PAPER:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_conference_paper");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForConferencePaper($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_BOOK:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_book");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForBook($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_TECHNICAL_REPORT:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_technical_report");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForTechnicalReport($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_RESEARCH_PAPER:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_research_paper");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForResearchPaper($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_LEARNING_MATERIAL:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_learning_material");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForLearningMaterial($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_DATA_OR_DATASET:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_data_or_dataset");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForDataOrDataset($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_SOFTWARE:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_software");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForSoftware($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_PRESENTATION:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_presentation");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForPresentation($item_id, $item_no, $type, $status);
                 break;
             
             case RepositoryConst::NIITYPE_OTHERS:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_others");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiForOthers($item_id, $item_no, $type, $status);
                 break;
             
@@ -203,13 +142,14 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                 return false;
         }
     }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     
     /**
      * check being able to give the item JaLC DOI for Journal Article
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -231,7 +171,8 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
                $this->existYHandleAndUri($item_id, $item_no) &&
-               $this->existJalcdoiPrefix() ) 
+               $this->existJalcdoiPrefix() &&
+               _REPOSITORY_JALC_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -240,14 +181,13 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         else if($type == self::TYPE_CROSS_REF)
         {
             // Cross Ref DOI付与可能アイテムである条件を満たす
-            if($this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, 
-                   self::JUNII2_MAPPING_FULL_TEXT_URL, false, false) &&
-               $this->existJunii2TitleMetadata($item_id, $item_no, true) &&
+            if($this->existJunii2TitleMetadata($item_id, $item_no, true) &&
                $this->isJournalArticleCrossRefDoiJunii2Required($item_id, $item_no) &&
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
                $this->existYHandleAndUri($item_id, $item_no) &&
-               $this->existCrossrefPrefix() ) 
+               $this->existCrossrefPrefix() &&
+               _REPOSITORY_JALC_CROSSREF_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -260,7 +200,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -274,7 +214,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -288,7 +228,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -302,7 +242,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -321,7 +261,8 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
                $this->existYHandleAndUri($item_id, $item_no) &&
-               $this->existJalcdoiPrefix() ) 
+               $this->existJalcdoiPrefix() &&
+               _REPOSITORY_JALC_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -335,7 +276,8 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                $this->existJunii2TitleMetadata($item_id, $item_no, false) &&
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
-               $this->existYHandleAndUri($item_id, $item_no)) 
+               $this->existYHandleAndUri($item_id, $item_no) &&
+               _REPOSITORY_JALC_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -348,7 +290,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -367,7 +309,8 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
                $this->existYHandleAndUri($item_id, $item_no) &&
-               $this->existJalcdoiPrefix() ) 
+               $this->existJalcdoiPrefix() &&
+               _REPOSITORY_JALC_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -376,14 +319,13 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         else if($type == self::TYPE_CROSS_REF)
         {
             // Cross Ref DOI付与可能アイテムである条件を満たす
-            if($this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, 
-                   self::JUNII2_MAPPING_FULL_TEXT_URL, false, false) &&
-               $this->existJunii2TitleMetadata($item_id, $item_no, true) &&
+            if($this->existJunii2TitleMetadata($item_id, $item_no, true) &&
                $this->isBookCrossRefDoiJunii2Required($item_id, $item_no) &&
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
                $this->existYHandleAndUri($item_id, $item_no) &&
-               $this->existCrossrefPrefix() ) 
+               $this->existCrossrefPrefix() &&
+               _REPOSITORY_JALC_CROSSREF_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -396,7 +338,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -410,7 +352,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -424,7 +366,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -438,7 +380,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -457,7 +399,8 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                $this->canOutputOaipmh($item_id, $item_no, $status) &&
                $this->isNotEnteredDoi($item_id, $item_no) &&
                $this->existYHandleAndUri($item_id, $item_no) &&
-               $this->existJalcdoiPrefix() ) 
+               $this->existJalcdoiPrefix() &&
+               _REPOSITORY_JALC_DOI == true ) 
             {
                 $can_grant = true;
             }
@@ -465,18 +408,58 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         return $can_grant;
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
     /**
      * check being able to give the item JaLC DOI for Data or Dataset
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
     private function checkDoiForDataOrDataset($item_id, $item_no, $type, $status=0)
     {
-        return $this->checkDoiForLearningMaterial($item_id, $item_no, $type, $status);
+        $can_grant = false;
+        // アイテムタイプID取得
+        $item_type_id = $this->getItemTypeId($item_id, $item_no);
+        
+        // JaLC DOI
+        if($type == self::TYPE_JALC_DOI)
+        {
+            // JaLC DOI付与可能アイテムである条件を満たす
+            if($this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, 
+                   self::JUNII2_MAPPING_FULL_TEXT_URL, false, false) &&
+               $this->existJunii2TitleMetadata($item_id, $item_no, false) &&
+               $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, 
+                   self::JUNII2_MAPPING_CREATOR, false, false) &&
+               $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, 
+                   self::JUNII2_MAPPING_PUBLISHER, true, false) &&
+               $this->canOutputOaipmh($item_id, $item_no, $status) &&
+               $this->isNotEnteredDoi($item_id, $item_no) &&
+               $this->existYHandleAndUri($item_id, $item_no) &&
+               $this->existJalcdoiPrefix() &&
+               _REPOSITORY_JALC_DOI == true ) 
+            {
+                $can_grant = true;
+            }
+        }
+        // DataCite
+        else if($type == self::TYPE_DATACITE)
+        {
+            // DataCite DOI付与可能アイテムである条件を満たす
+            if($this->existJunii2TitleMetadata($item_id, $item_no, true) &&
+               $this->isResearchDataDataCiteDoiJunii2Required($item_id, $item_no) &&
+               $this->canOutputOaipmh($item_id, $item_no, $status) &&
+               $this->isNotEnteredDoi($item_id, $item_no) &&
+               $this->existYHandleAndUri($item_id, $item_no) &&
+               $this->existDatacitePrefix() &&
+               _REPOSITORY_JALC_DATACITE_DOI == true ) 
+            {
+                $can_grant = true;
+            }
+        }
+        return $can_grant;
     }
     
     /**
@@ -484,21 +467,22 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
     private function checkDoiForSoftware($item_id, $item_no, $type, $status=0)
     {
-        return $this->checkDoiForLearningMaterial($item_id, $item_no, $type, $status);
+        return $this->checkDoiForDataOrDataset($item_id, $item_no, $type, $status);
     }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     
     /**
      * check being able to give the item JaLC DOI for Presentation
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -512,7 +496,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      *
      * @param int $item_id
      * @param int $item_no
-     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @param int $status 0:登録・編集, 1:アイテム管理
      * @return bool
      */
@@ -635,6 +619,9 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
     {
         $is_having = false;
         $item_type_id = $this->getItemTypeId($item_id, $item_no);
+    	// Add DataCite 2015/02/10 K.Sugimoto --start--
+        // <fullTextURL>に値が入力されているか
+		$existFullTextURL = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_FULL_TEXT_URL, false, false);
         // <publisher>に値が入力されているか
         $existPublisher = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_PUBLISHER, true, true);
         // <jtitle>に値が入力されているか
@@ -645,11 +632,12 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         $existSpage = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_SPAGE, false, false);
         // <language>に値が入力されているか
         $existLanguage = $this->existJunii2LanguageMetadata($item_id, $item_no, $item_type_id, true);
-        // JuNii2メタデータ項目の<publisher>, <jtitle>, <ISSN>, <spage>, <language>が入力されている
-        if($existPublisher && $existJtitle && $existIssn && $existSpage && $existLanguage)
+        // JuNii2メタデータ項目の<fullTextURL>, <publisher>, <jtitle>, <ISSN>, <spage>, <language>が入力されている
+        if($existFullTextURL && $existPublisher && $existJtitle && $existIssn && $existSpage && $existLanguage)
         {
             $is_having = true;
         }
+    	// Add DataCite 2015/02/10 K.Sugimoto --end--
         return $is_having;
     }
     
@@ -664,20 +652,53 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
     {
         $is_having = false;
         $item_type_id = $this->getItemTypeId($item_id, $item_no);
+    	// Add DataCite 2015/02/10 K.Sugimoto --start--
+        // <fullTextURL>に値が入力されているか
+		$existFullTextURL = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_FULL_TEXT_URL, false, false);
         // <publisher>に値が入力されているか
         $existPublisher = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_PUBLISHER, true, true);
         // <ISBN>に値が入力されているか
         $existIsbn = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_ISBN, true, false);
         // <language>に値が入力されているか
         $existLanguage = $this->existJunii2LanguageMetadata($item_id, $item_no, $item_type_id, true);
-        // JuNii2メタデータ項目の<publisher>, <ISBN>, <language>が入力されている
-        if($existPublisher && $existIsbn && $existLanguage)
+        // JuNii2メタデータ項目の<fullTextURL>, <publisher>, <ISBN>, <language>が入力されている
+        if($existFullTextURL && $existPublisher && $existIsbn && $existLanguage)
         {
             $is_having = true;
         }
+    	// Add DataCite 2015/02/10 K.Sugimoto --end--
         return $is_having;
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * 研究データのDataCite付与に必要なJuNii2メタデータ項目が入力されているか
+     *
+     * @param int $item_id
+     * @param int $item_no
+     * @return bool
+     */
+    private function isResearchDataDataCiteDoiJunii2Required($item_id, $item_no)
+    {
+        $is_having = false;
+        $item_type_id = $this->getItemTypeId($item_id, $item_no);
+        // <fullTextURL>に値が入力されているか
+		$existFullTextURL = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_FULL_TEXT_URL, false, false);
+        // <creator>に値が入力されているか
+        $existCreator = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_CREATOR, false, true);
+        // <publisher>に値が入力されているか
+        $existPublisher = $this->existJunii2MappingMetadata($item_id, $item_no, $item_type_id, self::JUNII2_MAPPING_PUBLISHER, true, true);
+        // <language>に値が入力されているか
+        $existLanguage = $this->existJunii2LanguageMetadata($item_id, $item_no, $item_type_id, true);
+        // JuNii2メタデータ項目の<fullTextURL>, <creator>, <publisher>, <language>が入力されている
+        if($existFullTextURL && $existCreator && $existPublisher && $existLanguage)
+        {
+            $is_having = true;
+        }
+        return $is_having;
+    }
+     // Add DataCite 2015/02/10 K.Sugimoto --end--
+
     /**
      * 指定したJuNii2マッピングの属性IDを取得する
      *
@@ -792,6 +813,29 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
     {
         $num = 0;
         $exist_data = false;
+        
+        // 言語メタデータの値を取得
+        $query = "SELECT language ".
+                 "FROM ".DATABASE_PREFIX."repository_item ".
+                 "WHERE item_id = ? ".
+                 "AND item_no = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = $item_id;
+        $params[] = $item_no;
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        
+        // 言語がenである時true
+        if(count($result) != 0)
+        {
+        	if($result[0]['language'] === "en")
+        	{
+            	$exist_data = true;
+        	}
+        	$num++;
+        }
+        
         // アイテムタイプ中の指定したマッピングの属性IDを取得する
         $attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, self::JUNII2_MAPPING_LANGUAGE);
         
@@ -1477,141 +1521,98 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         }
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * DataCiteのプレフィックスが登録されているかをチェックする
+     *
+     * @param int $item_id
+     * @param int $item_no
+     * @return bool
+     */
+    public function existDatacitePrefix()
+    {
+        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->dbAccess, $this->transStartDate);
+        $prefix = $repositoryHandleManager->getDataCitePrefix();
+        if(isset($prefix) && strlen($prefix) > 0)
+        {
+            return true;
+        }
+        else
+        {
+            return false;
+        }
+    }
+    
     /**
      * DOI付与可能になり得るアイテムタイプであるかを調べる
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     public function checkDoiGrantItemtype($item_type_id, $type)
     {
         $nii_type = $this->getNiiType($item_type_id);
+        $result = $this->canRegistDoi($nii_type, $type);
+        if(!$result)
+        {
+        	return false;
+        }
         switch($nii_type)
         {
             case RepositoryConst::NIITYPE_JOURNAL_ARTICLE:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_journal_article");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForJournalArticle($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_ARTICLE:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_article");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForArticle($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_PREPRINT:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_preprint");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForPreprint($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_DEPARTMENTAL_BULLETIN_PAPER:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_departmental_bulletin_paper");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForDepartmentalBulletinPaper($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_THESIS_OR_DISSERTATION:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_thesis_or_dissertation");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_CONFERENCE_PAPER:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_conference_paper");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForConferencePaper($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_BOOK:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_book");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForBook($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_TECHNICAL_REPORT:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_technical_report");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForTechnicalReport($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_RESEARCH_PAPER:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_research_paper");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForResearchPaper($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_LEARNING_MATERIAL:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_learning_material");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForLearningMaterial($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_DATA_OR_DATASET:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_data_or_dataset");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForDataOrDataset($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_SOFTWARE:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_software");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForSoftware($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_PRESENTATION:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_presentation");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForPresentation($item_type_id, $type);
                 break;
             
             case RepositoryConst::NIITYPE_OTHERS:
-                $editdoi_flag = $this->getNiiTypeFlag("edit_doi_flag_others");
-                if($editdoi_flag == 0)
-                {
-                    return false;
-                }
                 return $this->checkDoiGrantItemtypeForOthers($item_type_id, $type);
                 break;
             
@@ -1619,12 +1620,13 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                 return false;
         }
     }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     
     /**
      * アイテムタイプのNII typeがJournal Articleである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForJournalArticle($item_type_id, $type)
@@ -1633,12 +1635,16 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         if($type == self::TYPE_JALC_DOI)
         {
             $isExistJalcdoiPrefix = $this->existJalcdoiPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
             $spage_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_SPAGE);
             $biblio_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_BIBLIO);
             
             if($isExistJalcdoiPrefix &&
+               _REPOSITORY_JALC_DOI == true &&
+               count($fulltexturl_attr_id_array) > 0 &&
                (count($spage_attr_id_array) > 0 || 
                count($biblio_attr_id_array) > 0))
             {
@@ -1648,6 +1654,8 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         else if($type == self::TYPE_CROSS_REF)
         {
             $isExistCrossrefPrefix = $this->existCrossrefPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
             $publisher_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_PUBLISHER);
             $jtitle_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
@@ -1656,19 +1664,22 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
                 self::JUNII2_MAPPING_ISSN);
             $spage_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_SPAGE);
-            $language_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
-                self::JUNII2_MAPPING_LANGUAGE);
             $biblio_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_BIBLIO);
+            $publisher_lang_array = $this->getDisplayLangTypeInArray($publisher_attr_id_array);
+            $jtitle_lang_array = $this->getDisplayLangTypeInArray($jtitle_attr_id_array);
             
             if($isExistCrossrefPrefix && 
+               _REPOSITORY_JALC_CROSSREF_DOI == true && 
+               count($fulltexturl_attr_id_array) > 0 &&
                count($publisher_attr_id_array) > 0 && 
-               (count($jtitle_attr_id_array) > 0 || 
+               in_array("english", $publisher_lang_array) &&
+               (count($jtitle_attr_id_array) > 0 && 
+               in_array("english", $jtitle_lang_array) ||
                count($biblio_attr_id_array) > 0) && 
                count($issn_attr_id_array) > 0 && 
                (count($spage_attr_id_array) > 0 || 
-               count($biblio_attr_id_array) > 0) && 
-               count($language_attr_id_array) > 0)
+               count($biblio_attr_id_array) > 0))
             {
                 $can_grant = true;
             }
@@ -1680,7 +1691,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがArticleである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForArticle($item_type_id, $type)
@@ -1692,7 +1703,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがPreprintである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForPreprint($item_type_id, $type)
@@ -1704,7 +1715,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがDepartmental Bulletin Paperである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForDepartmentalBulletinPaper($item_type_id, $type)
@@ -1716,7 +1727,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがThesis or Dissertationである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type)
@@ -1725,8 +1736,23 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         if($type == self::TYPE_JALC_DOI)
         {
             $isExistJalcdoiPrefix = $this->existJalcdoiPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
             
-            if($isExistJalcdoiPrefix)
+            if($isExistJalcdoiPrefix &&
+               _REPOSITORY_JALC_DOI == true &&
+               count($fulltexturl_attr_id_array) > 0)
+            {
+                $can_grant = true;
+            }
+        }
+        else if($type == self::TYPE_LIBRARY_JALC_DOI)
+        {
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
+            
+            if(_REPOSITORY_JALC_DOI == true &&
+               count($fulltexturl_attr_id_array) > 0)
             {
                 $can_grant = true;
             }
@@ -1738,7 +1764,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがConference Paperである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForConferencePaper($item_type_id, $type)
@@ -1747,8 +1773,12 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         if($type == self::TYPE_JALC_DOI)
         {
             $isExistJalcdoiPrefix = $this->existJalcdoiPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
             
-            if($isExistJalcdoiPrefix)
+            if($isExistJalcdoiPrefix &&
+               _REPOSITORY_JALC_DOI == true &&
+               count($fulltexturl_attr_id_array) > 0)
             {
                 $can_grant = true;
             }
@@ -1756,17 +1786,20 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
         else if($type == self::TYPE_CROSS_REF)
         {
             $isExistCrossrefPrefix = $this->existCrossrefPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
             $publisher_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_PUBLISHER);
             $isbn_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
                 self::JUNII2_MAPPING_ISBN);
-            $language_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
-                self::JUNII2_MAPPING_LANGUAGE);
+            $publisher_lang_array = $this->getDisplayLangTypeInArray($publisher_attr_id_array);
             
             if($isExistCrossrefPrefix && 
+               _REPOSITORY_JALC_CROSSREF_DOI == true && 
+               count($fulltexturl_attr_id_array) > 0 &&
                count($publisher_attr_id_array) > 0 && 
-               count($isbn_attr_id_array) > 0 && 
-               count($language_attr_id_array) > 0)
+               in_array("english", $publisher_lang_array) &&
+               count($isbn_attr_id_array) > 0)
             {
                 $can_grant = true;
             }
@@ -1778,7 +1811,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがBookである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForBook($item_type_id, $type)
@@ -1790,7 +1823,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがTechnical Reportである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForTechnicalReport($item_type_id, $type)
@@ -1802,7 +1835,7 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがResearch Paperである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForResearchPaper($item_type_id, $type)
@@ -1814,89 +1847,188 @@ class Repository_Components_Checkdoi extends RepositoryLogicBase
      * アイテムタイプのNII typeがLearning Materialである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForLearningMaterial($item_type_id, $type)
     {
-        return $this->checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type);
+        $can_grant = false;
+        if($type == self::TYPE_JALC_DOI)
+        {
+            $isExistJalcdoiPrefix = $this->existJalcdoiPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
+            
+            if($isExistJalcdoiPrefix &&
+               _REPOSITORY_JALC_DOI == true &&
+               count($fulltexturl_attr_id_array) > 0)
+            {
+                $can_grant = true;
+            }
+        }
+        return $can_grant;
     }
 
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
     /**
      * アイテムタイプのNII typeがData or Datasetである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForDataOrDataset($item_type_id, $type)
     {
-        return $this->checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type);
+        $can_grant = false;
+        if($type == self::TYPE_JALC_DOI)
+        {
+            $isExistJalcdoiPrefix = $this->existJalcdoiPrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
+            $creator_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
+                self::JUNII2_MAPPING_CREATOR);
+            $publisher_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
+                self::JUNII2_MAPPING_PUBLISHER);
+            
+            if($isExistJalcdoiPrefix &&
+               _REPOSITORY_JALC_DOI == true && 
+               count($fulltexturl_attr_id_array) > 0 &&
+               count($creator_attr_id_array) > 0 && 
+               count($publisher_attr_id_array) > 0)
+            {
+                $can_grant = true;
+            }
+        }
+        else if($type == self::TYPE_DATACITE)
+        {
+            $isExistDatacitePrefix = $this->existDatacitePrefix();
+            $fulltexturl_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id,
+                self::JUNII2_MAPPING_FULL_TEXT_URL);
+            $creator_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
+                self::JUNII2_MAPPING_CREATOR);
+            $publisher_attr_id_array = $this->getAttributeIdFromJuNii2Mapping($item_type_id, 
+                self::JUNII2_MAPPING_PUBLISHER);
+            $creator_lang_array = $this->getDisplayLangTypeInArray($creator_attr_id_array);
+            $publisher_lang_array = $this->getDisplayLangTypeInArray($publisher_attr_id_array);
+            
+            if($isExistDatacitePrefix && 
+               _REPOSITORY_JALC_DATACITE_DOI == true && 
+               count($fulltexturl_attr_id_array) > 0 &&
+               count($creator_attr_id_array) > 0 && 
+               in_array("english", $creator_lang_array) &&
+               count($publisher_attr_id_array) > 0 &&
+               in_array("english", $publisher_lang_array))
+            {
+                $can_grant = true;
+            }
+        }
+        return $can_grant;
     }
 
     /**
      * アイテムタイプのNII typeがSoftwareである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForSoftware($item_type_id, $type)
     {
-        return $this->checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type);
+        return $this->checkDoiGrantItemtypeForDataOrDataset($item_type_id, $type);
     }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
 
     /**
      * アイテムタイプのNII typeがPresentationである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForPresentation($item_type_id, $type)
     {
-        return $this->checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type);
+        return $this->checkDoiGrantItemtypeForLearningMaterial($item_type_id, $type);
     }
 
     /**
      * アイテムタイプのNII typeがOthersである時、必要なマッピングのメタデータが存在するか
      *
      * @param int $item_type_id
-     * @param int $type   0:JaLC DOI, 1:Cross Ref
+     * @param int $type   0:JaLC DOI, 1:Cross Ref, 2:国会図書館JaLC DOI, 3:DataCite
      * @return bool
      */
     private function checkDoiGrantItemtypeForOthers($item_type_id, $type)
     {
-        return $this->checkDoiGrantItemtypeForThesisOrDissertation($item_type_id, $type);
+        return $this->checkDoiGrantItemtypeForLearningMaterial($item_type_id, $type);
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
     /**
-     * 指定したNII typeのDOI付与フラグを取得する
+     * 指定したNII type、DOI種別でDOI付与できるかを判定する
      *
-     * @param string $record_name
+     * @param string $nii_type
+     * @param string $type
      * @return int
      */
-    private function getNiiTypeFlag($record_name)
+    private function canRegistDoi($nii_type, $type)
     {
-        $editdoi_flag = 0;
+        $nii_type = strtolower($nii_type);
+        
+        if($type == self::TYPE_JALC_DOI)
+        {
+        	$doi = "jalc";
+        }
+        else if($type == self::TYPE_CROSS_REF)
+        {
+        	$doi = "crossref";
+        }
+        else if($type == self::TYPE_LIBRARY_JALC_DOI)
+        {
+        	$doi = "multiple_resolution";
+        }
+        else if($type == self::TYPE_DATACITE)
+        {
+        	$doi = "datacite";
+        }
         
         // DOI付与フラグを取得
-        $query = "SELECT param_value ".
-                 "FROM ".DATABASE_PREFIX."repository_parameter ".
-                 "WHERE param_name = ? ".
+        $query = "SELECT ".$doi." ".
+                 "FROM ".DATABASE_PREFIX."repository_doi_flag ".
+                 "WHERE nii_type = ? ".
                  "AND is_delete = ? ;";
         $params = array();
-        $params[] = $record_name;
+        $params[] = $nii_type;
         $params[] = 0;
         $result = $this->dbAccess->executeQuery($query, $params);
         
-        if(count($result) > 0)
+        if(count($result) > 0 && $result[0][$doi] == 1)
         {
-            $editdoi_flag = $result[0]["param_value"];
+            return true;
+        }
+        else
+        {
+        	return false;
         }
-        
-        return $editdoi_flag;
     }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
+    /**
+     * アイテム属性配列から表示言語を取得する
+     *
+     * @param Array $attr_id_array
+     * @return Array
+     */
+    private function getDisplayLangTypeInArray($attr_id_array)
+    {
+        $display_lang_type_array = array();
+        for($num = 0; $num < count($attr_id_array); $num++)
+        {
+            $display_lang_type_array[] = $attr_id_array[$num]["display_lang_type"];
+        }
+
+        return $display_lang_type_array;
+    }
+
 }
 
 ?>
diff --git a/repository/components/Factory.class.php b/repository/components/Factory.class.php
index fe3cc40..1f8d1c1 100644
--- a/repository/components/Factory.class.php
+++ b/repository/components/Factory.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Factory.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Factory.class.php 36217 2014-05-26 04:22:11Z satoshi_arata $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/IDServer.class.php b/repository/components/IDServer.class.php
index 74875f5..279eefa 100644
--- a/repository/components/IDServer.class.php
+++ b/repository/components/IDServer.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: IDServer.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: IDServer.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -851,11 +851,21 @@ class IDServer extends RepositoryAction
                 $flashDir = $this->makeFlashFolder($item_attr['item_id'],
                                                    $item_attr['attribute_id'],
                                                    $item_attr['file_no']);
-                // decompress flash data.
-                File_Archive::extract(
-                    File_Archive::read($tmp_tar.'/'),       // 末尾は'/'
-                    File_Archive::appender($flashDir.'/')   // 解凍先
-                );
+                
+                // バージョン違いで解凍できない場合の対応
+                if (version_compare(PHP_VERSION, '5.3.0', '>='))
+                {
+                    $phar = new PharData($tmp_tar);
+                    $phar->extractTo($flashDir);
+                }
+                else {
+                    // decompress flash data.
+                    File_Archive::extract(
+                        File_Archive::read($tmp_tar.'/'),       // 末尾は'/'
+                        File_Archive::appender($flashDir.'/')   // 解凍先
+                    );
+                }
+                
                 $swf_path = $flashDir.'/weko1.swf';
                 $this->removeDirectory($tmp_dir);
                 if( !(file_exists($swf_path)) ){
diff --git a/repository/components/ItemRegister.class.php b/repository/components/ItemRegister.class.php
index da1171f..984c6d4 100644
--- a/repository/components/ItemRegister.class.php
+++ b/repository/components/ItemRegister.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: ItemRegister.class.php 651 2014-11-13 10:14:11Z ivis $
+// $Id: ItemRegister.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -361,27 +361,39 @@ class ItemRegister extends RepositoryAction
         }
         // Add cnri handle T.Ichikawa 2014/09/17 --end--
         
+        return true;
+    }
+    
+    // BugFix when before and after update, assignment doi is failed T.Koyasu 2015/03/09 --start--
+    /**
+     * update self doi
+     *
+     * @param unknown_type $item
+     */
+    public function updateSelfDoi($item)
+    {
         // self DOI
         if(isset($item['selfdoi']) && is_array($item['selfdoi']))
         {
             if(isset($item['selfdoi'][0]['RA']) && strlen($item['selfdoi'][0]['RA']) > 0)
             {
+                $item['selfdoi'][0]['RA'] = strtoupper($item['selfdoi'][0]['RA']);
                 $checkdoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
-                if($item['selfdoi'][0]['RA'] === RepositoryConst::JUNII2_SELFDOI_RA_JALC)
+                if($item['selfdoi'][0]['RA'] === strtoupper(RepositoryConst::JUNII2_SELFDOI_RA_JALC))
                 {
                     $selfdoiPrefixSuffix = explode("/", $item['selfdoi'][0]['SELFDOI']);
                     $handleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
                     $libraryJalcdoiPrefix = $handleManager->getLibraryJalcDoiPrefix();
                     if($selfdoiPrefixSuffix[0] === $libraryJalcdoiPrefix)
                     {
-                        $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], 2, 0);
+                        $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], Repository_Components_Checkdoi::TYPE_LIBRARY_JALC_DOI, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                         if($checkRegist)
                         {
                             $handleManager->registLibraryJalcdoiSuffix($item['item_id'], $item['item_no'], $item['selfdoi'][0]['SELFDOI']);
                         }
                         else
                         {
-                            $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], 0, 0);
+                            $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], Repository_Components_Checkdoi::TYPE_JALC_DOI, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                             if($checkRegist)
                             {
                                 $suffix = $handleManager->getYHandleSuffix($item['item_id'], $item['item_no']);
@@ -391,7 +403,7 @@ class ItemRegister extends RepositoryAction
                     }
                     else
                     {
-                        $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], 0, 0);
+                        $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], Repository_Components_Checkdoi::TYPE_JALC_DOI, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                         if($checkRegist)
                         {
                             $suffix = $handleManager->getYHandleSuffix($item['item_id'], $item['item_no']);
@@ -399,9 +411,9 @@ class ItemRegister extends RepositoryAction
                         }
                     }
                 }
-                else if($item['selfdoi'][0]['RA'] === RepositoryConst::JUNII2_SELFDOI_RA_CROSSREF)
+                else if($item['selfdoi'][0]['RA'] === strtoupper(RepositoryConst::JUNII2_SELFDOI_RA_CROSSREF))
                 {
-                    $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], 1, 0);
+                    $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], Repository_Components_Checkdoi::TYPE_CROSS_REF, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
                     if($checkRegist)
                     {
                         $handleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
@@ -409,10 +421,20 @@ class ItemRegister extends RepositoryAction
                         $handleManager->registCrossrefSuffix($item['item_id'], $item['item_no'], $suffix);
                     }
                 }
+                else if($item['selfdoi'][0]['RA'] === strtoupper(RepositoryConst::JUNII2_SELFDOI_RA_DATACITE))
+                {
+                    $checkRegist = $checkdoi->checkDoiGrant($item['item_id'], $item['item_no'], Repository_Components_Checkdoi::TYPE_DATACITE, Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_REGISTRATION);
+                    if($checkRegist)
+                    {
+                        $handleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
+                        $suffix = $handleManager->getYHandleSuffix($item['item_id'], $item['item_no']);
+                        $handleManager->registDataciteSuffix($item['item_id'], $item['item_no'], $suffix);
+                    }
+                }
             }
         }
-        return true;
     }
+    // BugFix when before and after update, assignment doi is failed T.Koyasu 2015/03/09 --end--
 
     /**
      * get file no
@@ -924,6 +946,65 @@ class ItemRegister extends RepositoryAction
         
         // 外部コマンドをDBから取得する 2008/08/07 Y.Nakao --end--
         // PDFのプレビュー化処理を追加 2008/07/22 Y.Nakao --end--
+        // file contents move to save point
+        $fileName = $file_info['upload']['physical_file_name'];
+        // Add separate file from DB 2009/04/17 Y.Nakao --start--
+        // Move upload file and rename.
+        $upload_filepath = $filePath.$fileName;
+        $contents_path = $this->getFileSavePath("file");
+        if(strlen($contents_path) == 0){
+            // default directory
+            $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
+            if( !(file_exists($contents_path)) ){
+                mkdir ( $contents_path, 0777);
+            }
+        }
+        // check directory exists 
+        if( file_exists($contents_path) ){
+            // check this folder write right.
+            $ex_file = fopen ($contents_path.'/test.txt', "w");
+            if( $ex_file === false ){
+                // folder is not find, file save at default directory
+                $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
+                if( !(file_exists($contents_path)) ){
+                    mkdir ( $contents_path, 0777);
+                }
+                chmod($contents_path, 0777 );
+            } else {
+                fclose($ex_file);
+                unlink($contents_path.'/test.txt');
+            }
+        } else {
+            // folder is not find, file save at default directory
+            $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
+            if( !(file_exists($contents_path)) ){
+                mkdir ( $contents_path, 0777);
+            }
+            chmod($contents_path, 0777 );
+        }
+        
+        $contents_path .= DIRECTORY_SEPARATOR.
+                        $file_info['item_id'].'_'.
+                        $file_info['attribute_id'].'_'.
+                        $file_info['file_no'].'.'.
+                        $file_info['upload']['extension'];
+        if( file_exists($contents_path) ){
+            unlink($contents_path);
+        }
+        // file upload check 2015/04/02 K.Sugimoto --start--
+        $result = copy($upload_filepath, $contents_path);
+        if(!$result || !(file_exists($contents_path))){
+	        $smarty_assign = $this->Session->getParameter("smartyAssign");
+	        if(!isset($smarty_assign))
+	        {
+	            $this->setLangResource();
+	            $smarty_assign = $this->Session->getParameter("smartyAssign");
+	        }
+	        $errMsg = sprintf($smarty_assign->getLang("repository_file_upload_failed"), $file_info['upload']['file_name']);
+	        return false;
+        }
+        // file upload check 2015/04/02 K.Sugimoto --end--
+        // Add separate file from DB 2009/04/17 Y.Nakao --end--
         // Insert
         $params = array();
         $params[] = $file_info['item_id'];  // item_id
@@ -957,7 +1038,7 @@ class ItemRegister extends RepositoryAction
         $params[] = ""; // "pub_date"
         $params[] = ""; // "flash_pub_date"
         $params[] = $file_info['item_type_id']; // "item_type_id"
-        $params[] = "";  // "browsing_flag"
+        $params[] = 0;  // "browsing_flag"
         $params[] = 0;  // "create_cover_flag"
         $params[] = $this->ins_user_id; // "ins_user_id"
         $params[] = $this->mod_user_id; // "mod_user_id"
@@ -983,53 +1064,6 @@ class ItemRegister extends RepositoryAction
             } 
             return false;
         }
-        // file contents move to save point
-        $fileName = $file_info['upload']['physical_file_name'];
-        // Add separate file from DB 2009/04/17 Y.Nakao --start--
-        // Move upload file and rename.
-        $upload_filepath = $filePath.$fileName;
-        $contents_path = $this->getFileSavePath("file");
-        if(strlen($contents_path) == 0){
-            // default directory
-            $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
-            if( !(file_exists($contents_path)) ){
-                mkdir ( $contents_path, 0777);
-            }
-        }
-        // check directory exists 
-        if( file_exists($contents_path) ){
-            // check this folder write right.
-            $ex_file = fopen ($contents_path.'/test.txt', "w");
-            if( $ex_file === false ){
-                // folder is not find, file save at default directory
-                $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
-                if( !(file_exists($contents_path)) ){
-                    mkdir ( $contents_path, 0777);
-                }
-                chmod($contents_path, 0777 );
-            } else {
-                fclose($ex_file);
-                unlink($contents_path.'/test.txt');
-            }
-        } else {
-            // folder is not find, file save at default directory
-            $contents_path = BASE_DIR.'/webapp/uploads/repository/files';
-            if( !(file_exists($contents_path)) ){
-                mkdir ( $contents_path, 0777);
-            }
-            chmod($contents_path, 0777 );
-        }
-        
-        $contents_path .= DIRECTORY_SEPARATOR.
-                        $file_info['item_id'].'_'.
-                        $file_info['attribute_id'].'_'.
-                        $file_info['file_no'].'.'.
-                        $file_info['upload']['extension'];
-        if( file_exists($contents_path) ){
-            unlink($contents_path);
-        }
-        copy($upload_filepath, $contents_path);
-        // Add separate file from DB 2009/04/17 Y.Nakao --end--
         
         // PDFのプレビュー化処理を追加 2008/07/22 Y.Nakao --start--
         // 外部コマンドをDBから取得する 2008/08/07 Y.Nakao --start--
@@ -1340,7 +1374,7 @@ class ItemRegister extends RepositoryAction
         $params[] = $price;
         $params[] = $this->mod_user_id; // mod_user_id
         $params[] = $this->edit_start_date; // mod_Date
-        $params[] = '0';    // is_Dalete
+        $params[] = 0;    // is_Dalete
         $params[] = $file['item_id'];
         $params[] = $file['item_no'];
         $params[] = $file['attribute_id'];
@@ -1746,7 +1780,7 @@ class ItemRegister extends RepositoryAction
         $ins_params = array();
         $ins_params[0] = $item["item_id"];  // item_id
         $ins_params[1] = $item["item_no"];  // item_no
-        $ins_params[2] = "";                // index_id
+        $ins_params[2] = 0;                // index_id
         $ins_params[3] = 0;                 // custom_sort_order
         $ins_params[4] = $this->ins_user_id;    // ins_user_id
         $ins_params[5] = $this->mod_user_id;    // mod_user_id
@@ -1883,8 +1917,8 @@ class ItemRegister extends RepositoryAction
         $ins_params = array();
         $ins_params[0] = $item["item_id"];  // org_reference_item_id
         $ins_params[1] = $item["item_no"];  // org_reference_item_no
-        $ins_params[2] = "";    // dest_reference_item_id
-        $ins_params[3] = "";    // dest_reference_item_no
+        $ins_params[2] = 0;    // dest_reference_item_id
+        $ins_params[3] = 0;    // dest_reference_item_no
         $ins_params[4] = "";    // reference
         $ins_params[5] = $this->ins_user_id;    // ins_user_id
         $ins_params[6] = $this->mod_user_id;    // mod_user_id
@@ -1981,25 +2015,25 @@ class ItemRegister extends RepositoryAction
         // 必須入力検査 
         // ------------------------------------------------------------
         for($ii=0; $ii<count($item_attr_type); $ii++) {
-            // 必須指定でないメタデータはスルー
-            if( $item_attr_type[$ii]['is_required']!=1){
-                continue;
-            }
             if( $item_attr_type[$ii]['input_type']=='file' ||
                 $item_attr_type[$ii]['input_type']=='file_price' ||
                 $item_attr_type[$ii]['input_type']=='thumbnail'){
                 if($type == "all" || $type == "file"){
+                    // 必須指定でないメタデータはスルー
+                    if( $item_attr_type[$ii]['is_required']!=1){
+                        continue;
+                    }
                     // 必須ファイル／サムネイルが最低一件入力済みか検査
                     $IsInput = false;
                     for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
                         if($item_attr[$ii][$jj] != null){
-                            if($item_attr[$ii][$jj]["upload"] != null) {
+                            if(isset($item_attr[$ii][$jj]["upload"])) {
                                 $IsInput = true;
                                 break;
                             }
                         }
                     }
-                    // 未入力の場合はエラメッセージを登録
+                    // 未入力の場合はエラーメッセージを登録
                     if($IsInput == false) {
                         $msg = $smarty_assign->getLang("repository_input_error");
                         array_push($err_msg, sprintf($msg, $item_attr_type[$ii]['attribute_name']));
@@ -2007,8 +2041,12 @@ class ItemRegister extends RepositoryAction
                 }
                 if($type == "all" || $type == "license"){
                     for($jj=0; $jj<$item_num_attr[$ii]; $jj++) {
+                        if(!isset($item_attr[$ii][$jj]['upload'])){
+                            continue;
+                        }
                         // 価格精査
                         if($item_attr_type[$ii]['input_type']=='file_price'){
+                            
                             // 個数保持
                             $loop_num = $item_attr[$ii][$jj]['price_num'];
                             // 価格
@@ -2049,6 +2087,10 @@ class ItemRegister extends RepositoryAction
                     }
                 }
             } else {
+                // 必須指定でないメタデータはスルー
+                if( $item_attr_type[$ii]['is_required']!=1){
+                    continue;
+                }
                 if($type == "all" || $type == "meta"){
                     // テキスト入力項目が入力済みか検査, 必須入力は最低1属性に入っていれば良い
                     // 氏名は名入力時に姓が入っていなければNG
@@ -2168,13 +2210,10 @@ class ItemRegister extends RepositoryAction
             array_push($err_msg, $msg);
         }
         */
-        // タイトルの空、もしくはタイトルなし、no titleも空と判定してチェックク
-        if( ((trim($item['title']) == "") && ((trim($item['title_english'])) == "")) 
-            || ($item['title'] == "タイトル無し" && trim($item['title_english']) == "") 
-            || (trim($item['title'] == "") && $item['title_english'] == "no title")
-            || ($item['title'] == "タイトル無し" && $item['title_english'] == "no title") ) {
+        // タイトルの空チェック
+        if( trim($item['title']) == "" && trim($item['title_english']) == "") {
             $msg = $smarty_assign->getLang("repository_item_error_title");
-            array_push($err_msg, $msg);
+            array_push($warning, $msg);
             //WEKOの言語判定
             if($this->Session->getParameter("_lang") == "japanese"){
                 //論文の言語判定
@@ -2192,7 +2231,7 @@ class ItemRegister extends RepositoryAction
                     $str = "*An English title becomes \"no title\"";
                 }
             }
-            array_push($err_msg, $str);
+            array_push($warning, $str);
         }
         else if ($item['title'] == RepositoryConst::BLANK_WORD || $item['title_english'] == RepositoryConst::BLANK_WORD) {
             $msg = $smarty_assign->getLang("repository_item_error_required_item");
@@ -2221,7 +2260,10 @@ class ItemRegister extends RepositoryAction
             }
             if (count($result) > 0) {
                 $msg = $smarty_assign->getLang("repository_item_error_same_title");
-                $warning = $msg;
+                if(!isset($warning) || !is_array($warning)){
+                    $warning = array();
+                }
+                array_push($warning, $msg);
             }
         }
         //タイトルが空だった場合には重複チェックしない 2009/08/26 K.Ito --end--
@@ -2507,7 +2549,11 @@ class ItemRegister extends RepositoryAction
         $params[] = $item_id;
         $params[] = 1;
         $result = $this->Db->execute($query, $params);
-        $test = $this->Db->ErrorMsg();
+        if($result===false){
+            return false;
+        }
+        
+        return true;
     }
     // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
     
diff --git a/repository/components/JSON.php b/repository/components/JSON.php
index 6794410..77d532b 100644
--- a/repository/components/JSON.php
+++ b/repository/components/JSON.php
@@ -51,7 +51,7 @@
  * @author      Matt Knapp <mdknapp[at]gmail[dot]com>
  * @author      Brett Stimmerman <brettstimmerman[at]gmail[dot]com>
  * @copyright   2005 Michal Migurski
- * @version     CVS: $Id: JSON.php 158 2008-10-17 07:23:42Z ivis $
+ * @version     CVS: $Id: JSON.php 3 2010-02-02 05:07:44Z atsushi_suzuki $
  * @license     http://www.opensource.org/licenses/bsd-license.php
  * @link        http://pear.php.net/pepr/pepr-proposal-show.php?id=198
  */
diff --git a/repository/components/LogAnalyzor.class.php b/repository/components/LogAnalyzor.class.php
index a410c31..65a2af4 100644
--- a/repository/components/LogAnalyzor.class.php
+++ b/repository/components/LogAnalyzor.class.php
@@ -1,247 +1,353 @@
-<?php
-// --------------------------------------------------------------------
-//
-// $Id: LogAnalyzor.class.php 41652 2014-09-17 08:16:26Z tomohiro_ichikawa $
-//
-// Copyright (c) 2007 - 2008, National Institute of Informatics, 
-// Research and Development Center for Scientific Information Resources
-//
-// This program is licensed under a Creative Commons BSD Licence
-// http://creativecommons.org/licenses/BSD/
-//
-// --------------------------------------------------------------------
-
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryLogicBase.class.php';
-
-class Repository_Components_Loganalyzor extends RepositoryLogicBase
-{
-    /**
-     * Constructor
-     *
-     * @param var $session
-     * @param var $dbAccess
-     * @param string $transStartDate
-     */
-    public function __construct($session, $dbAccess, $transStartDate)
-    {
-        parent::__construct($session, $dbAccess, $transStartDate);
-    }
-
-    /**
-     * exclusive ip address
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function execlusiveIpAddressQuery($abbreviation) {
-        $query = "SELECT param_value FROM ". DATABASE_PREFIX. "repository_parameter ".
-                 "WHERE param_name = ? ;";
-        $params = array();
-        $params[] = "log_exclusion";
-        $result = $this->dbAccess->executeQuery($query, $params);
-        
-        $ip_address = str_replace(array("\r\n", "\r", "\n"), ",", $result[0]["param_value"]);
-        $ip_exclusion = "";
-        $colomun_name = "";
-        if(strlen($abbreviation) == 0) {
-            $column_name = "ip_address";
-        } else if(strlen($abbreviation) > 0) {
-            $column_name = $abbreviation. ".ip_address";
-        }
-        if(strlen($ip_address) > 0) {
-            $ip_exclusion = " AND ". $column_name. " NOT IN ('". $ip_address. "') ";
-        }
-        
-        return $ip_exclusion;
-    }
-  
-    /**
-     * exclusive double access
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function execlusiveDoubleAccessSubQuery($operation_id, $abbreviation, $start_date, $finish_date) {
-        $sub_query = "";
-        if($operation_id == RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE) {
-            if(strlen($abbreviation) == 0) {
-                $sub_query = "SELECT *,DATE_FORMAT(record_date, '%Y%m%d%k%i') FROM ". DATABASE_PREFIX. "repository_log ".
-                             "WHERE record_date >= '". $start_date. "' ".
-                             "AND record_date <= '". $finish_date. "' ".
-                             "AND operation_id = ". $operation_id. " ".
-                             "GROUP BY DATE_FORMAT(record_date, '%Y%m%d%k%i'), item_id, item_no, attribute_id, file_no, ".
-                             "user_agent, ip_address, operation_id, search_keyword, host, file_status, site_license, ".
-                             "input_type, login_status, group_id ";
-            } else {
-                $sub_query = "SELECT *,DATE_FORMAT(record_date, '%Y%m%d%k%i') FROM ". DATABASE_PREFIX. "repository_log AS ". $abbreviation. " ".
-                             "WHERE record_date >= '". $start_date. "' ".
-                             "AND record_date <= '". $finish_date. "' ".
-                             "AND operation_id = ". $operation_id. " ".
-                             "GROUP BY DATE_FORMAT(record_date, '%Y%m%d%k%i'), item_id, item_no, attribute_id, file_no, ".
-                             "user_agent, ip_address, operation_id, search_keyword, host, file_status, site_license, ".
-                             "input_type, login_status, group_id ";
-            }
-        } else {
-            $sub_query = DATABASE_PREFIX."repository_log";
-        }
-        
-        return $sub_query;
-    }
-    
-    /**
-     * exclusive robot
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function execlusiveRobotsQuery($abbreviation) {
-        $robots = "";
-        if(file_exists(WEBAPP_DIR.'/modules/repository/config/Robots_Exclusion')){
-            $fp = fopen(WEBAPP_DIR.'/modules/repository/config/Robots_Exclusion', "r");
-            while(!feof($fp)){
-                // read line
-                $file_line = fgets($fp);
-                $file_line = str_replace("\r\n", "", $file_line);
-                $file_line = str_replace("\n", "", $file_line);
-                // header '#' is coomment
-                $file_line = preg_replace("/^#.*/", "", $file_line);
-                if(strlen($file_line) == 0){
-                    continue;
-                }
-                if(strlen($robots) != 0){
-                    $robots .= " , ";
-                }
-                $robots .= "'". $file_line. "'";
-            }
-            fclose($fp);
-        }
-        
-        $robots_exclusion = "";
-        if(strlen($robots) > 0) {
-            if(strlen($abbreviation) == 0) {
-                $robots_exclusion = " AND (user_agent IS NULL OR user_agent NOT IN (". $robots. ")) ";
-            } else if(strlen($abbreviation) > 0) {
-                $robots_exclusion = " AND (".$abbreviation. ".user_agent IS NULL OR ".$abbreviation. ".user_agent NOT IN (". $robots. ")) ";
-            }
-        }
-        
-        return $robots_exclusion;
-    }
-    
-    /**
-     * format date of year
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function dateformatYearQuery($abbreviation) {
-        $year = "";
-        if(strlen($abbreviation) == 0) {
-            $year = " DATE_FORMAT(record_date, '%Y') AS YEAR ";
-        } else if(strlen($abbreviation) > 0) {
-            $year = " DATE_FORMAT(". $abbreviation. ".record_date, '%Y') AS YEAR ";
-        }
-        
-        return $year;
-    }
-    
-    /**
-     * make query parts of year
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function perYearQuery() {
-        $group_year = " GROUP BY YEAR ";
-        
-        return $group_year;
-    }
-    
-    /**
-     * format date of month
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function dateformatMonthlyQuery($abbreviation) {
-        $monthly = "";
-        if(strlen($abbreviation) == 0) {
-            $monthly = " DATE_FORMAT(record_date, '%m') AS MONTHLY ";
-        } else if(strlen($abbreviation) > 0) {
-            $monthly = " DATE_FORMAT(". $abbreviation. ".record_date, '%m') AS MONTHLY ";
-        }
-        
-        return $monthly;
-    }
-    
-    /**
-     * format make query parts of month
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function perMonthlyQuery() {
-        $group_monthly = " GROUP BY MONTHLY ";
-        
-        return $group_monthly;
-    }
-    
-    /**
-     * format date of week
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function dateformatWeeklyQuery($abbreviation) {
-        $weekly = "";
-        if(strlen($abbreviation) == 0) {
-            $weekly = " DATE_FORMAT(record_date, '%U') AS WEEKLY ";
-        } else if(strlen($abbreviation) > 0) {
-            $weekly = " DATE_FORMAT(". $abbreviation. ".record_date, '%U') AS WEEKLY ";
-        }
-        
-        return $weekly;
-    }
-    
-    /**
-     * make query parts of week
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function perWeeklyQuery() {
-        $group_weekly = " GROUP BY WEEKLY ";
-        
-        return $group_weekly;
-    }
-    
-    /**
-     * format date of day
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function dateformatDailyQuery($abbreviation) {
-        $daily = "";
-        if(strlen($abbreviation) == 0) {
-            $daily = " DATE_FORMAT(record_date, '%d') AS DAILY ";
-        } else if(strlen($abbreviation) > 0) {
-            $daily = " DATE_FORMAT(". $abbreviation. ".record_date, '%d') AS DAILY ";
-        }
-        
-        return $daily;
-    }
-    
-    /**
-     * make query parts of day
-     * 
-     * @param string $abbreviation
-     * @return string
-     */
-    public function perDailyQuery() {
-        $group_daily = " GROUP BY DAILY ";
-        
-        return $group_daily;
-    }
-}
+<?php
+// --------------------------------------------------------------------
+//
+// $Id: LogAnalyzor.class.php 48595 2015-02-18 08:36:51Z tomohiro_ichikawa $
+//
+// Copyright (c) 2007 - 2008, National Institute of Informatics, 
+// Research and Development Center for Scientific Information Resources
+//
+// This program is licensed under a Creative Commons BSD Licence
+// http://creativecommons.org/licenses/BSD/
+//
+// --------------------------------------------------------------------
+
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryLogicBase.class.php';
+
+class Repository_Components_Loganalyzor extends RepositoryLogicBase
+{
+    /**
+     * Constructor
+     *
+     * @param var $session
+     * @param var $dbAccess
+     * @param string $transStartDate
+     */
+    public function __construct($session, $dbAccess, $transStartDate)
+    {
+        parent::__construct($session, $dbAccess, $transStartDate);
+    }
+
+    /**
+     * exclusive ip address
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function execlusiveIpAddressQuery($abbreviation) {
+        $query = "SELECT param_value FROM ". DATABASE_PREFIX. "repository_parameter ".
+                 "WHERE param_name = ? ;";
+        $params = array();
+        $params[] = "log_exclusion";
+        $result = $this->dbAccess->executeQuery($query, $params);
+        
+        $ip_address = str_replace(array("\r\n", "\r", "\n"), ",", $result[0]["param_value"]);
+        $ip_exclusion = "";
+        $colomun_name = "";
+        if(strlen($abbreviation) == 0) {
+            $column_name = "ip_address";
+        } else if(strlen($abbreviation) > 0) {
+            $column_name = $abbreviation. ".ip_address";
+        }
+        if(strlen($ip_address) > 0) {
+            $ip_exclusion = " AND ". $column_name. " NOT IN ('". $ip_address. "') ";
+        }
+        
+        return $ip_exclusion;
+    }
+  
+    /**
+     * exclusive double access
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function execlusiveDoubleAccessSubQuery($operation_id, $abbreviation, $start_date, $finish_date) {
+        $sub_query = "";
+        if($operation_id == RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE) {
+            if(strlen($abbreviation) == 0) {
+                $sub_query = "SELECT *,DATE_FORMAT(record_date, '%Y%m%d%k%i') FROM ". DATABASE_PREFIX. "repository_log ".
+                             "WHERE record_date >= '". $start_date. "' ".
+                             "AND record_date <= '". $finish_date. "' ".
+                             "AND operation_id = ". $operation_id. " ".
+                             "GROUP BY DATE_FORMAT(record_date, '%Y%m%d%k%i'), item_id, item_no, attribute_id, file_no, ".
+                             "user_agent, ip_address, operation_id, search_keyword, host, file_status, site_license, ".
+                             "input_type, login_status, group_id ";
+            } else {
+                $sub_query = "SELECT *,DATE_FORMAT(record_date, '%Y%m%d%k%i') FROM ". DATABASE_PREFIX. "repository_log AS ". $abbreviation. " ".
+                             "WHERE record_date >= '". $start_date. "' ".
+                             "AND record_date <= '". $finish_date. "' ".
+                             "AND operation_id = ". $operation_id. " ".
+                             "GROUP BY DATE_FORMAT(record_date, '%Y%m%d%k%i'), item_id, item_no, attribute_id, file_no, ".
+                             "user_agent, ip_address, operation_id, search_keyword, host, file_status, site_license, ".
+                             "input_type, login_status, group_id ";
+            }
+        } else {
+            $sub_query = DATABASE_PREFIX."repository_log";
+        }
+        
+        return $sub_query;
+    }
+    
+    /**
+     * exclusive robot
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function execlusiveRobotsQuery($abbreviation) {
+        $robots = "";
+        if(file_exists(WEBAPP_DIR.'/modules/repository/config/Robots_Exclusion')){
+            $fp = fopen(WEBAPP_DIR.'/modules/repository/config/Robots_Exclusion', "r");
+            while(!feof($fp)){
+                // read line
+                $file_line = fgets($fp);
+                $file_line = str_replace("\r\n", "", $file_line);
+                $file_line = str_replace("\n", "", $file_line);
+                // header '#' is coomment
+                $file_line = preg_replace("/^#.*/", "", $file_line);
+                if(strlen($file_line) == 0){
+                    continue;
+                }
+                if(strlen($robots) != 0){
+                    $robots .= " , ";
+                }
+                $robots .= "'". $file_line. "'";
+            }
+            fclose($fp);
+        }
+        
+        $robots_exclusion = "";
+        if(strlen($robots) > 0) {
+            if(strlen($abbreviation) == 0) {
+                $robots_exclusion = " AND (user_agent IS NULL OR user_agent NOT IN (". $robots. ")) ";
+            } else if(strlen($abbreviation) > 0) {
+                $robots_exclusion = " AND (".$abbreviation. ".user_agent IS NULL OR ".$abbreviation. ".user_agent NOT IN (". $robots. ")) ";
+            }
+        }
+        
+        return $robots_exclusion;
+    }
+    
+    /**
+     * format date of year
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function dateformatYearQuery($abbreviation) {
+        $year = "";
+        if(strlen($abbreviation) == 0) {
+            $year = " DATE_FORMAT(record_date, '%Y') AS YEAR ";
+        } else if(strlen($abbreviation) > 0) {
+            $year = " DATE_FORMAT(". $abbreviation. ".record_date, '%Y') AS YEAR ";
+        }
+        
+        return $year;
+    }
+    
+    /**
+     * make query parts of year
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function perYearQuery() {
+        $group_year = " GROUP BY YEAR ";
+        
+        return $group_year;
+    }
+    
+    /**
+     * format date of month
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function dateformatMonthlyQuery($abbreviation) {
+        $monthly = "";
+        if(strlen($abbreviation) == 0) {
+            $monthly = " DATE_FORMAT(record_date, '%m') AS MONTHLY ";
+        } else if(strlen($abbreviation) > 0) {
+            $monthly = " DATE_FORMAT(". $abbreviation. ".record_date, '%m') AS MONTHLY ";
+        }
+        
+        return $monthly;
+    }
+    
+    /**
+     * format make query parts of month
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function perMonthlyQuery() {
+        $group_monthly = " GROUP BY MONTHLY ";
+        
+        return $group_monthly;
+    }
+    
+    /**
+     * format date of week
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function dateformatWeeklyQuery($abbreviation) {
+        $weekly = "";
+        if(strlen($abbreviation) == 0) {
+            $weekly = " DATE_FORMAT(record_date, '%U') AS WEEKLY ";
+        } else if(strlen($abbreviation) > 0) {
+            $weekly = " DATE_FORMAT(". $abbreviation. ".record_date, '%U') AS WEEKLY ";
+        }
+        
+        return $weekly;
+    }
+    
+    /**
+     * make query parts of week
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function perWeeklyQuery() {
+        $group_weekly = " GROUP BY WEEKLY ";
+        
+        return $group_weekly;
+    }
+    
+    /**
+     * format date of day
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function dateformatDailyQuery($abbreviation) {
+        $daily = "";
+        if(strlen($abbreviation) == 0) {
+            $daily = " DATE_FORMAT(record_date, '%d') AS DAILY ";
+        } else if(strlen($abbreviation) > 0) {
+            $daily = " DATE_FORMAT(". $abbreviation. ".record_date, '%d') AS DAILY ";
+        }
+        
+        return $daily;
+    }
+    
+    /**
+     * make query parts of day
+     * 
+     * @param string $abbreviation
+     * @return string
+     */
+    public function perDailyQuery() {
+        $group_daily = " GROUP BY DAILY ";
+        
+        return $group_daily;
+    }
+    
+    /**
+     * check site license
+     * 
+     * @param string $abbreviation
+     * @param array $start_ip
+     * @param array $finish_ip
+     * @param array $user_id
+     * @return string
+     */
+    public function checkSitelicenseQuery($abbreviation, $start_ip, $finish_ip, $user_id) {
+        // カラム名の設定
+        if(strlen($abbreviation) > 0) {
+            $ip_column = $abbreviation.".numeric_ip_address";
+            $user_column = $abbreviation.".user_id";
+        } else {
+            $ip_column = "numeric_ip_address";
+            $user_column = "user_id";
+        }
+        
+        // サブクエリ文作成
+        // IPアドレス判定
+        $sitelicense = "";
+        for($ii = 0; $ii < count($start_ip); $ii++) {
+            // IPが無い場合はスルー
+            if(strlen($start_ip[$ii]) > 0 && strlen($finish_ip[$ii]) > 0) {
+                 // IPが複数ある場合はORで繋ぐ
+                if(strlen($sitelicense) > 0) {
+                    $sitelicense .= " OR ";
+                }
+                // 終了IPが未設定だった場合は一致検索を行う
+                if(strlen($finish_ip[$ii]) == 0) {
+                    $sitelicense .= $ip_column. " = ". $start_ip[$ii];
+                } else {
+                    // IP範囲の設定
+                    $start_ip_address = 0;
+                    $finish_ip_address = 0;
+                    // 開始IPの方が終了IPより大きい設定がされていた場合
+                    if($start_ip[$ii] > $finish_ip[$ii]) {
+                        // 開始IPと終了IPを入れ替える
+                        $start_ip_address = $finish_ip[$ii];
+                        $finish_ip_address = $start_ip[$ii];
+                    } else {
+                        $start_ip_address = $start_ip[$ii];
+                        $finish_ip_address = $finish_ip[$ii];
+                    }
+                    $sitelicense .= "(".
+                                    $start_ip_address. " <= ". $ip_column.
+                                    " AND ".
+                                    $ip_column. " <= ". $finish_ip_address.
+                                    ")";
+                }
+            }
+        }
+        // 組織所属判定
+        if(count($user_id) > 0) {
+            if(strlen($sitelicense) > 0) {
+                $sitelicense .= " OR ";
+            }
+            $sitelicense .= $user_column. " IN ( ";
+            for($ii = 0; $ii < count($user_id); $ii++) {
+                if($ii > 0) {
+                    $sitelicense .= ", ";
+                }
+                $sitelicense .= "'". $user_id[$ii]. "'";
+            }
+            $sitelicense .= " ) ";
+        }
+        
+        if(strlen($sitelicense) > 0) {
+            $sitelicense = " AND ( ". $sitelicense. " ) ";
+        }
+        
+        return $sitelicense;
+    }
+    
+    /**
+     * check site license
+     * 
+     * @param string $abbreviation
+     * @param array $item_type_id
+     * @return string
+     */
+    public function exclusiveSitelicenseItemtypeQuery($abbreviation, $item_type_id) {
+        // カラム名の設定
+        if(strlen($abbreviation) > 0) {
+            $item_type_id_column = $abbreviation. ".item_type_id";
+        } else {
+            $item_type_id_column = "item_type_id";
+        }
+        
+        // サブクエリ文作成
+        $exclusive_item_type = "";
+        if(count($item_type_id) > 0) {
+            $exclusive_item_type .= " AND ". $item_type_id_column. " NOT IN ( ";
+            for($ii = 0; $ii < count($item_type_id); $ii++) {
+                if($ii > 0) {
+                    $exclusive_item_type .= ", ";
+                }
+                $exclusive_item_type .= $item_type_id[$ii];
+            }
+            $exclusive_item_type .= " ) ";
+        }
+        
+        return $exclusive_item_type;
+    }
+}
 ?>
\ No newline at end of file
diff --git a/repository/components/NameAuthority.class.php b/repository/components/NameAuthority.class.php
index 09a7e21..65939de 100644
--- a/repository/components/NameAuthority.class.php
+++ b/repository/components/NameAuthority.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: NameAuthority.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: NameAuthority.class.php 30569 2014-01-09 07:37:40Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/QueryGenerator.class.php b/repository/components/QueryGenerator.class.php
index 8b26072..9a527b5 100644
--- a/repository/components/QueryGenerator.class.php
+++ b/repository/components/QueryGenerator.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: QueryGenerator.class.php 44575 2014-12-01 12:09:36Z tomohiro_ichikawa $
+// $Id: QueryGenerator.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -189,6 +189,7 @@ class Repository_Components_Querygenerator implements Repository_Components_Quer
     const REQUEST_PAGE_ID = "page_id";
     const REQUEST_BLOCK_ID = "block_id";
     const REQUEST_WEKO_ID = "weko_id";
+    const REQUEST_ITEM_IDS = "item_ids";
     const REQUEST_DISPLAY_LANG = "lang";
     const REQUEST_SEARCH_TYPE = "st";
     const REQUEST_MODULE_ID = "module_id";
@@ -557,12 +558,39 @@ class Repository_Components_Querygenerator implements Repository_Components_Quer
                     }
                     
                     break;
-                    
+
+                // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/20 --start--
+                case self::REQUEST_ITEM_IDS:
+                        // string length of weko_id is 1-8
+                    $result = $this->createINSearchColumnQuery(self::SORT_TABLE_SHORT_NAME, self::ITEM_TABLE, self::ITEM_TABLE_SHORT_NAME, $value, "item_id",
+                                                "AND", $connectQuery, $connectTermQuery, $connectQueryParam, $connectFlag, $connectType);
+
+                    if($result){
+                        $searchFlag = true;
+                    }
+
+                        break;
+               // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/20 --end--
+
                 case self::REQUEST_PUBDATE_FROM:
                 case self::REQUEST_PUBDATE_UNTIL:
                     if(!$addPubDate){
-                        $result = $this->createDateQuery(self::SORT_TABLE_SHORT_NAME, self::DATEOFISSUED_YMD_TABLE, self::DATEOFISSUED_YMD_TABLE_SHORT_NAME, 
-                                               $searchInfo->search_term[self::REQUEST_PUBDATE_FROM], $searchInfo->search_term[self::REQUEST_PUBDATE_UNTIL], false, 
+                        if (array_key_exists(self::REQUEST_PUBDATE_FROM, $searchInfo->search_term)) {
+                            $pubDateFrom = $searchInfo->search_term[self::REQUEST_PUBDATE_FROM];
+                        }
+                        else {
+                            $pubDateFrom = "";
+                        }
+                        
+                        if (array_key_exists(self::REQUEST_PUBDATE_UNTIL, $searchInfo->search_term)) {
+                            $pubDateUntil = $searchInfo->search_term[self::REQUEST_PUBDATE_UNTIL];
+                        }
+                        else {
+                            $pubDateUntil = "";
+                        }
+                        
+                        $result = $this->createDateQuery(self::SORT_TABLE_SHORT_NAME, self::DATEOFISSUED_YMD_TABLE, self::DATEOFISSUED_YMD_TABLE_SHORT_NAME,
+                                               $pubDateFrom, $pubDateUntil, false,
                                                "AND", $connectQuery, $connectTermQuery, $connectQueryParam, $connectFlag, $connectType);
                         if($result){
                             $searchFlag = true;
@@ -877,6 +905,11 @@ class Repository_Components_Querygenerator implements Repository_Components_Quer
                 $tmpTermQuery .= "MATCH(".$shortName.".metadata) AGAINST(? IN BOOLEAN MODE) ";
                 $connectQueryParam[] = "+".$searchStringList[$ii];
             } else {
+                // \は4重にする必要あり
+                $searchStringList[$ii] = mb_ereg_replace('\\\\','\\\\',$searchStringList[$ii]);
+                // %, _はエスケープする必要あり
+                $searchStringList[$ii] = mb_ereg_replace('%','\%',$searchStringList[$ii]);
+                $searchStringList[$ii] = mb_ereg_replace('_','\_',$searchStringList[$ii]);
                 $tmpTermQuery .= $shortName.".metadata LIKE ? ";
                 $connectQueryParam[] = "%".$searchStringList[$ii]."%";
             }
@@ -1017,7 +1050,7 @@ class Repository_Components_Querygenerator implements Repository_Components_Quer
                     $date .=  sprintf('%02d', $dateArray[1]);
                 }
                 if(count($dateArray) >= 3){
-                    if(strlen($fromDateList[2]) >= 2){
+                    if(strlen($dateArray[2]) >= 2){
                         $date .= substr($dateArray[2], 0, 2);
                     } else {
                         $date .=  sprintf('%02d', $dateArray[2]);
diff --git a/repository/components/RepositoryAction.class.php b/repository/components/RepositoryAction.class.php
index 3d522b0..94f0d72 100644
--- a/repository/components/RepositoryAction.class.php
+++ b/repository/components/RepositoryAction.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryAction.class.php 651 2014-11-13 10:14:11Z ivis $
+// $Id: RepositoryAction.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -11,6 +11,8 @@
 //
 // --------------------------------------------------------------------
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR.'/modules/repository/components/FW/ActionBase.class.php';
+require_once WEBAPP_DIR.'/modules/repository/components/FW/AppException.class.php';
 include_once MAPLE_DIR.'/includes/pear/File/Archive.php';
 require_once WEBAPP_DIR. '/modules/repository/components/JSON.php';
 ini_set('include_path', WEBAPP_DIR.'/modules/repository/files/pear'. PATH_SEPARATOR . ini_get('include_path'));
@@ -19,12 +21,11 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryConst.class.p
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAddinCaller.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDbAccess.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUserAuthorityManager.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryOutputFilter.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryExternalSearchWordManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexManager.class.php';
 
-class RepositoryException extends Exception
+class RepositoryException extends AppException
 {
     protected   $_DetailMsg = NULL;     //詳細メッセージ
 
@@ -55,7 +56,7 @@ class RepositoryException extends Exception
  * @package  [[リポジトリ]]
  * @access    public
  */
-class RepositoryAction extends Action
+class RepositoryAction extends ActionBase
 {
     var $Db;
     var $Session;
@@ -87,15 +88,22 @@ class RepositoryAction extends Action
      *
      * @access  public
      */
-    function initAction()
+    function initAction($isStartTrans = true)
     {
         try {
+            // 基底クラス初期化処理
+            $this->initialize();
+            
             //トランザクション開始日時の取得
-            //$this->TransStartDate = date('Y-m-d H:i:s') . substr(microtime(), 1, 4);
-            $DATE = new Date();
-            $this->TransStartDate = $DATE->getDate().".000";
-            //トランザクション開始処理
-            $this->Db->StartTrans();
+            $this->TransStartDate = $this->accessDate;
+            
+            // Mod for start trans twice T.Koyasu 2015/03/06 --start--
+            if($isStartTrans){
+                //トランザクション開始処理
+                $this->Db->StartTrans();
+            }
+            // Mod for start trans twice T.Koyasu 2015/03/06 --end--
+            
             // Add fix login data 2009/07/31 A.Suzuki --start--
             // ログイン情報復元処理
             $this->fixSessionData();
@@ -150,8 +158,10 @@ class RepositoryAction extends Action
             // Add database access class R.Matsuura 2013/11/12 --end--
             
             // Add private tree K.Matsuo 2013/04/08
-            $this->createPrivateTree();
-
+            
+            $repositoryIndexManager = new RepositoryIndexManager($this->Session, $this->Db, $this->TransStartDate);
+            $repositoryIndexManager->createPrivateTree();
+            
             return "success";
         }
         catch ( RepositoryException $exception ) {
@@ -171,7 +181,7 @@ class RepositoryAction extends Action
         $getdata =& $container->getComponent("GetData");
         $blocks =& $getdata->getParameter("blocks");
         // when weko module uninstall, $blocks==false.
-        if(!isset($blocks) || !is_array($blocks))
+        if(!isset($blocks) || !is_array($blocks) || !isset($blocks[$blockIds['block_id']]) )
         {
             $this->wekoThemeName = 'default';
             return;
@@ -249,6 +259,9 @@ class RepositoryAction extends Action
     function exitAction()
     {
         try {
+            // 基底クラス終了処理
+            $this->finalize();
+            
             //トランザクション終了処理
             $this->Db->CompleteTrans();
 
@@ -466,9 +479,18 @@ class RepositoryAction extends Action
                     return false;
                 }
             // Add input type "supple" 2009/08/24 A.Suzuki --end--
+            // Add input type "heading" 2015/04/28 S.Suzuki --start--
+            } else if($Result_List['item_attr_type'][$nCnt]['input_type'] == "heading"){
+                // 入力形式が見出し
+                // アイテム属性テーブルの属性値を取得
+                $search_result = $this->getItemAttrTableData($Item_ID,$Item_No,$attr_id,$nCnt,$Result_List,$Error_Msg);
+                if($search_result === false){
+                    return false;
+                }
+            // Add input type "heading" 2015/04/28 S.Suzuki --end--
             } else {
                 // 入力形式がその他
-                // アイテム属性テーブルの属性地を取得
+                // アイテム属性テーブルの属性値を取得
                 $search_result = $this->getItemAttrTableData($Item_ID,$Item_No,$attr_id,$nCnt,$Result_List,$Error_Msg, $empty_del_flag);
                 if($search_result === false){
                     return false;
@@ -771,6 +793,10 @@ class RepositoryAction extends Action
         }
         // Add scrape thumbnail data if "plural_enable" state is "disabled" T.Ichikawa 2013/9/17 --end--
         if(!$blob_flag){
+            if (!isset($this->attr_list)){
+                $this->attr_list = "";
+            }
+            
             for($nCnt=0;$nCnt<count($result_Thumbnail_Table);$nCnt++){
                 $this->attr_list .= $result_Thumbnail_Table[$nCnt]['file_name'];
                 $result_Thumbnail_Table[$nCnt]['file'] = "";
@@ -1305,10 +1331,12 @@ class RepositoryAction extends Action
         }
         
         // 検索テーブルデータ削除
+        require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
         $searchTableProcessing = new RepositorySearchTableProcessing($this->Session, $this->Db);
         $searchTableProcessing->deleteDataFromSearchTableByItemId($Item_ID, $Item_No);
         
         // DOI付与状態削除
+        require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
         $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
         $repositoryHandleManager->deleteDoiStatus($Item_ID, $Item_No);
     }
@@ -2891,7 +2919,7 @@ class RepositoryAction extends Action
         $xml_parser = xml_parser_create();
         $rtn = xml_parse_into_struct( $xml_parser, $content, $vals );
         if($rtn == 0){
-            $this->Session->setParameter("error_msg", "not right XML");
+            $this->Session->setParameter("error_msg", "Invalid XML Format");
             return false;
         }
         xml_parser_free($xml_parser);
@@ -2946,7 +2974,7 @@ class RepositoryAction extends Action
         $xml_parser = xml_parser_create();
         $rtn = xml_parse_into_struct( $xml_parser, $content, $vals );
         if($rtn == 0){
-            $this->Session->setParameter("error_msg", "not right XML");
+            $this->Session->setParameter("error_msg", "Invalid XML Format");
             return false;
         }
         xml_parser_free($xml_parser);
@@ -3715,8 +3743,8 @@ class RepositoryAction extends Action
         $detail_uri = "";
         // get DB data
         $query = "SELECT uri FROM ". DATABASE_PREFIX ."repository_item ".
-                 "WHERE item_id = '".$item_id."' ".
-                 "AND item_no = '".$item_no."'; ";
+                 "WHERE item_id = ".$item_id." ".
+                 "AND item_no = ".$item_no." ; ";
         $return = $this->Db->execute( $query );
         if($return === false || count($detail_uri)!=1){
             return $detail_uri;
@@ -4347,7 +4375,7 @@ class RepositoryAction extends Action
             return "";
         }
         $tmp = explode(" ",$datetime);
-        if($tmp[1]!=""){
+        if(isset($tmp[1]) && $tmp[1]!=""){
             $tmp_time = explode(".", $tmp[1]);
             $time = $tmp_time[0];
         }
@@ -4532,152 +4560,6 @@ class RepositoryAction extends Action
     }
     // Add input type "supple" 2009/08/24 A.Suzuki --end--
 
-    // Get supple data from opensearch 2009/09/01 A.Suzuki --start--
-    /**
-     * WEKOIDをキーに、サプリWEKOからサプリアイテム情報を取得する
-     *
-     * @param $mode "weko_id" or "item_ids"
-     * @param $id
-     * @return array $supple_data
-     */
-    function getSuppleDataFromOpenSearch($mode, $id){
-        // request URL send for supple weko
-        // パラメタテーブルからサプリWEKOのアドレスを取得する
-        $query = "SELECT param_value FROM ".DATABASE_PREFIX."repository_parameter ".
-                 "WHERE param_name = 'supple_weko_url';";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return false;
-        }
-        if($result[0]['param_value'] == ""){
-            // no address error
-            $this->Session->setParameter("supple_error", 1);
-            return false;
-        } else {
-            $send_param = $result[0]['param_value'];
-        }
-
-        if($mode == "weko_id"){
-            $send_param .= "/?action=repository_opensearch&weko_id=".$id."&format=rss";
-        } else {
-            $send_param .= "/?action=repository_opensearch&item_ids=".$id."&format=rss";
-        }
-
-
-        /////////////////////////////
-        // HTTP_Request init
-        /////////////////////////////
-        // send http request
-        $option = array(
-            "timeout" => "10",
-            "allowRedirects" => true,
-            "maxRedirects" => 3,
-        );
-        // Modfy proxy 2011/12/06 Y.Nakao --start--
-        $proxy = $this->getProxySetting();
-        if($proxy['proxy_mode'] == 1)
-        {
-            $option = array(
-                    "timeout" => "10",
-                    "allowRedirects" => true,
-                    "maxRedirects" => 3,
-                    "proxy_host"=>$proxy['proxy_host'],
-                    "proxy_port"=>$proxy['proxy_port'],
-                    "proxy_user"=>$proxy['proxy_user'],
-                    "proxy_pass"=>$proxy['proxy_pass']
-                );
-        }
-        // Modfy proxy 2011/12/06 Y.Nakao --end--
-        $http = new HTTP_Request($send_param, $option);
-        // setting HTTP header
-        $http->addHeader("User-Agent", $_SERVER['HTTP_USER_AGENT']);
-        $http->addHeader("Referer", $_SERVER['HTTP_REFERER']);
-
-        /////////////////////////////
-        // run HTTP request
-        /////////////////////////////
-        $response = $http->sendRequest();
-        if (!PEAR::isError($response)) {
-            $charge_code = $http->getResponseCode();// ResponseCode(200等)を取得
-            $charge_header = $http->getResponseHeader();// ResponseHeader(レスポンスヘッダ)を取得
-            $charge_body = $http->getResponseBody();// ResponseBody(レスポンステキスト)を取得
-            $charge_Cookies = $http->getResponseCookies();// クッキーを取得
-        }
-        // get response
-        $response_xml = $charge_body;
-
-        /////////////////////////////
-        // parse response XML
-        /////////////////////////////
-        try{
-            $xml_parser = xml_parser_create();
-            $rtn = xml_parse_into_struct( $xml_parser, $response_xml, $vals );
-            if($rtn == 0){
-                // get false error
-                $this->Session->setParameter("supple_error", 2);
-                return false;
-            }
-            xml_parser_free($xml_parser);
-        } catch(Exception $ex){
-            // get false error
-            $this->Session->setParameter("supple_error", 2);
-            return false;
-        }
-
-        /////////////////////////////
-        // get XML data
-        /////////////////////////////
-        $item_flag = false;
-        $supple_data = array();
-        foreach($vals as $val){
-            if($val['tag'] == "ITEM"){
-                    if($val['type'] == "open"){
-                        $item_flag = true;
-                    }
-                    if($item_flag == true && $val['type'] == "close"){
-                        $item_flag = false;
-                        if($supple_data["supple_weko_item_id"] != "" && $supple_data["supple_weko_item_id"] != null){
-                            break;
-                        }
-                    }
-            }
-            if($item_flag){
-                switch($val['tag']){
-                    case "TITLE":   // サプリアイテム:タイトル
-                        $supple_data["supple_title"] = $val['value'];
-                        break;
-                    case "DCTERMS:ALTERNATIVE": // サプリアイテム:タイトル(英)
-                        $supple_data["supple_title_en"] = $val['value'];
-                        break;
-                    case "LINK":    // サプリアイテム:詳細画面URL
-                        $supple_data["uri"] = $val['value'];
-                        break;
-                    case "DC:IDENTIFIER":
-                        // サプリアイテム:ファイルID(attribute_id)
-                        if(ereg("^file_id:", $val['value']) > 0){
-                            $supple_data["file_id"] = ereg_replace("file_id:", "", $val['value']);
-                        }
-                        // サプリアイテム:アイテムID
-                        else {
-                            $supple_data["supple_weko_item_id"] = $val['value'];
-                        }
-                        break;
-                    case "DC:TYPE": // サプリアイテム:アイテムタイプ名
-                        $supple_data["supple_item_type_name"] = $val['value'];
-                        break;
-                    case "DC:FORMAT":   // サプリアイテム:マイムタイプ
-                        $supple_data["mime_type"] = $val['value'];
-                        break;
-                    default :
-                        break;
-                }
-            }
-        }
-
-        return $supple_data;
-    }
-    // Get supple data from opensearch 2009/09/01 A.Suzuki --end--
-
     // Add get edit item data for supple 2009/09/28 A.Suzuki --start--
     /**
      * 編集するアイテム情報をセッションに保存する
@@ -5207,7 +5089,7 @@ class RepositoryAction extends Action
         $indice = $Result_List['position_index'];
         for($ii=0; $ii<count($indice); $ii++){
             $query = "SELECT index_name, index_name_english FROM ".DATABASE_PREFIX."repository_index ".
-                     "WHERE index_id = '".$indice[$ii]["index_id"]."';";
+                     "WHERE index_id = ".$indice[$ii]["index_id"]." ;";
             $ret = $this->Db->execute($query);
             if($ret === false || count($ret)!=1){
                 return false;
@@ -5319,110 +5201,6 @@ class RepositoryAction extends Action
     }
     // Add review mail setting 2009/09/24 Y.Nakao --end--
 
-    // Get supple WEKO prefixID from opensearch 2009/10/13 A.Suzuki --start--
-    /**
-     * サプリWEKOからprefixIDを取得する
-     *
-     * @return string $supple_prefix_id
-     */
-    function getSupplePrefixIDFromOpenSearch(){
-        // request URL send for supple weko
-        // パラメタテーブルからサプリWEKOのアドレスを取得する
-        $query = "SELECT param_value FROM ".DATABASE_PREFIX."repository_parameter ".
-                 "WHERE param_name = 'supple_weko_url';";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $this->Session->setParameter("supple_error", 1);
-            return false;
-        }
-        if($result[0]['param_value'] == ""){
-            // no address error
-            $this->Session->setParameter("supple_error", 1);
-            return false;
-        } else {
-            $send_param = $result[0]['param_value'];
-        }
-
-        $send_param .= "/?action=repository_opensearch&prefix=true&format=rss";
-
-        /////////////////////////////
-        // HTTP_Request init
-        /////////////////////////////
-        // send http request
-        $option = array(
-            "timeout" => "10",
-            "allowRedirects" => true,
-            "maxRedirects" => 3,
-        );
-        // Modfy proxy 2011/12/06 Y.Nakao --start--
-        $proxy = $this->getProxySetting();
-        if($proxy['proxy_mode'] == 1)
-        {
-            $option = array(
-                    "timeout" => "10",
-                    "allowRedirects" => true,
-                    "maxRedirects" => 3,
-                    "proxy_host"=>$proxy['proxy_host'],
-                    "proxy_port"=>$proxy['proxy_port'],
-                    "proxy_user"=>$proxy['proxy_user'],
-                    "proxy_pass"=>$proxy['proxy_pass']
-                );
-        }
-        // Modfy proxy 2011/12/06 Y.Nakao --end--
-        $http = new HTTP_Request($send_param, $option);
-        // setting HTTP header
-        $http->addHeader("User-Agent", $_SERVER['HTTP_USER_AGENT']);
-        $http->addHeader("Referer", $_SERVER['HTTP_REFERER']);
-
-        /////////////////////////////
-        // run HTTP request
-        /////////////////////////////
-        $response = $http->sendRequest();
-        if (!PEAR::isError($response)) {
-            $charge_code = $http->getResponseCode();// ResponseCode(200等)を取得
-            $charge_header = $http->getResponseHeader();// ResponseHeader(レスポンスヘッダ)を取得
-            $charge_body = $http->getResponseBody();// ResponseBody(レスポンステキスト)を取得
-            $charge_Cookies = $http->getResponseCookies();// クッキーを取得
-        }
-        // get response
-        $response_xml = $charge_body;
-
-        /////////////////////////////
-        // parse response XML
-        /////////////////////////////
-        try{
-            $xml_parser = xml_parser_create();
-            $rtn = xml_parse_into_struct( $xml_parser, $response_xml, $vals );
-            if($rtn == 0){
-                // get false error
-                $this->Session->setParameter("supple_error", 2);
-                return false;
-            }
-            xml_parser_free($xml_parser);
-        } catch(Exception $ex){
-            // get false error
-            $this->Session->setParameter("supple_error", 2);
-            return false;
-        }
-
-        /////////////////////////////
-        // get XML data
-        /////////////////////////////
-        $supple_prefix_id = "";
-        foreach($vals as $val){
-            switch($val['tag']){
-                case "DC:IDENTIFIER":
-                    // prefixID
-                    $supple_prefix_id = $val['value'];
-                    break;
-                default :
-                    break;
-            }
-        }
-
-        return $supple_prefix_id;
-    }
-    // Get supple WEKO prefixID from opensearch 2009/10/13 A.Suzuki --end--
     /**
      * check any file can export status
      *
@@ -5507,140 +5285,6 @@ class RepositoryAction extends Action
         return true;
     }
 
-
-    // Add log common action Y.Nakao 2010/03/05 --start--
-    /**
-     * insert log
-     *
-     * @param int $operation_id 1:insert item
-     *                          2:download item
-     *                          3:view item
-     *                          4:search item
-     *                          5:top page access
-     *                          6:Flash view(ebook)
-     * @param int $item_id
-     * @param int $item_no
-     * @param int $attr_id
-     * @param int $file_no
-     * @param string $search_keyword
-     */
-    function entryLog($operation_id, $item_id = "", $item_no = "", $attr_id= "", $file_no = "", $search_keyword = ""){
-        // get log id
-        $log_no = $this->Db->nextSeq("repository_log");
-        // user_id
-        $user_id = $this->Session->getParameter("_user_id");
-        // ip address
-        if(isset($_SERVER['HTTP_X_FORWARDED_FOR']) && strlen($_SERVER['HTTP_X_FORWARDED_FOR']) > 0) {
-            $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
-        } else {
-            $ip = getenv("REMOTE_ADDR");
-        }
-        // convert ip address to numeric
-        
-        // host
-        // when host is null, host eq ip address
-        if(isset($_SERVER['HTTP_X_FORWARDED_FOR']) && strlen($_SERVER['HTTP_X_FORWARDED_FOR']) > 0) {
-            $host = $_SERVER['HTTP_X_FORWARDED_FOR'];
-        } else {
-            $host = getenv("REMOTE_HOST");
-        }
-        if ($host == null || $host == $ip){
-            $host = gethostbyaddr($ip);
-        }
-        // file_status
-        $fileStatus = RepositoryConst::LOG_FILE_STATUS_UNKNOWN;
-        // site_license
-        $siteLicense = RepositoryConst::LOG_SITE_LICENSE_OFF;
-        // input_type
-        $inputType = null;
-        // login_status
-        $loginStatus = null;
-        // group_id
-        $groupId = null;
-        
-        // numeric ip address
-        $ip_elements = explode(".", $ip);
-        $numeric_ip = sprintf("%d", $ip_elements[0]).
-                      sprintf("%03d", $ip_elements[1]).
-                      sprintf("%03d", $ip_elements[2]).
-                      sprintf("%03d", $ip_elements[3]);
-        // referer
-        $referer = "";
-        if(isset($_SERVER["HTTP_REFERER"]))
-        {
-            $referer = $_SERVER["HTTP_REFERER"];
-        }
-        else 
-        {
-            $referer = getenv("HTTP_REFERER");
-        }
-        
-        // If file download, set download status
-        if($operation_id == RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE
-            && intval($item_id)>0 && intval($item_no)>0 && intval($attr_id)>0 && intval($file_no)>0)
-        {
-            // Get file download status
-            $this->getFileDownloadStatusForEntryLog(
-                $item_id, $item_no, $attr_id, $file_no,
-                $fileStatus, $inputType, $loginStatus, $groupId);
-        }
-        // Add site license info to log 2013/07/02 A.Suzuki --start--
-        // Set Validator
-        require_once WEBAPP_DIR. '/modules/repository/validator/Validator_DownloadCheck.class.php';
-        $validator = new Repository_Validator_DownloadCheck();
-        $initResult = $validator->setComponents($this->Session, $this->Db);
-
-        // Check Site License
-        $result = $validator->checkSiteLicense($item_id, $item_no);
-        if($result == "true")
-        {
-            $siteLicense = RepositoryConst::LOG_SITE_LICENSE_ON;
-        }
-        // Add site license info to log 2013/07/02 A.Suzuki --end--
-
-        // entry log
-        $query_log = "INSERT INTO ". DATABASE_PREFIX ."repository_log ".
-                    " ( log_no, record_date, user_id, operation_id, ".
-                    " item_id, item_no, attribute_id, file_no, search_keyword, ".
-                    " ip_address, numeric_ip_address, host, user_agent, referer, file_status, site_license, input_type, login_status, group_id) ".
-                    " VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?); ";
-        $params = array();
-        $params[] = intval($log_no);
-        $params[] = $this->TransStartDate;
-        $params[] = $user_id;
-        $params[] = $operation_id;
-        $params[] = $item_id;
-        $params[] = $item_no;
-        $params[] = $attr_id;
-        $params[] = $file_no;
-        $params[] = $search_keyword;
-        $params[] = $ip;
-        $params[] = $numeric_ip;
-        $params[] = $host;
-        $params[] = $_SERVER['HTTP_USER_AGENT'];
-        $params[] = $referer;
-        $params[] = $fileStatus; // file_status
-        $params[] = $siteLicense; // site_license
-        $params[] = $inputType; // input_type
-        $params[] = $loginStatus; // login_status
-        $params[] = $groupId; // group_id
-        $result = $this->Db->execute($query_log, $params);
-        if ($result === false) {
-            $errMsg = $this->Db->ErrorMsg();
-            $tmpstr = sprintf("log : %s", $errMsg );
-            $this->Session->setParameter("error_msg", $tmpstr);
-            $this->failTrans();                //トランザクション失敗を設定(ROLLBACK)
-            return false;
-        }
-        // Add referer display 2014/05/20 T.Ichikawa --start--
-        if($operation_id == 3 && $item_id != 0 && $item_no != 0 && $file_no == 0) {
-            $searchWordManager = new Repository_Components_RepositoryExternalSearchWordManager($this->Session, $this->Db, $this->TransStartDate);
-            $searchWordManager->insertExternalSearchWordFromURL($item_id, $item_no, $referer);
-        }
-        // Add referer display 2014/05/20 T.Ichikawa --end--
-    }
-    // Add log common action Y.Nakao 2010/03/05 --end--
-
     // check supple link 2010/03/16 Y.Nakao --start--
     function checkSuppleWEKOlink($supple_table = false){
         // there has supple WEKO url and got prefix ID
@@ -5654,7 +5298,8 @@ class RepositoryAction extends Action
         } else if(strlen($result[0]['param_value']) == 0){
             return false;
         }
-        
+
+        require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
         $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->dbAccess, $this->TransStartDate);
         
         $prefixID = $repositoryHandleManager->getPrefix(RepositoryHandleManager::ID_Y_HANDLE);
@@ -7010,7 +6655,7 @@ class RepositoryAction extends Action
      * @param int $loginStatus
      * @param int $groupId
      */
-    private function getFileDownloadStatusForEntryLog(
+    public function getFileDownloadStatusForEntryLog(
         $itemId, $itemNo, $attrId, $fileNo, &$fileStatus,
         &$inputType, &$loginStatus, &$groupId)
     {
@@ -7022,7 +6667,7 @@ class RepositoryAction extends Action
         $loginStatus = null;
         // group_id
         $groupId = null;
-
+        
         // Get file info
         $query = "SELECT ATTRTYPE.".RepositoryConst::DBCOL_REPOSITORY_ITEM_ATTR_TYPE_IMPUT_TYPE.", FILE.* ".
                  "FROM ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_ITEM_ATTR_TYPE." AS ATTRTYPE, ".
@@ -7055,11 +6700,12 @@ class RepositoryAction extends Action
             {
                 $inputType = RepositoryConst::LOG_INPUT_TYPE_FILE;
             }
-
+            
             // login status
             $userId = $this->Session->getParameter("_user_id");
             $userAuthId = $this->Session->getParameter("_user_auth_id");
             $authId = $this->getRoomAuthorityID();
+            
             if(strlen($userId)==0 || $userId == "0")
             {
                 // No login user
@@ -7103,7 +6749,7 @@ class RepositoryAction extends Action
                     }
                 }
             }
-
+            
             // download status
             $fileStatus = RepositoryConst::LOG_FILE_STATUS_CLOSE;
             $this->Session->setParameter("_user_id", 0);
@@ -7111,6 +6757,7 @@ class RepositoryAction extends Action
             if($validator->checkCanItemAccess($itemId, $itemNo))
             {
                 $downloadFlag = $validator->checkFileDownloadViewFlag($fileInfo[0][RepositoryConst::DBCOL_REPOSITORY_FILE_PUB_DATE], $this->TransStartDate);
+                
                 if($downloadFlag === Repository_Validator_DownloadCheck::ACCESS_OPEN)
                 {
                     $fileStatus = RepositoryConst::LOG_FILE_STATUS_OPEN;
@@ -7121,168 +6768,6 @@ class RepositoryAction extends Action
         }
     }
 
-    /**
-     * Get user_authority_id by user ID
-     *
-     * @param string $userId
-     * @return string
-     */
-    public function getUserAuthIdByUserId($userId)
-    {
-        $userAuthId = "";
-        if(strlen($userId) != 0 && $userId != "0")
-        {
-            $query = "SELECT AUTH.user_authority_id ".
-                     "FROM ".DATABASE_PREFIX."users AS USERS, ".
-                             DATABASE_PREFIX."authorities AS AUTH ".
-                     "WHERE USERS.role_authority_id = AUTH.role_authority_id ".
-                     "AND USERS.user_id = ? ;";
-            $params = array();
-            $params[] = $userId;
-            $result = $this->Db->execute($query, $params);
-            if($result !== false && count($result) > 0)
-            {
-                $userAuthId = $result[0]["user_authority_id"];
-            }
-        }
-
-        return $userAuthId;
-    }
-    // Add auto create private_tree K.matsuo 2013/4/5 --start--
-    /**
-     * Create PrivateTree automatically
-     *
-     */
-    public function createPrivateTree(){
-        // 親インデックスIDの取得
-        $parentIndexId = null;
-        $error_msg = null;
-        $return = $this->getAdminParam('privatetree_parent_indexid', $parentIndexId, $error_msg);
-        if($return == false){
-            return false;
-        }
-        if(!$this->isCreatePrivatetree($parentIndexId)){
-            return;
-        }
-        $user_id = $this->Session->getParameter("_user_id");
-        // Modify Private Tree name K.Matsuo 2013/10/01 --start--
-        $return = $this->getAdminParam('private_tree_composition', $privateTreeCompositionXML, $error_msg);
-        
-        // Mod private index name is handle name 2014/03/25 T.Koyasu --start--
-        $index_name = $this->Session->getParameter("_handle");
-        if(strlen($index_name) === 0){
-            // for handle name is empty on shibboleth login
-            $index_name = $this->Session->getParameter("_login_id");
-        }
-        // Mod private index name is handle name 2014/03/25 T.Koyasu --end--
-        
-        // Modify Private Tree name K.Matsuo 2013/10/01 --end--
-        // Move require_once for avoid infinity loop K.Matsuo 2013/09/30
-        require_once WEBAPP_DIR. '/modules/repository/action/edit/tree/Tree.class.php';
-
-        $this->editTree = new Repository_Action_Edit_Tree();
-        $this->editTree->Session = $this->Session;
-        $this->editTree->Db = $this->Db;
-        $this->editTree->setPrivateTreeDefaultAccessControlList();
-        $this->editTree->TransStartDate = $this->TransStartDate;
-        // 新インデックスID取得
-        $index_num = $this->editTree->getNewIndexId();
-        $showOrder = $this->editTree->getShowOrder($parentIndexId) + 1;
-        $this->setLangResource();
-        $groupData = array();
-        $this->editTree->getAccessGroupData($this->editTree->getDefaultAccessRoleRoom(), $this->editTree->getDefaultExclusiveAclGroups(), $groupData);
-        $authData = array();
-        $this->editTree->getAccessAuthData($this->editTree->getDefaultAccessRoleIds(), $this->editTree->getDefaultExclusiveRoleIds(), $authData);
-
-        $newIndexData = array();
-        $newIndexData['index_id'] = $index_num;
-        $newIndexData["index_name"] = $index_name;
-        $newIndexData["index_name_english"] = $index_name;
-        $newIndexData["parent_index_id"] = $parentIndexId;
-        $newIndexData["show_order"] = $showOrder;
-        // Add specialized support for open.repo "private tree public" Y.Nakao 2013/06/21 --start--
-        // 通常は非公開
-        // Fix harvest_public_state 2014/03/15 Y.Nakao --start--
-        $newIndexData["public_state"] = "false";
-        $newIndexData["harvest_public_state"] = 0;
-        if(_REPOSITORY_PRIVATETREE_PUBLIC)
-        {
-            // プライベートツリーを公開するフラグがONの場合のみ公開する
-            $newIndexData["public_state"] = "true";
-            $newIndexData["harvest_public_state"] = 1;
-        }
-        // Fix harvest_public_state 2014/03/15 Y.Nakao --end--
-        // Add specialized support for open.repo "private tree public" Y.Nakao 2013/06/21 --end--
-        $newIndexData["pub_year"] = substr($this->TransStartDate, 0, 4);
-        $newIndexData["pub_month"] = substr($this->TransStartDate, 5, 2);
-        $newIndexData["pub_day"] = substr($this->TransStartDate, 7, 2);
-        $newIndexData["pub_date"] = substr($this->TransStartDate, 0, 10). ' 00:00:00.000';
-        $newIndexData["access_group_id"] = $groupData["access_group_id"];
-        $newIndexData["access_role_id"] = $authData["access_role_id"];
-        $newIndexData["comment"] = "";
-        $newIndexData["display_more"] = "";
-        $newIndexData["rss_display"] = "";
-        $newIndexData["access_role_room"] = $this->editTree->getDefaultAccessRoleRoom();
-        // Mod Bug fix No.55 2014/03/24 T.Koyasu --start--
-        $newIndexData["access_role"] = $newIndexData["access_role_id"]. "|". $newIndexData["access_role_room"];
-        // Mod Bug fix No.55 2014/03/24 T.Koyasu --end--
-        $newIndexData["display_type"] = "";
-        $newIndexData["select_index_list_display"] = "";
-        $newIndexData["select_index_list_name"] = "";
-        $newIndexData["select_index_list_name_english"] = "";
-        $newIndexData["exclusive_acl_role_id"] = $this->editTree->getDefaultExclusiveRoleIds();
-        $newIndexData["exclusive_acl_room_auth"] = $this->editTree->getDefaultExclusiveAclRoleRoom();
-        $newIndexData["exclusive_acl_group_id"] = $this->editTree->getDefaultExclusiveAclGroups();
-        $newIndexData["repository_id"] = 0;
-        $newIndexData["set_spec"] = "";
-        $newIndexData["owner_user_id"] = $user_id;
-        $result = $this->editTree->insertIndex($newIndexData);
-        if($result === false){
-            print_r($this->Db->ErrorMsg());
-            $errMsg = $this->Db->ErrorMsg();
-            $this->failTrans(); // ROLLBACK
-            return false;
-        }
-        if($privateTreeCompositionXML != ""){
-            $this->createPrivateTreeChildIndex($privateTreeCompositionXML, $index_num, $user_id);
-        }
-    }
-    /**
-     * Get user_authority_id by user ID
-     *
-     */
-    public function isCreatePrivatetree($parentIndexId)
-    {
-        $login_id = $this->Session->getParameter("_login_id");
-        $user_id = $this->Session->getParameter("_user_id");
-        // ログインしていないとき
-        if($user_id == '0' || strlen($login_id) == 0){
-            return false;
-        }
-        // ログインしているとき
-        $return = $this->getAdminParam('is_make_privatetree', $makePrivatetree, $error_msg);
-        if($makePrivatetree != 1){
-            // プライベートツリーを作成しないとき
-            return false;
-        }
-        $auth_id = $this->getRoomAuthorityID();
-        // アイテム登録権限チェック(一般ユーザ以上)
-        if($auth_id >= REPOSITORY_ITEM_REGIST_AUTH){
-            $query = "SELECT count(*) FROM ". DATABASE_PREFIX. "repository_index ".
-                     "WHERE owner_user_id = ? AND parent_index_id = ? AND is_delete = 0;";
-            $params = array();
-            $params[] = $user_id;
-            $params[] = $parentIndexId;
-            $ret = $this->Db->execute($query, $params);
-            if(count($ret) == 0 || $ret[0]['count(*)'] == 0) {
-                return true;
-            } else {
-                return false;
-            }
-        } else {
-            return false;
-        }
-    }
     // Add auto create private_tree K.matsuo 2013/4/5 --end--
 
     // Fix check index_id Y.Nakao 2013/06/07 --start--
@@ -7453,7 +6938,7 @@ class RepositoryAction extends Action
                     // add private tree index_id
                     $idx = array("index_id"=>$privateIndexTreeId);
                     $query = "SELECT index_name, index_name_english FROM ".DATABASE_PREFIX."repository_index ".
-                             "WHERE index_id = '".$privateIndexTreeId."';";
+                             "WHERE index_id = ".$privateIndexTreeId." ;";
                     $ret = $this->Db->execute($query);
                     if($ret === false || count($ret)!=1){
                         return $indice;
@@ -7546,148 +7031,6 @@ class RepositoryAction extends Action
     }
     //Add scrape attrTableData if "plural_enable" state change "enabled" to "disabled" 2013/09/09 T.Ichikawa --end--
 
-    // Add OpenDepo Private Tree Composition K.Matsuo 2013/10/01 --start--
-
-    private function createPrivateTreeChildIndex($privateTreeCompositionXML, $parentIndexId, $insUserId)
-    {
-        /////////////// XML perser ///////////////
-        try{
-            $xml_parser = xml_parser_create();
-            $rtn = xml_parse_into_struct( $xml_parser, $privateTreeCompositionXML, $vals );
-            if($rtn == 0){
-                return false;
-                xml_parser_free($xml_parser);
-            }
-        } catch(Exception $ex){
-            print_r("Failed: Exception occurrd in XML parse.");
-            return false;
-        }
-
-        require_once WEBAPP_DIR. '/modules/repository/action/edit/tree/Tree.class.php';
-        // インデックス登録用クラスの初期化
-        // Initialization of the class for index registration
-        /////////////// XML analysis ///////////////
-        $index_info = array();
-        $groupData = array();
-        $this->editTree->getAccessGroupData($this->editTree->getDefaultAccessRoleRoom(), $this->editTree->getDefaultExclusiveAclGroups(), $groupData);
-        $authData = array();
-        $this->editTree->getAccessAuthData($this->editTree->getDefaultAccessRoleIds(), $this->editTree->getDefaultExclusiveRoleIds(), $authData);
-        $index_id = -1;
-        foreach($vals as $val){
-            switch($val['tag']){
-                case "RDF:RDF":
-                    break;
-                case "RDF:DESCRIPTION":
-                    if($val['type'] == "open"){
-                        $index_id = 0;
-                    }else if($val['type'] == "close"){
-                        $index_id = -1;
-                    }
-                    break;
-                case "DC:IDENTIFIER":
-                    if($index_id >= 0){
-                        if(!isset($index_info[$val['value'] + $parentIndexId])){
-                            $index_id = $val['value'] + $parentIndexId;
-                            $index_info[$index_id] = array();
-                            $index_info[$index_id]['index_id'] = $val['value'] + $parentIndexId;
-                            $index_info[$index_id]['parent_index_id'] = $parentIndexId;
-                            $index_info[$index_id]['index_name'] = "";
-                            $index_info[$index_id]['index_name_english'] = "";
-                            $index_info[$index_id]['comment'] = "";
-                            $index_info[$index_id]['pub_date'] = "";
-                            $index_info[$index_id]['more'] = "";
-                            $index_info[$index_id]['rss'] = "";
-                            $index_info[$index_id]['pid_chk'] = false;
-                            $index_info[$index_id]["pub_year"] = substr($this->TransStartDate, 0, 4);
-                            $index_info[$index_id]["pub_month"] = substr($this->TransStartDate, 5, 2);
-                            $index_info[$index_id]["pub_day"] = substr($this->TransStartDate, 7, 2);
-                            $index_info[$index_id]["pub_date"] = substr($this->TransStartDate, 0, 10). ' 00:00:00.000';
-                            $index_info[$index_id]["access_group_id"] = $groupData["access_group_id"];
-                            $index_info[$index_id]["access_role_id"] = $authData["access_role_id"];
-                            $index_info[$index_id]["comment"] = "";
-                            $index_info[$index_id]["display_more"] = "";
-                            $index_info[$index_id]["rss_display"] = "";
-                            $index_info[$index_id]["access_role_room"] = $this->editTree->getDefaultAccessRoleRoom();
-                            // Mod Bug fix No.55 2014/03/24 T.Koyasu --start--
-                            $index_info[$index_id]["access_role"] = $index_info[$index_id]["access_role_id"]. "|". $index_info[$index_id]["access_role_room"];
-                            // Mod Bug fix No.55 2014/03/24 T.Koyasu --end--
-                            $index_info[$index_id]["display_type"] = "";
-                            $index_info[$index_id]["select_index_list_display"] = "";
-                            $index_info[$index_id]["select_index_list_name"] = "";
-                            $index_info[$index_id]["select_index_list_name_english"] = "";
-                            $index_info[$index_id]["exclusive_acl_role_id"] = $this->editTree->getDefaultExclusiveRoleIds();
-                            $index_info[$index_id]["exclusive_acl_room_auth"] = $this->editTree->getDefaultExclusiveAclRoleRoom();
-                            $index_info[$index_id]["exclusive_acl_group_id"] = $this->editTree->getDefaultExclusiveAclGroups();
-                            $index_info[$index_id]["repository_id"] = 0;
-                            $index_info[$index_id]["set_spec"] = "";
-                            $index_info[$index_id]["owner_user_id"] = $insUserId;
-                            $index_info[$index_id]["public_state"] = "false";
-                            $index_info[$index_id]["harvest_public_state"] = 0;
-                            if(_REPOSITORY_PRIVATETREE_PUBLIC)
-                            {
-                                // プライベートツリーを公開するフラグがONの場合のみ公開する
-                                $index_info[$index_id]["public_state"] = "true";
-                                $index_info[$index_id]["harvest_public_state"] = 1;
-                            }
-                        } else {
-                            $this->outputError("ErrorXML", "XML description is NG");
-                            exit();
-                        }
-                    }
-                    break;
-                case "DC:TITLE":
-                    if($index_id >= 0){
-                        if($val['attributes']['XML:LANG'] == "ja"){
-                            $index_info[$index_id]['index_name'] = $val['value'];
-                        } else if($val['attributes']['XML:LANG'] == "en"){
-                            $index_info[$index_id]['index_name_english'] = $val['value'];
-                        } else {
-                            $index_info[$index_id]['index_name'] = $val['value'];
-                            $index_info[$index_id]['index_name_english'] = $val['value'];
-                        }
-                    }
-                    break;
-                case "DC:COMMENT":
-                    $index_info[$index_id]['comment'] = $val['value'];
-                    break;
-                case "DC:PUBDATE":
-                    $index_info[$index_id]['pub_date'] = $val['value'];
-                    break;
-                case "DC:MORE":
-                    if(is_numeric($val['value'])){
-                        $index_info[$index_id]['more'] = intval($val['value']);
-                    }
-                    break;
-                case "DC:RSS":
-                    $index_info[$index_id]['rss'] = $val['value'];
-                    break;
-                case "DC:RELATION":
-                    if($index_id >= 0){
-                        $index_info[$index_id]['parent_index_id'] = $val['value'] + $parentIndexId;
-                    }
-                    break;
-                default:
-                    break;
-            }
-        }
-        /////////////// insert index ///////////////
-        $show_order_list = array();
-        foreach ($index_info as $key => $val){
-            if(isset($show_order_list[$val['parent_index_id']])){
-                $show_order_list[$val['parent_index_id']] = $this->editTree->getShowOrder($val['parent_index_id']) + 1;
-            }
-            $val["show_order"] = $show_order_list[$val['parent_index_id']];
-            $show_order_list[$val['parent_index_id']] += 1;
-        }
-        $result = $this->editTree->insertMultiIndex($index_info);
-        if($result === false){
-            $errMsg = $this->Db->ErrorMsg();
-            $this->failTrans(); // ROLLBACK
-            return false;
-        }
-    }
-    // Add OpenDepo Private Tree Composition K.Matsuo 2013/10/01 --end--
-
     // Add DSpace data move T.Koyasu 2013/10/23 --start--
     /**
      * base process of Action and View
@@ -7701,6 +7044,9 @@ class RepositoryAction extends Action
             // create flg of exec init
             $nIsInit = false;
             
+            // トランザクション外前処理
+            $this->beforeTrans();
+            
             // init proc
             $nInitResult = $this->initAction();
             
@@ -7711,14 +7057,31 @@ class RepositoryAction extends Action
             }
             $nIsInit = true;
             
-            // call the method(executeForWeko) of each inheritance class
-            $strProcResult = $this->executeForWeko();
+            // トランザクション内前処理呼び出し
+            $this->preExecute();
+            
+            // call the method(executeApp) of each inheritance class
+            $strProcResult = $this->executeApp();
+            
+            // トランザクション内後処理呼び出し
+            $this->postExecute();
             
             // finish proc
             $this->exitAction();
             
+            // トランザクション外後処理
+            $this->afterTrans();
+            
             // return result string
-            return $strProcResult;
+            if($this->exitFlag) {
+                if(is_array($this->errMsg) && count($this->errMsg) > 0){
+                    echo json_encode($this->errMsg);
+                }
+                exit();
+            }
+            else {
+                return $strProcResult;
+            }
         }
         catch(RepositoryException $Exception)
         {
@@ -7741,6 +7104,61 @@ class RepositoryAction extends Action
 
             return "error";
         }
+        catch (AppException $e)
+        {
+            if($nIsInit)
+            {
+                if($this->failTrans() === false)
+                {
+                    $this->errorLog("Failed rollback trance.", __FILE__, __CLASS__, __LINE__);
+                }
+            }
+            
+            // エラーログをダンプ
+            $this->exeptionLog($e, __FILE__, __CLASS__, __LINE__);
+            
+            // エラーメッセージを設定
+            $errors = $e->getErrors();
+            for($ii=0; $ii<count($errors); $ii++)
+            {
+                foreach ($errors[$ii] as $key => $val)
+                {
+                    $this->addErrMsg($key, $val);
+                }
+            }
+            
+            // ビジネスロジック生成クラス終了処理
+            BusinessFactory::uninitialize();
+            
+            if($this->exitFlag) {
+                if(is_array($this->errMsg)){
+                    echo json_encode($this->errMsg);
+                }
+                exit();
+            }
+            else {
+                return "error";
+            }
+        }
+        catch (Exception $e)
+        {
+            if($isInit)
+            {
+                if($this->failTrans() === false)
+                {
+                    $this->errorLog("Failed rollback trance.", __FILE__, __CLASS__, __LINE__);
+                }
+            }
+            // エラーログをダンプ
+            $this->exeptionLog($e, __FILE__, __CLASS__, __LINE__);
+            
+            $this->addErrMsg("予期せぬエラーが発生しました");
+            
+            // ビジネスロジック生成クラス終了処理
+            BusinessFactory::uninitialize();
+            
+            return "error";
+        }
     }
 
     /**
@@ -7748,11 +7166,15 @@ class RepositoryAction extends Action
      *
      * @return strResult
      */
-    protected function executeForWeko()
+    protected function executeApp()
     {
         $exception = new RepositoryException( "ERR_MSG_UnpopulatedCode", 00002 ); //主メッセージとログIDを指定して例外を作成
         throw $exception;
     }
+    protected function beforeTrans(){}
+    protected function afterTrans(){}
+    protected function preExecute(){}
+    protected function postExecute(){}
 
     // Add DSpace data move T.Koyasu 2013/10/23 --end--
     
diff --git a/repository/components/RepositoryAddinBaseAbstract.class.php b/repository/components/RepositoryAddinBaseAbstract.class.php
index 0ecff0c..a2c0e0d 100644
--- a/repository/components/RepositoryAddinBaseAbstract.class.php
+++ b/repository/components/RepositoryAddinBaseAbstract.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryAddinBaseAbstract.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: RepositoryAddinBaseAbstract.class.php 20287 2012-11-20 04:59:31Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryAddinCaller.class.php b/repository/components/RepositoryAddinCaller.class.php
index 1969b82..0b228f4 100644
--- a/repository/components/RepositoryAddinCaller.class.php
+++ b/repository/components/RepositoryAddinCaller.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryAddinCaller.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: RepositoryAddinCaller.class.php 20287 2012-11-20 04:59:31Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryAggregateCalculation.class.php b/repository/components/RepositoryAggregateCalculation.class.php
index 19f39af..ca76845 100644
--- a/repository/components/RepositoryAggregateCalculation.class.php
+++ b/repository/components/RepositoryAggregateCalculation.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryAggregateCalculation.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositoryAggregateCalculation.class.php 43113 2014-10-21 04:02:44Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryCheckFileTypeUtility.class.php b/repository/components/RepositoryCheckFileTypeUtility.class.php
index 0533c22..74bce28 100644
--- a/repository/components/RepositoryCheckFileTypeUtility.class.php
+++ b/repository/components/RepositoryCheckFileTypeUtility.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryCheckFileTypeUtility.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: RepositoryCheckFileTypeUtility.class.php 30910 2014-01-20 07:33:12Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryConst.class.php b/repository/components/RepositoryConst.class.php
index ca9c34b..5d3de52 100644
--- a/repository/components/RepositoryConst.class.php
+++ b/repository/components/RepositoryConst.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryConst.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: RepositoryConst.class.php 49321 2015-03-03 12:15:32Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -515,6 +515,9 @@ class RepositoryConst
     const JUNII2_SELFDOI = "selfDOI";
     const JUNII2_SELFDOI_JALC = "selfDOI(JaLC)";
     const JUNII2_SELFDOI_CROSSREF = "selfDOI(CrossRef)";
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    const JUNII2_SELFDOI_DATACITE = "selfDOI(DataCite)";
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     const JUNII2_ISBN = "isbn";
     const JUNII2_NAID = "NAID";
     const JUNII2_ICHUSHI = "ichushi";
@@ -524,6 +527,9 @@ class RepositoryConst
     const JUNII2_GRANTOR = "grantor";
     const JUNII2_SELFDOI_RA_JALC = "JaLC";
     const JUNII2_SELFDOI_RA_CROSSREF = "CrossRef";
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    const JUNII2_SELFDOI_RA_DATACITE = "DataCite";
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     // Add for JuNii2 Redaction 2013/09/16 R.Matsuura --end--
     // Add new prefix 2014/01/09 T.Ichikawa --start--
     const JUNII2_SELFDOI_ATTRIBUTE_JALC_DOI = "ra";
@@ -898,9 +904,8 @@ class RepositoryConst
     const GOOGLESCHOLAR_ISSN = "citation_issn";
     const GOOGLESCHOLAR_PUBLISHER = "citation_publisher";
     const GOOGLESCHOLAR_DC_CONTRIBUTOR = "dc.Contributor";
-    const GOOGLESCHOLAR_AUTHORS = "citation_authors";
-    const GOOGLESCHOLAR_DATE = "citation_date";
     const GOOGLESCHOLAR_KEYWORD = "citation_keywords";
+    const GOOGLESCHOLAR_DISSERTATION_INSTITUTION = "citation_dissertation_institution";
         
     // -------------------------------------------
     // Operation ID
diff --git a/repository/components/RepositoryDbAccess.class.php b/repository/components/RepositoryDbAccess.class.php
index 3478ec0..0fa8448 100644
--- a/repository/components/RepositoryDbAccess.class.php
+++ b/repository/components/RepositoryDbAccess.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryDbAccess.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: RepositoryDbAccess.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryDownload.class.php b/repository/components/RepositoryDownload.class.php
index 33698ff..f95f53f 100644
--- a/repository/components/RepositoryDownload.class.php
+++ b/repository/components/RepositoryDownload.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryDownload.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: RepositoryDownload.class.php 31589 2014-02-12 02:00:46Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryExternalSearchWordManager.class.php b/repository/components/RepositoryExternalSearchWordManager.class.php
index 3b59d03..488ef69 100644
--- a/repository/components/RepositoryExternalSearchWordManager.class.php
+++ b/repository/components/RepositoryExternalSearchWordManager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryExternalSearchWordManager.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
+// $Id: RepositoryExternalSearchWordManager.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -51,6 +51,12 @@ class Repository_Components_RepositoryExternalSearchWordManager extends Reposito
         $external_search_words = $this->checkSearchWord($split_external_search_word);
         // deposit external search word
         for($ii = 0; $ii < count($external_search_words); $ii++) {
+            // bug fix external searchword empty 2015/04/10 K.Sugimoto --start--
+            if(strlen($external_search_words[$ii]) == 0)
+            {
+                continue;
+            }
+            // bug fix external searchword empty 2015/04/10 K.Sugimoto --end--
             $query = "SELECT * FROM ". DATABASE_PREFIX. "repository_item_external_searchword ".
                      "WHERE item_id = ? ".
                      "AND item_no = ? ".
@@ -124,7 +130,12 @@ class Repository_Components_RepositoryExternalSearchWordManager extends Reposito
             if(isset($devRef[$result[$ii]['search_word']])){
                 $divWord = preg_split($result[$ii]['delimiter'], $devRef[$result[$ii]['search_word']]);
                 for($jj = 0; $jj < count($divWord); $jj++){
-                    $external_search_words[] = $divWord[$jj];
+                    // bug fix external searchword empty 2015/04/09 K.Sugimoto --start--
+                    if(strlen($divWord[$jj]) > 0)
+                    {
+                        $external_search_words[] = $divWord[$jj];
+                    }
+                    // bug fix external searchword empty 2015/04/09 K.Sugimoto --end--
                 }
             }
         }
diff --git a/repository/components/RepositoryFileUpload.class.php b/repository/components/RepositoryFileUpload.class.php
index 885c000..65f41f6 100644
--- a/repository/components/RepositoryFileUpload.class.php
+++ b/repository/components/RepositoryFileUpload.class.php
@@ -1,15 +1,19 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryFileUpload.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositoryFileUpload.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
-// Copyright (c) 2007 - 2008, National Institute of Informatics, 
+// Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
 //
 // This program is licensed under a Creative Commons BSD Licence
 // http://creativecommons.org/licenses/BSD/
 //
 // --------------------------------------------------------------------
+require_once WEBAPP_DIR. '/modules/repository/components/util/MultipartStreamDecoder.class.php';
+require_once WEBAPP_DIR.'/modules/repository/components/FW/AppException.class.php';
+require_once WEBAPP_DIR.'/modules/repository/components/FW/IO/IOException.class.php';
+require_once WEBAPP_DIR.'/modules/repository/components/FW/IO/FileStream.class.php';
 
 /**
  * output format filter class
@@ -70,12 +74,12 @@ class RepositoryFileUpload
      *
      * @return array
      */
-    public function getUploadData()
+    public function getUploadData(&$statusCode)
     {
         $this->writeLog("-- Start getUploadData (".date("Y/m/d H:i:s").") --\n");
-        
-        $this->getFileByInput();
-        
+
+        $this->getFileByInput($statusCode);
+
         $fileData = array();
         if( isset($this->fileName) && isset($this->physicalFileName) && isset($this->fileSize) &&
             isset($this->mimetype) && isset($this->extension) && isset($this->insertTime) && isset($this->uploadDir))
@@ -90,6 +94,11 @@ class RepositoryFileUpload
         }
         else
         {
+            if(!isset($statusCode) || strlen($statusCode) == 0)
+            {
+                $statusCode = 400;
+            }
+
             if( strlen($this->uploadDir)>0 && strlen($this->physicalFileName)>0 &&
                 file_exists($this->uploadDir.DIRECTORY_SEPARATOR.$this->physicalFileName))
             {
@@ -101,7 +110,10 @@ class RepositoryFileUpload
         
         return $fileData;
     }
-    
+
+    /**
+     * 初期化処理
+     */
     private function init()
     {
         $this->fileName = null;
@@ -113,25 +125,66 @@ class RepositoryFileUpload
         
         $this->writeLog("  Init data.\n");
     }
-    
-    private function getFileByInput()
+
+    /**
+     * ファイル情報の取得
+     * @param エラーメッセージ $errorMsg
+     */
+    private function getFileByInput(&$statusCode)
     {
         $this->writeLog("-- Start getFileByInput (".date("Y/m/d H:i:s").") --\n");
-        
+
         $this->init();
-        
+        // Update SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+        // ファイル情報を決める
+        $this->decideInsertTime();
+        $this->decideMimeType();
+        $this->decideFileName();
+        $this->decideExtension();
+        $this->decidePhysicalName();
+
+        // ファイルのアップロード
+        $this->decodeFile($statusCode);
+
+        // ログの出力
+        $this->outPutLogOfFileInfo();
+        $this->writeLog("-- End getFileByInput (".date("Y/m/d H:i:s").") --\n\n");
+        // Update SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+    }
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * InsertTimeを決める
+     */
+    private function decideInsertTime()
+    {
         // Set insertTime
         $now = new Date();
         $this->insertTime = $now->getDate(DATE_FORMAT_TIMESTAMP);
-        
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * MimeTypeを決める
+     */
+    private function decideMimeType()
+    {
         // Set mimetype
         if(isset($_SERVER['CONTENT_TYPE'])){
             $this->mimetype = $_SERVER['CONTENT_TYPE'];
         } else if(isset($_SERVER['HTTP_CONTENT_TYPE'])){
             $this->mimetype = $_SERVER['HTTP_CONTENT_TYPE'];
         }
-        
-        // Set fileName
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * ファイル名を決める
+     */
+    private function decideFileName()
+    {
         if(isset($_SERVER["CONTENT_DISPOSITION"])){
             $contentDisposition = urldecode($_SERVER["CONTENT_DISPOSITION"]);
             $contentDisposition = mb_convert_encoding($contentDisposition, "UTF-8", "ASCII,JIS,UTF-8,EUC-JP,SJIS");
@@ -160,13 +213,22 @@ class RepositoryFileUpload
                 }
             }
         }
-        
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * Extensionを決める
+     */
+    private function  decideExtension()
+    {
         // Set extension
         if(strlen($this->fileName) > 0)
         {
             if(preg_match("/^application\/zip/", $this->mimetype) ||
-                    preg_match("/^application\/x-zip/",$mimetype) ||
-                    preg_match("/^application\/x-compress/", $this->mimetype))
+                    preg_match("/^application\/x-zip/",$this->mimetype) ||
+                    preg_match("/^application\/x-compress/", $this->mimetype) ||
+                    preg_match("/^multipart\/form-data/", $this->mimetype))
             {
                 $this->extension = "zip";
                 $this->fileName .= ".".$this->extension;
@@ -180,24 +242,78 @@ class RepositoryFileUpload
                 }
             }
         }
-        
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * PhysicalNameを決める
+     */
+    private function decidePhysicalName()
+    {
         // Set physicalName
         $this->physicalFileName = $this->insertTime.".".$this->extension;
         if(strlen($this->fileName) == 0)
         {
             $this->fileName = $this->physicalFileName;
         }
-        
-        $putdata = fopen("php://input", "rb");
-        $fp = fopen($this->uploadDir.DIRECTORY_SEPARATOR.$this->physicalFileName, "w");
-        while($data = fread($putdata, 1024)){   // 1MBずつ追記する
-            fwrite($fp, $data);
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * ファイルアップロード処理
+     * @param string $statusCode ステータスコード
+     * @return boolean デコード処理の成功失敗
+     */
+    private function decodeFile(&$statusCode)
+    {
+        try {
+            $readFileStream = FileStream::open("php://input", "rb");
+            $this->writeLog("[decode]:");
+            $fileList = Repository_Components_Util_MultipartStreamDecoder::decodeMultiPartFile($readFileStream, $this->uploadDir.DIRECTORY_SEPARATOR.$this->physicalFileName);
+            $this->writeLog("Success\n");
+            $this->writeLog("[UPLODE FILE]"."\n");
+            foreach ($fileList as $fileName){
+                $this->writeLog($fileName."\n");
+            }
         }
-        fclose($fp);
-        fclose($putdata);
-        
+        catch(AppException $e){
+            $errorMsg = $e->getMessage();
+            $this->writeLog("ERROR\n".$errorMsg."\n");
+            $readFileStream->close();
+
+            // マルチパートでない場合のzipファイル出力処理
+            $readFileStream = FileStream::open("php://input", "rb");
+            $outputFileStream = FileStream::open($this->uploadDir.DIRECTORY_SEPARATOR.$this->physicalFileName, "w");
+            while ($data = $readFileStream->read(1024))
+            {
+                $outputFileStream->write($data);
+            }
+            $outputFileStream->close();
+            $readFileStream->close();
+        }
+        catch(IOException $e)
+        {
+            $errorMsg = $e->getMessage();
+            $this->writeLog("ERROR\n".$errorMsg."\n");
+            $statusCode = 500;
+
+            return false;
+        }
+
         $this->fileSize = filesize($this->uploadDir.DIRECTORY_SEPARATOR.$this->physicalFileName);
-        
+
+        return true;
+    }
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
+    // Add SuppleContentsEntry Y.Yamazawa --start-- 2015/04/08 --start--
+    /**
+     * ファイル情報ログの出力
+     */
+    private function outPutLogOfFileInfo()
+    {
         $this->writeLog(" [Session data]\n");
         if(isset($_SERVER['CONTENT_TYPE']))
         {
@@ -223,7 +339,8 @@ class RepositoryFileUpload
         $this->writeLog("  fileSize: ".$this->fileSize."\n");
         $this->writeLog("-- End getFileByInput (".date("Y/m/d H:i:s").") --\n\n");
     }
-    
+    // Add SuppleContentsEntry Y.Yamazawa --end-- 2015/04/08 --end--
+
     /**
      * Write log to file
      *
diff --git a/repository/components/RepositoryHandleManager.class.php b/repository/components/RepositoryHandleManager.class.php
index 3353140..8107055 100644
--- a/repository/components/RepositoryHandleManager.class.php
+++ b/repository/components/RepositoryHandleManager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryHandleManager.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositoryHandleManager.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -22,6 +22,9 @@ class RepositoryHandleManager extends RepositoryLogicBase
     const ID_LIBRARY_JALC_DOI = 50;
     const ID_JALC_DOI = 40;
     const ID_CROSS_REF_DOI = 30;
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    const ID_DATACITE_DOI = 25;
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     const ID_CNRI_HANDLE = 20;
     const ID_Y_HANDLE = 10;
     const PREFIX_DOI = "http://doi.org/";
@@ -34,6 +37,10 @@ class RepositoryHandleManager extends RepositoryLogicBase
     const DOI_STATUS_GRANTED = 1;
     const DOI_STATUS_DROPED = 2;
     
+    // Add DataCite 2015/02/26 K.Sugimoto --start--
+    public $err_msg = null;
+    // Add DataCite 2015/02/26 K.Sugimoto --end--
+    
     /**
      * Constructor
      *
@@ -132,6 +139,20 @@ class RepositoryHandleManager extends RepositoryLogicBase
         return $result;
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * Get DataCite prefix
+     * 
+     * @return string
+     */
+    public function getDataCitePrefix()
+    {
+        $result = $this->getPrefix(self::ID_DATACITE_DOI);
+        
+        return $result;
+    }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
     /**
      * Get Cnri prefix
      * 
@@ -161,12 +182,16 @@ class RepositoryHandleManager extends RepositoryLogicBase
      * 
      * @param string $jalcDoiPrefix
      * @param string $crossRefDoiPrefix
+     * @param string $dataCiteDoiPrefix
      * @param string $cnriPrefix
      */
-    public function registerPrefix($jalcDoiPrefix, $crossRefDoiPrefix, $cnriPrefix)
+    public function registerPrefix($jalcDoiPrefix, $crossRefDoiPrefix, $dataCiteDoiPrefix, $cnriPrefix)
     {
         $this->registerPrefixById(self::ID_JALC_DOI, $jalcDoiPrefix);
         $this->registerPrefixById(self::ID_CROSS_REF_DOI, $crossRefDoiPrefix);
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $this->registerPrefixById(self::ID_DATACITE_DOI, $dataCiteDoiPrefix);
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         $this->registerPrefixById(self::ID_CNRI_HANDLE, $cnriPrefix);
     }
     
@@ -218,6 +243,49 @@ class RepositoryHandleManager extends RepositoryLogicBase
     }
     
     /**
+     * Register Y handle suffix stub
+     * 
+     * @param string $title
+     * @param int $item_id
+     * @param int $item_no
+     */
+/*    public function registerYhandleSuffix($title, $item_id, $item_no)
+    {
+        $pre = $this->getPrefix(self::ID_Y_HANDLE);
+        if(empty($pre)) {
+            return false;
+        }
+        
+        $suf = str_pad($item_id, 8, "0", STR_PAD_LEFT);
+        
+        $query = "INSERT INTO ".DATABASE_PREFIX."repository_suffix".
+                 " (item_id, item_no, id, suffix, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete)".
+                 " VALUES".
+                 " (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)".
+                 " ON DUPLICATE KEY ". 
+                 " UPDATE suffix = ?, mod_user_id = ?, mod_date = ? ". 
+                 " ;";
+        $params = array();
+        $params[] = $item_id;
+        $params[] = $item_no;
+        $params[] = self::ID_Y_HANDLE;
+        $params[] = $suf;
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = "";
+        $params[] = $this->transStartDate;
+        $params[] = $this->transStartDate;
+        $params[] = "";
+        $params[] = 0;
+        $params[] = $suf;
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->transStartDate;
+                 
+        $this->dbAccess->executeQuery($query, $params);
+    }
+    */
+    
+    /**
      * Register prefix by id
      * 
      * @param int $prefix_id
@@ -225,15 +293,38 @@ class RepositoryHandleManager extends RepositoryLogicBase
      */
     private function registerPrefixById($prefix_id, $prefix)
     {
-        $query = "UPDATE ".DATABASE_PREFIX."repository_prefix".
-                 " SET prefix_id = ?".
-                 " WHERE id = ?".
-                 " ;";
-        $params = array();
-        $params[] = $prefix;
-        $params[] = $prefix_id;
-             
-        $this->dbAccess->executeQuery($query, $params);
+        if(isset($prefix))
+        {
+            if($prefix_id == self::ID_JALC_DOI || $prefix_id == self::ID_CROSS_REF_DOI || $prefix_id == self::ID_DATACITE_DOI)
+            {
+                $result = $this->checkDoiFormat($prefix);
+                
+                if($result === $prefix)
+                {
+                    $query = "UPDATE ".DATABASE_PREFIX."repository_prefix".
+                             " SET prefix_id = ?".
+                             " WHERE id = ?".
+                             " ;";
+                    $params = array();
+                    $params[] = $prefix;
+                    $params[] = $prefix_id;
+                         
+                    $this->dbAccess->executeQuery($query, $params);
+                }
+            }
+            else
+            {
+                $query = "UPDATE ".DATABASE_PREFIX."repository_prefix".
+                         " SET prefix_id = ?".
+                         " WHERE id = ?".
+                         " ;";
+                $params = array();
+                $params[] = $prefix;
+                $params[] = $prefix_id;
+                     
+                $this->dbAccess->executeQuery($query, $params);
+            }
+        }
     }
     
     /**
@@ -281,63 +372,53 @@ class RepositoryHandleManager extends RepositoryLogicBase
         $pre = "";
         $suf = "";
         
-        // 国会図書館JaLC DOIならば
-        if($prefix_id == self::ID_LIBRARY_JALC_DOI)
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $suf = $this->getHandleSuffix($item_id, $item_no, $prefix_id);
+        
+        switch($prefix_id)
         {
-            $pre = $this->getLibraryJalcDoiPrefix();
-            $suf = $this->getHandleSuffix($item_id, $item_no, $prefix_id);
-            if(strlen($pre) == 0) {
-                return "";
-            }
-            if(strlen($suf) == 0) {
-                return "";
-            }
+        	case self::ID_LIBRARY_JALC_DOI:
+            	$pre = $this->getLibraryJalcDoiPrefix();
+            	break;
+            	
+        	case self::ID_JALC_DOI:
+            	$pre = $this->getJalcDoiPrefix();
+            	break;
+            	
+        	case self::ID_CROSS_REF_DOI:
+            	$pre = $this->getCrossRefPrefix();
+            	break;
+            	
+        	case self::ID_DATACITE_DOI:
+            	$pre = $this->getDataCitePrefix();
+            	break;
+            	
+        	case self::ID_CNRI_HANDLE:
+            	$pre = $this->getCnriPrefix();
+            	break;
+            	
+        	case self::ID_Y_HANDLE:
+            	$pre = $this->getYHandlePrefix();
+            	break;
+            	
+        	default:
+            	break;
+            	
         }
-        // JaLC DOIまたはCross Refならば
-        if($prefix_id == self::ID_JALC_DOI || $prefix_id == self::ID_CROSS_REF_DOI)
-        {
-            $pre = $this->getJalcDoiPrefix();
-            $suf = $this->getHandleSuffix($item_id, $item_no, $prefix_id);
-            // プレフィックスまたはサフィックスのいずれかがなく、JaLCDOIである
-            if((strlen($pre) < 1 || strlen($suf) < 1) && $prefix_id == self::ID_JALC_DOI)
-            {
-                // Cross RefのDOIがあるか調べる
-                $prefix_id = self::ID_CROSS_REF_DOI;
-                $pre = $this->getPrefix($prefix_id);
-                $suf = $this->getHandleSuffix($item_id, $item_no, $prefix_id);
-            }
-            // JaLC DOI、Cross Refともになければ
-            if(strlen($pre) < 1 || strlen($suf) < 1)
-            {
-                $prefix_id = self::ID_CNRI_HANDLE;
-                $pre = $this->getPrefix($prefix_id);
-                if(strlen($pre) == 0) {
-                    return "";
-                }
-                $suf = $this->getSuffix($item_id, $item_no, $prefix_id);
-                if(strlen($suf) == 0) {
-                    return "";
-                }
-            }
-        }
-        else
-        {
-            $pre = $this->getPrefix($prefix_id);
-            if(strlen($pre) == 0) {
-                return "";
-            }
-            $suf = $this->getSuffix($item_id, $item_no, $prefix_id);
-            if(strlen($suf) == 0) {
-                return "";
-            }
+        
+        if(strlen($pre) == 0 || strlen($suf) == 0) {
+            return "";
         }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         
         $uri = "";
         if($prefix_id == self::ID_LIBRARY_JALC_DOI) {
             $uri = self::PREFIX_LIBRARY_DOI_HTTP
                  . $pre
                  . "/". $suf;
-        } elseif($prefix_id == self::ID_JALC_DOI || $prefix_id == self::ID_CROSS_REF_DOI) {
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        } elseif($prefix_id == self::ID_JALC_DOI || $prefix_id == self::ID_CROSS_REF_DOI || $prefix_id == self::ID_DATACITE_DOI) {
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
             $uri = self::PREFIX_DOI
                  . $pre
                  . "/". $suf;
@@ -372,6 +453,11 @@ class RepositoryHandleManager extends RepositoryLogicBase
         if(strlen($uri) == 0) {
             $uri = $this->createUri($item_id, $item_no, self::ID_CROSS_REF_DOI);
         }
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        if(strlen($uri) == 0) {
+            $uri = $this->createUri($item_id, $item_no, self::ID_DATACITE_DOI);
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         if(strlen($uri) == 0) {
             $uri = $this->createUri($item_id, $item_no, self::ID_CNRI_HANDLE);
         }
@@ -578,10 +664,27 @@ class RepositoryHandleManager extends RepositoryLogicBase
             if(strpos($uri, "/") === false)
             {
                 $suffix = $uri;
+                $suffix = $this->checkDoiFormat($suffix);
             }
         }
         
         if(strlen($suffix) > 0){
+	        // Add DataCite 2015/02/10 K.Sugimoto --start--
+	        $query = "SELECT param_value".
+	                 " FROM ".DATABASE_PREFIX."repository_parameter".
+	                 " WHERE param_name = ?".
+	                 " AND is_delete = ?;";
+	        $params = array();
+	        $params[] = "prefix_flag";
+	        $params[] = 0;
+	        $result = $this->dbAccess->executeQuery($query, $params);
+	        if(count($result) > 0 && $result[0]["param_value"] == 1)
+	        {
+	        	$yHandlePrefix = $this->getYHandlePrefix();
+	        	$suffix = $yHandlePrefix.".".$suffix;
+	        }
+	        // Add DataCite 2015/02/10 K.Sugimoto --end--
+	        
             $this->registSuffix($item_id, $item_no, self::ID_LIBRARY_JALC_DOI, $suffix);
             $this->registDoiStatus($item_id, $item_no, self::DOI_STATUS_GRANTED);
         }
@@ -596,6 +699,22 @@ class RepositoryHandleManager extends RepositoryLogicBase
      */
     public function registJalcdoiSuffix($item_id, $item_no, $suffix)
     {
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $query = "SELECT param_value".
+                 " FROM ".DATABASE_PREFIX."repository_parameter".
+                 " WHERE param_name = ?".
+                 " AND is_delete = ?;";
+        $params = array();
+        $params[] = "prefix_flag";
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if(count($result) > 0 && $result[0]["param_value"] == 1)
+        {
+        	$yHandlePrefix = $this->getYHandlePrefix();
+        	$suffix = $yHandlePrefix.".".$suffix;
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
+        
         $this->registSuffix($item_id, $item_no, self::ID_JALC_DOI, $suffix);
         $this->registDoiStatus($item_id, $item_no, self::DOI_STATUS_GRANTED);
     }
@@ -609,10 +728,55 @@ class RepositoryHandleManager extends RepositoryLogicBase
      */
     public function registCrossrefSuffix($item_id, $item_no, $suffix)
     {
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $query = "SELECT param_value".
+                 " FROM ".DATABASE_PREFIX."repository_parameter".
+                 " WHERE param_name = ?".
+                 " AND is_delete = ?;";
+        $params = array();
+        $params[] = "prefix_flag";
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if(count($result) > 0 && $result[0]["param_value"] == 1)
+        {
+        	$yHandlePrefix = $this->getYHandlePrefix();
+        	$suffix = $yHandlePrefix.".".$suffix;
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
+        
         $this->registSuffix($item_id, $item_no, self::ID_CROSS_REF_DOI, $suffix);
         $this->registDoiStatus($item_id, $item_no, self::DOI_STATUS_GRANTED);
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * Regist DataCite suffix
+     * 
+     * @param int $item_id
+     * @param int $item_no
+     * @param string $suffix
+     */
+    public function registDataciteSuffix($item_id, $item_no, $suffix)
+    {
+        $query = "SELECT param_value".
+                 " FROM ".DATABASE_PREFIX."repository_parameter".
+                 " WHERE param_name = ?".
+                 " AND is_delete = ?;";
+        $params = array();
+        $params[] = "prefix_flag";
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if(count($result) > 0 && $result[0]["param_value"] == 1)
+        {
+        	$yHandlePrefix = $this->getYHandlePrefix();
+        	$suffix = $yHandlePrefix.".".$suffix;
+        }
+        
+        $this->registSuffix($item_id, $item_no, self::ID_DATACITE_DOI, $suffix);
+        $this->registDoiStatus($item_id, $item_no, self::DOI_STATUS_GRANTED);
+    }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
     /**
      * Get Y Handle suffix
      * 
@@ -661,6 +825,20 @@ class RepositoryHandleManager extends RepositoryLogicBase
         return $this->getHandleSuffix($item_id, $item_no, self::ID_CROSS_REF_DOI);
     }
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * Get DataCite suffix
+     * 
+     * @param int $item_id
+     * @param int $item_no
+     * @return string
+     */
+    public function getDataciteSuffix($item_id, $item_no)
+    {
+        return $this->getHandleSuffix($item_id, $item_no, self::ID_DATACITE_DOI);
+    }
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
     /**
      * Get suffix
      * 
@@ -712,6 +890,11 @@ class RepositoryHandleManager extends RepositoryLogicBase
         
         // JaLC DOIを削除する
         $this->deleteSuffix($item_id, $item_no, self::ID_JALC_DOI);
+        
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        // DataCiteを削除する
+        $this->deleteSuffix($item_id, $item_no, self::ID_DATACITE_DOI);
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
     }
     
     /**
@@ -786,17 +969,31 @@ class RepositoryHandleManager extends RepositoryLogicBase
         {
             $prefix = $this->getLibraryJalcDoiPrefix();
             $suffix = $this->getLibraryJalcdoiSuffix($item_id, $item_no);
+            $suffix = $this->checkDoiFormat($suffix);
         }        
         else if($id == self::ID_JALC_DOI)
         {
             $prefix = $this->getJalcDoiPrefix();
+            $prefix = $this->checkDoiFormat($prefix);
             $suffix = $this->getJalcdoiSuffix($item_id, $item_no);
+            $suffix = $this->checkDoiFormat($suffix);
         }
         else if($id == self::ID_CROSS_REF_DOI)
         {
             $prefix = $this->getCrossRefPrefix();
+            $prefix = $this->checkDoiFormat($prefix);
             $suffix = $this->getCrossrefSuffix($item_id, $item_no);
+            $suffix = $this->checkDoiFormat($suffix);
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        else if($id == self::ID_DATACITE_DOI)
+        {
+            $prefix = $this->getDataCitePrefix();
+            $prefix = $this->checkDoiFormat($prefix);
+            $suffix = $this->getDataciteSuffix($item_id, $item_no);
+            $suffix = $this->checkDoiFormat($suffix);
         }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         
         if(strlen($prefix) > 0 && strlen($suffix) > 0)
         {
@@ -829,5 +1026,59 @@ class RepositoryHandleManager extends RepositoryLogicBase
     {
         return $this->getHandleSuffix($item_id, $item_no, self::ID_CNRI_HANDLE);
     }
+    
+    // Bug Fix WEKO-2014-083 K.Sugimoto 2014/09/05 --start--
+    /**
+     * YハンドルのURIを作成する
+     * 
+     * @param int $item_id
+     * @param int $item_no
+     * @return string
+     */
+    public function createYHandleUri($item_id, $item_no)
+    {
+        $uri = "";
+        $prefix = "";
+        $suffix = "";
+        
+        // Yハンドルのプレフィックスを取得する
+        $prefix = $this->getYHandlePrefix();
+        // Yハンドルのサフィックスを取得する
+        $suffix = $this->getYHandleSuffix($item_id, $item_no);
+        
+        // YハンドルのURIを作成する
+        if(strlen($prefix) > 0 && strlen($suffix) > 0)
+        {
+            $uri = self::PREFIX_Y_HANDLE . $prefix . "/" . $suffix;
+        }
+        
+        return $uri;
+    }
+    // Bug Fix WEKO-2014-083 K.Sugimoto 2014/09/05 --end--
+    
+    // Add DataCite 2015/02/26 K.Sugimoto --start--
+    /**
+     * プレフィックスのフォーマットが正しいかチェックする
+     * 
+     * @param string $doi
+     * @return string
+     */
+    private function checkDoiFormat($doi)
+    {
+        $match = array();
+        
+        // 半角英数字、_、-、.、;、(、)、/のみ使用可
+        if(preg_match("/^(\w|\-|\.|\;|\(|\)|\/)*$/", $doi, $match)==1)
+        {
+        	return $doi;
+        }
+        else
+        {
+        	$this->err_msg = "DoiFormatIncorrect";
+        	return "";
+        }
+    }
+    // Add DataCite 2015/02/26 K.Sugimoto --end--
+
 }
 ?>
\ No newline at end of file
diff --git a/repository/components/RepositoryHarvesting.class.php b/repository/components/RepositoryHarvesting.class.php
index 3acb99e..f4463f2 100644
--- a/repository/components/RepositoryHarvesting.class.php
+++ b/repository/components/RepositoryHarvesting.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryHarvesting.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: RepositoryHarvesting.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -899,7 +899,7 @@ class RepositoryHarvesting extends RepositoryAction
                          "del_user_id = '', ".
                          "mod_date = ?, ".
                          "del_date = '', ".
-                         "is_delete = '0' ".
+                         "is_delete = 0 ".
                          "WHERE repository_id = ?";
                 $params[] = $repoData[$ii]["repository_name"];
                 $params[] = $repoData[$ii]["base_url"];
@@ -907,8 +907,8 @@ class RepositoryHarvesting extends RepositoryAction
                 $params[] = $repoData[$ii]["until_date"];
                 $params[] = $repoData[$ii]["set_param"];
                 $params[] = $repoData[$ii]["metadata_prefix"];
-                $params[] = $repoData[$ii]["post_index_id"];
-                $params[] = $repoData[$ii]["automatic_sorting"];
+                $params[] = intval($repoData[$ii]["post_index_id"]);
+                $params[] = intval($repoData[$ii]["automatic_sorting"]);
                 $params[] = $repoData[$ii]["execution_date"];
                 $params[] = $user_id;
                 $params[] = $date;
@@ -929,8 +929,8 @@ class RepositoryHarvesting extends RepositoryAction
                 $params[] = $repoData[$ii]["until_date"];
                 $params[] = $repoData[$ii]["set_param"];
                 $params[] = $repoData[$ii]["metadata_prefix"];
-                $params[] = $repoData[$ii]["post_index_id"];
-                $params[] = $repoData[$ii]["automatic_sorting"];
+                $params[] = intval($repoData[$ii]["post_index_id"]);
+                $params[] = intval($repoData[$ii]["automatic_sorting"]);
                 $params[] = $repoData[$ii]["execution_date"];
                 $params[] = $user_id;
                 $params[] = $user_id;
diff --git a/repository/components/RepositoryImportXmlValidator.class.php b/repository/components/RepositoryImportXmlValidator.class.php
index 8683aa4..01b3805 100644
--- a/repository/components/RepositoryImportXmlValidator.class.php
+++ b/repository/components/RepositoryImportXmlValidator.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryImportXmlValidator.class.php 43911 2014-11-13 04:28:03Z tatsuya_koyasu $
+// $Id: RepositoryImportXmlValidator.class.php 47749 2015-02-04 04:03:14Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -62,6 +62,9 @@ class RepositoryImportXmlValidator
     const ERROR_NUM_EDIT_ITEM_URL = 18;
     const ERROR_NUM_EDIT_ITEM_NUM = 19;
     // Add for import error list 2014/11/04 T.Koyasu --end--
+    // Add for itemtype check 2014/01/08 T.Ichikawa --start--
+    const ERROR_NUM_CAN_NOT_USEITEM_TYPE = 20;
+    // Add for itemtype check 2014/01/08 T.Ichikawa --end--
     
     /**
      * execute check XML
@@ -110,8 +113,15 @@ class RepositoryImportXmlValidator
      * @param Object $item_type_nodes  item type node list
      */
     private function compareNodeNum($item_nodes, $item_type_nodes, &$error_list) {
-        // アイテムタブとアイテムタイプタグの長さが一致しない場合、エラー
-        if($item_nodes->length != $item_type_nodes->length) {
+        // Add for item type check 2014/12/22 T.Ichikawa --start--
+        if($item_nodes->length == 0 && $item_type_nodes->length > 0){
+            // アイテムタイプインポート時は何もしない
+        } else if($item_nodes->length == 0 && $item_type_nodes->length == 0){
+            // アイテムタグもアイテムタイプタグも無い時
+            $error_list[] = new DetailErrorInfo(0, "", self::ERROR_TAG_NUM, "", "", "", self::ERROR_NUM_TAG_NUM);
+        // Add for item type check 2014/12/22 T.Ichikawa --end--
+        } else if($item_nodes->length != $item_type_nodes->length) {
+            // アイテムタブとアイテムタイプタグの長さが一致しない場合、エラー
             // Add for import error list 2014/11/04 T.Koyasu --start--
             $error_list[] = new DetailErrorInfo(0, "", self::ERROR_TAG_NUM, "", "", "", self::ERROR_NUM_TAG_NUM);
             // Add for import error list 2014/11/04 T.Koyasu --end--
diff --git a/repository/components/RepositoryIndexAuthorityManager.class.php b/repository/components/RepositoryIndexAuthorityManager.class.php
index 17fb0f7..6099e1b 100644
--- a/repository/components/RepositoryIndexAuthorityManager.class.php
+++ b/repository/components/RepositoryIndexAuthorityManager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryIndexAuthorityManager.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositoryIndexAuthorityManager.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -18,6 +18,13 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUserAuthority
 
 class RepositoryIndexAuthorityManager extends RepositoryLogicBase
 {
+    private $defaultAccessRoleIds_ = "";
+    private $defaultAccessRoleRoom_ = _AUTH_CHIEF;
+    private $defaultAccessGroups_ = '';
+    private $defaultExclusiveAclRoleIds_ = '';
+    private $defaultExclusiveAclRoleRoom_ = RepositoryConst::TREE_DEFAULT_EXCLUSIVE_ACL_ROLE_ROOM;
+    private $defaultExclusiveAclGroups_ = '';
+    
     /**
      * 閲覧権限のあるインデックスIDのリストを取得する
      *
@@ -264,6 +271,63 @@ class RepositoryIndexAuthorityManager extends RepositoryLogicBase
     }
 
     /**
+     * 投稿権限があるインデックスである
+     * @param string $auth_id auth_id
+     * @param string $user_id user_id
+     * @param string $indexId インデックスID
+     * @param boolean $isError エラー発生
+     * @return boolean true:投稿権限がある false:投稿権限がない
+     */
+    public function isRegistItemToIndex($auth_id, $user_id, $indexId, &$isError)
+    {
+        $isError = false;
+        $access_role = $this->getIndexAccessRoleFromDb($indexId,$isError);
+        if($isError === true)
+        {
+            return false;
+        }
+
+        $access_group = $this->getIndexAccessGroupFromDb($indexId,$isError);
+        if($isError === true)
+        {
+            return false;
+        }
+
+        if($this->isIndexOwner($indexId,$user_id))
+        {
+            return true;
+        }
+        if(strlen(str_replace(",","",str_replace("|","",$access_role))) == 0 &&
+                strlen($access_group) == 0){
+            return false;
+        }
+
+        // access_roleをベース権限とルーム権限に分ける
+        $this->explodeBaseAndRoom($access_role,$base_auth,$room_auth);
+        // get user's role auth id
+        $role_auth_id = $this->getRoleAuthorityIdFromDb($user_id,$isError);
+        if($isError === true || strlen($role_auth_id) == 0)
+        {
+            return false;
+        }
+        // ベース権限、ルーム権限チェック
+        if(is_numeric(strpos($base_auth, $role_auth_id))){
+            if(intval($auth_id) >= intval($room_auth)) {
+                return true;
+            }
+        }
+
+        // get user's entry groups
+        $result = $this->getUsersGroupList($groups, $error);
+        for($ii=0; $ii<count($groups); $ii++){
+            if(is_numeric(strpos($access_group, $groups[$ii]["room_id"]))){
+                return true;
+            }
+        }
+        return false;
+    }
+
+    /**
      * get lower authority
      *
      * @param var $parentExclusiveBaseAuth base authority of parant index
@@ -414,23 +478,26 @@ class RepositoryIndexAuthorityManager extends RepositoryLogicBase
                  "del_date = ?, ".
                  "is_delete = ? ;";
         $params = array();
-        $params[] = $indexId;
-        $params[] = $childExclusiveBaseAuth;
-        $params[] = $childExclusiveRoomAuth;
-        $params[] = $childPublicState;
+        $params[] = (int)$indexId;
+        $params[] = (int)$childExclusiveBaseAuth;
+        $params[] = (int)$childExclusiveRoomAuth;
+        $params[] = (int)$childPublicState;
         $params[] = $childPublicDate;
-        $params[] = $childHarvestPublicState;
-        // 挿入処理用共通パラメータ追加
-        $this->addSystemPramsForInsert($params);
+        $params[] = (int)$childHarvestPublicState;
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->transStartDate;
+        $params[] = $this->transStartDate;
         $params[] = ''; // del_user_id
         $params[] = ''; // del_date
-        $params[] = $childExclusiveBaseAuth;
-        $params[] = $childExclusiveRoomAuth;
-        $params[] = $childPublicState;
+        $params[] = 0;
+        $params[] = (int)$childExclusiveBaseAuth;
+        $params[] = (int)$childExclusiveRoomAuth;
+        $params[] = (int)$childPublicState;
         $params[] = $childPublicDate;
-        $params[] = $childHarvestPublicState;
-        // 更新処理用共通パラメータ追加
-        $this->addSystemPramsForUpdate($params);
+        $params[] = (int)$childHarvestPublicState;
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->transStartDate;
         $params[] = ''; // del_user_id
         $params[] = ''; // del_date
         $params[] = 0;
@@ -498,12 +565,16 @@ class RepositoryIndexAuthorityManager extends RepositoryLogicBase
         $params = array();
         for ($ii = 0; $ii < count($childExclusiveGroup); $ii++) {
             $params[] = $indexId;
-            $params[] = $childExclusiveGroup[$ii];
-            // 挿入処理用共通パラメータ追加
-            $this->addSystemPramsForInsert($params);
+            $params[] = (int)$childExclusiveGroup[$ii];
+            $params[] = $this->Session->getParameter("_user_id");
+            $params[] = $this->Session->getParameter("_user_id");
+            $params[] = $this->transStartDate;
+            $params[] = $this->transStartDate;
+            $params[] = 0;
         }
         // 更新処理用共通パラメータ追加
-        $this->addSystemPramsForUpdate($params);
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = $this->transStartDate;
         $params[] = 0;
 
         if ( isset($logFh) ){
@@ -615,5 +686,463 @@ class RepositoryIndexAuthorityManager extends RepositoryLogicBase
         $indexManager = new RepositoryIndexManager($this->Session, $this->dbAccess, $this->transStartDate);
         $indexManager->createIndexBrowsingAuthority();
     }
+    
+    /**
+     * NetCommonsに登録されている全グループを取得し、
+     * 投稿権限のあるグループID、グループ名、投稿権限のないグループID、グループ名のリストを取得する。
+     * 
+     * get edit index access group list
+     *
+     * @param $access_group_id access OK group room ids
+     * @param $exclusive_acl_group acl NG group room ids
+     * @param $edit_index add result in this parameter
+     * @return true or false
+     */
+    function getAccessGroupData($access_group_id, $exclusive_acl_group_id, &$edit_index)
+    {
+        // get access group or not
+        $result = $this->getGroupList($all_group, $error);
+        if($result === false){
+            return false;;
+        }
+        // add get (not member)
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        $add_array = array("page_id"=>'0', "page_name"=>$smartyAssign->getLang("repository_item_gest"));
+        array_unshift($all_group, $add_array);
+        
+        // 投稿権限
+        $edit_index["access_group_id"] = '';
+        $edit_index["access_group_name"] = '';
+        $edit_index["not_access_group_id"] = '';
+        $edit_index["not_access_group_name"] = '';
+        
+        // 閲覧権限
+        $edit_index["acl_group_id"] = '';
+        $edit_index["acl_group_name"] = '';
+        $edit_index["exclusive_acl_group_id"] = '';
+        $edit_index["exclusive_acl_group_name"] = '';
+        
+        for($ii=0; $ii<count($all_group); $ii++)
+        {
+            if(is_numeric(strpos(",".$access_group_id.",", ",".$all_group[$ii]["page_id"].",")))
+            {
+                if($edit_index["access_group_id"] != "")
+                {
+                    $edit_index["access_group_id"] .= ",";
+                    $edit_index["access_group_name"] .= ",";
+                }
+                $edit_index["access_group_id"] .= $all_group[$ii]["page_id"];
+                $edit_index["access_group_name"] .= '"'.$all_group[$ii]["page_name"].'"';
+            }
+            else
+            {
+                if($edit_index["not_access_group_id"] != "")
+                {
+                    $edit_index["not_access_group_id"] .= ",";
+                    $edit_index["not_access_group_name"] .= ",";
+                }
+                $edit_index["not_access_group_id"] .= $all_group[$ii]["page_id"];
+                $edit_index["not_access_group_name"] .= '"'.$all_group[$ii]["page_name"].'"';
+            }
+            
+            if(is_numeric(strpos(",".$exclusive_acl_group_id.",", ",".$all_group[$ii]["page_id"].",")))
+            {
+                if(strlen($edit_index["exclusive_acl_group_id"]) > 0)
+                {
+                    $edit_index["exclusive_acl_group_id"] .= ",";
+                    $edit_index["exclusive_acl_group_name"] .= ",";
+                }
+                $edit_index["exclusive_acl_group_id"] .= $all_group[$ii]["page_id"];
+                $edit_index["exclusive_acl_group_name"] .= '"'.$all_group[$ii]["page_name"].'"';
+            }
+            else
+            {
+                if(strlen($edit_index["acl_group_id"]) > 0)
+                {
+                    $edit_index["acl_group_id"] .= ",";
+                    $edit_index["acl_group_name"] .= ",";
+                }
+                $edit_index["acl_group_id"] .= $all_group[$ii]["page_id"];
+                $edit_index["acl_group_name"] .= '"'.$all_group[$ii]["page_name"].'"';
+            }
+            
+        }
+        if($edit_index["access_group_name"] == '')
+        {
+            $edit_index["access_group_name"] = '""';
+        }
+        if($edit_index["not_access_group_name"] == '')
+        {
+            $edit_index["not_access_group_name"] = '""';
+        }
+        
+        if(strlen($edit_index["acl_group_name"]) == 0)
+        {
+            $edit_index["acl_group_name"] = '""';
+        }
+        if(strlen($edit_index["exclusive_acl_group_name"]) == 0)
+        {
+            $edit_index["exclusive_acl_group_name"] = '""';
+        }
+        
+        return true;
+    }
+    
+    /**
+     * NetCommonsに登録されている全権限を取得し、
+     * 投稿権限のある権限ID、権限名、投稿権限のない権限ID、権限名のリストを取得する。
+     * 
+     * get edit index access auth list
+     *
+     * @param $access_role_id access OK group room ids
+     * @param $edit_index add result in this parameter
+     * @return true or false
+     */
+    function getAccessAuthData($access_role, $exclusive_acl_role, &$edit_index){
+        // Add config management authority 2010/02/23 Y.Nakao --start--
+        // separate access role base authority and room authority
+        $access_auth = explode("|", $access_role);
+        $access_role_id = $this->defaultAccessRoleIds_;
+        $access_role_room = $this->defaultAccessRoleRoom_;
+        if(count($access_auth) == 2){
+            $access_role_id = $access_auth[0];
+            $access_role_room = $access_auth[1];
+        } else if(count($access_auth) == 1){
+            $access_role_id = $access_auth[0];
+        }
+        // Add config management authority 2010/02/23 Y.Nakao --end--
+        
+        $aclAuthorities = explode("|", $exclusive_acl_role);
+        $exclusiveAclRoleId = $this->defaultAccessRoleIds_;
+        $exclusiveAclRoleRoom = $this->defaultAccessRoleRoom_;
+        if(count($aclAuthorities) == 2)
+        {
+            // max user_authority_id
+            $exclusiveAclRoleId = $aclAuthorities[0];
+            $exclusiveAclRoleRoom = $aclAuthorities[1];
+        }
+        else if(count($aclAuthorities) == 1)
+        {
+            $exclusiveAclRoleId = $aclAuthorities[0];
+        }
+        
+        // get all access auth
+        $query = "SELECT * FROM ". DATABASE_PREFIX ."authorities;";
+        $all_auth = $this->dbAccess->executeQuery($query);
+        if($all_auth === false){
+            return false;
+        }
+        // add get (not member)
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        
+        // 投稿権限
+        $edit_index["access_role_id"] = '';
+        $edit_index["access_role_name"] = '';
+        $edit_index["not_access_role_id"] = '';
+        $edit_index["not_access_role_name"] = '';
+        
+        // 閲覧権限
+        $edit_index["acl_role_id"] = '';
+        $edit_index["acl_role_name"] = '';
+        $edit_index["exclusive_acl_role_id"] = '';
+        $edit_index["exclusive_acl_role_name"] = '';
+        // Add tree access control list 2012/03/02 T.Koyasu -start-
+        $edit_index["acl_user_auth_id"] = '';
+        $edit_index["exclusive_acl_user_auth_id"] = '';
+        // Add tree access control list 2012/03/02 T.Koyasu -end-
+        
+        for($ii=0; $ii<count($all_auth); $ii++){
+            if(is_numeric(strpos(",".$access_role_id.",", ",".$all_auth[$ii]["role_authority_id"].","))){
+                if($edit_index["access_role_id"] != ""){
+                    $edit_index["access_role_id"] .= ",";
+                    $edit_index["access_role_name"] .= ",";
+                }
+                $edit_index["access_role_id"] .= $all_auth[$ii]["role_authority_id"];
+                $edit_index["access_role_name"] .= '"'.$all_auth[$ii]["role_authority_name"].'"';
+            } else {
+                if($edit_index["not_access_role_id"] != ""){
+                    $edit_index["not_access_role_id"] .= ",";
+                    $edit_index["not_access_role_name"] .= ",";
+                }
+                $edit_index["not_access_role_id"] .= $all_auth[$ii]["role_authority_id"];
+                $edit_index["not_access_role_name"] .= '"'.$all_auth[$ii]["role_authority_name"].'"';
+            }
+            
+            // Add tree access control list 2012/03/02 T.Koyasu -start-
+            if($exclusiveAclRoleId >= intval($all_auth[$ii]["user_authority_id"]))
+            {
+                // Mod access_role_id -> exclusive_acl_role_id
+                if($edit_index["exclusive_acl_role_id"] != "")
+                {
+                    $edit_index["exclusive_acl_role_id"] .= ",";
+                    $edit_index["exclusive_acl_role_name"] .= ",";
+                    // add user_authority_id for gimic by Koyasu
+                    $edit_index["exclusive_acl_user_auth_id"] .= ",";
+                }
+                $edit_index["exclusive_acl_role_id"] .= $all_auth[$ii]["role_authority_id"];
+                $edit_index["exclusive_acl_role_name"] .= '"'.$all_auth[$ii]["role_authority_name"].'"';
+                // add user_authority_id for gimic by Koyasu
+                $edit_index["exclusive_acl_user_auth_id"] .= $all_auth[$ii]["user_authority_id"];
+            }
+            else
+            {
+                if($edit_index["acl_role_id"] != "")
+                {
+                    $edit_index["acl_role_id"] .= ",";
+                    $edit_index["acl_role_name"] .= ",";
+                    // add user_authority_id for gimic by Koyasu
+                    $edit_index["acl_user_auth_id"] .= ",";
+                }
+                $edit_index["acl_role_id"] .= $all_auth[$ii]["role_authority_id"];
+                $edit_index["acl_role_name"] .= '"'.$all_auth[$ii]["role_authority_name"].'"';
+                // add user_authority_id for gimic by Koyasu
+                $edit_index["acl_user_auth_id"] .= $all_auth[$ii]["user_authority_id"];
+            }
+            // Add tree access control list 2012/03/02 T.Koyasu -end-
+            
+        }
+        if($edit_index["access_role_name"] == ''){
+            $edit_index["access_role_name"] = '""';
+        }
+        if($edit_index["not_access_role_name"] == ''){
+            $edit_index["not_access_role_name"] = '""';
+        }
+        
+        if(strlen($edit_index["acl_role_name"]) == 0)
+        {
+            $edit_index["acl_role_name"] = '""';
+        }
+        if(strlen($edit_index["exclusive_acl_role_name"]) == 0)
+        {
+            $edit_index["exclusive_acl_role_name"] = '""';
+        }
+        
+        // Add config management authority 2010/02/23 Y.Nakao --start--
+        // set access role for room authority
+        if(intval($access_role_room) == _AUTH_GENERAL){
+            $edit_index["room_auth_moderate"] = "true";
+            $edit_index["room_auth_general"] = "true";
+        } else if(intval($access_role_room) == _AUTH_MODERATE){
+            $edit_index["room_auth_moderate"] = "true";
+            $edit_index["room_auth_general"] = "false";
+        } else {
+            $edit_index["room_auth_moderate"] = "false";
+            $edit_index["room_auth_general"] = "false";;
+        }
+        // Add config management authority 2010/02/23 Y.Nakao --end--
+        
+        // Add tree access control list 2012/02/22 T.Koyasu -start-
+        // modify true/false with value of exclusive_acl_role column
+        // Add tree access control list 2011/12/28 Y.Nakao --start--
+        if(intval($exclusiveAclRoleRoom) == _AUTH_OTHER)
+        {
+            $edit_index['acl_room_auth_moderate'] = "true";
+            $edit_index['acl_room_auth_general'] = "true";
+            $edit_index['acl_room_auth_guest'] = "true";
+            $edit_index['acl_room_auth_logout'] = "false";
+        }
+        else if(intval($exclusiveAclRoleRoom) == _AUTH_GUEST)
+        {
+            $edit_index['acl_room_auth_moderate'] = "true";
+            $edit_index['acl_room_auth_general'] = "true";
+            $edit_index['acl_room_auth_guest'] = "false";
+            $edit_index['acl_room_auth_logout'] = "false";
+        }
+        else if(intval($exclusiveAclRoleRoom) == _AUTH_GENERAL)
+        {
+            $edit_index['acl_room_auth_moderate'] = "true";
+            $edit_index['acl_room_auth_general'] = "false";
+            $edit_index['acl_room_auth_guest'] = "false";
+            $edit_index['acl_room_auth_logout'] = "false";
+        }
+        else if(intval($exclusiveAclRoleRoom) == _AUTH_MODERATE)
+        {
+            $edit_index['acl_room_auth_moderate'] = "false";
+            $edit_index['acl_room_auth_general'] = "false";
+            $edit_index['acl_room_auth_guest'] = "false";
+            $edit_index['acl_room_auth_logout'] = "false";
+        }
+        else
+        {
+            $edit_index['acl_room_auth_moderate'] = "true";
+            $edit_index['acl_room_auth_general'] = "true";
+            $edit_index['acl_room_auth_guest'] = "true";
+            $edit_index['acl_room_auth_logout'] = "true";
+        }
+        // Add tree access control list 2011/12/28 Y.Nakao --end--
+        // Add tree access control list 2012/02/22 T.Koyasu -end-
+        return true;
+    }
+    
+    // Add file price 2008/08/28 Y.Nakao --start--
+    /**
+     * NC上に存在するグループの一覧を取得
+     * @return $Result_List['groupe_list'][ii]['～']形式で値が帰る
+     */
+    function getGroupList(&$all_group, &$error_msg){
+        // get List from pages Table
+        $query = "SELECT * FROM ". DATABASE_PREFIX ."pages ".
+                 "WHERE space_type = ? AND ".
+                 "private_flag = ? AND ".
+                 "NOT thread_num = ? AND ".
+        // Fix select group list 2009/02/03 Y.Nakao --start--
+                 "room_id = page_id; ";
+        // Fix select group list 2009/02/03 Y.Nakao --end--
+        $params = null;
+        $params[] = _SPACE_TYPE_GROUP;
+        $params[] = 0;
+        $params[] = 0;
+        // SELECT実行
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if($result === false){
+            $error_msg = $this->Db->ErrorMsg();
+            return false;
+        }
+        // 結果を格納
+        $all_group = $result;
+        return true;
+    }
+
+    
+    /**
+     * アクセスグループの取得
+     * @param string $indexID インデックスID
+     * @param boolean $isError エラー発生か否か
+     * @return string access_group
+     */
+    private function getIndexAccessGroupFromDb($indexID,&$isError)
+    {
+        $isError = false;
+        $query = " SELECT access_group ".
+                " FROM ".DATABASE_PREFIX."repository_index ".
+                " WHERE index_id = ? ".
+                " AND is_delete = 0; ";
+        $params = array();
+        $params[] = $indexID;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if($result === false)
+        {
+            $isError = true;
+            return "";
+        }
+
+        $accessGroup = "";
+        if(strlen($result[0]['access_group']) > 0)
+        {
+            $accessGroup = $result[0]['access_group'];
+        }
+
+        return $accessGroup;
+    }
+
+    /**
+     * アクセスロールの取得
+     * @param string $indexID インデックスID
+     * @param boolean $isError エラー発生か否か
+     */
+    private function getIndexAccessRoleFromDb($indexID,&$isError)
+    {
+        $isError = false;
+        $query = "SELECT access_role FROM ".DATABASE_PREFIX."repository_index ".
+                "WHERE index_id = ? ".
+                "AND is_delete = 0;";
+        $params = array();
+        $params[] = $indexID;
+        $ret = $this->dbAccess->executeQuery($query, $params);
+        if($ret === false ){
+            $isError = true;
+        }
+
+        return $ret[0]['access_role'];
+    }
+
+    /**
+     * 対象インデックスのowner_user_idの個数確認
+     * @param unknown $indexId インデックスID
+     * @param unknown $user_id userID
+     * @return boolean 0個以上存在するか否か
+     */
+    private function isIndexOwner($indexId,$user_id)
+    {
+        $query = " SELECT count(*) ".
+                " FROM ".DATABASE_PREFIX."repository_index ".
+                " WHERE index_id = ? ".
+                " AND owner_user_id = ? ".
+                " AND is_delete = 0; ";
+        $params = array();
+        $params[] = $indexId;
+        $params[] = $user_id;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        if(count($result) != 0 && $result[0]['count(*)'] != 0) {
+            return true;
+        }else {
+            return false;
+        }
+    }
+
+    /**
+     * role_authority_idの取得
+     * @param string $user_id
+     * @param string $base_auth
+     * @param string $room_auth
+     * @param string $auth_id
+     * @return string
+     */
+    private function getRoleAuthorityIdFromDb($user_id,&$isError)
+    {
+        $isError = false;
+
+        $query = "SELECT role_authority_id FROM ". DATABASE_PREFIX ."users ".
+                "WHERE user_id = ?; ";
+        $params = array();
+        $params[] = $user_id;
+        $role_auth_id = $this->dbAccess->executeQuery($query, $params);
+        if($role_auth_id === false) {
+            $isError = true;
+            return "";
+        }
+        else if(count($role_auth_id)!=1)
+        {
+            return "";
+        }
+
+        return $role_auth_id[0]["role_authority_id"];
+    }
+
+    /**
+     * ユーザの登録グループ一覧を取得する
+     */
+    private function getUsersGroupList(&$user_group, &$error_msg){
+        $userAuthorityManager = new RepositoryUserAuthorityManager($this->Session, $this->dbAccess, $this->transStartDate);
+        return $userAuthorityManager->getUsersGroupList($user_group, $error_msg);
+    }
+
+    /**
+     * access_roleをBase権限とRoom権限に分ける
+     * @param string $access_role access_role
+     * @param string $base_auth Base権限
+     * @param string $room_auth Room権限
+     * @return boolean 分けられたか否か
+     */
+    private function explodeBaseAndRoom($access_role,&$base_auth,&$room_auth)
+    {
+        $base_auth = "";
+        $room_auth = 0;
+        $role = explode("|", $access_role);
+        if(count($role) == 0){
+            return false;
+        } else if(count($role) == 1){
+            $base_auth = $role[0];
+            $room_auth = _AUTH_CHIEF;
+        } else if(count($role) >= 2){
+            $base_auth = $role[0].",";
+            $room_auth = substr($role[1], 0, 1);
+        }
+        if(strlen($room_auth) == 0){
+            $room_auth = _AUTH_CHIEF;
+        }
+
+        return true;
+    }
 }
 ?>
diff --git a/repository/components/RepositoryIndexManager.class.php b/repository/components/RepositoryIndexManager.class.php
index 1d51e33..9ed06ce 100644
--- a/repository/components/RepositoryIndexManager.class.php
+++ b/repository/components/RepositoryIndexManager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryIndexManager.class.php 663 2014-12-18 02:25:06Z ivis $
+// $Id: RepositoryIndexManager.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -23,6 +23,13 @@ class RepositoryIndexManager extends RepositoryLogicBase
     private $repositorySearchTableProcessing = null;
     // Add new prefix 2014/01/15 T.Ichikawa --end--
     
+    private $defaultAccessRoleIds_ = '';
+    private $defaultAccessRoleRoom_ = '';
+    private $defaultAccessGroups_ = '';
+    private $defaultExclusiveAclRoleIds_ = '';
+    private $defaultExclusiveAclRoleRoom_ = '';
+    private $defaultExclusiveAclGroups_ = '';
+    
     /**
      * コンストラクタ
      *
@@ -344,6 +351,9 @@ class RepositoryIndexManager extends RepositoryLogicBase
         if (isset($index_data["online_issn"])) {
             $query .= "online_issn, ";
         }
+        
+        $query .= "select_index_list_name, select_index_list_name_english, thumbnail, thumbnail_name, thumbnail_mime_type, ";
+        
         // Add issn and biblio flag 2014/04/16 T.Ichikawa --end--
         // Fix harvest_public_state 2014/03/15 Y.Nakao --start--
         if (isset($index_data["harvest_public_state"])) {
@@ -391,6 +401,10 @@ class RepositoryIndexManager extends RepositoryLogicBase
         if (isset($index_data["online_issn"])) {
            $query .= "?, ";
         }
+        
+        $query .= "?, ?, ?, ?, ?, ";
+        
+        
         // Add issn and biblio flag 2014/04/16 T.Ichikawa --end--
         // Fix harvest_public_state 2014/03/15 Y.Nakao --start--
         if (isset($index_data["harvest_public_state"])) {
@@ -403,7 +417,7 @@ class RepositoryIndexManager extends RepositoryLogicBase
         $params[] = $newIndexId;
         $params[] = $index_data["index_name"];
         $params[] = $index_data["index_name_english"];
-        $params[] = $index_data["parent_index_id"];
+        $params[] = (int)$index_data["parent_index_id"];
         $params[] = $showOrder;
         if($index_data["public_state"] == "true" || $index_data["public_state"] == "1"){
             $index_data["public_state"] = 1;
@@ -438,31 +452,67 @@ class RepositoryIndexManager extends RepositoryLogicBase
             $params[] = $index_data["display_more"];
         }
         if (isset($index_data["rss_display"])) {
-            $params[] = $index_data["rss_display"];
+            $params[] = (int)$index_data["rss_display"];
         }
         if (isset($index_data["repository_id"])) {
-            $params[] = $index_data["repository_id"];
+            $params[] = (int)$index_data["repository_id"];
         }
         if (isset($index_data["set_spec"])) {
             $params[] = $index_data["set_spec"];
         }
         if (isset($index_data["create_cover_flag"])) {
-            $params[] = $index_data["create_cover_flag"];
+            $params[] = (int)$index_data["create_cover_flag"];
         }
         if (isset($index_data["owner_user_id"])) {
             $params[] = $index_data["owner_user_id"];
         }
         // Add issn and biblio flag 2014/04/16 T.Ichikawa --start--
         if (isset($index_data["biblio_flag"])) {
-           $params[] = $index_data["biblio_flag"];
+           $params[] = (int)$index_data["biblio_flag"];
         }
         if (isset($index_data["online_issn"])) {
            $params[] = $index_data["online_issn"];
         }
+        
+        if (isset($index_data["select_index_list_name"])) {
+            $params[] = $index_data["select_index_list_name"];
+        }
+        else {
+            $params[] = "";
+        }
+        
+        if (isset($index_data["select_index_list_name_english"])) {
+            $params[] = $index_data["select_index_list_name_english"];
+        }
+        else {
+            $params[] = "";
+        }
+        
+        if (isset($index_data["thumbnail"])) {
+            $params[] = $index_data["thumbnail"];
+        }
+        else {
+            $params[] = "";
+        }
+        
+        if (isset($index_data["thumbnail_name"])) {
+            $params[] = $index_data["thumbnail_name"];
+        }
+        else {
+            $params[] = "";
+        }
+        
+        if (isset($index_data["thumbnail_mime_type"])) {
+            $params[] = $index_data["thumbnail_mime_type"];
+        }
+        else {
+            $params[] = "";
+        }
+        
         // Add issn and biblio flag 2014/04/16 T.Ichikawa --end--
         // Fix harvest_public_state 2014/03/15 Y.Nakao --start--
         if (isset($index_data["harvest_public_state"])) {
-            $params[] = $index_data["harvest_public_state"];
+            $params[] = (int)$index_data["harvest_public_state"];
         }
         // Fix harvest_public_state 2014/03/15 Y.Nakao --end--
         // 挿入処理共通パラメータ追加
@@ -542,7 +592,7 @@ class RepositoryIndexManager extends RepositoryLogicBase
      *
      * @param array $index_data an update index data
      */
-    public function updateIndex(&$index_data)
+    public function updateIndex($index_data)
     {
         // インデックス名英語が配列内にあるかをチェック
         if(strlen($index_data["index_name_english"]) == 0){
@@ -647,10 +697,10 @@ class RepositoryIndexManager extends RepositoryLogicBase
         }
         $params[] = $index_data["index_name_english"];
         if(isset($index_data["parent_index_id"])){
-            $params[] = $index_data["parent_index_id"];
+            $params[] = (int)$index_data["parent_index_id"];
         }
         if(isset($index_data["show_order"])){
-            $params[] = $index_data["show_order"];
+            $params[] = (int)$index_data["show_order"];
         }
         if($index_data["public_state"] == "true" || $index_data["public_state"] == "1"){
             $index_data["public_state"] = 1;
@@ -694,10 +744,10 @@ class RepositoryIndexManager extends RepositoryLogicBase
             $params[] = $index_data["display_more"];
         }
         if(isset($index_data["display_type"])) {
-            $params[] = $index_data["display_type"];
+            $params[] = (int)$index_data["display_type"];
         }
         if(isset($index_data["select_index_list_display"])) {
-            $params[] = $index_data["select_index_list_display"];
+            $params[] = (int)$index_data["select_index_list_display"];
         }
         if(isset($index_data["select_index_list_name"])) {
             $params[] = $index_data["select_index_list_name"];
@@ -706,17 +756,17 @@ class RepositoryIndexManager extends RepositoryLogicBase
             $params[] = $index_data["select_index_list_name_english"];
         }
         if(isset($index_data["rss_display"])) {
-            $params[] = $index_data["rss_display"];
+            $params[] = (int)$index_data["rss_display"];
         }
         if(isset($index_data["owner_user_id"])){
            $params[] = $index_data["owner_user_id"];
         }
         if(isset($index_data["repository_id"])){
-            $params[] = $index_data["repository_id"];
+            $params[] = (int)$index_data["repository_id"];
         }
         // Add issn and biblio flag 2014/04/16 T.Ichikawa --start--
         if (isset($index_data["biblio_flag"])) {
-            $params[] = $index_data["biblio_flag"];
+            $params[] = (int)$index_data["biblio_flag"];
         }
         if (isset($index_data["online_issn"])) {
             $params[] = $index_data["online_issn"];
@@ -729,10 +779,10 @@ class RepositoryIndexManager extends RepositoryLogicBase
             $params[] = $index_data["set_spec"];
         }
         if(isset($index_data["create_cover_flag"])){
-            $params[] = $index_data["create_cover_flag"];
+            $params[] = (int)$index_data["create_cover_flag"];
         }
         if(isset($index_data["harvest_public_state"])){
-            $params[] = $index_data["harvest_public_state"];
+            $params[] = (int)$index_data["harvest_public_state"];
         }
         // 更新処理共通パラメータ追加
         $this->addSystemPramsForUpdate($params);
@@ -756,7 +806,7 @@ class RepositoryIndexManager extends RepositoryLogicBase
             $params[] = "";
             $params[] = $thumbnail["file_name"];
             $params[] = $thumbnail["mimetype"];
-            $params[] = $index_data["index_id"];
+            $params[] = (int)$index_data["index_id"];
             $result = $this->dbAccess->executeQuery($query,$params);
         } else if(is_array($thumbnail) && count($thumbnail) > 0 &&
             is_numeric(strpos($thumbnail["mimetype"],"image"))){
@@ -770,14 +820,14 @@ class RepositoryIndexManager extends RepositoryLogicBase
             $params[] = "";
             $params[] = $thumbnail["file_name"];
             $params[] = $thumbnail["mimetype"];
-            $params[] = $index_data["index_id"];
+            $params[] = (int)$index_data["index_id"];
             $result = $this->dbAccess->executeQuery($query,$params);
             $path = WEBAPP_DIR. "/uploads/repository/".$thumbnail["physical_file_name"];
             $ret = $this->dbAccess->updateBlobFile(
                 "repository_index",
                 "thumbnail",
                 $path,
-                "index_id = ". $index_data["index_id"],
+                "index_id = ". (int)$index_data["index_id"],
                 "LONGBLOB"
             );
         }
@@ -1184,7 +1234,7 @@ class RepositoryIndexManager extends RepositoryLogicBase
          $result = $this->dbAccess->executeQuery($query, $params);
      }
     
-    private function strictlySetSpec($index_id, &$specs) {
+    public function strictlySetSpec($index_id, &$specs) {
         if($index_id != 0) {
              $query = "SELECT parent_index_id FROM ". DATABASE_PREFIX. "repository_index ".
                       "WHERE index_id = ? ;";
@@ -1195,5 +1245,675 @@ class RepositoryIndexManager extends RepositoryLogicBase
              $this->strictlySetSpec($result[0]["parent_index_id"], $specs);
         }
     }
+    
+    /**
+     * $copyFrom を $copyToにコピーする
+     * 
+     * @param int $copyFrom
+     * @param int $copyTo
+     */
+    public function copyIndexTree($copyFrom, $copyTo) {
+        // 親インデックスを子インデックスにはコピーできない
+        $indexList = array();
+        $this->getDescendants($copyFrom, $indexList);
+        for($ii = 0; $ii<count($indexList); $ii++){
+            if($copyTo == $indexList[$ii]){
+                return false;
+            }
+        }
+        
+        $newId = $this->newIndexId();
+        
+        // コピー元インデックス情報取得
+        $query = "SELECT * FROM " . DATABASE_PREFIX . "repository_index " .
+                 "WHERE index_id = ? ;";
+        
+        $params = array();
+        $params[] = $copyFrom;
+        $data = $this->dbAccess->executeQuery($query, $params);
+        
+        // コピー先にインデックス情報をコピー
+        $query = "INSERT INTO " . DATABASE_PREFIX . "repository_index " . 
+                 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 
+                         ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ;" ;
+        
+        $data[0]["index_id"]         = $newId;
+        $data[0]["parent_index_id"]  = $copyTo;
+        $data[0]["contents"]         = 0;
+        $data[0]["private_contents"] = 0;
+        $data[0]["ins_user_id"]      = $this->Session->getParameter("_user_id");
+        $data[0]["mod_user_id"]      = $this->Session->getParameter("_user_id");
+        $data[0]["del_user_id"]      = 0;
+        $data[0]["ins_date"]         = $this->transStartDate;
+        $data[0]["mod_date"]         = $this->transStartDate;
+        $data[0]["del_date"]         = "";
+        
+        $result = $this->dbAccess->executeQuery($query, $data[0]);
+        
+        // インデックスの閲覧権限を更新する
+        $indexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->transStartDate);
+        
+        // 親インデックスの権限を取得
+        $indexAuthorityManager->getBrowsingAuth(
+            $copyFrom,
+            $parentBaseAuth,
+            $parentRoomAuth,
+            $parentGroups,
+            $parentPubState,
+            $parentPubDate,
+            $parentHarvestPubState
+        );
+        
+        // 子インデックスの権限を取得
+        $indexAuthorityManager->getBrowsingAuth(
+            $copyTo,
+            $childBaseAuth,
+            $childRoomAuth,
+            $childGroups,
+            $childPubState,
+            $childPubDate,
+            $childHarvestPubState
+        );
+        
+        // インデックスの権限を登録
+        $indexAuthorityManager->updateBrowsingAuth(
+            $newId,
+            $parentBaseAuth,
+            $parentRoomAuth,
+            $parentGroups,
+            $parentPubState,
+            $parentPubDate,
+            $parentHarvestPubState,
+            $childBaseAuth,
+            $childRoomAuth,
+            $childGroups,
+            $childPubState,
+            $childPubDate,
+            $childHarvestPubState
+        );
+        
+        // コピー元直下の子インデックスコピー
+        $query = "SELECT * FROM " . DATABASE_PREFIX . "repository_index " .
+                 "WHERE parent_index_id = ? ;";
+        $params = array();
+        $params[] = $copyFrom;
+        $children = $this->dbAccess->executeQuery($query, $params);
+        
+        for ($ii = 0; $ii < count($children); $ii++){
+            $this->copyIndexTree($children[$ii]["index_id"], $newId);
+        }
+        
+        return true;
+    }
+    
+    /**
+     * 再帰的にインデックスを更新する
+     * 
+     * @param array $parentRecord
+     * @param bool $pubdate
+     * @param bool $create_cover
+     * @param bool $aclRoleIds
+     * @param bool $aclRoomAuth
+     * @param bool $aclGroupIds
+     */
+    public function recursiveUpdate($parentRecord, $pubdate, $create_cover, $aclRoleIds, $aclRoomAuth, $aclGroupIds){
+        $indexList = array();
+        
+        $this->getDescendants($parentRecord["index_id"], $indexList);
+        
+        // 親インデックスの権限取得
+        $parentRoles = explode("|", $parentRecord["access_role"]);
+        
+        $parentBaseRole = "";
+        $parentRoomRole = "";
+        
+        if (count($parentRoles) == 2){
+            $parentBaseRole = $parentRoles[0];
+            $parentRoomRole = $parentRoles[1];
+        }
+        
+        $indexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->transStartDate);
+        
+        // 子インデックス更新
+        for ($ii = 0; $ii < count($indexList); $ii++){
+            // 更新する子レコードの情報を取得する
+            $query = "SELECT * FROM " . DATABASE_PREFIX . "repository_index " .
+                     "WHERE index_id = ? ;";
+            $params = array();
+            $params[] = $indexList[$ii];
+            $childRecord = $this->dbAccess->executeQuery($query, $params);
+            
+            // 取得結果の投稿権限(権限)を分離する
+            $childRoles = explode("|", $childRecord[0]["access_role"]);
+            
+            $childBaseRole = "";
+            $childRoomRole = "";
+            
+            if (count($childRoles) == 2){
+                $childBaseRole = $childRoles[0];
+                $childRoomRole = $childRoles[1];
+            }
+            
+            $updateSet = "";
+            $params = array();
+            
+            // 再帰フラグがtrueの要素を更新する
+            if ($pubdate) {
+                $updateSet .= "pub_date = ?, public_state = ?";
+                $params[] = $parentRecord["pub_date"];
+                $params[] = $parentRecord["public_state"];
+            }
+            
+            if ($create_cover) {
+                if (!empty($updateSet)) {
+                    $updateSet .= ", ";
+                }
+                $updateSet .= "create_cover_flag = ?";
+                $params[] = $parentRecord["create_cover_flag"];
+            }
+            
+            if ($aclRoleIds && $aclRoomAuth) {
+                if (!empty($updateSet)) {
+                    $updateSet .= ", ";
+                }
+                $updateSet .= "access_role = ?";
+                $params[] = $parentBaseRole . "|" . $parentRoomRole;
+            }
+            
+            if (!$aclRoleIds && $aclRoomAuth) {
+                if (!empty($updateSet)) {
+                    $updateSet .= ", ";
+                }
+                $updateSet .= "access_role = ?";
+                $params[] = $childBaseRole . "|" . $parentRoomRole;
+            }
+            
+            if ($aclRoleIds && !$aclRoomAuth) {
+                if (!empty($updateSet)) {
+                    $updateSet .= ", ";
+                }
+                $updateSet .= "access_role = ?";
+                $params[] = $parentBaseRole . "|" . $childRoomRole;
+            }
+            
+            if ($aclGroupIds) {
+                if (!empty($updateSet)) {
+                    $updateSet .= ", ";
+                }
+                $updateSet .= "access_group = ?";
+                $params[] = $parentRecord["access_group_id"];
+            }
+            
+            $query = "UPDATE " . DATABASE_PREFIX . "repository_index " .
+                     "SET " . $updateSet . " " .
+                     "WHERE index_id = ? ;";
+            $params[] = $indexList[$ii];
+            $result = $this->dbAccess->executeQuery($query, $params);
+            
+            // インデックスの閲覧権限を更新する
+            
+            // 親要素の権限情報を取得する
+            $indexAuthorityManager->getBrowsingAuth(
+                $childRecord[0]["parent_index_id"], 
+                $newParentBaseRole,
+                $newParentRoomRole,
+                $newParentGroup,
+                $newParentPubStatus,
+                $newParentPubDate,
+                $newParentHarvestStatus
+            );
+            
+            // 子要素の権限情報を取得する
+            $indexAuthorityManager->getBrowsingAuth(
+                $indexList[$ii],
+                $newChildBaseRole,
+                $newChildRoomRole,
+                $newChildGroup,
+                $newChildPubStatus,
+                $newChildPubDate,
+                $newChildHarvestStatus
+            );
+            
+            // 子要素の権限情報を上書きする
+            if ($pubdate) {
+                $newChildPubDate = $newParentPubDate;
+                $newChildPubStatus = $newParentPubStatus;
+            }
+            
+            $indexAuthorityManager->updateBrowsingAuth(
+                $indexList[$ii],
+                $newParentBaseRole,
+                $newParentRoomRole,
+                $newParentGroup,
+                $newParentPubStatus,
+                $newParentPubDate,
+                $newParentHarvestStatus,
+                $newChildBaseRole,
+                $newChildRoomRole,
+                $newChildGroup,
+                $newChildPubStatus,
+                $newChildPubDate,
+                $newChildHarvestStatus
+            );
+        }
+    }
+    
+    /**
+     * $index_id の子孫インデックス一覧を取得
+     * 
+     * @param int $index_id
+     * @param array $indexList
+     */
+    public function getDescendants($index_id, &$indexList){
+        $query = "SELECT index_id FROM " . DATABASE_PREFIX . "repository_index " .
+                 "WHERE parent_index_id = ? ".
+                 "AND is_delete = ?;";
+        $params = array();
+        $params[] = $index_id;
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        
+        for ($ii = 0; $ii < count($result); $ii++){
+            $child_id = $result[$ii]["index_id"];
+            
+            array_push($indexList, $child_id);
+            
+            $this->getDescendants($child_id, $indexList);
+        }
+        
+        return true;
+    }
+    
+    // Add auto create private_tree K.matsuo 2013/4/5 --start--
+    /**
+     * Create PrivateTree automatically
+     *
+     */
+    public function createPrivateTree(){
+        $repositoryUserAuthorityManager = new RepositoryUserAuthorityManager($this->Session, $this->dbAccess, $this->transStartDate);
+        
+        // 親インデックスIDの取得
+        $parentIndexId = null;
+        $error_msg = null;
+        $return = $repositoryUserAuthorityManager->getAdminParam('privatetree_parent_indexid', $parentIndexId, $error_msg);
+        if($return == false){
+            return false;
+        }
+        if(!$this->isCreatePrivatetree($parentIndexId)){
+            return;
+        }
+        $user_id = $this->Session->getParameter("_user_id");
+        // Modify Private Tree name K.Matsuo 2013/10/01 --start--
+        $return = $repositoryUserAuthorityManager->getAdminParam('private_tree_composition', $privateTreeCompositionXML, $error_msg);
+        
+        // Mod private index name is handle name 2014/03/25 T.Koyasu --start--
+        $index_name = $this->Session->getParameter("_handle");
+        if(strlen($index_name) === 0){
+            // for handle name is empty on shibboleth login
+            $index_name = $this->Session->getParameter("_login_id");
+        }
+        // Mod private index name is handle name 2014/03/25 T.Koyasu --end--
+        
+        // Modify Private Tree name K.Matsuo 2013/10/01 --end--
+        // Move require_once for avoid infinity loop K.Matsuo 2013/09/30
+
+        $this->setPrivateTreeDefaultAccessControlList();
+        // 新インデックスID取得
+        $index_num = $this->getNewIndexId();
+        $showOrder = $this->getShowOrder($parentIndexId) + 1;
+        $container =& DIContainerFactory::getContainer();
+        $filterChain =& $container->getComponent("FilterChain");
+        $smartyAssign =& $filterChain->getFilterByName("SmartyAssign");
+        $this->Session->setParameter("smartyAssign", $smartyAssign);
+        
+        $repositoryIndexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->transStartDate);
+
+        $groupData = array();
+        $repositoryIndexAuthorityManager->getAccessGroupData($this->getDefaultAccessRoleRoom(), $this->getDefaultExclusiveAclGroups(), $groupData);
+        $authData = array();
+        $repositoryIndexAuthorityManager->getAccessAuthData($this->getDefaultAccessRoleIds(), $this->getDefaultExclusiveRoleIds(), $authData);
+
+        $newIndexData = array();
+        $newIndexData['index_id'] = $index_num;
+        $newIndexData["index_name"] = $index_name;
+        $newIndexData["index_name_english"] = $index_name;
+        $newIndexData["parent_index_id"] = $parentIndexId;
+        $newIndexData["show_order"] = $showOrder;
+        // Add specialized support for open.repo "private tree public" Y.Nakao 2013/06/21 --start--
+        // 通常は非公開
+        // Fix harvest_public_state 2014/03/15 Y.Nakao --start--
+        $newIndexData["public_state"] = "false";
+        $newIndexData["harvest_public_state"] = 0;
+        if(_REPOSITORY_PRIVATETREE_PUBLIC)
+        {
+            // プライベートツリーを公開するフラグがONの場合のみ公開する
+            $newIndexData["public_state"] = "true";
+            $newIndexData["harvest_public_state"] = 1;
+        }
+        // Fix harvest_public_state 2014/03/15 Y.Nakao --end--
+        // Add specialized support for open.repo "private tree public" Y.Nakao 2013/06/21 --end--
+        $newIndexData["pub_year"] = substr($this->transStartDate, 0, 4);
+        $newIndexData["pub_month"] = substr($this->transStartDate, 5, 2);
+        $newIndexData["pub_day"] = substr($this->transStartDate, 7, 2);
+        $newIndexData["pub_date"] = substr($this->transStartDate, 0, 10). ' 00:00:00.000';
+        $newIndexData["access_group_id"] = $groupData["access_group_id"];
+        $newIndexData["access_role_id"] = $authData["access_role_id"];
+        $newIndexData["comment"] = "";
+        $newIndexData["display_more"] = "";
+        $newIndexData["rss_display"] = "";
+        $newIndexData["access_role_room"] = $this->getDefaultAccessRoleRoom();
+        // Mod Bug fix No.55 2014/03/24 T.Koyasu --start--
+        $newIndexData["access_role"] = $newIndexData["access_role_id"]. "|". $newIndexData["access_role_room"];
+        // Mod Bug fix No.55 2014/03/24 T.Koyasu --end--
+        $newIndexData["access_group"] = "";
+        $newIndexData["display_type"] = "";
+        $newIndexData["select_index_list_display"] = "";
+        $newIndexData["select_index_list_name"] = "";
+        $newIndexData["select_index_list_name_english"] = "";
+        $newIndexData["exclusive_acl_role_id"] = $this->getDefaultExclusiveRoleIds();
+        $newIndexData["exclusive_acl_room_auth"] = $this->getDefaultExclusiveAclRoleRoom();
+        $newIndexData["exclusive_acl_group_id"] = $this->getDefaultExclusiveAclGroups();
+        $newIndexData["repository_id"] = 0;
+        $newIndexData["set_spec"] = "";
+        $newIndexData["owner_user_id"] = $user_id;
+        $result = $this->insertIndex($newIndexData);
+        if($result === false){
+            print_r($this->Db->ErrorMsg());
+            $errMsg = $this->Db->ErrorMsg();
+            $this->failTrans(); // ROLLBACK
+            return false;
+        }
+        if($privateTreeCompositionXML != ""){
+            $this->createPrivateTreeChildIndex($privateTreeCompositionXML, $index_num, $user_id);
+        }
+    }
+    
+    // Add OpenDepo Private Tree Composition K.Matsuo 2013/10/01 --start--
+    
+    /**
+     * Get user_authority_id by user ID
+     *
+     */
+    private function isCreatePrivatetree($parentIndexId)
+    {
+        $repositoryUserAuthorityManager = new RepositoryUserAuthorityManager($this->Session, $this->dbAccess, $this->transStartDate);
+        
+        $login_id = $this->Session->getParameter("_login_id");
+        $user_id = $this->Session->getParameter("_user_id");
+        // ログインしていないとき
+        if($user_id == '0' || strlen($login_id) == 0){
+            return false;
+        }
+        // ログインしているとき
+        $return = $repositoryUserAuthorityManager->getAdminParam('is_make_privatetree', $makePrivatetree, $error_msg);
+        if($makePrivatetree != 1){
+            // プライベートツリーを作成しないとき
+            return false;
+        }
+        $auth_id = $repositoryUserAuthorityManager->getRoomAuthorityID();
+        // アイテム登録権限チェック(一般ユーザ以上)
+        if($auth_id >= REPOSITORY_ITEM_REGIST_AUTH){
+            $query = "SELECT count(*) FROM ". DATABASE_PREFIX. "repository_index ".
+                     "WHERE owner_user_id = ? AND parent_index_id = ? AND is_delete = 0;";
+            $params = array();
+            $params[] = $user_id;
+            $params[] = $parentIndexId;
+            $ret = $this->dbAccess->executeQuery($query, $params);
+            if(count($ret) == 0 || $ret[0]['count(*)'] == 0) {
+                return true;
+            } else {
+                return false;
+            }
+        } else {
+            return false;
+        }
+    }
+    
+    private function createPrivateTreeChildIndex($privateTreeCompositionXML, $parentIndexId, $insUserId)
+    {
+        /////////////// XML perser ///////////////
+        try{
+            $xml_parser = xml_parser_create();
+            $rtn = xml_parse_into_struct( $xml_parser, $privateTreeCompositionXML, $vals );
+            if($rtn == 0){
+                return false;
+                xml_parser_free($xml_parser);
+            }
+        } catch(Exception $ex){
+            print_r("Failed: Exception occurrd in XML parse.");
+            return false;
+        }
+
+        require_once WEBAPP_DIR. '/modules/repository/action/edit/tree/Tree.class.php';
+        // インデックス登録用クラスの初期化
+        // Initialization of the class for index registration
+        /////////////// XML analysis ///////////////
+        $index_info = array();
+        $groupData = array();
+        $this->getAccessGroupData($this->getDefaultAccessRoleRoom(), $this->getDefaultExclusiveAclGroups(), $groupData);
+        $authData = array();
+        $this->getAccessAuthData($this->getDefaultAccessRoleIds(), $this->getDefaultExclusiveRoleIds(), $authData);
+        $index_id = -1;
+        foreach($vals as $val){
+            switch($val['tag']){
+                case "RDF:RDF":
+                    break;
+                case "RDF:DESCRIPTION":
+                    if($val['type'] == "open"){
+                        $index_id = 0;
+                    }else if($val['type'] == "close"){
+                        $index_id = -1;
+                    }
+                    break;
+                case "DC:IDENTIFIER":
+                    if($index_id >= 0){
+                        if(!isset($index_info[$val['value'] + $parentIndexId])){
+                            $index_id = $val['value'] + $parentIndexId;
+                            $index_info[$index_id] = array();
+                            $index_info[$index_id]['index_id'] = $val['value'] + $parentIndexId;
+                            $index_info[$index_id]['parent_index_id'] = $parentIndexId;
+                            $index_info[$index_id]['index_name'] = "";
+                            $index_info[$index_id]['index_name_english'] = "";
+                            $index_info[$index_id]['comment'] = "";
+                            $index_info[$index_id]['pub_date'] = "";
+                            $index_info[$index_id]['more'] = "";
+                            $index_info[$index_id]['rss'] = "";
+                            $index_info[$index_id]['pid_chk'] = false;
+                            $index_info[$index_id]["pub_year"] = substr($this->transStartDate, 0, 4);
+                            $index_info[$index_id]["pub_month"] = substr($this->transStartDate, 5, 2);
+                            $index_info[$index_id]["pub_day"] = substr($this->transStartDate, 7, 2);
+                            $index_info[$index_id]["pub_date"] = substr($this->transStartDate, 0, 10). ' 00:00:00.000';
+                            $index_info[$index_id]["access_group_id"] = $groupData["access_group_id"];
+                            $index_info[$index_id]["access_role_id"] = $authData["access_role_id"];
+                            $index_info[$index_id]["comment"] = "";
+                            $index_info[$index_id]["display_more"] = "";
+                            $index_info[$index_id]["rss_display"] = "";
+                            $index_info[$index_id]["access_role_room"] = $this->getDefaultAccessRoleRoom();
+                            // Mod Bug fix No.55 2014/03/24 T.Koyasu --start--
+                            $index_info[$index_id]["access_role"] = $index_info[$index_id]["access_role_id"]. "|". $index_info[$index_id]["access_role_room"];
+                            // Mod Bug fix No.55 2014/03/24 T.Koyasu --end--
+                            $index_info[$index_id]["display_type"] = "";
+                            $index_info[$index_id]["select_index_list_display"] = "";
+                            $index_info[$index_id]["select_index_list_name"] = "";
+                            $index_info[$index_id]["select_index_list_name_english"] = "";
+                            $index_info[$index_id]["exclusive_acl_role_id"] = $this->getDefaultExclusiveRoleIds();
+                            $index_info[$index_id]["exclusive_acl_room_auth"] = $this->getDefaultExclusiveAclRoleRoom();
+                            $index_info[$index_id]["exclusive_acl_group_id"] = $this->getDefaultExclusiveAclGroups();
+                            $index_info[$index_id]["repository_id"] = 0;
+                            $index_info[$index_id]["set_spec"] = "";
+                            $index_info[$index_id]["owner_user_id"] = $insUserId;
+                            $index_info[$index_id]["public_state"] = "false";
+                            $index_info[$index_id]["harvest_public_state"] = 0;
+                            if(_REPOSITORY_PRIVATETREE_PUBLIC)
+                            {
+                                // プライベートツリーを公開するフラグがONの場合のみ公開する
+                                $index_info[$index_id]["public_state"] = "true";
+                                $index_info[$index_id]["harvest_public_state"] = 1;
+                            }
+                        } else {
+                            $this->outputError("ErrorXML", "XML description is NG");
+                            exit();
+                        }
+                    }
+                    break;
+                case "DC:TITLE":
+                    if($index_id >= 0){
+                        if($val['attributes']['XML:LANG'] == "ja"){
+                            $index_info[$index_id]['index_name'] = $val['value'];
+                        } else if($val['attributes']['XML:LANG'] == "en"){
+                            $index_info[$index_id]['index_name_english'] = $val['value'];
+                        } else {
+                            $index_info[$index_id]['index_name'] = $val['value'];
+                            $index_info[$index_id]['index_name_english'] = $val['value'];
+                        }
+                    }
+                    break;
+                case "DC:COMMENT":
+                    $index_info[$index_id]['comment'] = $val['value'];
+                    break;
+                case "DC:PUBDATE":
+                    $index_info[$index_id]['pub_date'] = $val['value'];
+                    break;
+                case "DC:MORE":
+                    if(is_numeric($val['value'])){
+                        $index_info[$index_id]['more'] = intval($val['value']);
+                    }
+                    break;
+                case "DC:RSS":
+                    $index_info[$index_id]['rss'] = $val['value'];
+                    break;
+                case "DC:RELATION":
+                    if($index_id >= 0){
+                        $index_info[$index_id]['parent_index_id'] = $val['value'] + $parentIndexId;
+                    }
+                    break;
+                default:
+                    break;
+            }
+        }
+        /////////////// insert index ///////////////
+        $show_order_list = array();
+        foreach ($index_info as $key => $val){
+            if(isset($show_order_list[$val['parent_index_id']])){
+                $show_order_list[$val['parent_index_id']] = $this->getShowOrder($val['parent_index_id']) + 1;
+            }
+            $val["show_order"] = $show_order_list[$val['parent_index_id']];
+            $show_order_list[$val['parent_index_id']] += 1;
+        }
+        $result = $this->insertMultiIndex($index_info);
+        if($result === false){
+            $errMsg = $this->Db->ErrorMsg();
+            $this->failTrans(); // ROLLBACK
+            return false;
+        }
+    }
+    // Add OpenDepo Private Tree Composition K.Matsuo 2013/10/01 --end--
+    
+    public function setPrivateTreeDefaultAccessControlList()
+    {
+        // Mod Bug fix No.55 2014/03/24 T.Koyasu --start--
+        $this->defaultAccessRoleIds_ = "";
+        // Mod Bug fix No.55 2014/03/24 T.Koyasu --end--
+        $this->defaultAccessRoleRoom_ = _AUTH_CHIEF;
+        $this->defaultAccessGroups_ = '';
+        $this->defaultExclusiveAclRoleIds_ = '';
+        $this->defaultExclusiveAclRoleRoom_ = RepositoryConst::TREE_DEFAULT_EXCLUSIVE_ACL_ROLE_ROOM;
+        $this->defaultExclusiveAclGroups_ = '';
+    }
+    
+    /**
+     * 新規index_idを取得する
+     * get new index id
+     *
+     * @return new index id
+     */
+    function getNewIndexId(){
+        // get new index id
+        $query = "SELECT MAX(index_id) FROM ". DATABASE_PREFIX ."repository_index; ";
+        $ret_idx = $this->dbAccess->executeQuery($query);
+        if($ret_idx === false){
+            return "";
+        }
+        $new_id = $ret_idx[0]["MAX(index_id)"];
+        $new_id++;
+        
+        return $new_id;
+    }
+    
+    /**
+     * $pid直下にあるindexの最大show_orderを取得する
+     * get $pid bottom index max show order
+     *
+     * @param $pid
+     */ 
+    function getShowOrder($pid){
+        // get new parent index bottom's max show_order
+        $query = "SELECT COUNT(show_order) FROM ". DATABASE_PREFIX ."repository_index ".
+                 "WHERE `is_delete` = 0 AND ".
+                 "parent_index_id = ". $pid ."; ";
+        $ret_show = $this->dbAccess->executeQuery($query);
+        if($ret_show === false || $ret_show[0]["COUNT(show_order)"]<=0){
+            $show_order = 0;
+        } else {
+            $show_order = $ret_show[0]["COUNT(show_order)"];
+        }
+        return $show_order;
+    }
+    
+    public function getDefaultAccessRoleIds()
+    {
+        return $this->defaultAccessRoleIds_;
+    }
+    public function getDefaultAccessRoleRoom()
+    {
+        return $this->defaultAccessRoleRoom_;
+    }
+    public function getDefaultAccessGroups()
+    {
+        return $this->defaultAccessGroups_;
+    }
+    public function getDefaultExclusiveRoleIds()
+    {
+        return $this->defaultExclusiveAclRoleIds_;
+    }
+    public function getDefaultExclusiveAclRoleRoom()
+    {
+        return $this->defaultExclusiveAclRoleRoom_;
+    }
+    public function getDefaultExclusiveAclGroups()
+    {
+        return $this->defaultExclusiveAclGroups_;
+    }
+    
+    /**
+     * indexの新規登録(プライベートツリーで使用)
+     * insert index
+     *
+     * @param $index_data update index data
+     * @return true or false
+     */
+    function insertIndex($index_data){
+        // Fix index authority table. Y.Nakao --start--
+        return $this->addIndex(false, $index_data, $errMsg);
+    }
+    
+    /**
+     * indexの新規登録
+     * insert index
+     *
+     * @param $index_data update index data
+     * @return true or false
+     */
+    function insertMultiIndex($index_data_list){
+        // Fix Not call indexAuthorityManager 2014/03/15 Y.Nakao --start--
+        foreach($index_data_list as $index_data){
+            if(strlen($index_data["index_name_english"]) == 0){
+                return false;
+            }
+            $this->insertIndex($index_data);
+        }
+        // Fix Not call indexAuthorityManager 2014/03/15 Y.Nakao --end--
+    }
+    
 }
 ?>
diff --git a/repository/components/RepositoryItemAuthorityManager.class.php b/repository/components/RepositoryItemAuthorityManager.class.php
index ef753dc..5a56a0e 100644
--- a/repository/components/RepositoryItemAuthorityManager.class.php
+++ b/repository/components/RepositoryItemAuthorityManager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryItemAuthorityManager.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositoryItemAuthorityManager.class.php 41628 2014-09-17 02:01:48Z tatsuya_koyasu $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryLogicBase.class.php b/repository/components/RepositoryLogicBase.class.php
index 17d9a11..ddb4b83 100644
--- a/repository/components/RepositoryLogicBase.class.php
+++ b/repository/components/RepositoryLogicBase.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryLogicBase.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: RepositoryLogicBase.class.php 30197 2013-12-19 09:55:45Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryOutputFilter.class.php b/repository/components/RepositoryOutputFilter.class.php
index 265d5ea..25eacd9 100644
--- a/repository/components/RepositoryOutputFilter.class.php
+++ b/repository/components/RepositoryOutputFilter.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryOutputFilter.class.php 41901 2014-09-22 12:39:14Z tatsuya_koyasu $
+// $Id: RepositoryOutputFilter.class.php 46336 2015-01-15 01:04:14Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -854,7 +854,7 @@ class RepositoryOutputFilterJuNii2 extends RepositoryOutputFilter
         $pattern_zero = "/^\d{5}[AB]\d+$/";
         $pattern_one = "/^\d{5}.*第.*\d+号$/";
         
-        if(preg_match($pattern_zero, $strTarget) || preg_match($pattern_one, $strTarget))
+        if(preg_match($pattern_zero, $strTarget)===1 || preg_match($pattern_one, $strTarget)===1)
         {
             return $strTarget;
         }
diff --git a/repository/components/RepositoryOutputTSV.class.php b/repository/components/RepositoryOutputTSV.class.php
index 780e8bd..09f4825 100644
--- a/repository/components/RepositoryOutputTSV.class.php
+++ b/repository/components/RepositoryOutputTSV.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryOutputTSV.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositoryDownload.class.php 24001 2013-07-10 01:33:59Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,6 +14,7 @@
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/action/main/export/ExportCommon.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryItemAuthorityManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 class RepositoryOutputTSV extends RepositoryAction
 {
@@ -1686,6 +1687,17 @@ class RepositoryOutputTSV extends RepositoryAction
                     $libraryJalcdoiPrefix = $handleManager->getLibraryJalcDoiPrefix();
                     $Result_List[self::SELF_DOI][0]["SELFDOI"] = $libraryJalcdoiPrefix."/".$libraryJalcdoiSuffix;
                 }
+        		// Add DataCite 2015/02/10 K.Sugimoto --start--
+                else
+                {
+	                $dataciteSuffix = $handleManager->getDataciteSuffix($Item_ID, $Item_No);
+	                if(isset($dataciteSuffix) && strlen($dataciteSuffix) > 0)
+	                {
+	                    $Result_List[self::SELF_DOI_RA][0]["RA"] = RepositoryConst::JUNII2_SELFDOI_RA_DATACITE;
+	                    $Result_List[self::SELF_DOI][0]["SELFDOI"] = "";
+	                }
+                }
+        		// Add DataCite 2015/02/10 K.Sugimoto --end--
             }
         }
         if($jalcdoiSuffix === false)
diff --git a/repository/components/RepositoryPdfCover.class.php b/repository/components/RepositoryPdfCover.class.php
index ae9854f..09b5617 100644
--- a/repository/components/RepositoryPdfCover.class.php
+++ b/repository/components/RepositoryPdfCover.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryPdfCover.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: RepositoryPdfCover.class.php 49641 2015-03-09 07:02:34Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,6 +14,7 @@
 require_once WEBAPP_DIR. '/modules/repository/files/fpdf/mc_table.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryConst.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
  * Repository module create PDF cover class
@@ -154,6 +155,14 @@ class RepositoryPdfCover extends PDF_MC_Table
      */
     private $errorMsg = "";
     
+    /**
+     * tmp dir delete flg
+     * 
+     * @var int
+     * @access private
+     */
+    private $deleteTmpDirFlg = 0;
+    
     // -------------------------------------------------------
     // Const
     // -------------------------------------------------------
@@ -212,6 +221,11 @@ class RepositoryPdfCover extends PDF_MC_Table
     // Error message
     const ERR_CANNOT_CREATE = "Could not create PDF cover page.";
     
+    // Add delete pdf cover 2015/01/26 K.Matsushita -start-
+    const ERR_CANNOT_DELETE = "Could not delete PDF cover page.";
+    const RESET_CREATED_FLG = 0;
+    // Add delete pdf cover 2015/01/26 K.Matsushita -end-
+    
     // -------------------------------------------------------
     // Constructor
     // -------------------------------------------------------
@@ -229,7 +243,7 @@ class RepositoryPdfCover extends PDF_MC_Table
      * @access public
      */
     public function RepositoryPdfCover(
-        $Session, $Db, $TransStartDate, $userId="", $itemId=0, $itemNo=0, $attributeId=0, $fileNo=0)
+        $Session, $Db, $TransStartDate, $userId="", $itemId=0, $itemNo=0, $attributeId=0, $fileNo=0, $tmpFolderPath="")
     {
         // Set member
         $this->Session = $Session;
@@ -240,7 +254,16 @@ class RepositoryPdfCover extends PDF_MC_Table
         $this->itemNo = $itemNo;
         $this->attributeId = $attributeId;
         $this->fileNo = $fileNo;
-        $this->setDefaltTmpDirPath();
+        
+        if( strlen($tmpFolderPath) > 0 ){
+            $this->tmpDir = $tmpFolderPath;
+            $this->deleteTmpDirFlg = 0;
+        }
+        else 
+        {
+            $this->tmpDir = $this->getDefaltTmpDirPath();
+            $this->deleteTmpDirFlg = 1;
+        }
         
         if(strlen($this->userId) == 0)
         {
@@ -368,21 +391,8 @@ class RepositoryPdfCover extends PDF_MC_Table
             $success = false;
         }
         
-        // Make temporary directory
-        if($success && !$this->makeTmpDir())
-        {
-            $success = false;
-        }
-        
-        // Get target file path
-        if($success && strlen($this->getTargetPdfFilePath()) == 0)
-        {
-            $success = false;
-        }
-        
-        // Copy Target PDF to temporary directory
-        if($success && !copy($this->getTargetPdfFilePath(), $this->tmpDir.self::PDF_NAME_TARGET))
-        {
+        // Delete created cover page
+        if( $success && !$this->deleteCoverPage() ){
             $success = false;
         }
         
@@ -392,46 +402,12 @@ class RepositoryPdfCover extends PDF_MC_Table
             $success = false;
         }
         
-        // Check existing cover page
-        $coverCreatedFlag = 0;
-        if($success && $this->chkExistCover($coverCreatedFlag))
-        {
-            // Divide PDF pages
-            if(!$this->dividePdf(
-                    $this->tmpDir.self::PDF_NAME_TARGET,
-                    $this->tmpDir.self::PDF_NAME_ORG_TARGET,
-                    sprintf(($coverCreatedFlag+1)."-end")))
-            {
-                $success = false;
-            }
-        }
-        
         // Combine PDF pages
         if($success && !$this->combinePdf())
         {
             $success = false;
         }
         
-        // Combined PDF replace to file directory
-        if($success && !copy($this->tmpDir.self::PDF_NAME_COMBINED, $this->getTargetPdfFilePath()))
-        {
-            $success = false;
-        }
-        
-        // Update cover created flag
-        if($success && !$this->updateCoverCreatedFlag())
-        {
-            $success = false;
-        }
-        
-        // Create PDF thumbnail
-        if($success)
-        {
-            $this->makeThumbnail();
-        }
-        
-        $this->removeTmpDir();
-        
         if(!$success)
         {
             $this->errorMsg = self::ERR_CANNOT_CREATE;
@@ -444,21 +420,22 @@ class RepositoryPdfCover extends PDF_MC_Table
     // PRIVATE
     // -------------------------------------------------------
     /**
-     * Set defaut temporary directory path
+     * Get defaut temporary directory path
      *
-     * @return bool
+     * @return string
      */
-    private function setDefaltTmpDirPath()
+    private function getDefaltTmpDirPath()
     {
+        $tmpDirPath = "";
         $query = "SELECT DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS now_date;";
         $result = $this->Db->execute($query);
         if($result === false || count($result) != 1){
-            return false;
+            return $tmpDirPath;
         }
         $date = $result[0]['now_date'];
-        $this->tmpDir = WEBAPP_DIR.self::WEKO_UPLOAD_DIR."_".$date."/";
-        
-        return true;
+        $tmpDirPath = WEBAPP_DIR.self::WEKO_UPLOAD_DIR."_".$date."/";
+    
+        return $tmpDirPath;
     }
     
     /**
@@ -473,10 +450,14 @@ class RepositoryPdfCover extends PDF_MC_Table
         if(strlen($this->tmpDir) == 0)
         {
             // Set directory path
-            if($this->setDefaltTmpDirPath())
-            {
+            $tmpDirPath = $this->getDefaltTmpDirPath();
+            if( strlen($tmpDirPath) == 0 ){
                 return false;
             }
+            else 
+            {
+                $this->tmpDir = $tmpDirPath;
+            }
         }
         
         // Make directory
@@ -1045,8 +1026,20 @@ class RepositoryPdfCover extends PDF_MC_Table
         }
         
         // Add PDF file URL
-        $url = $itemData["item"][0]["uri"];
-        array_push($metadataList, array("name" => "URL", "value" => $url));
+        // Bug Fix WEKO-2014-083 K.Sugimoto 2014/09/05 --start--
+        $uri = "";
+        
+        $handleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
+        
+        // Mod PDF Cover page timing 2015/01/26 K.Matsushita --start--//
+        $uri = $handleManager->createUriForDetail($this->itemId, $this->itemNo);
+        // Mod PDF Cover page timing 2015/01/26 K.Matsushita --end--//
+        
+        if(strlen($uri) <= 0) {
+            $uri = $handleManager->getSubstanceUri($this->itemId, $this->itemNo);
+        }
+        // Bug Fix WEKO-2014-083 K.Sugimoto 2014/09/05 --end--
+        array_push($metadataList, array("name" => "URL", "value" => $uri));
         
         foreach($metadataList as $metadata)
         {
@@ -1082,7 +1075,7 @@ class RepositoryPdfCover extends PDF_MC_Table
      * @return bool false: Not exist / true: Existing
      * @access private
      */
-    private function chkExistCover(&$coverCreatedFlag)
+    public function chkExistCover(&$coverCreatedFlag)
     {
         $coverCreatedFlag = 0;
         $query = "SELECT ".RepositoryConst::DBCOL_REPOSITORY_FILE_COVER_CREATED_FLAG." ".
@@ -1198,20 +1191,22 @@ class RepositoryPdfCover extends PDF_MC_Table
         
         // PDF -> PNG
         $cmd = "\"".$this->cmdPathImageMagick."\" ".
-               "-quality 100 ".
-               "\"".$this->tmpDir.self::PDF_NAME_COMBINED."\"[0] ".
-               "\"".$this->tmpDir.self::PDF_NAME_COMBINED.".png\"";
+                "-quality 100 ".
+                "\"".$this->tmpDir.self::PDF_NAME_TARGET."\"[0] ".
+                "\"".$this->tmpDir.self::PDF_NAME_TARGET.".png\"";
+        
         exec(escapeshellcmd($cmd));
         
-        if(file_exists($this->tmpDir.self::PDF_NAME_COMBINED.".png"))
+        if(file_exists($this->tmpDir.self::PDF_NAME_TARGET.".png"))
         {
             // Success
             // Get image size
             $imgSize = array();
-            $imgSize = getimagesize($this->tmpDir.self::PDF_NAME_COMBINED.".png");
-            $width = $imgsize[0];
-            $height = $imgsize[1];
-            if(unlink($this->tmpDir.self::PDF_NAME_COMBINED.".png"))
+            $imgSize = getimagesize($this->tmpDir.self::PDF_NAME_TARGET.".png");
+            $width = $imgSize[0];
+            $height = $imgSize[1];
+            
+            if(unlink($this->tmpDir.self::PDF_NAME_TARGET.".png"))
             {
                 // Resize
                 if($height > $width)
@@ -1219,23 +1214,23 @@ class RepositoryPdfCover extends PDF_MC_Table
                     // Height is longer than width
                     $cmd = "\"".$this->cmdPathImageMagick."\" ".
                            "-quality 100 -density 200x200 -resize 200x ".
-                           "\"".$this->tmpDir.self::PDF_NAME_COMBINED."\"[0] ".
-                           "\"".$this->tmpDir.self::PDF_NAME_COMBINED.".png\"";
+                           "\"".$this->tmpDir.self::PDF_NAME_TARGET."\"[0] ".
+                           "\"".$this->tmpDir.self::PDF_NAME_TARGET.".png\"";
                 }
                 else
                 {
                     // Width is longer than height
                     $cmd = "\"".$this->cmdPathImageMagick."\" ".
                            "-quality 100 -density 200x200 -resize x280 ".
-                           "\"".$this->tmpDir.self::PDF_NAME_COMBINED."\"[0] ".
-                           "\"".$this->tmpDir.self::PDF_NAME_COMBINED.".png\"";
+                           "\"".$this->tmpDir.self::PDF_NAME_TARGET."\"[0] ".
+                           "\"".$this->tmpDir.self::PDF_NAME_TARGET.".png\"";
                 }
                 exec(escapeshellcmd($cmd));
                 
-                if(file_exists($this->tmpDir.self::PDF_NAME_COMBINED.".png"))
-                {
+                if(file_exists($this->tmpDir.self::PDF_NAME_TARGET.".png"))
+                {   
                     // Success
-                    $this->updateThumbnail($this->tmpDir.self::PDF_NAME_COMBINED.".png");
+                    $this->updateThumbnail($this->tmpDir.self::PDF_NAME_TARGET.".png");
                     $isSuccess = true;
                 }
             }
@@ -1322,24 +1317,26 @@ class RepositoryPdfCover extends PDF_MC_Table
         return $this->targetFilePath;
     }
     
+    
+    // Mod delete pdf cover 2015/01/26 K.Matsushita -start-
     /**
-     * Update cover_created_flag
-     *
+     * Reset cover_created_flag
+     * 
      * @return bool
      * @access private
      */
-    private function updateCoverCreatedFlag()
+    private function resetCoverCreatedFlag()
     {
         $query = "UPDATE ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_FILE." ".
-                 "SET ".RepositoryConst::DBCOL_REPOSITORY_FILE_COVER_CREATED_FLAG." = ?, ".
-                 RepositoryConst::DBCOL_COMMON_MOD_USER_ID." = ?, ".
-                 RepositoryConst::DBCOL_COMMON_MOD_DATE." = ? ".
-                 "WHERE ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID." = ? ".
-                 "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO." = ? ".
-                 "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID." = ? ".
-                 "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO." = ?; ";
+                "SET ".RepositoryConst::DBCOL_REPOSITORY_FILE_COVER_CREATED_FLAG." = ?, ".
+                RepositoryConst::DBCOL_COMMON_MOD_USER_ID." = ?, ".
+                RepositoryConst::DBCOL_COMMON_MOD_DATE." = ? ".
+                "WHERE ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID." = ? ".
+                "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO." = ? ".
+                "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID." = ? ".
+                "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO." = ?; ";
         $params = array();
-        $params[] = intval($this->page);
+        $params[] = self::RESET_CREATED_FLG;
         $params[] = $this->userId;
         $params[] = $this->TransStartDate;
         $params[] = $this->itemId;
@@ -1354,6 +1351,8 @@ class RepositoryPdfCover extends PDF_MC_Table
         
         return true;
     }
+    // Mod delete pdf cover 2015/01/26 K.Matsushita -end-
+    
     
     /**
      * Strip accent string
@@ -1638,7 +1637,7 @@ class RepositoryPdfCover extends PDF_MC_Table
                     else if($headerAlign == self::ALIGN_LEFT)
                     {
                         // left
-                        $this->SetX(self::MARGIN_LEFT - $w_unit);
+                        $this->SetX(self::MARGIN_LEFT );
                     }
                     
                     $this->Image($this->tmpDir.$imageName, $this->GetX(), $this->GetY(), $w_unit, $h_unit);
@@ -1737,6 +1736,87 @@ class RepositoryPdfCover extends PDF_MC_Table
         $this->SetY(self::MARGIN_TOP);
         $this->SetX(self::MARGIN_LEFT);
     }
+    
+    // Add delete pdf cover 2015/01/26 K.Matsushita -start-
+    /**
+     * delete cover page
+     * @return bool
+     */
+    public function deleteCoverPage(){
+        
+        $success = true;
+        
+        // Make temporary directory
+        if(!$this->makeTmpDir())
+        {
+            $success = false;
+        }
+        
+        // Get target file path
+        $targetFilePath = $this->getTargetPdfFilePath();
+        if($success && strlen($targetFilePath) == 0)
+        {
+            $success = false;
+        }
+        
+        // Copy Target PDF to temporary directory
+        if($success && !copy($targetFilePath, $this->tmpDir.self::PDF_NAME_TARGET))
+        {
+            $success = false;
+        }
+        
+        // Check existing cover page
+        $coverCreatedFlag = 0;
+        if( $this->chkExistCover($coverCreatedFlag) ){
+            
+            // Divide PDF pages
+            if(!$this->dividePdf( $this->tmpDir.self::PDF_NAME_TARGET,
+                                  $this->tmpDir.self::PDF_NAME_ORG_TARGET,
+                                  sprintf(($coverCreatedFlag+1)."-end")))
+            {
+                $success = false;
+            }
+            
+            // divided PDF replace to file directory
+            if($success && !copy($this->tmpDir.self::PDF_NAME_TARGET, $targetFilePath))
+            {
+                $success = false;
+            }
+            
+            // Reset cover created flag
+            if( $success && !$this->resetCoverCreatedFlag() ){
+                $success = false;
+            }
+            
+            // Create PDF thumbnail
+            if($success && !$this->makeThumbnail() )
+            {
+                $success = false;
+            }
+            
+            
+        }
+        
+        // if caller is Adddb
+        if( $this->deleteTmpDirFlg == 1 ){
+        
+            // delete temporary directory
+            $this->removeTmpDir();
+            if( file_exists($this->tmpDir) ){
+                $success = false;
+            }
+        }
+        
+        if(!$success)
+        {
+            $this->errorMsg = self::ERR_CANNOT_DELETE;
+        }
+        
+        return $success;
+    }
+    
+    // Add delete pdf cover 2015/01/26 K.Matsushita -end-
+    
 }
 
 ?>
diff --git a/repository/components/RepositoryProcessUtility.class.php b/repository/components/RepositoryProcessUtility.class.php
index bd96c6e..3a8b8c5 100644
--- a/repository/components/RepositoryProcessUtility.class.php
+++ b/repository/components/RepositoryProcessUtility.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryProcessUtility.class.php 657 2014-11-28 10:40:35Z ivis $
+// $Id: RepositoryProcessUtility.class.php 44462 2014-11-28 02:42:41Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositorySearch.class.php b/repository/components/RepositorySearch.class.php
index 7e25459..9c7caeb 100644
--- a/repository/components/RepositorySearch.class.php
+++ b/repository/components/RepositorySearch.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositorySearch.class.php 44575 2014-12-01 12:09:36Z tomohiro_ichikawa $
+// $Id: RepositorySearch.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,12 +13,13 @@
 require_once WEBAPP_DIR."/modules/repository/components/RepositorySearchRequestParameter.class.php";
 require_once WEBAPP_DIR."/modules/repository/components/QueryGenerator.class.php";
 require_once WEBAPP_DIR."/modules/repository/components/RepositoryPluginManager.class.php";
+require_once WEBAPP_DIR."/modules/repository/files/plugin/searchkeywordconverter/Twobytechartohalfsizechar.class.php";
 
 /**
  * for search class object
  * 
  */
-class RepositorySearchQueryParameter
+class RepositorySearchQueryParameter 
 {
     public $search_term = null;
     public $index_id = null;
@@ -225,8 +226,22 @@ class RepositorySearch extends RepositorySearchRequestParameter
         $this->RepositoryAction->getUsersGroupList($groupList, $errMsg);
         $this->RepositoryAction->deleteRoomIdOfMyRoomAndPublicSpace($groupList);
         
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $search_term_half = $this->search_term;
+        $converterHalf = new Repository_Files_Plugin_Searchkeywordconverter_Twobytechartohalfsizechar();
+        $exceptArray = array("itemTypeList", "language", "textversion", "scList", "idList", "typeList", "riList");
+        $toSearchCondition = new ToSearchCondition();
+        foreach($search_term_half as $key => $value)
+        {
+	        if(!in_array($key, $exceptArray))
+	        {
+	        	$search_term_half[$key] = $converterHalf->toSearchCondition($value, $toSearchCondition);
+	        }
+        }
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+        
         // 検索条件オブジェクト作成
-        $countSearchInfo = new RepositorySearchQueryParameter($this->search_term, 
+        $countSearchInfo = new RepositorySearchQueryParameter($search_term_half, 
                                                               $this->index_id, 
                                                               $this->Session->getParameter("_user_id"), 
                                                               $user_auth_id, 
@@ -274,7 +289,7 @@ class RepositorySearch extends RepositorySearchRequestParameter
         }
         
         // 検索条件オブジェクトの作成
-        $searchInfo = new RepositorySearchQueryParameter($this->search_term, 
+        $searchInfo = new RepositorySearchQueryParameter($search_term_half, 
                                                          $this->index_id, 
                                                          $this->Session->getParameter("_user_id"), 
                                                          $user_auth_id, 
@@ -366,41 +381,330 @@ class RepositorySearch extends RepositorySearchRequestParameter
         {
             foreach($this->search_term as $key => $value)
             {
+                // Improve Search Log 2015/03/19 K.Sugimoto --start--
                 switch($key)
                 {
+                    // 簡易検索
                     case "all":
                     case "meta":
+                    	$detailSearchItemId = 0;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // タイトル
                     case "title":
+                    	$detailSearchItemId = 1;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 著者名 OR 著者ID
                     case "creator":
+                    	$detailSearchItemId = 2;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // キーワード
                     case "kw":
+                    	$detailSearchItemId = 3;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 件名・分類
                     case "scDes":
+                    	$detailSearchItemId = 4;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 抄録・内容記述
                     case "des":
+                    	$detailSearchItemId = 5;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 公開者 OR 著者ID
                     case "pub":
+                    	$detailSearchItemId = 6;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 寄与者 OR 著者ID
                     case "con":
+                    	$detailSearchItemId = 7;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // コンテンツ作成日
+                    case "date":
+                    	$detailSearchItemId = 8;
+                    	$keywordArray = array();
+                        $keywordArray[0] = $value;
+                        
+                        break;
+                    // アイテムタイプ
+                    case "itemTypeList":
+                    	$detailSearchItemId = 9;
+                        // カンマ区切りで1単語ずつに分割
+                        $keywordArray = explode(",", $value);
+                        
+                        break;
+                    // 資源タイプ
+                    case "typeList":
+                    	$detailSearchItemId = 10;
+                        // カンマ区切りで1単語ずつに分割
+                        $keywordArray = explode(",", $value);
+                    	$keywordArray = $this->transformNiiTypeIdToNiiTypeName($keywordArray);
+                        
+                        break;
+                    // フォーマット
                     case "form":
+                    	$detailSearchItemId = 11;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // ID
                     case "idDes":
+                    	$detailSearchItemId = 12;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 雑誌名
                     case "jtitle":
+                    	$detailSearchItemId = 13;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 出版年
+                    case "pubYearFrom":
+                    case "pubYearUntil":
+                    	$detailSearchItemId = 14;
+                    	$keywordArray = array();
+                        $keywordArray[0] = $value;
+                        
+                        break;
+                    // 言語
+                    case "ln":
+                    	$detailSearchItemId = 15;
+                        // カンマ区切りで1単語ずつに分割
+                        $keywordArray = explode(",", $value);
+                        
+                        break;
+                    // 地域
                     case "sp":
+                    	$detailSearchItemId = 16;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 時代
                     case "era":
+                    	$detailSearchItemId = 17;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 権利
+                    case "riDes":
+                    	$detailSearchItemId = 18;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 権利
+                    case "riList":
+                    	$detailSearchItemId = 18;
+                        // カンマ区切りで1単語ずつに分割
+                        $keywordArray = explode(",", $value);
+                    	$keywordArray = $this->transformRightIdToRightName($keywordArray);
+                        
+                        break;
+                    // 著者版フラグ
+                    case "textver":
+                    	$detailSearchItemId = 19;
+                        // カンマ区切りで1単語ずつに分割
+                        $keywordArray = explode(",", $value);
+                        
+                        break;
+                    // 学位授与番号
                     case "grantid":
+                    	$detailSearchItemId = 20;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 学位授与年月日
+                    case "grantDateFrom":
+                    case "grantDateUntil":
+                    	$detailSearchItemId = 21;
+                    	$keywordArray = array();
+                        $keywordArray[0] = $value;
+                        
+                        break;
+                    // 学位名
                     case "degreename":
+                    	$detailSearchItemId = 22;
+                        // スペース区切りで1単語ずつに分割
+                        $keywordArray = explode(" ", $value);
+                        
+                        break;
+                    // 学位授与機関
                     case "grantor":
+                    	$detailSearchItemId = 23;
                         // スペース区切りで1単語ずつに分割
                         $keywordArray = explode(" ", $value);
                         
-                        // ログ出力
-                        for($ii = 0; $ii < count($keywordArray); $ii++)
-                        {
-                            $this->RepositoryAction->entryLog(4, "", "", "", "", $keywordArray[$ii]);
-                        }
+                        break;
+                    // インデックス
+                    case "idx":
+                    	$detailSearchItemId = 24;
+                        // カンマ区切りで1単語ずつに分割
+                        $keywordArray = explode(",", $value);
                         
                         break;
+                    // 公開日
+                    case "pubDateFrom":
+                    case "pubDateUntil":
+                    	$detailSearchItemId = 25;
+                    	$keywordArray = array();
+                        $keywordArray[0] = $value;
                         
+                        break;
+                    
                     default:
+                        $keywordArray = array();
                         break;
                 }
+                
+                // ログ出力
+                for($ii = 0; $ii < count($keywordArray); $ii++)
+                {
+                    if(strlen($this->TransStartDate) == 0)
+                    {
+                        $date = new Date();
+                        $this->TransStartDate = $date->getDate().".000";
+                    }
+                    // Mod entryLog T.Koyasu 2015/03/06 --start--
+                    require_once WEBAPP_DIR. '/modules/repository/components/FW/AppLogger.class.php';
+                    AppLogger::infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+                    BusinessFactory::initialize($this->Session, $this->Db, $this->TransStartDate);
+                    $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+                    
+                    $logManager->entryLogForKeywordSearch($keywordArray[$ii], $detailSearchItemId);
+                    // Mod entryLog T.Koyasu 2015/03/06 --end--
+                }
+                // Improve Search Log 2015/03/19 K.Sugimoto --end--
+            }
+        }
+    }
+    
+    // Improve Search Log 2015/03/19 K.Sugimoto --start--
+    /**
+     * 資源タイプ変換
+     *
+     * @param Array $niiTypeArray
+     */
+    private function transformNiiTypeIdToNiiTypeName($niiTypeArray)
+    {
+        for($ii = 0; $ii < count($niiTypeArray); $ii++)
+        {
+            switch($niiTypeArray[$ii])
+            {
+            	case 0:
+            		$niiTypeArray[$ii] = "Journal Article";
+            		break;
+            	case 1:
+            		$niiTypeArray[$ii] = "Thesis or Dissertation";
+            		break;
+            	case 2:
+            		$niiTypeArray[$ii] = "Departmental Bulletin Paper";
+            		break;
+            	case 3:
+            		$niiTypeArray[$ii] = "Conference Paper";
+            		break;
+            	case 4:
+            		$niiTypeArray[$ii] = "Presentation";
+            		break;
+            	case 5:
+            		$niiTypeArray[$ii] = "Book";
+            		break;
+            	case 6:
+            		$niiTypeArray[$ii] = "Technical Report";
+            		break;
+            	case 7:
+            		$niiTypeArray[$ii] = "Research Paper";
+            		break;
+            	case 8:
+            		$niiTypeArray[$ii] = "Article";
+            		break;
+            	case 9:
+            		$niiTypeArray[$ii] = "Preprint";
+            		break;
+            	case 10:
+            		$niiTypeArray[$ii] = "Learning Material";
+            		break;
+            	case 11:
+            		$niiTypeArray[$ii] = "Data or Dataset";
+            		break;
+            	case 12:
+            		$niiTypeArray[$ii] = "Software";
+            		break;
+            	case 13:
+            		$niiTypeArray[$ii] = "Others";
+            		break;
+            	default:
+            		break;
+            }
+        }
+        return $niiTypeArray;
+    }
+    
+    /**
+     * 権利変換
+     *
+     * @param Array $niiTypeArray
+     */
+    private function transformRightIdToRightName($rightArray)
+    {
+        $returnArray = array();
+        
+        for($ii = 0; $ii < count($rightArray); $ii++)
+        {
+            switch($rightArray[$ii])
+            {
+            	case 101:
+            		$returnArray[] = "CC BY";
+            		break;
+            	case 102:
+            		$returnArray[] = "CC BY-SA";
+            		break;
+            	case 103:
+            		$returnArray[] = "CC BY-ND";
+            		break;
+            	case 104:
+            		$returnArray[] = "CC BY-NC";
+            		break;
+            	case 105:
+            		$returnArray[] = "CC BY-NC-SA";
+            		break;
+            	case 106:
+            		$returnArray[] = "CC BY-NC-ND";
+            		break;
+            	default:
+            		break;
             }
         }
+        return $returnArray;
     }
+    // Improve Search Log 2015/03/19 K.Sugimoto --end--
 }
 ?>
diff --git a/repository/components/RepositorySearchRequestParameter.class.php b/repository/components/RepositorySearchRequestParameter.class.php
index e531447..2e55fe0 100644
--- a/repository/components/RepositorySearchRequestParameter.class.php
+++ b/repository/components/RepositorySearchRequestParameter.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositorySearchRequestParameter.class.php 40394 2014-08-25 09:36:51Z yuko_nakao $
+// $Id: RepositorySearchRequestParameter.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -87,6 +87,7 @@ class RepositorySearchRequestParameter
     const REQUEST_PAGE_ID = "page_id";
     const REQUEST_BLOCK_ID = "block_id";
     const REQUEST_WEKO_ID = "weko_id";
+    const REQUEST_ITEM_IDS = "item_ids";
     const REQUEST_DISPLAY_LANG = "lang";
     const REQUEST_SEARCH_TYPE = "st";
     const REQUEST_MODULE_ID = "module_id";
@@ -267,7 +268,14 @@ class RepositorySearchRequestParameter
         $this->search_type = null;
         $this->format = null;
         $this->index_id = null;
-        parse_str($_SERVER["HTTP_REFERER"],$refererRequest);
+        if(isset($_SERVER["HTTP_REFERER"]))
+        {
+        	parse_str($_SERVER["HTTP_REFERER"],$refererRequest);
+        }
+        else
+        {
+        	$refererRequest = array();
+        }
         $this->_request = $refererRequest;
         $this->setRequestParameter();
     }
@@ -326,6 +334,12 @@ class RepositorySearchRequestParameter
         {
             $this->search_term[self::REQUEST_WEKO_ID] = $this->_request[self::REQUEST_WEKO_ID];;
         }
+        // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/20 --start--
+        else if(isset($this->_request[self::REQUEST_ITEM_IDS]))
+        {
+            $this->search_term[self::REQUEST_ITEM_IDS] = $this->_request[self::REQUEST_ITEM_IDS];
+        }
+        // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/20 --end--
         else
         {
         foreach($this->_request as $requestParam => $requestValue){
@@ -377,11 +391,6 @@ class RepositorySearchRequestParameter
             $this->search_term[self::REQUEST_ID_LIST] = "";
             for($ii=1; $ii<12; $ii++)
             {
-                // idList==4 => selfDOI
-                if($ii==4)
-                {
-                    continue;
-                }
                 // set 1-11
                 if($ii>1)
                 {
@@ -458,7 +467,7 @@ class RepositorySearchRequestParameter
         
         foreach($this->search_term as $requestParam => $requestValue)
         {
-            array_push($req, $requestParam."=".$requestValue);
+            array_push($req, $requestParam."=".urlencode($requestValue));
         }
         return implode("&", $req);
     }
@@ -615,9 +624,11 @@ class RepositorySearchRequestParameter
                         $this->search_term[$requestParam] = 0;
                     }
                 }
-            } else if($requestParam == self::REQUEST_SUBJECT_LIST || $requestParam == self::REQUEST_ITEMTYPE_LIST
+            }
+            else if($requestParam == self::REQUEST_SUBJECT_LIST || $requestParam == self::REQUEST_ITEMTYPE_LIST
                        || $requestParam == self::REQUEST_TYPE_LIST || $requestParam == self::REQUEST_ID_LIST
-                       || $requestParam == self::REQUEST_IDX){
+                       || $requestParam == self::REQUEST_IDX
+                       || $requestParam == self::REQUEST_ITEM_IDS){// Add suppleContentsEntry Y.Yamazawa 2015/03/20
                 $tmpValue = RepositoryOutputFilter::string($requestValue);
                 $divideValue = explode(",", $tmpValue);
                 $tmpValue = "";
@@ -637,15 +648,15 @@ class RepositorySearchRequestParameter
                 $this->search_term[$requestParam] = $tmpValue;
             } else if($requestParam == self::REQUEST_TEXTVERSION || $requestParam == self::REQUEST_LANGUAGE
                    || $requestParam == self::REQUEST_RIGHT_LIST){
-                $tmpValue = urldecode($requestValue);
+                $tmpValue = $requestValue;
                 $tmpValue = trim(mb_convert_encoding($tmpValue, "UTF-8", "ASCII,JIS,UTF-8,EUC-JP,SJIS"));
                 $tmpValue = RepositoryOutputFilter::string($tmpValue);
                 $this->search_term[$requestParam] = preg_replace("/[\s,]+|　/", ",", $tmpValue);
             } else {
-                $tmpValue = urldecode($requestValue);
+                $tmpValue = $requestValue;
                 $tmpValue = trim(mb_convert_encoding($tmpValue, "UTF-8", "ASCII,JIS,UTF-8,EUC-JP,SJIS"));
                 $tmpValue = RepositoryOutputFilter::string($tmpValue);
-                $this->search_term[$requestParam] = preg_replace("/[\s,]+|　/", " ", $tmpValue);
+                $this->search_term[$requestParam] = preg_replace("/[\s]+|　|\+/", " ", $tmpValue);
             }
             
             // Bug fix WEKO-2014-012 T.Koyasu 2014/06/10 --start--
@@ -778,6 +789,18 @@ class RepositorySearchRequestParameter
                 $keyword = $this->search_term[self::REQUEST_ALL];
                 $this->all_search_type = "detail";
             } else {
+            	
+            	// Add Default Search Type 2014/12/03 K.Sugimoto --start--
+        		$result = $this->getDefaultSearchType();
+        		if(isset($result[0]['param_value'])){
+        			if($result[0]['param_value'] == 0){
+        				$this->all_search_type = "detail";
+        			} else if($result[0]['param_value'] == 1){
+        				$this->all_search_type = "simple";
+        			}
+        		}
+            	// Add Default Search Type 2014/12/03 K.Sugimoto --end--
+            	
                 $keyword = "";
             }
             $this->Session->setParameter("searchkeyword", $keyword);
@@ -814,6 +837,27 @@ class RepositorySearchRequestParameter
         }
     }
     
+    // Add Default Search Type 2014/12/09 K.Sugimoto --start--
+    /**
+     * get default_search_type
+     *
+     * @access public
+     */
+    public function getDefaultSearchType()
+    {
+        $query = "SELECT param_value ".
+                 "FROM ".DATABASE_PREFIX."repository_parameter ".
+                 "WHERE param_name = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = "default_search_type";
+        $params[] = 0;
+        $result = $this->dbAccess->executeQuery($query, $params);
+        
+        return $result;
+    }
+    // Add Default Search Type 2014/12/09 K.Sugimoto --end--
+    
     /**
      * init session detail_search_select_item
      *
diff --git a/repository/components/RepositorySearchTableProcessing.class.php b/repository/components/RepositorySearchTableProcessing.class.php
index b92bdcf..44f1bf6 100644
--- a/repository/components/RepositorySearchTableProcessing.class.php
+++ b/repository/components/RepositorySearchTableProcessing.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositorySearchTableProcessing.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: RepositorySearchTableProcessing.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -17,6 +17,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryProcessUtilit
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/QueryGenerator.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryPluginManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/files/plugin/searchkeywordconverter/Twobytechartohalfsizechar.class.php';
 
 /**
  * class of input data to search table
@@ -236,6 +237,14 @@ class RepositorySearchTableProcessing extends RepositoryAction
      */
     private $pluginFlag = false;
     
+    // Extend Search Keyword 2015/02/26 K.Sugimoto --start--
+    /**
+     * Instance of SearchKeywordConverter
+     * 
+     * @var classObject
+     */
+    private $searchKeywordConverter = null;
+    // Extend Search Keyword 2015/02/26 K.Sugimoto --end--
     
     /**
      * constructer
@@ -478,20 +487,40 @@ class RepositorySearchTableProcessing extends RepositoryAction
     private function addBaseData($itemBaseInfo, &$searchItemInfo, &$sortItemInfo)
     {
         // set title data
-        $this->setTextData($searchItemInfo, self::TITLE, $itemBaseInfo["title"]);
-        $this->setTextData($searchItemInfo, self::TITLE, $itemBaseInfo["title_english"]);
-        $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemBaseInfo["title"]);
-        $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemBaseInfo["title_english"]);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $toSearchKey = new ToSearchKey();
+        $titleConverted = $this->convertSearchTableKeyword($itemBaseInfo["title"], self::TITLE, $toSearchKey);
+        $titleEnglishConverted = $this->convertSearchTableKeyword($itemBaseInfo["title_english"], self::TITLE, $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+        $this->setTextData($searchItemInfo, self::TITLE, $titleConverted);
+        $this->setTextData($searchItemInfo, self::TITLE, $titleEnglishConverted);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $titleAllMetadataConverted = $this->convertSearchTableKeyword($itemBaseInfo["title"], self::ALLMETADATA, $toSearchKey);
+        $titleEnglishAllMetadataConverted = $this->convertSearchTableKeyword($itemBaseInfo["title_english"], self::ALLMETADATA, $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+        $this->setTextData($searchItemInfo, self::ALLMETADATA, $titleAllMetadataConverted);
+        $this->setTextData($searchItemInfo, self::ALLMETADATA, $titleEnglishAllMetadataConverted);
         $sortItemInfo["title"] = $itemBaseInfo["title"];
         $sortItemInfo["title_en"] = $itemBaseInfo["title_english"];
         // set shown date data
-        $this->setTextData($searchItemInfo, self::DATE, $itemBaseInfo["shown_date"]);
-        $this->setTextData($searchItemInfo, self::DATAODISSUED_YMD, $itemBaseInfo["shown_date"]);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $shownDateConverted = $this->convertSearchTableKeyword($itemBaseInfo["shown_date"], self::DATE, $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+        $this->setTextData($searchItemInfo, self::DATE, $shownDateConverted);
+        $this->setTextData($searchItemInfo, self::DATAODISSUED_YMD, $shownDateConverted);
         // set keyword data
-        $this->setTextData($searchItemInfo, self::KEYWORD, $itemBaseInfo["serch_key"]);
-        $this->setTextData($searchItemInfo, self::KEYWORD, $itemBaseInfo["serch_key_english"]);
-        $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemBaseInfo["serch_key"]);
-        $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemBaseInfo["serch_key_english"]);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $searchKeyConverted = $this->convertSearchTableKeyword($itemBaseInfo["serch_key"], self::KEYWORD, $toSearchKey);
+        $searchKeyEnglishConverted = $this->convertSearchTableKeyword($itemBaseInfo["serch_key_english"], self::KEYWORD, $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+        $this->setTextData($searchItemInfo, self::KEYWORD, $searchKeyConverted);
+        $this->setTextData($searchItemInfo, self::KEYWORD, $searchKeyEnglishConverted);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $searchKeyAllMetadataConverted = $this->convertSearchTableKeyword($itemBaseInfo["serch_key"], self::ALLMETADATA, $toSearchKey);
+        $searchKeyEnglishAllMetadataConverted = $this->convertSearchTableKeyword($itemBaseInfo["serch_key_english"], self::ALLMETADATA, $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+        $this->setTextData($searchItemInfo, self::ALLMETADATA, $searchKeyAllMetadataConverted);
+        $this->setTextData($searchItemInfo, self::ALLMETADATA, $searchKeyEnglishAllMetadataConverted);
         // set language data
         $this->setTextData($searchItemInfo, self::LANGUAGE, $itemBaseInfo["language"]);
         // set itemtype data
@@ -526,6 +555,7 @@ class RepositorySearchTableProcessing extends RepositoryAction
     {
         // set item metadata
         for($ii = 0; $ii < count($itemMetaData); $ii++){
+	        $toSearchKey = new ToSearchKey();
             switch($itemTypeMetaData["input_type"])
             {
                 case "name":
@@ -536,23 +566,48 @@ class RepositorySearchTableProcessing extends RepositoryAction
                     for($jj = 0; $jj < count($idList); $jj++){
                         $addText .= ",".$idList[$jj]["suffix"];
                     }
-                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) != 0){
-                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $addText);
+                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) > 0){
+                        $addTextJunii2Converted = $this->convertSearchTableKeyword($addText, $itemTypeMetaData["junii2_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $addTextJunii2Converted);
                     }
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $addText);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+                    if(isset($itemTypeMetaData["dublin_core_mapping"]) && strlen($itemTypeMetaData["dublin_core_mapping"]) > 0 && $itemTypeMetaData["dublin_core_mapping"] !== $itemTypeMetaData["junii2_mapping"]){
+                        $addTextDublinCoreConverted = $this->convertSearchTableKeyword($addText, $itemTypeMetaData["dublin_core_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["dublin_core_mapping"], $addTextDublinCoreConverted);
+                    }
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+                    $addTextAllMetadataConverted = $this->convertSearchTableKeyword($addText, self::ALLMETADATA, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $addTextAllMetadataConverted);
                     break;
                 case "thumbnail":
-                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) != 0){
-                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $itemMetaData[$ii]["file_name"]);
+                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) > 0){
+                        $fileNameJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["file_name"], $itemTypeMetaData["junii2_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $fileNameJunii2Converted);
+                    }
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+                    if(isset($itemTypeMetaData["dublin_core_mapping"]) && strlen($itemTypeMetaData["dublin_core_mapping"]) > 0 && $itemTypeMetaData["dublin_core_mapping"] !== $itemTypeMetaData["junii2_mapping"]){
+                        $fileNameDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["file_name"], $itemTypeMetaData["dublin_core_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["dublin_core_mapping"], $fileNameDublinCoreConverted);
                     }
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemMetaData[$ii]["file_name"]);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+                    $fileNameAllMetadataConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["file_name"], self::ALLMETADATA, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $fileNameAllMetadataConverted);
                     break;
                 case "file":
                 case "file_price":
-                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) != 0){
-                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $itemMetaData[$ii]["file_name"]);
+                    $addText = $itemMetaData[$ii]["file_name"].",".$itemMetaData[$ii]["display_name"];
+                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) > 0){
+                        $addTextJunii2Converted = $this->convertSearchTableKeyword($addText, $itemTypeMetaData["junii2_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $addTextJunii2Converted);
+                    }
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+                    if(isset($itemTypeMetaData["dublin_core_mapping"]) && strlen($itemTypeMetaData["dublin_core_mapping"]) > 0 && $itemTypeMetaData["dublin_core_mapping"] !== $itemTypeMetaData["junii2_mapping"]){
+                        $addTextDublinCoreConverted = $this->convertSearchTableKeyword($addText, $itemTypeMetaData["dublin_core_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["dublin_core_mapping"], $addTextDublinCoreConverted);
                     }
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemMetaData[$ii]["file_name"]);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+                    $addTextAllMetadataConverted = $this->convertSearchTableKeyword($addText, self::ALLMETADATA, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $addTextAllMetadataConverted);
                     $this->addFileData($itemMetaData[$ii], $searchItemInfo);
                     
                     // Add free style license to search_rights table T.Koyasu 2014/06/10 --start--
@@ -565,28 +620,53 @@ class RepositorySearchTableProcessing extends RepositoryAction
                     break;
                 case "biblio_info":
                     $addText = $itemMetaData[$ii]["biblio_name"].",".$itemMetaData[$ii]["biblio_name_english"].",".$itemMetaData[$ii]["date_of_issued"];
-                    $this->setTextData($searchItemInfo, self::JTITLE, $itemMetaData[$ii]["biblio_name"]);
-                    $this->setTextData($searchItemInfo, self::JTITLE, $itemMetaData[$ii]["biblio_name_english"]);
-                    $this->setTextData($searchItemInfo, self::DATAODISSUED, $itemMetaData[$ii]["date_of_issued"]);
+                    $biblioNameJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["biblio_name"], self::JTITLE, $toSearchKey);
+                    $biblioNameEnJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["biblio_name_english"], self::JTITLE, $toSearchKey);
+                    $dateOfIssuedJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["date_of_issued"], self::DATAODISSUED, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::JTITLE, $biblioNameJunii2Converted);
+                    $this->setTextData($searchItemInfo, self::JTITLE, $biblioNameEnJunii2Converted);
+                    $this->setTextData($searchItemInfo, self::DATAODISSUED, $dateOfIssuedJunii2Converted);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+                    $biblioNameDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["biblio_name"], self::IDENTIFER, $toSearchKey);
+                    $biblioNameEnDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["biblio_name_english"], self::IDENTIFER, $toSearchKey);
+                    $dateOfIssuedDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["date_of_issued"], self::IDENTIFER, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::IDENTIFER, $biblioNameDublinCoreConverted);
+                    $this->setTextData($searchItemInfo, self::IDENTIFER, $biblioNameEnDublinCoreConverted);
+                    $this->setTextData($searchItemInfo, self::IDENTIFER, $dateOfIssuedDublinCoreConverted);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
                     // Fix Don't fill biblio_date at sort table. Y.Nakao 2014/03/26 --start--
                     if(!isset($sortItemInfo["biblio_date"]))
                     {
                         $this->setTextData($sortItemInfo, "biblio_date", $itemMetaData[$ii]["date_of_issued"]);
                     }
                     // Fix Don't fill biblio_date at sort table. Y.Nakao 2014/03/26 --end--
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $addText);
+                    $addTextAllMetadataConverted = $this->convertSearchTableKeyword($addText, self::ALLMETADATA, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $addTextAllMetadataConverted);
                     break;
                 case "supple":
-                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) != 0){
-                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $itemMetaData[$ii]["supple_title"]);
-                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $itemMetaData[$ii]["supple_title_en"]);
+                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) > 0){
+                    	$suppleTitleJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["supple_title"], $itemTypeMetaData["junii2_mapping"], $toSearchKey);
+                    	$suppleTitleEnTextJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["supple_title_en"], $itemTypeMetaData["junii2_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $suppleTitleJunii2Converted);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $suppleTitleEnTextJunii2Converted);
                     }
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemMetaData[$ii]["supple_title"]);
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemMetaData[$ii]["supple_title_en"]);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+                    if(isset($itemTypeMetaData["dublin_core_mapping"]) && strlen($itemTypeMetaData["dublin_core_mapping"]) > 0 && $itemTypeMetaData["dublin_core_mapping"] !== $itemTypeMetaData["junii2_mapping"]){
+                    	$suppleTitleDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["supple_title"], $itemTypeMetaData["dublin_core_mapping"], $toSearchKey);
+                    	$suppleTitleEnTextDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["supple_title_en"], $itemTypeMetaData["dublin_core_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["dublin_core_mapping"], $suppleTitleDublinCoreConverted);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["dublin_core_mapping"], $suppleTitleEnTextDublinCoreConverted);
+                    }
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+                    $suppleTitleAllMetadataConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["supple_title"], self::ALLMETADATA, $toSearchKey);
+                    $suppleTitleEnTextAllMetadataConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["supple_title_en"], self::ALLMETADATA, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $suppleTitleAllMetadataConverted);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $suppleTitleEnTextAllMetadataConverted);
                     break;
                 default:
-                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) != 0){
-                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $itemMetaData[$ii]["attribute_value"]);
+                    if(isset($itemTypeMetaData["junii2_mapping"]) && strlen($itemTypeMetaData["junii2_mapping"]) > 0){
+                    	$attributeValueJunii2Converted = $this->convertSearchTableKeyword($itemMetaData[$ii]["attribute_value"], $itemTypeMetaData["junii2_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["junii2_mapping"], $attributeValueJunii2Converted);
                         // Fix Don't fill biblio_date at sort table. Y.Nakao 2014/03/26 --start--
                         if(!isset($sortItemInfo["biblio_date"]) && $itemTypeMetaData["junii2_mapping"] == self::DATAODISSUED)
                         {
@@ -594,7 +674,20 @@ class RepositorySearchTableProcessing extends RepositoryAction
                         }
                         // Fix Don't fill biblio_date at sort table. Y.Nakao 2014/03/26 --end--
                     }
-                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $itemMetaData[$ii]["attribute_value"]);
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+                    if(isset($itemTypeMetaData["dublin_core_mapping"]) && strlen($itemTypeMetaData["dublin_core_mapping"]) > 0 && $itemTypeMetaData["dublin_core_mapping"] !== $itemTypeMetaData["junii2_mapping"]){
+                    	$attributeValueDublinCoreConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["attribute_value"], $itemTypeMetaData["dublin_core_mapping"], $toSearchKey);
+                        $this->setTextData($searchItemInfo, $itemTypeMetaData["dublin_core_mapping"], $attributeValueDublinCoreConverted);
+                        // Fix Don't fill biblio_date at sort table. Y.Nakao 2014/03/26 --start--
+                        if(!isset($sortItemInfo["biblio_date"]) && $itemTypeMetaData["dublin_core_mapping"] == self::DATAODISSUED)
+                        {
+                            $this->setTextData($sortItemInfo, "biblio_date", $itemMetaData[$ii]["attribute_value"]);
+                        }
+                        // Fix Don't fill biblio_date at sort table. Y.Nakao 2014/03/26 --end--
+                    }
+				    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+                    $attributeValueAllMetadataConverted = $this->convertSearchTableKeyword($itemMetaData[$ii]["attribute_value"], self::ALLMETADATA, $toSearchKey);
+                    $this->setTextData($searchItemInfo, self::ALLMETADATA, $attributeValueAllMetadataConverted);
                     break;
             }
         }
@@ -813,7 +906,7 @@ class RepositorySearchTableProcessing extends RepositoryAction
                 foreach (glob($xml_path. DIRECTORY_SEPARATOR.'slide*.xml') as $sheet) {
                     $getTagResult = $this->getOfficeXMLText($xml_path, "slide".$noCnt.".xml");
                     if($getTagResult !== false){
-                        $strFullText = $getTagResult;
+                        $strFullText .= $getTagResult;
                         $noCnt++;
                     }
                 }
@@ -823,6 +916,11 @@ class RepositorySearchTableProcessing extends RepositoryAction
         // MySQLは4バイト文字に対応していないため4バイト文字を削除
         $strFullText = preg_replace("/[\xF0-\xF7][\x80-\xBF][\x80-\xBF][\x80-\xBF]/", "", $strFullText);
         
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $toSearchKey = new ToSearchKey();
+        $strFullText = $this->convertSearchTableKeyword($strFullText, self::FILEDATA, $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
+
         $this->setTextData($searchItemInfo, self::FILEDATA, $strFullText);
         //一時dir削除
         $this->removeDirectory($dir_path);
@@ -1103,18 +1201,25 @@ class RepositorySearchTableProcessing extends RepositoryAction
         $uri_jalcdoi = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_JALC_DOI);
         $uri_crossref = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_CROSS_REF_DOI);
         $uri_library_jalcdoi = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_LIBRARY_JALC_DOI);
-        if(strlen($uri_jalcdoi) > 0 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1)
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $uri_datacite = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_DATACITE_DOI);
+        if(strlen($uri_jalcdoi) > 0 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1 && strlen($uri_datacite) < 1)
         {
             $uri = $uri_jalcdoi;
         }
-        else if(strlen($uri_crossref) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_library_jalcdoi) < 1)
+        else if(strlen($uri_crossref) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_library_jalcdoi) < 1 && strlen($uri_datacite) < 1)
         {
             $uri = $uri_crossref;
         }
-        else if(strlen($uri_library_jalcdoi) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1)
+        else if(strlen($uri_library_jalcdoi) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1 && strlen($uri_datacite) < 1)
         {
             $uri = $uri_library_jalcdoi;
         }
+        else if(strlen($uri_datacite) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1)
+        {
+            $uri = $uri_datacite;
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         
         if(strlen($uri) > 0)
         {
@@ -1161,6 +1266,10 @@ class RepositorySearchTableProcessing extends RepositoryAction
      * @param string $search_word
      */
     public function addExternalSearchWord($item_id, $item_no, $search_word) {
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --start--
+        $toSearchKey = new ToSearchKey();
+        $search_word = $this->convertSearchTableKeyword($search_word, "externalsearchword", $toSearchKey);
+	    // Extend Search Keyword 2015/02/23 K.Sugimoto --end--
         $query = "INSERT INTO ". DATABASE_PREFIX. "repository_search_external_searchword ".
                  "(item_id, item_no, metadata) ".
                  "VALUES (?, ?, ?) ".
@@ -1174,6 +1283,27 @@ class RepositorySearchTableProcessing extends RepositoryAction
         $params[] = ",".$search_word;
         $this->dbAccess->executeQuery($query, $params);
     }
+    
+    // Extend Search Keyword 2015/02/26 K.Sugimoto --start--
+    /**
+     * convert search table keyword
+     * @param string $word
+     * @param string $mapping
+     * @param object $toSearchKey
+     */
+    public function convertSearchTableKeyword($word, $mapping, $toSearchKey=null) {
+        if(!isset($this->searchKeywordConverter)) {
+        	$this->searchKeywordConverter = new Repository_Files_Plugin_Searchkeywordconverter_Twobytechartohalfsizechar();
+        }
+        
+        if($mapping === self::LANGUAGE || $mapping === self::TEXTVERSION) {
+        	return $word;
+        }
+        
+        return $this->searchKeywordConverter->toSearchKey($word, $toSearchKey);
+    }
+    // Extend Search Keyword 2015/02/26 K.Sugimoto --end--
+    
 }
 
 ?>
diff --git a/repository/components/RepositoryShelfregistration.class.php b/repository/components/RepositoryShelfregistration.class.php
index 3168028..f004768 100644
--- a/repository/components/RepositoryShelfregistration.class.php
+++ b/repository/components/RepositoryShelfregistration.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryShelfregistration.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: RepositoryShelfregistration.class.php 22551 2013-05-13 00:57:50Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryUsagestatistics.class.php b/repository/components/RepositoryUsagestatistics.class.php
index a941449..ab06d30 100644
--- a/repository/components/RepositoryUsagestatistics.class.php
+++ b/repository/components/RepositoryUsagestatistics.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryUsagestatistics.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: RepositoryUsagestatistics.class.php 19124 2012-08-20 01:18:33Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryUsagestatisticsSendMail.class.php b/repository/components/RepositoryUsagestatisticsSendMail.class.php
index 1eec6f1..972dba1 100644
--- a/repository/components/RepositoryUsagestatisticsSendMail.class.php
+++ b/repository/components/RepositoryUsagestatisticsSendMail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryUsagestatisticsSendMail.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: RepositoryUsagestatisticsSendMail.class.php 30569 2014-01-09 07:37:40Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/components/RepositoryUserAuthorityManager.class.php b/repository/components/RepositoryUserAuthorityManager.class.php
index c9a1c28..af896d7 100644
--- a/repository/components/RepositoryUserAuthorityManager.class.php
+++ b/repository/components/RepositoryUserAuthorityManager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: RepositoryUserAuthorityManager.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: RepositoryUserAuthorityManager.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -45,7 +45,7 @@ class RepositoryUserAuthorityManager extends RepositoryLogicBase
                     "   AND room_id = ( ".
                     "       SELECT room_id ". 
                     "       FROM ".DATABASE_PREFIX."pages ". 
-                    "       WHERE page_id = '".$block_id['page_id']."' ".
+                    "       WHERE page_id = ".$block_id['page_id']." ".
                     "   ) ".
                     " ); ";
             $result = $this->dbAccess->executeQuery($query);
@@ -299,5 +299,23 @@ class RepositoryUserAuthorityManager extends RepositoryLogicBase
         $param_value = $result[0]['param_value'];
         return true;
     }
+    
+    /**
+     *  Get all user authority
+     * 
+     * @return result(array)
+     */
+    public function getAllAuthority()
+    {
+        $query = "SELECT * FROM ". DATABASE_PREFIX ."authorities ;";
+        // execute SQL
+        $result = $this->dbAccess->executeQuery($query);
+        
+        if(count($result) > 0) {
+            return $result;
+        } else {
+            return array();
+        }
+    }
 }
 ?>
diff --git a/repository/components/Swordmanager.class.php b/repository/components/Swordmanager.class.php
index fff01e1..13410d4 100644
--- a/repository/components/Swordmanager.class.php
+++ b/repository/components/Swordmanager.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Swordmanager.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Swordmanager.class.php 43075 2014-10-20 06:12:22Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/config/define.inc.php b/repository/config/define.inc.php
index e00f96f..186dfc4 100644
--- a/repository/config/define.inc.php
+++ b/repository/config/define.inc.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: define.inc.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: define.inc.php 49321 2015-03-03 12:15:32Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -36,7 +36,7 @@ if(!defined('SHIB_ENABLED'))
 // プライベートツリーが作成しない設定の時は、REPOSITORY_ADMIN_MOREの管理者権限以上(作成できない)
 // 作成する設定の時は、REPOSITORY_ITEM_REGIST_AUTHのアイテム登録権限
 // 管理画面で、プライベートツリー作成の設定を切り替えたとき下記権限を自動で書き換える
-define("_REPOSITORY_PRIVATETREE_AUTHORITY", REPOSITORY_ADMIN_MORE);		// CHANGE_TEXT_PRIVATETREE
+define("_REPOSITORY_PRIVATETREE_AUTHORITY", REPOSITORY_ADMIN_MORE);		// CHANGE_TEXT_PRIVATETREE
 
 //--------------プライベートツリー公開---------------------
 // 通常プライベートツリーは非公開(ユーザーおよび管理者のみ投稿・閲覧可)であるが
@@ -85,4 +85,11 @@ define("_REPOSITORY_HIGH_SPEED", false);
 // default value: false
 define("_REPOSITORY_NOT_SHOW_TOP_PAGE", false);
 
+//---------------DOI表示設定---------------------
+// 使用するDOIの設定
+// default value: false
+define("_REPOSITORY_JALC_DOI", false);
+define("_REPOSITORY_JALC_CROSSREF_DOI", false);
+define("_REPOSITORY_JALC_DATACITE_DOI", false);
+
 ?>
diff --git a/repository/files/css/blue/style.css b/repository/files/css/blue/style.css
index 74dec35..f593208 100644
--- a/repository/files/css/blue/style.css
+++ b/repository/files/css/blue/style.css
@@ -3,7 +3,7 @@
 /**
 // --------------------------------------------------------------------
 //
-// $Id: style.css 562 2014-04-14 01:03:17Z ivis $
+// $Id: style.css 49367 2015-03-05 00:45:00Z shota_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -787,12 +787,12 @@ a.white:hover { color:#fff !important; }
 .btn_blue:hover,
 .btn_back,
 .btn_back:hover,
-.btn_next,
-.btn_next:hover,
 .btn_upload,
 .btn_upload:hover,
 .btn_delete,
-.btn_delete:hover {
+.btn_delete:hover,
+.btn_delete_doi,
+.btn_delete_doi:hover {
 	margin:6px 3px !important;
 	padding:5px 10px 5px 25px;
 	/*background-color:#255b8c;*/
@@ -808,6 +808,23 @@ a.white:hover { color:#fff !important; }
     line-height:1.5;
 }
 
+.btn_next,
+.btn_next:hover {
+    margin:6px 3px !important;
+    padding:5px 25px 5px 10px;
+    /*background-color:#255b8c;*/
+    background-position:right 0 !important;
+    background-repeat:no-repeat;
+    border-color:#2c69a0 #1d466b #1d466b #2c69a0;
+    border-style:solid;
+    border-width:1px;
+    color:#fff !important;
+    cursor:pointer;
+    font-weight:bold;
+    text-decoration: none;
+    line-height:1.5;
+}
+
 .btn_blue:hover,
 .btn_back:hover,
 .btn_next:hover,
@@ -875,6 +892,19 @@ a.white:hover { color:#fff !important; }
 	border-color:#660404 #e18e8e #e18e8e #660404;
 }
 
+.btn_delete_doi,
+.btn_delete_doi:hover {
+	background-repeat:repeat-x;
+	background-color:#9d0606;
+	border-color:#e18e8e #660404 #660404 #e18e8e;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long.png");
+}
+.btn_delete_doi:hover {
+	background-color:#d55f5f;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long_hover.png");
+	border-color:#660404 #e18e8e #e18e8e #660404;
+}
+
 .btn_back {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/blue/btn_back.gif") !important;
 	font-size:96%;
@@ -901,7 +931,8 @@ a.white:hover { color:#fff !important; }
 
 .btn_blue[disabled], .btn_blue[disabled]:hover,
 .btn_white[disabled], .btn_white[disabled]:hover,
-.btn_delete[disabled], .btn_delete[disabled]:hover {
+.btn_delete[disabled], .btn_delete[disabled]:hover,
+.btn_delete_doi[disabled], .btn_delete_doi[disabled]:hover {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_white.gif") !important;
 	color:#ccc !important;
 	border-color:#f0f0f0 #d5d5d5 #d5d5d5 #f0f0f0 !important;
diff --git a/repository/files/css/default/style.css b/repository/files/css/default/style.css
index b58f3a5..6b6c001 100644
--- a/repository/files/css/default/style.css
+++ b/repository/files/css/default/style.css
@@ -3,7 +3,7 @@
 /**
 // --------------------------------------------------------------------
 //
-// $Id: style.css 562 2014-04-14 01:03:17Z ivis $
+// $Id: style.css 49367 2015-03-05 00:45:00Z shota_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -780,12 +780,12 @@ a.white:hover { color:#fff !important; }
 .btn_blue:hover,
 .btn_back,
 .btn_back:hover,
-.btn_next,
-.btn_next:hover,
 .btn_upload,
 .btn_upload:hover,
 .btn_delete,
-.btn_delete:hover {
+.btn_delete:hover,
+.btn_delete_doi,
+.btn_delete_doi:hover {
 	margin:6px 3px;
 	padding:5px 10px 5px 25px;
 	background-color:#555;
@@ -801,6 +801,23 @@ a.white:hover { color:#fff !important; }
     line-height:1.5;
 }
 
+.btn_next,
+.btn_next:hover {
+    margin:6px 3px;
+    padding:5px 25px 5px 10px;
+    background-color:#555;
+    background-position:right 0;
+    background-repeat:no-repeat;
+    border-color:#868686 #555 #555 #868686;
+    border-style:solid;
+    border-width:1px;
+    color:#fff;
+    cursor:pointer;
+	font-weight:bold;
+    text-decoration: none;
+    line-height:1.5;
+}
+
 .btn_blue:hover,
 .btn_back:hover,
 .btn_next:hover,
@@ -860,6 +877,19 @@ a.white:hover { color:#fff !important; }
 	border-color:#660404 #e18e8e #e18e8e #660404;
 }
 
+.btn_delete_doi,
+.btn_delete_doi:hover {
+	background-repeat:repeat-x;
+	background-color:#9d0606;
+	border-color:#e18e8e #660404 #660404 #e18e8e;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long.png");
+}
+.btn_delete_doi:hover {
+	background-color:#d55f5f;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long_hover.png");
+	border-color:#660404 #e18e8e #e18e8e #660404;
+}
+
 .btn_back {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_back.gif");
 	font-size:96%;
@@ -886,7 +916,8 @@ a.white:hover { color:#fff !important; }
 
 .btn_blue[disabled], .btn_blue[disabled]:hover,
 .btn_white[disabled], .btn_white[disabled]:hover,
-.btn_delete[disabled], .btn_delete[disabled]:hover {
+.btn_delete[disabled], .btn_delete[disabled]:hover,
+.btn_delete_doi[disabled], .btn_delete_doi[disabled]:hover {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_white.gif");
 	color:#ccc !important;
 	border-color:#f0f0f0 #d5d5d5 #d5d5d5 #f0f0f0;
diff --git a/repository/files/css/green/style.css b/repository/files/css/green/style.css
index 5409a78..ddcee4a 100644
--- a/repository/files/css/green/style.css
+++ b/repository/files/css/green/style.css
@@ -3,7 +3,7 @@
 /**
 // --------------------------------------------------------------------
 //
-// $Id: style.css 562 2014-04-14 01:03:17Z ivis $
+// $Id: style.css 49367 2015-03-05 00:45:00Z shota_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -793,12 +793,12 @@ a.white:hover { color:#fff !important; }
 .btn_blue:hover,
 .btn_back,
 .btn_back:hover,
-.btn_next,
-.btn_next:hover,
 .btn_upload,
 .btn_upload:hover,
 .btn_delete,
-.btn_delete:hover {
+.btn_delete:hover,
+.btn_delete_doi,
+.btn_delete_doi:hover {
 	margin:6px 3px !important;
 	padding:5px 10px 5px 25px;
 	/*background-color:#255b8c;*/
@@ -814,6 +814,23 @@ a.white:hover { color:#fff !important; }
     line-height:1.5;
 }
 
+.btn_next,
+.btn_next:hover {
+    margin:6px 3px !important;
+    padding:5px 25px 5px 10px;
+    /*background-color:#255b8c;*/
+    background-position:right 0 !important;
+    background-repeat:no-repeat;
+    border-color:#288c66 #316745 #316745 #288c66;
+    border-style:solid;
+    border-width:1px;
+    color:#fff !important;
+    cursor:pointer;
+    font-weight:bold;
+    text-decoration: none;
+    line-height:1.5;
+}
+
 .btn_blue:hover,
 .btn_back:hover,
 .btn_next:hover,
@@ -882,6 +899,19 @@ a.white:hover { color:#fff !important; }
 	border-color:#660404 #e18e8e #e18e8e #660404;
 }
 
+.btn_delete_doi,
+.btn_delete_doi:hover {
+	background-repeat:repeat-x;
+	background-color:#9d0606;
+	border-color:#e18e8e #660404 #660404 #e18e8e;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long.png");
+}
+.btn_delete_doi:hover {
+	background-color:#d55f5f;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long_hover.png");
+	border-color:#660404 #e18e8e #e18e8e #660404;
+}
+
 .btn_back {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/green/btn_back.gif") !important;
 	font-size:96%;
@@ -908,7 +938,8 @@ a.white:hover { color:#fff !important; }
 
 .btn_blue[disabled], .btn_blue[disabled]:hover,
 .btn_white[disabled], .btn_white[disabled]:hover,
-.btn_delete[disabled], .btn_delete[disabled]:hover {
+.btn_delete[disabled], .btn_delete[disabled]:hover,
+.btn_delete_doi[disabled], .btn_delete_doi[disabled]:hover {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_white.gif") !important;
 	color:#ccc !important;
 	border-color:#f0f0f0 #d5d5d5 #d5d5d5 #f0f0f0 !important;
diff --git a/repository/files/css/orange/style.css b/repository/files/css/orange/style.css
index 463e011..026dc8f 100644
--- a/repository/files/css/orange/style.css
+++ b/repository/files/css/orange/style.css
@@ -793,12 +793,12 @@ a.white:hover { color:#fff !important; }
 .btn_blue:hover,
 .btn_back,
 .btn_back:hover,
-.btn_next,
-.btn_next:hover,
 .btn_upload,
 .btn_upload:hover,
 .btn_delete,
-.btn_delete:hover {
+.btn_delete:hover,
+.btn_delete_doi,
+.btn_delete_doi:hover {
 	margin:6px 3px !important;
 	padding:5px 10px 5px 25px;
 	/*background-color:#255b8c;*/
@@ -814,6 +814,23 @@ a.white:hover { color:#fff !important; }
 	line-height:1.5;
 }
 
+.btn_next,
+.btn_next:hover {
+    margin:6px 3px !important;
+    padding:5px 25px 5px 10px;
+    /*background-color:#255b8c;*/
+    background-position:right 0 !important;
+    background-repeat:no-repeat;
+    border-color:#FFB959 #e17b34 #e17b34 #FFB959;
+    border-style:solid;
+    border-width:1px;
+    color:#fff !important;
+    cursor:pointer;
+    font-weight:bold;
+    text-decoration: none;
+    line-height:1.5;
+}
+
 .btn_blue:hover,
 .btn_back:hover,
 .btn_next:hover,
@@ -881,6 +898,19 @@ a.white:hover { color:#fff !important; }
 	border-color:#660404 #e18e8e #e18e8e #660404;
 }
 
+.btn_delete_doi,
+.btn_delete_doi:hover {
+	background-repeat:repeat-x;
+	background-color:#9d0606;
+	border-color:#e18e8e #660404 #660404 #e18e8e;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long.png");
+}
+.btn_delete_doi:hover {
+	background-color:#d55f5f;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long_hover.png");
+	border-color:#660404 #e18e8e #e18e8e #660404;
+}
+
 .btn_back {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/orange/btn_back.gif") !important;
 	font-size:96%;
@@ -907,7 +937,8 @@ a.white:hover { color:#fff !important; }
 
 .btn_blue[disabled], .btn_blue[disabled]:hover,
 .btn_white[disabled], .btn_white[disabled]:hover,
-.btn_delete[disabled], .btn_delete[disabled]:hover {
+.btn_delete[disabled], .btn_delete[disabled]:hover,
+.btn_delete_doi[disabled], .btn_delete_doi[disabled]:hover {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_white.gif") !important;
 	color:#ccc !important;
 	border-color:#f0f0f0 #d5d5d5 #d5d5d5 #f0f0f0 !important;
diff --git a/repository/files/css/pink/style.css b/repository/files/css/pink/style.css
index 307183f..c8dfecb 100644
--- a/repository/files/css/pink/style.css
+++ b/repository/files/css/pink/style.css
@@ -792,12 +792,12 @@ a.white:hover { color:#fff !important; }
 .btn_blue:hover,
 .btn_back,
 .btn_back:hover,
-.btn_next,
-.btn_next:hover,
 .btn_upload,
 .btn_upload:hover,
 .btn_delete,
-.btn_delete:hover {
+.btn_delete:hover,
+.btn_delete_doi,
+.btn_delete_doi:hover {
 	margin:6px 3px !important;
 	padding:5px 10px 5px 25px;
 	/*background-color:#EF9EDE;*/
@@ -813,6 +813,23 @@ a.white:hover { color:#fff !important; }
     line-height:1.5;
 }
 
+.btn_next,
+.btn_next:hover {
+    margin:6px 3px !important;
+    padding:5px 25px 5px 10px;
+    /*background-color:#EF9EDE;*/
+    background-position:right 0 !important;
+    background-repeat:no-repeat;
+    border-color:#f7b9f3 #ff69b4 #ff69b4 #f7b9f3;
+    border-style:solid;
+    border-width:1px;
+    color:#fff !important;
+    cursor:pointer;
+    font-weight:bold;
+    text-decoration: none;
+    line-height:1.5;
+}
+
 .btn_blue:hover,
 .btn_back:hover,
 .btn_next:hover,
@@ -895,6 +912,19 @@ a.white:hover { color:#fff !important; }
 	border-color:#660404 #e18e8e #e18e8e #660404;
 }
 
+.btn_delete_doi,
+.btn_delete_doi:hover {
+	background-repeat:repeat-x;
+	background-color:#9d0606;
+	border-color:#e18e8e #660404 #660404 #e18e8e;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long.png");
+}
+.btn_delete_doi:hover {
+	background-color:#d55f5f;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long_hover.png");
+	border-color:#660404 #e18e8e #e18e8e #660404;
+}
+
 .btn_back {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/pink/btn_back.gif") !important;
 	font-size:96%;
@@ -921,7 +951,8 @@ a.white:hover { color:#fff !important; }
 
 .btn_blue[disabled], .btn_blue[disabled]:hover,
 .btn_white[disabled], .btn_white[disabled]:hover,
-.btn_delete[disabled], .btn_delete[disabled]:hover {
+.btn_delete[disabled], .btn_delete[disabled]:hover,
+.btn_delete_doi[disabled], .btn_delete_doi[disabled]:hover {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_white.gif") !important;
 	color:#ccc !important;
 	border-color:#f0f0f0 #d5d5d5 #d5d5d5 #f0f0f0 !important;
diff --git a/repository/files/css/red/style.css b/repository/files/css/red/style.css
index a6228ae..5dfc749 100644
--- a/repository/files/css/red/style.css
+++ b/repository/files/css/red/style.css
@@ -792,12 +792,12 @@ a.white:hover { color:#fff !important; }
 .btn_blue:hover,
 .btn_back,
 .btn_back:hover,
-.btn_next,
-.btn_next:hover,
 .btn_upload,
 .btn_upload:hover,
 .btn_delete,
-.btn_delete:hover {
+.btn_delete:hover,
+.btn_delete_doi,
+.btn_delete_doi:hover {
 	margin:6px 3px !important;
 	padding:5px 10px 5px 25px;
 	/*background-color:#ff0000;*/
@@ -813,6 +813,23 @@ a.white:hover { color:#fff !important; }
     line-height:1.5;
 }
 
+.btn_next,
+.btn_next:hover {
+    margin:6px 3px !important;
+    padding:5px 25px 5px 10px;
+    /*background-color:#ff0000;*/
+    background-position:right 0 !important;
+    background-repeat:no-repeat;
+    border-color:#fc655a #C60A00 #C60A00 #fc655a;
+    border-style:solid;
+    border-width:1px;
+    color:#fff !important;
+    cursor:pointer;
+    font-weight:bold;
+    text-decoration: none;
+    line-height:1.5;
+}
+
 .btn_blue:hover,
 .btn_back:hover,
 .btn_next:hover,
@@ -880,6 +897,19 @@ a.white:hover { color:#fff !important; }
 	border-color:#660404 #e18e8e #e18e8e #660404;
 }
 
+.btn_delete_doi,
+.btn_delete_doi:hover {
+	background-repeat:repeat-x;
+	background-color:#9d0606;
+	border-color:#e18e8e #660404 #660404 #e18e8e;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long.png");
+}
+.btn_delete_doi:hover {
+	background-color:#d55f5f;
+	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_delete_long_hover.png");
+	border-color:#660404 #e18e8e #e18e8e #660404;
+}
+
 .btn_back {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/red/btn_back.gif") !important;
 	font-size:96%;
@@ -906,7 +936,8 @@ a.white:hover { color:#fff !important; }
 
 .btn_blue[disabled], .btn_blue[disabled]:hover,
 .btn_white[disabled], .btn_white[disabled]:hover,
-.btn_delete[disabled], .btn_delete[disabled]:hover {
+.btn_delete[disabled], .btn_delete[disabled]:hover,
+.btn_delete_doi[disabled], .btn_delete_doi[disabled]:hover {
 	background-image:url("<{$smarty.const.CORE_BASE_URL}>/images/repository/default/btn_white.gif") !important;
 	color:#ccc !important;
 	border-color:#f0f0f0 #d5d5d5 #d5d5d5 #f0f0f0 !important;
diff --git a/repository/files/galleryview/LICENSE.txt b/repository/files/galleryview/LICENSE.txt
index 01208fb..2330d40 100644
--- a/repository/files/galleryview/LICENSE.txt
+++ b/repository/files/galleryview/LICENSE.txt
@@ -1,4 +1,4 @@
-﻿Copyright (c) 2009 John Anderson III
+Copyright (c) 2009 John Anderson III
 
 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
diff --git a/repository/files/galleryview/js/jquery.timers-1.2.js b/repository/files/galleryview/js/jquery.timers-1.2.js
index 6803250..ce66eaf 100644
--- a/repository/files/galleryview/js/jquery.timers-1.2.js
+++ b/repository/files/galleryview/js/jquery.timers-1.2.js
@@ -1,4 +1,4 @@
-﻿/**
+/**
  * jQuery.timers - Timer abstractions for jQuery
  * Written by Blair Mitchelmore (blair DOT mitchelmore AT gmail DOT com)
  * Licensed under the WTFPL (http://sam.zoy.org/wtfpl/).
diff --git a/repository/files/help/en/contents.hhc b/repository/files/help/en/contents.hhc
index 20d00ea..c32f7ae 100644
--- a/repository/files/help/en/contents.hhc
+++ b/repository/files/help/en/contents.hhc
@@ -63,7 +63,7 @@
 			<LI> <OBJECT type="text/sitemap">
 				<param name="Name" value="サプリメンタルコンテンツ">
 				<param name="Local" value="html\workflow_supple.html">
-		</UL>
+				</UL>
 		<LI> <OBJECT type="text/sitemap">
 			<param name="Name" value="管理者">
 			<param name="Local" value="html\index.html">
diff --git a/repository/files/help/en/html/css/style.css b/repository/files/help/en/html/css/style.css
index 2ac0356..41daa04 100644
--- a/repository/files/help/en/html/css/style.css
+++ b/repository/files/help/en/html/css/style.css
@@ -58,3 +58,4 @@
 .indent{
 	padding-left: 2em;
 }
+
diff --git a/repository/files/help/en/html/img/item_entry_DOI_condition.png b/repository/files/help/en/html/img/item_entry_DOI_condition.png
index b4d6f4a..6f2cc32 100644
Binary files a/repository/files/help/en/html/img/item_entry_DOI_condition.png and b/repository/files/help/en/html/img/item_entry_DOI_condition.png differ
diff --git a/repository/files/help/en/html/img/itemtype.png b/repository/files/help/en/html/img/itemtype.png
index bf8fe5d..4718bb0 100644
Binary files a/repository/files/help/en/html/img/itemtype.png and b/repository/files/help/en/html/img/itemtype.png differ
diff --git a/repository/files/help/en/html/img/itemtype_mapping_04.png b/repository/files/help/en/html/img/itemtype_mapping_04.png
index 6e48015..0c9d625 100644
Binary files a/repository/files/help/en/html/img/itemtype_mapping_04.png and b/repository/files/help/en/html/img/itemtype_mapping_04.png differ
diff --git a/repository/files/help/en/html/img/itemtype_mapping_06.png b/repository/files/help/en/html/img/itemtype_mapping_06.png
index 82714f8..549240d 100644
Binary files a/repository/files/help/en/html/img/itemtype_mapping_06.png and b/repository/files/help/en/html/img/itemtype_mapping_06.png differ
diff --git a/repository/files/help/en/html/img/itemtype_mapping_10.png b/repository/files/help/en/html/img/itemtype_mapping_10.png
index e26638b..1862c78 100644
Binary files a/repository/files/help/en/html/img/itemtype_mapping_10.png and b/repository/files/help/en/html/img/itemtype_mapping_10.png differ
diff --git a/repository/files/help/en/html/img/itemtype_mappingconf_02.png b/repository/files/help/en/html/img/itemtype_mappingconf_02.png
index 6ac8443..c896293 100644
Binary files a/repository/files/help/en/html/img/itemtype_mappingconf_02.png and b/repository/files/help/en/html/img/itemtype_mappingconf_02.png differ
diff --git a/repository/files/help/en/html/img/setting_21.png b/repository/files/help/en/html/img/setting_21.png
index ffc862d..67458f4 100644
Binary files a/repository/files/help/en/html/img/setting_21.png and b/repository/files/help/en/html/img/setting_21.png differ
diff --git a/repository/files/help/en/html/img/setting_29.png b/repository/files/help/en/html/img/setting_29.png
index e9d0a19..3cc8299 100644
Binary files a/repository/files/help/en/html/img/setting_29.png and b/repository/files/help/en/html/img/setting_29.png differ
diff --git a/repository/files/help/en/html/img/setting_40.png b/repository/files/help/en/html/img/setting_40.png
index 4aae547..54e7cd8 100644
Binary files a/repository/files/help/en/html/img/setting_40.png and b/repository/files/help/en/html/img/setting_40.png differ
diff --git a/repository/files/help/en/html/img/setting_41.png b/repository/files/help/en/html/img/setting_41.png
index 4c55625..8448b5b 100644
Binary files a/repository/files/help/en/html/img/setting_41.png and b/repository/files/help/en/html/img/setting_41.png differ
diff --git a/repository/files/help/en/html/img/setting_42.png b/repository/files/help/en/html/img/setting_42.png
index 5c52c22..bff84b8 100644
Binary files a/repository/files/help/en/html/img/setting_42.png and b/repository/files/help/en/html/img/setting_42.png differ
diff --git a/repository/files/help/en/html/img/setting_43.png b/repository/files/help/en/html/img/setting_43.png
index eb046c4..4ac1d9e 100644
Binary files a/repository/files/help/en/html/img/setting_43.png and b/repository/files/help/en/html/img/setting_43.png differ
diff --git a/repository/files/help/en/html/img/setting_69.png b/repository/files/help/en/html/img/setting_69.png
index ff708d3..546cfdc 100644
Binary files a/repository/files/help/en/html/img/setting_69.png and b/repository/files/help/en/html/img/setting_69.png differ
diff --git a/repository/files/help/en/html/img/setting_73.png b/repository/files/help/en/html/img/setting_73.png
index 19f6961..22d510e 100644
Binary files a/repository/files/help/en/html/img/setting_73.png and b/repository/files/help/en/html/img/setting_73.png differ
diff --git a/repository/files/help/en/html/img/setting_86.png b/repository/files/help/en/html/img/setting_86.png
index 0b68df2..271debf 100644
Binary files a/repository/files/help/en/html/img/setting_86.png and b/repository/files/help/en/html/img/setting_86.png differ
diff --git a/repository/files/help/en/html/img/setting_87.png b/repository/files/help/en/html/img/setting_87.png
index d045510..b40ca31 100644
Binary files a/repository/files/help/en/html/img/setting_87.png and b/repository/files/help/en/html/img/setting_87.png differ
diff --git a/repository/files/help/en/html/img/supple_entry_popup_02.png b/repository/files/help/en/html/img/supple_entry_popup_02.png
index 52d5836..93de0fe 100644
Binary files a/repository/files/help/en/html/img/supple_entry_popup_02.png and b/repository/files/help/en/html/img/supple_entry_popup_02.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_01.png b/repository/files/help/en/html/img/tree_edit_01.png
index 3389fe3..4a82bff 100644
Binary files a/repository/files/help/en/html/img/tree_edit_01.png and b/repository/files/help/en/html/img/tree_edit_01.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_03.png b/repository/files/help/en/html/img/tree_edit_03.png
index 1755975..ab9ae51 100644
Binary files a/repository/files/help/en/html/img/tree_edit_03.png and b/repository/files/help/en/html/img/tree_edit_03.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_05.png b/repository/files/help/en/html/img/tree_edit_05.png
index 654ad07..24d0e90 100644
Binary files a/repository/files/help/en/html/img/tree_edit_05.png and b/repository/files/help/en/html/img/tree_edit_05.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_07.png b/repository/files/help/en/html/img/tree_edit_07.png
index 4fb6f56..4441612 100644
Binary files a/repository/files/help/en/html/img/tree_edit_07.png and b/repository/files/help/en/html/img/tree_edit_07.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_09.png b/repository/files/help/en/html/img/tree_edit_09.png
index cfd1218..079a840 100644
Binary files a/repository/files/help/en/html/img/tree_edit_09.png and b/repository/files/help/en/html/img/tree_edit_09.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_15.png b/repository/files/help/en/html/img/tree_edit_15.png
index d0d7531..e3316ff 100644
Binary files a/repository/files/help/en/html/img/tree_edit_15.png and b/repository/files/help/en/html/img/tree_edit_15.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_16.png b/repository/files/help/en/html/img/tree_edit_16.png
index 90b5b3a..b15cfae 100644
Binary files a/repository/files/help/en/html/img/tree_edit_16.png and b/repository/files/help/en/html/img/tree_edit_16.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_21.png b/repository/files/help/en/html/img/tree_edit_21.png
index 42ad488..df308ee 100644
Binary files a/repository/files/help/en/html/img/tree_edit_21.png and b/repository/files/help/en/html/img/tree_edit_21.png differ
diff --git a/repository/files/help/en/html/img/tree_edit_43.png b/repository/files/help/en/html/img/tree_edit_43.png
index 6ca9206..8193cae 100644
Binary files a/repository/files/help/en/html/img/tree_edit_43.png and b/repository/files/help/en/html/img/tree_edit_43.png differ
diff --git a/repository/files/help/en/html/import.html b/repository/files/help/en/html/import.html
index 29b644d..c020496 100644
--- a/repository/files/help/en/html/import.html
+++ b/repository/files/help/en/html/import.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: import.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: import.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -50,6 +50,13 @@
 						<li>メタデータ構成の異なる同名のアイテムタイプ名が存在した場合、アイテムタイプ名に自動的にサフィックスを付加し、「アイテムタイプ名_XX」としてインポートされる。</li>
 					</ul>
 				</div>
+				<h3><a name="top">サプリメンタルコンテンツ登録</a></h3>
+				<div class="page_list">
+                    WEKOインポート形式ファイル内のアイテム情報が記述されたXML(import.xml)にサプリメンタルコンテンツの情報が記述されていることでサプリメンタルコンテンツが登録できます。<br/>
+                    <br/>
+                    <center><img src="./img/supple_import.png" alt="インポートファイル指定" border="0" /></center>
+                    <br/>
+                </div>
 			</div>
 			<h2><a name="authority">著者名典拠インポート</h2>
 			<div class="page_list">
diff --git a/repository/files/help/en/html/index.html b/repository/files/help/en/html/index.html
index 5a0fdd3..ee11211 100644
--- a/repository/files/help/en/html/index.html
+++ b/repository/files/help/en/html/index.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: index.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: index.html 32710 2014-03-11 09:28:04Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/introduction.html b/repository/files/help/en/html/introduction.html
index 321f445..43c1bd4 100644
--- a/repository/files/help/en/html/introduction.html
+++ b/repository/files/help/en/html/introduction.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: introduction.html 380 2009-11-10 07:19:58Z ivis $          -->
+<!--// $Id: introduction.html 4 2010-02-02 05:28:03Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/item_detail.html b/repository/files/help/en/html/item_detail.html
index 4e3675a..b183c94 100644
--- a/repository/files/help/en/html/item_detail.html
+++ b/repository/files/help/en/html/item_detail.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: item_detail.html 600 2014-08-06 04:41:16Z ivis $        -->
+<!--// $Id: item_detail.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -187,7 +187,7 @@
 					アイテムの利用統計が閲覧出来ます。<br/>
 					また、アイテム詳細画面に、サイト開設時からのファイル毎のダウンロード回数が、リアルタイムで表示されます。<br/>
 					<br/>
-					
+
 					<center><img src="./img/item_detail_tokei.png" alt="利用統計表示"></center><br/>
 					<br/>
 					アイテム詳細画面の利用統計リンクをクリックすると、利用統計画面がポップアップで表示されます。<br/>
@@ -200,6 +200,17 @@
 						<li>利用統計の集計が行われている場合のみ「利用統計を見る」リンクが表示されます。</br>
 						利用統計の集計方法については<a href="./setting.html#run_DB">WEKO管理 データベース管理</a>をご覧ください。
 						</li>
+						</br>
+						<li>管理画面で利用統計リンクを表示する設定にしている場合のみ「利用統計を見る」リンクが表示されます。</br>
+						利用統計リンク表示の設定方法については<a href="./setting.html#view_UsageStatistics_link">WEKO管理 利用統計リンク表示設定</a>をご覧ください。
+						</li>
+						</br>
+						<li>利用統計機能は月末締めで行われる集計結果を元にしているため、新規登録されてから月が切り替わっていないアイテムの利用統計を表示できません。</br>
+						それらのアイテムについては以下のようなメッセージが表示されます。
+						<br/>
+						<center><img src="./img/item_detail_usagesatistics_not_exist.png" alt="利用統計表示"></center><br/>
+						<br/>
+						</li>
 					</ul>
 				</div>
 				<br/>
@@ -242,7 +253,7 @@
 						■既存登録<br/>
 						<div class="page_list">
 							サプリメンタルWEKOに登録されている既存のアイテムをサプリメンタルコンテンツとして登録します。<br/>
-							登録するアイテムのパーマリンクURLをテキストボックスに入力し、「登録」ボタンをクリックするとパーマリンク先のアイテム情報を取得します。<br/>
+							登録するアイテムのWEKO URLまたはパーマリンクURLをテキストボックスに入力し、「登録」ボタンをクリックするとパーマリンク先のアイテム情報を取得します。<br/>
 							<br/>
 							<center><img src="./img/supple_entry_popup_02.png" alt="サプリメンタルコンテンツ既存登録ポップアップ"></center><br/>
 							<br/>
@@ -250,6 +261,10 @@
 							<br/>
 							<center><img src="./img/supple_permalink.png" alt="パーマリンクURL"></center><br/>
 							<br/>
+							アイテムのWEKO URLは、アイテムリスト画面内のアイテム名にカーソルを合わし、右クリック→「リンクのURLをコピーで(A)」で取得できます。<br/>
+							<br/>
+							<center><img src="./img/supple_weko_url.png" alt="サプリメンタルコンテンツ既存登録ポップアップ"></center><br/>
+                            <br/>
 							アイテムの情報取得が正常に完了すると、サプリメンタルコンテンツとして登録されます。<br/>
 							<br/>
 							査読待の表示がある場合は他のユーザーに公開されていません。<br/>
@@ -290,7 +305,7 @@
 						</ul>
 					</div>
 				</div>
-				
+
 				<h3><a name="edit">アイテム編集</a></h3>
 				<div class="page_list">
 					アイテムの編集権限を持つ場合、「公開」ボタンまたは「非公開」ボタン、「編集」ボタン、「削除」ボタンが表示されます。<br/>
@@ -307,7 +322,7 @@
 					<center><img src="./img/item_detail_edit.png" alt="アイテム編集"></center><br/>
 					<br/>
 				</div>
-				<h3><a name="edit">検索ワード表示機能</a></h3>
+				<h3><a name="refererSearchKeyword">検索ワード表示機能</a></h3>
 				<div class="page_list">
 					アイテムがどのようなワードによって検索されているかを表示します。<br/>
 					<br/>
@@ -326,7 +341,7 @@
 				</div>
 				<br/>
 				<br/>
-				
+
 			</div>
 			<p align="center"><font size="2"><a href="../index.html" target="_top">WEKO Help Top</a></font></p>
 		</div>
diff --git a/repository/files/help/en/html/item_entry.html b/repository/files/help/en/html/item_entry.html
index c362ced..1a2ce90 100644
--- a/repository/files/help/en/html/item_entry.html
+++ b/repository/files/help/en/html/item_entry.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: item_entry.html 645 2014-10-29 12:39:52Z ivis $        -->
+<!--// $Id: item_entry.html 53594 2015-05-28 05:25:53Z kaede_matsushita $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -27,6 +27,11 @@
 				<br/>
 				<center><img src="./img/item_entry_tab.png" alt="アイテム登録タブ"></center><br/>
 				<br/>
+                フロー画像の各画面名をクリックすると該当の画面にジャンプできます。<br/>
+                ただし途中の画面で未入力の必須項目がある場合はその画面に遷移します。<br/>
+                <br/>
+                <center><img src="./img/item_entry_flow.png" alt="フロー画像"></center><br/>
+                <br/>
 				<br/>
 				<h3><a name="select">アイテムタイプ選択</a></h3>
 				<div class="page_list">
@@ -212,6 +217,20 @@
 						<br/>
 					</div>
 					<br/>
+					<h4><a name="price">権限設定</a></h4>
+					<div class="page_list">
+						メタデータ属性がファイルである場合はグループごとにダウンロード権限の設定をすることができます。<br/>
+						権限が設定されていないグループのユーザーはファイルをダウンロードできません。<br/>
+						<br/>
+						「More input row」ボタンを押下すると権限を設定するグループを追加できます。<br/>
+						「削除」ボタンを押下するとその行が削除されます。<br/>
+						<br/>
+						公開方法がオープンアクセスのファイルには権限は設定できません。<br/>
+						オープンアクセス日が経過した場合は、すべてのユーザーがファイルをダウンロードできます。<br/>
+						<br/>
+						<center><img src="./img/file_auth_setting.png" alt="権限設定"></center><br/>
+						<br/>
+					</div>
 					<h4><a name="price">課金設定</a></h4>
 					<div class="page_list">
 						メタデータ属性が課金ファイルである場合はグループごとに価格の設定をすることができます。<br/>
@@ -365,6 +384,29 @@
 						<br/>
 						<br/>
 					</div>
+					
+					<h4><a name="empty">空白文字列入力</a></h4>
+					<div class="page_list">
+						メタデータ入力時、「&EMPTY&」と入力すると、「空データ」を登録することができます。<br/>
+						個別のメタデータで、登録順序に意味がある場合などに利用します。<br/>
+						<br/>
+						<center><img src="./img/blank_word_01.png" alt="空白文字列入力"></center><br/>
+						<br/>
+						<p class="indent">
+							◆詳細画面<br/>
+							　詳細画面では「空データ」は表示されません。<br/>
+								<center><img src="./img/blank_word_02.png" alt="詳細表示"></center><br/>
+							<br/>
+						</p>
+						<br/>
+						<p class="indent">
+							◆OAI-PMH<br/>
+							　グルーピングに意味がある項目を出力する際に「空データ」を考慮してデータを出力します。<br/>
+								<center><img src="./img/blank_word_03.png" alt="詳細表示"></center><br/>
+							<br/>
+						</p>
+					</div>
+					
 					<h4><a name="policy_name">著作権ポリシー表示</a></h4>
 					<div class="page_list">
 						書誌に定められた著作権ポリシーを表示する。<br/>
@@ -451,7 +493,7 @@
 					<div class="page_list">
 						外部データベースから書誌情報を取得し該当項目に自動入力します。<br/>
 						<br/>
-						外部データベースは<a href="http://www.amazon.co.jp/" target="_blank">Amazon</a>, <a href="http://www.ncbi.nlm.nih.gov/sites/entrez/" target="_blank">PubMed</a>, <a href="http://ci.nii.ac.jp/" target="_blank">CiNii</a>, <a href="http://search.jamas.or.jp/" target="_blank">医中誌</a>が利用できます。<br/>
+						外部データベースは<a href="http://www.amazon.co.jp/" target="_blank">Amazon</a>, <a href="http://www.ncbi.nlm.nih.gov/sites/entrez/" target="_blank">PubMed</a>, <a href="http://ci.nii.ac.jp/" target="_blank">CiNii</a>, <a href="http://search.jamas.or.jp/" target="_blank">医中誌</a>, <a href="http://www.crossref.org/" target="_blank">CrossRef</a>が利用できます。<br/>
 						各サイトで利用可能な書誌IDを入力し、「取得」ボタンを押下すると書誌情報が取得されます。<br/>
 						取得された書誌情報は、アイテムの対応項目および対応するjunii2マッピングが設定されたメタデータ項目に自動入力されます。<br/>
 						<br/>
@@ -551,6 +593,27 @@
 									issn<br/>
 								</td>
 							</tr>
+							<tr>
+								<td>CrossRef</td>
+								<td>
+									CrossRef<br/>
+								</td>
+								<td>
+									タイトル（英）<br/>
+									著者名（英）<br/>
+									言語<br/>
+									雑誌名（英）<br/>
+									巻<br/>
+									号<br/>
+									ページ<br/>
+									発行年<br/>
+								</td>
+								<td>
+									creator<br/>
+									contributor<br/>
+									issn<br/>
+								</td>
+							</tr>
 						</table>
 						<br/>
 						<center><img src="./img/metadata_fill.png" alt="メタデータ自動入力"></center><br/>
@@ -567,6 +630,10 @@
 								医中誌は、医中誌と連携ができる場合のみメタデータ自動入力の項目に表示されます。<br/>
 								医中誌の連携については<a href="./setting.html#server_biblio">WEKO管理 書誌情報簡単登録</a>をご覧ください。
 							</li>
+							<li>
+								CrossRefは、CrossRefと連携ができる場合のみメタデータ自動入力の項目に表示されます。<br/>
+								CrossRefの連携については<a href="./setting.html#server_biblio">WEKO管理 書誌情報簡単登録</a>をご覧ください。
+							</li>
 						</ul>
 					</div>
 					<h4><a name="contributor">代理投稿機能</a></h4>
@@ -588,7 +655,7 @@
 							<img alt="代理投稿機能" src="./img/contributor.png">
 						</center>
 					</div>
-					<h4><a name="contributor">フィードバックメール送信先設定機能</a></h4>
+					<h4><a name="feedbackmail">フィードバックメール送信先設定機能</a></h4>
 					<div class="page_list">
 						WEKOに登録されている著者を、フィードバックメール送信先として指定することができます。
 						<br/>
@@ -711,7 +778,7 @@
 						DOIの取扱は十分注意して行ってください。<br/>
 						<ul>
 							<li>アイテム登録時にIDサーバー(http://id.nii.ac.jp/)のSuffixが付与される状態となっている</li>
-							<li>「JaLC」または「CrossRef」のプレフィックスがWEKOの管理画面にて登録されている</li>
+							<li>「JaLC」または「CrossRef」または「DataCite」のプレフィックスがWEKOの管理画面にて登録されている</li>
 							<li>削除されたアイテムではなく、公開されているアイテムである</li>
 							<li>ハーベストが許可(公開)されている</li>
 							<li>OAI-PMHのJuNii2形式でメタデータを出力することができる</li>
diff --git a/repository/files/help/en/html/item_setting.html b/repository/files/help/en/html/item_setting.html
index 089d949..8be870e 100644
--- a/repository/files/help/en/html/item_setting.html
+++ b/repository/files/help/en/html/item_setting.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: item_setting.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: item_setting.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -70,13 +70,58 @@
 			<h3>一括削除</h3>
 			<div class="page_list">
 				<a name="listdelete"></a>
+				アイテムを一括削除することができます。<br/>
+				選択したインデックスに属するアイテムを一括削除する方法とキーワード検索で条件に一致したアイテムを選択して一括削除する方法の2通りがあります。<br/>
+				<br/>
+				「一括削除」タブをクリックすると左側にキーワード検索欄とインデックスツリーが表示されます。<br/>
+				<br/>
+				<br/>
+				<center><img src="./img/item_setting_bulk_deletion.png" alt="一括削除タブ" border="0" /></center><br/>
+				<br/>
+				
+				<h4>キーワード検索から一括削除</h4>
+				キーワード検索で条件に一致したアイテムを選択して一括削除することができます。<br/>
+				<br/>
+				「キーワード検索」と「全文検索」どちらかの検索方法を選択します。<br/>
+				キーワードを入力して「検索」ボタンをクリックすると、検索条件に一致したアイテムの一覧が表示されます。<br/>
+				削除したいアイテムのチェックボックスを選択します。<br/>
+				　※表のヘッダーにあるチェックボックスにチェックを入れると表示されているチェックボックス全てが選択されます。<br/>
+				「アイテムを削除」ボタンをクリックすると、アイテムの一括削除が実行されます。<br/>
+				<br/>
+				<center><img src="./img/item_setting_bulk_deletion_keyword_01.png" alt="検索削除_設定" border="0" /></center><br/>
+				<br/>
+				
+				一括削除を実行すると削除した件数が表示されます。<br/>
+				検索条件に一致するアイテムで削除されていないものがあれば表示されます。<br/>
+				<br/>
+				<center><img src="./img/item_setting_bulk_deletion_keyword_02.png" alt="検索削除_実行後" border="0" /></center><br/>
+				<br/>
+				
+				<h4>インデックスから一括削除</h4>
 				インデックスに属するアイテムを一括削除することができます。<br/>
 				<br/>
-				「一括削除」タブをクリックし、「インデックスツリー」からアイテムを一括削除するインデックスを選択します。<br/>
+				「インデックスツリー」からアイテムを一括削除するインデックスを選択します。<br/>
 				「サブインデックスのアイテムも削除する」にチェックが付いている場合、再帰的に子インデックスに所属するアイテムも削除されます。<br/>
 				「アイテムを削除」ボタンをクリックすると、アイテムの一括削除が実行されます。<br/>
 				<br/>
-				<center><img src="./img/item_setting_06.png" alt="一括削除" border="0" /></center><br/>
+				<center><img src="./img/item_setting_bulk_deletion_index.png" alt="一括削除" border="0" /></center><br/>
+				<br/>
+			</div>
+			
+			<h3>DOI一括付与</h3>
+			<div class="page_list">
+				<a name="doibulkgrant"></a>
+				インデックスに属するアイテムに一括でDOIを付与することができます。<br/>
+				<br/>
+				「DOI一括付与」タブをクリックし、「インデックスツリー」からDOI一括付与を行うインデックスを選択します。<br/>
+				 選択したインデックスの直下に配置されているアイテムのうち、DOIを付与できるアイテムの一覧が表示されます。<br/>
+				 DOIを付与したいアイテムのチェックボックスをONにし、「DOI付与」ボタンを押下するとDOIが一括付与されます。<br/>
+				<br/>
+				<center><img src="./img/item_setting_DOI_add.png" alt="DOI一括付与" width="600" border="0" /></center><br/>
+				<br/>
+				すべてにチェックを入れる場合は、DOI名下部のチェックボックスから実行することができます。<br/>
+				<br/>
+				<center><img src="./img/item_setting_DOI_check.png" alt="DOI一括付与" width="600" border="0" /></center><br/>
 				<br/>
 			</div>
 			
diff --git a/repository/files/help/en/html/itemtype_mapping.html b/repository/files/help/en/html/itemtype_mapping.html
index 94847f7..e337de2 100644
--- a/repository/files/help/en/html/itemtype_mapping.html
+++ b/repository/files/help/en/html/itemtype_mapping.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: itemtype_mapping.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: itemtype_mapping.html 45812 2015-01-05 04:38:51Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -75,7 +75,7 @@
 							<td>&lt;title lang="ja"&gt;</td>
 							<td>generalTitle</td>
 							<td>&lt;generalTitle language="ja"&gt;</td>
-							<td>descriptiveMetadata.objectIdentificationWrap.titleWrap.titleSet.appellationValue</td>
+							<td>titleWrap.titleSet.appellationValue</td>
 							<td>&lt;titleWrap&gt;&lt;titleSet&gt;&lt;appellationValue xml:lang="jp"&gt;</td>
 							<td>日本語</td>
 						</tr>
@@ -87,7 +87,7 @@
 							<td>&lt;alternative&gt;</td>
 							<td>generalTitle</td>
 							<td>&lt;generalTitle language="en"&gt;</td>
-							<td>descriptiveMetadata.objectIdentificationWrap.titleWrap.titleSet.appellationValue</td>
+							<td>titleWrap.titleSet.appellationValue</td>
 							<td>&lt;titleWrap&gt;&lt;titleSet&gt;&lt;appellationValue xml:lang="en"&gt;</td>
 							<td>英語</td>
 						</tr>
@@ -123,7 +123,7 @@
 							<td>&lt;subject&gt;</td>
 							<td>generalKeyword</td>
 							<td>&lt;generalKeyword&gt;</td>
-							<td>descriptiveMetadata.objectRelationWrap.subjectWrap.subjectSet.displaySubject</td>
+							<td>subjectWrap.subjectSet.displaySubject</td>
 							<td>&lt;subjectWrap&gt;&lt;subjectSet&gt;&lt;displaySubject xml:lang="jp"&gt;</td>
 							<td>日本語</td>
 						</tr>
@@ -135,7 +135,7 @@
 							<td>&lt;subject&gt;</td>
 							<td>generalKeyword</td>
 							<td>&lt;generalKeyword&gt;</td>
-							<td>descriptiveMetadata.objectRelationWrap.subjectWrap.subjectSet.displaySubject</td>
+							<td>subjectWrap.subjectSet.displaySubject</td>
 							<td>&lt;subjectWrap&gt;&lt;subjectSet&gt;&lt;displaySubject xml:lang="jp"&gt;</td>
 							<td>英語</td>
 						</tr>
@@ -160,7 +160,7 @@
 							<td>&lt;alternative&gt;</td>
 							<td>generalTitle</td>
 							<td>&lt;generalTitle language="ja"&gt;</td>
-							<td>descriptiveMetadata.objectIdentificationWrap.titleWrap.titleSet.appellationValue</td>
+							<td>titleWrap.titleSet.appellationValue</td>
 							<td>&lt;titleWrap&gt;&lt;titleSet&gt;&lt;appellationValue xml:lang="jp"&gt;</td>
 							<td>日本語</td>
 						</tr>
@@ -172,7 +172,7 @@
 							<td>&lt;title lang="en"&gt;</td>
 							<td>generalTitle</td>
 							<td>&lt;generalTitle language="en"&gt;</td>
-							<td>descriptiveMetadata.objectIdentificationWrap.titleWrap.titleSet.appellationValue</td>
+							<td>titleWrap.titleSet.appellationValue</td>
 							<td>&lt;titleWrap&gt;&lt;titleSet&gt;&lt;appellationValue xml:lang="en"&gt;</td>
 							<td>英語</td>
 						</tr>
@@ -208,7 +208,7 @@
 							<td>&lt;subject&gt;</td>
 							<td>generalKeyword</td>
 							<td>&lt;generalKeyword&gt;</td>
-							<td>descriptiveMetadata.objectRelationWrap.subjectWrap.subjectSet.displaySubject</td>
+							<td>subjectWrap.subjectSet.displaySubject</td>
 							<td>&lt;subjectWrap&gt;&lt;subjectSet&gt;&lt;displaySubject xml:lang="jp"&gt;</td>
 							<td>日本語</td>
 						</tr>
@@ -220,7 +220,7 @@
 							<td>&lt;subject&gt;</td>
 							<td>generalKeyword</td>
 							<td>&lt;generalKeyword&gt;</td>
-							<td>descriptiveMetadata.objectRelationWrap.subjectWrap.subjectSet.displaySubject</td>
+							<td>subjectWrap.subjectSet.displaySubject</td>
 							<td>&lt;subjectWrap&gt;&lt;subjectSet&gt;&lt;displaySubject xml:lang="jp"&gt;</td>
 							<td>英語</td>
 						</tr>
@@ -1346,6 +1346,7 @@
 					<center><img src="./img/itemtype_mapping_04.png" alt="NIIType設定" border="0"/></center>
 					<br/>
 					各メタデータ属性にDublin CoreおよびJuNii2、Learning Object Matadata、LIDOの語彙を関連付けることができます。<br/>
+					Dublin Core以外のマッピング及び表示言語はセレクトボックスで内容を切り替えることができます。<br/>
 					セレクトボックスからDublin CoreまたはJuNii2、Learning Object Matadata、LIDOの語彙を選択すると、選択した語彙と関連付けされます。<br/>
 					ただし、メタデータ属性が書誌情報の場合Dublin CoreおよびJuNii2、Learning Object Matadata、LIDOの語彙が固定されており、変更や削除はできません。<br/>
 					<br/>
diff --git a/repository/files/help/en/html/itemtype_metadata.html b/repository/files/help/en/html/itemtype_metadata.html
index defdb80..470798f 100644
--- a/repository/files/help/en/html/itemtype_metadata.html
+++ b/repository/files/help/en/html/itemtype_metadata.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: itemtype_metadata.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: itemtype_metadata.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -1304,6 +1304,19 @@
 							<li>削除したアイテムタイプに属するアイテムは引き続き利用することができます。</li>
 						</ul>
 					</div>
+					<h4>アイテムタイプ権限設定</h4>
+					<div class="page_list">
+						指定したアイテムタイプの権限を設定する事が出来ます。<br/>
+						テキストエリアからユーザー権限を選択し、矢印ボタンで権限を変更し、「送信」ボタンをクリックするとアイテムタイプの権限が設定されます。<br/>
+						<br/>
+						<center><img src="./img/itemtype_authority_01.png" alt="アイテムタイプ権限設定" border="0"/></center>
+						<br/>
+						<br/>
+						【注意事項】
+						<ul>
+							<li>一部のアイテムタイプは権限を変更するすることはできません。</li>
+						</ul>
+					</div>
 				</div>
 				<br/>
 				<a name="itemtype_metadata"><h3>アイテムタイプメタデータ編集</h3></a>
diff --git a/repository/files/help/en/html/log.html b/repository/files/help/en/html/log.html
index fc401e8..85cef02 100644
--- a/repository/files/help/en/html/log.html
+++ b/repository/files/help/en/html/log.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: log.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: log.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -23,6 +23,9 @@
 			<div class="page_list">
 				「ログ解析」タブをクリックするとログ解析画面が表示されます。<br/>
 				ログの集計、解析を行い、その結果を表示またはダウンロードすることができます。<br/>
+				<a href="./setting.html#run_log">管理画面</a>にて除外対象に設定されているアドレスなどを除いて集計されます。<br/>
+				また、30秒以内に同一ユーザが同じ操作をした場合、集計から除外されます。
+				<br/>
 				<br/>
 				<center><img src="./img/log_01.png" alt="定型レポート" border="0"/></center><br/>
 				<br/>
@@ -36,29 +39,121 @@
 				<h3><a name="report">定型レポート</a></h3>
 				<div class="page_list">
 					指定した期間の定型レポートをTSV(タブ区切りテキスト)形式でダウンロードすることができます。<br/>
-					定型レポートは下記4種類です。<br/>
+					定型レポートは下記10種類です。<br/>
 					<br/>
-					<table class="table_border" border="0" alt="Downloadクリック" align="center" cellspacing="0">
+					<table class="table_border" border="0" alt="Downloadクリック" align="center" cellspacing="0" style="border-collapse: collapse" cellpadding="5">
 						<tr>
 							<th nowrap>ファイル名</th>
 							<th nowrap>ログ内容</th>
 						</tr>
 						<tr>
 							<td>logReport_IndexAccess_YYYYMM.tsv</td>
-							<td>各インデックスに所属するアイテムのアイテム詳細画面アクセス数</td>
+							<td>
+								各インデックスに所属するアイテムのアイテム詳細画面アクセス数を表示します</br>
+								インデックス名はツリー構造を&yen;区切りで表示します
+								</br>
+								</br>
+								<img src="./img/log_18.png" alt="インデックスごとの詳細画面アクセス数" border="0"/>
+							</td>
 						</tr>
 						<tr>
 							<td>logReport_PayPerView_YYYYMM.tsv</td>
-							<td>課金およびオープンアクセスファイルのダウンロード数</td>
+							<td>
+								課金およびオープンアクセスファイルのダウンロード数を表示します<br/>
+								また、NetCommonsの各グループ毎のファイルダウンロード数を表示します
+								</br>
+								</br>
+								<img style="width:100%" src="./img/log_19.png" alt="課金ファイルダウンロード数" border="0"/>
+							</td>
 						</tr>
 						<tr>
-							<td>logReport_SiteAccess_YYYYMM.tsv</td>
-							<td>サイトライセンスを設定しているホストからのアクセスとサイトライセンス以外からのアクセス数</td>
+							<td>logReport_SearchCount_YYYYMM.tsv</td>
+							<td>
+								各検索キーワードの検索回数を表示します<br/>
+								下記にあたる詳細カテゴリーの検索キーワードのみを表示します<br/>
+								<ul>
+									<li>タイトル</li>
+									<li>著者 OR 著者ID</li>
+									<li>キーワード</li>
+									<li>抄録・内容記述</li>
+									<li>公開者 OR 著者ID</li>
+									<li>寄与者 OR 著者ID</li>
+									<li>雑誌名</li>
+								</ul>
+								<img src="./img/log_20.png" alt="検索キーワードランキング" border="0"/>
+							</td>
 						</tr>
 						<tr>
-							<td>logReport_SuppleAccess_YYYYMM.tsv</td>
-							<td>サプリメンタルコンテンツアクセス数およびダウンロード数</td>
+							<td>logReport_SiteAccess_YYYYMM.tsv</td>
+							<td>
+								サイトライセンスを設定しているホストまたはユーザとサイトライセンス以外からの下記アクセス数を表示します
+								<ul>
+									<li>キーワード検索</li>
+									<li>アイテム詳細画面</li>
+									<li>ファイルダウンロード</li>
+								</ul>
+								<img src="./img/log_21.png" alt="サイトライセンス別アクセス数" border="0"/>
+							</td>
 						</tr>
+                        <tr>
+                            <td>logReport_SuppleAccess_YYYYMM.tsv</td>
+                            <td>
+                            	サプリメンタルコンテンツアクセス数およびダウンロード数を表示します<br/>
+                            	本レポートに記載されているサプリメンタルコンテンツの詳細画面アクセス数およびダウンロード数はサプリWEKOでのアイテム詳細画面アクセス数とダウンロード数となります
+								</br>
+								</br>
+								<img src="./img/log_22.png" alt="サプリメンタルコンテンツアクセス数およびダウンロード数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_DetailView_YYYYMM.tsv</td>
+                            <td>
+                            	アイテム詳細画面のアクセス数を表示します<br/>
+								また、NetCommonsの各グループ毎のアイテム詳細画面のアクセス数を表示します
+								</br>
+								</br>
+								<img src="./img/log_14.png" alt="詳細画面閲覧数" border="0"/>
+							</td>
+                        </tr>
+                        <tr>
+                            <td>logReport_FileView_YYYYMM.tsv</td>
+                            <td>
+                            	オープンアクセスおよびオープンアクセスでないファイルのダウンロード数をインデックスごとに表示します<br/>
+                            	また、ユーザの所属グループ、未ログイン、管理者およびアイテムの登録者毎のダウンロード数の内訳を表示します
+								</br>
+								</br>
+								<img style="width:100%;" src="./img/log_15.png" alt="ファイルダウンロード数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_FileViewPerUser_YYYYMM.tsv</td>
+                            <td>
+                            	ユーザー別のダウンロード数を表示します<br/>
+                            	また、各ユーザのログインID、ハンドル名、会員氏名、NC2の権限、所属している全グループも表示します
+								</br>
+								</br>
+								<img src="./img/log_16.png" alt="ユーザ別ダウンロード数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_HostAccess_YYYYMM.tsv</td>
+                            <td>
+                            	ホスト別のトップページアクセス数を表示します
+								</br>
+								</br>
+								<img src="./img/log_17.png" alt="ホスト別アクセス数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_UserAffiliate_YYYYMM.tsv</td>
+                            <td>
+                            	権限別の登録ユーザ数を表示します<br/>
+                            	また、研究会(NetCommonsのグループ)に所属しているユーザを表示します
+								</br>
+								</br>
+								<img src="./img/log_23.png" alt="ユーザ所属情報" border="0"/>
+                            </td>
+                        </tr>
 					</table>
 					<br/>
 					集計年月をセレクトボックスから指定し、「Download」リンクをクリックします。<br/>
@@ -69,10 +164,10 @@
 					<br/>
 					【注意事項】
 					<ul>
-						<li>定型レポートでダウンロードできるファイルは、4種類のTSV(タブ区切りテキスト)形式ファイルを圧縮したZIPアーカイブとなります。</li>
+						<li>定型レポートでダウンロードできるファイルは、10種類のTSV(タブ区切りテキスト)形式ファイルを圧縮したZIPアーカイブとなります。</li>
 					</ul>
 				</div>
-				<h4>定型レポート メール送信</h4>
+				<h4><a name="sendmail">定型レポート メール送信</h4>
 				<div class="page_list">
 					指定した期間の定型レポートを登録したメールアドレスで受信することができます。<br/>
 					<br/>
@@ -85,7 +180,7 @@
 					<center><img src="./img/log_04.png" alt="定型レポート メール送信" border="0"/></center><br/>
 					<br/>
 				</div>
-				<h3>カスタムレポート</h3>
+				<h3><a name="custom">カスタムレポート</h3>
 				<div class="page_list">
 					下記3種類のデータを指定した期間のログから集計することができます。<br/>
 					また、集計データを「日」「週」「月」「年」「アイテム」「ホスト」ごとに区切ったヒストグラムで表示またはダウンロードすることができます。<br/>
@@ -118,6 +213,14 @@
 					<br/>
 					<center><img src="./img/log_12.png" alt="Downloadクリック" border="0"/></center><br/>
 					<br/>
+					ダウンロード回数および閲覧回数にて、単位に「ホスト」を指定して表示すると下記のようになります<br/>
+					解析から除外したいアクセスを選択することができます。<br/>
+					<br/>
+					<center><img src="./img/log_13.png" alt="ホスト別カスタムレポート" border="0"/></center><br/>
+					<br/>
+					【注意事項】<br/>
+					解析から除外したいアクセスを設定した後、<a href="./setting.html#run_log">管理画面</a>にてログ削除の実行を実施する必要があります。<br/>
+					実行方法については<a href="./setting.html#run_log">WEKO管理</a>をご覧ください。
 				</div>
 				<h3>ログ削除</h3>
 				<div class="page_list">
diff --git a/repository/files/help/en/html/privatetree_edit.html b/repository/files/help/en/html/privatetree_edit.html
index ba48599..7c3338c 100644
--- a/repository/files/help/en/html/privatetree_edit.html
+++ b/repository/files/help/en/html/privatetree_edit.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: privatetree_edit.html 564 2014-04-14 01:06:48Z ivis $          -->
+<!--// $Id: privatetree_edit.html 18555 2012-07-12 03:39:15Z tatsuya_koyasu $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/ranking.html b/repository/files/help/en/html/ranking.html
index 298fd5c..40d3bee 100644
--- a/repository/files/help/en/html/ranking.html
+++ b/repository/files/help/en/html/ranking.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: ranking.html 527 2012-07-20 01:44:48Z ivis $        -->
+<!--// $Id: ranking.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/review.html b/repository/files/help/en/html/review.html
index 9361cb0..1a9a0d0 100644
--- a/repository/files/help/en/html/review.html
+++ b/repository/files/help/en/html/review.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: review.html 527 2012-07-20 01:44:48Z ivis $          -->
+<!--// $Id: review.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/search.html b/repository/files/help/en/html/search.html
index 109a3d6..05ab86b 100644
--- a/repository/files/help/en/html/search.html
+++ b/repository/files/help/en/html/search.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: search.html 599 2014-07-14 09:06:17Z ivis $        -->
+<!--// $Id: search.html 36553 2014-05-30 11:01:40Z tomohiro_ichikawa $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/setting.html b/repository/files/help/en/html/setting.html
index be2162f..d450a88 100644
--- a/repository/files/help/en/html/setting.html
+++ b/repository/files/help/en/html/setting.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: setting.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: setting.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -30,15 +30,18 @@
 				</ul>
 				<h3><a name="view">表示設定</a></h3>
 				<div class="page_list">
-					「表示設定」では下記6項目を設定することができます。<br/>
+					「表示設定」では下記10項目を設定することができます。<br/>
 					<ul>
 						<li><a href="#view_first_setting">初期表示設定</a></li>
 						<li><a href="#view_language">言語表示設定</a></li>
 						<li><a href="#view_unit_money">通貨単位設定</a></li>
-						<li><a href="#simple_list">インデックス一覧表示設定</a></li>
+						<li><a href="#simple_list">インデックスリンク表示設定</a></li>
 						<li><a href="#view_ranking">ランキング管理</a></li>
+						<li><a href="#default_search_setting">検索設定</a></li>
 						<li><a href="#view_detail_search">詳細検索条件設定</a></li>
 						<li><a href="#view_search">検索結果表示設定</a></li>
+						<li><a href="#view_icon">アイコン表示設定</a></li>
+						<li><a href="#view_UsageStatistics_link">利用統計リンク表示設定</a></li>
 					</ul>
 					「管理」タブを選択し、「表示設定」タブを選択すると表示設定画面が表示されます。<br/>
 					設定変更後は「適用」ボタンを押下し、変更を反映してください。<br/>
@@ -175,7 +178,7 @@
 						<center><img src="./img/setting_17.png" alt="通貨単位設定" border="0"/></center>
 						<br/>
 					</div>
-					<h4><a name="simple_list">インデックス一覧表示</a></h4>
+					<h4><a name="simple_list">インデックスリンク表示</a></h4>
 					<div class="page_list">
 						トップページのインデックス簡易アクセスUI表示を設定することができます。<br/>
 						設定するインデックス簡易アクセスUIはトップページの左側となります。
@@ -212,12 +215,21 @@
 									セレクトボックスから「DB保存情報を表示する」を選択すると、DBに登録されているランキング情報を利用したランキングが表示される<br/>
 								</td>
 							</tr>
+							
 							<tr>
-								<td nowrap>新規登録期間</td>
+								<td nowrap>ランキング表示設定</td>
 								<td>
 									登録アイテムを新着アイテムとして扱う期間を設定する<br/>
 								</td>
 							</tr>
+							
+							<tr>
+								<td nowrap>新規登録期間</td>
+								<td>
+									ランキングタブの表示／非表示を設定する<br/>
+									「表示する」を選択するとWEKOのトップページにランキングタブが表示される<br/>
+								</td>
+							</tr>
 							<tr>
 								<td nowrap>統計期間</td>
 								<td>
@@ -247,6 +259,19 @@
 							<li>新規登録期間に設定できる日数は「1日」からとなります。</li>
 						</ul>
 					</div>
+					
+					<h4><a name="default_search_setting">検索設定</a></h4>
+					<div class="page_list">
+						WEKOの簡易検索および詳細検索のデフォルトの検索タイプを「全文検索」または「キーワード検索」のどちらかに設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_default_search_setting.png" alt="検索設定" border="0"/></center>
+						<br/>
+						下記のように設定した値がトップページの検索画面に反映されます。<br/>
+						<br/>
+						<center><img src="./img/setting_top_seartch_type.png" alt="トップページの検索タイプ設定" border="0"/></center>
+						<br/>
+					</div>
+					
 					<h4><a name="view_detail_search">詳細検索条件設定</a></h4>
 					<div class="page_list">
 						使用可能な詳細検索条件およびデフォルトで表示する詳細検索条件について設定することができます。<br/>
@@ -297,6 +322,33 @@
 						</table>
 						<br/>
 					</div>
+					
+					<h4><a name="view_icon">アイコン表示設定</a></h4>
+					<div class="page_list">
+						トップページのヘルプアイコンとOAI-OREアイコンの表示／非表示を設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_display_icon_setting.png" alt="アイコン表示設定" border="0"/></center>
+						<br/>
+						どちらも「表示する」を選択した場合、トップページ画面は以下のようになります。<br/>
+						<br/>
+						<center><img src="./img/setting_display_icon_top.png" alt="アイコン表示トップ画面" border="0"/></center>
+						<br/>
+					</div>
+					
+					
+					
+					<h4><a name="view_UsageStatistics_link">利用統計リンク表示設定</a></h4>
+					<div class="page_list">
+						アイテム詳細画面に利用統計リンクを表示するかしないかを設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_usagestatistics_link.png" alt="利用統計リンク表示設定" border="0"/></center>
+						<br/>
+						「表示する」を選択した場合、アイテム詳細画面は以下のようになります。<br/>
+						<br/>
+						<center><img src="./img/setting_detail_usagestatistics_link.png" alt="利用統計リンク表示設定" border="0"/></center>
+						<br/>
+					</div>
+					
 				</div>
 				<h3><a name="run">運用設定</a></h3>
 				<div class="page_list">
@@ -388,10 +440,51 @@
 					</div>
 					<h4><a name="run_log">ログ解析管理</a></h4>
 					<div class="page_list">
+						<a name="exclude_log">■除外対象のログ削除</a><br/>
+						除外対象アドレスおよび共用クローラーリストから、指定されたIPアドレス、ユーザエージェントを持つアクセスログを削除します。<br/>
+						除外されるアクセスログは画面上で設定したIPアドレスおよび共用クローラーリストに<br/>
+						記載されているIPアドレスを持つアクセスログと、共用クローラーリストに記載されている<br/>
+						文字列に部分一致するユーザエージェントを持つアクセスログです。<br/>
+						<br/>
+						<center><img src="./img/setting_102.png" alt="ログ除外実行" border="0"/></center>
+						<br/>
+						【注意事項】
+						<ul>
+							<li><b style="color:#FF0000">アクセスログは物理削除となります</b></li>
+							<li><b style="color:#FF0000">設定後、設定されたIPアドレスおよび共用クローラーリストにて指定されたIPアドレスとユーザエージェントを持つアクセスはアクセスログに保存されなくなります</b></li>
+						</ul>
+						<br/>
+						除外対象のログを削除している間はログ集計を実施できません。<br/>
+						除外処理終了後、ログの集計が実施できるようになります。<br/>
+						影響を受ける集計結果を下記に記載いたします。
+						<ul>
+							<li>ランキング</li>
+							<li>利用統計</li>
+							<li>サイトライセンスフィードバックメール送信</li>
+							<li>利用統計フィードバックメール送信</li>
+							<li>定型レポート</li>
+							<li>カスタムレポート</li>
+						</ul>
+						<br/>
+						<a name="set_ipaddress">■除外対象アドレス</a><br/>
 						ログ解析から除外するIPアドレスを指定することができます。<br/>
 						<br/>
 						<center><img src="./img/setting_69.png" alt="ログ解析管理" border="0"/></center>
 						<br/>
+						<br/>
+						<a name="shared_crawler_list">■共用クローラーリスト</a><br/>
+						ログ解析から除外するIPアドレス、ユーザエージェントの部分一致キーワードリストを定義し、ネットワークを介して取得、設定することができます。<br/>
+						共用クローラーリストはNIIから提供されます。<br/>
+						表示されるバージョンなどは現在取り込んでいるクローラーリストの情報となります。<br/>
+						<br/>
+						<center><img src="./img/setting_103.png" alt="共用クローラーリスト" border="0"/></center>
+						<br/>
+						【注意事項】
+						<ul>
+							<li><b style="color:#FF0000">共用クローラーリストを無効にしても削除されたアクセスログは復活しません</b></li>
+							<li>有効に変更しログ削除実施後、指定されたIPアドレスおよび共用クローラーリストにて指定されているIPアドレスおよびユーザエージェントと部分一致するアクセスはログに保存されなくなります</li>
+						</ul>
+						<br/>
 					</div>
 					<h4><a name="run_license">サイトライセンス認可</a></h4>
 					<div class="page_list">
@@ -399,6 +492,7 @@
 						サイトライセンスを認可されたIPアドレスからのアクセスであれば、課金ファイルが無料でダウンロードできるようになります。<br/>
 						また、サイトライセンスが認可されているIPアドレスからのアクセスであってもアイテムタイプごとに無料ダウンロード対象から除外することが可能です。<br/>
 						サイトライセンスユーザーの利用状況をフィードバックする事が出来ます。<br/>
+						<br/>
 						<center><img src="./img/setting_73.png" alt="サイトライセンス認可" border="0"/></center>
 						<br/>
 					</div>
@@ -662,19 +756,42 @@
 						■PrefixID(<a href="http://japanlinkcenter.org/jalc/" target="_blank">JaLC DOI</a>)
 						<br/>
 						JaLC DOIハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC DOIのPrefix設定欄を表示するには、repository/config/define.inc.phpの_REPOSITORY_JALC_DOIをtrueにする必要があります。<br/>
 						<br/>
 						<center><img src="./img/setting_41.png" alt="" border="0"/></center>
 						<br/>
 						
 						<br/>
-						■PrefixID(<a href="http://www.crossref.org/" target="_blank">Cross Ref</a>)
+						■PrefixID(<a href="http://www.crossref.org/" target="_blank">JaLC CrossRef DOI</a>)
 						<br/>
-						Cross RefハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC CrossRef DOIハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC CrossRef DOIのPrefix設定欄を表示するには、repository/config/define.inc.phpの_REPOSITORY_JALC_CROSSREF_DOIをtrueにする必要があります。<br/>
 						<br/>
 						<center><img src="./img/setting_42.png" alt="" border="0"/></center>
 						<br/>
 						
 						<br/>
+						■PrefixID(<a href="https://www.datacite.org/" target="_blank">JaLC DataCite DOI</a>)
+						<br/>
+						JaLC DataCite DOIハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC DataCite DOIのPrefix設定欄を表示するには、repository/config/define.inc.phpの_REPOSITORY_JALC_DATACITE_DOIをtrueにする必要があります。<br/>
+						<br/>
+						<center><img src="./img/setting_101.png" alt="" border="0"/></center>
+						<br/>
+						
+						<br/>
+						■機関内部ID
+						<br/>
+						複数のWEKOを所有する機関において、DOIの値が重複することを防ぐため、 下記のようにPrefixID(http://id.nii.ac.jp/)をSuffixに付加するか設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_100.png" alt="" border="0"/></center>
+						<br/>
+						<font color="#f00">DOIが付与されたアイテムをすでに登録している場合、設定を変更することはできません。</font><br/>
+						<br/>
+						<center><img src="./img/setting_99.png" alt="" border="0"/></center>
+						<br/>
+						
+						<br/>
 						■PrefixID(<a href="http://www.cnri.reston.va.us/" target="_blank">CNRIハンドル</a>)
 						<br/>
 						CNRIハンドルサーバのPrefixIDを設定することができます。<br/>
@@ -738,6 +855,20 @@
 							<li>医中誌へ連携しない場合、及び「現在の連携状態」が未認証状態の場合、医中誌のfill機能が利用できなくなります。</li>
 							<li>医中誌へのIP認証が通っている場合、ログインID・ログインパスワードの設定は必要ありません。</li>
 						</ul>
+						<br/>
+						<br/>
+						■CrossRef Query Services Account
+						<br/>
+						アイテム登録時のfill機能において利用しているCrossRefの「CrossRef Query Services Account」を変更することができます。<br/>
+						「CrossRef Query Services Account」は、CrossRef連携に利用する登録アカウントです。 <br/>
+						<br/>
+						<center><img src="./img/setting_crossref_account.png" alt="CrossRefQueryServicesAccount" border="0"/></center>
+						<br/>
+						<br/>
+						【注意事項】
+						<ul>
+							<li>「CrossRef Query Services Account」が空白の場合、CrossRefのfill機能が利用できなくなります。</li>
+						</ul>
 					</div>
 					<h4><a name="server_OAIPMH">OAI-PMH設定</a></h4>
 					<div class="page_list">
diff --git a/repository/files/help/en/html/top.html b/repository/files/help/en/html/top.html
index a986cb5..6494056 100644
--- a/repository/files/help/en/html/top.html
+++ b/repository/files/help/en/html/top.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: top.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: top.html 32710 2014-03-11 09:28:04Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/tree_edit.html b/repository/files/help/en/html/tree_edit.html
index a0359fb..82064da 100644
--- a/repository/files/help/en/html/tree_edit.html
+++ b/repository/files/help/en/html/tree_edit.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: tree_edit.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: tree_edit.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -179,7 +179,7 @@
 						投稿権限についての詳細は<a href="http://www.netcommons.org/nc20/nc20_manual/japanese/admin_manual/chapter3.html#3">NetCommonsのヘルプ</a>をご参照下さい。</li>
 					</ul>
 				</div>
-				<h3>移動</h3>
+				<h3>移動<a name="move"></h3>
 				<div class="page_list">
 					インデックスのドラッグ&ドロップでインデックスを移動することができます。<br/>
 					インデックスの移動では子インデックスも一緒に移動されます。<br/>
@@ -187,7 +187,19 @@
 					<center><img src="./img/tree_edit_43.png" alt="インデックス移動" border="0"/></center>
 					<br/>
 				</div>
-				<h3>削除</h3>
+				<h3>コピー<a name="copy"></h3>
+				<div class="page_list">
+					コントロールキーを押下しながら、インデックスのドラッグ&ドロップでインデックスをコピーすることができます。<br/>
+					インデックスのコピーでは設定および子インデックスも一緒にコピーされます。<br/>
+					<br/>
+					<center><img src="./img/tree_edit_44.png" alt="インデックスコピー" border="0"/></center>
+					<br/>
+					【注意事項】
+					<ul>
+						<li>インデックスに所属するアイテムはコピーされません。</li>
+					</ul>
+				</div>
+				<h3>削除<a name="delete"></h3>
 				<div class="page_list">
 					インデックスを削除することができます。<br/>
 					任意のインデックスをクリックして選択し、「削除」をクリックすると任意のインデックスが削除されます。<br/>
diff --git a/repository/files/help/en/html/workflow.html b/repository/files/help/en/html/workflow.html
index a1bf4b8..9ce1dbf 100644
--- a/repository/files/help/en/html/workflow.html
+++ b/repository/files/help/en/html/workflow.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: workflow.html 527 2012-07-20 01:44:48Z ivis $        -->
+<!--// $Id: workflow.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/html/workflow_supple.html b/repository/files/help/en/html/workflow_supple.html
index a6b50d7..37054c6 100644
--- a/repository/files/help/en/html/workflow_supple.html
+++ b/repository/files/help/en/html/workflow_supple.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: workflow_supple.html 527 2012-07-20 01:44:48Z ivis $        -->
+<!--// $Id: workflow_supple.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/en/index.html b/repository/files/help/en/index.html
index 809a342..54491fb 100644
--- a/repository/files/help/en/index.html
+++ b/repository/files/help/en/index.html
@@ -1,7 +1,7 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN">
 <html>
 <head>
-  <title>WEKO HELP ver2.1.5</title>
+  <title>WEKO HELP ver2.2.0</title>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 </head>
 
diff --git a/repository/files/help/ja/html/img/item_entry_DOI_condition.png b/repository/files/help/ja/html/img/item_entry_DOI_condition.png
index b4d6f4a..6f2cc32 100644
Binary files a/repository/files/help/ja/html/img/item_entry_DOI_condition.png and b/repository/files/help/ja/html/img/item_entry_DOI_condition.png differ
diff --git a/repository/files/help/ja/html/img/item_entry_DOI_view.png b/repository/files/help/ja/html/img/item_entry_DOI_view.png
index 96d5532..3dd040a 100644
Binary files a/repository/files/help/ja/html/img/item_entry_DOI_view.png and b/repository/files/help/ja/html/img/item_entry_DOI_view.png differ
diff --git a/repository/files/help/ja/html/img/item_setting_DOI_add.png b/repository/files/help/ja/html/img/item_setting_DOI_add.png
index 86b6662..b109d04 100644
Binary files a/repository/files/help/ja/html/img/item_setting_DOI_add.png and b/repository/files/help/ja/html/img/item_setting_DOI_add.png differ
diff --git a/repository/files/help/ja/html/img/item_setting_DOI_check.png b/repository/files/help/ja/html/img/item_setting_DOI_check.png
index 8181937..afb0277 100644
Binary files a/repository/files/help/ja/html/img/item_setting_DOI_check.png and b/repository/files/help/ja/html/img/item_setting_DOI_check.png differ
diff --git a/repository/files/help/ja/html/img/itemtype.png b/repository/files/help/ja/html/img/itemtype.png
index bf8fe5d..4718bb0 100644
Binary files a/repository/files/help/ja/html/img/itemtype.png and b/repository/files/help/ja/html/img/itemtype.png differ
diff --git a/repository/files/help/ja/html/img/itemtype_mapping_04.png b/repository/files/help/ja/html/img/itemtype_mapping_04.png
index 06215c2..0c9d625 100644
Binary files a/repository/files/help/ja/html/img/itemtype_mapping_04.png and b/repository/files/help/ja/html/img/itemtype_mapping_04.png differ
diff --git a/repository/files/help/ja/html/img/itemtype_mapping_06.png b/repository/files/help/ja/html/img/itemtype_mapping_06.png
index 312633b..549240d 100644
Binary files a/repository/files/help/ja/html/img/itemtype_mapping_06.png and b/repository/files/help/ja/html/img/itemtype_mapping_06.png differ
diff --git a/repository/files/help/ja/html/img/itemtype_mapping_10.png b/repository/files/help/ja/html/img/itemtype_mapping_10.png
index fcd0299..1862c78 100644
Binary files a/repository/files/help/ja/html/img/itemtype_mapping_10.png and b/repository/files/help/ja/html/img/itemtype_mapping_10.png differ
diff --git a/repository/files/help/ja/html/img/itemtype_mappingconf_02.png b/repository/files/help/ja/html/img/itemtype_mappingconf_02.png
index caed0d6..c896293 100644
Binary files a/repository/files/help/ja/html/img/itemtype_mappingconf_02.png and b/repository/files/help/ja/html/img/itemtype_mappingconf_02.png differ
diff --git a/repository/files/help/ja/html/img/setting_21.png b/repository/files/help/ja/html/img/setting_21.png
index ffc862d..67458f4 100644
Binary files a/repository/files/help/ja/html/img/setting_21.png and b/repository/files/help/ja/html/img/setting_21.png differ
diff --git a/repository/files/help/ja/html/img/setting_29.png b/repository/files/help/ja/html/img/setting_29.png
index e9d0a19..3cc8299 100644
Binary files a/repository/files/help/ja/html/img/setting_29.png and b/repository/files/help/ja/html/img/setting_29.png differ
diff --git a/repository/files/help/ja/html/img/setting_40.png b/repository/files/help/ja/html/img/setting_40.png
index 4aae547..54e7cd8 100644
Binary files a/repository/files/help/ja/html/img/setting_40.png and b/repository/files/help/ja/html/img/setting_40.png differ
diff --git a/repository/files/help/ja/html/img/setting_41.png b/repository/files/help/ja/html/img/setting_41.png
index 4c55625..8448b5b 100644
Binary files a/repository/files/help/ja/html/img/setting_41.png and b/repository/files/help/ja/html/img/setting_41.png differ
diff --git a/repository/files/help/ja/html/img/setting_42.png b/repository/files/help/ja/html/img/setting_42.png
index 5c52c22..bff84b8 100644
Binary files a/repository/files/help/ja/html/img/setting_42.png and b/repository/files/help/ja/html/img/setting_42.png differ
diff --git a/repository/files/help/ja/html/img/setting_43.png b/repository/files/help/ja/html/img/setting_43.png
index eb046c4..4ac1d9e 100644
Binary files a/repository/files/help/ja/html/img/setting_43.png and b/repository/files/help/ja/html/img/setting_43.png differ
diff --git a/repository/files/help/ja/html/img/setting_69.png b/repository/files/help/ja/html/img/setting_69.png
index ff708d3..546cfdc 100644
Binary files a/repository/files/help/ja/html/img/setting_69.png and b/repository/files/help/ja/html/img/setting_69.png differ
diff --git a/repository/files/help/ja/html/img/setting_73.png b/repository/files/help/ja/html/img/setting_73.png
index 19f6961..22d510e 100644
Binary files a/repository/files/help/ja/html/img/setting_73.png and b/repository/files/help/ja/html/img/setting_73.png differ
diff --git a/repository/files/help/ja/html/img/supple_entry_popup_02.png b/repository/files/help/ja/html/img/supple_entry_popup_02.png
index 52d5836..93de0fe 100644
Binary files a/repository/files/help/ja/html/img/supple_entry_popup_02.png and b/repository/files/help/ja/html/img/supple_entry_popup_02.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_01.png b/repository/files/help/ja/html/img/tree_edit_01.png
index 3389fe3..4a82bff 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_01.png and b/repository/files/help/ja/html/img/tree_edit_01.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_03.png b/repository/files/help/ja/html/img/tree_edit_03.png
index 1755975..ab9ae51 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_03.png and b/repository/files/help/ja/html/img/tree_edit_03.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_05.png b/repository/files/help/ja/html/img/tree_edit_05.png
index 654ad07..24d0e90 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_05.png and b/repository/files/help/ja/html/img/tree_edit_05.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_07.png b/repository/files/help/ja/html/img/tree_edit_07.png
index 4fb6f56..4441612 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_07.png and b/repository/files/help/ja/html/img/tree_edit_07.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_09.png b/repository/files/help/ja/html/img/tree_edit_09.png
index cfd1218..079a840 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_09.png and b/repository/files/help/ja/html/img/tree_edit_09.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_15.png b/repository/files/help/ja/html/img/tree_edit_15.png
index d0d7531..e3316ff 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_15.png and b/repository/files/help/ja/html/img/tree_edit_15.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_16.png b/repository/files/help/ja/html/img/tree_edit_16.png
index 90b5b3a..b15cfae 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_16.png and b/repository/files/help/ja/html/img/tree_edit_16.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_21.png b/repository/files/help/ja/html/img/tree_edit_21.png
index 42ad488..df308ee 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_21.png and b/repository/files/help/ja/html/img/tree_edit_21.png differ
diff --git a/repository/files/help/ja/html/img/tree_edit_43.png b/repository/files/help/ja/html/img/tree_edit_43.png
index 6ca9206..8193cae 100644
Binary files a/repository/files/help/ja/html/img/tree_edit_43.png and b/repository/files/help/ja/html/img/tree_edit_43.png differ
diff --git a/repository/files/help/ja/html/import.html b/repository/files/help/ja/html/import.html
index 29b644d..7288283 100644
--- a/repository/files/help/ja/html/import.html
+++ b/repository/files/help/ja/html/import.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: import.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: import.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -50,6 +50,13 @@
 						<li>メタデータ構成の異なる同名のアイテムタイプ名が存在した場合、アイテムタイプ名に自動的にサフィックスを付加し、「アイテムタイプ名_XX」としてインポートされる。</li>
 					</ul>
 				</div>
+				<h3><a name="top">サプリメンタルコンテンツ登録</a></h3>
+				<div class="page_list">
+                    WEKOインポート形式ファイル内のアイテム情報が記述されたXML(import.xml)にサプリメンタルコンテンツの情報が記述されていることでサプリメンタルコンテンツが登録できます。<br/>
+                    <br/>
+                    <center><img src="./img/supple_import.png" alt="インポートファイル指定" border="0" /></center>
+                    <br/>
+                </div>
 			</div>
 			<h2><a name="authority">著者名典拠インポート</h2>
 			<div class="page_list">
diff --git a/repository/files/help/ja/html/index.html b/repository/files/help/ja/html/index.html
index 5a0fdd3..ee11211 100644
--- a/repository/files/help/ja/html/index.html
+++ b/repository/files/help/ja/html/index.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: index.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: index.html 32710 2014-03-11 09:28:04Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/introduction.html b/repository/files/help/ja/html/introduction.html
index 321f445..43c1bd4 100644
--- a/repository/files/help/ja/html/introduction.html
+++ b/repository/files/help/ja/html/introduction.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: introduction.html 380 2009-11-10 07:19:58Z ivis $          -->
+<!--// $Id: introduction.html 4 2010-02-02 05:28:03Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/item_detail.html b/repository/files/help/ja/html/item_detail.html
index 8584ba1..d687c7c 100644
--- a/repository/files/help/ja/html/item_detail.html
+++ b/repository/files/help/ja/html/item_detail.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: item_detail.html 600 2014-08-06 04:41:16Z ivis $        -->
+<!--// $Id: item_detail.html 53594 2015-05-28 05:25:53Z kaede_matsushita $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -187,7 +187,7 @@
 					アイテムの利用統計が閲覧出来ます。<br/>
 					また、アイテム詳細画面に、サイト開設時からのファイル毎のダウンロード回数が、リアルタイムで表示されます。<br/>
 					<br/>
-					
+
 					<center><img src="./img/item_detail_tokei.png" alt="利用統計表示"></center><br/>
 					<br/>
 					アイテム詳細画面の利用統計リンクをクリックすると、利用統計画面がポップアップで表示されます。<br/>
@@ -200,6 +200,17 @@
 						<li>利用統計の集計が行われている場合のみ「利用統計を見る」リンクが表示されます。</br>
 						利用統計の集計方法については<a href="./setting.html#run_DB">WEKO管理 データベース管理</a>をご覧ください。
 						</li>
+						</br>
+						<li>管理画面で利用統計リンクを表示する設定にしている場合のみ「利用統計を見る」リンクが表示されます。</br>
+						利用統計リンク表示の設定方法については<a href="./setting.html#view_UsageStatistics_link">WEKO管理 利用統計リンク表示設定</a>をご覧ください。
+						</li>
+						</br>
+						<li>利用統計機能は月末締めで行われる集計結果を元にしているため、新規登録されてから月が切り替わっていないアイテムの利用統計を表示できません。</br>
+						それらのアイテムについては以下のようなメッセージが表示されます。
+						<br/>
+						<center><img src="./img/item_detail_usagesatistics_not_exist.png" alt="利用統計表示"></center><br/>
+						<br/>
+						</li>
 					</ul>
 				</div>
 				<br/>
@@ -242,7 +253,7 @@
 						■既存登録<br/>
 						<div class="page_list">
 							サプリメンタルWEKOに登録されている既存のアイテムをサプリメンタルコンテンツとして登録します。<br/>
-							登録するアイテムのパーマリンクURLをテキストボックスに入力し、「登録」ボタンをクリックするとパーマリンク先のアイテム情報を取得します。<br/>
+							登録するアイテムのWEKO URLまたはパーマリンクURLをテキストボックスに入力し、「登録」ボタンをクリックするとパーマリンク先のアイテム情報を取得します。<br/>
 							<br/>
 							<center><img src="./img/supple_entry_popup_02.png" alt="サプリメンタルコンテンツ既存登録ポップアップ"></center><br/>
 							<br/>
@@ -250,6 +261,10 @@
 							<br/>
 							<center><img src="./img/supple_permalink.png" alt="パーマリンクURL"></center><br/>
 							<br/>
+							アイテムのWEKO URLは、アイテムリスト画面内のアイテム名にカーソルを合わし、右クリック→「リンクのURLをコピーで(A)」で取得できます。<br/>
+							<br/>
+							<center><img src="./img/supple_weko_url.png" alt="サプリメンタルコンテンツ既存登録ポップアップ"></center><br/>
+                            <br/>
 							アイテムの情報取得が正常に完了すると、サプリメンタルコンテンツとして登録されます。<br/>
 							<br/>
 							査読待の表示がある場合は他のユーザーに公開されていません。<br/>
@@ -290,7 +305,7 @@
 						</ul>
 					</div>
 				</div>
-				
+
 				<h3><a name="edit">アイテム編集</a></h3>
 				<div class="page_list">
 					アイテムの編集権限を持つ場合、「公開」ボタンまたは「非公開」ボタン、「編集」ボタン、「削除」ボタンが表示されます。<br/>
@@ -326,7 +341,7 @@
 				</div>
 				<br/>
 				<br/>
-				
+
 			</div>
 			<p align="center"><font size="2"><a href="../index.html" target="_top">WEKO Help Top</a></font></p>
 		</div>
diff --git a/repository/files/help/ja/html/item_entry.html b/repository/files/help/ja/html/item_entry.html
index bf88f84..1a2ce90 100644
--- a/repository/files/help/ja/html/item_entry.html
+++ b/repository/files/help/ja/html/item_entry.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: item_entry.html 645 2014-10-29 12:39:52Z ivis $        -->
+<!--// $Id: item_entry.html 53594 2015-05-28 05:25:53Z kaede_matsushita $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -27,6 +27,11 @@
 				<br/>
 				<center><img src="./img/item_entry_tab.png" alt="アイテム登録タブ"></center><br/>
 				<br/>
+                フロー画像の各画面名をクリックすると該当の画面にジャンプできます。<br/>
+                ただし途中の画面で未入力の必須項目がある場合はその画面に遷移します。<br/>
+                <br/>
+                <center><img src="./img/item_entry_flow.png" alt="フロー画像"></center><br/>
+                <br/>
 				<br/>
 				<h3><a name="select">アイテムタイプ選択</a></h3>
 				<div class="page_list">
@@ -212,6 +217,20 @@
 						<br/>
 					</div>
 					<br/>
+					<h4><a name="price">権限設定</a></h4>
+					<div class="page_list">
+						メタデータ属性がファイルである場合はグループごとにダウンロード権限の設定をすることができます。<br/>
+						権限が設定されていないグループのユーザーはファイルをダウンロードできません。<br/>
+						<br/>
+						「More input row」ボタンを押下すると権限を設定するグループを追加できます。<br/>
+						「削除」ボタンを押下するとその行が削除されます。<br/>
+						<br/>
+						公開方法がオープンアクセスのファイルには権限は設定できません。<br/>
+						オープンアクセス日が経過した場合は、すべてのユーザーがファイルをダウンロードできます。<br/>
+						<br/>
+						<center><img src="./img/file_auth_setting.png" alt="権限設定"></center><br/>
+						<br/>
+					</div>
 					<h4><a name="price">課金設定</a></h4>
 					<div class="page_list">
 						メタデータ属性が課金ファイルである場合はグループごとに価格の設定をすることができます。<br/>
@@ -474,7 +493,7 @@
 					<div class="page_list">
 						外部データベースから書誌情報を取得し該当項目に自動入力します。<br/>
 						<br/>
-						外部データベースは<a href="http://www.amazon.co.jp/" target="_blank">Amazon</a>, <a href="http://www.ncbi.nlm.nih.gov/sites/entrez/" target="_blank">PubMed</a>, <a href="http://ci.nii.ac.jp/" target="_blank">CiNii</a>, <a href="http://search.jamas.or.jp/" target="_blank">医中誌</a>が利用できます。<br/>
+						外部データベースは<a href="http://www.amazon.co.jp/" target="_blank">Amazon</a>, <a href="http://www.ncbi.nlm.nih.gov/sites/entrez/" target="_blank">PubMed</a>, <a href="http://ci.nii.ac.jp/" target="_blank">CiNii</a>, <a href="http://search.jamas.or.jp/" target="_blank">医中誌</a>, <a href="http://www.crossref.org/" target="_blank">CrossRef</a>が利用できます。<br/>
 						各サイトで利用可能な書誌IDを入力し、「取得」ボタンを押下すると書誌情報が取得されます。<br/>
 						取得された書誌情報は、アイテムの対応項目および対応するjunii2マッピングが設定されたメタデータ項目に自動入力されます。<br/>
 						<br/>
@@ -574,6 +593,27 @@
 									issn<br/>
 								</td>
 							</tr>
+							<tr>
+								<td>CrossRef</td>
+								<td>
+									CrossRef<br/>
+								</td>
+								<td>
+									タイトル（英）<br/>
+									著者名（英）<br/>
+									言語<br/>
+									雑誌名（英）<br/>
+									巻<br/>
+									号<br/>
+									ページ<br/>
+									発行年<br/>
+								</td>
+								<td>
+									creator<br/>
+									contributor<br/>
+									issn<br/>
+								</td>
+							</tr>
 						</table>
 						<br/>
 						<center><img src="./img/metadata_fill.png" alt="メタデータ自動入力"></center><br/>
@@ -590,6 +630,10 @@
 								医中誌は、医中誌と連携ができる場合のみメタデータ自動入力の項目に表示されます。<br/>
 								医中誌の連携については<a href="./setting.html#server_biblio">WEKO管理 書誌情報簡単登録</a>をご覧ください。
 							</li>
+							<li>
+								CrossRefは、CrossRefと連携ができる場合のみメタデータ自動入力の項目に表示されます。<br/>
+								CrossRefの連携については<a href="./setting.html#server_biblio">WEKO管理 書誌情報簡単登録</a>をご覧ください。
+							</li>
 						</ul>
 					</div>
 					<h4><a name="contributor">代理投稿機能</a></h4>
@@ -734,7 +778,7 @@
 						DOIの取扱は十分注意して行ってください。<br/>
 						<ul>
 							<li>アイテム登録時にIDサーバー(http://id.nii.ac.jp/)のSuffixが付与される状態となっている</li>
-							<li>「JaLC」または「CrossRef」のプレフィックスがWEKOの管理画面にて登録されている</li>
+							<li>「JaLC」または「CrossRef」または「DataCite」のプレフィックスがWEKOの管理画面にて登録されている</li>
 							<li>削除されたアイテムではなく、公開されているアイテムである</li>
 							<li>ハーベストが許可(公開)されている</li>
 							<li>OAI-PMHのJuNii2形式でメタデータを出力することができる</li>
diff --git a/repository/files/help/ja/html/item_setting.html b/repository/files/help/ja/html/item_setting.html
index 1271637..8be870e 100644
--- a/repository/files/help/ja/html/item_setting.html
+++ b/repository/files/help/ja/html/item_setting.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: item_setting.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: item_setting.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -70,13 +70,41 @@
 			<h3>一括削除</h3>
 			<div class="page_list">
 				<a name="listdelete"></a>
+				アイテムを一括削除することができます。<br/>
+				選択したインデックスに属するアイテムを一括削除する方法とキーワード検索で条件に一致したアイテムを選択して一括削除する方法の2通りがあります。<br/>
+				<br/>
+				「一括削除」タブをクリックすると左側にキーワード検索欄とインデックスツリーが表示されます。<br/>
+				<br/>
+				<br/>
+				<center><img src="./img/item_setting_bulk_deletion.png" alt="一括削除タブ" border="0" /></center><br/>
+				<br/>
+				
+				<h4>キーワード検索から一括削除</h4>
+				キーワード検索で条件に一致したアイテムを選択して一括削除することができます。<br/>
+				<br/>
+				「キーワード検索」と「全文検索」どちらかの検索方法を選択します。<br/>
+				キーワードを入力して「検索」ボタンをクリックすると、検索条件に一致したアイテムの一覧が表示されます。<br/>
+				削除したいアイテムのチェックボックスを選択します。<br/>
+				　※表のヘッダーにあるチェックボックスにチェックを入れると表示されているチェックボックス全てが選択されます。<br/>
+				「アイテムを削除」ボタンをクリックすると、アイテムの一括削除が実行されます。<br/>
+				<br/>
+				<center><img src="./img/item_setting_bulk_deletion_keyword_01.png" alt="検索削除_設定" border="0" /></center><br/>
+				<br/>
+				
+				一括削除を実行すると削除した件数が表示されます。<br/>
+				検索条件に一致するアイテムで削除されていないものがあれば表示されます。<br/>
+				<br/>
+				<center><img src="./img/item_setting_bulk_deletion_keyword_02.png" alt="検索削除_実行後" border="0" /></center><br/>
+				<br/>
+				
+				<h4>インデックスから一括削除</h4>
 				インデックスに属するアイテムを一括削除することができます。<br/>
 				<br/>
-				「一括削除」タブをクリックし、「インデックスツリー」からアイテムを一括削除するインデックスを選択します。<br/>
+				「インデックスツリー」からアイテムを一括削除するインデックスを選択します。<br/>
 				「サブインデックスのアイテムも削除する」にチェックが付いている場合、再帰的に子インデックスに所属するアイテムも削除されます。<br/>
 				「アイテムを削除」ボタンをクリックすると、アイテムの一括削除が実行されます。<br/>
 				<br/>
-				<center><img src="./img/item_setting_06.png" alt="一括削除" border="0" /></center><br/>
+				<center><img src="./img/item_setting_bulk_deletion_index.png" alt="一括削除" border="0" /></center><br/>
 				<br/>
 			</div>
 			
@@ -87,11 +115,11 @@
 				<br/>
 				「DOI一括付与」タブをクリックし、「インデックスツリー」からDOI一括付与を行うインデックスを選択します。<br/>
 				 選択したインデックスの直下に配置されているアイテムのうち、DOIを付与できるアイテムの一覧が表示されます。<br/>
-				 DOIを付与したいアイテムのチェックボックスをONにし、「実行」ボタンを押下するとDOIが一括付与されます。<br/>
+				 DOIを付与したいアイテムのチェックボックスをONにし、「DOI付与」ボタンを押下するとDOIが一括付与されます。<br/>
 				<br/>
 				<center><img src="./img/item_setting_DOI_add.png" alt="DOI一括付与" width="600" border="0" /></center><br/>
 				<br/>
-				すべてにチェックを入れる場合は、下部のプルダウンメニューから実行することができます。<br/>
+				すべてにチェックを入れる場合は、DOI名下部のチェックボックスから実行することができます。<br/>
 				<br/>
 				<center><img src="./img/item_setting_DOI_check.png" alt="DOI一括付与" width="600" border="0" /></center><br/>
 				<br/>
diff --git a/repository/files/help/ja/html/itemtype_mapping.html b/repository/files/help/ja/html/itemtype_mapping.html
index d0fb180..0782905 100644
--- a/repository/files/help/ja/html/itemtype_mapping.html
+++ b/repository/files/help/ja/html/itemtype_mapping.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: itemtype_mapping.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: itemtype_mapping.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -1346,6 +1346,7 @@
 					<center><img src="./img/itemtype_mapping_04.png" alt="NIIType設定" border="0"/></center>
 					<br/>
 					各メタデータ属性にDublin CoreおよびJuNii2、Learning Object Matadata、LIDOの語彙を関連付けることができます。<br/>
+					Dublin Core以外のマッピング及び表示言語はセレクトボックスで内容を切り替えることができます。<br/>
 					セレクトボックスからDublin CoreまたはJuNii2、Learning Object Matadata、LIDOの語彙を選択すると、選択した語彙と関連付けされます。<br/>
 					ただし、メタデータ属性が書誌情報の場合Dublin CoreおよびJuNii2、Learning Object Matadata、LIDOの語彙が固定されており、変更や削除はできません。<br/>
 					<br/>
diff --git a/repository/files/help/ja/html/itemtype_metadata.html b/repository/files/help/ja/html/itemtype_metadata.html
index defdb80..470798f 100644
--- a/repository/files/help/ja/html/itemtype_metadata.html
+++ b/repository/files/help/ja/html/itemtype_metadata.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: itemtype_metadata.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: itemtype_metadata.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -1304,6 +1304,19 @@
 							<li>削除したアイテムタイプに属するアイテムは引き続き利用することができます。</li>
 						</ul>
 					</div>
+					<h4>アイテムタイプ権限設定</h4>
+					<div class="page_list">
+						指定したアイテムタイプの権限を設定する事が出来ます。<br/>
+						テキストエリアからユーザー権限を選択し、矢印ボタンで権限を変更し、「送信」ボタンをクリックするとアイテムタイプの権限が設定されます。<br/>
+						<br/>
+						<center><img src="./img/itemtype_authority_01.png" alt="アイテムタイプ権限設定" border="0"/></center>
+						<br/>
+						<br/>
+						【注意事項】
+						<ul>
+							<li>一部のアイテムタイプは権限を変更するすることはできません。</li>
+						</ul>
+					</div>
 				</div>
 				<br/>
 				<a name="itemtype_metadata"><h3>アイテムタイプメタデータ編集</h3></a>
diff --git a/repository/files/help/ja/html/log.html b/repository/files/help/ja/html/log.html
index fc401e8..85cef02 100644
--- a/repository/files/help/ja/html/log.html
+++ b/repository/files/help/ja/html/log.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: log.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: log.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -23,6 +23,9 @@
 			<div class="page_list">
 				「ログ解析」タブをクリックするとログ解析画面が表示されます。<br/>
 				ログの集計、解析を行い、その結果を表示またはダウンロードすることができます。<br/>
+				<a href="./setting.html#run_log">管理画面</a>にて除外対象に設定されているアドレスなどを除いて集計されます。<br/>
+				また、30秒以内に同一ユーザが同じ操作をした場合、集計から除外されます。
+				<br/>
 				<br/>
 				<center><img src="./img/log_01.png" alt="定型レポート" border="0"/></center><br/>
 				<br/>
@@ -36,29 +39,121 @@
 				<h3><a name="report">定型レポート</a></h3>
 				<div class="page_list">
 					指定した期間の定型レポートをTSV(タブ区切りテキスト)形式でダウンロードすることができます。<br/>
-					定型レポートは下記4種類です。<br/>
+					定型レポートは下記10種類です。<br/>
 					<br/>
-					<table class="table_border" border="0" alt="Downloadクリック" align="center" cellspacing="0">
+					<table class="table_border" border="0" alt="Downloadクリック" align="center" cellspacing="0" style="border-collapse: collapse" cellpadding="5">
 						<tr>
 							<th nowrap>ファイル名</th>
 							<th nowrap>ログ内容</th>
 						</tr>
 						<tr>
 							<td>logReport_IndexAccess_YYYYMM.tsv</td>
-							<td>各インデックスに所属するアイテムのアイテム詳細画面アクセス数</td>
+							<td>
+								各インデックスに所属するアイテムのアイテム詳細画面アクセス数を表示します</br>
+								インデックス名はツリー構造を&yen;区切りで表示します
+								</br>
+								</br>
+								<img src="./img/log_18.png" alt="インデックスごとの詳細画面アクセス数" border="0"/>
+							</td>
 						</tr>
 						<tr>
 							<td>logReport_PayPerView_YYYYMM.tsv</td>
-							<td>課金およびオープンアクセスファイルのダウンロード数</td>
+							<td>
+								課金およびオープンアクセスファイルのダウンロード数を表示します<br/>
+								また、NetCommonsの各グループ毎のファイルダウンロード数を表示します
+								</br>
+								</br>
+								<img style="width:100%" src="./img/log_19.png" alt="課金ファイルダウンロード数" border="0"/>
+							</td>
 						</tr>
 						<tr>
-							<td>logReport_SiteAccess_YYYYMM.tsv</td>
-							<td>サイトライセンスを設定しているホストからのアクセスとサイトライセンス以外からのアクセス数</td>
+							<td>logReport_SearchCount_YYYYMM.tsv</td>
+							<td>
+								各検索キーワードの検索回数を表示します<br/>
+								下記にあたる詳細カテゴリーの検索キーワードのみを表示します<br/>
+								<ul>
+									<li>タイトル</li>
+									<li>著者 OR 著者ID</li>
+									<li>キーワード</li>
+									<li>抄録・内容記述</li>
+									<li>公開者 OR 著者ID</li>
+									<li>寄与者 OR 著者ID</li>
+									<li>雑誌名</li>
+								</ul>
+								<img src="./img/log_20.png" alt="検索キーワードランキング" border="0"/>
+							</td>
 						</tr>
 						<tr>
-							<td>logReport_SuppleAccess_YYYYMM.tsv</td>
-							<td>サプリメンタルコンテンツアクセス数およびダウンロード数</td>
+							<td>logReport_SiteAccess_YYYYMM.tsv</td>
+							<td>
+								サイトライセンスを設定しているホストまたはユーザとサイトライセンス以外からの下記アクセス数を表示します
+								<ul>
+									<li>キーワード検索</li>
+									<li>アイテム詳細画面</li>
+									<li>ファイルダウンロード</li>
+								</ul>
+								<img src="./img/log_21.png" alt="サイトライセンス別アクセス数" border="0"/>
+							</td>
 						</tr>
+                        <tr>
+                            <td>logReport_SuppleAccess_YYYYMM.tsv</td>
+                            <td>
+                            	サプリメンタルコンテンツアクセス数およびダウンロード数を表示します<br/>
+                            	本レポートに記載されているサプリメンタルコンテンツの詳細画面アクセス数およびダウンロード数はサプリWEKOでのアイテム詳細画面アクセス数とダウンロード数となります
+								</br>
+								</br>
+								<img src="./img/log_22.png" alt="サプリメンタルコンテンツアクセス数およびダウンロード数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_DetailView_YYYYMM.tsv</td>
+                            <td>
+                            	アイテム詳細画面のアクセス数を表示します<br/>
+								また、NetCommonsの各グループ毎のアイテム詳細画面のアクセス数を表示します
+								</br>
+								</br>
+								<img src="./img/log_14.png" alt="詳細画面閲覧数" border="0"/>
+							</td>
+                        </tr>
+                        <tr>
+                            <td>logReport_FileView_YYYYMM.tsv</td>
+                            <td>
+                            	オープンアクセスおよびオープンアクセスでないファイルのダウンロード数をインデックスごとに表示します<br/>
+                            	また、ユーザの所属グループ、未ログイン、管理者およびアイテムの登録者毎のダウンロード数の内訳を表示します
+								</br>
+								</br>
+								<img style="width:100%;" src="./img/log_15.png" alt="ファイルダウンロード数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_FileViewPerUser_YYYYMM.tsv</td>
+                            <td>
+                            	ユーザー別のダウンロード数を表示します<br/>
+                            	また、各ユーザのログインID、ハンドル名、会員氏名、NC2の権限、所属している全グループも表示します
+								</br>
+								</br>
+								<img src="./img/log_16.png" alt="ユーザ別ダウンロード数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_HostAccess_YYYYMM.tsv</td>
+                            <td>
+                            	ホスト別のトップページアクセス数を表示します
+								</br>
+								</br>
+								<img src="./img/log_17.png" alt="ホスト別アクセス数" border="0"/>
+                            </td>
+                        </tr>
+                        <tr>
+                            <td>logReport_UserAffiliate_YYYYMM.tsv</td>
+                            <td>
+                            	権限別の登録ユーザ数を表示します<br/>
+                            	また、研究会(NetCommonsのグループ)に所属しているユーザを表示します
+								</br>
+								</br>
+								<img src="./img/log_23.png" alt="ユーザ所属情報" border="0"/>
+                            </td>
+                        </tr>
 					</table>
 					<br/>
 					集計年月をセレクトボックスから指定し、「Download」リンクをクリックします。<br/>
@@ -69,10 +164,10 @@
 					<br/>
 					【注意事項】
 					<ul>
-						<li>定型レポートでダウンロードできるファイルは、4種類のTSV(タブ区切りテキスト)形式ファイルを圧縮したZIPアーカイブとなります。</li>
+						<li>定型レポートでダウンロードできるファイルは、10種類のTSV(タブ区切りテキスト)形式ファイルを圧縮したZIPアーカイブとなります。</li>
 					</ul>
 				</div>
-				<h4>定型レポート メール送信</h4>
+				<h4><a name="sendmail">定型レポート メール送信</h4>
 				<div class="page_list">
 					指定した期間の定型レポートを登録したメールアドレスで受信することができます。<br/>
 					<br/>
@@ -85,7 +180,7 @@
 					<center><img src="./img/log_04.png" alt="定型レポート メール送信" border="0"/></center><br/>
 					<br/>
 				</div>
-				<h3>カスタムレポート</h3>
+				<h3><a name="custom">カスタムレポート</h3>
 				<div class="page_list">
 					下記3種類のデータを指定した期間のログから集計することができます。<br/>
 					また、集計データを「日」「週」「月」「年」「アイテム」「ホスト」ごとに区切ったヒストグラムで表示またはダウンロードすることができます。<br/>
@@ -118,6 +213,14 @@
 					<br/>
 					<center><img src="./img/log_12.png" alt="Downloadクリック" border="0"/></center><br/>
 					<br/>
+					ダウンロード回数および閲覧回数にて、単位に「ホスト」を指定して表示すると下記のようになります<br/>
+					解析から除外したいアクセスを選択することができます。<br/>
+					<br/>
+					<center><img src="./img/log_13.png" alt="ホスト別カスタムレポート" border="0"/></center><br/>
+					<br/>
+					【注意事項】<br/>
+					解析から除外したいアクセスを設定した後、<a href="./setting.html#run_log">管理画面</a>にてログ削除の実行を実施する必要があります。<br/>
+					実行方法については<a href="./setting.html#run_log">WEKO管理</a>をご覧ください。
 				</div>
 				<h3>ログ削除</h3>
 				<div class="page_list">
diff --git a/repository/files/help/ja/html/privatetree_edit.html b/repository/files/help/ja/html/privatetree_edit.html
index ba48599..7c3338c 100644
--- a/repository/files/help/ja/html/privatetree_edit.html
+++ b/repository/files/help/ja/html/privatetree_edit.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: privatetree_edit.html 564 2014-04-14 01:06:48Z ivis $          -->
+<!--// $Id: privatetree_edit.html 18555 2012-07-12 03:39:15Z tatsuya_koyasu $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/ranking.html b/repository/files/help/ja/html/ranking.html
index bf735f3..492f3b1 100644
--- a/repository/files/help/ja/html/ranking.html
+++ b/repository/files/help/ja/html/ranking.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: ranking.html 516 2012-05-22 09:30:55Z ivis $        -->
+<!--// $Id: ranking.html 15639 2012-02-21 07:22:35Z ayumi_jin $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/review.html b/repository/files/help/ja/html/review.html
index 228cf65..8571e43 100644
--- a/repository/files/help/ja/html/review.html
+++ b/repository/files/help/ja/html/review.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: review.html 469 2011-03-24 02:35:39Z ivis $          -->
+<!--// $Id: review.html 6453 2011-03-17 03:05:05Z hisaya_ito $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/search.html b/repository/files/help/ja/html/search.html
index 109a3d6..05ab86b 100644
--- a/repository/files/help/ja/html/search.html
+++ b/repository/files/help/ja/html/search.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: search.html 599 2014-07-14 09:06:17Z ivis $        -->
+<!--// $Id: search.html 36553 2014-05-30 11:01:40Z tomohiro_ichikawa $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/setting.html b/repository/files/help/ja/html/setting.html
index 1fcd72e..d450a88 100644
--- a/repository/files/help/ja/html/setting.html
+++ b/repository/files/help/ja/html/setting.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: setting.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: setting.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -30,15 +30,18 @@
 				</ul>
 				<h3><a name="view">表示設定</a></h3>
 				<div class="page_list">
-					「表示設定」では下記6項目を設定することができます。<br/>
+					「表示設定」では下記10項目を設定することができます。<br/>
 					<ul>
 						<li><a href="#view_first_setting">初期表示設定</a></li>
 						<li><a href="#view_language">言語表示設定</a></li>
 						<li><a href="#view_unit_money">通貨単位設定</a></li>
-						<li><a href="#simple_list">インデックス一覧表示設定</a></li>
+						<li><a href="#simple_list">インデックスリンク表示設定</a></li>
 						<li><a href="#view_ranking">ランキング管理</a></li>
+						<li><a href="#default_search_setting">検索設定</a></li>
 						<li><a href="#view_detail_search">詳細検索条件設定</a></li>
 						<li><a href="#view_search">検索結果表示設定</a></li>
+						<li><a href="#view_icon">アイコン表示設定</a></li>
+						<li><a href="#view_UsageStatistics_link">利用統計リンク表示設定</a></li>
 					</ul>
 					「管理」タブを選択し、「表示設定」タブを選択すると表示設定画面が表示されます。<br/>
 					設定変更後は「適用」ボタンを押下し、変更を反映してください。<br/>
@@ -175,7 +178,7 @@
 						<center><img src="./img/setting_17.png" alt="通貨単位設定" border="0"/></center>
 						<br/>
 					</div>
-					<h4><a name="simple_list">インデックス一覧表示</a></h4>
+					<h4><a name="simple_list">インデックスリンク表示</a></h4>
 					<div class="page_list">
 						トップページのインデックス簡易アクセスUI表示を設定することができます。<br/>
 						設定するインデックス簡易アクセスUIはトップページの左側となります。
@@ -212,12 +215,21 @@
 									セレクトボックスから「DB保存情報を表示する」を選択すると、DBに登録されているランキング情報を利用したランキングが表示される<br/>
 								</td>
 							</tr>
+							
 							<tr>
-								<td nowrap>新規登録期間</td>
+								<td nowrap>ランキング表示設定</td>
 								<td>
 									登録アイテムを新着アイテムとして扱う期間を設定する<br/>
 								</td>
 							</tr>
+							
+							<tr>
+								<td nowrap>新規登録期間</td>
+								<td>
+									ランキングタブの表示／非表示を設定する<br/>
+									「表示する」を選択するとWEKOのトップページにランキングタブが表示される<br/>
+								</td>
+							</tr>
 							<tr>
 								<td nowrap>統計期間</td>
 								<td>
@@ -247,6 +259,19 @@
 							<li>新規登録期間に設定できる日数は「1日」からとなります。</li>
 						</ul>
 					</div>
+					
+					<h4><a name="default_search_setting">検索設定</a></h4>
+					<div class="page_list">
+						WEKOの簡易検索および詳細検索のデフォルトの検索タイプを「全文検索」または「キーワード検索」のどちらかに設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_default_search_setting.png" alt="検索設定" border="0"/></center>
+						<br/>
+						下記のように設定した値がトップページの検索画面に反映されます。<br/>
+						<br/>
+						<center><img src="./img/setting_top_seartch_type.png" alt="トップページの検索タイプ設定" border="0"/></center>
+						<br/>
+					</div>
+					
 					<h4><a name="view_detail_search">詳細検索条件設定</a></h4>
 					<div class="page_list">
 						使用可能な詳細検索条件およびデフォルトで表示する詳細検索条件について設定することができます。<br/>
@@ -297,6 +322,33 @@
 						</table>
 						<br/>
 					</div>
+					
+					<h4><a name="view_icon">アイコン表示設定</a></h4>
+					<div class="page_list">
+						トップページのヘルプアイコンとOAI-OREアイコンの表示／非表示を設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_display_icon_setting.png" alt="アイコン表示設定" border="0"/></center>
+						<br/>
+						どちらも「表示する」を選択した場合、トップページ画面は以下のようになります。<br/>
+						<br/>
+						<center><img src="./img/setting_display_icon_top.png" alt="アイコン表示トップ画面" border="0"/></center>
+						<br/>
+					</div>
+					
+					
+					
+					<h4><a name="view_UsageStatistics_link">利用統計リンク表示設定</a></h4>
+					<div class="page_list">
+						アイテム詳細画面に利用統計リンクを表示するかしないかを設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_usagestatistics_link.png" alt="利用統計リンク表示設定" border="0"/></center>
+						<br/>
+						「表示する」を選択した場合、アイテム詳細画面は以下のようになります。<br/>
+						<br/>
+						<center><img src="./img/setting_detail_usagestatistics_link.png" alt="利用統計リンク表示設定" border="0"/></center>
+						<br/>
+					</div>
+					
 				</div>
 				<h3><a name="run">運用設定</a></h3>
 				<div class="page_list">
@@ -388,10 +440,51 @@
 					</div>
 					<h4><a name="run_log">ログ解析管理</a></h4>
 					<div class="page_list">
+						<a name="exclude_log">■除外対象のログ削除</a><br/>
+						除外対象アドレスおよび共用クローラーリストから、指定されたIPアドレス、ユーザエージェントを持つアクセスログを削除します。<br/>
+						除外されるアクセスログは画面上で設定したIPアドレスおよび共用クローラーリストに<br/>
+						記載されているIPアドレスを持つアクセスログと、共用クローラーリストに記載されている<br/>
+						文字列に部分一致するユーザエージェントを持つアクセスログです。<br/>
+						<br/>
+						<center><img src="./img/setting_102.png" alt="ログ除外実行" border="0"/></center>
+						<br/>
+						【注意事項】
+						<ul>
+							<li><b style="color:#FF0000">アクセスログは物理削除となります</b></li>
+							<li><b style="color:#FF0000">設定後、設定されたIPアドレスおよび共用クローラーリストにて指定されたIPアドレスとユーザエージェントを持つアクセスはアクセスログに保存されなくなります</b></li>
+						</ul>
+						<br/>
+						除外対象のログを削除している間はログ集計を実施できません。<br/>
+						除外処理終了後、ログの集計が実施できるようになります。<br/>
+						影響を受ける集計結果を下記に記載いたします。
+						<ul>
+							<li>ランキング</li>
+							<li>利用統計</li>
+							<li>サイトライセンスフィードバックメール送信</li>
+							<li>利用統計フィードバックメール送信</li>
+							<li>定型レポート</li>
+							<li>カスタムレポート</li>
+						</ul>
+						<br/>
+						<a name="set_ipaddress">■除外対象アドレス</a><br/>
 						ログ解析から除外するIPアドレスを指定することができます。<br/>
 						<br/>
 						<center><img src="./img/setting_69.png" alt="ログ解析管理" border="0"/></center>
 						<br/>
+						<br/>
+						<a name="shared_crawler_list">■共用クローラーリスト</a><br/>
+						ログ解析から除外するIPアドレス、ユーザエージェントの部分一致キーワードリストを定義し、ネットワークを介して取得、設定することができます。<br/>
+						共用クローラーリストはNIIから提供されます。<br/>
+						表示されるバージョンなどは現在取り込んでいるクローラーリストの情報となります。<br/>
+						<br/>
+						<center><img src="./img/setting_103.png" alt="共用クローラーリスト" border="0"/></center>
+						<br/>
+						【注意事項】
+						<ul>
+							<li><b style="color:#FF0000">共用クローラーリストを無効にしても削除されたアクセスログは復活しません</b></li>
+							<li>有効に変更しログ削除実施後、指定されたIPアドレスおよび共用クローラーリストにて指定されているIPアドレスおよびユーザエージェントと部分一致するアクセスはログに保存されなくなります</li>
+						</ul>
+						<br/>
 					</div>
 					<h4><a name="run_license">サイトライセンス認可</a></h4>
 					<div class="page_list">
@@ -663,19 +756,42 @@
 						■PrefixID(<a href="http://japanlinkcenter.org/jalc/" target="_blank">JaLC DOI</a>)
 						<br/>
 						JaLC DOIハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC DOIのPrefix設定欄を表示するには、repository/config/define.inc.phpの_REPOSITORY_JALC_DOIをtrueにする必要があります。<br/>
 						<br/>
 						<center><img src="./img/setting_41.png" alt="" border="0"/></center>
 						<br/>
 						
 						<br/>
-						■PrefixID(<a href="http://www.crossref.org/" target="_blank">Cross Ref</a>)
+						■PrefixID(<a href="http://www.crossref.org/" target="_blank">JaLC CrossRef DOI</a>)
 						<br/>
-						Cross RefハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC CrossRef DOIハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC CrossRef DOIのPrefix設定欄を表示するには、repository/config/define.inc.phpの_REPOSITORY_JALC_CROSSREF_DOIをtrueにする必要があります。<br/>
 						<br/>
 						<center><img src="./img/setting_42.png" alt="" border="0"/></center>
 						<br/>
 						
 						<br/>
+						■PrefixID(<a href="https://www.datacite.org/" target="_blank">JaLC DataCite DOI</a>)
+						<br/>
+						JaLC DataCite DOIハンドルサーバのPrefixIDを設定することができます。<br/>
+						JaLC DataCite DOIのPrefix設定欄を表示するには、repository/config/define.inc.phpの_REPOSITORY_JALC_DATACITE_DOIをtrueにする必要があります。<br/>
+						<br/>
+						<center><img src="./img/setting_101.png" alt="" border="0"/></center>
+						<br/>
+						
+						<br/>
+						■機関内部ID
+						<br/>
+						複数のWEKOを所有する機関において、DOIの値が重複することを防ぐため、 下記のようにPrefixID(http://id.nii.ac.jp/)をSuffixに付加するか設定することができます。<br/>
+						<br/>
+						<center><img src="./img/setting_100.png" alt="" border="0"/></center>
+						<br/>
+						<font color="#f00">DOIが付与されたアイテムをすでに登録している場合、設定を変更することはできません。</font><br/>
+						<br/>
+						<center><img src="./img/setting_99.png" alt="" border="0"/></center>
+						<br/>
+						
+						<br/>
 						■PrefixID(<a href="http://www.cnri.reston.va.us/" target="_blank">CNRIハンドル</a>)
 						<br/>
 						CNRIハンドルサーバのPrefixIDを設定することができます。<br/>
@@ -739,6 +855,20 @@
 							<li>医中誌へ連携しない場合、及び「現在の連携状態」が未認証状態の場合、医中誌のfill機能が利用できなくなります。</li>
 							<li>医中誌へのIP認証が通っている場合、ログインID・ログインパスワードの設定は必要ありません。</li>
 						</ul>
+						<br/>
+						<br/>
+						■CrossRef Query Services Account
+						<br/>
+						アイテム登録時のfill機能において利用しているCrossRefの「CrossRef Query Services Account」を変更することができます。<br/>
+						「CrossRef Query Services Account」は、CrossRef連携に利用する登録アカウントです。 <br/>
+						<br/>
+						<center><img src="./img/setting_crossref_account.png" alt="CrossRefQueryServicesAccount" border="0"/></center>
+						<br/>
+						<br/>
+						【注意事項】
+						<ul>
+							<li>「CrossRef Query Services Account」が空白の場合、CrossRefのfill機能が利用できなくなります。</li>
+						</ul>
 					</div>
 					<h4><a name="server_OAIPMH">OAI-PMH設定</a></h4>
 					<div class="page_list">
diff --git a/repository/files/help/ja/html/top.html b/repository/files/help/ja/html/top.html
index a986cb5..6494056 100644
--- a/repository/files/help/ja/html/top.html
+++ b/repository/files/help/ja/html/top.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: top.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: top.html 32710 2014-03-11 09:28:04Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/tree_edit.html b/repository/files/help/ja/html/tree_edit.html
index a0359fb..82064da 100644
--- a/repository/files/help/ja/html/tree_edit.html
+++ b/repository/files/help/ja/html/tree_edit.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: tree_edit.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: tree_edit.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -179,7 +179,7 @@
 						投稿権限についての詳細は<a href="http://www.netcommons.org/nc20/nc20_manual/japanese/admin_manual/chapter3.html#3">NetCommonsのヘルプ</a>をご参照下さい。</li>
 					</ul>
 				</div>
-				<h3>移動</h3>
+				<h3>移動<a name="move"></h3>
 				<div class="page_list">
 					インデックスのドラッグ&ドロップでインデックスを移動することができます。<br/>
 					インデックスの移動では子インデックスも一緒に移動されます。<br/>
@@ -187,7 +187,19 @@
 					<center><img src="./img/tree_edit_43.png" alt="インデックス移動" border="0"/></center>
 					<br/>
 				</div>
-				<h3>削除</h3>
+				<h3>コピー<a name="copy"></h3>
+				<div class="page_list">
+					コントロールキーを押下しながら、インデックスのドラッグ&ドロップでインデックスをコピーすることができます。<br/>
+					インデックスのコピーでは設定および子インデックスも一緒にコピーされます。<br/>
+					<br/>
+					<center><img src="./img/tree_edit_44.png" alt="インデックスコピー" border="0"/></center>
+					<br/>
+					【注意事項】
+					<ul>
+						<li>インデックスに所属するアイテムはコピーされません。</li>
+					</ul>
+				</div>
+				<h3>削除<a name="delete"></h3>
 				<div class="page_list">
 					インデックスを削除することができます。<br/>
 					任意のインデックスをクリックして選択し、「削除」をクリックすると任意のインデックスが削除されます。<br/>
diff --git a/repository/files/help/ja/html/workflow.html b/repository/files/help/ja/html/workflow.html
index 9bfdb86..b169a16 100644
--- a/repository/files/help/ja/html/workflow.html
+++ b/repository/files/help/ja/html/workflow.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: workflow.html 469 2011-03-24 02:35:39Z ivis $        -->
+<!--// $Id: workflow.html 6453 2011-03-17 03:05:05Z hisaya_ito $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/html/workflow_supple.html b/repository/files/help/ja/html/workflow_supple.html
index fbb008b..9705a6d 100644
--- a/repository/files/help/ja/html/workflow_supple.html
+++ b/repository/files/help/ja/html/workflow_supple.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: workflow_supple.html 469 2011-03-24 02:35:39Z ivis $        -->
+<!--// $Id: workflow_supple.html 6453 2011-03-17 03:05:05Z hisaya_ito $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/files/help/ja/index.html b/repository/files/help/ja/index.html
index 809a342..54491fb 100644
--- a/repository/files/help/ja/index.html
+++ b/repository/files/help/ja/index.html
@@ -1,7 +1,7 @@
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN">
 <html>
 <head>
-  <title>WEKO HELP ver2.1.5</title>
+  <title>WEKO HELP ver2.2.0</title>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
 </head>
 
diff --git a/repository/files/images/blue/btn_next.gif b/repository/files/images/blue/btn_next.gif
index fc1a548..fd5f24c 100644
Binary files a/repository/files/images/blue/btn_next.gif and b/repository/files/images/blue/btn_next.gif differ
diff --git a/repository/files/images/blue/btn_next_hover.gif b/repository/files/images/blue/btn_next_hover.gif
index 7a6feaa..6bbe631 100644
Binary files a/repository/files/images/blue/btn_next_hover.gif and b/repository/files/images/blue/btn_next_hover.gif differ
diff --git a/repository/files/images/blue/item_select_type_doi_1.png b/repository/files/images/blue/item_select_type_doi_1.png
index 361fa8e..d93281c 100644
Binary files a/repository/files/images/blue/item_select_type_doi_1.png and b/repository/files/images/blue/item_select_type_doi_1.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_1_eng.png b/repository/files/images/blue/item_select_type_doi_1_eng.png
index 176f1a5..076dd70 100644
Binary files a/repository/files/images/blue/item_select_type_doi_1_eng.png and b/repository/files/images/blue/item_select_type_doi_1_eng.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_2.png b/repository/files/images/blue/item_select_type_doi_2.png
index a375623..a0a8daf 100644
Binary files a/repository/files/images/blue/item_select_type_doi_2.png and b/repository/files/images/blue/item_select_type_doi_2.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_2_eng.png b/repository/files/images/blue/item_select_type_doi_2_eng.png
index cbaee35..e7cb010 100644
Binary files a/repository/files/images/blue/item_select_type_doi_2_eng.png and b/repository/files/images/blue/item_select_type_doi_2_eng.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_3.png b/repository/files/images/blue/item_select_type_doi_3.png
index 612976d..d721b40 100644
Binary files a/repository/files/images/blue/item_select_type_doi_3.png and b/repository/files/images/blue/item_select_type_doi_3.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_3_eng.png b/repository/files/images/blue/item_select_type_doi_3_eng.png
index e0474dc..39cb811 100644
Binary files a/repository/files/images/blue/item_select_type_doi_3_eng.png and b/repository/files/images/blue/item_select_type_doi_3_eng.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_4.png b/repository/files/images/blue/item_select_type_doi_4.png
index 216b786..6bc8777 100644
Binary files a/repository/files/images/blue/item_select_type_doi_4.png and b/repository/files/images/blue/item_select_type_doi_4.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_4_eng.png b/repository/files/images/blue/item_select_type_doi_4_eng.png
index 17765d5..c75cc67 100644
Binary files a/repository/files/images/blue/item_select_type_doi_4_eng.png and b/repository/files/images/blue/item_select_type_doi_4_eng.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_5.png b/repository/files/images/blue/item_select_type_doi_5.png
index 81f7c5e..9cbdba3 100644
Binary files a/repository/files/images/blue/item_select_type_doi_5.png and b/repository/files/images/blue/item_select_type_doi_5.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_5_eng.png b/repository/files/images/blue/item_select_type_doi_5_eng.png
index c87198e..6c9c0e1 100644
Binary files a/repository/files/images/blue/item_select_type_doi_5_eng.png and b/repository/files/images/blue/item_select_type_doi_5_eng.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_6.png b/repository/files/images/blue/item_select_type_doi_6.png
index 6354f92..5847e3e 100644
Binary files a/repository/files/images/blue/item_select_type_doi_6.png and b/repository/files/images/blue/item_select_type_doi_6.png differ
diff --git a/repository/files/images/blue/item_select_type_doi_6_eng.png b/repository/files/images/blue/item_select_type_doi_6_eng.png
index 9ead9b0..f8e267c 100644
Binary files a/repository/files/images/blue/item_select_type_doi_6_eng.png and b/repository/files/images/blue/item_select_type_doi_6_eng.png differ
diff --git a/repository/files/images/default/btn_next.gif b/repository/files/images/default/btn_next.gif
index 3ba1d4b..566c8db 100644
Binary files a/repository/files/images/default/btn_next.gif and b/repository/files/images/default/btn_next.gif differ
diff --git a/repository/files/images/default/btn_next_hover.gif b/repository/files/images/default/btn_next_hover.gif
index 9a25630..801c212 100644
Binary files a/repository/files/images/default/btn_next_hover.gif and b/repository/files/images/default/btn_next_hover.gif differ
diff --git a/repository/files/images/default/item_select_type_doi_1.png b/repository/files/images/default/item_select_type_doi_1.png
index 3e328f3..4d971c5 100644
Binary files a/repository/files/images/default/item_select_type_doi_1.png and b/repository/files/images/default/item_select_type_doi_1.png differ
diff --git a/repository/files/images/default/item_select_type_doi_1_eng.png b/repository/files/images/default/item_select_type_doi_1_eng.png
index fd2777a..fac85a0 100644
Binary files a/repository/files/images/default/item_select_type_doi_1_eng.png and b/repository/files/images/default/item_select_type_doi_1_eng.png differ
diff --git a/repository/files/images/default/item_select_type_doi_2.png b/repository/files/images/default/item_select_type_doi_2.png
index 06aa1a9..718cd9e 100644
Binary files a/repository/files/images/default/item_select_type_doi_2.png and b/repository/files/images/default/item_select_type_doi_2.png differ
diff --git a/repository/files/images/default/item_select_type_doi_2_eng.png b/repository/files/images/default/item_select_type_doi_2_eng.png
index 2a6a691..fa0734f 100644
Binary files a/repository/files/images/default/item_select_type_doi_2_eng.png and b/repository/files/images/default/item_select_type_doi_2_eng.png differ
diff --git a/repository/files/images/default/item_select_type_doi_3.png b/repository/files/images/default/item_select_type_doi_3.png
index 240585d..6a6c5cd 100644
Binary files a/repository/files/images/default/item_select_type_doi_3.png and b/repository/files/images/default/item_select_type_doi_3.png differ
diff --git a/repository/files/images/default/item_select_type_doi_3_eng.png b/repository/files/images/default/item_select_type_doi_3_eng.png
index 6ee2f6c..aad47be 100644
Binary files a/repository/files/images/default/item_select_type_doi_3_eng.png and b/repository/files/images/default/item_select_type_doi_3_eng.png differ
diff --git a/repository/files/images/default/item_select_type_doi_4.png b/repository/files/images/default/item_select_type_doi_4.png
index 9dbc32c..7607b79 100644
Binary files a/repository/files/images/default/item_select_type_doi_4.png and b/repository/files/images/default/item_select_type_doi_4.png differ
diff --git a/repository/files/images/default/item_select_type_doi_4_eng.png b/repository/files/images/default/item_select_type_doi_4_eng.png
index 89e16f2..5bb7569 100644
Binary files a/repository/files/images/default/item_select_type_doi_4_eng.png and b/repository/files/images/default/item_select_type_doi_4_eng.png differ
diff --git a/repository/files/images/default/item_select_type_doi_5.png b/repository/files/images/default/item_select_type_doi_5.png
index fa7694a..723907b 100644
Binary files a/repository/files/images/default/item_select_type_doi_5.png and b/repository/files/images/default/item_select_type_doi_5.png differ
diff --git a/repository/files/images/default/item_select_type_doi_5_eng.png b/repository/files/images/default/item_select_type_doi_5_eng.png
index fbe0e75..d6ba27d 100644
Binary files a/repository/files/images/default/item_select_type_doi_5_eng.png and b/repository/files/images/default/item_select_type_doi_5_eng.png differ
diff --git a/repository/files/images/default/item_select_type_doi_6.png b/repository/files/images/default/item_select_type_doi_6.png
index a257e39..9cc8fcb 100644
Binary files a/repository/files/images/default/item_select_type_doi_6.png and b/repository/files/images/default/item_select_type_doi_6.png differ
diff --git a/repository/files/images/default/item_select_type_doi_6_eng.png b/repository/files/images/default/item_select_type_doi_6_eng.png
index bc0fc97..b4b89fe 100644
Binary files a/repository/files/images/default/item_select_type_doi_6_eng.png and b/repository/files/images/default/item_select_type_doi_6_eng.png differ
diff --git a/repository/files/images/green/btn_next.gif b/repository/files/images/green/btn_next.gif
index 6837000..3d01c52 100644
Binary files a/repository/files/images/green/btn_next.gif and b/repository/files/images/green/btn_next.gif differ
diff --git a/repository/files/images/green/btn_next_hover.gif b/repository/files/images/green/btn_next_hover.gif
index 005c0e1..932f456 100644
Binary files a/repository/files/images/green/btn_next_hover.gif and b/repository/files/images/green/btn_next_hover.gif differ
diff --git a/repository/files/images/green/item_select_type_doi_1.png b/repository/files/images/green/item_select_type_doi_1.png
index 9ede5f5..2757110 100644
Binary files a/repository/files/images/green/item_select_type_doi_1.png and b/repository/files/images/green/item_select_type_doi_1.png differ
diff --git a/repository/files/images/green/item_select_type_doi_1_eng.png b/repository/files/images/green/item_select_type_doi_1_eng.png
index 34e3a61..94c94fc 100644
Binary files a/repository/files/images/green/item_select_type_doi_1_eng.png and b/repository/files/images/green/item_select_type_doi_1_eng.png differ
diff --git a/repository/files/images/green/item_select_type_doi_2.png b/repository/files/images/green/item_select_type_doi_2.png
index 473e43c..72c7811 100644
Binary files a/repository/files/images/green/item_select_type_doi_2.png and b/repository/files/images/green/item_select_type_doi_2.png differ
diff --git a/repository/files/images/green/item_select_type_doi_2_eng.png b/repository/files/images/green/item_select_type_doi_2_eng.png
index 35d7cf3..35f672b 100644
Binary files a/repository/files/images/green/item_select_type_doi_2_eng.png and b/repository/files/images/green/item_select_type_doi_2_eng.png differ
diff --git a/repository/files/images/green/item_select_type_doi_3.png b/repository/files/images/green/item_select_type_doi_3.png
index 1c10217..02a4fde 100644
Binary files a/repository/files/images/green/item_select_type_doi_3.png and b/repository/files/images/green/item_select_type_doi_3.png differ
diff --git a/repository/files/images/green/item_select_type_doi_3_eng.png b/repository/files/images/green/item_select_type_doi_3_eng.png
index 294ba60..743a5fa 100644
Binary files a/repository/files/images/green/item_select_type_doi_3_eng.png and b/repository/files/images/green/item_select_type_doi_3_eng.png differ
diff --git a/repository/files/images/green/item_select_type_doi_4.png b/repository/files/images/green/item_select_type_doi_4.png
index a45163b..2c12b15 100644
Binary files a/repository/files/images/green/item_select_type_doi_4.png and b/repository/files/images/green/item_select_type_doi_4.png differ
diff --git a/repository/files/images/green/item_select_type_doi_4_eng.png b/repository/files/images/green/item_select_type_doi_4_eng.png
index e7c1b11..9cd7819 100644
Binary files a/repository/files/images/green/item_select_type_doi_4_eng.png and b/repository/files/images/green/item_select_type_doi_4_eng.png differ
diff --git a/repository/files/images/green/item_select_type_doi_5.png b/repository/files/images/green/item_select_type_doi_5.png
index 89c1085..9808b4b 100644
Binary files a/repository/files/images/green/item_select_type_doi_5.png and b/repository/files/images/green/item_select_type_doi_5.png differ
diff --git a/repository/files/images/green/item_select_type_doi_5_eng.png b/repository/files/images/green/item_select_type_doi_5_eng.png
index 067705c..efef023 100644
Binary files a/repository/files/images/green/item_select_type_doi_5_eng.png and b/repository/files/images/green/item_select_type_doi_5_eng.png differ
diff --git a/repository/files/images/green/item_select_type_doi_6.png b/repository/files/images/green/item_select_type_doi_6.png
index 4ab62cd..53b281d 100644
Binary files a/repository/files/images/green/item_select_type_doi_6.png and b/repository/files/images/green/item_select_type_doi_6.png differ
diff --git a/repository/files/images/green/item_select_type_doi_6_eng.png b/repository/files/images/green/item_select_type_doi_6_eng.png
index 231e06b..59e2b19 100644
Binary files a/repository/files/images/green/item_select_type_doi_6_eng.png and b/repository/files/images/green/item_select_type_doi_6_eng.png differ
diff --git a/repository/files/images/orange/btn_next.gif b/repository/files/images/orange/btn_next.gif
index d8f169a..348ae5c 100644
Binary files a/repository/files/images/orange/btn_next.gif and b/repository/files/images/orange/btn_next.gif differ
diff --git a/repository/files/images/orange/btn_next_hover.gif b/repository/files/images/orange/btn_next_hover.gif
index 7027385..ed7fe27 100644
Binary files a/repository/files/images/orange/btn_next_hover.gif and b/repository/files/images/orange/btn_next_hover.gif differ
diff --git a/repository/files/images/orange/item_select_type_doi_1.png b/repository/files/images/orange/item_select_type_doi_1.png
index a637a57..5e73301 100644
Binary files a/repository/files/images/orange/item_select_type_doi_1.png and b/repository/files/images/orange/item_select_type_doi_1.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_1_eng.png b/repository/files/images/orange/item_select_type_doi_1_eng.png
index 2899bc4..1678a7e 100644
Binary files a/repository/files/images/orange/item_select_type_doi_1_eng.png and b/repository/files/images/orange/item_select_type_doi_1_eng.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_2.png b/repository/files/images/orange/item_select_type_doi_2.png
index 7843722..153d334 100644
Binary files a/repository/files/images/orange/item_select_type_doi_2.png and b/repository/files/images/orange/item_select_type_doi_2.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_2_eng.png b/repository/files/images/orange/item_select_type_doi_2_eng.png
index baf7448..6deb5ae 100644
Binary files a/repository/files/images/orange/item_select_type_doi_2_eng.png and b/repository/files/images/orange/item_select_type_doi_2_eng.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_3.png b/repository/files/images/orange/item_select_type_doi_3.png
index 1b0e0a4..51747ca 100644
Binary files a/repository/files/images/orange/item_select_type_doi_3.png and b/repository/files/images/orange/item_select_type_doi_3.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_3_eng.png b/repository/files/images/orange/item_select_type_doi_3_eng.png
index a7d9e79..a143d37 100644
Binary files a/repository/files/images/orange/item_select_type_doi_3_eng.png and b/repository/files/images/orange/item_select_type_doi_3_eng.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_4.png b/repository/files/images/orange/item_select_type_doi_4.png
index 1ae513e..cc0b9ec 100644
Binary files a/repository/files/images/orange/item_select_type_doi_4.png and b/repository/files/images/orange/item_select_type_doi_4.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_4_eng.png b/repository/files/images/orange/item_select_type_doi_4_eng.png
index 05c0699..8a6f4e2 100644
Binary files a/repository/files/images/orange/item_select_type_doi_4_eng.png and b/repository/files/images/orange/item_select_type_doi_4_eng.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_5.png b/repository/files/images/orange/item_select_type_doi_5.png
index 8ecc775..c6a988c 100644
Binary files a/repository/files/images/orange/item_select_type_doi_5.png and b/repository/files/images/orange/item_select_type_doi_5.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_5_eng.png b/repository/files/images/orange/item_select_type_doi_5_eng.png
index 9efca69..655afae 100644
Binary files a/repository/files/images/orange/item_select_type_doi_5_eng.png and b/repository/files/images/orange/item_select_type_doi_5_eng.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_6.png b/repository/files/images/orange/item_select_type_doi_6.png
index 6a003f6..a1a9eed 100644
Binary files a/repository/files/images/orange/item_select_type_doi_6.png and b/repository/files/images/orange/item_select_type_doi_6.png differ
diff --git a/repository/files/images/orange/item_select_type_doi_6_eng.png b/repository/files/images/orange/item_select_type_doi_6_eng.png
index b00332f..04d3f0c 100644
Binary files a/repository/files/images/orange/item_select_type_doi_6_eng.png and b/repository/files/images/orange/item_select_type_doi_6_eng.png differ
diff --git a/repository/files/images/pink/btn_next.gif b/repository/files/images/pink/btn_next.gif
index 09cdb20..538ff05 100644
Binary files a/repository/files/images/pink/btn_next.gif and b/repository/files/images/pink/btn_next.gif differ
diff --git a/repository/files/images/pink/btn_next_hover.gif b/repository/files/images/pink/btn_next_hover.gif
index bcab4af..8921cfd 100644
Binary files a/repository/files/images/pink/btn_next_hover.gif and b/repository/files/images/pink/btn_next_hover.gif differ
diff --git a/repository/files/images/pink/item_select_type_doi_1.png b/repository/files/images/pink/item_select_type_doi_1.png
index 5f08136..ba2f22f 100644
Binary files a/repository/files/images/pink/item_select_type_doi_1.png and b/repository/files/images/pink/item_select_type_doi_1.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_1_eng.png b/repository/files/images/pink/item_select_type_doi_1_eng.png
index b6fcbd7..44a8fb8 100644
Binary files a/repository/files/images/pink/item_select_type_doi_1_eng.png and b/repository/files/images/pink/item_select_type_doi_1_eng.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_2.png b/repository/files/images/pink/item_select_type_doi_2.png
index ba6d42b..0d5529b 100644
Binary files a/repository/files/images/pink/item_select_type_doi_2.png and b/repository/files/images/pink/item_select_type_doi_2.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_2_eng.png b/repository/files/images/pink/item_select_type_doi_2_eng.png
index f779a8f..35d264a 100644
Binary files a/repository/files/images/pink/item_select_type_doi_2_eng.png and b/repository/files/images/pink/item_select_type_doi_2_eng.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_3.png b/repository/files/images/pink/item_select_type_doi_3.png
index 43ab68c..229c810 100644
Binary files a/repository/files/images/pink/item_select_type_doi_3.png and b/repository/files/images/pink/item_select_type_doi_3.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_3_eng.png b/repository/files/images/pink/item_select_type_doi_3_eng.png
index f62c468..558eda0 100644
Binary files a/repository/files/images/pink/item_select_type_doi_3_eng.png and b/repository/files/images/pink/item_select_type_doi_3_eng.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_4.png b/repository/files/images/pink/item_select_type_doi_4.png
index 2afe121..2607be9 100644
Binary files a/repository/files/images/pink/item_select_type_doi_4.png and b/repository/files/images/pink/item_select_type_doi_4.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_4_eng.png b/repository/files/images/pink/item_select_type_doi_4_eng.png
index 81d896a..e98506d 100644
Binary files a/repository/files/images/pink/item_select_type_doi_4_eng.png and b/repository/files/images/pink/item_select_type_doi_4_eng.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_5.png b/repository/files/images/pink/item_select_type_doi_5.png
index 56f3b01..48043b7 100644
Binary files a/repository/files/images/pink/item_select_type_doi_5.png and b/repository/files/images/pink/item_select_type_doi_5.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_5_eng.png b/repository/files/images/pink/item_select_type_doi_5_eng.png
index 4370f98..6d6f49d 100644
Binary files a/repository/files/images/pink/item_select_type_doi_5_eng.png and b/repository/files/images/pink/item_select_type_doi_5_eng.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_6.png b/repository/files/images/pink/item_select_type_doi_6.png
index 700e867..7d6f63d 100644
Binary files a/repository/files/images/pink/item_select_type_doi_6.png and b/repository/files/images/pink/item_select_type_doi_6.png differ
diff --git a/repository/files/images/pink/item_select_type_doi_6_eng.png b/repository/files/images/pink/item_select_type_doi_6_eng.png
index 70e312a..77815d4 100644
Binary files a/repository/files/images/pink/item_select_type_doi_6_eng.png and b/repository/files/images/pink/item_select_type_doi_6_eng.png differ
diff --git a/repository/files/images/red/btn_next.gif b/repository/files/images/red/btn_next.gif
index 7bd4a44..6d67609 100644
Binary files a/repository/files/images/red/btn_next.gif and b/repository/files/images/red/btn_next.gif differ
diff --git a/repository/files/images/red/btn_next_hover.gif b/repository/files/images/red/btn_next_hover.gif
index d6febd0..f3451cc 100644
Binary files a/repository/files/images/red/btn_next_hover.gif and b/repository/files/images/red/btn_next_hover.gif differ
diff --git a/repository/files/images/red/item_select_type_doi_1.png b/repository/files/images/red/item_select_type_doi_1.png
index cd85e2d..626a0ec 100644
Binary files a/repository/files/images/red/item_select_type_doi_1.png and b/repository/files/images/red/item_select_type_doi_1.png differ
diff --git a/repository/files/images/red/item_select_type_doi_1_eng.png b/repository/files/images/red/item_select_type_doi_1_eng.png
index ad72461..1b7044c 100644
Binary files a/repository/files/images/red/item_select_type_doi_1_eng.png and b/repository/files/images/red/item_select_type_doi_1_eng.png differ
diff --git a/repository/files/images/red/item_select_type_doi_2.png b/repository/files/images/red/item_select_type_doi_2.png
index 092ec1f..e81f848 100644
Binary files a/repository/files/images/red/item_select_type_doi_2.png and b/repository/files/images/red/item_select_type_doi_2.png differ
diff --git a/repository/files/images/red/item_select_type_doi_2_eng.png b/repository/files/images/red/item_select_type_doi_2_eng.png
index 66f5ce4..3466573 100644
Binary files a/repository/files/images/red/item_select_type_doi_2_eng.png and b/repository/files/images/red/item_select_type_doi_2_eng.png differ
diff --git a/repository/files/images/red/item_select_type_doi_3.png b/repository/files/images/red/item_select_type_doi_3.png
index aba5051..87d7a93 100644
Binary files a/repository/files/images/red/item_select_type_doi_3.png and b/repository/files/images/red/item_select_type_doi_3.png differ
diff --git a/repository/files/images/red/item_select_type_doi_3_eng.png b/repository/files/images/red/item_select_type_doi_3_eng.png
index fb4ea7d..fd75437 100644
Binary files a/repository/files/images/red/item_select_type_doi_3_eng.png and b/repository/files/images/red/item_select_type_doi_3_eng.png differ
diff --git a/repository/files/images/red/item_select_type_doi_4.png b/repository/files/images/red/item_select_type_doi_4.png
index 8f83031..f125350 100644
Binary files a/repository/files/images/red/item_select_type_doi_4.png and b/repository/files/images/red/item_select_type_doi_4.png differ
diff --git a/repository/files/images/red/item_select_type_doi_4_eng.png b/repository/files/images/red/item_select_type_doi_4_eng.png
index c5b0168..16205a3 100644
Binary files a/repository/files/images/red/item_select_type_doi_4_eng.png and b/repository/files/images/red/item_select_type_doi_4_eng.png differ
diff --git a/repository/files/images/red/item_select_type_doi_5.png b/repository/files/images/red/item_select_type_doi_5.png
index 7a165e7..88e7e76 100644
Binary files a/repository/files/images/red/item_select_type_doi_5.png and b/repository/files/images/red/item_select_type_doi_5.png differ
diff --git a/repository/files/images/red/item_select_type_doi_5_eng.png b/repository/files/images/red/item_select_type_doi_5_eng.png
index 3d5ce3e..2124257 100644
Binary files a/repository/files/images/red/item_select_type_doi_5_eng.png and b/repository/files/images/red/item_select_type_doi_5_eng.png differ
diff --git a/repository/files/images/red/item_select_type_doi_6.png b/repository/files/images/red/item_select_type_doi_6.png
index 878d06e..499b087 100644
Binary files a/repository/files/images/red/item_select_type_doi_6.png and b/repository/files/images/red/item_select_type_doi_6.png differ
diff --git a/repository/files/images/red/item_select_type_doi_6_eng.png b/repository/files/images/red/item_select_type_doi_6_eng.png
index 7bc4753..ac18d30 100644
Binary files a/repository/files/images/red/item_select_type_doi_6_eng.png and b/repository/files/images/red/item_select_type_doi_6_eng.png differ
diff --git a/repository/files/js/default/bargraph_repository.js b/repository/files/js/default/bargraph_repository.js
index 0ffe607..b83c683 100644
--- a/repository/files/js/default/bargraph_repository.js
+++ b/repository/files/js/default/bargraph_repository.js
@@ -1,6 +1,6 @@
 // --------------------------------------------------------------------
 //
-// $Id: bargraph_repository.js 270 2009-01-21 04:50:41Z ivis $
+// $Id: bargraph_repository.js 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/files/js/default/common_repository.js b/repository/files/js/default/common_repository.js
index 7bf2610..eceba19 100644
--- a/repository/files/js/default/common_repository.js
+++ b/repository/files/js/default/common_repository.js
@@ -1,6 +1,6 @@
 // --------------------------------------------------------------------
 //
-// $Id: common_repository.js 270 2009-01-21 04:50:41Z ivis $
+// $Id: common_repository.js 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/files/js/default/edittree_repository.js b/repository/files/js/default/edittree_repository.js
index 7f8bb3f..d78965f 100644
--- a/repository/files/js/default/edittree_repository.js
+++ b/repository/files/js/default/edittree_repository.js
@@ -1,6 +1,6 @@
 // --------------------------------------------------------------------
 //
-// $Id: edittree_repository.js 270 2009-01-21 04:50:41Z ivis $
+// $Id: edittree_repository.js 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/files/js/default/log_repository.js b/repository/files/js/default/log_repository.js
index 1217305..cb0b45e 100644
--- a/repository/files/js/default/log_repository.js
+++ b/repository/files/js/default/log_repository.js
@@ -1,6 +1,6 @@
 // --------------------------------------------------------------------
 //
-// $Id: log_repository.js 562 2014-04-14 01:03:17Z ivis $
+// $Id: log_repository.js 9472 2011-06-16 07:54:19Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -194,6 +194,7 @@ function checkPeriod_repos(logErrorMsg){
 	var dtS = new Date(yearS, monthS - 1, dayS);
 	// 開始日判定
 	if(!checkDate_repos(yearS,monthS,dayS)) {
+		loadingIconOff();
 		alert(logErrorMsg[0]);
 		return false;
 	}
@@ -205,12 +206,14 @@ function checkPeriod_repos(logErrorMsg){
 	var dtE = new Date(yearE, monthE - 1, dayE);
 	// 終了日判定
 	if(!checkDate_repos(yearE,monthE,dayE)) {
+		loadingIconOff();
 		alert(logErrorMsg[1]);
 		return false;
 	}
 
 	// 開始日と終了日の関係を判定
 	if(dtS.getTime() > dtE.getTime()){
+		loadingIconOff();
 		alert(logErrorMsg[2]);
 		return false;
 	}
@@ -266,13 +269,17 @@ function downloadCSV_report(mail, error_msg){
 		// IEでのonload代用処理
 		$('log_download').innerHTML = '<iframe boder="0" id="log_frame" src="'+url+'?'+pars+'"></iframe>';
 		$('log_frame').onreadystatechange = function(){
-			if ($('log_frame').readyState == "complete"||($('log_frame').readyState == "interactive")) {
+            // Mod double alert on IE11 T.Koyasu 2015/04/09 --start--
+			if ($('log_frame').readyState == "complete") {
 				loadingIconOff(mail, error_msg);
 			}
+            // Mod double alert on IE11 T.Koyasu 2015/04/09 --end--
 		}
 	} else if(userAgent.indexOf("firefox") > -1){
+        // Mod no alert on FireFox T.Koyasu 2015/04/09 --start--
 		//firefoxの場合
-		$('log_download').innerHTML = '<iframe boder="0" id="log_frame" src="'+url+'?'+pars+'" onload="javascript: loadingIconOff();"></iframe>';
+		$('log_download').innerHTML = '<iframe boder="0" id="log_frame" src="'+url+'?'+pars+'" onload="javascript: loadingIconOff(\'' + mail + '\', \'' + error_msg + '\');"></iframe>';
+        // Mod no alert on FireFox T.Koyasu 2015/04/09 --end--
 	} else{
 		//その他のブラウザは待ち画像を表示しない
 		$('log_download').innerHTML = '<iframe boder="0" id="log_frame" src="'+url+'?'+pars+'"></iframe>';
@@ -362,31 +369,6 @@ function loadingIconOff(mail, error_msg){
 }
 // Add log report 2008/03/09 Y.Nakao --end--
 
-// Add log par host 2010/03/15 K.Ando --start--
-function ChangeHostStatus(ip, status, type, is_csv, logErrorMsg)
-{
-	var pars="action=repository_action_edit_log_exclusion";
-		pars += '&page_id='+$("page_id").value;
-		pars += '&block_id='+$("block_id").value;  
-		pars += '&log_exclusion='+ip;
-  		pars += '&queryParam='+status;
-		var url = _nc_base_url + "/index.php";	// Modify Directory specification BASE_URL K.Matsuo 2011/9/2
-		
-		var myAjax = new Ajax.Request(
-						url,
-						{
-							method: 'get',
-							parameters: pars, 
-							onComplete :function(req) {
-								execLogAjax_repos(type, is_csv, logErrorMsg);
-							}
-						}
-					);
-					
-}
-// Add log par host 2010/03/15 K.Ando --end--
-
-
 // Add log moves 2010/04/26 Y.Nakao --start--
 function logMoves(id){
 	
@@ -431,3 +413,45 @@ function logMoves(id){
 				);
 }
 // Add log moves 2010/04/26 Y.Nakao --end--
+
+// Modify Set Exclude IP Address List by log analyze 2015/04/06 --start--
+function setExcludeIpAddress(countNum)
+{
+    str = "";
+    for(ii = 0; ii < countNum; ii++)
+    {
+        if(str.length > 0)
+        {
+            str = str + ",";
+        }
+        checkId = "check_" + ii;
+        checkboxObj = document.getElementById(checkId);
+        if(checkboxObj.checked == true && checkboxObj.disabled == false)
+        {
+            str = str + checkboxObj.value;
+        }
+    }
+    
+    var pars="action=repository_action_edit_log_exclusion";
+    pars += '&page_id='+$("page_id").value;
+    pars += '&block_id='+$("block_id").value;  
+    pars += '&log_exclusion='+str;
+    var url = _nc_base_url + "/index.php";
+    
+    var myAjax = new Ajax.Request(
+                    url,
+                    {
+                        method: 'post',
+                        parameters: pars, 
+                        onFailure : function(){
+                        },
+                        onSuccess : function(res){
+                            // popup
+                            alert(res.responseText);
+                        },
+                        onComplete: function(res) {
+                        }
+                    }
+                );
+}
+// Modify Set Exclude IP Address List by log analyze 2015/04/06 --end--
diff --git a/repository/files/js/default/repository.js b/repository/files/js/default/repository.js
index 6adb75b..dcb34c6 100644
--- a/repository/files/js/default/repository.js
+++ b/repository/files/js/default/repository.js
@@ -1,6 +1,6 @@
 // --------------------------------------------------------------------
 //
-// $Id: repository.js 600 2014-08-06 04:41:16Z ivis $
+// $Id: repository.js 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -590,24 +590,24 @@ clsRepository.prototype = {
 		commonCls.send(params);
 	},
 	// Goto ItemSelectEdit (S.Kawasaki)
-	repositoryItemSelectType: function() {
+	repositoryItemSelectType: function(mode) {
 		var top_el = $(this.id);
 		var form = top_el.getElementsByTagName("form")[0];
 		var params = new Object();
 		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_selecttype" + "&"+ Form.serialize(form);
+		params["param"] = "action=repository_action_main_item_selecttype" + "&"+ Form.serialize(form) + "&save_mode=" + mode;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
 		commonCls.send(params);
 	},
 	// Goto ItemEditFiles (S.Kawasaki)
-	repositoryItemEditFiles: function() {
+	repositoryItemEditFiles: function(mode) {
 		var top_el = $(this.id);
 		var form = top_el.getElementsByTagName("form")[0];
 		var params = new Object();
 		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_editfiles" + "&"+ Form.serialize(form);
+		params["param"] = "action=repository_action_main_item_editfiles" + "&"+ Form.serialize(form) + "&save_mode=" + mode;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -619,7 +619,7 @@ clsRepository.prototype = {
 		var form = document.getElementById('send_date');
 		var params = new Object();
 		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_editfiles" + "&"+ Form.serialize(form) + "&return_screen=1";
+		params["param"] = "action=repository_action_main_item_selecttype" + "&"+ Form.serialize(form) + "&return_screen=1&save_mode=next";
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -630,21 +630,23 @@ clsRepository.prototype = {
 		var top_el = $(this.id);
 		var params = new Object();
 		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_editfiles" + "&item_id=" + Item_Id + "&item_no=" + Item_No + "&workflow_active_tab=" + active_tab + "&return_screen=2";
+		params["param"] = "action=repository_action_main_item_selecttype" + "&item_id=" + Item_Id + "&item_no=" + Item_No + "&workflow_active_tab=" + active_tab + "&return_screen=2&save_mode=next";
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
 		commonCls.send(params);
 	},
 	// Goto ItemEditFilesLicense (S.Kawasaki)
-	repositoryItemEditFilesLicense: function() {
+	repositoryItemEditFilesLicense: function(mode) {
 		var top_el = $(this.id);
 		var form = top_el.getElementsByTagName("form")[0];
 		var params = new Object();
-		var add_params = new Object();		
+		var add_params = new Object();
+		// OK, check all text(textarea) element and if IsEmpty, set " ".
+		this.repositoryItemAddSpaceToEmptyText(form);
 //		var childelms = form.elements;
 		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_editfileslicense" + "&"+ Form.serialize(form);
+		params["param"] = "action=repository_action_main_item_editfileslicense" + "&"+ Form.serialize(form) + "&save_mode=" + mode;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -746,7 +748,8 @@ clsRepository.prototype = {
 		var opt = "save_mode=" + mode + "&" + "target=" + target + "&" + "attridx=" + attridx;
 		// OK, check all text(textarea) element and if IsEmpty, set " ".
 		this.repositoryItemAddSpaceToEmptyText(form);
-		params["param"] = "action=repository_action_main_item_editfileslicense" + "&"+ Form.serialize(form) + "&" + opt;
+		
+		params["param"] = "action=repository_action_main_item_editfiles" + "&"+ Form.serialize(form) + "&" + opt;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -755,24 +758,23 @@ clsRepository.prototype = {
 	// Goto ItemEditLinks (S.Kawasaki)
 	repositoryItemEditLinks: function(save_mode) {
 		var top_el = $(this.id);
-		var form = top_el.getElementsByTagName("form")[0];
+		var forms = top_el.getElementsByTagName("form");
 		var params = new Object();
 		params["method"] = "post";
-		// OK, check all text(textarea) element and if IsEmpty, set " ".
-		this.repositoryItemAddSpaceToEmptyText(form);
-		// Get Opend Node IDs & Checked Node Ids.
-		// change index tree view action 2008/12/03 Y.Nakao --start--
-		//var OpendIds = this.searchOpenNodeItemIndex();
-		//var CheckedIds = this.searchCheckedNodeItemIndex(); 
-		//var CheckedNames = this.searchCheckedNodeNameItemIndex(); 
-		params["param"] = "action=repository_action_main_item_editlinks" + "&" +
-						  Form.serialize(form) + "&save_mode=" + save_mode;
-						  //"OpendIds=" + OpendIds + "&" +
-						  //"CheckedIds=" + CheckedIds + "&" +
-						  //"CheckedNames=" + CheckedNames;
-		// change index tree view action 2008/12/03 Y.Nakao --end--
-//		var req_str = "action=repository_action_main_item_editlinks" + this.repositoryItemRequestStrMaker(form);
-//		params["param"] = req_str;
+		var OpendIds = "";
+		var CheckedIds = $('check_insert_idx').value;
+		var CheckedNames = $('check_insert_idx_name').value;
+		
+		var len = forms.length;
+		var form_data = "";
+		for (i=0; i<len; i++) {
+			form_data += "&" + Form.serialize(forms[i]);
+		}
+		params["param"] =   "action=repository_action_main_item_editlinks" + form_data + "&" +
+							"OpendIds=" + OpendIds + "&" +
+							"CheckedIds=" + CheckedIds + "&" +
+							"CheckedNames=" + CheckedNames + "&" + 
+							"save_mode=" + save_mode;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -788,18 +790,8 @@ clsRepository.prototype = {
 		var opt = "save_mode=" + mode + "&" + "target=" + target + "&" + "attridx=" + attridx;
 		// OK, check all text(textarea) element and if IsEmpty, set " ".
 		this.repositoryItemAddSpaceToEmptyText(form);
-		// Get Opend Node IDs & Checked Node Ids.
-		// change index tree view action 2008/12/03 Y.Nakao --start--
-		//var OpendIds = this.searchOpenNodeItemIndex(); 
-		//var CheckedIds = this.searchCheckedNodeItemIndex(); 
-		//var CheckedNames = this.searchCheckedNodeNameItemIndex();
-		params["param"] = "action=repository_action_main_item_editlinks" + "&" +
+		params["param"] = "action=repository_action_main_item_edittexts" + "&" +
 						  Form.serialize(form) + "&" + opt;
-						  //"OpendIds=" + OpendIds + "&" +
-						  //"CheckedIds=" + CheckedIds + "&" +
-						  //"CheckedNames=" + CheckedNames;
-		// change index tree view action 2008/12/03 Y.Nakao --end--
-//		params["param"] = "action=repository_action_main_item_editlinks" + "&"+ Form.serialize(form) + "&" + opt;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -840,58 +832,6 @@ clsRepository.prototype = {
 		}
 		return cnt;
 	},
-	// To Send All RequestParams, generate netsuzou serialized str (S.Kawasaki)
-	repositoryItemRequestStrMaker: function(formEl) {
-		// get "text", "textarea", "name"... elements from "item_attr_form" form.
-		var request_str = "";
-		var childelms = formEl.elements;
-		var len = childelms.length;
-		// OK, 2008/03/05/kokomade, 
-		for (ii=0; ii<len; ii++) {
-			if(childelms[ii].id == "base_attr") {
-				// basic information (title and language...)
-				request_str = request_str + "&" + "base_attr%5B%5D=%2520" + childelms[ii].value;		
-			} else {
-				// additional information (metadata)
-				switch(childelms[ii].tagName) {
-				case "INPUT":
-					switch(childelms[ii].type) {
-					case "text":
-						// texts id == "text", "link", "name_family", "name_given", "name_email"
-//						request_str = request_str + "&" + childelms[ii].id + "%5B%5D=%2520" + childelms[ii].value;
-						request_str = request_str + "&" + childelms[ii].id + "%5B%5D=%2520" + childelms[ii].value;
-						break;
-					case "checkbox":
-						// if checked, send "1", else send "0".
-						if(childelms[ii].checked) {
-							request_str = request_str + "&" + "item_attr_checkbox%5B%5D=%25201";
-						} else {
-							request_str = request_str + "&" + "item_attr_checkbox%5B%5D=%25200";
-						}
-						break;
-					case "radio":
-						// if checked, send value, else do not send.
-						if(childelms[ii].checked) {
-							request_str = request_str + "&" + "item_attr_radio%5B%5D=%2520" + childelms[ii].value;
-						}
-						break;
-					default:
-						break;
-					}	
-					break;
-				case "TEXTAREA":
-					request_str = request_str + "&" + "item_attr_textarea%5B%5D=%2520" + childelms[ii].value;
-					break;
-				case "SELECT":
-					request_str = request_str + "&" + "item_attr_select%5B%5D=%2520" + childelms[ii].value;
-					break;
-				default:
-					break;
-				}
-			}
-		}
-		return request_str;
-	},
 	// change next "hidden" value
 	changeNextHiddenVal: function(elm, IsChecked) {
 		if(IsChecked) {
@@ -925,29 +865,17 @@ clsRepository.prototype = {
 			}
 		}
 	},
-	// Goto ItemConfirm (S.Kawasaki)
 	repositoryItemEditDoi: function(save_mode) {
 		var top_el = $(this.id);
 		var forms = top_el.getElementsByTagName("form");
 		var params = new Object();
-		params["method"] = "post";
-		// Add join set insert index and set item links 2008/12/17 Y.Nakao --start--
-		var OpendIds = "";
-		var CheckedIds = $('check_insert_idx').value;
-		var CheckedNames = $('check_insert_idx_name').value;
-		
 		var len = forms.length;
 		var form_data = "";
 		for (i=0; i<len; i++) {
 			form_data += "&" + Form.serialize(forms[i]);
 		}
-		
-		params["param"] =   "action=repository_action_main_item_editdoi" + form_data + "&" +
-							"OpendIds=" + OpendIds + "&" +
-							"CheckedIds=" + CheckedIds + "&" +
-							"CheckedNames=" + CheckedNames + "&" + 
-							"save_mode=" + save_mode;
-		// Add join set insert index and set item links 2008/12/17 Y.Nakao --end--
+		params["method"] = "post";
+		params["param"] =   "action=repository_action_main_item_editdoi" + form_data + "&save_mode=" + save_mode;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -956,30 +884,9 @@ clsRepository.prototype = {
 	// Goto ItemConfirm (S.Kawasaki)
 	repositoryItemConfirm: function(save_mode) {
 		var top_el = $(this.id);
-		var forms = top_el.getElementsByTagName("form");
 		var params = new Object();
 		params["method"] = "post";
-		
-		var len = forms.length;
-		var form_data = "";
-		for (i=0; i<len; i++) {
-			form_data += "&" + Form.serialize(forms[i]);
-		}
-		
-		params["param"] =   "action=repository_action_main_item_confirm" + form_data + "&" +
-							"save_mode=" + save_mode;
-		params["top_el"] = top_el;
-		params["loading_el"] = top_el;
-		params["target_el"] = top_el;
-		commonCls.send(params);
-	},
-	// Goto ItemAdddb(F.Arisaka)
-	repositoryItemAdddb: function() {
-		var top_el = $(this.id);
-		var form = top_el.getElementsByTagName("form")[0];
-		var params = new Object();
-		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_adddb" + "&"+ Form.serialize(form);
+		params["param"] =   "action=repository_action_main_item_confirm&save_mode=" + save_mode;
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -1668,7 +1575,6 @@ clsRepository.prototype = {
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
 		// callback : action => view => template => callback...
-//		params["callbackfunc"] = this.repositoryItemEditLinks.bind(this);
 		commonCls.send(params);
 	},
 	// Generate Opening Index IDs, for ItemEditLink.
@@ -3176,9 +3082,10 @@ clsRepository.prototype = {
 	repositoryAddSupple: function(item_id, item_no, mode, weko_key){
 		var top_el = $(this.id);
 		var params = new Object();
+ 		var tmp_weko_key = encodeURIComponent(weko_key); // Add suppleContentsEntry 2015/03/23 Y.Yamazawa
 
 		params["method"] = "post";
-		params["param"] = "action=repository_action_main_item_supple" + "&item_id="+ item_id + "&item_no="+ item_no + "&mode=" + mode + "&weko_key=" + weko_key;
+		params["param"] = "action=repository_action_main_item_supple" + "&item_id="+ item_id + "&item_no="+ item_no + "&mode=" + mode + "&weko_key=" + tmp_weko_key; // Update suppleContentsEntry 2015/03/23 Y.Yamazawa
 		params["top_el"] = top_el;
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
@@ -4048,12 +3955,72 @@ clsRepository.prototype = {
 		params["loading_el"] = top_el;
 		params["target_el"] = top_el;
 		commonCls.send(params);
-	}
+	},
 	//show multi language for item type popup 2013/07/17 K.Matsuo --end--
+	// Modify for itemtype authority 2014/12/15 T.Ichikawa --start--
+	repositoryItemTypeAuthorityAdd: function(param)
+	{
+		var top_el = $(this.id);
+		var params = new Object();
+		params["method"] = "post";
+		params["param"] = 'action=repository_action_edit_itemtype_auth_adddb'+param;
+		params["top_el"] = top_el;
+		params["loading_el"] = top_el;
+		params["target_el"] = top_el;
+		commonCls.send(params);
+	},
+	// Modify for itemtype authority 2014/12/15 T.Ichikawa --end--
+	// Add for search item delete function 2015/04/06 K.Matsushita --start--
+	repositoryDeleteSearchedItem: function(searchkeyword, search_type, elm)
+	{
+		var top_el = $(this.id);
+		
+		var form = document.getElementById('enter_search_delete_form' + this.id);
+		var params = new Object();
+		params["method"] = "post";
+		
+		params["param"] = "action=repository_action_edit_item_searchdelete" + 
+						  "&"+ Form.serialize(form) + 
+						  "&searchkeyword=" + searchkeyword + 
+						  "&search_type=" + search_type;
+		params["top_el"] = top_el;
+		params["loading_el"] = elm;
+		params["target_el"] = top_el;
+		commonCls.send(params);
+	},
+	// Add for search item delete function 2015/04/06 K.Matsushita --end--
 	// input " " to empty text element.
 	
 	// Other test logics
 	
 	// notice : we can see DOM object from this js code. also see "search.js" 
 	
+    repositoryRobotlistRun: function() {
+        var top_el = $(this.id);
+        var params = new Object();
+        var form = document.getElementsByName("robotlistValid[]");
+        
+        var forms = "";
+        for (ii = 0; ii < form.length; ii++){
+            forms += "&robotlistValid[]=" + form[ii].checked;
+        }
+        
+        params["method"] = "get";
+        params["param"] = "action=repository_action_common_robotlist" + forms;
+        params["top_el"] = top_el;
+        params["loading_el"] = top_el;
+        params["target_el"] = top_el;
+        commonCls.send(params);
+    },
+    repositoryRobotlistCancel: function() {
+        var top_el = $(this.id);
+        var params = new Object();
+        params["method"] = "get";
+        params["param"] = "action=repository_action_edit_logdeletecancel";
+        params["top_el"] = top_el;
+        params["loading_el"] = top_el;
+        params["target_el"] = top_el;
+        commonCls.send(params);
+    },
+
 }
diff --git a/repository/files/js/default/suggest_jtitle_policy_repository.js b/repository/files/js/default/suggest_jtitle_policy_repository.js
index a239d8f..cf87f39 100644
--- a/repository/files/js/default/suggest_jtitle_policy_repository.js
+++ b/repository/files/js/default/suggest_jtitle_policy_repository.js
@@ -177,9 +177,9 @@ SuggestJtitlePolicy.Local.prototype = {
         return;
     }
     
-     //邭\
-     var loadingfuncName = 'return '+'displayLoadingImage'+this.class_id+'(arg1, arg2)';
-     var loadingfunc = new Function('arg1', 'arg2', loadingfuncName) ;
+     //邭\
+     var loadingfuncName = 'return '+'displayLoadingImage'+this.class_id+'(arg1, arg2)';
+     var loadingfunc = new Function('arg1', 'arg2', loadingfuncName) ;
      loadingfunc(this.iiCnt, this.jjCnt);
     
     //ʂȂ
@@ -298,8 +298,8 @@ SuggestJtitlePolicy.Local.prototype = {
         //Unicode : 0x0 ` 0x80, 0xf8f0, 0xff61 ` 0xff9f, 0xf8f1 ` 0xf8f3
         if ( (c >= 0x0 && c < 0x81) || (c == 0xf8f0) || (c >= 0xff61 && c < 0xffa0) || (c >= 0xf8f1 && c < 0xf8f4)) {
             byte += 1;
-        }else {
-            byte += 2;
+        }else {
+            byte += 2;
         }
     }
     return byte;
diff --git a/repository/files/js/default/tree_repository.js b/repository/files/js/default/tree_repository.js
index 5a51512..d33e3a9 100644
--- a/repository/files/js/default/tree_repository.js
+++ b/repository/files/js/default/tree_repository.js
@@ -1,6 +1,6 @@
 // --------------------------------------------------------------------
 //
-// $Id: tree_repository.js 516 2012-05-22 09:30:55Z ivis $
+// $Id: tree_repository.js 3131 2011-01-28 11:36:33Z haruka_goto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/files/sword/deposit.php b/repository/files/sword/deposit.php
index a14a898..afc9d1a 100644
--- a/repository/files/sword/deposit.php
+++ b/repository/files/sword/deposit.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: deposit.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: deposit.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -525,32 +525,17 @@ xml_parse_into_struct($parser, $import_body, $vals, $index);
 xml_parser_free($parser);
 fwrite($fh, "Check Point 18: Parse import response.\n");
 
+// Add SupleContentsEntry Y.Yamazawa 2015/04/01 --start--
 # TestCode : Check and Dump Authorize Rsoponse to Server Text.
-foreach($vals as $key => $resparams) {
-	if( isset($resparams['tag'])&&isset($resparams['value'])){
-    	fwrite($fh, "['" . $key . "'] = " .$resparams['tag']. "/" .$resparams['value']."\n");
-	}
-}
 
 #Check Status of Import Action
 
-$import_status = $vals[$index['STATUS'][0]]['value'];
+$import_status = $vals[$index['TITLE'][0]]['value'];
 //fwrite($fh, $import_status."\n");
 fwrite($fh, "Check Point 19: Check import status. Status: ".$import_status."\n");
-if ( $import_status != "success" ){
-    // V1.2 => V1.3, Create Error Document
-    $header_params['summary'] = $vals[$index['SUMMARY'][0]]['value'];
-    // Add for error check 2014/09/12 T.Ichikawa --start--
-    if(isset($vals[$index['TREATMENT'][0]])) {
-        $header_params['treatment'] = $vals[$index['TREATMENT'][0]]['value'];
-    }
-    if(isset($vals[$index['DESCRIPTION'][0]])) {
-        $header_params['description'] = $vals[$index['DESCRIPTION'][0]]['value'];
-    }
-    // Add for error check 2014/09/12 T.Ichikawa --end--
-    generateErrorDocument($header_params, $error_doc);
-    $xmlsize = strlen($error_doc);
-    fwrite($fh, $error_doc . "\n");     // 2008/11/12 kawa check point.
+if ( $import_status == "ERROR" ){
+    $xmlsize = strlen($import_body);
+    fwrite($fh, $import_body . "\n");     // 2008/11/12 kawa check point.
     // header output
     header("Internal Server Error", true, 500);
     header("X-Error-Code: " . $import_status);      // X-Error-Code is generated by WEKO.
@@ -558,33 +543,15 @@ if ( $import_status != "success" ){
     header("Content-Length: ".$xmlsize);
     session_destroy();
     fclose($fh);
-    echo $error_doc;
+    echo $import_body;
     exit;
 }
-$import_code = $import_req->getResponseCode();      // ResponseCode(200等)を取得
-$import_header = $import_req->getResponseHeader();  // ResponseHeader(レスポンスヘッダ)を取得
-$header_params['startid'] = $vals[$index['START_ID'][0]]['value'];  // Get Start ID (or Suffix)
-$header_params['endid'] = $vals[$index['END_ID'][0]]['value'];      // Get End ID (or Suffix)
-$uris = array();
-$cnt_uri = count($index['CONTENTS_URI']);
-for($cnt=0; $cnt<$cnt_uri; $cnt++ ) {
-    array_push($uris, $vals[$index['CONTENTS_URI'][$cnt]]['value']);
-}
-$header_params['contents'] = $uris;                                 // Get Contents URIs
-// 2008/11/11 S.Kawasaki retrieve SWORD options End
-
 
 // generate Atom entry document
-$atom_entry_doc = '';
-if($header_params['contentType'] == "text/xml"){
-     $atom_entry_doc = "<?xml version=\"1.0\" encoding=\"utf-8\"?>" . "\n";
-} else {
-    generateEntryDocument($header_params, $atom_entry_doc);
-}
 //$atom_entry_doc_enc = mb_convert_encoding($atom_entry_doc, "UTF-8", "auto");
-$xmlsize = strlen($atom_entry_doc);
+$xmlsize = strlen($import_body);
 # TestCode : Check and Dump Atom Entry Document to Server Text.
-fwrite($fh, $atom_entry_doc . "\n");        // 2008/11/12 kawa check point.
+fwrite($fh, $import_body . "\n");        // 2008/11/12 kawa check point.
 fwrite($fh, "Check Point 20: Successfully completed SWORD import.\n");
 fclose($fh);
 // header output
@@ -593,6 +560,7 @@ header("Location: ".$header_params['generator']);
 header("Content-Type: application/atom+xml;type=entry;charset=\"utf-8\"");
 header("Content-Length: ".$xmlsize);
 // output　Atom entry document
-echo $atom_entry_doc;
+echo $import_body;
+// Add SupleContentsEntry Y.Yamazawa 2015/04/01 --end--
 exit;
 ?>
diff --git a/repository/files/sword/servicedocument.php b/repository/files/sword/servicedocument.php
index f75f378..9201ce2 100644
--- a/repository/files/sword/servicedocument.php
+++ b/repository/files/sword/servicedocument.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: servicedocument.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: servicedocument.php 30197 2013-12-19 09:55:45Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/files/sword/serviceitemtype.php b/repository/files/sword/serviceitemtype.php
index 8c1bce9..6e15e31 100644
--- a/repository/files/sword/serviceitemtype.php
+++ b/repository/files/sword/serviceitemtype.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: serviceitemtype.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: serviceitemtype.php 32116 2014-02-27 07:50:53Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/files/sword/utils.php b/repository/files/sword/utils.php
index d847cca..75aca2d 100644
--- a/repository/files/sword/utils.php
+++ b/repository/files/sword/utils.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: utils.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: utils.php 43165 2014-10-22 10:48:15Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -360,7 +360,6 @@ function process_headers($request)
         $filename = "deposit";
         $token = split('[;]', $deposition);
         foreach($token as $value) {
-            $value = trim($value);
             $filename = split('[=]', $value);
             if(!strcmp($filename[0],'filename')) {
                 $filename = $filename[1];
diff --git a/repository/install.ini b/repository/install.ini
index fe7134b..bfedd0b 100644
--- a/repository/install.ini
+++ b/repository/install.ini
@@ -1,4 +1,4 @@
-version = "2.1.7"
+version = "2.2.0"
 action_name="repository_view_main_item_snippet"
 ;edit_action_name="repository_view_edit_init"
 edit_action_name="repository_view_edit_itemtype_setting"
diff --git a/repository/json/detail/Detail.class.php b/repository/json/detail/Detail.class.php
index be22839..f8440a6 100644
--- a/repository/json/detail/Detail.class.php
+++ b/repository/json/detail/Detail.class.php
@@ -39,7 +39,7 @@ class Repository_Json_Detail extends RepositoryAction
      *
      * @access  public
      */
-    function executeForWEKO()
+    function executeApp()
     {
         $itemAuthorityManager = new RepositoryItemAuthorityManager($this->Session, $this->dbAccess, $this->TransStartDate);
         $pubflg = $itemAuthorityManager->checkItemPublicFlg($this->item_id, 1, $this->repository_admin_base, $this->repository_admin_room);
diff --git a/repository/json/searchranking/Searchranking.class.php b/repository/json/searchranking/Searchranking.class.php
index 9b34aec..836e111 100644
--- a/repository/json/searchranking/Searchranking.class.php
+++ b/repository/json/searchranking/Searchranking.class.php
@@ -29,7 +29,7 @@ class Repository_Json_Searchranking extends RepositoryAction
      *
      * @access  public
      */
-    function executeForWEKO()
+    function executeApp()
     {
         // ランキング設定を取得する
         $rankingDisplay = 0;
diff --git a/repository/language/cantonese/main.ini b/repository/language/cantonese/main.ini
index a23843e..b1dd7ec 100644
--- a/repository/language/cantonese/main.ini
+++ b/repository/language/cantonese/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "拒絕的理由 : "
 repository_mail_review_supple_reject_close = "拒絕補充內容已被移動到“未登記的”。"
 repository_mail_review_supple_setting = "如果你不再需要接收電子郵件通知審查結果，請點擊這裡更改設置。"
 repository_mail_review_supple_setting_url = "設置頁面的URL"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId的補充WEKO側未設置"
+repository_entry_no_prefix_id = "PrefixId尚未設置。 對不起，麻煩你，但請與管理員聯繫。"
+repository_entry_no_supple_weko_url = "補充WEKOURL尚未設置。  對不起，麻煩你，但請與管理員聯繫。"
+repository_entry_invalid_supple_contents_url = "補充內容URL是不正確的值。請檢查補充內容URL。"
+repository_entry_invalid_all_supple_contents_url = "補充內容URL都是非法值。請檢查補充內容URL。"
+repository_entry_failed_entry_supple_contents = "註冊失敗補充內容"
+repository_entry_failed_some_of_supple_entry = "有失敗註冊一個補充內容"
+repository_entry_exist_supple_contents = "補充內容已經被註冊"
+repository_delete_failed_delete_supple_contents = "無法刪除多餘的內容"
+repository_update_failed_update_supple_contents = "無法更新內容外"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "無法顯示嵌入式框架的瀏覽器不對應。"
 repository_help_link_here = "here"
@@ -201,6 +212,7 @@ repository_log_report = "固定報告"
 repository_log_custom = "自年報t"
 repository_log_is_sitelicense = "站點許可證"
 repository_log_not_sitelicense = "其他站點許可證"
+repository_log_sitelicense_member = "站點許可證成員"
 repository_log_total = "總"
 repository_log_organization = "組織"
 repository_log_weko_top = "WEKO頂頁"
@@ -225,6 +237,7 @@ repository_log_download_admin = "幫助"
 repository_log_download_register = "註冊"
 repository_log_download_deleted_group = "刪除組"
 repository_log_index_report_title = "細節接入面值指數"
+repository_log_index = "指數"
 
 repository_log_index_detail_access_total = "總詳細訪問"
 repository_log_start_month = "設置啟動一個月"
@@ -257,6 +270,11 @@ repository_log_update_OK = "進入OK"
 repository_log_update_NG = "進入 NG"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "訪問參數主機"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "搜索关键词排行"
+repository_search_keyword_name = "搜索关键字"
+repository_search_num = "搜索次数"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[下載] : "
 repository_sitelicense_mail_subject = "站點許可證使用情況統計"
 repository_sitelicense_mail_body_dear = "%s狀"
 repository_sitelicense_mail_body_thank = "感謝您使用的%s。"
-repository_sitelicense_mail_body_announcement = "我們會送你一個站點許可證使用情況統計"
+repository_sitelicense_mail_body_announcement = "這是在%s的網站牌照訪問的使用情況統計報告。"
 repository_sitelicense_mail_body_unnecessary = "如果不需要此郵件，抱歉給您添麻煩，但是請聯繫管理員（%s）"
 repository_sitelicense_mail_body_explain_rule_1 = "◆我已經計數的訪問次數，將IP地址範圍，為每個註冊的。"
 repository_sitelicense_mail_body_explain_rule_2 = "（如果要註冊多個IP地址範圍，此郵件將多種交付。）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "上传失败%s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "後面"
 
@@ -456,7 +478,9 @@ repository_execute = "執行"
 repository_commit = "犯"
 repository_edit = "編輯"
 repository_public = "公眾"
+repository_public_change = "改變公眾"
 repository_private = "私人"
+repository_private_change = "改變私人"
 repository_upload = "上載"
 repository_export = "出口"
 repository_import = "i進口"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "IP地址範圍"
 repository_admin_site_license_from = "從"
 repository_admin_site_license_to = "至"
 repository_admin_site_license_addrow = "更多的輸入行"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "指數顯示設置"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "電子郵件地址"
 repository_admin_site_license_from_to = "（從 - 到）"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "組織名稱"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "排除地址"
 repository_admin_log_address = "請指定互聯網協議地址日誌分析排除"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "自動設置"
 repository_admin_server_cmmdpath = "自動設置"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "PrefixID格式无效"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "文獻記錄信息填寫從其他網站"
 repository_admin_AWSAccessKeyId = "AWS訪問密鑰ID"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "目前的狀態："
 repository_admin_IchushiLogin_attestation = "認證"
 repository_admin_IchushiLogin_no_attestation = "沒有被證實"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "CrossRef查询服务的帐号"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "機構名"
+repository_admin_institution_name_explanation = "機構名(英文推薦)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "字首ID"
 repository_admin_ranking_disp_setting = "顯示設置"
 repository_admin_ranking_disp_realtime = "要更新實時排名信息"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "貨幣設置"
 repository_admin_index_search = "索引搜索"
 repository_admin_keyword_search = "關鍵字搜索"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "机构内部ID"
+repository_admin_add_prefix = "添加"
+repository_admin_do_not_add_prefix = "不添加"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "得到字首ID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,10 @@ repository_admin_icon_display_setting = "圖標顯示設置"
 repository_admin_icon_display_setting_help = "設置幫助圖標設置"
 repository_admin_icon_display_setting_oaiore = "OAI-ORE設置圖標設置"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "使用統計鏈接顯示設置"
+repository_admin_usagestatistics_link_display = "使用統計顯示鏈接"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "作者ID前綴設置"
 repository_admin_author_id_prefix_edit = "作者ID前綴編輯"
@@ -864,6 +913,13 @@ repository_admin_privatetree_indexname_sort_desc = "指數名稱排序（降序
 repository_admin_privatetree_parent_index = "註冊指數"
 repository_admin_privatetree_writable_notice = "*當沒有寫權限 [webapp/modules/repository/config/define.inc.php],設置一個私人的樹不能改變。"
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "日誌刪除的排除"
+repository_admin_robotlist_now_executing = "現在執行..."
+repository_admin_robotlist_process_kill = "殺死進程"
+repository_admin_robotlist_common_crawler_list = "共享履帶列表"
+repository_admin_robotlist_no_robotlist = "沒有獲得機器人列表"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "更新使用統計"
 repository_admin_update_usage_statistics_comment = "更新使用統計..."
@@ -898,6 +954,12 @@ repository_admin_sitelicense_send_mail_activate = "我要啟用的站點許可
 repository_admin_sitelicense_send_mail_running = "網站許可郵件傳輸開始..."
 repository_admin_sitelicense_send_mail_errorMsg = "我沒能送的站點許可郵件開始。請檢查輸入的信息"
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "搜索設置"
+repository_admin_default_search_type = "默認搜索設置"
+repository_admin_detail_search_type = "全文"
+repository_admin_simple_search_type = "簡單"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1093,13 @@ repository_item_embargo_index_error = "適用規則，指定索引"
 repository_item_embargo_select_index = "從樹中選擇索引"
 repository_item_embargo_registered_index = "該指數已經註冊ELS"
 repository_item_embargo_free_licence = "形容自己的許可證"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "排序順序設置"
 repository_item_sortorder_target_index = "顯示變更目標指數"
@@ -1043,17 +1112,34 @@ repository_item_listdelete_target_index = "刪除索引"
 repository_item_listdelete_delete_button_title = "刪除項目"
 repository_item_listdelete_sub_index = "子索引項也刪除"
 repository_item_listdelete_select_index_list_default = "請選擇索引"
+repository_item_listdelete_selsect_index_or_search_keyword = "请运行或关键字搜索来选择指数"
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "交叉參考"
-repository_item_edit_item_name = "項目"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "称号"
 repository_item_edit_select = "請選擇"
+repository_item_add_doi = "DOI补助"
 repository_item_enterdoi = "DOI散批"
 repository_item_enterdoi_target_index = "DOI批量承授人指数"
 repository_item_enterdoi_target_item = "（101个后来除外）DOI批量承授人"
 repository_item_enterjalcdoi_all_check = "我檢查所有的JaLC DOI "
-repository_item_entercrossref_all_check = "我檢查所有的交叉索引"
+repository_item_entercrossref_all_check = "我檢查所有的Cross Ref "
+repository_item_enterdatacite_all_check = "我檢查所有的DataCite "
+repository_item_doi_count_msg = "我被授予%s评测DOI"
+repository_item_enterdoi_error = "它不符合用於施加DOI的條件"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "搜索中刪除"
+repository_item_search_delete_title = "稱號"
+repository_item_search_delete_button_title = "刪除項目"
+repository_item_search_delete_search = "請運行關鍵字搜索"
+repository_item_search_delete_num = "%s我已刪除"
+repository_item_search_delete_error_no_check = "請把支票"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "指數"
@@ -1190,6 +1276,7 @@ repository_import_error_msg_flash_pub_date = "該文件的閃存出版日期格
 repository_import_error_msg_item_type = "無法找到該項目的項目類型的信息"
 repository_import_error_msg_edit_item_url = "在repository_edit標籤中指定的域不與本網站相匹配"
 repository_import_error_msg_edit_item_num = "repository_edit標籤有多於一個"
+repository_import_error_msg_can_not_use_item_type = "您沒有權限使用的項目類型"
 
 repository_importauthority_result_title = "輸入名稱規範。"
 repository_importauthority_result_success = "作者成功導入。"
@@ -1221,7 +1308,7 @@ repository_mapping_confirm = "測繪確認"
 repository_mapping_name = "元數據名稱映射確認"
 repository_mapping_inputtype = "輸入類型"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "語言類型"
@@ -1243,7 +1330,10 @@ repository_detail_hidden_metadata = "▲ 隱藏的元數據 ▲"
 repository_detail_show_usagestatistics = "使用統計"
 repository_detail_openaccess = "它是下載的年/月/日。"
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "從下個月使用統計我"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "可下載 ： "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "瀏覽次數"
@@ -1286,6 +1376,9 @@ repository_log_refer = "參考"
 repository_log_of = " 的 "
 repository_log_num = " 數"
 repository_log_period = "期間"
+repository_log_set_exclude_address = "将排除的IP地址"
+repository_log_update_exclude_address = "排除的IP地址设置。"
+repository_log_announce_update_clowler_list = "请从管理执行日志排除。"
 repository_log_print = "打印"
 repository_log_item_view = "查看數項"
 repository_log_nodata = "沒有匹配的數據"
@@ -1315,6 +1408,8 @@ repository_rank_newitem = "新項目"
 repository_rank_newitem_pubdate = "出版日期"
 repository_rank_thumbnail = "縮略圖"
 repository_rank_link_title = "文件下載"
+repository_rank_statistics_period = "統計週期："
+repository_rank_registration_date = "注册日期："
 
 ;Tree
 repository_index_tree = "索引樹"
@@ -1380,6 +1475,14 @@ repository_edittree_post_sitelicense_user = "我聚集在這個索引中的項
 repository_edittree_online_issn_warning = "※值遞歸反映到子索引"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "設置子指標的公佈日期遞歸"
+repository_edittree_pdf_cover_recursive = "遞歸子集索引的PDF封面"
+repository_edittree_exclusive_acl_role_ids_recursive = "設置子索引的基當局遞歸"
+repository_edittree_exclusive_acl_room_auth_recursive = "設置子索引的房間當局遞歸"
+repository_edittree_exclusive_acl_group_ids_recursive = "設置子指標的組當局遞歸"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "無效的發布日期"
 repository_edittree_nodenameerror = "輸入一個字符串，超過2個字符"
@@ -1502,18 +1605,28 @@ repository_item_date_error = "無效的日期"
 repository_item_embargo_open = "開放存取文件中沒有設置價格"
 repository_item_embargo_no_download = "私人文件沒有設置價格"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "你可以不設置開放訪問權限"
+repository_item_embargo_file_authority_no_download = "你不能設置權限，如果你不公佈"
+repository_item_set_file_authority = "請設置組，以允許該文件的下載"
+repository_item_file_authority_attention = "集團尚未設置無法下載文件"
+repository_item_add_file_authority = "權限設置"
+repository_item_download_file_authority = "下載權限設置"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "書目DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "書目數據庫沒有被選中"
 repository_item_fill_data_no_id_error = "輸入搜索ID不"
 repository_item_fill_data_no_data_error = "無法得到填充數據"
@@ -1524,11 +1637,19 @@ repository_item_fill_data_no_metadata_error = ": 元數據採集出了錯。"
 repository_item_fill_data_access_error = "無法進行訪問。"
 repository_item_fill_data_callback_admin = "請詢問管理員。"
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "授予JaLC DOI "
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "降JaLC DOI "
-repository_item_enter_crossref = "格蘭特交叉索引 "
-repository_item_delete_crossref = "降交叉索引 "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "降JaLC CrossRef DOI "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "降JaLC DataCite DOI "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "降Multiple Resolution "
@@ -1600,6 +1721,12 @@ repository_item_msg_selectlicense = "選擇許可證"
 repository_item_file_free_licence = "形容自己的許可證"
 repository_item_set_index = "選擇集索引"
 repository_item_file_not_input = "文件沒有註冊"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "您確定要取消？"
diff --git a/repository/language/chinese/main.ini b/repository/language/chinese/main.ini
index 8f3f36d..fd522b6 100644
--- a/repository/language/chinese/main.ini
+++ b/repository/language/chinese/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "拒绝的理由 : "
 repository_mail_review_supple_reject_close = "拒绝补充内容已被移动到“未登记的”。"
 repository_mail_review_supple_setting = "如果你不再需要接收电子邮件通知审查结果，请点击这里更改设置。"
 repository_mail_review_supple_setting_url = "设置页面的URL"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId补充WEKO尚未设置。"
+repository_entry_no_prefix_id = "PrefixId尚未设置。"
+repository_entry_no_supple_weko_url = "补充WEKOURL网址尚未设置。抱歉打扰你，但请与管理员联系"
+repository_entry_invalid_supple_contents_url = "您指定的补充内容URL无效。请检查补充内容URL。"
+repository_entry_invalid_all_supple_contents_url = "您指定的补充内容URL都是非法值。请检查补充内容URL。"
+repository_entry_failed_entry_supple_contents = "我没能注册补充内容。"
+repository_entry_failed_some_of_supple_entry = "有失败的注册的补充内容。"
+repository_entry_exist_supple_contents = "补充内容已经注册。"
+repository_delete_failed_delete_supple_contents = "这是不可能的，删除的补充内容"
+repository_update_failed_update_supple_contents = "无法更新补充内容"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "无法显示嵌入式框架的浏览器不对应。"
 repository_help_link_here = "这里"
@@ -201,6 +212,7 @@ repository_log_report = "固定报告"
 repository_log_custom = "自定义报表"
 repository_log_is_sitelicense = "站点许可证"
 repository_log_not_sitelicense = "否则精英许可证"
+repository_log_sitelicense_member = "站点许可证成员"
 repository_log_total = "总"
 repository_log_organization = "组织"
 repository_log_weko_top = "WEKO顶页"
@@ -225,6 +237,7 @@ repository_log_download_admin = "帮助"
 repository_log_download_register = "注册"
 repository_log_download_deleted_group = "删除组"
 repository_log_index_report_title = "细节接入面值指数"
+repository_log_index = "指数"
 
 repository_log_index_detail_access_total = "总详细访问"
 repository_log_start_month = "设置启动一个月"
@@ -257,6 +270,11 @@ repository_log_update_OK = "进入OK"
 repository_log_update_NG = "进入NG"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "访问参数主机"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "搜索關鍵詞排行"
+repository_search_keyword_name = "搜索關鍵字"
+repository_search_num = "搜索次數"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[下载] : "
 repository_sitelicense_mail_subject = "站点许可证使用情况统计"
 repository_sitelicense_mail_body_dear = "%s 状"
 repository_sitelicense_mail_body_thank = "感谢您使用的%s。"
-repository_sitelicense_mail_body_announcement = "我们会送你一个站点许可证使用情况统计。"
+repository_sitelicense_mail_body_announcement = "这是在%s的网站牌照访问的使用情况统计报告。"
 repository_sitelicense_mail_body_unnecessary = "如果不需要此邮件，抱歉给您添麻烦，但是请联系管理员(%s)。"
 repository_sitelicense_mail_body_explain_rule_1 = "◆我已经计数的访问次数，将IP地址范围，为每个注册的。"
 repository_sitelicense_mail_body_explain_rule_2 = "（如果要注册多个IP地址范围，此邮件将多种交付。）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "上傳失敗%s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "后面"
 
@@ -456,7 +478,9 @@ repository_execute = "执行"
 repository_commit = "犯"
 repository_edit = "编辑"
 repository_public = "公众"
+repository_public_change = "改变公众"
 repository_private = "私人"
+repository_private_change = "改变私人"
 repository_upload = "上载"
 repository_export = "出口"
 repository_import = "进口"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "IP地址范围"
 repository_admin_site_license_from = "从"
 repository_admin_site_license_to = "至"
 repository_admin_site_license_addrow = "更多的输入行"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "指数显示设置"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "电子邮件"
 repository_admin_site_license_from_to = "（从 - 到）"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "组织名称"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "排除地址"
 repository_admin_log_address = "请指定互联网协议地址日志分析排除"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "自动设置"
 repository_admin_server_cmmdpath = "外部命令的绝对路径"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "PrefixID格式無效"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "文献记录信息填写从其他网站"
 repository_admin_AWSAccessKeyId = "AWS访问密钥ID"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "目前的状态："
 repository_admin_IchushiLogin_attestation = "认证"
 repository_admin_IchushiLogin_no_attestation = "Unattested"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "CrossRef查詢服務的帳號"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "机构名称"
+repository_admin_institution_name_explanation = "机构名称(英文推荐)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "前缀标识"
 repository_admin_ranking_disp_setting = "显示设置"
 repository_admin_ranking_disp_realtime = "要更新实时排名信息"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "货币设置"
 repository_admin_index_search = "索引搜索"
 repository_admin_keyword_search = "关键字搜索"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "機構內部ID"
+repository_admin_add_prefix = "添加"
+repository_admin_do_not_add_prefix = "不添加"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "前缀ID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,10 @@ repository_admin_icon_display_setting = "图标显示设置"
 repository_admin_icon_display_setting_help = "设置帮助图标设置"
 repository_admin_icon_display_setting_oaiore = "OAI-ORE设置图标设置"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "使用统计链接显示设置"
+repository_admin_usagestatistics_link_display = "使用统计显示链接"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "作者ID前缀设置"
 repository_admin_author_id_prefix_edit = "作者ID前缀编辑"
@@ -864,6 +913,13 @@ repository_admin_privatetree_indexname_sort_desc = "指数名称排序（降序
 repository_admin_privatetree_parent_index = "注册索引 "
 repository_admin_privatetree_writable_notice = "*当有一种[web应用/模块/资源库/配置/ define.inc.php]没有写入权限，私人树的设置不能更改。"
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "日志删除的排除"
+repository_admin_robotlist_now_executing = "现在执行的..."
+repository_admin_robotlist_process_kill = "杀死进程"
+repository_admin_robotlist_common_crawler_list = "共享履带列表"
+repository_admin_robotlist_no_robotlist = "没有获得机器人列表"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "更新使用统计"
 repository_admin_update_usage_statistics_comment = "更新使用统计..."
@@ -898,6 +954,12 @@ repository_admin_sitelicense_send_mail_activate = "激活网站发送邮件牌"
 repository_admin_sitelicense_send_mail_running = "开始发送站点许可证的邮件..."
 repository_admin_sitelicense_send_mail_errorMsg = "无法发送站点许可证的邮件。"
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "搜索设置"
+repository_admin_default_search_type = "默认搜索设置"
+repository_admin_detail_search_type = "全文"
+repository_admin_simple_search_type = "简单"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1093,13 @@ repository_item_embargo_index_error = "适用规则，指定索引"
 repository_item_embargo_select_index = "从树中选择索引"
 repository_item_embargo_registered_index = "该指数已经注册ELS"
 repository_item_embargo_free_licence = "形容自己的许可证"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "排序顺序设置"
 repository_item_sortorder_target_index = "显示变更目标指数"
@@ -1043,17 +1112,35 @@ repository_item_listdelete_target_index = "删除索引"
 repository_item_listdelete_delete_button_title = "删除项目"
 repository_item_listdelete_sub_index = "子索引项也删除"
 repository_item_listdelete_select_index_list_default = "请选择索引"
+repository_item_listdelete_selsect_index_or_search_keyword = "
+請運行或關鍵字搜索來選擇指數"
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "交叉参考"
-repository_item_edit_item_name = "项目"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "稱號"
 repository_item_edit_select = "请选择"
+repository_item_add_doi = "DOI補助"
 repository_item_enterdoi = "DOI散批"
 repository_item_enterdoi_target_index = "DOI批量承授人指數"
 repository_item_enterdoi_target_item = "（101個後來除外）DOI批量承授人"
 repository_item_enterjalcdoi_all_check = "我检查所有的JaLC DOI "
-repository_item_entercrossref_all_check = "我检查所有的交叉索引"
+repository_item_entercrossref_all_check = "我检查所有的Cross Ref "
+repository_item_enterdatacite_all_check = "我检查所有的DataCite "
+repository_item_doi_count_msg = "我被授予%s評測DOI"
+repository_item_enterdoi_error = "它不符合用于施加DOI的条件"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "搜索中删除"
+repository_item_search_delete_title = "称号"
+repository_item_search_delete_button_title = "删除项目"
+repository_item_search_delete_search = "请运行关键字搜索"
+repository_item_search_delete_num = "%s我已删除"
+repository_item_search_delete_error_no_check = "请把支票"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "指数"
@@ -1190,6 +1277,7 @@ repository_import_error_msg_flash_pub_date = "该文件的闪存出版日期格
 repository_import_error_msg_item_type = "无法找到该项目的项目类型的信息"
 repository_import_error_msg_edit_item_url = "在repository_edit标签中指定的域不与本网站相匹配"
 repository_import_error_msg_edit_item_num = "repository_edit标签有多于一个"
+repository_import_error_msg_can_not_use_item_type = "您没有权限使用的项目类型"
 
 repository_importauthority_result_title = "输入名称规范。"
 repository_importauthority_result_success = "作者成功导入。"
@@ -1221,7 +1309,7 @@ repository_mapping_confirm = "测绘确认"
 repository_mapping_name = "元数据名称"
 repository_mapping_inputtype = "输入类型"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "语言类型"
@@ -1243,7 +1331,10 @@ repository_detail_hidden_metadata = "▲ 隐藏的元数据 ▲"
 repository_detail_show_usagestatistics = "使用统计"
 repository_detail_openaccess = "它是从下载 YYYY/MM/DD."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "从下个月使用统计我"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "可下载 ： "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "浏览次数"
@@ -1286,6 +1377,9 @@ repository_log_refer = "参考"
 repository_log_of = " 的 "
 repository_log_num = " 数"
 repository_log_period = "期间"
+repository_log_set_exclude_address = "將排除的IP地址"
+repository_log_update_exclude_address = "排除的IP地址設置。"
+repository_log_announce_update_clowler_list = "請從管理執行日誌排除。"
 repository_log_print = "打印"
 repository_log_item_view = "查看数项"
 repository_log_nodata = "没有匹配的数据"
@@ -1315,6 +1409,8 @@ repository_rank_newitem = "新项目"
 repository_rank_newitem_pubdate = "出版日期"
 repository_rank_thumbnail = "缩略图"
 repository_rank_link_title = "文件下载"
+repository_rank_statistics_period = "统计周期："
+repository_rank_registration_date = "註冊日期："
 
 ;Tree
 repository_index_tree = "索引树"
@@ -1380,6 +1476,14 @@ repository_edittree_post_sitelicense_user = "发表SiteLicense用户本杂志日
 repository_edittree_online_issn_warning = "*设置反映到所有子索引"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "设置子指标的公布日期递归"
+repository_edittree_pdf_cover_recursive = "递归子集索引的PDF封面"
+repository_edittree_exclusive_acl_role_ids_recursive = "设置子索引的基当局递归"
+repository_edittree_exclusive_acl_room_auth_recursive = "设置子索引的房间当局递归"
+repository_edittree_exclusive_acl_group_ids_recursive = "设置子指标的组当局递归"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "无效的发布日期"
 repository_edittree_nodenameerror = "输入一个字符串，超过2个字符"
@@ -1502,18 +1606,28 @@ repository_item_date_error = "无效的日期"
 repository_item_embargo_open = "开放存取文件中没有设置价格"
 repository_item_embargo_no_download = "私人文件没有设置价格"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "你可以不设置开放访问权限"
+repository_item_embargo_file_authority_no_download = "你不能设置权限，如果你不公布"
+repository_item_set_file_authority = "请设置组，以允许该文件的下载"
+repository_item_file_authority_attention = "集团尚未设置无法下载文件"
+repository_item_add_file_authority = "权限设置"
+repository_item_download_file_authority = "下载权限设置"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "书目DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "书目数据库没有被选中"
 repository_item_fill_data_no_id_error = "输入搜索ID不"
 repository_item_fill_data_no_data_error = "无法得到填充数据"
@@ -1524,11 +1638,19 @@ repository_item_fill_data_no_metadata_error = ": 元数据采集出了错。"
 repository_item_fill_data_access_error = "无法进行访问。"
 repository_item_fill_data_callback_admin = "请询问管理员。"
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "授予JaLC DOI "
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "降JaLC DOI "
-repository_item_enter_crossref = "格兰特交叉索引 "
-repository_item_delete_crossref = "降交叉索引 "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "降JaLC CrossRef DOI "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "降JaLC DataCite DOI "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "降Multiple Resolution "
@@ -1600,6 +1722,12 @@ repository_item_msg_selectlicense = "选择许可证"
 repository_item_file_free_licence = "形容自己的许可证"
 repository_item_set_index = "选择集索引"
 repository_item_file_not_input = "文件没有注册"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "您确定要取消？"
diff --git a/repository/language/english/main.ini b/repository/language/english/main.ini
index 341918c..03708e2 100644
--- a/repository/language/english/main.ini
+++ b/repository/language/english/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "Rejected Reason : "
 repository_mail_review_supple_reject_close = "Rejected supplemental contents has been moved to 'Under Registration'."
 repository_mail_review_supple_setting = "If you no longer need to receive email notification of review results, please click here to change the settings."
 repository_mail_review_supple_setting_url = "Setting Page URL"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixID of SuppleWEKO has not been set."
+repository_entry_no_prefix_id = "PrefixID has not been set. Please contact the repository manager."
+repository_entry_no_supple_weko_url = "Supplemental WEKO URL has not been set. Please contact the repository manager."
+repository_entry_invalid_supple_contents_url = "Invalid Supplemental Contents URL. Please check Supplemental Contents URL."
+repository_entry_invalid_all_supple_contents_url = "Invalid Supplemental Contents URL of all. Please check Supplemental Contents URL."
+repository_entry_failed_entry_supple_contents = "Failed to entry Supplemental Contents. "
+repository_entry_failed_some_of_supple_entry = "Failed to some of Supplemental Contents registration."
+repository_entry_exist_supple_contents = "Exist Supplemental Contents."
+repository_delete_failed_delete_supple_contents = "Failed to delete Supplemental Contents."
+repository_update_failed_update_supple_contents = "Failed to update Supplemental Contents. "
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "Unable to display inline frames because the browser does not compatible to show it."
 repository_help_link_here = "here"
@@ -201,6 +212,7 @@ repository_log_report = "Fixed Format Report"
 repository_log_custom = "Customized Report"
 repository_log_is_sitelicense = "Site License User: UNIT0"
 repository_log_not_sitelicense = "Not Site License"
+repository_log_sitelicense_member = "Site License Member"
 repository_log_total = "Total"
 repository_log_organization = "Organization"
 repository_log_weko_top = "WEKO Top Page"
@@ -225,6 +237,7 @@ repository_log_download_admin = "Admin"
 repository_log_download_register = "Register"
 repository_log_download_deleted_group = "DeletedGroup"
 repository_log_index_report_title = "Total access to item detail page by index"
+repository_log_index = "Index"
 
 repository_log_index_detail_access_total = "Total access to item detail page"
 repository_log_start_month = "Select Month"
@@ -257,6 +270,11 @@ repository_log_update_OK = "Entry OK"
 repository_log_update_NG = "Entry NG"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "Access par host"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "Search Keyword Ranking"
+repository_search_keyword_name = "Search keyword"
+repository_search_num = "Search Count"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -339,8 +357,8 @@ repository_feedback_mail_body_downloads = "[Downloads] : "
 ;for sitelicense mail
 repository_sitelicense_mail_subject = "Site License Usage Statistics Report"
 repository_sitelicense_mail_body_dear = "Dear %s Esq."
-repository_sitelicense_mail_body_thank = "Thank you for using the $s."
-repository_sitelicense_mail_body_announcement = "This is a usage statistics report under the site license access."
+repository_sitelicense_mail_body_thank = "Thank you for using the %s."
+repository_sitelicense_mail_body_announcement = "This is a usage statistics report under the site license access of %s."
 repository_sitelicense_mail_body_unnecessary = "If you no longer need to recieve this feedback mail anymore, please contact the repository manager."
 repository_sitelicense_mail_body_explain_rule_1 = "◆Counting the number of accesses to the IP address range for each that are registered."
 repository_sitelicense_mail_body_explain_rule_2 = "(If you are registering a plurality of IP address range, this mail will be multiple delivery.)"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "failed to upload %s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "Back"
 
@@ -456,7 +478,9 @@ repository_execute = "Execute"
 repository_commit = "Commit"
 repository_edit = "Edit"
 repository_public = "Public"
+repository_public_change = "Change to Public"
 repository_private = "Private"
+repository_private_change = "Change to Private"
 repository_upload = "Upload"
 repository_export = "Export"
 repository_import = "Import"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "IP Adress Range"
 repository_admin_site_license_from = "from"
 repository_admin_site_license_to = "to"
 repository_admin_site_license_addrow = "More Input Row"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "Ranking display setting"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "e-mail address"
 repository_admin_site_license_from_to = "(from - to)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "OrganizationName"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "Exclude IP Address"
 repository_admin_log_address = "Please specify IP addresses to be excluded from the log analysis."
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "Auto Setting"
 repository_admin_server_cmmdpath = "Absolute Path to External Command"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "ID Prefix Setting"
+repository_admin_prefix_incorrect = "PrefixID format is invalid"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "Bibliographic Informatoin Fill Function Setting"
 repository_admin_AWSAccessKeyId = "AWSAccessKeyId"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "Status : "
 repository_admin_IchushiLogin_attestation = "Authorized"
 repository_admin_IchushiLogin_no_attestation = "Unauthorized"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "CrossRef Query Services Account"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "Institution Name"
+repository_admin_institution_name_explanation = "Institution Name (English Recommended)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "PrefixID"
 repository_admin_ranking_disp_setting = "Display setting"
 repository_admin_ranking_disp_realtime = "Update ranking information in real time"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "Currency Setting"
 repository_admin_index_search = "Index Search"
 repository_admin_keyword_search = "Keyword Search"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "JaLC DOI Prefix"
-repository_admin_get_cross_ref_doi = "CrossRef DOI Prefix"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "Agency internal ID"
+repository_admin_add_prefix = "Add"
+repository_admin_do_not_add_prefix = "Do not add"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "CNRI Handle Prefix"
 repository_admin_get_prefixid = "NII ID Server Prefix ID"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,11 @@ repository_admin_icon_display_setting = "Icon Display Setting"
 repository_admin_icon_display_setting_help = "Help Icon"
 repository_admin_icon_display_setting_oaiore = "OAI-ORE Icon"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "
+Usage statistics link display settings"
+repository_admin_usagestatistics_link_display = "Usage statistics link display"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "AuthorID Prefix Setting"
 repository_admin_author_id_prefix_edit = "AuthorID Prefix"
@@ -864,6 +914,13 @@ repository_admin_privatetree_indexname_sort_desc = "Index Name(descending order)
 repository_admin_privatetree_parent_index = "Parent Index to assign Private Index"
 repository_admin_privatetree_writable_notice = "* Since the system has no write permission to [webapp/modules/repository/config/define.inc.php], configuration for private tree cannot be completed. "
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "Log deletion of excluded"
+repository_admin_robotlist_now_executing = "Now executing..."
+repository_admin_robotlist_process_kill = "Kill process"
+repository_admin_robotlist_common_crawler_list = "Shared crawler list"
+repository_admin_robotlist_no_robotlist = "There is no acquired robot list"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "Update Usage Statistics"
 repository_admin_update_usage_statistics_comment = "Updating usage statistics..."
@@ -898,6 +955,12 @@ repository_admin_sitelicense_send_mail_activate = "Activate for sending site lic
 repository_admin_sitelicense_send_mail_running = "Start send site license mail..."
 repository_admin_sitelicense_send_mail_errorMsg = "Failed send site license mail."
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "Search Setting"
+repository_admin_default_search_type = "Default Search Setting"
+repository_admin_detail_search_type = "Full Text"
+repository_admin_simple_search_type = "Simple"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1094,13 @@ repository_item_embargo_index_error = "Specify an index which apply the rule."
 repository_item_embargo_select_index = "Select index from the tree."
 repository_item_embargo_registered_index = "This index has already been registered to ELS"
 repository_item_embargo_free_licence = "Describe your own license"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "Sort Order Setting"
 repository_item_sortorder_target_index = "Index to be changed their sort order"
@@ -1043,17 +1113,34 @@ repository_item_listdelete_target_index = "Target index to delete their items"
 repository_item_listdelete_delete_button_title = "Delete Items"
 repository_item_listdelete_sub_index = "Delete items belong to sub-index as well"
 repository_item_listdelete_select_index_list_default = "Please select the index"
+repository_item_listdelete_selsect_index_or_search_keyword = "Please select the index or search by keywords."
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "Cross Ref"
-repository_item_edit_item_name = "Item"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "Title"
 repository_item_edit_select = "Please select"
+repository_item_add_doi = "DOI grant"
 repository_item_enterdoi = "DOI Bulk Assignment"
 repository_item_enterdoi_target_index = "Index to apply DOI bulk assignment"
 repository_item_enterdoi_target_item = "Items to assign DOI (Items after 101st are unable to assign)"
 repository_item_enterjalcdoi_all_check = "Check All JaLC DOI"
 repository_item_entercrossref_all_check = "Check All Cross Ref"
+repository_item_enterdatacite_all_check = "Check All DataCite"
+repository_item_doi_count_msg = "granted %s items DOI"
+repository_item_enterdoi_error = "It does not meet the conditions for applying the DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "Search Delete"
+repository_item_search_delete_title = "Title"
+repository_item_search_delete_button_title = "Delete items"
+repository_item_search_delete_search = "Please search by keywords."
+repository_item_search_delete_num = "%s items have been deleted."
+repository_item_search_delete_error_no_check = "Please put a check."
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "Index"
@@ -1190,6 +1277,7 @@ repository_import_error_msg_flash_pub_date = "The form of flash_pub_date of a fi
 repository_import_error_msg_item_type = "The item type information on an item is not found"
 repository_import_error_msg_edit_item_url = "The domain specified with the repository_edit tag is not in agreement with this site"
 repository_import_error_msg_edit_item_num = "Two or more repository_edit tags exist"
+repository_import_error_msg_can_not_use_item_type = "You do not have permission to use the item type"
 
 repository_importauthority_result_title = "Import name authority data."
 repository_importauthority_result_success = "items successfully imported."
@@ -1221,7 +1309,7 @@ repository_mapping_confirm = "Mapping Confirmation"
 repository_mapping_name = "Metadata Name"
 repository_mapping_inputtype = "Input Type"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "Language Type"
@@ -1243,7 +1331,10 @@ repository_detail_hidden_metadata = "▲ Hide Metadata ▲"
 repository_detail_show_usagestatistics = "Show Usage Statistics"
 repository_detail_openaccess = "It is downloadable from YYYY/MM/DD."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "Usagestatistics can be used from next month."
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "Download Allowed : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "Views"
@@ -1286,6 +1377,9 @@ repository_log_refer = "View"
 repository_log_of = " -> "
 repository_log_num = " Count"
 repository_log_period = "Period"
+repository_log_set_exclude_address = "Set the Excluded IP Address"
+repository_log_update_exclude_address = "Excluded IP Address was set."
+repository_log_announce_update_clowler_list = "Please execute log exclusion from Management."
 repository_log_print = "Print"
 repository_log_item_view = "View count for item"
 repository_log_nodata = "There is no matched data."
@@ -1315,6 +1409,8 @@ repository_rank_newitem = "New Items"
 repository_rank_newitem_pubdate = "Publication date"
 repository_rank_thumbnail = "Thumbnail"
 repository_rank_link_title = "File download"
+repository_rank_statistics_period = "Statistics Period:"
+repository_rank_registration_date = "Registration Date :"
 
 ;Tree
 repository_index_tree = "Index Tree"
@@ -1380,6 +1476,14 @@ repository_edittree_post_sitelicense_user = "Calculate statistics of items belon
 repository_edittree_online_issn_warning = "* The configuration is applied to all child indexes."
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "Set the publication date of child indexes recursively"
+repository_edittree_pdf_cover_recursive = "Set the pdf cover page of child indexes recursively"
+repository_edittree_exclusive_acl_role_ids_recursive = "Set the base authorities of child indexes recursively"
+repository_edittree_exclusive_acl_room_auth_recursive = "Set the room authorities of child indexes recursively"
+repository_edittree_exclusive_acl_group_ids_recursive = "Set the group authorities of child indexes recursively"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "Invalid publication date."
 repository_edittree_nodenameerror = "Input strings more than 2 characters"
@@ -1502,18 +1606,28 @@ repository_item_date_error = "Invalid date"
 repository_item_embargo_open = "You cannot define the price since this is an open access item."
 repository_item_embargo_no_download = "You cannot define the price since this item is not yet open to public."
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "You can not set permissions for open access"
+repository_item_embargo_file_authority_no_download = "You can not set permissions if you do not publish"
+repository_item_set_file_authority = "Please set the group to allow the download of the file"
+repository_item_file_authority_attention = "Group that has not been set can not download the file"
+repository_item_add_file_authority = "Authority setting"
+repository_item_download_file_authority = "Download permission settings"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "Bibliographic DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "Bibliographic database has not been selected"
 repository_item_fill_data_no_id_error = "Search ID is not entered"
 repository_item_fill_data_no_data_error = "Could not get fill data"
@@ -1524,11 +1638,19 @@ repository_item_fill_data_no_metadata_error = ": Metadata acquisition went wrong
 repository_item_fill_data_access_error = "was not able to be accessed."
 repository_item_fill_data_callback_admin = "Please ask your repository administrator."
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "Grant JaLC DOI"
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "Drop JaLC DOI"
-repository_item_enter_crossref = "Grant Cross Ref"
-repository_item_delete_crossref = "Drop Cross Ref"
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "Drop JaLC CrossRef DOI"
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "Drop JaLC DataCite DOI"
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "Drop Multiple Resolution "
@@ -1600,6 +1722,12 @@ repository_item_msg_selectlicense = "select license"
 repository_item_file_free_licence = "describe your own license"
 repository_item_set_index = "select set index"
 repository_item_file_not_input = "No file registered."
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "Are you sure you want to cancel?"
diff --git a/repository/language/hindi/main.ini b/repository/language/hindi/main.ini
index 2288fc6..40a3839 100644
--- a/repository/language/hindi/main.ini
+++ b/repository/language/hindi/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "कारण अस्वीक
 repository_mail_review_supple_reject_close = "अस्वीकृत पूरक सामग्री 'अपंजीकृत' करने के लिए ले जाया गया है."
 repository_mail_review_supple_setting = "आप नहीं रह समीक्षा परिणामों के ईमेल सूचना प्राप्त करने की आवश्यकता है, सेटिंग में बदलाव करने के लिए यहाँ क्लिक करें."
 repository_mail_review_supple_setting_url = "स्थापना पेज URL"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId के पूरक WEKO पक्ष सेट नहीं किया गया है. व्यवस्थापक करने के लिए संपर्क करें"
+repository_entry_no_prefix_id = "PrefixId सेट नहीं किया गया है. व्यवस्थापक करने के लिए संपर्क करें"
+repository_entry_no_supple_weko_url = "पूरक WEKO URL निर्धारित नहीं किया गया है. व्यवस्थापक करने के लिए संपर्क करें"
+repository_entry_invalid_supple_contents_url = "आपके द्वारा निर्दिष्ट पूरक सामग्री URL अमान्य मान है. पूरक सामग्री URL की जाँच करें।"
+repository_entry_invalid_all_supple_contents_url = "आप निर्दिष्ट सभी पूरक सामग्री URL अमान्य मान है।. पूरक सामग्री URL की जाँच करें।"
+repository_entry_failed_entry_supple_contents = "मैं पूरक सामग्री रजिस्टर करने में विफल रहा।"
+repository_entry_failed_some_of_supple_entry = "रजिस्टर करने में विफल रहा है कि एक निवेदक सामग्री नहीं है"
+repository_entry_exist_supple_contents = "पूरक सामग्री पहले से ही पंजीकृत है।"
+repository_delete_failed_delete_supple_contents = "मैं निवेदक सामग्री हटाने में विफल"
+repository_update_failed_update_supple_contents = "मैं पूरक सामग्री को अद्यतन करने में विफल"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "इनलाइन तख्ते प्रदर्शित करने में असमर्थ ब्राउज़र के अनुरूप नहीं है."
 repository_help_link_here = "यहां"
@@ -201,6 +212,7 @@ repository_log_report = "फिक्स्ड रिपोर्ट"
 repository_log_custom = "कस्टम रिपोर्ट"
 repository_log_is_sitelicense = "स्थल लाइसेंस"
 repository_log_not_sitelicense = "किसी और साइट लाइसेंस"
+repository_log_sitelicense_member = "साइट लाइसेंस सदस्य"
 repository_log_total = "संपूर्ण"
 repository_log_organization = "संगठन"
 repository_log_weko_top = "WEKO शीर्ष पेज"
@@ -225,6 +237,7 @@ repository_log_download_admin = "प्रशासन"
 repository_log_download_register = "रजिस्टर"
 repository_log_download_deleted_group = "हटाए गएसमूह"
 repository_log_index_report_title = "विस्तार पहुँच बराबर सूचकांक"
+repository_log_index = "अनुक्रमणिका"
 
 repository_log_index_detail_access_total = "कुल विस्तार का उपयोग"
 repository_log_start_month = "माह शुरू सेट"
@@ -257,6 +270,11 @@ repository_log_update_OK = "प्रविष्टि ठीक"
 repository_log_update_NG = "प्रवेश एनजी"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "सममूल्य मेजबान का उपयोग"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "कीवर्ड रैंकिंग खोज"
+repository_search_keyword_name = "मुख्य शब्द ढूंडो"
+repository_search_num = "खोज गिनती"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[डाउनलोड] : "
 repository_sitelicense_mail_subject = "साइट लाइसेंस उपयोगकर्ता usagestatistics"
 repository_sitelicense_mail_body_dear = "प्रिय% s Esq."
 repository_sitelicense_mail_body_thank = "%s का उपयोग करने के लिए धन्यवाद."
-repository_sitelicense_mail_body_announcement = "साइट लाइसेंस उपयोगकर्ता usagestatistics भेजें."
+repository_sitelicense_mail_body_announcement = "यह %s की साइट लाइसेंस पहुँच के तहत एक उपयोग के आंकड़े रिपोर्ट है।"
 repository_sitelicense_mail_body_unnecessary = "यदि आप अब यह मेल करने की जरूरत है, व्यवस्थापक (% s) को मेल करें."
 repository_sitelicense_mail_body_explain_rule_1 = "◆मैं पंजीकृत हैं कि प्रत्येक के लिए IP पता श्रेणी में पहुंच की संख्या की गणना कर रहा है."
 repository_sitelicense_mail_body_explain_rule_2 = "（आप IP पता श्रेणी की अधिकता दर्ज कर रहे हैं, तो इस मेल एकाधिक वितरण किया जाएगा.）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "%s अपलोड होने में विफल"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "वापस"
 
@@ -456,7 +478,9 @@ repository_execute = "चलाना"
 repository_commit = "करना"
 repository_edit = "संपादित"
 repository_public = "सार्वजनिक"
+repository_public_change = "जनता के लिए बदलें"
 repository_private = "निजी"
+repository_private_change = "निजी क्षेत्र में बदलें"
 repository_upload = "अपलोड"
 repository_export = "निर्यात"
 repository_import = "आयात"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "आईपी ​​पते की स
 repository_admin_site_license_from = "से"
 repository_admin_site_license_to = "से"
 repository_admin_site_license_addrow = "अधिक इनपुट पंक्ति"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "सूचकांक के प्रदर्शन सेटिंग्स"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "ई - मेल पते"
 repository_admin_site_license_from_to = "(से - तक)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "संगठन का नाम"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "अपवर्जित पता "
 repository_admin_log_address = "लॉग विश्लेषण से बाहर रखा गया है इंटरनेट प्रोटोकॉल पता निर्दिष्ट करें"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "ऑटो सेटिंग"
 repository_admin_server_cmmdpath = "बाहरी कमांड में पूर्ण पथ"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "PrefixID प्रारूप अमान्य है"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "बाइबिल या पुस्तक संबंधी जानकारी अन्य साइट से भरना"
 repository_admin_AWSAccessKeyId = "AWSदेखाId"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "वर्तमान स्
 repository_admin_IchushiLogin_attestation = "अनुप्रमाणन"
 repository_admin_IchushiLogin_no_attestation = "अनुप्रमाणित"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "CrossRef के क्वेरी सेवा खाता"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "एजेंसी का नाम"
+repository_admin_institution_name_explanation = "एजेंसी का नाम (अंग्रेजी की सिफारिश की)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "उपसर्गID"
 repository_admin_ranking_disp_setting = "सेटिंग प्रदर्शित"
 repository_admin_ranking_disp_realtime = "वास्तविक समय में रैंकिंग जानकारी अद्यतन करने के लिए"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "मुद्रा सेटिंग"
 repository_admin_index_search = "सूचकांक खोज"
 repository_admin_keyword_search = "कीवर्ड खोज"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "एजेंसी आंतरिक आईडी"
+repository_admin_add_prefix = "जोड़ना"
+repository_admin_do_not_add_prefix = "जोड़ें नहीं"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "जाना उपसर्गID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,10 @@ repository_admin_icon_display_setting = "आइकन प्रदर्शन 
 repository_admin_icon_display_setting_help = "आइकन सेटिंग मदद सेट"
 repository_admin_icon_display_setting_oaiore = "OAI-ORE आइकन सेटिंग सेट"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "उपयोग के आंकड़े प्रदर्शन सेटिंग्स लिंक"
+repository_admin_usagestatistics_link_display = "उपयोग के आंकड़े कड़ी प्रदर्शन"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "लेखकID उपसर्ग सेटिंग"
 repository_admin_author_id_prefix_edit = "लेखकID उपसर्ग संपादित"
@@ -864,6 +913,13 @@ repository_admin_privatetree_indexname_sort_desc = "सूचकांक ना
 repository_admin_privatetree_parent_index = "पंजीकरण सूचकांक"
 repository_admin_privatetree_writable_notice = "*लिखने का अधिकार [webapp / modules / repository / विन्यासconfig / define.inc.php], एक निजी पेड़ की एक सेटअप नहीं बदला जा सकता है नहीं है जब वहाँ."
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "अपवर्जित का विलोपन लॉग इन करें"
+repository_admin_robotlist_now_executing = "अब क्रियान्वित करने..."
+repository_admin_robotlist_process_kill = "प्रक्रिया को मार डालो"
+repository_admin_robotlist_common_crawler_list = "साझा क्रॉलर सूची"
+repository_admin_robotlist_no_robotlist = "कोई अधिग्रहीत रोबोट सूची है"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "उपयोग के आंकड़े अपडेट"
 repository_admin_update_usage_statistics_comment = "उपयोग के आंकड़े को अपडेट करना..."
@@ -898,6 +954,12 @@ repository_admin_sitelicense_send_mail_activate = "साइट लाइसे
 repository_admin_sitelicense_send_mail_running = "भेजें साइट लाइसेंस मेल प्रारंभ करें ..."
 repository_admin_sitelicense_send_mail_errorMsg = "भेजें साइट लाइसेंस मेल में विफल."
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "खोज सेटिंग"
+repository_admin_default_search_type = "डिफ़ॉल्ट खोज सेटिंग"
+repository_admin_detail_search_type = "पूर्ण पाठ"
+repository_admin_simple_search_type = "सरल"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1093,13 @@ repository_item_embargo_index_error = "नियम लागू होते 
 repository_item_embargo_select_index = "पेड़ से सूचकांक का चयन"
 repository_item_embargo_registered_index = "इस सूचकांक में पहले से ही ELS के लिए पंजीकृत किया गया है"
 repository_item_embargo_free_licence = "अपने स्वयं के लाइसेंस का वर्णन"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "सॉर्ट क्रम सेटिंग"
 repository_item_sortorder_target_index = "परिवर्तन लक्ष्य सूचकांक प्रदर्शित"
@@ -1043,17 +1112,35 @@ repository_item_listdelete_target_index = "विलोपन के सूच
 repository_item_listdelete_delete_button_title = "आइटम हटा"
 repository_item_listdelete_sub_index = "उप सूचकांक आइटम भी नष्ट"
 repository_item_listdelete_select_index_list_default = "सूचकांक का चयन करें"
+repository_item_listdelete_selsect_index_or_search_keyword = "
+सूचकांक का चयन करने के लिए या कीवर्ड खोज चलाने कृपया"
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "क्रॉस रेफरी"
-repository_item_edit_item_name = "मद"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "शीर्षक"
 repository_item_edit_select = "का चयन करें"
+repository_item_add_doi = "डीओआई अनुदान"
 repository_item_enterdoi = "DOI थोक अनुदान"
 repository_item_enterdoi_target_index = "DOI थोक जागीरदार सूचकांक"
 repository_item_enterdoi_target_item = "DOI थोक grantees (101 आइटम बाद में छोड़ा गया है)"
 repository_item_enterjalcdoi_all_check = "मैं सभी JaLC DOI जाँच "
-repository_item_entercrossref_all_check = "मैं सब पार रेफरी की जांच"
+repository_item_entercrossref_all_check = "मैं सभी Cross Ref जाँच "
+repository_item_enterdatacite_all_check = "मैं सभी DataCite जाँच "
+repository_item_doi_count_msg = "मैं %s समीक्षा डीओआई प्रदान की गई थी"
+repository_item_enterdoi_error = "यह डीओआई लागू करने के लिए शर्तों को पूरा नहीं करता है।"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "हटाएँ खोज"
+repository_item_search_delete_title = "शीर्षक"
+repository_item_search_delete_button_title = "आइटम हटाएँ"
+repository_item_search_delete_search = "कीवर्ड खोज चलाने कृपया"
+repository_item_search_delete_num = "%s मैं हटा दिया है"
+repository_item_search_delete_error_no_check = "एक जांच डाल दीजिये"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "अनुक्रमणिका"
@@ -1190,6 +1277,7 @@ repository_import_error_msg_flash_pub_date = "फ़ाइल का फ्ल
 repository_import_error_msg_item_type = "आइटम के मद प्रकार की जानकारी नहीं पाया जा सकता"
 repository_import_error_msg_edit_item_url = "repository_edit टैग में निर्दिष्ट किया जाता है कि डोमेन इस साइट के साथ मेल नहीं खाता"
 repository_import_error_msg_edit_item_num = "repository_edit टैग वहाँ एक से अधिक है"
+repository_import_error_msg_can_not_use_item_type = "आप आइटम प्रकार का उपयोग करने की अनुमति नहीं है"
 
 repository_importauthority_result_title = "नाम प्राधिकरण आयात."
 repository_importauthority_result_success = "सफलतापूर्वक आयात लेखक."
@@ -1221,7 +1309,7 @@ repository_mapping_confirm = "मानचित्रण पुष्टि"
 repository_mapping_name = "मेटाडाटा नाम"
 repository_mapping_inputtype = "इनपुट प्रकार"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "भाषा प्रकार"
@@ -1243,7 +1331,11 @@ repository_detail_hidden_metadata = "▲ छुपे हुए मेटाड
 repository_detail_show_usagestatistics = "उपयोग के आँकड़े दिखाएँ"
 repository_detail_openaccess = "यह YYYY / MM / DD से डाउनलोड किए जा सकते है."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "
+अगले महीने से उपलब्ध उपयोग के आंकड़ों मैं"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "डाउनलोड करने योग्य : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "दृष्टिकोण"
@@ -1286,6 +1378,9 @@ repository_log_refer = "उल्लेख"
 repository_log_of = " की "
 repository_log_num = " संख्या"
 repository_log_period = "अवधि"
+repository_log_set_exclude_address = "बहिष्कृत IP पता सेट"
+repository_log_update_exclude_address = "अपवर्जित आईपी पता सेट किया गया था।"
+repository_log_announce_update_clowler_list = "प्रबंधन से प्रवेश बहिष्कार पर अमल करें।"
 repository_log_print = "प्रिंट"
 repository_log_item_view = "आइटम के लिए गिनती देखने"
 repository_log_nodata = "कोई मैच डाटा नहीं है"
@@ -1315,6 +1410,8 @@ repository_rank_newitem = "नए आइटम"
 repository_rank_newitem_pubdate = "प्रकाशन की तारीख"
 repository_rank_thumbnail = "थंबनेल"
 repository_rank_link_title = "डाउनलोड फ़ाइल"
+repository_rank_statistics_period = "सांख्यिकी अवधि:"
+repository_rank_registration_date = "पंजीकरण की तारीख:"
 
 ;Tree
 repository_index_tree = "सूचकांक पेड़ "
@@ -1380,6 +1477,14 @@ repository_edittree_post_sitelicense_user = "SiteLicense उपयोगकर
 repository_edittree_online_issn_warning = "* सभी बच्चे अनुक्रमित करने के लिए सेटिंग को प्रतिबिंबित"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "बारी बारी से बच्चे अनुक्रमित के प्रकाशन तिथि निर्धारित"
+repository_edittree_pdf_cover_recursive = "बारी बारी से बच्चे इंडेक्सेस की पीडीएफ कवर पेज सेट करें"
+repository_edittree_exclusive_acl_role_ids_recursive = "बारी बारी से बच्चे अनुक्रमित के आधार अधिकारियों सेट"
+repository_edittree_exclusive_acl_room_auth_recursive = "बारी बारी से बच्चे अनुक्रमित के कमरे अधिकारियों सेट"
+repository_edittree_exclusive_acl_group_ids_recursive = "बारी बारी से बच्चे अनुक्रमित के समूह अधिकारियों को सेट करें"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "अवैध तारीख प्रकाशित"
 repository_edittree_nodenameerror = "अधिक से अधिक 2 पात्रों के साथ एक स्ट्रिंग दर्ज"
@@ -1502,18 +1607,28 @@ repository_item_date_error = "अवैध तारीख"
 repository_item_embargo_open = "खुले उपयोग फ़ाइल कीमत निर्धारित नहीं है"
 repository_item_embargo_no_download = "निजी फाइल मूल्य निर्धारित नहीं किया गया है"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "आप खुले उपयोग के लिए अनुमतियों को निर्धारित नहीं कर सकते"
+repository_item_embargo_file_authority_no_download = "आप प्रकाशित नहीं करते हैं तो आप अनुमतियाँ निर्धारित नहीं कर सकते"
+repository_item_set_file_authority = "फाइल का डाउनलोड अनुमति देने के लिए समूह सेट करें"
+repository_item_file_authority_attention = "फाइल को डाउनलोड नहीं कर सकते सेट नहीं किया गया है कि समूह"
+repository_item_add_file_authority = "प्राधिकरण सेटिंग"
+repository_item_download_file_authority = "डाउनलोड अनुमति सेटिंग"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "Bibliographic DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "ग्रंथ सूची डेटाबेस चयनित नहीं किया गया है"
 repository_item_fill_data_no_id_error = "खोज ID दर्ज नहीं है"
 repository_item_fill_data_no_data_error = "भरण डेटा प्राप्त नहीं किया जा सका"
@@ -1524,11 +1639,19 @@ repository_item_fill_data_no_metadata_error = ": मेटाडाटा अध
 repository_item_fill_data_access_error = "पहुँचा जा करने में सक्षम नहीं था."
 repository_item_fill_data_callback_admin = "एक व्यवस्थापक से संपर्क करें."
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "JaLC DOI अनुदान "
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "JaLC DOI गिरा "
-repository_item_enter_crossref = "अनुदान क्रॉस रेफरी "
-repository_item_delete_crossref = "ड्रॉप क्रॉस रेफरी "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "JaLC CrossRef DOI गिरा "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "JaLC DataCite DOI गिरा "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "Multiple Resolution गिरा "
@@ -1600,6 +1723,12 @@ repository_item_msg_selectlicense = "लाइसेंस का चयन"
 repository_item_file_free_licence = "अपने स्वयं के लाइसेंस का वर्णन"
 repository_item_set_index = "सेट सूचकांक चयन"
 repository_item_file_not_input = "फाइल पंजीकृत नहीं"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "यदि आप रद्द करना चाहते हैं?"
diff --git a/repository/language/indonesia/main.ini b/repository/language/indonesia/main.ini
index e1df920..a48bf5d 100644
--- a/repository/language/indonesia/main.ini
+++ b/repository/language/indonesia/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "Tolak alasan : "
 repository_mail_review_supple_reject_close = "Isi tambahan Ditolak telah dipindahkan ke 'terdaftar'."
 repository_mail_review_supple_setting = "Jika Anda tidak perlu lagi menerima pemberitahuan email dari hasil review, silahkan klik disini untuk mengubah pengaturan."
 repository_mail_review_supple_setting_url = "Mengatur URL halaman"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "TambahanWeko sisi PrefixId belum ditetapkan"
+repository_entry_no_prefix_id = "PrefixId belum ditetapkan. Maaf untuk masalah Anda, tapi tolong hubungi administrator."
+repository_entry_no_supple_weko_url = "Tambahan Weko URL tidak diatur. Maaf untuk masalah Anda, tapi tolong hubungi administrator."
+repository_entry_invalid_supple_contents_url = "URL konten tambahan adalah nilai yang tidak valid. Silakan periksa isi URL tambahan"
+repository_entry_invalid_all_supple_contents_url = "URL konten tambahan adalah semua nilai yang ilegal. Silakan periksa isi URL tambahan"
+repository_entry_failed_entry_supple_contents = "gagal untuk mendaftar konten tambahan"
+repository_entry_failed_some_of_supple_entry = "Ada konten tambahan yang gagal untuk mendaftar"
+repository_entry_exist_supple_contents = "Konten tambahan yang sudah terdaftar"
+repository_delete_failed_delete_supple_contents = "Saya gagal untuk menghapus konten tambahan"
+repository_update_failed_update_supple_contents = "Saya gagal untuk memperbarui konten tambahan"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "Tidak dapat menampilkan inline frames tidak sesuai dengan browser."
 repository_help_link_here = "disini"
@@ -201,6 +212,7 @@ repository_log_report = "laporan tetap"
 repository_log_custom = "laporan kustom"
 repository_log_is_sitelicense = "lisensi situs"
 repository_log_not_sitelicense = "lisensi lain eite"
+repository_log_sitelicense_member = "Anggota Lisensi situs"
 repository_log_total = "total"
 repository_log_organization = "organisasi"
 repository_log_weko_top = "Halaman atas Weko"
@@ -225,6 +237,7 @@ repository_log_download_admin = "Admin"
 repository_log_download_register = "daftar"
 repository_log_download_deleted_group = "KelompokDihapus"
 repository_log_index_report_title = "rinci akses indeks par"
+repository_log_index = "indeks"
 
 repository_log_index_detail_access_total = "akses total detail"
 repository_log_start_month = "ditetapkan mulai bulan"
@@ -257,6 +270,11 @@ repository_log_update_OK = "entri OK"
 repository_log_update_NG = "entri NG"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "mengakses par tuan"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "Cari Kata Kunci Ranking"
+repository_search_keyword_name = "pencarian kata kunci"
+repository_search_num = "Cari Hitungan"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[Download] : "
 repository_sitelicense_mail_subject = "usagestatistics lisensi situs pengguna"
 repository_sitelicense_mail_body_dear = "Sayang% s Esq."
 repository_sitelicense_mail_body_thank = "%s Terima kasih telah menggunakan."
-repository_sitelicense_mail_body_announcement = "mengirim situs usagestatistics lisensi pengguna."
+repository_sitelicense_mail_body_announcement = "Ini adalah laporan statistik penggunaan di bawah lisensi akses situs %s."
 repository_sitelicense_mail_body_unnecessary = "Jika Anda tidak perlu lagi surat ini, silahkan email ke admin (% s)."
 repository_sitelicense_mail_body_explain_rule_1 = "◆Aku sudah menghitung jumlah akses ke berbagai alamat IP untuk setiap yang terdaftar."
 repository_sitelicense_mail_body_explain_rule_2 = "（Jika Anda mendaftarkan sejumlah kisaran alamat IP, email ini akan ada beberapa pengiriman.）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "gagal untuk meng-upload %s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "kembali"
 
@@ -456,7 +478,9 @@ repository_execute = "melakukan"
 repository_commit = "melakukan"
 repository_edit = "mengedit"
 repository_public = "publik"
+repository_public_change = "Ubah ke publik"
 repository_private = "pribadi"
+repository_private_change = "Perubahan pribadi"
 repository_upload = "meng-upload"
 repository_export = "ekspor"
 repository_import = "mengimpor"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "kisaran alamat IP"
 repository_admin_site_license_from = "dari"
 repository_admin_site_license_to = "untuk"
 repository_admin_site_license_addrow = "Lebih masukan baris"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "Pengaturan indeks display"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "Alamat e-mail"
 repository_admin_site_license_from_to = "(Dari - sampai)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "Nama Organisasi"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "alamat dikecualikan"
 repository_admin_log_address = "Silakan tentukan alamat Internet Protocol dikeluarkan dari analisis log"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "pengaturan otomatis"
 repository_admin_server_cmmdpath = "path absolut ke perintah eksternal"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "Format PrefixID tidak valid"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "biblio Info isi dari situs lain"
 repository_admin_AWSAccessKeyId = "AWSAksesIdKunci"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "Keadaan sekarang："
 repository_admin_IchushiLogin_attestation = "pengesahan"
 repository_admin_IchushiLogin_no_attestation = "Unattested"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "Akun CrossRef Query Layanan"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "nama Agency"
+repository_admin_institution_name_explanation = "nama Agency (English Direkomendasikan)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "awalanID"
 repository_admin_ranking_disp_setting = "Tampilan Pengaturan"
 repository_admin_ranking_disp_realtime = "Untuk memperbarui informasi peringkat secara real time"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "pengaturan mata uang"
 repository_admin_index_search = "indeks pencarian"
 repository_admin_keyword_search = "pencarian kata kunci"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "Lembaga internal ID"
+repository_admin_add_prefix = "menambahkan"
+repository_admin_do_not_add_prefix = "Jangan tambahkan"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "mendapatkan awalanID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,11 @@ repository_admin_icon_display_setting = "pengaturan tampilan icon"
 repository_admin_icon_display_setting_help = "mengatur membantu pengaturan ikon"
 repository_admin_icon_display_setting_oaiore = "mengatur OAI-ORE ikon pengaturan"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "Statistik penggunaan menghubungkan pengaturan tampilan"
+repository_admin_usagestatistics_link_display = "
+Statistik penggunaan layar Link"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "PenulisID pengaturan Prefix"
 repository_admin_author_id_prefix_edit = "PenulisID Awalan sunting"
@@ -864,6 +914,13 @@ repository_admin_privatetree_indexname_sort_desc = "nama indeks (urutan descendi
 repository_admin_privatetree_parent_index = "indeks pendaftaran"
 repository_admin_privatetree_writable_notice = "*Ketika tidak ada write-in kewenangan [webapp / modules / repositori / config / define.inc.php], setup sebuah pohon pribadi tidak dapat diubah. "
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "Log penghapusan dikecualikan"
+repository_admin_robotlist_now_executing = "Sekarang mengeksekusi ..."
+repository_admin_robotlist_process_kill = "proses bunuh"
+repository_admin_robotlist_common_crawler_list = "Daftar crawler bersama"
+repository_admin_robotlist_no_robotlist = "Tidak ada daftar robot yang diperoleh"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "Perbarui statistik penggunaan"
 repository_admin_update_usage_statistics_comment = "Memperbarui statistik penggunaan ..."
@@ -898,6 +955,12 @@ repository_admin_sitelicense_send_mail_activate = "Aktifkan untuk mengirimkan si
 repository_admin_sitelicense_send_mail_running = "Mulai situs mengirim surat izin ..."
 repository_admin_sitelicense_send_mail_errorMsg = "Gagal situs mengirim lisensi mail."
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "setelan penelusuran"
+repository_admin_default_search_type = "Pengaturan pencarian default"
+repository_admin_detail_search_type = "teks lengkap"
+repository_admin_simple_search_type = "sederhana"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1094,13 @@ repository_item_embargo_index_error = "menentukan indeks yang menerapkan aturan"
 repository_item_embargo_select_index = "pilih indeks dari pohon"
 repository_item_embargo_registered_index = "indeks ini telah didaftarkan ke ELS"
 repository_item_embargo_free_licence = "menggambarkan lisensi Anda sendiri"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "Pengaturan tata urutan"
 repository_item_sortorder_target_index = "menampilkan perubahan indeks sasaran"
@@ -1043,17 +1113,35 @@ repository_item_listdelete_target_index = "Indeks untuk dihapus"
 repository_item_listdelete_delete_button_title = "menghapus item"
 repository_item_listdelete_sub_index = "Subindex item juga menghapus"
 repository_item_listdelete_select_index_list_default = "silahkan pilih indeks"
+repository_item_listdelete_selsect_index_or_search_keyword = "
+Silakan jalankan atau kata kunci pencarian untuk memilih indeks"
 
 ; item management(DOI bulk grant)
-repository_item_edit_jalcdoi = "Jalc DOI"
-repository_item_edit_crossref = "Palang Ref"
-repository_item_edit_item_name = "barang"
+repository_item_edit_jalcdoi = "JaLC DOI"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "judul"
 repository_item_edit_select = "silakan pilih"
+repository_item_add_doi = "DOI hibah"
 repository_item_enterdoi = "DOI massal hibah"
 repository_item_enterdoi_target_index = "DOI Indeks massal penerima"
 repository_item_enterdoi_target_item = "(101 Items kemudian dikecualikan) DOI massal penerima"
 repository_item_enterjalcdoi_all_check = "Saya periksa semua Jalc DOI "
-repository_item_entercrossref_all_check = "Saya periksa semua Palang Ref"
+repository_item_entercrossref_all_check = "Saya periksa semua Cross ref"
+repository_item_enterdatacite_all_check = "Saya periksa semua Datacite"
+repository_item_doi_count_msg = "Aku diberi %s Ulasan DOI"
+repository_item_enterdoi_error = "Ini tidak memenuhi kondisi untuk menerapkan DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "Pencarian Hapus"
+repository_item_search_delete_title = "judul"
+repository_item_search_delete_button_title = "Menghapus item"
+repository_item_search_delete_search = "Jalankan pencarian kata kunci"
+repository_item_search_delete_num = "%s Saya telah dihapus"
+repository_item_search_delete_error_no_check = "Silahkan beri tanda check"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "indeks"
@@ -1190,6 +1278,7 @@ repository_import_error_msg_flash_pub_date = "Format Flash tanggal penerbitan fi
 repository_import_error_msg_item_type = "Informasi jenis item item tidak dapat ditemukan"
 repository_import_error_msg_edit_item_url = "domain yang ditentukan dalam tag repository_edit tidak sesuai dengan situs ini"
 repository_import_error_msg_edit_item_num = "tag repository_edit ada lebih dari satu"
+repository_import_error_msg_can_not_use_item_type = "Anda tidak memiliki izin untuk menggunakan jenis item"
 
 repository_importauthority_result_title = "Impor otoritas nama."
 repository_importauthority_result_success = "Penulis berhasil diimpor."
@@ -1221,7 +1310,7 @@ repository_mapping_confirm = "konfirmasi pemetaan"
 repository_mapping_name = "nama metadata"
 repository_mapping_inputtype = "jenis input"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "jenis bahasa"
@@ -1243,7 +1332,10 @@ repository_detail_hidden_metadata = "▲ metadata tersembunyi ▲"
 repository_detail_show_usagestatistics = "Tampilkan statistik penggunaan"
 repository_detail_openaccess = "Hal ini didownload dari YYYY/MM/DD."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "Statistik penggunaan I tersedia dari bulan depan"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "Unduhan : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "views"
@@ -1286,6 +1378,9 @@ repository_log_refer = "lihat"
 repository_log_of = " dari "
 repository_log_num = " nomor"
 repository_log_period = "periode"
+repository_log_set_exclude_address = "Mengatur IP Address Dikecualikan"
+repository_log_update_exclude_address = "Dikecualikan IP Address ditetapkan."
+repository_log_announce_update_clowler_list = "Silakan mengeksekusi log pengecualian dari manajemen."
 repository_log_print = "mencetak"
 repository_log_item_view = "lihat menghitung untuk item"
 repository_log_nodata = "tidak ada data pertandingan"
@@ -1315,6 +1410,8 @@ repository_rank_newitem = "item baru"
 repository_rank_newitem_pubdate = "tanggal publikasi"
 repository_rank_thumbnail = "kuku ibu jari"
 repository_rank_link_title = "download file"
+repository_rank_statistics_period = "Statistik Periode :"
+repository_rank_registration_date = "Tanggal Registrasi:"
 
 ;Tree
 repository_index_tree = "pohon indeks"
@@ -1380,6 +1477,14 @@ repository_edittree_post_sitelicense_user = "posting SiteLicense pengguna log ju
 repository_edittree_online_issn_warning = "* Mencerminkan pengaturan untuk semua indeks anak"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "Mengatur tanggal penerbitan indeks anak rekursif"
+repository_edittree_pdf_cover_recursive = "Mengatur halaman pdf sampul indeks anak rekursif"
+repository_edittree_exclusive_acl_role_ids_recursive = "Mengatur otoritas dasar indeks anak rekursif"
+repository_edittree_exclusive_acl_room_auth_recursive = "Mengatur otoritas kamar indeks anak rekursif"
+repository_edittree_exclusive_acl_group_ids_recursive = "Mengatur otoritas kelompok indeks anak rekursif"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "valid tanggal mempublikasikan"
 repository_edittree_nodenameerror = "memasukkan string dengan lebih dari 2 karakter"
@@ -1502,18 +1607,28 @@ repository_item_date_error = "tanggal tidak valid"
 repository_item_embargo_open = "File akses terbuka tidak menetapkan harga"
 repository_item_embargo_no_download = "File swasta tidak menetapkan harga"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "Anda tidak dapat mengatur hak akses untuk akses terbuka"
+repository_item_embargo_file_authority_no_download = "Anda tidak dapat mengatur hak akses jika Anda tidak mempublikasikan"
+repository_item_set_file_authority = "Silakan mengatur kelompok untuk memungkinkan download file"
+repository_item_file_authority_attention = "Kelompok yang belum ditetapkan tidak dapat men-download file"
+repository_item_add_file_authority = "pengaturan Authority"
+repository_item_download_file_authority = "Download pengaturan izin"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "bibliografi DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "Database bibliografi belum dipilih"
 repository_item_fill_data_no_id_error = "ID pencarian tidak dimasukkan"
 repository_item_fill_data_no_data_error = "Tidak bisa mengisi data"
@@ -1524,11 +1639,19 @@ repository_item_fill_data_no_metadata_error = ": Akuisisi Metadata beres."
 repository_item_fill_data_access_error = "tidak dapat diakses."
 repository_item_fill_data_callback_admin = "Silakan meminta administrator."
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "Hibah Jalc DOI"
-repository_item_delete_jalcdoi = "Jatuhkan Jalc DOI "
-repository_item_enter_crossref = "Hibah Palang Ref "
-repository_item_delete_crossref = "Jatuhkan Palang Ref "
+repository_item_enter_jalcdoi = "JaLC DOI"
+repository_item_delete_jalcdoi = "Jatuhkan JaLC DOI "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "Jatuhkan JaLC CrossRef DOI "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "Jatuhkan JaLC DataCite DOI "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "Jatuhkan Multiple Resolution "
@@ -1600,6 +1723,12 @@ repository_item_msg_selectlicense = "pilih lisensi"
 repository_item_file_free_licence = "menggambarkan lisensi Anda sendiri"
 repository_item_set_index = "pilih set indeks"
 repository_item_file_not_input = "mengajukan tidak terdaftar"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "Apakah Anda yakin ingin membatalkan?"
diff --git a/repository/language/japanese/main.ini b/repository/language/japanese/main.ini
index c103b7d..5c41bd4 100644
--- a/repository/language/japanese/main.ini
+++ b/repository/language/japanese/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "却下理由 : "
 repository_mail_review_supple_reject_close = "却下されたサプリメンタルコンテンツは「登録中」へ移動されました。"
 repository_mail_review_supple_setting = "査読結果通知メールの受信が不要になった場合は、こちらから設定を変更してください。"
 repository_mail_review_supple_setting_url = "サプリメンタルコンテンツ査読結果受信設定変更"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "サプリメンタルWEKO側のPrefixIdが設定されていません。"
+repository_entry_no_prefix_id = "PrefixIdが設定されていません。お手数ですが管理者までご連絡ください。"
+repository_entry_no_supple_weko_url = "サプリメンタルWEKO URLが設定されていません。お手数ですが管理者までご連絡ください。"
+repository_entry_invalid_supple_contents_url = "指定したサプリメンタルコンテンツURLが不正な値です。サプリメンタルコンテンツURLをご確認ください。"
+repository_entry_invalid_all_supple_contents_url = "指定したサプリメンタルコンテンツURLがすべて不正な値です。サプリメンタルコンテンツURLをご確認ください。"
+repository_entry_failed_entry_supple_contents = "サプリメンタルコンテンツの登録に失敗しました。"
+repository_entry_failed_some_of_supple_entry = "登録に失敗したサプリメンタルコンテンツがあります。"
+repository_entry_exist_supple_contents = "登録対象のサプリメンタルコンテンツは既に登録されています。"
+repository_delete_failed_delete_supple_contents = "サプリメンタルコンテンツの削除に失敗しました。"
+repository_update_failed_update_supple_contents = "サプリメンタルコンテンツの更新に失敗しました。"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "ブラウザがインラインフレームに対応していないため表示できません。"
 repository_help_link_here = "ここ"
@@ -201,6 +212,7 @@ repository_log_report = "定型レポート"
 repository_log_custom = "カスタムレポート"
 repository_log_is_sitelicense = "サイトライセンス会員：UNIT0"
 repository_log_not_sitelicense = "サイトライセンス以外"
+repository_log_sitelicense_member = "サイトライセンス会員"
 repository_log_total = "合計"
 repository_log_organization = "機関名"
 repository_log_weko_top = "WEKOトップページ"
@@ -225,6 +237,7 @@ repository_log_download_admin = "管理者"
 repository_log_download_register = "登録者"
 repository_log_download_deleted_group = "削除済グループ"
 repository_log_index_report_title = "インデックスごとの詳細画面アクセス数"
+repository_log_index = "インデックス"
 
 repository_log_index_detail_access_total = "詳細画面アクセス数合計"
 repository_log_start_month = "集計月指定"
@@ -257,6 +270,11 @@ repository_log_update_OK = "正しく登録されました"
 repository_log_update_NG = "登録に失敗しました"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "ホスト別アクセス数"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "検索キーワードランキング"
+repository_search_keyword_name = "検索キーワード"
+repository_search_num = "検索回数"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[ダウンロード回数] : "
 repository_sitelicense_mail_subject = "サイトライセンス利用統計"
 repository_sitelicense_mail_body_dear = "%s 様"
 repository_sitelicense_mail_body_thank = "%sをご利用いただきありがとうございます。"
-repository_sitelicense_mail_body_announcement = "のサイトライセンス利用統計を送付いたします。"
+repository_sitelicense_mail_body_announcement = "%sのサイトライセンス利用統計を送付いたします。"
 repository_sitelicense_mail_body_unnecessary = "このメールが不要な場合は、お手数ですが管理者(%s)までご連絡ください。"
 repository_sitelicense_mail_body_explain_rule_1 = "◆登録されているIPアドレスレンジ毎にアクセス数を集計しています。"
 repository_sitelicense_mail_body_explain_rule_2 = "（複数のIPアドレスレンジを登録されている場合、本メールが複数配信されます。）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "%sのアップロードに失敗しました"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "戻る"
 
@@ -456,7 +478,9 @@ repository_execute = "実行"
 repository_commit = "適用"
 repository_edit = "編集"
 repository_public = "公開"
+repository_public_change = "公開に変更"
 repository_private = "非公開"
+repository_private_change = "非公開に変更"
 repository_upload = "アップロード"
 repository_export = "エクスポート"
 repository_import = "インポート"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "IPアドレス範囲"
 repository_admin_site_license_from = "from"
 repository_admin_site_license_to = "to"
 repository_admin_site_license_addrow = "More input row"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "ランキング表示設定"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "メールアドレス"
 repository_admin_site_license_from_to = "(from - to)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "OrganizationName"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "除外対象アドレス"
 repository_admin_log_address = "ログ解析から除外するIPアドレスを指定してください"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "自動設定"
 repository_admin_server_cmmdpath = "外部コマンドの絶対パス"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "Prefix設定"
+repository_admin_prefix_incorrect = "PrefixIDのフォーマットが不正です"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "書誌情報簡単登録"
 repository_admin_AWSAccessKeyId = "AWSAccessKeyId"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "現在の状態："
 repository_admin_IchushiLogin_attestation = "認証"
 repository_admin_IchushiLogin_no_attestation = "未認証"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "CrossRef Query Services Account"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "機関名称"
+repository_admin_institution_name_explanation = "機関名称(英語推奨)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "PrefixID"
 repository_admin_ranking_disp_setting = "表示設定"
 repository_admin_ranking_disp_realtime = "リアルタイムに更新する"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "通貨単位設定"
 repository_admin_index_search = "インデックス検索"
 repository_admin_keyword_search = "キーワード検索"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "機関内部ID"
+repository_admin_add_prefix = "付加する"
+repository_admin_do_not_add_prefix = "付加しない"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "PrefixID取得"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,10 @@ repository_admin_icon_display_setting = "アイコン表示設定"
 repository_admin_icon_display_setting_help = "ヘルプアイコン表示"
 repository_admin_icon_display_setting_oaiore = "OAI-OREアイコン表示"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "利用統計リンク表示設定"
+repository_admin_usagestatistics_link_display = "利用統計リンク表示"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "外部著者ID Prefix設定"
 repository_admin_author_id_prefix_edit = "外部著者ID Prefix編集"
@@ -864,6 +913,13 @@ repository_admin_privatetree_indexname_sort_desc = "インデックス名(降順
 repository_admin_privatetree_parent_index = "登録インデックス"
 repository_admin_privatetree_writable_notice = "※「webapp/modules/repository/config/define.inc.php」の書き込み権限がないため、プライベートツリーの設定を変更することができません。"
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "除外対象のログ削除"
+repository_admin_robotlist_now_executing = "実行中..."
+repository_admin_robotlist_process_kill = "強制終了"
+repository_admin_robotlist_common_crawler_list = "共用クローラーリスト"
+repository_admin_robotlist_no_robotlist = "ロボットリストを取得していません"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "利用統計ログ集計"
 repository_admin_update_usage_statistics_comment = "利用統計集計中..."
@@ -898,6 +954,12 @@ repository_admin_sitelicense_send_mail_activate = "サイトライセンスメ
 repository_admin_sitelicense_send_mail_running = "サイトライセンスメール送信開始..."
 repository_admin_sitelicense_send_mail_errorMsg = "サイトライセンスメールの送信開始に失敗しました。入力情報を確認してください。"
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "検索設定"
+repository_admin_default_search_type = "デフォルト検索設定"
+repository_admin_detail_search_type = "全文検索"
+repository_admin_simple_search_type = "キーワード検索"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ランキングデータなし
@@ -1031,6 +1093,13 @@ repository_item_embargo_index_error = "インデックスを指定してくだ
 repository_item_embargo_select_index = "インデックスをツリーから選択してください"
 repository_item_embargo_registered_index = "このインデックスは既に登録されています"
 repository_item_embargo_free_licence = "ライセンスを記述してください"
+repository_item_file_license_notation_by = "Creative Commons : 表示"
+repository_item_file_license_notation_by_sa = "Creative Commons : 表示 - 継承"
+repository_item_file_license_notation_by_nd = "Creative Commons : 表示 - 改変禁止"
+repository_item_file_license_notation_by_nc = "Creative Commons : 表示 - 非営利"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : 表示 - 非営利 - 継承"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : 表示 - 非営利 - 改変禁止"
+
 ;アイテム管理(表示順序設定)
 repository_item_sortorder = "表示順序設定"
 repository_item_sortorder_target_index = "表示順序変更対象インデックス"
@@ -1043,17 +1112,34 @@ repository_item_listdelete_target_index = "削除対象インデックス"
 repository_item_listdelete_delete_button_title = "アイテムを削除"
 repository_item_listdelete_sub_index = "サブインデックスのアイテムも削除する"
 repository_item_listdelete_select_index_list_default = "インデックスを選択してください"
+repository_item_listdelete_selsect_index_or_search_keyword = "インデックスを選択するかキーワード検索を実行して下さい。"
 
 ;アイテム管理(DOI一括付与)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "Cross Ref"
-repository_item_edit_item_name = "アイテム名"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "タイトル"
 repository_item_edit_select = "選択してください"
+repository_item_add_doi = "DOI付与"
 repository_item_enterdoi = "DOI一括付与"
 repository_item_enterdoi_target_index = "DOI一括付与対象インデックス"
 repository_item_enterdoi_target_item = "DOI一括付与対象（101件目以降は対象外）"
 repository_item_enterjalcdoi_all_check = "JaLC DOIを全てチェックする"
 repository_item_entercrossref_all_check = "Cross Refを全てチェックする"
+repository_item_enterdatacite_all_check = "DataCiteを全てチェックする"
+repository_item_doi_count_msg = "%s件DOIを付与しました"
+repository_item_enterdoi_error = "DOIを付与するための条件を満たしていません"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;アイテム管理（検索削除）
+repository_item_search_delete = "検索削除"
+repository_item_search_delete_title = "タイトル"
+repository_item_search_delete_button_title = "アイテムを削除"
+repository_item_search_delete_search = "キーワード検索を実行してください"
+repository_item_search_delete_num = "%s件削除しました"
+repository_item_search_delete_error_no_check = "チェックを入れて下さい"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ;アイテム一覧表示画面(検索結果)
 repository_search_index = "インデックス"
@@ -1190,6 +1276,7 @@ repository_import_error_msg_flash_pub_date = "ファイルのFlash公開日の
 repository_import_error_msg_item_type = "アイテムのアイテムタイプ情報が見つかりません"
 repository_import_error_msg_edit_item_url = "repository_editタグで指定されたドメインが本サイトと一致していません"
 repository_import_error_msg_edit_item_num = "repository_editタグが複数存在します"
+repository_import_error_msg_can_not_use_item_type = "アイテムタイプを使用する権限がありません"
 
 repository_importauthority_result_title = "著者名典拠インポート"
 repository_importauthority_result_success = "件のインポートに成功しました。"
@@ -1221,7 +1308,7 @@ repository_mapping_confirm = "マッピング確認"
 repository_mapping_name = "メタデータ名"
 repository_mapping_inputtype = "入力タイプ"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "表示言語"
@@ -1243,7 +1330,10 @@ repository_detail_hidden_metadata = "▲ メタデータを非表示にする 
 repository_detail_show_usagestatistics = "利用統計を見る"
 repository_detail_openaccess = "YYYY年MM月DD日からダウンロード可能です。"
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "利用統計は来月からご利用いただけます"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "ダウンロード可 : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%1$04d年%2$02d月"
 repository_usagestatistics_views_title = "閲覧回数"
@@ -1286,6 +1376,9 @@ repository_log_refer = "閲覧"
 repository_log_of = "の"
 repository_log_num = "回数"
 repository_log_period = "期間"
+repository_log_set_exclude_address = "除外対象アドレス設定"
+repository_log_update_exclude_address = "除外対象アドレスを設定しました。"
+repository_log_announce_update_clowler_list = "管理画面からログの除外を実施してください。"
 repository_log_print = "印刷"
 repository_log_item_view = "アイテム毎の閲覧回数"
 repository_log_nodata = "該当するデータがありません"
@@ -1315,6 +1408,8 @@ repository_rank_newitem = "新着アイテム"
 repository_rank_newitem_pubdate = "公開日時"
 repository_rank_thumbnail = "サムネイル"
 repository_rank_link_title = "ファイルダウンロード"
+repository_rank_statistics_period = "統計期間："
+repository_rank_registration_date = "登録日："
 
 ;Tree
 repository_index_tree = "インデックスツリー"
@@ -1380,6 +1475,14 @@ repository_edittree_post_sitelicense_user = "このインデックス直下の
 repository_edittree_online_issn_warning = "※子インデックスへ再帰的に設定値が反映されます"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "子インデックスの公開日にも再帰的に反映させる"
+repository_edittree_pdf_cover_recursive = "子インデックスのPDFカバーページにも再帰的に反映させる"
+repository_edittree_exclusive_acl_role_ids_recursive = "子インデックスのベース権限にも再帰的に反映させる"
+repository_edittree_exclusive_acl_room_auth_recursive = "子インデックスのルーム権限にも再帰的に反映させる"
+repository_edittree_exclusive_acl_group_ids_recursive = "子インデックスのグループにも再帰的に反映させる"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ;ツリー編集(エラーメッセージ)
 repository_edittree_dayerror = "公開日が不正です"
 repository_edittree_nodenameerror = "2文字以上の文字列を指定してください"
@@ -1502,18 +1605,28 @@ repository_item_date_error = "日付が不正です"
 repository_item_embargo_open = "オープンアクセスのため価格は設定できません"
 repository_item_embargo_no_download = "公開しない場合は価格は設定できません"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "オープンアクセスのため権限は設定できません"
+repository_item_embargo_file_authority_no_download = "公開しない場合は権限は設定できません"
+repository_item_set_file_authority = "ファイルのダウンロードを許可するグループを設定してください"
+repository_item_file_authority_attention = "設定されていないグループはファイルをダウンロードできません"
+repository_item_add_file_authority = "権限設定"
+repository_item_download_file_authority = "ダウンロード権限設定"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "メタデータ自動入力"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "医中誌"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "医中誌ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "検索先が選択されていません"
 repository_item_fill_data_no_id_error = "が入力されていません"
 repository_item_fill_data_no_data_error = "情報が取得できませんでした"
@@ -1524,11 +1637,19 @@ repository_item_fill_data_no_metadata_error = "からのメタデータ取得に
 repository_item_fill_data_access_error = "にアクセスできませんでした。"
 repository_item_fill_data_callback_admin = "管理者にお問い合わせ下さい。"
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "JaLC DOIの付与"
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "JaLC DOIの取り下げ"
-repository_item_enter_crossref = "Cross Refの付与"
-repository_item_delete_crossref = "Cross Refの取り下げ"
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "JaLC CrossRef DOIの取り下げ"
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "JaLC DataCite DOIの取り下げ"
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution"
 repository_item_delete_library_jalcdoi = "Multiple Resolution取下げ"
@@ -1600,6 +1721,12 @@ repository_item_msg_selectlicense = "ライセンスを選択してください"
 repository_item_file_free_licence = "ライセンスを記述してください"
 repository_item_set_index = "セットインデックスを選択してください"
 repository_item_file_not_input = "※ファイルが未入力です"
+repository_item_file_license_notation_by = "Creative Commons : 表示"
+repository_item_file_license_notation_by_sa = "Creative Commons : 表示 - 継承"
+repository_item_file_license_notation_by_nd = "Creative Commons : 表示 - 改変禁止"
+repository_item_file_license_notation_by_nc = "Creative Commons : 表示 - 非営利"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : 表示 - 非営利 - 継承"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : 表示 - 非営利 - 改変禁止"
 
 ;キャンセルボタン押下時表示メッセージ
 repository_confirmation_cancel = "キャンセルを実行しますか？"
diff --git a/repository/language/melayu/main.ini b/repository/language/melayu/main.ini
index 7693c12..0fc2a27 100644
--- a/repository/language/melayu/main.ini
+++ b/repository/language/melayu/main.ini
@@ -189,7 +189,19 @@ repository_mail_review_supple_reject_reason = "Sebab-sebab ditolak:"
 repository_mail_review_supple_reject_close = "Kandungan tambahan yang ditolak, telah dipindahkan ke 'tidak berdaftar'"
 repository_mail_review_supple_setting = "Sekiranya anda tidak lagi berhasrat menerima pemberitahuan melalui emel mengenai hasil keputusan, sila klik disini untuk mengubah tetapan"
 repository_mail_review_supple_setting_url = "Tetapan halaman URL"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId Supplemental WEKO belum ditetapkan."
+repository_entry_no_prefix_id = "PrefixId belum ditetapkan.
+Maaf untuk masalah anda, tetapi sila hubungi pentadbir."
+repository_entry_no_supple_weko_url = "Supplemental URL WEKO belum ditetapkan. Maaf untuk masalah anda, tetapi sila hubungi pentadbir."
+repository_entry_invalid_supple_contents_url = "Supplemental URL kandungan adalah nilai yang tidak sah. Sila semak URL kandungan."
+repository_entry_invalid_all_supple_contents_url = "Supplemental URL kandungan yang dinyatakan adalah semua nilai haram. Sila semak URL kandungan."
+repository_entry_failed_entry_supple_contents = "kegagalan pendaftaran kandungan Supplemental"
+repository_entry_failed_some_of_supple_entry = "Terdapat kandungan Supplemental yang gagal untuk mendaftar."
+repository_entry_exist_supple_contents = "Kandungan Supplemental telah pun didaftarkan."
+repository_delete_failed_delete_supple_contents = "gagal untuk membuang kandungan Supplemental ."
+repository_update_failed_update_supple_contents = "gagal untuk mengemas kini kandungan Supplemental .."
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "Tidak dapat memaparkan iFrame tidak sesuai dengan pelayar."
 repository_help_link_here = "di sini"
@@ -201,6 +213,7 @@ repository_log_report = "laporan tetap"
 repository_log_custom = "laporan Custom"
 repository_log_is_sitelicense = "lesen tapak"
 repository_log_not_sitelicense = "lesen lain eite "
+repository_log_sitelicense_member = "Ahli Lesen tapak"
 repository_log_total = "jumlah"
 repository_log_organization = "organisasi"
 repository_log_weko_top = "Halaman atas WEKO"
@@ -225,6 +238,7 @@ repository_log_download_admin = "Admin"
 repository_log_download_register = "Daftar "
 repository_log_download_deleted_group = "KumpulanDihapuskan"
 repository_log_index_report_title = "indeks akses terperinci par"
+repository_log_index = "indeks"
 
 repository_log_index_detail_access_total = "jumlah akses terperinci"
 repository_log_start_month = "set permulaan bulan"
@@ -257,6 +271,11 @@ repository_log_update_OK = "OK kemasukan "
 repository_log_update_NG = "NG lemasukan"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "mengakses pelbagai par"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "Kata kunci Carian Kedudukan"
+repository_search_keyword_name = "Cari kata kunci"
+repository_search_num = "Cari Count"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +359,7 @@ repository_feedback_mail_body_downloads = "[Muat turun] :"
 repository_sitelicense_mail_subject = "usagestatistics lesen tapak pengguna"
 repository_sitelicense_mail_body_dear = "Dear %s Esq."
 repository_sitelicense_mail_body_thank = "%s Terima kasih kerana menggunakan."
-repository_sitelicense_mail_body_announcement = "menghantar tapak usagestatistics lesen pengguna."
+repository_sitelicense_mail_body_announcement = "Ini adalah laporan statistik penggunaan di bawah lesen akses tapak　%s."
 repository_sitelicense_mail_body_unnecessary = "Jika anda tidak lagi perlu mel ini, sila mel kepada admin (%s)."
 repository_sitelicense_mail_body_explain_rule_1 = "◆Saya telah mengira bilangan akses kepada pelbagai alamat IP untuk setiap yang berdaftar."
 repository_sitelicense_mail_body_explain_rule_2 = "（Jika anda mendaftar pluralitas rentang alamat IP, surat ini akan menjadi penyampaian berganda.）"
@@ -434,6 +453,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "gagal dimuat naik %s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "kembali"
 
@@ -456,7 +479,9 @@ repository_execute = "lancarkan"
 repository_commit = "melakukan"
 repository_edit = "edit"
 repository_public = "awam"
+repository_public_change = "Tukar kepada orang ramai"
 repository_private = "swasta"
+repository_private_change = "Perubahan swasta"
 repository_upload = "memuat naik "
 repository_export = "mengeksport"
 repository_import = "mengimport"
@@ -627,10 +652,16 @@ repository_admin_site_license_iprange = "had pelbagai alamat  IP"
 repository_admin_site_license_from = "daripada"
 repository_admin_site_license_to = "kepada"
 repository_admin_site_license_addrow = "Lebih input baris"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "Tetapan paparan Indeks"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "Alamat e-mel"
 repository_admin_site_license_from_to = "(dari - untuk)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "Nama Pertubuhan"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "alamat yang dikecualikan"
 repository_admin_log_address = "Sila nyatakan alamat Protokol Internet dikecualikan daripada analisis log"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +724,7 @@ repository_admin_server_auto_cmmdpath = "setting auto"
 repository_admin_server_cmmdpath = "laluan mutlak kepada arahan luaran"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "penetapan awalan "
+repository_admin_prefix_incorrect = "Format PrefixID tidak sah"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "Biblio mengisi maklumat dari laman web lain"
 repository_admin_AWSAccessKeyId = "AWSAksesMsKunci"
@@ -708,6 +740,13 @@ repository_admin_IchushiLogin_now_connect_stat = "Keadaan sekarang："
 repository_admin_IchushiLogin_attestation = "Pengesahan"
 repository_admin_IchushiLogin_no_attestation = "Unattested"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "Akaun CrossRef Query Perkhidmatan"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "nama agensi"
+repository_admin_institution_name_explanation = "nama agensi (Bahasa Inggeris lawatan)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "AwalanID"
 repository_admin_ranking_disp_setting = "memaparkan suasana"
 repository_admin_ranking_disp_realtime = "Untuk mengemas kini maklumat kedudukan dalam masa sebenar"
@@ -736,8 +775,15 @@ repository_admin_currency_setting = "penetapan mata wang"
 repository_admin_index_search = "indeks mencari"
 repository_admin_keyword_search = "kata kunci mencari"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Awalan (JaLC DOI) "
-repository_admin_get_cross_ref_doi = "Awalan (CrossRef DOI) "
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "Agensi ID dalaman"
+repository_admin_add_prefix = "Lampirkan"
+repository_admin_do_not_add_prefix = "Jangan tambah"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Awalan (CNRI) "
 repository_admin_get_prefixid = "dapatkan PrefixID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +832,10 @@ repository_admin_icon_display_setting = "tetapan paparan icon"
 repository_admin_icon_display_setting_help = "Tetapan set ikon bantuan"
 repository_admin_icon_display_setting_oaiore = "Tetapan set  OAI-ORE ikon."
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "Statistik penggunaan pautan tetapan paparan"
+repository_admin_usagestatistics_link_display = "Statistik penggunaan pautan paparan"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "Tetapan Prefix AuthorID"
 repository_admin_author_id_prefix_edit = "AuthorID Prefix edit"
@@ -864,6 +914,13 @@ repository_admin_privatetree_indexname_sort_desc = "nama indeks (turutan menurun
 repository_admin_privatetree_parent_index = "pendaftaran indeks"
 repository_admin_privatetree_writable_notice = "*Apabila tidak ada penurunan dalam kuasa [webapp / modules / gedung / config / define.inc.php], persediaan pokok swasta tidak boleh berubah."
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "Log penghapusan dikecualikan"
+repository_admin_robotlist_now_executing = "sekarang melaksanakan..."
+repository_admin_robotlist_process_kill = "membunuh proses"
+repository_admin_robotlist_common_crawler_list = "Senarai crawler dikongsi"
+repository_admin_robotlist_no_robotlist = "Tidak ada senarai robot yang diperolehi"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "Mengemas kini statistik penggunaan"
 repository_admin_update_usage_statistics_comment = "Mengemas kini statistik penggunaan..."
@@ -898,6 +955,12 @@ repository_admin_sitelicense_send_mail_activate = "Aktifkan untuk menghantar mel
 repository_admin_sitelicense_send_mail_running = "Mula mel lesen tapak send ..."
 repository_admin_sitelicense_send_mail_errorMsg = "Gagal mel lesen tapak menghantar."
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "tetapan Cari"
+repository_admin_default_search_type = "Tetapan carian lalai"
+repository_admin_detail_search_type = "teks penuh"
+repository_admin_simple_search_type = "mudah"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1094,13 @@ repository_item_embargo_index_error = "menentukan indeks yang mengamalkan peratu
 repository_item_embargo_select_index = "pilih indeks dari pokok"
 repository_item_embargo_registered_index = "indeks ini telah berdaftar dalam ELS"
 repository_item_embargo_free_licence = "menggambarkan lesen anda sendiri"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "Tetapan tertib isihan"
 repository_item_sortorder_target_index = "papar perubahan indeks sasaran "
@@ -1043,17 +1113,34 @@ repository_item_listdelete_target_index = "Indeks bagi penghapusan"
 repository_item_listdelete_delete_button_title = "memadam item"
 repository_item_listdelete_sub_index = "subindex barangan juga memadam"
 repository_item_listdelete_select_index_list_default = "sila pilih indeks"
+repository_item_listdelete_selsect_index_or_search_keyword = "Sila jalankan atau kata kunci carian untuk memilih indeks"
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "Cross Ref"
-repository_item_edit_item_name = "Perkara"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "Tajuk"
 repository_item_edit_select = "Sila pilih"
+repository_item_add_doi = "geran DOI"
 repository_item_enterdoi = "DOI geran pukal"
 repository_item_enterdoi_target_index = "DOI indeks penerima pukal"
 repository_item_enterdoi_target_item = "(101 Item kemudian dikecualikan) DOI Penerima Opsyen pukal"
 repository_item_enterjalcdoi_all_check = "Saya memeriksa semua JaLC DOI "
-repository_item_entercrossref_all_check = "Saya memeriksa semua Ref Cross"
+repository_item_entercrossref_all_check = "Saya memeriksa semua Cross Ref "
+repository_item_enterdatacite_all_check = "Saya memeriksa semua DataCite "
+repository_item_doi_count_msg = "Saya telah diberikan %s Ulasan DOI"
+repository_item_enterdoi_error = "Ia tidak memenuhi syarat-syarat untuk memohon DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "Cari Padam"
+repository_item_search_delete_title = "Tajuk"
+repository_item_search_delete_button_title = "Mengeluarkan barang"
+repository_item_search_delete_search = "Sila jalankan carian kata kunci"
+repository_item_search_delete_num = "%s Saya telah dikeluarkan"
+repository_item_search_delete_error_no_check = "Sila letak cek"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "Indeks"
@@ -1190,6 +1277,7 @@ repository_import_error_msg_flash_pub_date = "Format Flash tanggal penerbitan fa
 repository_import_error_msg_item_type = "Maklumat jenis item item tersebut tidak dapat dijumpai"
 repository_import_error_msg_edit_item_url = "domain yang dinyatakan dalam tag repository_edit tidak sesuai dengan laman web ini"
 repository_import_error_msg_edit_item_num = "tag repository_edit terdapat lebih dari satu."
+repository_import_error_msg_can_not_use_item_type = "Anda tidak mempunyai kebenaran untuk menggunakan jenis item"
 
 repository_importauthority_result_title = "Import nama autoriti"
 repository_importauthority_result_success = "Berjaya mengimport pengarang"
@@ -1221,7 +1309,7 @@ repository_mapping_confirm = "pengesahan pemetaan "
 repository_mapping_name = "nama metadata"
 repository_mapping_inputtype = "Jenis input "
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "jenis bahasa "
@@ -1243,7 +1331,10 @@ repository_detail_hidden_metadata = "▲ metadata tersembunyi ▲"
 repository_detail_show_usagestatistics = "Menunjukkan statistik penggunaan"
 repository_detail_openaccess = "Ia boleh dimuat turun dari YYYY / MM / DD."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "Statistik penggunaan saya boleh didapati mulai bulan depan"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "Muat Turun : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "Views"
@@ -1286,6 +1377,9 @@ repository_log_refer = "merujuk"
 repository_log_of = " daripada "
 repository_log_num = " bilangan"
 repository_log_period = "tempoh"
+repository_log_set_exclude_address = "Tetapkan IP Alamat yang Dikecualikan"
+repository_log_update_exclude_address = "Tidak termasuk Alamat IP telah ditetapkan."
+repository_log_announce_update_clowler_list = "Sila log melaksanakan pengecualian daripada Pengurusan."
 repository_log_print = "mencetak"
 repository_log_item_view = "Papar kiraan item"
 repository_log_nodata = "data tidak sepadan"
@@ -1315,6 +1409,8 @@ repository_rank_newitem = "Item baru"
 repository_rank_newitem_pubdate = "tarikh penerbitan"
 repository_rank_thumbnail = "thumbnail"
 repository_rank_link_title = "muatturun fail"
+repository_rank_statistics_period = "Tempoh Statistik :"
+repository_rank_registration_date = "Tarikh Pendaftaran:"
 
 ;Tree
 repository_index_tree = "pokok indeks"
@@ -1380,6 +1476,14 @@ repository_edittree_post_sitelicense_user = "pos SiteLicense pengguna log jurnal
 repository_edittree_online_issn_warning = "* Mencerminkan menetapkan kepada semua indeks anak"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "Tetapkan tarikh penerbitan setiap indeks kanak-kanak secara rekursif"
+repository_edittree_pdf_cover_recursive = "Tetapkan muka hadapan pdf indeks kanak-kanak secara rekursif"
+repository_edittree_exclusive_acl_role_ids_recursive = "Tetapkan berkuasa asas indeks kanak-kanak secara rekursif"
+repository_edittree_exclusive_acl_room_auth_recursive = "Tetapkan berkuasa bilik indeks kanak-kanak secara rekursif"
+repository_edittree_exclusive_acl_group_ids_recursive = "Tetapkan pihak berkuasa kumpulan indeks kanak-kanak secara rekursif"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "tarikh penerbitan tidak sah"
 repository_edittree_nodenameerror = "memasukkan rentetan dengan lebih dari 2 perkataan"
@@ -1502,18 +1606,28 @@ repository_item_date_error = "tarikh tidak sah"
 repository_item_embargo_open = "file akses terbuka tidak menetapkan harga"
 repository_item_embargo_no_download = "fail persendirian tidak menetapkan harga akses"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "Anda tidak boleh menetapkan kebenaran akses terbuka"
+repository_item_embargo_file_authority_no_download = "Anda tidak boleh menetapkan kebenaran jika anda tidak menyiarkan"
+repository_item_set_file_authority = "Sila tetapkan kumpulan untuk membenarkan muat turun fail"
+repository_item_file_authority_attention = "Kumpulan yang belum ditetapkan tidak boleh memuat turun fail"
+repository_item_add_file_authority = "tetapan kuasa"
+repository_item_download_file_authority = "Tetapan kebenaran turun"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "Bibliographic DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "Pangkalan data bibliografi belum dipilih"
 repository_item_fill_data_no_id_error = "ID carian tidak dimasukkan"
 repository_item_fill_data_no_data_error = "Tidak dapat mengisi data"
@@ -1524,11 +1638,19 @@ repository_item_fill_data_no_metadata_error = ": Pengambilalihan Metadata pergi
 repository_item_fill_data_access_error = "tidak dapat diakses."
 repository_item_fill_data_callback_admin = "Sila hubungi pentadbir sistem."
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "Pemberian JaLC DOI "
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "Drop JaLC DOI "
-repository_item_enter_crossref = "Geran Cross Ref "
-repository_item_delete_crossref = "Drop Cross Ref "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "Drop JaLC CrossRef DOI "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "Drop JaLC DataCite DOI "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "Drop Multiple Resolution "
@@ -1600,6 +1722,12 @@ repository_item_msg_selectlicense = "memilih lesen"
 repository_item_file_free_licence = "menggambarkan lesen anda sendiri"
 repository_item_set_index = "pilih set indeks"
 repository_item_file_not_input = "memfailkan tidak berdaftar"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "Adakah anda pasti anda mahu membatalkan? "
diff --git a/repository/language/tagalog/main.ini b/repository/language/tagalog/main.ini
index d1d77be..adab01e 100644
--- a/repository/language/tagalog/main.ini
+++ b/repository/language/tagalog/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "tanggihan ang dahilan : "
 repository_mail_review_supple_reject_close = "Tinanggihan mga pandagdag na nilalaman ay inilipat sa 'hindi rehistradong'."
 repository_mail_review_supple_setting = "Kung hindi mo na kailangan upang makatanggap ng mga abiso sa email ng mga resulta ng pagsusuri, mangyaring mag-click dito upang baguhin ang mga setting."
 repository_mail_review_supple_setting_url = "Pagtatakda ng URL ng pahina"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId ng namamanhik WEKO hindi pa naitatakda"
+repository_entry_no_prefix_id = "PrefixId hindi pa naitatakda. Paumanhin sa pag-mo, ngunit mangyaring makipag-ugnay sa administrator."
+repository_entry_no_supple_weko_url = "Karagdagang WEKOURL hindi pa naitatakda, ngunit mangyaring makipag-ugnay sa administrator."
+repository_entry_invalid_supple_contents_url = "URL Karagdagang nilalaman na iyong tinukoy ay hindi wasto halaga. Mangyaring suriin ang mga pandagdag na URL nilalaman"
+repository_entry_invalid_all_supple_contents_url = "URL Karagdagang nilalaman na iyong tinukoy ay ang lahat ng mga ilegal na halaga. Mangyaring suriin ang mga pandagdag na URL nilalaman"
+repository_entry_failed_entry_supple_contents = "Nabigo kong irehistro Karagdagang nilalaman"
+repository_entry_failed_some_of_supple_entry = "May mga pandagdag na nilalaman na nabigo para magparehistro"
+repository_entry_exist_supple_contents = "Karagdagang nilalaman ay naka-rehistro"
+repository_delete_failed_delete_supple_contents = "Nabigo kong alisin Karagdagang nilalaman"
+repository_update_failed_update_supple_contents = "Nabigo kong i-update ang mga pandagdag na nilalaman"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "Hindi maipakita ang mga inline na frame ay hindi tumutugma sa mga browser."
 repository_help_link_here = "dito"
@@ -201,6 +212,7 @@ repository_log_report = "fixed ulat"
 repository_log_custom = "pasadyang ulat"
 repository_log_is_sitelicense = "site lisensya"
 repository_log_not_sitelicense = "iba eite lisensya"
+repository_log_sitelicense_member = "Miyembro ng Lisensya ng Site"
 repository_log_total = "kabuuan"
 repository_log_organization = "samahan"
 repository_log_weko_top = "WEKO tuktok ng pahina"
@@ -225,6 +237,7 @@ repository_log_download_admin = "Admin"
 repository_log_download_register = "magparehistro"
 repository_log_download_deleted_group = "tinanggal Group"
 repository_log_index_report_title = "detalye ng access par index"
+repository_log_index = "talatuntunan"
 
 repository_log_index_detail_access_total = "kabuuang mga detalye ng access"
 repository_log_start_month = "itakda ang simulang buwan"
@@ -257,6 +270,11 @@ repository_log_update_OK = "OK entry"
 repository_log_update_NG = "Ng entry"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "access par host"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "Maghanap ng Keyword Pagraranggo"
+repository_search_keyword_name = "paghahanap ng keyword"
+repository_search_num = "Bilang ng Paghahanap"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[URL] : "
 repository_sitelicense_mail_subject = "usagestatistics gumagamit lisensya site"
 repository_sitelicense_mail_body_dear = "Minamahal na% s Esq."
 repository_sitelicense_mail_body_thank = "%s Salamat sa iyo para sa paggamit."
-repository_sitelicense_mail_body_announcement = "magpadala ng site usagestatistics gumagamit lisensya."
+repository_sitelicense_mail_body_announcement = "Ito ay isang ulat ng mga istatistika ng paggamit sa ilalim access ang lisensya site ng %s."
 repository_sitelicense_mail_body_unnecessary = "Kung hindi mo na kailangang i-mail na ito, mangyaring i-mail sa admin (% s)."
 repository_sitelicense_mail_body_explain_rule_1 = "◆Gumagamit ako ng pagbibilang ang bilang ng mga naa-access sa IP address na hanay para sa bawat na ay nakarehistro."
 repository_sitelicense_mail_body_explain_rule_2 = "（Kung ikaw ay pagrehistro ng mayorya ng mga hanay ng IP address, ang mail na ito ay magiging maramihang paghahatid.）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "Nabigo mag-upload ng %s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "likod"
 
@@ -456,7 +478,9 @@ repository_execute = "tumakbo"
 repository_commit = "magkasala"
 repository_edit = "i-edit"
 repository_public = "publiko"
+repository_public_change = "Baguhin sa publiko"
 repository_private = "pribado"
+repository_private_change = "Pagbabago sa pribadong"
 repository_upload = "mag-upload"
 repository_export = "luwas"
 repository_import = "angkat"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "hanay ng mga IP address"
 repository_admin_site_license_from = "mula sa"
 repository_admin_site_license_to = "upang"
 repository_admin_site_license_addrow = "Higit pang mga input hilera"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "Mga setting ng display Index"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "e-mail address"
 repository_admin_site_license_from_to = "(Mula sa - sa)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "Pangalan ng Organisasyon"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "ibinukod address"
 repository_admin_log_address = "Mangyaring tukuyin ang Internet Protocol address na ibinukod mula sa pagtatasa ng log"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "auto setting"
 repository_admin_server_cmmdpath = "absolute path sa panlabas na command"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "PrefixID format ay hindi wasto"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "biblio info punan mula sa iba pang mga site"
 repository_admin_AWSAccessKeyId = "AWSAccessKeyId"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "Ang kasalukuyang estado："
 repository_admin_IchushiLogin_attestation = "patotoo"
 repository_admin_IchushiLogin_no_attestation = "Unattested"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "Mga Serbisyo ng Query CrossRef Account"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "pangalan ng Ahensya"
+repository_admin_institution_name_explanation = "pangalan ng Ahensya (Inirerekumenda Ingles)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "unlapiID"
 repository_admin_ranking_disp_setting = "ipakita ang setting"
 repository_admin_ranking_disp_realtime = "Upang i-update pagraranggo impormasyon sa real time"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "setting sa pera"
 repository_admin_index_search = "index ng paghahanap"
 repository_admin_keyword_search = "paghahanap ng keyword"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "Ahensya ng panloob na ID"
+repository_admin_add_prefix = "isama"
+repository_admin_do_not_add_prefix = "Huwag idagdag ang"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "makapag unlapiID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,11 @@ repository_admin_icon_display_setting = "icon ng display setting"
 repository_admin_icon_display_setting_help = "itakda matulungan icon ng setting"
 repository_admin_icon_display_setting_oaiore = "itakda OAI-mineral icon ng setting"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "
+Istatistika ng paggamit link mga setting ng display"
+repository_admin_usagestatistics_link_display = "Mga istatistika sa paggamit display link"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "May-akda ID Prefix setting"
 repository_admin_author_id_prefix_edit = "May-akda ID Prefix edit"
@@ -864,6 +914,13 @@ repository_admin_privatetree_indexname_sort_desc = "index pangalan (pababang pag
 repository_admin_privatetree_parent_index = "Pagpaparehistro ng index"
 repository_admin_privatetree_writable_notice = "*Kapag walang write-sa kapangyarihan ng [webapp / module / imbakan / config / define.inc.php], isang pag-setup ng isang pribadong punong kahoy ay hindi mababago. "
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "Mag-log pagbura ng ibinukod"
+repository_admin_robotlist_now_executing = "Ngayon e-execute ..."
+repository_admin_robotlist_process_kill = "patayin ang proseso"
+repository_admin_robotlist_common_crawler_list = "List Ibinahagi crawler"
+repository_admin_robotlist_no_robotlist = "Walang nakuha sa listahan robot"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "I-update ang mga istatistika ng paggamit"
 repository_admin_update_usage_statistics_comment = "Ina-update ang mga istatistika ng paggamit ..."
@@ -898,6 +955,12 @@ repository_admin_sitelicense_send_mail_activate = "I-activate para sa pagpapadal
 repository_admin_sitelicense_send_mail_running = "Simulan ang lisensya mail ipadala site ..."
 repository_admin_sitelicense_send_mail_errorMsg = "Nabigong lisensya mail ipadala site."
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "setting sa paghahanap"
+repository_admin_default_search_type = "Ang mga setting ng default na paghahanap"
+repository_admin_detail_search_type = "buong teksto"
+repository_admin_simple_search_type = "simple"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1094,13 @@ repository_item_embargo_index_error = "tukuyin ang isang index na nalalapat ang
 repository_item_embargo_select_index = "piliin index mula sa puno"
 repository_item_embargo_registered_index = "index na ito ay narehistro sa ELS"
 repository_item_embargo_free_licence = "ilarawan ang iyong sariling mga lisensya"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "sort ng order setting"
 repository_item_sortorder_target_index = "ipakita ang pagbabagong target index"
@@ -1043,18 +1113,35 @@ repository_item_listdelete_target_index = "index para sa pagtanggal"
 repository_item_listdelete_delete_button_title = "magtanggal ng mga item"
 repository_item_listdelete_sub_index = "subindex item ring tanggalin"
 repository_item_listdelete_select_index_list_default = "mangyaring piliin ang index"
+repository_item_listdelete_selsect_index_or_search_keyword = "
+Mangyaring patakbuhin ang o keyword sa paghahanap upang piliin ang mga index"
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC Doi"
-repository_item_edit_crossref = "Cross Ref"
-repository_item_edit_item_name = "bagay"
+repository_item_edit_crossref = "JaLC CrossRef Doi"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite Doi"
+repository_item_edit_item_name = "pamagat"
 repository_item_edit_select = "Mangyaring pumili"
+repository_item_add_doi = "Doi grant"
 repository_item_enterdoi = "Doi bulk grant"
 repository_item_enterdoi_target_index = "Doi bulk tagatanggap index"
 repository_item_enterdoi_target_item = "(101 Item mamaya ibinukod) Doi bulk tumanggap ng grant"
 repository_item_enterjalcdoi_all_check = "Ako suriin ang lahat ng mga JaLC Doi"
-repository_item_entercrossref_all_check = "
-Ako suriin ang lahat ng mga Cross Ref"
+repository_item_entercrossref_all_check = "Ako suriin ang lahat ng mga Cross Ref"
+repository_item_enterdatacite_all_check = "Ako suriin ang lahat ng mga DataCite"
+repository_item_doi_count_msg = "Ako ay nabigyan ng %s Mga Review Doi"
+repository_item_enterdoi_error = "Hindi ito matugunan ang mga kondisyon para sa pag-aaplay ng Doi"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "maghanap Tanggalin"
+repository_item_search_delete_title = "pamagat"
+repository_item_search_delete_button_title = "Alisin ang mga item"
+repository_item_search_delete_search = "Mangyaring patakbuhin ang paghahanap ng keyword"
+repository_item_search_delete_num = "%s ko na inalis"
+repository_item_search_delete_error_no_check = "Mangyaring maglagay ng check"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "talatuntunan"
@@ -1191,6 +1278,7 @@ repository_import_error_msg_flash_pub_date = "Format ng Flash petsa ng publicati
 repository_import_error_msg_item_type = "Impormasyon ang uri ng item ng item ay hindi mahanap"
 repository_import_error_msg_edit_item_url = "domain na tinukoy sa repository_edit tag na ay hindi tumutugma sa site na ito"
 repository_import_error_msg_edit_item_num = "repository_edit tag na mayroong higit sa isa"
+repository_import_error_msg_can_not_use_item_type = "Wala kang pahintulot upang gamitin ang uri ng item"
 
 repository_importauthority_result_title = "I-import ang kapangyarihan pangalan."
 repository_importauthority_result_success = "Matagumpay na na-import na may-akda."
@@ -1222,7 +1310,7 @@ repository_mapping_confirm = "pagmamapa pagkumpirma"
 repository_mapping_name = "metadata name"
 repository_mapping_inputtype = "uri ng pag-input"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "uri ng wika"
@@ -1244,7 +1332,10 @@ repository_detail_hidden_metadata = "▲ nakatagong metadata ▲"
 repository_detail_show_usagestatistics = "Ipakita usagestatistics"
 repository_detail_openaccess = "Ito ay nada-download mula sa TTTT/BB/AA."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "Mga istatistika sa paggamit ko makukuha mula sa susunod na buwan"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "Nada-download na : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "Pananaw"
@@ -1287,6 +1378,9 @@ repository_log_refer = "sumangguni"
 repository_log_of = " ng "
 repository_log_num = " numero"
 repository_log_period = "panahon"
+repository_log_set_exclude_address = "Itakda ang Ibinukod IP Address"
+repository_log_update_exclude_address = "Mga ibinukod na IP Address ay nakatakda."
+repository_log_announce_update_clowler_list = "Mangyaring isagawa sa pagbubukod mula sa log ng Pamamahala."
 repository_log_print = "magpalimbag"
 repository_log_item_view = "tingnan bilangin para sa item"
 repository_log_nodata = "walang tugma data"
@@ -1316,6 +1410,8 @@ repository_rank_newitem = "mga bagong item"
 repository_rank_newitem_pubdate = "petsa ng pagkakalathala"
 repository_rank_thumbnail = "kuko ng hinlalaki"
 repository_rank_link_title = "maghain download"
+repository_rank_statistics_period = "Panahon ng Statistics:"
+repository_rank_registration_date = "Petsa Registration:"
 
 ;Tree
 repository_index_tree = "index ng puno"
@@ -1381,6 +1477,14 @@ repository_edittree_post_sitelicense_user = "mag-post SiteLicense user na ito ng
 repository_edittree_online_issn_warning = "* Sumasalamin sa pagse-set sa lahat ng ini-index ng bata"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "Itakda ang petsa ng ini-index ng bata publication recursively"
+repository_edittree_pdf_cover_recursive = "I-set ang pahina ng pdf pabalat ng ini-index ng bata recursively"
+repository_edittree_exclusive_acl_role_ids_recursive = "Itakda ang pangunahing awtoridad ng ini-index ng bata recursively"
+repository_edittree_exclusive_acl_room_auth_recursive = "Itakda ang mga awtoridad ng room ng ini-index ng bata recursively"
+repository_edittree_exclusive_acl_group_ids_recursive = "Itakda ang mga awtoridad ng pangkat ng mga ini-index ng bata recursively"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "Di-wasto ang publish petsa"
 repository_edittree_nodenameerror = "ipasok ang isang string na may higit sa 2 character"
@@ -1503,18 +1607,28 @@ repository_item_date_error = "hindi wastong petsa"
 repository_item_embargo_open = "open access na file ay hindi nakatakda presyo"
 repository_item_embargo_no_download = "pribadong file ay hindi nakatakda presyo"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "Hindi mo maaaring itakda ang mga pahintulot para sa mga bukas na pag-access"
+repository_item_embargo_file_authority_no_download = "Hindi mo maaaring itakda ang mga pahintulot kung hindi mo i-publish"
+repository_item_set_file_authority = "Mangyaring itakda ang pangkat upang payagan ang pag-download ng file"
+repository_item_file_authority_attention = "Pangkat na hindi pa na-set hindi maaaring i-download ang file"
+repository_item_add_file_authority = "Authority setting"
+repository_item_download_file_authority = "I-download ang mga setting ng pahintulot"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "bibliographic DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "Bibliographic database ay hindi pa napili"
 repository_item_fill_data_no_id_error = "Paghahanap ng ID ay hindi ipinasok"
 repository_item_fill_data_no_data_error = "Hindi makuha ang data fill"
@@ -1525,11 +1639,19 @@ repository_item_fill_data_no_metadata_error = ": Metadata acquisition nangyaring
 repository_item_fill_data_access_error = "Hindi nagawang i-access."
 repository_item_fill_data_callback_admin = "Mangyaring hilingin sa isang administrator."
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "Bigyan JaLC Doi "
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "I-drop JaLC Doi "
-repository_item_enter_crossref = "Grant Cross Ref "
-repository_item_delete_crossref = "Drop Cross Ref "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "I-drop JaLC CrossRef Doi "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "I-drop JaLC DataCite Doi "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "I-drop Multiple Resolution "
@@ -1601,6 +1723,12 @@ repository_item_msg_selectlicense = "piliin lisensya"
 repository_item_file_free_licence = "ilarawan ang iyong sariling mga lisensya"
 repository_item_set_index = "piliin ang hanay index"
 repository_item_file_not_input = "maghain hindi nakarehistro"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "Sigurado ka bang gusto mong mag-cancel?"
diff --git a/repository/language/thai/main.ini b/repository/language/thai/main.ini
index 8b5cf47..d0a2690 100644
--- a/repository/language/thai/main.ini
+++ b/repository/language/thai/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "ปฏิเสธด้วยเ
 repository_mail_review_supple_reject_close = "ปฏิเสธเนื้อหาเสริมได้ถูกย้ายไป 'จดทะเบียน'"
 repository_mail_review_supple_setting = "ถ้าคุณไม่จำเป็นต้องได้รับการแจ้งทางอีเมล์จากผลการทบทวนกรุณาคลิกที่นี่เพื่อเปลี่ยนการตั้งค่า"
 repository_mail_review_supple_setting_url = "การตั้งค่า URL ของหน้า"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId เสริม WEKO ยังไม่ได้รับการตั้งค่า"
+repository_entry_no_prefix_id = "PrefixId ยังไม่ได้รับการตั้งค่า. ขออภัยเป็นปัญหากับคุณ แต่โปรดติดต่อผู้ดูแลระบบ"
+repository_entry_no_supple_weko_url = "WEKOURL เสริมยังไม่ได้รับการตั้งค่า. ขออภัยเป็นปัญหากับคุณ แต่โปรดติดต่อผู้ดูแลระบบ"
+repository_entry_invalid_supple_contents_url = "URL เนื้อหาเพิ่มเติมที่คุณระบุเป็นค่าที่ไม่ถูกต้อง. กรุณาตรวจสอบ URL ของเนื้อหาเสริม"
+repository_entry_invalid_all_supple_contents_url = "URL เนื้อหาเพิ่มเติมที่คุณระบุเป็นสิ่งที่คุ้มค่าที่ผิดกฎหมาย. กรุณาตรวจสอบ URL ของเนื้อหาเสริม"
+repository_entry_failed_entry_supple_contents = "มีเนื้อหาเสริมที่ล้มเหลวในการลงทะเบียนเป็น"
+repository_entry_failed_some_of_supple_entry = "มีเนื้อหาเสริมที่ล้มเหลวในการลงทะเบียนเป็น"
+repository_entry_exist_supple_contents = "เนื้อหาเสริมมีการลงทะเบียนแล้ว"
+repository_delete_failed_delete_supple_contents = "ฉันล้มเหลวในการลบเนื้อหาเพิ่มเติม"
+repository_update_failed_update_supple_contents = "ล้มเหลวในการปรับปรุงเพิ่มเติมเนื้อหา"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "ไม่สามารถแสดงเฟรมในหน้าเว็บไม่ตรงกับเบราว์เซอร์"
 repository_help_link_here = "ที่นี่"
@@ -201,6 +212,7 @@ repository_log_report = "แก้ไข แจ้ง"
 repository_log_custom = "ประเพณี แจ้ง"
 repository_log_is_sitelicense = "สถาน การอนุญาต"
 repository_log_not_sitelicense = "อื่น สถาน การอนุญาต"
+repository_log_sitelicense_member = "สมาชิก License เว็บไซต์"
 repository_log_total = "ทั้งหมด"
 repository_log_organization = "องค์กร"
 repository_log_weko_top = "WEKO หน้าด้านบน"
@@ -225,6 +237,7 @@ repository_log_download_admin = "ผู้ดูแลระบบ"
 repository_log_download_register = "ทะเบียน"
 repository_log_download_deleted_group = "ที่ถูกลบ กลุ่ม"
 repository_log_index_report_title = "รายละเอียดการเข้าถึงดัชนีหุ้นที่ตราไว้"
+repository_log_index = "ดัชนี"
 
 repository_log_index_detail_access_total = "เข้าถึงรายละเอียดทั้งหมด"
 repository_log_start_month = "ตั้ง เริ่มต้นเดือน"
@@ -257,6 +270,11 @@ repository_log_update_OK = "ตกลงรายการ"
 repository_log_update_NG = "ความล้มเหลวของรายการ"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "เข้าถึงโฮสต์ที่ตราไว้หุ้น"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "คำที่ใช้ค้นหาตามลำดับ"
+repository_search_keyword_name = "คำที่ต้องการค้นหา"
+repository_search_num = "ค้นหาจำนวน"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[URL] : "
 repository_sitelicense_mail_subject = "usagestatistics ผู้ใช้ใบอนุญาตเว็บไซต์"
 repository_sitelicense_mail_body_dear = "เรียน% s เอสไคว"
 repository_sitelicense_mail_body_thank = "%s ขอขอบคุณที่ใช้"
-repository_sitelicense_mail_body_announcement = "ส่ง usagestatistics ใบอนุญาตของผู้ใช้เว็บไซต์"
+repository_sitelicense_mail_body_announcement = "นี่คือสถิติการใช้งานรายงานภายใต้ใบอนุญาตการเข้าถึงเว็บไซต์ของ %s"
 repository_sitelicense_mail_body_unnecessary = "ถ้าคุณไม่จำเป็นต้องไปยังอีเมลนี้โปรดอีเมลไปยังผู้ดูแลระบบ (% s)"
 repository_sitelicense_mail_body_explain_rule_1 = "◆ฉันได้รับการนับจำนวนของการเข้าถึงไปยังช่วงที่อยู่ IP สำหรับแต่ละที่ลงทะเบียน"
 repository_sitelicense_mail_body_explain_rule_2 = "（หากคุณกำลังลงทะเบียนส่วนใหญ่ของไอพีช่วงที่อยู่, อีเมลนี้จะถูกส่งมอบหลาย）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "ไม่สามารถอัปโหลด %s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "กลับ"
 
@@ -456,7 +478,9 @@ repository_execute = "ดำเนินงาน"
 repository_commit = "ผูกมัด"
 repository_edit = "แก้ไข"
 repository_public = "ของประชาชน"
+repository_public_change = "เปลี่ยนให้ประชาชน"
 repository_private = "ส่วนตัว"
+repository_private_change = "การเปลี่ยนแปลงในภาคเอกชน"
 repository_upload = "อัพโหลด"
 repository_export = "ส่งออก"
 repository_import = "นำเข้า"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "ช่วงของที่อยู
 repository_admin_site_license_from = "จาก"
 repository_admin_site_license_to = "ไปยัง"
 repository_admin_site_license_addrow = "แถวป้อนข้อมูลเพิ่มเติม"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "ดัชนีค่าการแสดงผล"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "e-mail address"
 repository_admin_site_license_from_to = "(ไป - กลับ)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "ชื่อองค์กร"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "ที่อยู่รวม"
 repository_admin_log_address = "โปรดระบุที่อยู่ Internet Protocol รับการยกเว้นจากการเข้าสู่ระบบ"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "การตั้งค่าอัต
 repository_admin_server_cmmdpath = "เส้นทางแน่นอนคำสั่งภายนอก"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "รูปแบบ PrefixID ไม่ถูกต้อง"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "Biblio กรอกข้อมูลจากเว็บไซต์อื่น ๆ"
 repository_admin_AWSAccessKeyId = "AWSเข้ากุญแจID"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "รัฐปัจจุบั
 repository_admin_IchushiLogin_attestation = "การรับรอง"
 repository_admin_IchushiLogin_no_attestation = "ไม่ได้รับอนุญาต"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "CrossRef บัญชีบริการแบบสอบถาม"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "ชื่อหน่วยงาน"
+repository_admin_institution_name_explanation = "ชื่อหน่วยงาน(ภาษาอังกฤษแนะนำ)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "อุปสรรคID"
 repository_admin_ranking_disp_setting = "แสดงการตั้งค่า"
 repository_admin_ranking_disp_realtime = "ในการปรับปรุงข้อมูลการจัดอันดับในเวลาจริง"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "การตั้งค่าสกุล"
 repository_admin_index_search = "ดัชนีการค้นหา "
 repository_admin_keyword_search = "การค้นหาคำหลัก"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "หน่วยงานภายใน ID"
+repository_admin_add_prefix = "ผนวก"
+repository_admin_do_not_add_prefix = "ไม่ต้องเพิ่ม"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "ได้รับคำนำหน้าID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,10 @@ repository_admin_icon_display_setting = "การตั้งค่าการ
 repository_admin_icon_display_setting_help = "ตั้งช่วยให้การตั้งค่าไอคอน"
 repository_admin_icon_display_setting_oaiore = "ตั้ง OAI-OREการตั้งค่าไอคอน"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "สถิติการใช้งานเชื่อมโยงการตั้งค่าการแสดงผล"
+repository_admin_usagestatistics_link_display = "สถิติการใช้งานจอแสดงผลเชื่อมโยง"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "ผู้เขียนID การตั้งค่าคำนำหน้า"
 repository_admin_author_id_prefix_edit = "ผู้เขียนID แก้ไขคำนำหน้า"
@@ -864,6 +913,13 @@ repository_admin_privatetree_indexname_sort_desc = "ชื่อดัชนี
 repository_admin_privatetree_parent_index = "ดัชนีที่ลงทะเบียน"
 repository_admin_privatetree_writable_notice = "*เมื่อไม่มีเขียนในอำนาจของ [webapp/modules/repository/config/define.inc.php] การติดตั้งของต้นไม้ส่วนตัวไม่สามารถเปลี่ยนแปลงได้ "
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "เข้าสู่ระบบการลบการยกเว้น"
+repository_admin_robotlist_now_executing = "ขณะนี้การดำเนินงาน..."
+repository_admin_robotlist_process_kill = "ฆ่ากระบวนการ"
+repository_admin_robotlist_common_crawler_list = "รายการซอฟต์แวร์รวบรวมข้อมูลที่ใช้ร่วมกัน"
+repository_admin_robotlist_no_robotlist = "ไม่มีรายการที่ได้มาเป็นหุ่นยนต์"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "ปรับปรุงสถิติการใช้งาน"
 repository_admin_update_usage_statistics_comment = "การปรับปรุงสถิติการใช้งาน..."
@@ -898,6 +954,12 @@ repository_admin_sitelicense_send_mail_activate = "เปิดใช้งา
 repository_admin_sitelicense_send_mail_running = "เริ่มต้นจดหมายใบอนุญาตสถานที่ส่ง ..."
 repository_admin_sitelicense_send_mail_errorMsg = "จดหมายใบอนุญาตเว็บไซต์ส่งล้มเหลว"
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "การตั้งค่าการค้นหา"
+repository_admin_default_search_type = "การตั้งค่าการค้นหาเริ่มต้น"
+repository_admin_detail_search_type = "ข้อความเต็ม"
+repository_admin_simple_search_type = "ง่าย"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1093,13 @@ repository_item_embargo_index_error = "ระบุดัชนีที่ใ
 repository_item_embargo_select_index = "เลือกดัชนีลงมาจากต้นไม้"
 repository_item_embargo_registered_index = "ดัชนีนี้ได้รับการลงทะเบียนกับ ELS"
 repository_item_embargo_free_licence = "อธิบายใบอนุญาตของคุณเอง"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "การตั้งค่าลำดับการจัดเรียง"
 repository_item_sortorder_target_index = "แสดงดัชนีเป้าหมายการเปลี่ยนแปลง"
@@ -1043,17 +1112,34 @@ repository_item_listdelete_target_index = "ดัชนีสำหรับก
 repository_item_listdelete_delete_button_title = "ลบรายการ"
 repository_item_listdelete_sub_index = "รายการดัชนีย่อยยังลบ"
 repository_item_listdelete_select_index_list_default = "กรุณาเลือกดัชนี"
+repository_item_listdelete_selsect_index_or_search_keyword = "กรุณาเรียกใช้การค้นหาหรือคำหลักเพื่อเลือกดัชนี"
 
 ; item management(DOI bulk grant)
-repository_item_edit_jalcdoi = "jalc ดอย"
-repository_item_edit_crossref = "ข้ามอ้างอิง"
-repository_item_edit_item_name = "ชิ้น"
+repository_item_edit_jalcdoi = "JaLC ดอย"
+repository_item_edit_crossref = "JaLC CrossRef ดอย"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite ดอย"
+repository_item_edit_item_name = "ชื่อเรื่อง"
 repository_item_edit_select = "กรุณาเลือก"
+repository_item_add_doi = "ทุนดอย"
 repository_item_enterdoi = "ดอยให้เป็นกลุ่ม"
 repository_item_enterdoi_target_index = "DOI ดัชนีผู้รับจำนวนมาก"
 repository_item_enterdoi_target_item = "(ไม่รวม 101 รายการต่อมา) ดอยผู้รับจำนวนมาก"
 repository_item_enterjalcdoi_all_check = "ฉันจะตรวจสอบทั้งหมด jalc ดอย "
-repository_item_entercrossref_all_check = "ฉันจะตรวจสอบทั้งหมดข้ามอ้างอิง"
+repository_item_entercrossref_all_check = "ฉันจะตรวจสอบทั้งหมด cross ref"
+repository_item_enterdatacite_all_check = "ฉันจะตรวจสอบทั้งหมด datacite"
+repository_item_doi_count_msg = "ฉันได้รับ %s ความคิดเห็นดอย"
+repository_item_enterdoi_error = "มันไม่เป็นไปตามเงื่อนไขการใช้ดอย"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "ค้นหาการค้นหาลบ"
+repository_item_search_delete_title = "ชื่อเรื่อง"
+repository_item_search_delete_button_title = "ลบรายการ"
+repository_item_search_delete_search = "โปรดเรียกใช้การค้นหาคำหลัก"
+repository_item_search_delete_num = "%s ผมได้ลบ"
+repository_item_search_delete_error_no_check = "กรุณาใส่ตรวจสอบ"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "ดัชนี"
@@ -1190,6 +1276,7 @@ repository_import_error_msg_flash_pub_date = "ไฟล์แฟลชวัน
 repository_import_error_msg_item_type = "ข้อมูลประเภทรายการของรายการที่ไม่สามารถพบได้"
 repository_import_error_msg_edit_item_url = "โดเมนที่ระบุไว้ในแท็ก repository_edit ไม่ตรงกับเว็บไซต์นี้"
 repository_import_error_msg_edit_item_num = "แท็ก repository_edit มีมากกว่าหนึ่ง"
+repository_import_error_msg_can_not_use_item_type = "คุณไม่ได้รับอนุญาตให้ใช้ประเภทรายการ"
 
 repository_importauthority_result_title = "ชื่อผู้มีอำนาจนำเข้า"
 repository_importauthority_result_success = "ผู้เขียนนำเข้าสำเร็จ"
@@ -1221,7 +1308,7 @@ repository_mapping_confirm = "ยืนยันการทำแผนที
 repository_mapping_name = "ชื่อเมตาดาต้าที่"
 repository_mapping_inputtype = "ประเภทการป้อนข้อมูล"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "ประเภทภาษา"
@@ -1243,7 +1330,10 @@ repository_detail_hidden_metadata = "▲ เมตาดาต้าที่ซ
 repository_detail_show_usagestatistics = "แสดงสถิติการใช้งาน "
 repository_detail_openaccess = "มันเป็นดาวน์โหลดได้จาก YYYY/MM/DD"
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "สถิติการใช้งานผมสามารถใช้ได้จากเดือนถัดไป"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "ที่ดาวน์โหลด　: "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "ครั้งที่เข้าดู"
@@ -1286,6 +1376,9 @@ repository_log_refer = "อ้างถึง"
 repository_log_of = " ของ "
 repository_log_num = " จำนวน"
 repository_log_period = "ระยะเวลา"
+repository_log_set_exclude_address = "ระบุที่อยู่ IP ไม่รวม"
+repository_log_update_exclude_address = "ไม่รวมที่อยู่ไอพีได้รับการตั้งค่า"
+repository_log_announce_update_clowler_list = "กรุณาเข้าสู่ระบบดำเนินการยกเว้นจากการบริหารจัดการ"
 repository_log_print = "พิมพ์"
 repository_log_item_view = "ดูนับสำหรับรายการ"
 repository_log_nodata = "ไม่มีข้อมูลตรงคือ"
@@ -1315,6 +1408,8 @@ repository_rank_newitem = "รายการใหม่"
 repository_rank_newitem_pubdate = "วันที่จัดพิมพ์"
 repository_rank_thumbnail = "ภาพ"
 repository_rank_link_title = "ดาวน์โหลดแฟ้ม"
+repository_rank_statistics_period = "สถิติ ระยะเวลา:"
+repository_rank_registration_date = "วันที่จดทะเบียน:"
 
 ;Tree
 repository_index_tree = "ต้นไม้ดัชนี"
@@ -1380,6 +1475,14 @@ repository_edittree_post_sitelicense_user = "โพสต์ของผู้
 repository_edittree_online_issn_warning = "สะท้อนให้เห็นถึงการตั้งค่า * ทุกดัชนีเด็ก"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "ตั้งวันที่ตีพิมพ์ของดัชนีเด็กซ้ำ"
+repository_edittree_pdf_cover_recursive = "ตั้ง pdf หน้าปกของดัชนีเด็กซ้ำ"
+repository_edittree_exclusive_acl_role_ids_recursive = "เจ้าหน้าที่ตั้งฐานของดัชนีเด็กซ้ำ"
+repository_edittree_exclusive_acl_room_auth_recursive = "ตั้งเจ้าหน้าที่ห้องของดัชนีเด็กซ้ำ"
+repository_edittree_exclusive_acl_group_ids_recursive = "ตั้งเจ้าหน้าที่กลุ่มของดัชนีเด็กซ้ำ"
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "ที่ไม่ถูกต้องวันที่เผยแพร่"
 repository_edittree_nodenameerror = "ป้อนสตริงที่มีมากกว่า 2 ตัวอักษร"
@@ -1502,18 +1605,28 @@ repository_item_date_error = "วันที่ไม่ถูกต้อง"
 repository_item_embargo_open = "การเข้าถึงไฟล์ที่เปิดไม่ได้กำหนดราคา"
 repository_item_embargo_no_download = "ไฟล์ส่วนตัวไม่ได้กำหนดราคา"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "คุณไม่สามารถตั้งค่าสิทธิ์สำหรับการเข้าถึงเปิด"
+repository_item_embargo_file_authority_no_download = "คุณไม่สามารถตั้งค่าสิทธิ์ถ้าคุณไม่ได้เผยแพร่"
+repository_item_set_file_authority = "กรุณาตั้งกลุ่มเพื่อช่วยให้การดาวน์โหลดไฟล์"
+repository_item_file_authority_attention = "กลุ่มที่ไม่ได้รับการติดตั้งไม่สามารถดาวน์โหลดไฟล์"
+repository_item_add_file_authority = "ผู้มีอำนาจในการตั้งค่า"
+repository_item_download_file_authority = "ดาวน์โหลดได้รับอนุญาตการตั้งค่า"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "ฐานข้อมูลบรรณานุกรม"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "บรรณานุกรมฐานข้อมูลบรรณานุกรมฐานข้อมูลยังไม่ได้รับการคัดเลือก"
 repository_item_fill_data_no_id_error = "ID ค้นหาจะไม่ได้ป้อน"
 repository_item_fill_data_no_data_error = "ไม่สามารถรับข้อมูลที่เติม"
@@ -1524,11 +1637,19 @@ repository_item_fill_data_no_metadata_error = ": การซื้อกิจ
 repository_item_fill_data_access_error = "ก็ไม่สามารถที่จะเข้าถึง"
 repository_item_fill_data_callback_admin = "กรุณาขอให้ผู้ดูแล"
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "ให้ jalc ดอย"
-repository_item_delete_jalcdoi = "วาง jalc ดอย"
-repository_item_enter_crossref = "แกรนท์ครอสอ้างอิง"
-repository_item_delete_crossref = "การลดลงของครอสอ้างอิง"
+repository_item_enter_jalcdoi = "JaLC DOI"
+repository_item_delete_jalcdoi = "วาง JaLC ดอย"
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "วาง JaLC CrossRef ดอย"
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "วาง JaLC DataCite ดอย"
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "วาง Multiple Resolution "
@@ -1600,6 +1721,12 @@ repository_item_msg_selectlicense = "เลือกใบอนุญาต"
 repository_item_file_free_licence = "อธิบายใบอนุญาตของคุณเอง"
 repository_item_set_index = "เลือกดัชนีชุด"
 repository_item_file_not_input = "ยื่นไม่ได้ลงทะเบียน "
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "คุณแน่ใจหรือว่าต้องการยกเลิก"
diff --git a/repository/language/vietnamese/main.ini b/repository/language/vietnamese/main.ini
index 69a7d4b..a153fe2 100644
--- a/repository/language/vietnamese/main.ini
+++ b/repository/language/vietnamese/main.ini
@@ -189,7 +189,18 @@ repository_mail_review_supple_reject_reason = "lý do từ chối : "
 repository_mail_review_supple_reject_close = "Rđẩy ra nội dung bổ sung đã được chuyển đến 'đăng ký'."
 repository_mail_review_supple_setting = "Nếu bạn không còn cần phải nhận được email thông báo kết quả rà soát, xin vui lòng bấm vào đây để thay đổi cài đặt."
 repository_mail_review_supple_setting_url = "Thiết lập URL trang"
-
+;Add lang resource 2015/03/27 Y.Yamazawa--start--
+repository_entry_no_prefix_id_from_supple_weko = "PrefixId Supplemental WEKO chưa được thiết lập"
+repository_entry_no_prefix_id = "PrefixId chưa được thiết lập. Xin lỗi làm phiền bạn, nhưng xin vui lòng liên hệ với quản trị viên."
+repository_entry_no_supple_weko_url = "WEKOURL bổ sung chưa được thiết lập. Xin lỗi làm phiền bạn, nhưng xin vui lòng liên hệ với quản trị viên."
+repository_entry_invalid_supple_contents_url = "URL nội dung bổ sung là các giá trị không hợp lệ. Vui lòng kiểm tra URL nội dung bổ sung."
+repository_entry_invalid_all_supple_contents_url = "URL nội dung bổ sung là tất cả các giá trị bất hợp pháp .Vui lòng kiểm tra URL nội dung bổ sung."
+repository_entry_failed_entry_supple_contents = "Lỗi đăng ký nội dung bổ sung"
+repository_entry_failed_some_of_supple_entry = "Có một nội dung bổ sung mà không đăng ký"
+repository_entry_exist_supple_contents = "Bổ sung nội dung đã được đăng ký"
+repository_delete_failed_delete_supple_contents = "Tôi thất bại trong việc loại bỏ các nội dung bổ sung."
+repository_update_failed_update_supple_contents = "Tôi thất bại trong việc cập nhật các nội dung bổ sung"
+;Add lang resource 2015/03/27 Y.Yamazawa--end--
 ;for WEKO help
 repository_help_not_support_inline_frame = "Không thể hiển thị khung nội tuyến không tương ứng với các trình duyệt."
 repository_help_link_here = "đây"
@@ -201,6 +212,7 @@ repository_log_report = "cố định báo cáo"
 repository_log_custom = "báo cáo tùy chỉnh"
 repository_log_is_sitelicense = "giấy phép trang web"
 repository_log_not_sitelicense = "giấy phép khác ưu tú"
+repository_log_sitelicense_member = "Giấy phép thành viên trang web"
 repository_log_total = "tổng"
 repository_log_organization = "cơ quan"
 repository_log_weko_top = "WEKO đầu trang"
@@ -225,6 +237,7 @@ repository_log_download_admin = "Sơ"
 repository_log_download_register = "đăng ký"
 repository_log_download_deleted_group = "xóa Nhóm"
 repository_log_index_report_title = "chi tiết chỉ số mệnh truy cập"
+repository_log_index = "chỉ số"
 
 repository_log_index_detail_access_total = "tổng số truy cập chi tiết"
 repository_log_start_month = "thiết lập bắt đầu vào tháng"
@@ -257,6 +270,11 @@ repository_log_update_OK = "nhập OK"
 repository_log_update_NG = "nhập NG"
 ; Add send mail for log report 2010/03/10 Y.Nakao --end--
 repository_log_host_access = "truy cập vào máy chủ mệnh"
+; Improve search log 2015/03/20 K.Sugimoto --start--
+repository_log_search_keyword_report_title = "Tìm kiếm từ khoá xếp hạng"
+repository_search_keyword_name = "Tìm kiếm từ khóa"
+repository_search_num = "Đếm Tìm kiếm"
+; Improve search log 2015/03/20 K.Sugimoto --end--
 
 ; Add lang resource 2010/04/26 Y.Nakao --start--
 ; for log moves
@@ -340,7 +358,7 @@ repository_feedback_mail_body_downloads = "[URL] : "
 repository_sitelicense_mail_subject = "usagestatistics sử dụng giấy phép trang web"
 repository_sitelicense_mail_body_dear = "Thân% s Esq."
 repository_sitelicense_mail_body_thank = "%s Cảm ơn bạn đã sử dụng."
-repository_sitelicense_mail_body_announcement = "gửi trang web usagestatistics sử dụng giấy phép."
+repository_sitelicense_mail_body_announcement = "Đây là một báo cáo thống kê sử dụng dưới sự truy cập trang web của giấy phép %s."
 repository_sitelicense_mail_body_unnecessary = "Nếu bạn không còn cần phải thư này, xin vui lòng gửi cho admin (% s)."
 repository_sitelicense_mail_body_explain_rule_1 = "◆Tôi đã đếm số lượng truy cập đến phạm vi địa chỉ IP cho mỗi đã được đăng ký."
 repository_sitelicense_mail_body_explain_rule_2 = "（Nếu bạn đang đăng ký một đa số của dải địa chỉ IP, thư này sẽ được phân phối nhiều.）"
@@ -434,6 +452,10 @@ repository_item_self_doi_ra = "SELF_DOI_RA"
 repository_item_self_doi = "SELF_DOI"
 ; 2014/09/25 K.Sugimoto --end--
 
+;2015/04/02 K.Sugimoto --start--
+repository_file_upload_failed = "không thể tải lên %s"
+;2015/04/02 K.Sugimoto --end--
+
 [Repository_Files_Js]
 repository_return = "lưng"
 
@@ -456,7 +478,9 @@ repository_execute = "thực hiện"
 repository_commit = "cam kết"
 repository_edit = "chỉnh sửa"
 repository_public = "công khai"
+repository_public_change = "Thay đổi để công chúng"
 repository_private = "riêng tư"
+repository_private_change = "Thay đổi trong tư nhân"
 repository_upload = "tải lên"
 repository_export = "xuất khẩu"
 repository_import = "nhập khẩu"
@@ -627,10 +651,16 @@ repository_admin_site_license_iprange = "phạm vi của địa chỉ IP"
 repository_admin_site_license_from = "từ"
 repository_admin_site_license_to = "đến"
 repository_admin_site_license_addrow = "Hơn hàng đầu vào"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+repository_admin_ranking_display_setting = "Cài đặt hiển thị chỉ số"
+;Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --start--
 repository_admin_site_license_mail_address = "Địa chỉ email"
 repository_admin_site_license_from_to = "(Từ - đến)"
 ;Add mail address for feedback mail 2014/04/15 T.Ichikawa --end--
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --start--
+repository_admin_site_license_group = "Tên tổ chức"
+;Add group name for feedback mail 2014/04/15 T.Ichikawa --end--
 repository_admin_log_exclusion = "địa chỉ loại trừ"
 repository_admin_log_address = "Vui lòng ghi rõ địa chỉ giao thức Internet bị loại khỏi phân tích đăng nhập"
 ;Add log exclusion from user-agaent 2010/07/02 Y.Nakao --start--
@@ -693,6 +723,7 @@ repository_admin_server_auto_cmmdpath = "thiết lập tự động"
 repository_admin_server_cmmdpath = "đường dẫn tuyệt đối để lệnh bên ngoài"
 ;Add new prefix 2013/12/25 T.Ichikawa --start--
 repository_admin_prefix_setting = "prefix setting"
+repository_admin_prefix_incorrect = "Định dạng PrefixID là không hợp lệ"
 ;Add new prefix 2013/12/25 T.Ichikawa --end--
 repository_admin_fill = "Biblio thông tin điền từ trang web khác"
 repository_admin_AWSAccessKeyId = "AWS truy cập chính Id"
@@ -708,6 +739,13 @@ repository_admin_IchushiLogin_now_connect_stat = "Hiện trạng："
 repository_admin_IchushiLogin_attestation = "sự nhận thật"
 repository_admin_IchushiLogin_no_attestation = "Unattested"
 ;Add ICHUSHI Login A.Jin 2012/11/14 --end--
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --start--
+repository_admin_CrossRefQueryServicesAccount = "Tài khoản CrossRef kiếm Dịch vụ"
+;Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/04 --end--
+;Add Institution Name S.Suzuki 2014/12/19 --start--
+repository_admin_institution_name = "tên cơ quan"
+repository_admin_institution_name_explanation = "tên cơ quan(English Giới thiệu)"
+;Add Institution Name S.Suzuki 2014/12/19 --end--
 repository_admin_prefixid = "tiền tố ID"
 repository_admin_ranking_disp_setting = "hiển thị thiết lập"
 repository_admin_ranking_disp_realtime = "Để cập nhật thông tin xếp hạng trong thời gian thực"
@@ -736,8 +774,15 @@ repository_admin_currency_setting = "cài đặt tiền tệ"
 repository_admin_index_search = "tìm kiếm chỉ mục"
 repository_admin_keyword_search = "tìm Kiếm"
 ; Add new prefix 2013/12/25 T.Ichikawa --start--
-repository_admin_get_jalc_doi = "Prefix(JaLC DOI)"
-repository_admin_get_cross_ref_doi = "Prefix(CrossRef DOI)"
+; Add DataCite 2015/02/10 K.Sugimoto --start--
+repository_admin_prefix_flag = "Cơ quan ID nội bộ"
+repository_admin_add_prefix = "Nối"
+repository_admin_do_not_add_prefix = "Đừng thêm"
+repository_admin_jalc = "JaLC DOI"
+repository_admin_get_jalc_doi = "JaLC DOI"
+repository_admin_get_cross_ref_doi = "JaLC CrossRef DOI"
+repository_admin_get_datacite_doi = "JaLC DataCite DOI"
+; Add DataCite 2015/02/10 K.Sugimoto --end--
 repository_admin_get_cnri = "Prefix(CNRI)"
 repository_admin_get_prefixid = "Tiền tố được ID (http://id.nii.ac.jp/)"
 ; Add new prefix 2013/12/25 T.Ichikawa --end--
@@ -786,6 +831,11 @@ repository_admin_icon_display_setting = "thiết lập hiển thị biểu tư
 repository_admin_icon_display_setting_help = "thiết lập giúp thiết lập biểu tượng"
 repository_admin_icon_display_setting_oaiore = "thiết lập OAI-quặng biểu tượng"
 ;2010/02/10 K.Ando --end--
+;2014/12/16 K.Matsushita --start--
+repository_admin_usagestatistics_link_display_setting = "Thống kê sử dụng liên kết cài đặt hiển thị"
+repository_admin_usagestatistics_link_display = "
+Thống kê sử dụng màn hình hiển thị liên kết"
+;2014/12/16 K.Matsushita --end--
 ;2010/11/15 A.Suzuki --start--
 repository_admin_author_id_prefix_setting = "Thiết lập Tiền tố ID tác giả"
 repository_admin_author_id_prefix_edit = "Tác giả Mã Tiền tố chỉnh sửa"
@@ -864,6 +914,13 @@ repository_admin_privatetree_indexname_sort_desc = "tên chỉ số (thứ tự
 repository_admin_privatetree_parent_index = "chỉ số đăng ký"
 repository_admin_privatetree_writable_notice = "*Khi không có ghi trong thẩm quyền của [webapp / modules / kho / config / define.inc.php], một thiết lập của một cây tư nhân có thể không được thay đổi. "
 ;Add privatetree setting 2013/04/04 K.Matsuo --end--
+;Add robot list 2014/04/07 S.Suzuki --start--
+repository_admin_robotlist_delete_execute = "Đăng xóa loại trừ"
+repository_admin_robotlist_now_executing = "Bây giờ thực hiện..."
+repository_admin_robotlist_process_kill = "giết chết quá trình"
+repository_admin_robotlist_common_crawler_list = "Danh sách thu thập được chia sẻ"
+repository_admin_robotlist_no_robotlist = "Không có danh sách Robot mua"
+;Add robot list 2014/04/07 S.Suzuki --end--
 ;Add update usage statistics 2012/07/01 A.Suzuki --start--
 repository_admin_update_usage_statistics = "Cập nhật thống kê sử dụng"
 repository_admin_update_usage_statistics_comment = "Cập nhật thống kê sử dụng..."
@@ -898,6 +955,12 @@ repository_admin_sitelicense_send_mail_activate = "Kích hoạt để gửi tran
 repository_admin_sitelicense_send_mail_running = "Bắt đầu gửi trang web Giấy phép mail ..."
 repository_admin_sitelicense_send_mail_errorMsg = "Không gửi trang web Giấy phép mail."
 ;Add sitelicense mail 2014/04/23 T.Ichikawa --end--
+;Add default search type 2014/12/03 K.Sugimoto --start--
+repository_admin_search = "cài đặt tìm kiếm"
+repository_admin_default_search_type = "Các thiết lập tìm kiếm mặc định"
+repository_admin_detail_search_type = "toàn văn"
+repository_admin_simple_search_type = "đơn giản"
+;Add default search type 2014/12/03 K.Sugimoto --end--
 
 ;2010/02/18 K.Ando --start--
 ;ranking 
@@ -1031,6 +1094,13 @@ repository_item_embargo_index_error = "chỉ định một chỉ số mà áp d
 repository_item_embargo_select_index = "chọn chỉ số từ cây"
 repository_item_embargo_registered_index = "chỉ số này đã được đăng ký để ELS"
 repository_item_embargo_free_licence = "mô tả bản quyền của riêng bạn"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
+
 ; item management(sort order)
 repository_item_sortorder = "thiết lập thứ tự sắp xếp"
 repository_item_sortorder_target_index = "hiển thị thay đổi chỉ số mục tiêu"
@@ -1043,17 +1113,34 @@ repository_item_listdelete_target_index = "chỉ số để xóa"
 repository_item_listdelete_delete_button_title = "xóa các mục"
 repository_item_listdelete_sub_index = "subindex mục cũng xóa"
 repository_item_listdelete_select_index_list_default = "hãy chọn các chỉ số"
+repository_item_listdelete_selsect_index_or_search_keyword = "Hãy chạy hoặc từ khóa tìm kiếm để chọn các chỉ số"
 
 ; item management(DOI bulk grant)
 repository_item_edit_jalcdoi = "JaLC DOI"
-repository_item_edit_crossref = "Tài liệu tham khảo chéo"
-repository_item_edit_item_name = "mục"
+repository_item_edit_crossref = "JaLC CrossRef DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --start--
+repository_item_edit_datacite = "JaLC DataCite DOI"
+repository_item_edit_item_name = "Tiêu đề"
 repository_item_edit_select = "Vui lòng chọn"
+repository_item_add_doi = "DOI cấp"
 repository_item_enterdoi = "DOI số lượng lớn tài trợ"
 repository_item_enterdoi_target_index = "DOI chỉ số số lượng lớn được cấp"
 repository_item_enterdoi_target_item = "(101 mục sau loại trừ) được cấp số lượng lớn DOI"
 repository_item_enterjalcdoi_all_check = "Tôi kiểm tra tất cả các JaLC DOI "
-repository_item_entercrossref_all_check = "Tôi kiểm tra tất cả các đường Tài liệu tham khảo"
+repository_item_entercrossref_all_check = "Tôi kiểm tra tất cả các Cross Ref "
+repository_item_enterdatacite_all_check = "Tôi kiểm tra tất cả các DataCite "
+repository_item_doi_count_msg = "Tôi đã được cấp %s Nhận xét DOI"
+repository_item_enterdoi_error = "Nó không đáp ứng các điều kiện áp dụng các DOI"
+; 2015/02/10 Add DataCite K.Sugimoto --end--
+
+;2015/04/08 Add item search delete K.Matsushita --start--
+repository_item_search_delete = "Tìm kiếm Xóa"
+repository_item_search_delete_title = "Tiêu đề"
+repository_item_search_delete_button_title = "Xoá các mục"
+repository_item_search_delete_search = "Hãy chạy từ khóa tìm kiếm"
+repository_item_search_delete_num = "%s Tôi đã gỡ bỏ"
+repository_item_search_delete_error_no_check = "Hãy đặt một kiểm tra"
+;2015/04/08 Add item search delete K.Matsushita --start--
 
 ; item listing interface (search results)
 repository_search_index = "chỉ số"
@@ -1190,6 +1277,7 @@ repository_import_error_msg_flash_pub_date = "Định dạng Flash ngày xuất
 repository_import_error_msg_item_type = "Không thể tìm thấy mục các loại thông tin của sản phẩm"
 repository_import_error_msg_edit_item_url = "miền được chỉ định trong thẻ repository_edit không phù hợp với trang web này"
 repository_import_error_msg_edit_item_num = "tag repository_edit có nhiều hơn một"
+repository_import_error_msg_can_not_use_item_type = "Bạn không có quyền sử dụng các loại item"
 
 repository_importauthority_result_title = "Nhập khẩu quyền tên."
 repository_importauthority_result_success = "Tác giả nhập thành công."
@@ -1221,7 +1309,7 @@ repository_mapping_confirm = "xác nhận bản đồ"
 repository_mapping_name = "tên siêu dữ liệu"
 repository_mapping_inputtype = "loại đầu vào"
 repository_mapping_dublincore = "Dublin Core"
-repository_mapping_junii2 = "JuNii2"
+repository_mapping_junii2 = "junii2"
 repository_mapping_lom = "LOM"
 repository_mapping_lido = "LIDO"
 repository_mapping_language = "loại ngôn ngữ"
@@ -1243,7 +1331,10 @@ repository_detail_hidden_metadata = "▲ ẩn siêu dữ liệu ▲"
 repository_detail_show_usagestatistics = "Hiển thị thống kê sử dụng"
 repository_detail_openaccess = "Nó được tải về từ YYYY/MM/DD."
 repository_detail_self_doi = "selfDOI"
-
+;Add message about usagestatistics next month K.matsushita 2014/12/03
+repository_detail_usage_statistics_next_month = "Thống kê sử dụng tôi sẵn từ tháng tiếp theo"
+;Add file authority T.Ichikawa 2015/03/20
+repository_detail_file_authority_group = "Downloadable : "
 ;UsageStatistics
 repository_usagestatistics_date_format = "%2$02d/%1$04d"
 repository_usagestatistics_views_title = "Lần đọc"
@@ -1286,6 +1377,9 @@ repository_log_refer = "xem"
 repository_log_of = " của "
 repository_log_num = " số"
 repository_log_period = "thời gian"
+repository_log_set_exclude_address = "Thiết lập địa chỉ IP bị loại trừ"
+repository_log_update_exclude_address = "Loại trừ địa chỉ IP đã được thiết lập."
+repository_log_announce_update_clowler_list = "Vui lòng thực hiện loại trừ log từ quản lý."
 repository_log_print = "in"
 repository_log_item_view = "xem tính cho mục"
 repository_log_nodata = "không có dữ liệu phù hợp"
@@ -1315,6 +1409,8 @@ repository_rank_newitem = "mặt hàng mới"
 repository_rank_newitem_pubdate = "ngày xuất bản"
 repository_rank_thumbnail = "thumbnail"
 repository_rank_link_title = "tập tin tải về"
+repository_rank_statistics_period = "Thống kê Thời gian :"
+repository_rank_registration_date = "Ngày Đăng Kí:"
 
 ;Tree
 repository_index_tree = "cây số"
@@ -1380,6 +1476,14 @@ repository_edittree_post_sitelicense_user = "gửi người sử dụng đăng n
 repository_edittree_online_issn_warning = "* Phản ánh thiết lập cho tất cả các chỉ số trẻ em"
 ; Add ISSN flag 2014/04/15 T.Ichikawa --end--
 
+; Add recursive settings 2015/01/22 S.Suzuki --start--
+repository_edittree_pub_date_recursive = "Thiết lập ngày công bố chỉ số con đệ quy"
+repository_edittree_pdf_cover_recursive = "Thiết lập trang pdf bìa của chỉ số con đệ quy"
+repository_edittree_exclusive_acl_role_ids_recursive = "Thiết lập chính quyền cơ sở của chỉ số con đệ quy"
+repository_edittree_exclusive_acl_room_auth_recursive = "Thiết lập các cơ quan phòng của chỉ số con đệ quy"
+repository_edittree_exclusive_acl_group_ids_recursive = "Thiết lập các cơ quan chức nhóm chỉ số con đệ quy."
+; Add recursive settings 2015/01/22 S.Suzuki --end--
+
 ; Editting tree (error messages)
 repository_edittree_dayerror = "không hợp lệ ngày xuất bản"
 repository_edittree_nodenameerror = "nhập vào một chuỗi với hơn 2 ký tự"
@@ -1502,18 +1606,28 @@ repository_item_date_error = "ngày không hợp lệ"
 repository_item_embargo_open = "truy cập tập tin mở không được thiết lập giá"
 repository_item_embargo_no_download = "tập tin không được đặt giá"
 ;2008/10/23 Y.Nakao --end--
+;2015/03/20 T.Ichikawa --start--
+repository_item_emvargo_file_authority = "Bạn không thể thiết lập quyền truy cập mở"
+repository_item_embargo_file_authority_no_download = "Bạn không thể thiết lập quyền nếu bạn không xuất bản"
+repository_item_set_file_authority = "Hãy thiết lập các nhóm để cho phép việc tải các tập tin"
+repository_item_file_authority_attention = "Nhóm đã không được thiết lập không thể tải về các tập tin"
+repository_item_add_file_authority = "thiết lập quyền"
+repository_item_download_file_authority = "Cho phép cài đặt Tải về"
+;2015/03/20 T.Ichikawa --end--
 ;2008/11/18 A.Suzuki --start--
 repository_item_fill_data_type = "thư mục DB"
-repository_item_fill_data_type_amazon = "Amazon"
+repository_item_fill_data_type_amazon = "ISBN"
 repository_item_fill_data_type_pubmed = "PubMed"
 repository_item_fill_data_type_cinii = "CiNii"
-repository_item_fill_data_type_itemid = "ItemID"
+repository_item_fill_data_type_itemid = "WEKO_ItemID"
 repository_item_fill_data_type_ichushi = "ICHUSHI"
+repository_item_fill_data_type_crossref = "CrossRef"
 repository_item_fill_data_id_isbn = "ISBN"
 repository_item_fill_data_id_pmid = "PMID"
 repository_item_fill_data_id_naid = "NAID"
 repository_item_fill_data_id_item = "ItemID"
 repository_item_fill_data_id_ichushi = "ICHUSHI ID"
+repository_item_fill_data_id_crossref = "CrossRef"
 repository_item_fill_data_no_type_error = "Cơ sở dữ liệu thư mục đã không được chọn"
 repository_item_fill_data_no_id_error = "Tìm kiếm ID không nhập"
 repository_item_fill_data_no_data_error = "Không có thể nhận được dữ liệu điền"
@@ -1524,11 +1638,19 @@ repository_item_fill_data_no_metadata_error = ": Mua lại siêu dữ liệu đ
 repository_item_fill_data_access_error = "đã không thể được truy cập."
 repository_item_fill_data_callback_admin = "Xin hỏi một quản trị viên."
 ;2012/11/27 A.jin --end--
+;2015/01/06 K.Matsushita --start--
+repository_item_more_id = "more ID"
+repository_item_fill = "fill"
+;2015/01/06 K.Matsushita --end--
 ;2014/06/05 R.Matsuura -start--
-repository_item_enter_jalcdoi = "Cấp JaLC DOI "
+repository_item_enter_jalcdoi = "JaLC DOI"
 repository_item_delete_jalcdoi = "Thả JaLC DOI "
-repository_item_enter_crossref = "Cấp đường Tài liệu tham khảo"
-repository_item_delete_crossref = "Thả thập Tài liệu tham khảo "
+repository_item_enter_crossref = "JaLC CrossRef DOI"
+repository_item_delete_crossref = "Thả JaLC CrossRef DOI "
+;2015/02/10 K.Sugimoto --start--
+repository_item_enter_datacite = "JaLC DataCite DOI"
+repository_item_delete_datacite = "Thả JaLC DataCite DOI "
+;2015/02/10 K.Sugimoto --end--
 ;2014/09/11 K.Sugimoto -start--
 repository_item_enter_library_jalcdoi = "Multiple Resolution "
 repository_item_delete_library_jalcdoi = "Thả Multiple Resolution "
@@ -1600,6 +1722,12 @@ repository_item_msg_selectlicense = "chọn giấy phép"
 repository_item_file_free_licence = "mô tả bản quyền của riêng bạn"
 repository_item_set_index = "chọn bộ chỉ số"
 repository_item_file_not_input = "nộp không đăng ký"
+repository_item_file_license_notation_by = "Creative Commons : Attribution"
+repository_item_file_license_notation_by_sa = "Creative Commons : Attribution - ShareAlike"
+repository_item_file_license_notation_by_nd = "Creative Commons : Attribution - NoDerivs"
+repository_item_file_license_notation_by_nc = "Creative Commons : Attribution - NonCommercial"
+repository_item_file_license_notation_by_nc_sa = "Creative Commons : Attribution - NonCommercial - ShareAlike"
+repository_item_file_license_notation_by_nc_nd = "Creative Commons : Attribution - NonCommercial - NoDerivs"
 
 ;
 repository_confirmation_cancel = "Bạn có chắc chắn bạn muốn hủy bỏ?"
diff --git a/repository/logreport/Logreport.class.php b/repository/logreport/Logreport.class.php
index 0a0d84e..8ce5d17 100644
--- a/repository/logreport/Logreport.class.php
+++ b/repository/logreport/Logreport.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Logreport.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Logreport.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,6 +13,7 @@
 include_once MAPLE_DIR.'/includes/pear/File/Archive.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDownload.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 
 /**
  * Make log report
@@ -24,674 +25,185 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDownload.clas
  * @project  NetCommons Project, supported by National Institute of Informatics
  * @access    public
  */
-class Repository_Logreport extends RepositoryAction
+class Repository_Logreport extends WekoAction
 {
-    // component
-    var $Session = null;
+    // const
+    const FILE_NAME_SITE_ACCESS = "logReport_SiteAccess_";
+    const FILE_NAME_FILE_DOWNLOAD = "logReport_FileView_";
+    const FILE_NAME_PAY_PER_VIEW = "logReport_PayPerView_";
+    const FILE_NAME_INDEX_ACCESS = "logReport_IndexAccess_";
+    const FILE_NAME_SUPPLE_ACCESS = "logReport_SuppleAccess_";
+    const FILE_NAME_HOST_ACCESS = "logReport_HostAccess_";
+    const FILE_NAME_DETAIL_VIEW = "logReport_DetailView_";
+    const FILE_NAME_USER_AFFILIATE = "logReport_UserAffiliate_";
+    const FILE_NAME_DOWNLOAD_PER_USER = "logReport_FileViewPerUser_";
+    const FILE_NAME_SEARCH_COUNT = "logReport_SearchCount_";
+    
+    const IS_SITELICENSE = "is_sitelicense";
+    const IS_NOT_SITELICENSE = "is_not_sitelicense";
     
     // start date
-    var $sy_log = null;
-    var $sm_log = null;
-    var $sd_log = 01;
-    var $start_date = '';
-    var $disp_start_date = '';
+    public $sy_log = null;
+    public $sm_log = null;
+    public $sd_log = 01;
+    public $start_date = '';
+    public $disp_start_date = '';
     // end date
-    var $ey_log = "";
-    var $em_log = "";
-    var $ed_log = 31;
-    var $end_date = '';
-    var $disp_end_date = '';
-    // for lang resource
-    var $smartyAssign = null;
-    // site license
-    var $site_licrnse = array();
-    // log exception
-    var $log_exception = '';
-    var $lang = "";
+    public $ey_log = "";
+    public $em_log = "";
+    public $ed_log = 31;
+    public $end_date = '';
+    public $disp_end_date = '';
+    
+    /**
+     * If this value is true, send mail with log report
+     *
+     * @var boolean
+     */
+    public $mail = null;
+    
+    /**
+     * send mail object
+     *
+     * @var object
+     */
+    public $mailMain = null;
+    
+    /**
+     * nc2 login id with admin authority
+     *
+     * @var string
+     */
+    public $login_id = null;
     
-    // Add send mail for log report 2010/03/10 Y.Nakao --start--
-    var $mail = null;
-    var $mailMain = null;
-    var $login_id = null;
-    var $password = null;
-    var $user_authority_id = "";
-    var $authority_id = "";
-    // Add send mail for log report 2010/03/10 Y.Nakao --end--
+    /**
+     * nc login password with admin authority
+     *
+     * @var string
+     */
+    public $password = null;
     
-    function execute()
+    /**
+     * language resource
+     *
+     * @var object
+     */
+    private $smartyAssign = null;
+    
+    /**
+     * display language by Session
+     *
+     * @var string
+     */
+    private $lang = "";
+    
+    /**
+     * NC2 group list for write log report
+     *
+     * @var array
+     */
+    private $groupList = null;
+    
+    /**
+     * create log report(download or send mail)
+     *
+     */
+    protected function executeApp()
     {
-        try {
-            // -----------------------------------------------
-            // init
-            // -----------------------------------------------
-            // start action
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );
-                $DetailMsg = null;
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );
-                $this->failTrans();
-                throw $exception;
-            }
-            // get language
-            $this->lang = $this->Session->getParameter("_lang");
-            // Add send mail for log report 2010/03/10 Y.Nakao --start--
-            // get language resource
-            $this->setLangResource();
-            $this->smartyAssign = $this->Session->getParameter("smartyAssign");
-
-            // Fix bulk log file 2014/08/11 Y.Nakao --start--
-            ini_set('max_execution_time', 2400);
-            ini_set('memory_limit', '2048M');
-            // Fix bulk log file 2014/08/11 Y.Nakao --end--
-            
-            // -----------------------------------------------
-            // check login
-            // -----------------------------------------------
-            $user_id = $this->Session->getParameter("_user_id");
-            if($user_id != "0"){
-                // check auth
-                $this->user_authority_id = $this->Session->getParameter("_user_auth_id");
-                $this->authority_id = $this->getRoomAuthorityID($user_id);
-            } else if($this->login_id != null && strlen($this->login_id) > 0 &&
-                $this->password != null && strlen($this->password) > 0){
-                $ret = $this->checkLogin($this->login_id, $this->password, $Result_List, $error_msg);
-                if($ret === false){
-                    echo $this->smartyAssign->getLang("repository_log_report_error");
-                    return false;
-                }
-            } else {
-                echo $this->smartyAssign->getLang("repository_log_report_error");
-                return false;
-            }
-            if($this->user_authority_id < $this->repository_admin_base || $this->authority_id < $this->repository_admin_room){
-                // not admin
-                echo $this->smartyAssign->getLang("repository_log_report_error");
-                return false;
-            }
-            // Add send mail for log report 2010/03/10 Y.Nakao --end--
-            
-            // set start date
-            if($this->sy_log == null || strlen($this->sy_log) == 0 || intval($this->sy_log) < 1 || 
-                $this->sm_log == null || strlen($this->sm_log) == 0 || intval($this->sm_log) < 1 || 12 < intval($this->sm_log) ){
-
-                $NOW_DATE = new Date();
-                $query = "SELECT DATE_FORMAT(DATE_SUB('".$NOW_DATE->getYear()."-".$NOW_DATE->getMonth()."-".$NOW_DATE->getDay()."', INTERVAL 1 MONTH), '%Y') AS tmp_year,".
-                         " DATE_FORMAT(DATE_SUB('".$NOW_DATE->getYear()."-".$NOW_DATE->getMonth()."-".$NOW_DATE->getDay()."', INTERVAL 1 MONTH), '%m') AS tmp_month;";
-                $result = $this->Db->execute($query);
-                if($result === false || count($result) != 1){
-                    return false;
-                }
-                $this->sy_log = $result[0]['tmp_year'];
-                $this->sm_log = sprintf("%02d",$result[0]['tmp_month']);
-            }
+        $this->initForLogreport();
+        
+        if($this->isLoginAdministrator() === false)
+        {
+            echo $this->smartyAssign->getLang("repository_log_report_error");
+            return "";
+        }
+        
+        // set start date
+        $this->start_date = sprintf("%d-%02d-%02d",$this->sy_log, $this->sm_log,$this->sd_log);
+        $this->disp_start_date = sprintf("%d-%02d",$this->sy_log, $this->sm_log);
+        // set end date
+        $this->ey_log = $this->sy_log;
+        $this->em_log = $this->sm_log;
+        $this->end_date = sprintf("%d-%02d-%02d",$this->ey_log, $this->em_log,$this->ed_log);
+        $this->disp_end_date = sprintf("%d-%02d",$this->ey_log, $this->em_log);
+        
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Db = $this->Db;
+        
+        // -----------------------------------------------
+        // check logreport exist
+        // -----------------------------------------------
+        if($this->isExistLogReportFileAndDownload())
+        {
+            $zip_file = "logReport_". sprintf("%d%02d",$this->sy_log, $this->sm_log).".zip";
+            // when log file exist, download that log file
+            $repositoryDownload = new RepositoryDownload();
+            $repositoryDownload->downloadFile(WEBAPP_DIR."/logs/weko/logreport/".$zip_file, $zip_file);
+        }
+        else 
+        {
+            $tmp_dir = $this->createTempDirectory();
             
-            // send mail address check
-            $users = array();
-            if($this->mail == "true"){
-                $this->getLogReportMailInfo($users);
-                if(count($users) == 0){
-                    echo $this->smartyAssign->getLang("repository_log_mail_text");
-                    return false;
-                }
-            }
-            // set start date
-            $this->start_date = sprintf("%d-%02d-%02d",$this->sy_log, $this->sm_log,$this->sd_log);
-            $this->disp_start_date = sprintf("%d-%02d",$this->sy_log, $this->sm_log);
-            // set end date
-            $this->ey_log = $this->sy_log;
-            $this->em_log = $this->sm_log;
-            $this->end_date = sprintf("%d-%02d-%02d",$this->ey_log, $this->em_log,$this->ed_log);
-            $this->disp_end_date = sprintf("%d-%02d",$this->ey_log, $this->em_log);
+            $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+            $businessLogreport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+            $businessLogreport->setStartYear($this->sy_log);
+            $businessLogreport->setStartMonth($this->sm_log);
+            $businessLogreport->setEndYear($this->ey_log);
+            $businessLogreport->setEndMonth($this->em_log);
+            $businessLogreport->setAdminBase($this->repository_admin_base);
+            $businessLogreport->setAdminRoom($this->repository_admin_room);
+            $businessLogreport->execute();
             
-            // Add log move 2010/05/21 Y.Nakao --start--
-            // -----------------------------------------------
-            // check logreport exist
-            // -----------------------------------------------
-            // set zip file name
-            $zip_file = "logReport_".
-                        str_replace("-", "", $this->disp_start_date).".zip";
-            if(file_exists(WEBAPP_DIR."/logs/weko/logreport/".$zip_file)){
-                // when log file exist, download that log file
-                $repositoryDownload = new RepositoryDownload();
-                $repositoryDownload->downloadFile(WEBAPP_DIR."/logs/weko/logreport/".$zip_file, $zip_file);
-                exit();
-            }
-            // Add log move 2010/05/21 Y.Nakao --end--
-            
-            // add for compress files
+            // create each log report
             $output_files = array();
-            //$date = date("YmdHis");
-            $query = "SELECT DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS now_date;";
-            $result = $this->Db->execute($query);
-            if($result === false || count($result) != 1){
-                return false;
-            }
-            $date = $result[0]['now_date'];
-            $tmp_dir = WEBAPP_DIR."/uploads/repository/_".$date;
-            mkdir( $tmp_dir, 0777 );
-            // set log exclusion
-
-            // Add log exclusion from user-agaent 2011/05/09 H.Ito --start--
-            $this->log_exception = $this->createLogExclusion();
-            // Add log exclusion from user-agaent 2011/05/09 H.Ito --end--
-            
-            // -----------------------------------------------
-            // make log report
-            //  operation_id =  1:アイテム登録(entry item)
-            //                  2:ファイルダウンロード(download file)
-            //                  3:詳細画面表示(detail view)
-            //                  4:検索(search)
-            //                  5:TOP画面(TOP)
-            // -----------------------------------------------
-            
-            $BOM = pack('C*',0xEF,0xBB,0xBF);
-            
-            //$start_time = microtime(true); // 計測開始
-            
-            // サイトライセンス別アクセス数(access num as site lisence)
-            $log_str = $this->makeAccessLogReport();
-            $log_file = $tmp_dir . "/logReport_SiteAccess_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            
-            // 課金ファイルダウンロード数(download file num)
-            $fileLogStr = "";
-            $priceLogStr = "";
-            $this->makeFileDownloadLogReport($fileLogStr, $priceLogStr);
-            // FileView
-            $log_file = $tmp_dir . "/logReport_FileView_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$fileLogStr);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            
-            // PayPerView
-            $log_file = $tmp_dir . "/logReport_PayPerView_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$priceLogStr);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            
-            // インデックごとの詳細画面アクセス数(detail view as index)
-            $log_str = $this->makeIndexLogReport();
-            $log_file = $tmp_dir . "/logReport_IndexAccess_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // check supple link 2010/03/16 Y.Nakao --start--
-            if($this->checkSuppleWEKOlink(true)){
-            // Add supple log report 2009/09/04 A.Suzuki --start--
-            // サプリコンテンツの閲覧回数およびダウンロード回数(detail view and download file num as supple items)
-            $log_str = $this->makeSuppleLogReport();
-            $log_file = $tmp_dir . "/logReport_SuppleAccess_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add supple log report 2009/09/04 A.Suzuki --end--
-            }
-            // check supple link 2010/03/16 Y.Nakao --end--
-            
-            // Add access log per host 2010/04/01 Y.Nakao --start--
-            $log_str = $this->makeHostLogReport();
-            $log_file = $tmp_dir . "/logReport_HostAccess_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add access log per host 2010/04/01 Y.Nakao --end--
-            
-            
-            /**
-            // FLASH表示はなくなったのでログを出力しないように対応 2013/06/12 Y.Nakao
-            // Add Flash view log 2011/03/01 Y.Nakao --start--
-            $log_str = $this->makeFlashViewLogReport();
-            $log_file = $tmp_dir . "/logReport_FlashView_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add Flash view log 2011/03/01 Y.Nakao --end--
-            */
-            
-            
-            // Add detail view log 2011/03/10 Y.Nakao --start--
-            $log_str = $this->makeDetailViewLogReport();
-            $log_file = $tmp_dir . "/logReport_DetailView_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add detail view log 2011/03/10 Y.Nakao --end--
-            
-            // Add user info 2011/07/25 Y.Nakao --start--
-            $log_str = $this->makeUserLogReport();
-            $log_file = $tmp_dir . "/logReport_UserAffiliate_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add user info 2011/07/25 Y.Nakao --end--
-
-            // Add user download logreport 2012/10/29 A.jin --start--
-            $log_str = $this->makeUsersDLLogReport();
-            $log_file = $tmp_dir . "/logReport_FileViewPerUser_".
-                        str_replace("-", "", $this->disp_start_date).".tsv";
-            $log_report = fopen($log_file, "w");
-            fwrite($log_report, $BOM.$log_str);
-            fclose($log_report);
-            array_push( $output_files, $log_file );
-            // Add user download logreport 2012/10/29 A.jin --end--
+            $output_files = $this->createLogReport($tmp_dir);
             
             // -----------------------------------------------
             // compress zip file
             // -----------------------------------------------
             // set zip file name
-            $zip_file = "logReport_".
-                        str_replace("-", "", $this->disp_start_date).".zip";
+            $zip_file = "logReport_". $this->getStrOfJoinedStartYearAndStartMonth().".zip";
             // compress zip file    
             File_Archive::extract(
                 $output_files,
                 File_Archive::toArchive($zip_file, File_Archive::toFiles( $tmp_dir."/" ))
             );
-
+    
             // -----------------------------------------------
             // download zip file
             // -----------------------------------------------
-            // Add send mail for log report 2010/03/10 Y.Nakao --start--
             if($this->mail == "true"){
                 // send mail
                 $this->sendMailLogReport($tmp_dir."/".$zip_file, $zip_file);
             } else {
-            // ダウンロードアクション処理(download)
-            // Add RepositoryDownload action 2010/03/30 A.Suzuki --start--
-            $repositoryDownload = new RepositoryDownload();
-            $repositoryDownload->downloadFile($tmp_dir."/".$zip_file, $zip_file);
-            // Add RepositoryDownload action 2010/03/30 A.Suzuki --end--
+                // ダウンロードアクション処理(download)
+                $repositoryDownload = new RepositoryDownload();
+                $repositoryDownload->downloadFile($tmp_dir."/".$zip_file, $zip_file);
             }
-            // Add send mail for log report 2010/03/10 Y.Nakao --end--
             
             // delete tmp folder
-            $this->removeDirectory($tmp_dir);
-            
-            // -----------------------------------------------
-            // end action
-            // -----------------------------------------------
-            $result = $this->exitAction();
-            if ( $result == false ){
-                return "error";
-            }
-            
-            exit();
-            
-        }
-        catch ( RepositoryException $Exception) {
-            $this->logFile(
-                "SampleAction",
-                "execute",
-                $Exception->getCode(),
-                $Exception->getMessage(),
-                $Exception->getDetailMsg() );
-            $this->exitAction();
-            return "error";
+            $repositoryAction->removeDirectory($tmp_dir);
         }
+        
+        return "";
     }
     
     /**
-     * サイトライセンス別アクセス数(access num as site lisence)
+     * access num as site lisence
      *
      * @return string log report 
      */
-    function makeAccessLogReport(){
-        $log_data = array();
-        // -----------------------------------------------
-        // site license or not init
-        // -----------------------------------------------
-        // site license total
-        $is_sitelicense = $this->smartyAssign->getLang("repository_log_is_sitelicense");
-        $log_data[$is_sitelicense]['top'] = 0;
-        $log_data[$is_sitelicense]['search'] = 0;
-        $log_data[$is_sitelicense]['detail'] = 0;
-        $log_data[$is_sitelicense]['download'] = 0;
-        // not site license total
-        $not_sitelicense = $this->smartyAssign->getLang("repository_log_not_sitelicense");
-        $log_data[$not_sitelicense]['top'] = 0;
-        $log_data[$not_sitelicense]['search'] = 0;
-        $log_data[$not_sitelicense]['detail'] = 0;
-        $log_data[$not_sitelicense]['download'] = 0;
-        // -----------------------------------------------
-        // get site license organization and init
-        // -----------------------------------------------
-        $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                 "WHERE param_name = 'site_license'; ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str = $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        if(strlen($result[0]['param_value']) > 0){
-            $site_license = explode("|", $result[0]['param_value']);
-            for($ii=0; $ii<count($site_license); $ii++){
-                $param_site_license = explode(",", $site_license[$ii]);
-                $organization = $param_site_license[0];
-                // Bugfix Input scrutiny 2011/06/17 Y.Nakao --start--
-                // decode explode delimiters.
-                $organization = str_replace("&#124;", "|", $organization);
-                $organization = str_replace("&#44;", ",", $organization);
-                $organization = str_replace("&#46;", ".", $organization);
-                // Bugfix Input scrutiny 2011/06/17 Y.Nakao --end--
-                $log_data[$organization]['top'] = 0;
-                $log_data[$organization]['search'] = 0;
-                $log_data[$organization]['detail'] = 0;
-                $log_data[$organization]['download'] = 0;
-            }
-        }
+    private function makeAccessLogReport(){
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $businessLogreport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $businessLogreport->setAdminBase($this->repository_admin_base);
+        $businessLogreport->setAdminRoom($this->repository_admin_room);
         
-        // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --start--
-        // Get param table data : site_license_item_type_id
-        $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                 "WHERE param_name = 'site_license_item_type_id'; ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str = $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        $siteLicenseItemTypeId = explode(",", trim($result[0]['param_value']));
-        // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --end--
+        $log_data = $businessLogreport->getSiteAccessReport();
+        
+        $is_sitelicense = self::IS_SITELICENSE;
+        $not_sitelicense = self::IS_NOT_SITELICENSE;
         
-        // -----------------------------------------------
-        // get WEKO Top page access
-        // -----------------------------------------------
-        $query = "SELECT ip_address, site_license FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                " WHERE log.record_date >= '$this->start_date 00:00:00.000' ". 
-                " AND log.record_date <= '$this->end_date 23:59:99.999' ".
-                " AND log.operation_id='5' ".
-                $this->log_exception;
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str = $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        // check site license
-        for($ii=0; $ii<count($result); $ii++){
-            if(isset($result[$ii]['site_license']))
-            {
-                // Exist site license info in log recode
-                if($result[$ii]['site_license'] == 1)
-                {
-                    // Site license ON
-                    // Check site license organization
-                    if(!$this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization))
-                    {
-                        // Not exist organization
-                        $organization = $result[$ii]['ip_address'];
-                    }
-                    if(!isset($log_data[$organization]))
-                    {
-                        $log_data[$organization]['top'] = 0;
-                        $log_data[$organization]['search'] = 0;
-                        $log_data[$organization]['detail'] = 0;
-                        $log_data[$organization]['download'] = 0;
-                    }
-                    $log_data[$organization]['top']++;
-                    $log_data[$is_sitelicense]['top']++;
-                }
-                else
-                {
-                    // Site license OFF
-                    $log_data[$not_sitelicense]['top']++;
-                }
-            }
-            else
-            {
-                // Not exist site license info in log recode
-                $organization = "";
-                if($this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization)){
-                    $log_data[$organization]['top']++;
-                    $log_data[$is_sitelicense]['top']++;
-                } else {
-                    $log_data[$not_sitelicense]['top']++;
-                }
-            }
-        }
-        // -----------------------------------------------
-        // get search result page access
-        // -----------------------------------------------
-        $query = "SELECT ip_address, site_license FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                " WHERE log.record_date >= '$this->start_date 00:00:00.000' ". 
-                " AND log.record_date <= '$this->end_date 23:59:99.999' ".
-                " AND log.operation_id='4' ".
-                $this->log_exception;
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str = $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        // check site license
-        for($ii=0; $ii<count($result); $ii++){
-            if(isset($result[$ii]['site_license']))
-            {
-                // Exist site license info in log recode
-                if($result[$ii]['site_license'] == 1)
-                {
-                    // Site license ON
-                    // Check site license organization
-                    if(!$this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization))
-                    {
-                        // Not exist organization
-                        $organization = $result[$ii]['ip_address'];
-                    }
-                    if(!isset($log_data[$organization]))
-                    {
-                        $log_data[$organization]['top'] = 0;
-                        $log_data[$organization]['search'] = 0;
-                        $log_data[$organization]['detail'] = 0;
-                        $log_data[$organization]['download'] = 0;
-                    }
-                    $log_data[$organization]['search']++;
-                    $log_data[$is_sitelicense]['search']++;
-                }
-                else
-                {
-                    // Site license OFF
-                    $log_data[$not_sitelicense]['search']++;
-                }
-            }
-            else
-            {
-                // Not exist site license info in log recode
-                $organization = "";
-                if($this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization)){
-                    $log_data[$organization]['search']++;
-                    $log_data[$is_sitelicense]['search']++;
-                } else {
-                    $log_data[$not_sitelicense]['search']++;
-                }
-            }
-        }
-        // -----------------------------------------------
-        // get detail display page access
-        // -----------------------------------------------
-        // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --start--
-        $query = "SELECT ip_address, item_type_id, site_license ".
-                 "FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                 "LEFT JOIN ".DATABASE_PREFIX."repository_item AS item ".
-                 "ON log.item_id = item.item_id AND log.item_no = item.item_no ".
-                 " WHERE log.record_date >= '$this->start_date 00:00:00.000' ".
-                 " AND log.record_date <= '$this->end_date 23:59:99.999' ".
-                 " AND log.operation_id='3' ".
-                 $this->log_exception;
-        // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --end--
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str = $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        // check site license
-        for($ii=0; $ii<count($result); $ii++){
-            if(isset($result[$ii]['site_license']))
-            {
-                // Exist site license info in log recode
-                if($result[$ii]['site_license'] == 1)
-                {
-                    // Site license ON
-                    // Check site license organization
-                    if(!$this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization))
-                    {
-                        // Not exist organization
-                        $organization = $result[$ii]['ip_address'];
-                    }
-                    if(!isset($log_data[$organization]))
-                    {
-                        $log_data[$organization]['top'] = 0;
-                        $log_data[$organization]['search'] = 0;
-                        $log_data[$organization]['detail'] = 0;
-                        $log_data[$organization]['download'] = 0;
-                    }
-                    $log_data[$organization]['detail']++;
-                    $log_data[$is_sitelicense]['detail']++;
-                }
-                else
-                {
-                    // Site license OFF
-                    $log_data[$not_sitelicense]['detail']++;
-                }
-            }
-            else
-            {
-                // Not exist site license info in log recode
-                $organization = "";
-                if($this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization))
-                {
-                    // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --start--
-                    $matchFlag = false;
-                    for($jj=0; $jj<count($siteLicenseItemTypeId); $jj++)
-                    {
-                        if($siteLicenseItemTypeId[$jj] == $result[$ii]['item_type_id'])
-                        {
-                            $matchFlag = true;
-                            break;
-                        }
-                    }
-                    if($matchFlag)
-                    {
-                        $log_data[$not_sitelicense]['detail']++;
-                    }
-                    else
-                    {
-                        $log_data[$organization]['detail']++;
-                        $log_data[$is_sitelicense]['detail']++;
-                    }
-                    // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --end--
-                } else {
-                    $log_data[$not_sitelicense]['detail']++;
-                }
-            }
-        }
-        // -----------------------------------------------
-        // get download access
-        // -----------------------------------------------
-        // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --start--
-        // Modify for remove IE Continuation log K.Matsuo 2011/11/15 --start-- 
-        // Fix WEKO-2014-003 / 同一ユーザーのアクセスかを判定する条件を IPアドレス、ユーザーエージェント、ユーザーIDが一致していること に修正した 2014/06/11 Y.Nakao --start--
-        $query = "SELECT DISTINCT DATE_FORMAT( record_date, '%Y%m%d%H%i' ), ".
-                 " ip_address, user_agent, log.item_id, log.item_no, attribute_id, file_no, ".
-                 " user_id, item.item_type_id, site_license ".
-                 "FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                 "LEFT JOIN ".DATABASE_PREFIX."repository_item AS item ".
-                 "ON log.item_id = item.item_id AND log.item_no = item.item_no ".
-                 "WHERE log.record_date >= '$this->start_date 00:00:00.000' ". 
-                 "AND log.record_date <= '$this->end_date 23:59:99.999' ".
-                 "AND log.operation_id='2' ".
-                 $this->log_exception;
-        // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --end--
-        // Fix WEKO-2014-003 / 同一ユーザーのアクセスかを判定する条件を IPアドレス、ユーザーエージェント、ユーザーIDが一致していること に修正した 2014/06/11 Y.Nakao --end--
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str = $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        // check site license
-        for($ii=0; $ii<count($result); $ii++){
-            if(isset($result[$ii]['site_license']))
-            {
-                // Exist site license info in log recode
-                if($result[$ii]['site_license'] == 1)
-                {
-                    // Site license ON
-                    // Check site license organization
-                    if(!$this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization))
-                    {
-                        // Not exist organization
-                        $organization = $result[$ii]['ip_address'];
-                    }
-                    if(!isset($log_data[$organization]))
-                    {
-                        $log_data[$organization]['top'] = 0;
-                        $log_data[$organization]['search'] = 0;
-                        $log_data[$organization]['detail'] = 0;
-                        $log_data[$organization]['download'] = 0;
-                    }
-                    $log_data[$organization]['download']++;
-                    $log_data[$is_sitelicense]['download']++;
-                }
-                else
-                {
-                    // Site license OFF
-                    $log_data[$not_sitelicense]['download']++;
-                }
-            }
-            else
-            {
-                // Not exist site license info in log recode
-                $organization = "";
-                if($this->checkSiteLicenseForLogReport($result[$ii]['ip_address'], $organization))
-                {
-                    // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --start--
-                    $matchFlag = false;
-                    for($jj=0; $jj<count($siteLicenseItemTypeId); $jj++)
-                    {
-                        if($siteLicenseItemTypeId[$jj] == $result[$ii]['item_type_id'])
-                        {
-                            $matchFlag = true;
-                            break;
-                        }
-                    }
-                    if($matchFlag)
-                    {
-                        $log_data[$not_sitelicense]['download']++;
-                    }
-                    else
-                    {
-                        $log_data[$organization]['download']++;
-                        $log_data[$is_sitelicense]['download']++;
-                    }
-                    // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --end--
-                } else {
-                    $log_data[$not_sitelicense]['download']++;  
-                }
-            }
-        }
         // -----------------------------------------------
         // make log report
         // -----------------------------------------------
@@ -705,13 +217,13 @@ class Repository_Logreport extends RepositoryAction
         $str .= $this->smartyAssign->getLang("repository_log_item_detail")."\t";
         $str .= $this->smartyAssign->getLang("repository_log_file_download");
         $str .= "\r\n";
-        $str .= $is_sitelicense."\t";
+        $str .= $this->smartyAssign->getLang("repository_log_is_sitelicense")."\t";
         $str .= $log_data[$is_sitelicense]['top']."\t";
         $str .= $log_data[$is_sitelicense]['search']."\t";
         $str .= $log_data[$is_sitelicense]['detail']."\t";
         $str .= $log_data[$is_sitelicense]['download'];
         $str .= "\r\n";
-        $str .= $not_sitelicense."\t";
+        $str .= $this->smartyAssign->getLang("repository_log_not_sitelicense")."\t";
         $str .= $log_data[$not_sitelicense]['top']."\t";
         $str .= $log_data[$not_sitelicense]['search']."\t";
         $str .= $log_data[$not_sitelicense]['detail']."\t";
@@ -740,543 +252,102 @@ class Repository_Logreport extends RepositoryAction
     }
     
     /**
-     * サイトライセンス判定(check site license)
-     *
-     * @param string $access_ip check ip address
-     * @param string $organization 
-     *                  when $access_ip is site license, 
-     *                  set $organization is site license organization.
-     * @return string where wuery for site license
-     */
-    function checkSiteLicenseForLogReport($access_ip, &$organization){
-        // get user ip address
-        $ipaddress = explode(".", $access_ip);
-        $ipaddress = sprintf("%03d", $ipaddress[0]).
-                     sprintf("%03d", $ipaddress[1]).
-                     sprintf("%03d", $ipaddress[2]).
-                     sprintf("%03d", $ipaddress[3]);
-        // get param table data : site_license
-        $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                 "WHERE param_name = 'site_license'; ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return false;
-        }
-        $site_license = explode("|", $result[0]['param_value']);
-        
-        for($ii=0; $ii<count($site_license); $ii++){
-            $param_site_license = explode(",", $site_license[$ii]);
-            $ipaddress_from = explode(",", $param_site_license[1]);
-            if($param_site_license[2] != ""){
-                // from to
-                $ipaddress_to = explode(",", $param_site_license[2]);
-                $ipaddress_from = explode(".", $ipaddress_from[0]);
-                $ipaddress_to = explode(".", $ipaddress_to[0]);
-                $from = sprintf("%03d", $ipaddress_from[0]).
-                        sprintf("%03d", $ipaddress_from[1]).
-                        sprintf("%03d", $ipaddress_from[2]).
-                        sprintf("%03d", $ipaddress_from[3]);
-                $to   = sprintf("%03d", $ipaddress_to[0]).
-                        sprintf("%03d", $ipaddress_to[1]).
-                        sprintf("%03d", $ipaddress_to[2]).
-                        sprintf("%03d", $ipaddress_to[3]);  
-                if( $from <= $ipaddress && $ipaddress <= $to ){
-                    $organization = $param_site_license[0];
-                    // Bugfix Input scrutiny 2011/06/17 Y.Nakao --start--
-                    // decode explode delimiters.
-                    $organization = str_replace("&#124;", "|", $organization);
-                    $organization = str_replace("&#44;", ",", $organization);
-                    $organization = str_replace("&#46;", ".", $organization);
-                    // Bugfix Input scrutiny 2011/06/17 Y.Nakao --end--
-                    return true;
-                }
-            } else {
-                // same ip
-                if($access_ip == $ipaddress_from[0]){
-                    $organization = $param_site_license[0];
-                    // Bugfix Input scrutiny 2011/06/17 Y.Nakao --start--
-                    // decode explode delimiters.
-                    $organization = str_replace("&#124;", "|", $organization);
-                    $organization = str_replace("&#44;", ",", $organization);
-                    $organization = str_replace("&#46;", ".", $organization);
-                    // Bugfix Input scrutiny 2011/06/17 Y.Nakao --end--
-                    return true;
-                }
-            }
-        }
-        return false;
-    }
-    
-    /**
-     * インデックごとの詳細画面アクセス数(detail view as index)
+     * detail view per index
      *
      * @return string log report 
      */
-    function makeIndexLogReport(){
-        $log_data = array();
-        // -----------------------------------------------
-        // get All detail access num
-        // -----------------------------------------------
-        $query = "SELECT ip_address FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                 " WHERE log.record_date BETWEEN '".$this->start_date." 00:00:00.000'".
-                 " AND '".$this->end_date." 23:59:99.999'".
-                 " AND log.operation_id='3' ".
-                 $this->log_exception;
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $str .= $query."\r\n";
-            $str .= $this->Db->ErrorMsg();
-            return $str;
-        }
-        $total_access = count($result);
+    private function makeIndexLogReport(){
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        $indexAccessReport = $logReport->getIndexAccessReport();
+        $total_access = $indexAccessReport["totalAccess"];
         // -----------------------------------------------
         // get all index's child item access num
         // -----------------------------------------------
         
-        $index_data = array();
-        $index_data = $this->getIndexTree();
+        $index_data = $indexAccessReport["detailViewPerIndex"];
         
         // -----------------------------------------------
         // make log report
-        // -----------------------------------------------
-        $str = '';
-        $str .= $this->smartyAssign->getLang("repository_log_index_report_title")."\r\n";
-        $str .= $this->smartyAssign->getLang("repository_log_totaling_month")."\t".$this->disp_start_date."\r\n";
-        $str .= "\r\n";
-        //$str .= $this->smartyAssign->getLang("repository_log_index_attention")."\r\n";
-        //$str .= "\r\n";
-        $str .= $this->smartyAssign->getLang("repository_search_index")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_access_num");
-        $str .= "\r\n";
-        $str .= $this->smartyAssign->getLang("repository_log_index_detail_access_total")."\t";
-        $str .= $total_access."\t";
-        $str .= "\r\n";
-//      for($ii=0; $ii<count($index_data); $ii++){
-//          $str .= $index_data[$ii]['index_name']."\t";
-//          $str .= $index_data[$ii]['detail_view']."\r\n";
-//      }
-        $this->outIndexTree($index_data, $index_data['0'], "", $str);
-        return $str;
-    }
-    
-    /**
-     * get index tree
-     *
-     * @return unknown
-     */
-    function getIndexTree(){
-        $index = array();
-        // log report have closed indexs.
-        $query = " SELECT idx.index_id, idx.index_name, idx.index_name_english, idx.parent_index_id, cnt.detail_view ".
-                " FROM ".DATABASE_PREFIX."repository_index AS idx ".
-                " LEFT JOIN ( ".
-                "   SELECT pos.index_id, count(log.log_no) AS detail_view ".
-                "   FROM ".DATABASE_PREFIX."repository_position_index AS pos, ".DATABASE_PREFIX."repository_log AS log ".
-                "   WHERE log.record_date BETWEEN '".$this->start_date." 00:00:00.000'".
-                "   AND '".$this->end_date." 23:59:99.999'".
-                "   AND log.operation_id = '3' ".$this->log_exception.
-                "   AND pos.is_delete = '0' ".
-                "   AND pos.item_id = log.item_id AND pos.item_no = log.item_no ".
-                "   GROUP BY pos.index_id ".
-                " ) AS cnt ".
-                " ON cnt.index_id = idx.index_id ".
-                " WHERE idx.is_delete = '0' ".
-                " ORDER BY show_order, index_id ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            $this->error_msg = $this->Db->ErrorMsg();
-            //アクション終了処理
-            $result = $this->exitAction();   //トランザクションが成功していればCOMMITされる
-            return false;
-        }
-        for($ii=0; $ii<count($result); $ii++){
-            $node = array(
-                        'id'=>$result[$ii]['index_id'],
-                        'name'=>"",
-                        'pid'=>$result[$ii]['parent_index_id'],
-                        'detail_view'=>intval($result[$ii]['detail_view'])
-                    );
-            if($this->lang == "japanese"){
-                $node['name'] = $result[$ii]['index_name'];
-            } else {
-                $node['name'] = $result[$ii]['index_name_english'];
-            }
-            if($node['detail_view'] == null || strlen($node['detail_view']) == 0 || !is_numeric($node['detail_view'])){
-                $node['detail_view'] = 0;
-            }
-            
-            if(!isset($index[$node['pid']])){
-                $index[$node['pid']] = array();
-            }
-            array_push($index[$node['pid']], $node);
-        }
-        return $index;
-    }
-    
-    /**
-     * Enter description here...
-     *
-     * @param unknown_type $all_index
-     * @param unknown_type $index
-     * @param unknown_type $parent_name
-     */
-    function outIndexTree(&$all_index, $index, $parent_name, &$str){
-        //$log_file = "IndexTree.txt";
-        //$log_report = fopen($log_file, "a");
-        foreach ($index as $key => $val){
-            if(strlen($parent_name) > 0){
-                $val['name'] = $parent_name."\\".$val['name'];
-            }
-            $str .= $val['name']."\t".$val['detail_view']."\r\n";
-            if(is_array($all_index[$val['id']]) && count($all_index[$val['id']]) > 0){
-                $this->outIndexTree($all_index, $all_index[$val['id']], $val['name'], $str);
-                unset($all_index[$val['id']]);
-            }
-        }
-        //fclose($log_report);
-    }
-    
-    /**
-     * 通常ファイルおよび課金ファイルのダウンロード数を集計(make file view download report / pay per view download report)
-     * 
-     * @param string $fileReport
-     * @param string $priceReport
-     * @return string log report 
-     */
-    function makeFileDownloadLogReport(&$fileReport, &$priceReport)
-    {
-        $fileReport = "";
-        $priceReport = "";
-        
-        // -----------------------------------------------
-        // Get file download log
-        // -----------------------------------------------
-        // Fix WEKO-2014-003 / 同一ユーザーのアクセスかを判定する条件を IPアドレス、ユーザーエージェント、ユーザーIDが一致していること に修正した 2014/06/11 Y.Nakao --start--
-        $query = "SELECT DISTINCT DATE_FORMAT(".RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE.", '%Y-%m-%d %H:%i' ) AS ".RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_IP_ADDRESS.", ".RepositoryConst::DBCOL_REPOSITORY_LOG_USER_AGENT.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_ITEM_ID.", ".RepositoryConst::DBCOL_REPOSITORY_LOG_ITEM_NO.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_ATTRIBUTE_ID.", ".RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_NO.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_STATUS.", ".RepositoryConst::DBCOL_REPOSITORY_LOG_SITE_LICENSE.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_INPUT_TYPE.", ".RepositoryConst::DBCOL_REPOSITORY_LOG_LOGIN_STATUS.", ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_GROUP_ID." ".
-                 "FROM ". DATABASE_PREFIX .RepositoryConst::DBTABLE_REPOSITORY_LOG." AS log ".
-                 "WHERE log.".RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE." >= '$this->start_date 00:00:00.000' ". 
-                 "AND log.".RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE." <= '$this->end_date 23:59:99.999' ".
-                 "AND log.".RepositoryConst::DBCOL_REPOSITORY_LOG_OPERATION_ID." = '".RepositoryConst::LOG_OPERATION_DOWNLOAD_FILE."' ".
-                 $this->log_exception." ".
-                 "ORDER BY ".RepositoryConst::DBCOL_REPOSITORY_LOG_ITEM_ID." ASC, ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_ATTRIBUTE_ID." ASC, ".
-                 RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_NO." ASC";
-        // Fix WEKO-2014-003 / 同一ユーザーのアクセスかを判定する条件を IPアドレス、ユーザーエージェント、ユーザーIDが一致していること に修正した 2014/06/11 Y.Nakao --end--
-        $log = $this->Db->execute($query);
-        if($log === false)
-        {
-            return $this->Db->ErrorMsg();
-        }
-        // -----------------------------------------------
-        // Get data for make log
-        // -----------------------------------------------
-        $priceLog = array();
-        $priceOpenLog = array();
-        $fileLog = array();
-        $fileOpenLog = array();
-        $result = $this->makeDownloadInfo($log, $priceLog, $priceOpenLog, $fileLog, $fileOpenLog);
-        if($result === false)
-        {
-            return false;
-        }
-        // -----------------------------------------------
-        // Get data for make log
-        // -----------------------------------------------
-        $fileReport = $this->makeFileDownloadLogReportStr($fileLog, $fileOpenLog);
-        $priceReport = $this->makeFilePriceDownloadLogReportStr($priceLog, $priceOpenLog);
-        
-        return true;
-    }
-    
-    /**
-     * Create file download info
-     *
-     * @param array $log
-     * @param array $priceLog
-     * @param array $priceOpenLog
-     * @param array $fileLog
-     * @param array $fileOpenLog
-     * @return bool
-     */
-    function makeDownloadInfo($log, &$priceLog, &$priceOpenLog, &$fileLog, &$fileOpenLog)
-    {
-        for($ii=0; $ii<count($log); $ii++)
-        {
-            $fileStatus = "";
-            $siteLicense = "";
-            $inputType = "";
-            $loginStatus = "";
-            $groupId = "";
-            $result = $this->checkFileDownloadStatus($log[$ii], $fileName, $fileStatus, $siteLicense, $inputType, $loginStatus, $groupId);
-            if($result === false)
-            {
-                continue;
-            }
-            
-            $key =  $log[$ii]['item_id'].'_'.$log[$ii]['item_no'].'_'.
-                    $log[$ii]['attribute_id'].'_'.$log[$ii]['file_no'];
-            
-            if($inputType == RepositoryConst::LOG_INPUT_TYPE_FILE)
-            {
-                if($fileStatus == RepositoryConst::LOG_FILE_STATUS_OPEN)
-                {
-                    $this->setFileLogArray($key, $fileName, $fileStatus, $siteLicense, $loginStatus, $fileOpenLog);
-                }
-                else if($fileStatus == RepositoryConst::LOG_FILE_STATUS_CLOSE)
-                {
-                    $this->setFileLogArray($key, $fileName, $fileStatus, $siteLicense, $loginStatus, $fileLog);
-                }
-            }
-            else if($inputType == RepositoryConst::LOG_INPUT_TYPE_FILE_PRICE)
-            {
-                if($fileStatus == RepositoryConst::LOG_FILE_STATUS_OPEN)
-                {
-                    $this->setFilePriceLogArray($key, $fileName, $fileStatus, $siteLicense, $loginStatus, $groupId, $priceOpenLog);
-                }
-                else if($fileStatus == RepositoryConst::LOG_FILE_STATUS_CLOSE)
-                {
-                    $this->setFilePriceLogArray($key, $fileName, $fileStatus, $siteLicense, $loginStatus, $groupId, $priceLog);
-                }
-            }
-        }
-        return true;
-    }
-    
-    /**
-     * 
-     *
-     * @param string $key item_id_item_no_attribute_id_file_no
-     * @return string index name
-     */
-    function getIndexName($key, $index_id){
-        if($key != ""){
-            $index_name = '';
-            $key = explode("_", $key);
-            $query = "SELECT index_id FROM ". DATABASE_PREFIX ."repository_position_index ".
-                    " WHERE item_id = '$key[0]' ".
-                    " AND item_no = '$key[1]'; ";
-            $result = $this->Db->execute($query);
-            if($result === false){
-                return "";
-            }
-            for($ii=0; $ii<count($result); $ii++){
-                if($ii != 0){
-                    $index_name .= " | ";
-                }
-                $index_name .= $this->getIndexName("", $result[$ii]['index_id']);
-            }
-        } else {
-            $index_name = ''; 
-            // get this index info
-            $query = "SELECT index_name, index_name_english, parent_index_id ".
-                    " FROM ". DATABASE_PREFIX ."repository_index ".
-                    " WHERE index_id = '$index_id' ";
-            $result = $this->Db->execute($query);
-            if($result === false){
-                return "";
-            }
-            if(count($result) == 0){
-                return "";
-            }
-            if($this->Session->getParameter("_lang") == "japanese"){
-                $index_name = $result[0]['index_name'];
-            } else {
-                $index_name = $result[0]['index_name_english'];
-            }
-            // search parent index name
-            $p_name = $this->getIndexName("", $result[0]['parent_index_id']);
-            if($p_name != ""){
-                $index_name = $p_name."\\".$index_name;
-            }
-        }
+        // -----------------------------------------------
+        $str = '';
+        $str .= $this->smartyAssign->getLang("repository_log_index_report_title")."\r\n";
+        $str .= $this->smartyAssign->getLang("repository_log_totaling_month")."\t".$this->disp_start_date."\r\n";
+        $str .= "\r\n";
+        $str .= $this->smartyAssign->getLang("repository_log_index")."\t";
+        $str .= $this->smartyAssign->getLang("repository_log_access_num");
+        $str .= "\r\n";
+        $str .= $this->smartyAssign->getLang("repository_log_index_detail_access_total")."\t";
+        $str .= $total_access."\t";
+        $str .= "\r\n";
         
-        return $index_name;
+        $this->outputDetailViewPerIndexes($index_data, $index_data['0'], "", $str);
+        return $str;
     }
     
     /**
-     * download type
+     * output detail view num per each indexes in recursive
      *
-     * @param unknown_type $price
-     * @param unknown_type $user_id
-     * @return unknown
+     * @param array $all_index
+     * @param array $index
+     * @param string $parent_name : parent indexes path
+     * @param string $str : output data
      */
-    function getDownloadType($price, $user_id){
-        $room_id = '0';
-        $room_name = '';
-        ///// get groupID and price /////
-        $room_price = explode("|",$price);
-        ///// ユーザが入っているroom_idを取得 /////
-        $query = "SELECT room_id FROM ". DATABASE_PREFIX ."pages_users_link ".
-                 "WHERE user_id = ?; ";
-        $params = null;
-        $params[] = $user_id;
-        // SELECT実行
-        $user_group = $this->Db->execute($query, $params);
-        if($user_group === false){
-            return false;
-        }
-        // Add Nonmember
-        // search file price for setting download type
-        for($price_Cnt=0;$price_Cnt<count($room_price);$price_Cnt++){
-            $price = explode(",", $room_price[$price_Cnt]);
-            // There is a pair of room_id and the price. 
-            if($price!=null && count($price)==2) {
-                // It is judged whether it is user's belonging group.
-                for($user_group_cnt=0;$user_group_cnt<count($user_group);$user_group_cnt++){
-                    if($price[0] == $user_group[$user_group_cnt]["room_id"]){
-                        // When the price is set to the belonging group
-                        if($file_price==""){
-                            // The price is maintained at the unsetting. 
-                            $file_price = $price[1];
-                            $room_id = $user_group[$user_group_cnt]["room_id"];
-                        } else if(intval($file_price) > intval($price[1])){
-                            // It downloads it by the lowest price. 
-                            $file_price = $price[1];
-                            $room_id = $user_group[$user_group_cnt]["room_id"];
-                        }
-                    }
-                }
+    function outputDetailViewPerIndexes(&$all_index, $index, $parent_name, &$str){
+        foreach ($index as $key => $val){
+            if(strlen($parent_name) > 0){
+                $val['name'] = $parent_name."\\".$val['name'];
+            }
+            $str .= $val['name']."\t".$val['detail_view']."\r\n";
+            if(isset($all_index[$val['id']]) && is_array($all_index[$val['id']]) && count($all_index[$val['id']]) > 0){
+                $this->outputDetailViewPerIndexes($all_index, $all_index[$val['id']], $val['name'], $str);
+                unset($all_index[$val['id']]);
             }
         }
-        return $room_id;
     }
     
-    // Add supple log report 2009/09/04 A.Suzuki --start--
     /**
-     * サプリコンテンツの閲覧回数およびダウンロード回数(detail view and download file num as supple items)
-     *
+     * create file view download report / pay per view download report
+     * 
+     * @param string $fileReport
+     * @param string $priceReport
      * @return string log report 
      */
-    function makeSuppleLogReport(){
-        // サプリテーブルの情報を取得
-        $query = "SELECT * FROM ".DATABASE_PREFIX."repository_supple ".
-                 "WHERE is_delete = 0;";
-        $result = $this->Db->execute($query);
-        
-        // サプリコンテンツのサプリWEKOアイテムIDを連結する
-        $item_ids = "";
-        foreach($result as $val){
-            if($item_ids != ""){
-                $item_ids .= ",";
-            }
-            $item_ids .= $val['supple_weko_item_id'];
-        }
-        
-        // request URL send for supple weko
-        // パラメタテーブルからサプリWEKOのアドレスを取得する
-        $query = "SELECT param_value FROM ".DATABASE_PREFIX."repository_parameter ".
-                 "WHERE param_name = 'supple_weko_url';";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return false;
-        }
-        if($result[0]['param_value'] == ""){
-            return false;
-        } else {
-            $send_param = $result[0]['param_value'];
-        }
-        
-        $send_param .= "/?action=repository_opensearch&item_ids=".$item_ids."&log_term=".$this->disp_start_date."&format=rss";
+    private function makeFileDownloadLogReport(&$fileReport, &$priceReport)
+    {
+        $fileReport = "";
+        $priceReport = "";
         
-        /////////////////////////////
-        // HTTP_Request init
-        /////////////////////////////
-        // send http request
-        $option = array( 
-            "timeout" => "10",
-            "allowRedirects" => true, 
-            "maxRedirects" => 3, 
-        );
-        // Modfy proxy 2011/12/06 Y.Nakao --start--
-        $proxy = $this->getProxySetting();
-        if($proxy['proxy_mode'] == 1)
-        {
-            $option = array( 
-                    "timeout" => "10",
-                    "allowRedirects" => true, 
-                    "maxRedirects" => 3,
-                    "proxy_host"=>$proxy['proxy_host'],
-                    "proxy_port"=>$proxy['proxy_port'],
-                    "proxy_user"=>$proxy['proxy_user'],
-                    "proxy_pass"=>$proxy['proxy_pass']
-                );
-        }
-        // Modfy proxy 2011/12/06 Y.Nakao --end--
-        $http = new HTTP_Request($send_param, $option);
-        // setting HTTP header
-        $http->addHeader("User-Agent", $_SERVER['HTTP_USER_AGENT']); 
-        $http->addHeader("Referer", $_SERVER['HTTP_REFERER']);
+        $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
         
-        /////////////////////////////
-        // run HTTP request 
-        /////////////////////////////
-        $response = $http->sendRequest(); 
-        if (!PEAR::isError($response)) { 
-            $charge_code = $http->getResponseCode();// ResponseCode(200等)を取得 
-            $charge_header = $http->getResponseHeader();// ResponseHeader(レスポンスヘッダ)を取得 
-            $charge_body = $http->getResponseBody();// ResponseBody(レスポンステキスト)を取得 
-            $charge_Cookies = $http->getResponseCookies();// クッキーを取得 
-        }
-        // get response
-        $response_xml = $charge_body;
+        $fileViewReport = $logReport->getFileViewReport();
+        $payPerViewReport = $logReport->getPayPerViewReport();
         
-        /////////////////////////////
-        // parse response XML
-        /////////////////////////////
-        try{
-            $xml_parser = xml_parser_create();
-            $rtn = xml_parse_into_struct( $xml_parser, $response_xml, $vals );
-            if($rtn == 0){
-                return false;
-            }
-            xml_parser_free($xml_parser);
-        } catch(Exception $ex){
-            return false;
-        }
+        // -----------------------------------------------
+        // Get data for make log
+        // -----------------------------------------------
+        $fileReport = $this->makeFileDownloadLogReportStr($fileViewReport["fileLog"], $fileViewReport["fileOpenLog"]);
+        $priceReport = $this->makeFilePriceDownloadLogReportStr($payPerViewReport["priceLog"], $payPerViewReport["priceOpenLog"]);
         
-        /////////////////////////////
-        // get XML data
-        /////////////////////////////
-        $item_flag = false;
-        $supple_data = array();
-        foreach($vals as $val){
-            if($val['tag'] == "ITEM"){
-                    if($val['type'] == "open"){
-                        $item_flag = true;
-                        $item_data = array();
-                    }
-                    if($item_flag == true && $val['type'] == "close"){
-                        $item_flag = false;
-                        if($item_data["supple_weko_item_id"] != "" && $item_data["supple_weko_item_id"] != null){
-                            array_push($supple_data, $item_data);
-                        }
-                    }
-            }
-            if($item_flag){
-                switch($val['tag']){
-                    case "DC:IDENTIFIER":   // サプリアイテム:アイテムID
-                        if(ereg("^file_id:", $val['value']) == 0){
-                            $item_data["supple_weko_item_id"] = $val['value'];
-                        }
-                        break;
-                    case "WEKOLOG:VIEW":    // サプリアイテム:閲覧回数
-                        $item_data["log_view"] = $val['value'];
-                        break;
-                    case "WEKOLOG:DOWNLOAD":    // サプリアイテム:ダウンロード回数
-                        $item_data["log_download"] = $val['value'];
-                        break;
-                    default :
-                        break;
-                }
-            }
-        }
+        return true;
+    }
+    
+    /**
+     * create detail view and download file num per supple items
+     *
+     * @return string log report 
+     */
+    function makeSuppleLogReport(){
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        $supple_data = $logReport->getSuppleReport();
         
         // -----------------------------------------------
         // make log report
@@ -1297,9 +368,8 @@ class Repository_Logreport extends RepositoryAction
     }
     
     /**
-     * 
-     * 再帰的にインデックスツリーを作成
-     *  配下のアイテムのサプリコンテンツ閲覧回数とダウンロード回数を出す
+     * create index tree infomation by recursive processing
+     * calculate supplemental contents detail view and download in each index
      * 
      *
      * @param string $pid_name parent index name
@@ -1316,13 +386,16 @@ class Repository_Logreport extends RepositoryAction
         $children = array();
         $query = "SELECT index_id, index_name, index_name_english, parent_index_id ".
                 " FROM ". DATABASE_PREFIX ."repository_index ".
-                " WHERE is_delete = '0' ".
-                " AND parent_index_id = '$pid_id' ".
+                " WHERE is_delete = ? ".
+                " AND parent_index_id = ? ".
                 " ORDER BY show_order ";
-        $children = $this->Db->execute($query);
+        $params = array();
+        $params[] = 0;
+        $params[] = $pid_id;
+        $children = $this->Db->execute($query, $params);
         if($children === false){
-            //array_push($index_array, "MySQL ERROR : ".$this->Db->ErrorMsg());
-            return false;
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
         }
         
         // インデックス直下にあるサプリアイテムを検索
@@ -1333,16 +406,22 @@ class Repository_Logreport extends RepositoryAction
                      "LEFT JOIN ".DATABASE_PREFIX."repository_position_index AS p_idx ON idx.index_id = p_idx.index_id ".
                      "LEFT JOIN ".DATABASE_PREFIX."repository_item AS item ON item.item_id = p_idx.item_id AND item.item_no = p_idx.item_no ".
                      "LEFT JOIN ".DATABASE_PREFIX."repository_supple AS supple ON item.item_id = supple.item_id AND item.item_no = supple.item_no ".
-                     "WHERE idx.index_id = '$pid_id' ".
-                     "AND idx.is_delete = 0 ".
-                     "AND p_idx.is_delete = 0 ".
-                     "AND item.is_delete = 0 ".
-                     "AND supple.is_delete = 0 ".
+                     "WHERE idx.index_id = ? ".
+                     "AND idx.is_delete = ? ".
+                     "AND p_idx.is_delete = ? ".
+                     "AND item.is_delete = ? ".
+                     "AND supple.is_delete = ? ".
                      "ORDER BY idx.show_order ASC, item.item_id ASC, supple.supple_no ASC;";
-            $supple_result = $this->Db->execute($query);
+            $params = array();
+            $params[] = $pid_id;
+            $params[] = 0;
+            $params[] = 0;
+            $params[] = 0;
+            $params[] = 0;
+            $supple_result = $this->Db->execute($query, $params);
             if($supple_result === false){
-                //array_push($index_array, "MySQL ERROR : ".$this->Db->ErrorMsg());
-                return false;
+                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                throw new AppException($this->Db->ErrorMsg());
             }
             
             for($ii=0; $ii<count($supple_result); $ii++){
@@ -1413,9 +492,7 @@ class Repository_Logreport extends RepositoryAction
 
         return true;
     }
-    // Add supple log report 2009/09/04 A.Suzuki --end--
     
-    // Add send mail for log report 2010/03/10 Y.Nakao --start--
     /**
      * send mail for log report
      *
@@ -1489,6 +566,10 @@ class Repository_Logreport extends RepositoryAction
         if(count($users) > 0){
             // 送信者がいる場合は送信
             $return = $this->mailMain->send();
+            if($return === false)
+            {
+                $this->errorLog("logreport: send mail is failed", __FILE__, __CLASS__, __LINE__);
+            }
         }
          
         // 言語リソース開放
@@ -1512,7 +593,8 @@ class Repository_Logreport extends RepositoryAction
         // SELECT実行
         $result = $this->Db->execute($query, $params);
         if($result === false){
-            return false;
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
         }
         if(count($result) == 1){
             if($result[0]['param_name'] == 'log_report_mail'){
@@ -1528,37 +610,25 @@ class Repository_Logreport extends RepositoryAction
         }
         return true;
     }
-    // Add send mail for log report 2010/03/10 Y.Nakao --end--
     
-    // Add access log per host 2010/04/01 Y.Nakao --start--
     /**
      * host access log report
      *
      * @return string log report text
      */
-    function makeHostLogReport(){
+    private function makeHostLogReport(){
         // -----------------------------------------------
         // init
         // -----------------------------------------------
         $str = "";
         $host_cnt = array();
         
-        // -----------------------------------------------
-        // get access log report per host
-        // count top page access
-        // -----------------------------------------------
-        $query = "SELECT host, ip_address, operation_id, count( * ) AS cnt ". 
-                " FROM ".DATABASE_PREFIX."repository_log AS log ".
-                " WHERE log.record_date >= '$this->start_date 00:00:00.000' ". 
-                " AND log.record_date <= '$this->end_date 23:59:99.999' ".
-                " AND operation_id = '5' ".
-                $this->log_exception.
-                " GROUP BY operation_id, ip_address ".
-                " ORDER BY ip_address; ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return 'error';
-        }
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        $result = $logReport->getHostAccessReport();
+        
         // -----------------------------------------------
         // make log report text
         // -----------------------------------------------
@@ -1576,277 +646,27 @@ class Repository_Logreport extends RepositoryAction
         }
         return $str;
     }
-    // Add access log per host 2010/04/01 Y.Nakao --end--
-    
-    // Add entry Flash log Y.Nakao 2011/03/01 --start--
-    /**
-     * Flash閲覧数を集計(make Flash view report)
-     * 
-     * @return string log report
-     */
-    function makeFlashViewLogReport(){
-        // -----------------------------------------------
-        // get pay file download log
-        // -----------------------------------------------
-        $query = "SELECT * FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                " WHERE log.record_date BETWEEN '$this->start_date 00:00:00.000' ". 
-                " AND '$this->end_date 23:59:99.999' ".
-                " AND log.operation_id='6' ".
-                $this->log_exception;
-        $log = $this->Db->execute($query);
-        if($log === false){
-            return $this->Db->ErrorMsg();
-        }
-        // -----------------------------------------------
-        // get group list(room_id and room_name list)
-        // -----------------------------------------------
-        $result = $this->getGroupList($all_group, $error_msg);
-        if($result === false){
-            return $this->Db->ErrorMsg();
-        }
-        // -----------------------------------------------
-        // get data for make log
-        // -----------------------------------------------
-        $viewLog = array();
-        $result = $this->makeFlashViewInfo($log, $viewLog);
-        if($result === false){
-            return $this->Db->ErrorMsg();
-        }
-        // -----------------------------------------------
-        // make file price download log
-        // -----------------------------------------------
-        $str = '';
-        $str .= $this->smartyAssign->getLang("repository_log_Fashview_title")."\r\n";
-        $str .= $this->smartyAssign->getLang("repository_log_totaling_month")."\t".$this->disp_start_date."\r\n";
-        $str .= "\r\n";
-        $str .= $this->smartyAssign->getLang("repository_log_Fashview_title");
-        $str .= "\r\n";
-        $str .= $this->smartyAssign->getLang("repository_log_download_filename")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_download_index")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_Fashview_total")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_download_not_login")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_Fashview_guest")."\t";
-        for($ii=0; $ii<count($all_group); $ii++){
-            if($ii != 0){
-                $str .= "\t";
-            }
-            $str .= $all_group[$ii]['page_name'];
-        }
-        $str .= "\r\n";
-        foreach ($viewLog as $key => $value) {
-            $str .= $value['file_name']."\t";
-            $str .= $value['index_name']."\t";
-            $str .= $value['total']."\t";
-            $str .= $value['not_login']."\t";
-            $str .= $value['group']['0']."\t";
-            for($ii=0; $ii<count($all_group); $ii++){
-                if($ii != 0){
-                    $str .= "\t";
-                }
-                if(isset($value['group'][$all_group[$ii]['room_id']])){
-                    $str .= $value['group'][$all_group[$ii]['room_id']];
-                } else {
-                    $str .= "0";
-                }
-            }
-            $str .= "\r\n";
-        }
-        return $str;
-    }
-    
-    /**
-     * Enter description here...
-     *
-     * @param array $log
-     * @param array viewLog
-     * @return boolean true/false
-     */
-    function makeFlashViewInfo($log, &$viewLog){
-        for($ii=0; $ii<count($log); $ii++){
-            $key =  $log[$ii]['item_id'].'_'.$log[$ii]['item_no'].'_'.
-                    $log[$ii]['attribute_id'].'_'.$log[$ii]['file_no'];
-            // ファイル情報取得(get file info)
-            $query = "SELECT file_name, pub_date ".
-                    " FROM ". DATABASE_PREFIX ."repository_file ".
-                    " WHERE item_id = '".$log[$ii]['item_id']."' AND ".
-                    " item_no = '".$log[$ii]['item_no']."' AND ".
-                    " attribute_id = '".$log[$ii]['attribute_id']."' AND ".
-                    " file_no = '".$log[$ii]['file_no']."' ";
-            $file = $this->Db->execute($query);
-            if($file === false){
-                return false;
-            }
-            if( !isset($viewLog[$key]) ){
-                $viewLog[$key]['file_name'] = $file[0]['file_name'];
-                $viewLog[$key]['index_name'] = $this->getIndexName($key);
-                $viewLog[$key]['total'] = 0;// トータル(total)
-                $viewLog[$key]['not_login'] = 0;// 個人(not login)
-                $viewLog[$key]['group'] = array();// グループ(group(room))
-                $viewLog[$key]['group']['0'] = 0;// 非会員(login user(not affiliate))
-            }
-            // 課金かどうかチェック(check input type is "file_price")
-            $query = "SELECT input_type ".
-                    " FROM ". DATABASE_PREFIX ."repository_item as item, ".
-                    DATABASE_PREFIX ."repository_item_attr_type as attr_type ".
-                    " WHERE item.item_type_id = attr_type.item_type_id ".
-                    " AND item.item_id = '".$log[$ii]['item_id']."' ".
-                    " AND item.item_no = '".$log[$ii]['item_no']."' ".
-                    " AND attr_type.attribute_id = '".$log[$ii]['attribute_id']."' ";
-            $result = $this->Db->execute($query);
-            if($result === false){
-                return false;
-            }
-            // 個人ダウンロード(未ログインダウンロード)かどうか判定(check not login download)
-            $viewLog[$key]['total']++;
-            if($log[$ii]['user_id'] == "0"){
-                $viewLog[$key]['not_login']++;
-            } else if($result[0]['input_type'] == "file"){
-                ///// ユーザが入っているroom_idを取得(get user group list) /////
-                $user_group = $this->getUserGroupIds($log[$ii]['user_id']);
-                // select first room_id
-                $group = $user_group[0]['room_id'];
-                if(isset($viewLog[$key]['group'][$group])){
-                    $viewLog[$key]['group'][$group]++;
-                } else {
-                    $viewLog[$key]['group'][$group] = 1;
-                }
-            } else if($result[0]['input_type'] == "file_price"){
-                // 課金ファイル情報取得(get file price info)
-                $query = "SELECT price ".
-                        " FROM ". DATABASE_PREFIX ."repository_file_price ".
-                        " WHERE item_id = '".$log[$ii]['item_id']."' AND ".
-                        " item_no = '".$log[$ii]['item_no']."' AND ".
-                        " attribute_id = '".$log[$ii]['attribute_id']."' AND ".
-                        " file_no = '".$log[$ii]['file_no']."' ";
-                $price = $this->Db->execute($query);
-                if($price === false){
-                    return false;
-                }
-                if(count($price) == 1){
-                    $group = $this->getFlashViewUserGroup($price[0]['price'], $log[$ii]['user_id']);
-                    if(isset($viewLog[$key]['group'][$group])){
-                        $viewLog[$key]['group'][$group]++;
-                    } else {
-                        $viewLog[$key]['group'][$group] = 1;
-                    }
-                }
-            }
-        }
-        return true;
-    }
-    
-    /**
-     * ユーザが入っているroom_idを取得(get user group list)
-     * 
-     * @param string user_id
-     * @return array
-     *
-     */
-    function getUserGroupIds($user_id){
-        $query = "SELECT DISTINCT links.room_id ".
-                " FROM ".DATABASE_PREFIX."pages_users_link AS links, ".
-                       DATABASE_PREFIX."pages AS pages ".
-                " WHERE links.user_id = ? ".
-                " AND pages.private_flag = ? ".
-                " AND pages.space_type = ? ".
-                " AND NOT pages.thread_num = ? ".
-                " AND pages.room_id = pages.page_id ".
-                " AND links.room_id = pages.room_id; ";
-        $params = null;
-        $params[] = $user_id;
-        $params[] = 0;
-        $params[] = _SPACE_TYPE_GROUP;
-        $params[] = 0;
-        $result = $this->Db->execute($query, $params);
-        if($result === false){
-            return array();
-        }
-        return $result;
-    }
-    
-    /**
-     * Enter description here...
-     *
-     * @param string $price
-     * @param string $user_id
-     * @return int room_id(group)
-     */
-    function getFlashViewUserGroup($price, $user_id){
-        $room_id = '0';
-        $room_name = '';
-        ///// get groupID and price /////
-        $room_price = explode("|",$price);
-        ///// ユーザが入っているroom_idを取得(get user group list) /////
-        $user_group = $this->getUserGroupIds($user_id);
-        // Add Nonmember
-        // search file price for setting download type
-        for($price_Cnt=0;$price_Cnt<count($room_price);$price_Cnt++){
-            $price = explode(",", $room_price[$price_Cnt]);
-            // There is a pair of room_id and the price. 
-            if($price!=null && count($price)==2) {
-                // It is judged whether it is user's belonging group.
-                for($user_group_cnt=0;$user_group_cnt<count($user_group);$user_group_cnt++){
-                    if($price[0] == $user_group[$user_group_cnt]["room_id"]){
-                        // When the price is set to the belonging group
-                        if($file_price==""){
-                            // The price is maintained at the unsetting. 
-                            $file_price = $price[1];
-                            $room_id = $user_group[$user_group_cnt]["room_id"];
-                        } else if(intval($file_price) > intval($price[1])){
-                            // It downloads it by the lowest price. 
-                            $file_price = $price[1];
-                            $room_id = $user_group[$user_group_cnt]["room_id"];
-                        }
-                    }
-                }
-            }
-        }
-        
-        if($room_id == "0"){
-            // When donwload type 'nomembe', user any affiliate group.
-            if(count($user_group) > 0){
-                return $user_group[0]['room_id'];
-            }
-        }
-        
-        return $room_id;
-    }
-    // Add entry Flash log Y.Nakao 2011/03/01 --end--
-    
     
-    // Add detail view log 2011/03/10 Y.Nakao --start--
     /**
      * make detail view log 
      *
      */
     private function makeDetailViewLogReport(){
-        // -----------------------------------------------
-        // get detaile view log
-        // -----------------------------------------------
-        $query = "SELECT * FROM ". DATABASE_PREFIX ."repository_log AS log ".
-                " WHERE log.record_date BETWEEN '$this->start_date 00:00:00.000' ". 
-                " AND '$this->end_date 23:59:99.999' ".
-                " AND log.operation_id='3' ".
-                $this->log_exception;
-        $log = $this->Db->execute($query);
-        if($log === false){
-            return $this->Db->ErrorMsg();
-        }
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        
         // -----------------------------------------------
         // get group list(room_id and room_name list)
         // -----------------------------------------------
-        $result = $this->getGroupList($all_group, $error_msg);
-        if($result === false){
-            return $this->Db->ErrorMsg();
-        }
+        $all_group = $this->groupList;
+        
         // -----------------------------------------------
         // get data for make log
         // -----------------------------------------------
-        $viewLog = array();
-        $result = $this->makeDetailViewInfo($log, $viewLog);
-        if($result === false){
-            return $this->Db->ErrorMsg();
-        }
+        $viewLog = $logReport->getDetailViewReport();
+        
         // -----------------------------------------------
         // make file price download log
         // -----------------------------------------------
@@ -1895,103 +715,23 @@ class Repository_Logreport extends RepositoryAction
     }
     
     /**
-     * Enter description here...
-     *
-     * @param unknown_type $log
-     * @param unknown_type $viewLog
-     */
-    private function makeDetailViewInfo($log, &$viewLog){
-        for($ii=0; $ii<count($log); $ii++){
-            $key =  $log[$ii]['item_id'].'_'.$log[$ii]['item_no'];
-            // ファイル情報取得(get file info)
-            $query = "SELECT title, title_english ".
-                    " FROM ". DATABASE_PREFIX ."repository_item ".
-                    " WHERE item_id = '".$log[$ii]['item_id']."' AND ".
-                    " item_no = '".$log[$ii]['item_no']."' ";
-            $item = $this->Db->execute($query);
-            if($item === false){
-                return false;
-            }
-            if( !isset($viewLog[$key]) ){
-                $viewLog[$key]['title'] = $item[0]['title'];
-                $viewLog[$key]['title_en'] = $item[0]['title_english'];
-                $viewLog[$key]['index_name'] = $this->getIndexName($key);
-                $viewLog[$key]['total'] = 0;// トータル(total)
-                $viewLog[$key]['not_login'] = 0;// 個人(not login)
-                $viewLog[$key]['group'] = array();// グループ(group(room))
-                $viewLog[$key]['group']['0'] = 0;// 非会員(login user(not affiliate))
-            }
-            // 個人ダウンロード(未ログインダウンロード)かどうか判定(check not login download)
-            $viewLog[$key]['total']++;
-            if($log[$ii]['user_id'] == "0"){
-                $viewLog[$key]['not_login']++;
-            } else {
-                ///// ユーザが入っているroom_idを取得(get user group list) /////
-                $user_group = $this->getUserGroupIds($log[$ii]['user_id']);
-                // select first room_id
-                $group = $user_group[0]['room_id'];
-                if(isset($viewLog[$key]['group'][$group])){
-                    $viewLog[$key]['group'][$group]++;
-                } else {
-                    $viewLog[$key]['group'][$group] = 1;
-                }
-            }
-        }
-        return true;
-    }
-    
-    // Add user info 2011/07/25 Y.Nakao --start--
-    /**
-     * 権限別ユーザ数/研究会別ユーザ数を取得する
+     * get user num per authority and user num per group
      *
      * @return string logReport by user text
      */
-    function makeUserLogReport(){
+    private function makeUserLogReport(){
         // -----------------------------------------------
         // init
         // -----------------------------------------------
         $str = "";
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        $userAffiliation = $logReport->getUserAffiliateReport();
         
-        // -----------------------------------------------
-        // get user per BASE_AUTHOHRITY
-        // -----------------------------------------------
-        $query = "SELECT auth.role_authority_name, count( users.user_id ) cnt ".
-                " FROM ".DATABASE_PREFIX."authorities AS auth ".
-                " LEFT JOIN ".DATABASE_PREFIX."users AS users ON users.role_authority_id = auth.role_authority_id ".
-                " GROUP BY auth.role_authority_id; ";
-        $userAuth = $this->Db->execute($query);
-        if($userAuth === false){
-            return 'error';
-        }
-        
-        $result = $this->getGroupList($all_group, $error_msg);
-        if($result === false){
-            return 'error';
-        }
-        // -----------------------------------------------
-        // get user per room
-        // -----------------------------------------------
-        $query = "SELECT links.room_id, count(users.user_id) AS cnt ".
-                " FROM ".DATABASE_PREFIX."users AS users, ".DATABASE_PREFIX."pages_users_link AS links ".
-                " WHERE users.user_id=links.user_id ".
-                " GROUP BY room_id ";
-        $userRoom = $this->Db->execute($query);
-        if($userRoom === false){
-            return 'error';
-        }
-        
-        for($ii=0; $ii<count($all_group); $ii++){
-            $all_group[$ii]['cnt'] = 0;
-            for($jj=0; $jj<count($userRoom); $jj++){
-                if($all_group[$ii]['room_id'] == $userRoom[$jj]['room_id']){
-                    $all_group[$ii]['cnt'] = $userRoom[$jj]['cnt'];
-                }
-            }
-            if($jj == count($userRoom)){
-                unset($userRoom[$jj]);
-                $userRoom = array_values($userRoom);
-            }
-        }
+        $userAuth = $userAffiliation["userAuth"];
+        $all_group = $userAffiliation["all_group"];
         
         // -----------------------------------------------
         // make log report text
@@ -2004,7 +744,7 @@ class Repository_Logreport extends RepositoryAction
         $str .= $this->smartyAssign->getLang("repository_log_user");
         $str .= "\r\n";
         for($ii=0; $ii<count($userAuth); $ii++){
-            if(strlen(constant($userAuth[$ii]['role_authority_name'])) > 0){
+            if(defined($userAuth[$ii]['role_authority_name']) && strlen(constant($userAuth[$ii]['role_authority_name'])) > 0){
                 $str .= constant($userAuth[$ii]['role_authority_name'])."\t";
             } else {
                 $str .= $userAuth[$ii]['role_authority_name']."\t";
@@ -2024,10 +764,7 @@ class Repository_Logreport extends RepositoryAction
         }
         return $str;
     }
-    // Add user info 2011/07/25 Y.Nakao --end--
-    
     
-    // Add UsersDownloadsNum 2012/11/01 A.jin --start--
     /**
      * The download log output character string classified by user is acquired.
      * 
@@ -2039,32 +776,12 @@ class Repository_Logreport extends RepositoryAction
         // -----------------------------------------------
         $str = "";
         
-        // ---------------------------------------------
-        // get data
-        // ---------------------------------------------
-        // Fix WEKO-2014-003 / 同一ユーザーのアクセスかを判定する条件を IPアドレス、ユーザーエージェント、ユーザーIDが一致していること に修正した 2014/06/11 Y.Nakao --start--
-        $query = "SELECT USERS.user_id, USERS.login_id, USERS.handle , AUTH.role_authority_name , IFNULL(LOGCOUNT.filecount, 0) AS DLCount ".
-                 "FROM ".DATABASE_PREFIX."users AS USERS ".
-                 "LEFT JOIN ".DATABASE_PREFIX."authorities AS AUTH".
-                 " ON USERS.role_authority_id=AUTH.role_authority_id ".
-                 "LEFT JOIN (".
-                 " SELECT USERLOG.user_id, COUNT(USERLOG.user_id) AS filecount".
-                 " FROM (".
-                 " SELECT DISTINCT DATE_FORMAT(record_date, '%Y%m%d%H%i'), user_id, ip_address, user_agent, item_id, item_no, attribute_id, file_no".
-                 " FROM ".DATABASE_PREFIX."repository_log AS log".
-                 " WHERE log.record_date BETWEEN '$this->start_date 00:00:00.000'".
-                 " AND '$this->end_date 23:59:99.999'".
-                 " AND log.operation_id=2".
-                 $this->log_exception.
-                 " ) AS USERLOG".
-                 " GROUP BY USERLOG.user_id )".
-                 " AS LOGCOUNT".
-                 " ON USERS.user_id=LOGCOUNT.user_id;";
-        // Fix WEKO-2014-003 / 同一ユーザーのアクセスかを判定する条件を IPアドレス、ユーザーエージェント、ユーザーIDが一致していること に修正した 2014/06/11 Y.Nakao --end--
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return $this->Db->ErrorMsg();
-        }
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        $this->traceLog("logReport::getFileViewPerUser", __FILE__, __CLASS__, __LINE__);
+        $result = $logReport->getFileViewPerUser();
         
         // -----------------------------------------------
         // make log report text
@@ -2076,77 +793,25 @@ class Repository_Logreport extends RepositoryAction
         $str .= $this->smartyAssign->getLang("repository_log_download_count_user_handle")."\t";
         $str .= $this->smartyAssign->getLang("repository_log_download_count_user_name")."\t";
         $str .= $this->smartyAssign->getLang("repository_log_download_count_user_authority")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_download_count_user_affiliatelist")."\t";
-        $str .= $this->smartyAssign->getLang("repository_log_download_count_user_num")."\t";
-        $str .= "\r\n";
-        
-        for($ii=0; $ii<count($result); $ii++){
-            $user_id = $result[$ii]['user_id'];
-            $login_id = $result[$ii]['login_id'];
-            $handle = $result[$ii]['handle'];
-            $name = "";
-            
-            // 会員氏名取得
-            $query = "SELECT * ".
-                     "FROM ".DATABASE_PREFIX."users_items_link ".
-                     "WHERE user_id = ?".
-                     "AND item_id = ?;";
-            $params = array();
-            $params[] = $user_id;   // user_id
-            $params[] = 4;          // item_id = 4 : 会員氏名
-            $ret = $this->Db->execute($query, $params);
-            if($ret === false){
-                return $this->Db->ErrorMsg();
-            }
-            if(count($ret)>0 && isset($ret[0]["content"]))
-            {
-                $name = str_replace("\t", " ", $ret[0]["content"]);
-            }
-            
-            //Add ルーム権限取得処理 2012/12/05 A.Jin --start--
-            $room_authority_name = "";
-            //4以上だったら _AUTH_CHIEF_NAME
-            //3 _AUTH_MODERATE_NAME
-            //2 _AUTH_GENERAL_NAME
-            //1 _AUTH_GUEST_NAME
-            //それ以外 _AUTH_GUEST_NAME
-            $auth_id = $this->getRoomAuthorityID($user_id);
-            if($auth_id >= 4){
-                $room_authority_name = _AUTH_CHIEF_NAME;
-            } else if($auth_id == 3){
-                $room_authority_name = _AUTH_MODERATE_NAME;
-            } else if($auth_id == 2){
-                $room_authority_name = _AUTH_GENERAL_NAME;
-            } else if($auth_id == 1){
-                $room_authority_name = _AUTH_GUEST_NAME;
-            } else {
-                $room_authority_name = _AUTH_GUEST_NAME;
-            }
-            //Add ルーム権限取得処理 2012/12/05 A.Jin --end--
-            
-            $base_authority_name = constant($result[$ii]['role_authority_name']);
-            if($base_authority_name == ""){
-                $base_authority_name = $result[$ii]['role_authority_name'];
-            }
-            $group_name_list = $this->getUserGroupNameList($user_id);
-            $dl_count = $result[$ii]['DLCount'];
-            
+        $str .= $this->smartyAssign->getLang("repository_log_download_count_user_affiliatelist")."\t";
+        $str .= $this->smartyAssign->getLang("repository_log_download_count_user_num")."\t";
+        $str .= "\r\n";
+        
+        for($ii=0; $ii<count($result); $ii++){
             // ---------------------------------------------
             // create output a row text
             // ---------------------------------------------
-            $str .= $login_id."\t";
-            $str .= $handle."\t";
-            $str .= $name."\t";
-            $str .= $base_authority_name.'/'.$room_authority_name."\t";
-            $str .= $group_name_list."\t";
-            $str .= strval($dl_count)."\r\n";
+            $str .= $result[$ii]["login_id"]."\t";
+            $str .= $result[$ii]["handle"]."\t";
+            $str .= $result[$ii]["name"]."\t";
+            $str .= $result[$ii]["base_authority_name"].'/'.$result[$ii]["room_authority_name"]."\t";
+            $str .= $result[$ii]["group_name_list"]."\t";
+            $str .= strval($result[$ii]["dl_count"])."\r\n";
         }
         
         return $str;
     }
-    // Add UsersDownloadsNum 2012/11/1 A.jin --end--
-
-    // Add UserGroupNameList 2012/11/01 A.jin --start--
+    
     /**
      * The list of affiliation group names is acquired to the user who specified.
      *
@@ -2185,342 +850,8 @@ class Repository_Logreport extends RepositoryAction
                 $str .= $result[$ii]['page_name'].",";
             }
         }
-
         return $str;
     }
-    // Add UserGroupNameList 2012/11/1 A.jin --end--
-    
-    // Add file download status to log 2012/11/15 A.Suzuki --start--
-    /**
-     * Check file download status and file input type
-     *
-     * @param array $logRecord 'repository_log' table record
-     * @param int $fileStatus 0:unknown / 1: public / -1: private
-     * @param int $inputType 0: file / 1: file_price
-     * @return bool true: success / false: failed
-     */
-    private function checkFileDownloadStatus($logRecord, &$fileName, &$fileStatus, &$siteLicense, &$inputType, &$loginStatus, &$groupId)
-    {
-        // Init
-        $fileName = "";
-        $fileStatus = RepositoryConst::LOG_FILE_STATUS_UNKNOWN;
-        $siteLicense = RepositoryConst::LOG_SITE_LICENSE_OFF;
-        $inputType = null;
-        $loginStatus = null;
-        $groupId = null;
-        
-        // Check params
-        if(!is_array($logRecord))
-        {
-            return false;
-        }
-        
-        $itemId = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_ITEM_ID];
-        $itemNo = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_ITEM_NO];
-        $attributeId = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_ATTRIBUTE_ID];
-        $fileNo = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_NO];
-        
-        if(!isset($logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_STATUS])
-            || $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_STATUS] == RepositoryConst::LOG_FILE_STATUS_UNKNOWN)
-        {
-            // File status is not set or 'unknown'
-            // Check input type is "file" or "file_price"
-            $key =  $itemId.'_'.$itemNo.'_'.$attributeId.'_'.$fileNo;
-            $query = "SELECT ".RepositoryConst::DBCOL_REPOSITORY_ITEM_ATTR_TYPE_IMPUT_TYPE." ".
-                     "FROM ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_ITEM." as item, ".
-                             DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_ITEM_ATTR_TYPE." as attr_type ".
-                     "WHERE item.".RepositoryConst::DBCOL_REPOSITORY_ITEM_ITEM_TYPE_ID." = attr_type.".RepositoryConst::DBCOL_REPOSITORY_ITEM_ATTR_TYPE_ITEM_TYPE_ID." ".
-                     "AND item.".RepositoryConst::DBCOL_REPOSITORY_ITEM_ITEM_ID." = '".$itemId."' ".
-                     "AND item.".RepositoryConst::DBCOL_REPOSITORY_ITEM_ITEM_NO." = '".$itemNo."' ".
-                     "AND attr_type.".RepositoryConst::DBCOL_REPOSITORY_ITEM_ATTR_TYPE_ATTRIBUTE_ID." = '".$attributeId."' ";
-            $result = $this->Db->execute($query);
-            if($result === false)
-            {
-                return false;
-            }
-            
-            // Set input type
-            if($result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_ATTR_TYPE_IMPUT_TYPE] == RepositoryConst::ITEM_ATTR_TYPE_FILE)
-            {
-                $inputType = RepositoryConst::LOG_INPUT_TYPE_FILE;
-            }
-            else if($result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_ATTR_TYPE_IMPUT_TYPE] == RepositoryConst::ITEM_ATTR_TYPE_FILEPRICE)
-            {
-                $inputType = RepositoryConst::LOG_INPUT_TYPE_FILE_PRICE;
-            }
-            else
-            {
-                // Illegal input type
-                return false;
-            }
-            
-            // Check site license
-            $organization = "";
-            if($this->checkSiteLicenseForLogReport($logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_IP_ADDRESS], $organization))
-            {
-                // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --start--
-                // Get item_type_id
-                $query = "SELECT item_type_id ".
-                         "FROM ".DATABASE_PREFIX."repository_item ".
-                         "WHERE item_id = ? ".
-                         "AND item_no = ? ".
-                         "AND is_delete = 0;";
-                $params = array();
-                $params[] = $itemId;
-                $params[] = $itemNo;
-                $result = $this->Db->execute($query, $params);
-                if($result === false)
-                {
-                    return false;
-                }
-                $itemTypeId = $result[0]['item_type_id'];
-                
-                // Get param table data : site_license_item_type_id
-                $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                         "WHERE param_name = 'site_license_item_type_id'; ";
-                $result = $this->Db->execute($query);
-                if($result === false)
-                {
-                    return false;
-                }
-                $siteLicenseItemTypeIdArray = explode(",", trim($result[0]['param_value']));
-                
-                $matchFlag = false;
-                for($ii=0; $ii<count($siteLicenseItemTypeIdArray); $ii++)
-                {
-                    if($siteLicenseItemTypeIdArray[$ii] == $itemTypeId)
-                    {
-                        $matchFlag = true;
-                        break;
-                    }
-                }
-                if(!$matchFlag)
-                {
-                    $siteLicense = RepositoryConst::LOG_SITE_LICENSE_ON;
-                }
-                // Add exclude item_type_id for site license 2013/07/01 A.Suzuki --end--
-            }
-            
-            // Get file info
-            $query = "SELECT ".RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NAME.", ".
-                               RepositoryConst::DBCOL_REPOSITORY_FILE_PUB_DATE.", ".
-                               RepositoryConst::DBCOL_COMMON_INS_USER_ID." ".
-                     "FROM ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_FILE." ".
-                     "WHERE ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID." = '".$itemId."' ".
-                     "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO." = '".$itemNo."' ".
-                     "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID." = '".$attributeId."' ".
-                     "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO." = '".$fileNo."' ";
-            $file = $this->Db->execute($query);
-            if($file === false)
-            {
-                return false;
-            }
-            
-            // Set file name
-            $fileName = $file[0][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NAME];
-            
-            // Check open access or pay per view
-            $pub_date = explode(" ", $file[0][RepositoryConst::DBCOL_REPOSITORY_FILE_PUB_DATE]);
-            $pub_date = explode("-", $pub_date[0]);
-            $pub_date = sprintf("%04d%02d%02d", $pub_date[0],$pub_date[1],$pub_date[2]);
-            $log_date = explode(" ", $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_RECORD_DATE]);
-            $log_date = explode("-", $log_date[0]);
-            $log_date = sprintf("%04d%02d%02d", $log_date[0],$log_date[1],$log_date[2]);
-            $download_log = array();
-            if($pub_date <= $log_date){
-                // Open access
-                $fileStatus = RepositoryConst::LOG_FILE_STATUS_OPEN;
-            } else {
-                // Need login file / Pay per view
-                $fileStatus = RepositoryConst::LOG_FILE_STATUS_CLOSE;
-            }
-            
-            // Check not login download
-            if(strlen($logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID]) == 0 || $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID] == "0")
-            {
-                // No login user
-                $loginStatus = RepositoryConst::LOG_LOGIN_STATUS_NO_LOGIN;
-            }
-            else
-            {
-                // Check user's authority
-                $userAuthId = $this->getUserAuthIdByUserId($logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID]);
-                $authId = $this->getRoomAuthorityID($logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID]);
-                if(strlen($userAuthId) > 0 && ($userAuthId >= $this->repository_admin_base && $authId >= $this->repository_admin_room))
-                {
-                    // Admin user
-                    $loginStatus = RepositoryConst::LOG_LOGIN_STATUS_ADMIN;
-                }
-                else if($logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID] == $file[0][RepositoryConst::DBCOL_COMMON_INS_USER_ID])
-                {
-                    // Register
-                    $loginStatus = RepositoryConst::LOG_LOGIN_STATUS_REGISTER;
-                }
-                else
-                {
-                    // Login user
-                    $loginStatus = RepositoryConst::LOG_LOGIN_STATUS_LOGIN;
-                    if($inputType == RepositoryConst::LOG_INPUT_TYPE_FILE_PRICE)
-                    {
-                        // Get file price info
-                        $query = "SELECT ".RepositoryConst::DBCOL_REPOSITORY_FILE_PRICE_PRICE." ".
-                                 "FROM ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_FILE_PRICE." ".
-                                 "WHERE ".RepositoryConst::DBCOL_REPOSITORY_FILE_PRICE_ITEM_ID." = '".$itemId."' ".
-                                 "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_PRICE_ITEM_NO." = '".$itemNo."' ".
-                                 "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_PRICE_ATTRIBUTE_ID." = '".$attributeId."' ".
-                                 "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_PRICE_FILE_NO." = '".$fileNo."' ";
-                        $price = $this->Db->execute($query);
-                        if($price === false)
-                        {
-                            return false;
-                        }
-                        
-                        // Check download user's affiliate
-                        $groupId = $this->getDownloadType($price[0][RepositoryConst::DBCOL_REPOSITORY_FILE_PRICE_PRICE], $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_USER_ID]);
-                        if(strlen($groupId) > 0 && $groupId != "0")
-                        {
-                            // Group user
-                            $loginStatus = RepositoryConst::LOG_LOGIN_STATUS_GROUP;
-                        }
-                    }
-                }
-            }
-        }
-        else
-        {
-            // Get file status by log record.
-            $fileStatus = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_FILE_STATUS];
-            $siteLicense = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_SITE_LICENSE];
-            $inputType = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_INPUT_TYPE];
-            $loginStatus = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_LOGIN_STATUS];
-            $groupId = $logRecord[RepositoryConst::DBCOL_REPOSITORY_LOG_GROUP_ID];
-            
-            // Get file name
-            $query = "SELECT ".RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NAME." ".
-                     "FROM ".DATABASE_PREFIX.RepositoryConst::DBTABLE_REPOSITORY_FILE." ".
-                     "WHERE ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID." = '".$itemId."' ".
-                     "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO." = '".$itemNo."' ".
-                     "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID." = '".$attributeId."' ".
-                     "AND ".RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO." = '".$fileNo."' ";
-            $file = $this->Db->execute($query);
-            if($file === false)
-            {
-                return false;
-            }
-            $fileName = $file[0][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NAME];
-        }
-        
-        return true;
-    }
-    // Add file download status to log 2012/11/15 A.Suzuki --end--
-    
-    // Add file download log report 2012/11/21 A.Suzuki --start--
-    /**
-     * Set file download log report to array
-     *
-     * @param string $key
-     * @param string $fileName
-     * @param int $fileStatus
-     * @param int $siteLicense
-     * @param int $loginStatus
-     * @param array $fileLog
-     */
-    private function setFileLogArray($key, $fileName, $fileStatus, $siteLicense, $loginStatus, &$fileLog)
-    {
-        if(!isset($fileLog[$key]))
-        {
-            $fileLog[$key]['file_name'] = $fileName;
-            $fileLog[$key]['index_name'] = $this->getIndexName($key);
-            $fileLog[$key]['total'] = 0;        // トータル(total)
-            $fileLog[$key]['not_login'] = 0;    // 個人(not login)
-            $fileLog[$key]['login'] = 0;        // ログインユーザー(login)
-            $fileLog[$key]['site_license'] = 0; // Download by site license
-            $fileLog[$key]['admin'] = 0;        // Download by admin
-            $fileLog[$key]['register'] = 0;     // Download by register
-        }
-        
-        // Check not login download
-        $fileLog[$key]['total']++;
-        if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_ADMIN)
-        {
-            $fileLog[$key]['admin']++;
-        }
-        else if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_REGISTER)
-        {
-            $fileLog[$key]['register']++;
-        }
-        else if($siteLicense == RepositoryConst::LOG_SITE_LICENSE_ON)
-        {
-            $fileLog[$key]['site_license']++;
-        }
-        else if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_NO_LOGIN)
-        {
-            $fileLog[$key]['not_login']++;
-        }
-        else
-        {
-            $fileLog[$key]['login']++;
-        }
-    }
-    
-    /**
-     * Set file_price download log report to array
-     *
-     * @param string $key
-     * @param string $fileName
-     * @param int $fileStatus
-     * @param int $siteLicense
-     * @param int $loginStatus
-     * @param int $groupId
-     * @param array $fileLog
-     */
-    private function setFilePriceLogArray($key, $fileName, $fileStatus, $siteLicense, $loginStatus, $groupId, &$priceLog)
-    {
-        if(!isset($priceLog[$key]))
-        {
-            $priceLog[$key]['file_name'] = $fileName;
-            $priceLog[$key]['index_name'] = $this->getIndexName($key);
-            $priceLog[$key]['total'] = 0;           // トータル(total)
-            $priceLog[$key]['not_login'] = 0;       // 個人(not login)
-            $priceLog[$key]['group'] = array();     // グループ(group(room))
-            $priceLog[$key]['group']['0'] = 0;      // 非会員(login user(not affiliate))
-            $priceLog[$key]['site_license'] = 0;    // Download by site license
-            $priceLog[$key]['admin'] = 0;           // Download by admin
-            $priceLog[$key]['register'] = 0;        // Download by register
-        }
-        
-        // Check not login download
-        $priceLog[$key]['total']++;
-        if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_ADMIN)
-        {
-            $priceLog[$key]['admin']++;
-        }
-        else if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_REGISTER)
-        {
-            $priceLog[$key]['register']++;
-        }
-        else if($siteLicense == RepositoryConst::LOG_SITE_LICENSE_ON)
-        {
-            $priceLog[$key]['site_license']++;
-        }
-        else if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_NO_LOGIN)
-        {
-            $priceLog[$key]['not_login']++;
-        }
-        else if($loginStatus == RepositoryConst::LOG_LOGIN_STATUS_GROUP)
-        {
-            if(isset($priceLog[$key]['group'][$groupId]))
-            {
-                $priceLog[$key]['group'][$groupId]++;
-            } else {
-                $priceLog[$key]['group'][$groupId] = 1;
-            }
-        }
-        else
-        {
-            $priceLog[$key]['group']['0']++;
-        }
-    }
     
     /**
      * Create file download report string
@@ -2592,18 +923,15 @@ class Repository_Logreport extends RepositoryAction
      *
      * @return string file price download log report 
      */
-    public function makeFilePriceDownloadLogReportStr($priceLog, $priceOpenLog)
+    private function makeFilePriceDownloadLogReportStr($priceLog, $priceOpenLog)
     {
         // -----------------------------------------------
         // Get group list(room_id and room_name list)
         // -----------------------------------------------
         $all_group = array();
         $error_msg = "";
-        $result = $this->getGroupList($all_group, $error_msg);
-        if($result === false)
-        {
-            return $this->Db->ErrorMsg();
-        }
+        
+        $all_group = $this->groupList;
         
         // -----------------------------------------------
         // make file price download log
@@ -2703,6 +1031,322 @@ class Repository_Logreport extends RepositoryAction
         
         return $str;
     }
-    // Add file download log report 2012/11/21 A.Suzuki --end--
+    
+    /**
+     * create search log report
+     * 
+     */
+    private function makeSearchLogReport(){
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        
+        $keywordRanking = $logReport->getKeywordRankingReport();
+        
+        // -----------------------------------------------
+        // make log report
+        // -----------------------------------------------
+        $str = '';
+        $str .= $this->smartyAssign->getLang("repository_log_search_keyword_report_title")."\r\n";
+        $str .= $this->smartyAssign->getLang("repository_log_totaling_month")."\t".$this->disp_start_date."\r\n";
+        $str .= "\r\n";
+        $str .= $this->smartyAssign->getLang("repository_search_keyword_name")."\t";
+        $str .= $this->smartyAssign->getLang("repository_search_num");
+        $str .= "\r\n";
+        for($ii=0; $ii<count($keywordRanking); $ii++){
+            $str .= $keywordRanking[$ii]['search_keyword']."\t";
+            $str .= $keywordRanking[$ii]['CNT']."\r\n";
+        }
+        return $str;
+    }
+    
+    /**
+     * set start date - now date to table
+     *
+     */
+    private function setStartDateByCurrentDate()
+    {
+        $NOW_DATE = new Date();
+        $query = "SELECT DATE_FORMAT(DATE_SUB(?, INTERVAL 1 MONTH), '%Y') AS tmp_year,".
+                 " DATE_FORMAT(DATE_SUB(?, INTERVAL 1 MONTH), '%m') AS tmp_month;";
+        $params = array();
+        $params[] = $NOW_DATE->getYear()."-".$NOW_DATE->getMonth()."-".$NOW_DATE->getDay();
+        $params[] = $NOW_DATE->getYear()."-".$NOW_DATE->getMonth()."-".$NOW_DATE->getDay();
+        $result = $this->Db->execute($query, $params);
+        if($result === false || count($result) != 1){
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        $this->sy_log = $result[0]['tmp_year'];
+        $this->sm_log = sprintf("%02d",$result[0]['tmp_month']);
+    }
+    
+    /**
+     * is exist moved log report?
+     *
+     */
+    private function isExistLogReportFileAndDownload()
+    {
+        $zip_file = "logReport_". sprintf("%d%02d",$this->sy_log, $this->sm_log).".zip";
+            // when log file exist, download that log file
+        if(file_exists(WEBAPP_DIR."/logs/weko/logreport/".$zip_file)){
+            return true;
+        } else {
+            return false;
+        }
+    }
+    
+    /**
+     * Ecreate temporary directory and return path
+     *
+     * @return string
+     */
+    private function createTempDirectory()
+    {
+        // add for compress files
+        $output_files = array();
+        //$date = date("YmdHis");
+        $query = "SELECT DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') AS now_date;";
+        $result = $this->Db->execute($query);
+        if($result === false || count($result) != 1){
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        $date = $result[0]['now_date'];
+        $tmp_dir = WEBAPP_DIR."/uploads/repository/_".$date;
+        mkdir( $tmp_dir, 0777 );
+        
+        return $tmp_dir;
+    }
+    
+    /**
+     * return start date string(YYYYMM)
+     *
+     * @return string
+     */
+    private function getStrOfJoinedStartYearAndStartMonth()
+    {
+        return sprintf("%d-%02d",$this->sy_log, $this->sm_log);
+    }
+    
+    /**
+     * write log report add bom
+     *
+     * @param string $logStr
+     * @param string $logFileName
+     */
+    private function writeLogReport($logStr, $logFileName)
+    {
+        $BOM = pack('C*',0xEF,0xBB,0xBF);
+        
+        $log_report = fopen($logFileName, "w");
+        fwrite($log_report, $BOM.$logStr);
+        fclose($log_report);
+    }
+    
+    /**
+     * create each log report
+     *
+     * @param string $tmp_dir
+     * @return array
+     */
+    public function createLogReport($tmp_dir)
+    {
+        $output_files = array();
+        
+        // サイトライセンス別アクセス数(access num as site lisence)
+        $this->traceLog("write access report per sitelicense", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeAccessLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_SITE_ACCESS. $this->getStrOfJoinedStartYearAndStartMonth().".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        // 課金ファイルダウンロード数(download file num)
+        $fileLogStr = "";
+        $priceLogStr = "";
+        $this->traceLog("output file download report data", __FILE__, __CLASS__, __LINE__);
+        $this->makeFileDownloadLogReport($fileLogStr, $priceLogStr);
+        
+        // FileView
+        $this->traceLog("write file download report", __FILE__, __CLASS__, __LINE__);
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_FILE_DOWNLOAD. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($fileLogStr, $log_file);
+        array_push( $output_files, $log_file );
+        
+        // PayPerView
+        $this->traceLog("write price file download report", __FILE__, __CLASS__, __LINE__);
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_PAY_PER_VIEW. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($priceLogStr, $log_file);
+        array_push( $output_files, $log_file );
+        
+        // インデックごとの詳細画面アクセス数(detail view as index)
+        $this->traceLog("write access report per index", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeIndexLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_INDEX_ACCESS. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        $this->infoLog("businessLogreport", __FILE__, __CLASS__, __LINE__);
+        $logReport = BusinessFactory::getFactory()->getBusiness("businessLogreport");
+        $logReport->setAdminBase($this->repository_admin_base);
+        $logReport->setAdminRoom($this->repository_admin_room);
+        
+        if($logReport->getIsCreatedSuppleReport()){
+            // サプリコンテンツの閲覧回数およびダウンロード回数(detail view and download file num as supple items)
+            $this->traceLog("write supple contents usagestatics report", __FILE__, __CLASS__, __LINE__);
+            $log_str = $this->makeSuppleLogReport();
+            $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_SUPPLE_ACCESS. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+            $this->writeLogReport($log_str, $log_file);
+            array_push( $output_files, $log_file );
+        }
+        
+        $this->traceLog("write access report per host", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeHostLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_HOST_ACCESS. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        $this->traceLog("write item detail report", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeDetailViewLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_DETAIL_VIEW. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        $this->traceLog("write user affiliation report", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeUserLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_USER_AFFILIATE. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        $this->traceLog("write file download report per user", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeUsersDLLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_DOWNLOAD_PER_USER. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        // 検索キーワードランキング
+        $this->traceLog("write search keyword report", __FILE__, __CLASS__, __LINE__);
+        $log_str = $this->makeSearchLogReport();
+        $log_file = $tmp_dir. DIRECTORY_SEPARATOR. self::FILE_NAME_SEARCH_COUNT. $this->getStrOfJoinedStartYearAndStartMonth(). ".tsv";
+        $this->writeLogReport($log_str, $log_file);
+        array_push( $output_files, $log_file );
+        
+        return $output_files;
+    }
+
+    /**
+     * check be able to login or not and login user has authority of administrator
+     *
+     * @return : is admin login
+     */
+    private function isLoginAdministrator()
+    {
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setConfigAuthority();
+        require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDbAccess.class.php';
+        $repositoryAction->dbAccess = new RepositoryDbAccess($this->Db);
+        
+        // -----------------------------------------------
+        // check login
+        // -----------------------------------------------
+        $user_id = $this->Session->getParameter("_user_id");
+        if($user_id != "0"){
+            // check auth
+            $user_authority_id = $this->Session->getParameter("_user_auth_id");
+            $authority_id = $repositoryAction->getRoomAuthorityID($user_id);
+        } else if(isset($this->login_id) && strlen($this->login_id) > 0 &&
+                  isset($this->password) && strlen($this->password) > 0){
+            
+            $ret = $repositoryAction->checkLogin($this->login_id, $this->password, $Result_List, $error_msg);
+            if($ret === false){
+                return false;
+            }
+            
+            $container =& DIContainerFactory::getContainer();
+            $authoritiesView =& $container->getComponent("authoritiesView");
+            $authorities =& $authoritiesView->getAuthorityById($Result_List[0]["role_authority_id"]);
+            $user_authority_id = $authorities['user_authority_id'];
+            $authority_id = $repositoryAction->getRoomAuthorityID($Result_List[0]["user_id"]);
+        } else {
+            return false;
+        }
+        
+        if($user_authority_id < $repositoryAction->repository_admin_base || $authority_id < $repositoryAction->repository_admin_room){
+            return false;
+        }
+        
+        return true;
+    }
+    
+    /**
+     * initialize member value for logReport
+     *
+     */
+    private function initForLogreport()
+    {
+        ini_set('max_execution_time', 2400);
+        ini_set('memory_limit', '2048M');
+        
+        // get language
+        $this->lang = $this->Session->getParameter("_lang");
+        
+        $this->setupLanguageResourceForOtherAction();
+        
+        // If start year and start month is not set, start year and start month set to current year and current month
+        // set start date
+        if(!isset($this->sy_log) || strlen($this->sy_log) == 0 || intval($this->sy_log) < 1 || 
+            !isset($this->sm_log) || strlen($this->sm_log) == 0 || intval($this->sm_log) < 1 || 12 < intval($this->sm_log) ){
+            
+            $this->setStartDateByCurrentDate();
+        }
+        
+        // send mail address check
+        $users = array();
+        if($this->mail == "true"){
+            $this->getLogReportMailInfo($users);
+            if(count($users) == 0){
+                $this->addErrMsg($this->Db->ErrorMsg());
+                throw new AppException($this->Db->ErrorMsg());
+            }
+        }
+        
+        $this->setupGroupList();
+        
+        // for download and send mail
+        $this->exitFlag = true;
+    }
+    
+    /**
+     * set language resource for execute by other action(repository_edit_log_move)
+     *
+     */
+    public function setupLanguageResourceForOtherAction()
+    {
+        // get language resource
+        $container =& DIContainerFactory::getContainer();
+        $filterChain =& $container->getComponent("FilterChain");
+        $this->smartyAssign =& $filterChain->getFilterByName("SmartyAssign");
+    }
+    
+    /**
+     * set group list
+     *
+     */
+    public function setupGroupList()
+    {
+        // set all nc2 group list
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Db = $this->Db;
+        $result = $repositoryAction->getGroupList($all_group, $error_msg);
+        if($result === false){
+            $this->errorLog($error_msg, __FILE__, __CLASS__, __LINE__);
+            throw new AppException($error_msg);
+        }
+        $this->groupList = $all_group;
+    }
 }
 ?>
diff --git a/repository/logreport/maple.ini b/repository/logreport/maple.ini
index 6b6cf3a..13a9bc0 100644
--- a/repository/logreport/maple.ini
+++ b/repository/logreport/maple.ini
@@ -2,9 +2,6 @@
 module = main.ini
 config = main.ini
 
-[DIContainer]
-filename = "dicon.ini"
-
 [ValidateDef]
 sy_log
 sm_log
diff --git a/repository/maple.ini b/repository/maple.ini
index e9d0295..c7be0fd 100644
--- a/repository/maple.ini
+++ b/repository/maple.ini
@@ -1,5 +1,8 @@
 [SmartyAssign]
 module = main.ini
 
+[DIContainer]
+filename = "/modules/repository/dicon.ini"
+
 [Include]
 filename = "/modules/repository/config/define.inc.php"
diff --git a/repository/oaiore/Oaiore.class.php b/repository/oaiore/Oaiore.class.php
index 675d81f..7a493e7 100644
--- a/repository/oaiore/Oaiore.class.php
+++ b/repository/oaiore/Oaiore.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Oaiore.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Oaiore.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -142,7 +142,7 @@ class Repository_Oaiore extends RepositoryAction
 	    	// Add check close index 2009/12/21 Y.Nakao --start--
 					 //" AND pub_date <= '".date('Y-m-d 00:00:00.000',mktime())."' ".
 					 " AND pub_date <= NOW() ".
-	    			 " AND public_state = '1' ".
+	    			 " AND public_state = 1 ".
 					 " AND is_delete = 0; ";
 	    	// Add check close index 2009/12/21 Y.Nakao --end--
 	    	$retRef = $this->Db->execute($query);
@@ -301,7 +301,7 @@ class Repository_Oaiore extends RepositoryAction
 		    			// Add check close index 2009/12/21 Y.Nakao --start--
 						 //" AND pub_date <= '".date('Y-m-d 00:00:00.000',mktime())."' ".
 		    			 " AND pub_date <= NOW() ".
-		    			 " AND public_state = '1' ".
+		    			 " AND public_state = 1 ".
 						 " AND is_delete = 0; ";
 	    				// Add check close index 2009/12/21 Y.Nakao --end--
 		    	$params = null;
@@ -878,12 +878,12 @@ class Repository_Oaiore extends RepositoryAction
 						 "  AND item.item_type_id = attr_type.item_type_id ".
 						 "  AND name.attribute_id = attr_type.attribute_id ".
 						 "  AND attr_type.junii2_mapping = 'creator' ".
-						 "  AND item.is_delete != '1' ".
+						 "  AND item.is_delete != 1 ".
 						 "  AND item.item_id = ? ".
 						 // Fix output hidden metadata 2011/11/28 Y.Nakao --start--
 						 "  AND attr_type.hidden = 0 ".
 						 // Fix output hidden metadata 2011/11/28 Y.Nakao --end--
-						 "  AND name.is_delete = '0' ;";
+						 "  AND name.is_delete = 0 ;";
 			$params1 = null;
 			$params1[] = $itemId;
 			$ret_personal_name = $this->Db->execute($query, $params1);
@@ -918,13 +918,13 @@ class Repository_Oaiore extends RepositoryAction
 					 "  AND (item_type.mapping_info != null OR  item_type.mapping_info != '') ".
 					 "  AND item.item_type_id = attr_type.item_type_id ".
 					 "  AND attr.attribute_id = attr_type.attribute_id ".
-					 "  AND item.is_delete != '1' ".
+					 "  AND item.is_delete != 1 ".
 					 "  AND attr_type.junii2_mapping = 'creator' ".
 					 "  AND item.item_id = ? ".
 					 // Fix output hidden metadata 2011/11/28 Y.Nakao --start--
 					 "  AND attr_type.hidden = 0 ".
 					 // Fix output hidden metadata 2011/11/28 Y.Nakao --end--
-					 "  AND attr.is_delete = '0' ;";
+					 "  AND attr.is_delete = 0 ;";
 			$ret_item_attr = $this->Db->execute($query, $params1);
 			if ($ret_item_attr === false) {
 				$this->outputError();
diff --git a/repository/oaiore/maple.ini b/repository/oaiore/maple.ini
index e9d12bf..d39a6bb 100644
--- a/repository/oaiore/maple.ini
+++ b/repository/oaiore/maple.ini
@@ -1,18 +1,3 @@
-;[Convert]
-;*.trim =
-
-;[ValidateDef]
-;item_type_id
-
-;[Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
-
-;[View]
-;success = "action:repository_view_main_export_detailconfirm"
-
-
-
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
diff --git a/repository/oaipmh/Oaipmh.class.php b/repository/oaipmh/Oaipmh.class.php
index 559552e..af53123 100644
--- a/repository/oaipmh/Oaipmh.class.php
+++ b/repository/oaipmh/Oaipmh.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Oaipmh.class.php 657 2014-11-28 10:40:35Z ivis $
+// $Id: Oaipmh.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -13,6 +13,7 @@
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryConst.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryItemAuthorityManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexAuthorityManager.class.php';
 
 /**
@@ -133,6 +134,13 @@ class Repository_Oaipmh extends RepositoryAction
      * @var array
      */
     private $harvestPublicIndex = array();
+    
+    /**
+     * setSpec full string
+     *
+     * @var string
+     */
+    private $fullSet = "";
 
     /*******************************************************************/
     /**
@@ -174,7 +182,7 @@ class Repository_Oaipmh extends RepositoryAction
         $this->initAction();
 
         // init member variable
-        $this->initialize();
+        $this->initializeOaipmh();
         $xml = '';
 
         // header
@@ -237,9 +245,11 @@ class Repository_Oaipmh extends RepositoryAction
 
     /**
      * initialize
+     * 
+     * ActionBaseのメソッド名と被るため関数名変更
      *
      */
-    private function initialize()
+    private function initializeOaipmh()
     {
         // init output string
         $this->errorCode = '';
@@ -412,15 +422,11 @@ class Repository_Oaipmh extends RepositoryAction
      *
      * @param bool $required must
      */
-    private function checkSet($must=false)
-    {
-        if($must && strlen($this->set) == 0)
-        {
+    private function checkSet($must=false) {
+        if($must && strlen($this->set) == 0) {
             $this->errorCode = self::ERRORCODE_BAD_ARGUMENT;
             return;
-        }
-        else if(preg_match("/^[0-9]+$/", $this->set) == 1)
-        {
+        } else if(preg_match("/^[0-9]+$/", $this->set) == 1) {
             // 'set' is index_id
             $query = "SELECT index_id ".
                      "FROM ". DATABASE_PREFIX ."repository_index ".
@@ -428,14 +434,18 @@ class Repository_Oaipmh extends RepositoryAction
             $params = array();
             $params[] = intval($this->set);
             $ret = $this->Db->execute($query, $params);
-            if ($ret === false || count($ret) != 1)
-            {
+            if ($ret === false || count($ret) != 1) {
                 $this->errorCode = self::ERRORCODE_BAD_ARGUMENT;
             }
-        }
-        else
-        {
-            $this->set = '';
+        } else {
+            // setSpecが階層形式で来た場合最後の要素だけを使う
+            $set = explode(":", $this->set);
+            if(count($set) > 1 && preg_match("/^[0-9]+$/", $set[count($set)-1]) == 1) {
+                $this->fullSet = $this->set;
+                $this->set = $set[count($set)-1];
+            } else {
+                $this->set = '';
+            }
         }
     }
 
@@ -937,25 +947,29 @@ class Repository_Oaipmh extends RepositoryAction
     {
         $xml = '';
         if ($nextToken > 0) {
+            // from指定が無い場合
             if ($this->from == null || strlen($this->from) == 0) {
                 $this->from = '0001-01-01T00:00:00Z';
-            }
-            else
-            {
+            } else {
                 $this->from = $this->getStandardTime($this->from);
             }
+            // until指定が無い場合
             if ($this->until == null || strlen($this->until) == 0) {
                 $this->until = '9999-12-31T23:59:59Z';
-            }
-            else
-            {
+            } else {
                 $this->until = $this->getStandardTime($this->until);
             }
-
+            // setSpecが連結形式の場合
+            if(strlen($this->fullSet) > 0) {
+                $setSpec = $this->fullSet;
+            } else {
+                $setSpec = $this->set;
+            }
+            
             //$resumptionToken = "${request_from}/${request_until}/${request_set}/${request_metadataPrefix}/${next_resumptionToken}";
             $resumptionToken = $this->from.'/'.
                                $this->until.'/'.
-                               $this->set.'/'.
+                               $setSpec.'/'.
                                $this->metadataPrefix.'/'.
                                $nextToken;
             // 1時間後となるようにする
@@ -1001,11 +1015,11 @@ class Repository_Oaipmh extends RepositoryAction
         //検索速度特化対応
         if(!_REPOSITORY_HIGH_SPEED && $pubflg)
         {
-            $setSpec = $this->getSetSpec($itemId, $itemNo);
+            $setSpec = $this->getSetSpec($itemId, $itemNo, true);
             for($ii=0; $ii<count($setSpec); $ii++)
             {
                 $xml .= '<'.RepositoryConst::OAIPMH_TAG_SET_SPEC.'>';
-                $xml .= sprintf("%05d", $setSpec[$ii]);
+                $xml .= $setSpec[$ii];
                 $xml .= '</'.RepositoryConst::OAIPMH_TAG_SET_SPEC.'>';
             }
         }
@@ -1525,9 +1539,15 @@ class Repository_Oaipmh extends RepositoryAction
 	            $params[] = $until;
 	        }
         }
-
-        if(strlen($this->set) > 0)
-        {
+        
+        
+        
+        if(strlen($this->set) > 0) {
+            // setSpecの階層指定が間違っていた場合noRecordMarchを返す
+            if(!$this->checkSetspecPosition()) {
+                return array();
+            }
+            
             if(strlen($addFilter) == 0)
             {
                 $addFilter .= 'WHERE ';
@@ -1537,13 +1557,32 @@ class Repository_Oaipmh extends RepositoryAction
                 $addFilter .= ' AND ';
             }
             // Mod Bug fix No.56 2014/03/24 T.Koyasu --start--
-            $addFilter .= " item_id IN ( ".
-                          "     SELECT item_id ".
-                          "     FROM ". DATABASE_PREFIX. "repository_position_index ".
-                          "     WHERE index_id = ? ".
-                          " ) ";
-            // Mod Bug fix No.56 2014/03/24 T.Koyasu --end--
-            $params[] = preg_replace("/^0+/", "", $this->set);
+            $indexIds = preg_replace("/^0+/", "", $this->set);
+            $indexArray = array();
+            
+            // setで指定されたインデックスの子インデックスを再帰的にすべて取得する
+            $repositoryIndexManager = new RepositoryIndexManager($this->Session, $this->dbAccess, $this->TransStartDate);
+            $repositoryIndexManager->getDescendants(preg_replace("/^0+/", "", $this->set), $indexArray);
+            if(count($indexArray) > 0) {
+                for($indexNum = 0; $indexNum < count($indexArray); $indexNum++) {
+                    if(strlen($indexIds) > 0) {
+                        $indexIds .= ",";
+                    }
+                    $indexIds .= $indexArray[$indexNum];
+                }
+            }
+            $addFilter .= " item_id IN (".
+                                         "SELECT POS.item_id FROM ". DATABASE_PREFIX. "repository_position_index POS ".
+                                         "INNER JOIN ". DATABASE_PREFIX. "repository_index IDX ON POS.index_id = IDX.index_id ".
+                                         "INNER JOIN ". DATABASE_PREFIX. "repository_index_browsing_authority AUTH ON AUTH.index_id = IDX.index_id ".
+                                         "WHERE IDX.index_id IN (". $indexIds. ") ".
+                                         "AND AUTH.harvest_public_state = ? ".
+                                         "AND IDX.is_delete = ? ".
+                                         "AND POS.is_delete = ? ".
+                                      ") ";
+            $params[] = 1; // harvest_public_status
+            $params[] = 0; // is_delete
+            $params[] = 0; // is_delete
         }
 
         if(strlen($addFilter) > 0)
@@ -1590,35 +1629,94 @@ class Repository_Oaipmh extends RepositoryAction
      * @param int item_no
      * @return string setSpec
      */
-    private function getSetSpec($item_id, $item_no)
+    private function getSetSpec($item_id, $item_no, $recursiveFlag=false)
     {
         // set public index list
         // Mod OpenDepo 2014/01/31 S.Arata --start--
-        if(strlen($this->publicIndexQuery) == 0)
-        {
+        if(strlen($this->publicIndexQuery) == 0) {
             $this->setPublicIndexQuery();
         }
-        $query = "SELECT pos.`index_id` ".
-                 "FROM `". DATABASE_PREFIX ."repository_position_index` pos ".
-                 "INNER JOIN (".$this->publicIndexQuery.") pub ON pos.index_id = pub.index_id ".
-                 "WHERE pos.`is_delete` = ? AND pos.`item_id` = ? AND pos.`item_no` = ?";
+        $query = "SELECT POS.index_id ".
+                 "FROM ". DATABASE_PREFIX ."repository_position_index POS ".
+                 "INNER JOIN (".$this->publicIndexQuery.") PUB ON POS.index_id = PUB.index_id ".
+                 "WHERE POS.is_delete = ? ".
+                 "AND POS.item_id = ? ".
+                 "AND POS.item_no = ? ;";
         $params = array();
         $params[] = 0;  // 削除されていない
         $params[] = $item_id;
         $params[] = $item_no;
         $ret = $this->Db->execute($query, $params);
-        if ($ret === false)
-        {
+        if ($ret === false) {
             // not blong index
             return '';
         }
-
+        
+        $repositoryIndexManager = new RepositoryIndexManager($this->Session, $this->dbAccess, $this->TransStartDate);
         $belong_index = array();
         for ($nCnt=0; $nCnt<count($ret); $nCnt++) {
-                array_push($belong_index, $ret[$nCnt]['index_id']);
+            if($recursiveFlag) {
+                // 再帰的に親インデックスを辿り全てのインデックスIDを取得する
+                $specs = array();
+                $repositoryIndexManager->strictlySetSpec($ret[$nCnt]['index_id'], $specs);
+                // setSpecとしてコロンで繋げる
+                $setSpec = "";
+                for($jj = 0; $jj < count($specs); $jj++) {
+                    if($jj > 0) {
+                        $setSpec .= ":";
+                    }
+                    $setSpec .= $specs[$jj];
+                }
+                array_push($belong_index, $setSpec);
+            } else {
+                // 直接所属しているインデックスのみをsetSpecとして出力する
+                array_push($belong_index, sprintf("%05d", $ret[$nCnt]['index_id']));
             }
+        }
         return $belong_index;
     }
-
+    
+    /**
+     * check setSpec position index
+     *
+     * @return bool
+     */
+    private function checkSetspecPosition() {
+        // 指定されたsetの階層が全て正しいかチェックする
+        // setSpecが階層形式で無い場合はスルーする
+        if(strlen($this->fullSet) == 0) {
+            return true;
+        }
+        
+        $specs = array();
+        $specs = explode(":", $this->fullSet);
+        $specs = array_reverse($specs);
+        for($ii = 0; $ii < count($specs); $ii++) {
+            $query = "SELECT parent_index_id FROM ". DATABASE_PREFIX. "repository_index ".
+                     "WHERE index_id = ? ".
+                     "AND is_delete = ? ;";
+            $params = array();
+            $params[] = $specs[$ii];
+            $params[] = 0;
+            $result = $this->Db->execute($query, $params);
+            if($result === false || count($result) == 0) {
+                return false;
+            }
+            
+            // 一番上のインデックスまでチェックが通過したらtrueを返す
+            if($result[0]["parent_index_id"] == 0) {
+                return true;
+            }
+            // setSpecが1つ上の階層のインデックスIDと一致しているかチェックする
+            if(isset($specs[$ii+1])) {
+                if($result[0]["parent_index_id"] != $specs[$ii+1]) {
+                    return false;
+                }
+            }
+        }
+        
+        // 全て通過したという事は一番上の階層までループが辿り着いていないという事なので不正扱い
+        return false;
+    }
 }
 ?>
\ No newline at end of file
diff --git a/repository/oaipmh/format/JuNii2.class.php b/repository/oaipmh/format/JuNii2.class.php
index 32cb112..1793b54 100644
--- a/repository/oaipmh/format/JuNii2.class.php
+++ b/repository/oaipmh/format/JuNii2.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: JuNii2.class.php 42605 2014-10-03 01:02:01Z keiya_sugimoto $
+// $Id: JuNii2.class.php 49321 2015-03-03 12:15:32Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -61,6 +61,7 @@ class Repository_Oaipmh_JuNii2 extends Repository_Oaipmh_FormatAbstract
                                 RepositoryConst::JUNII2_SELFDOI=>1,
                                 RepositoryConst::JUNII2_SELFDOI_JALC=>1,
                                 RepositoryConst::JUNII2_SELFDOI_CROSSREF=>1,
+                                RepositoryConst::JUNII2_SELFDOI_DATACITE=>1,
                                 RepositoryConst::JUNII2_NAID=>1,
                                 RepositoryConst::JUNII2_ICHUSHI=>1,
                                 RepositoryConst::JUNII2_GRANTID=>1,
@@ -1782,6 +1783,13 @@ class Repository_Oaipmh_JuNii2 extends Repository_Oaipmh_FormatAbstract
             // selfdoi(crossref) is min occurs = 0, maxOccurs=1.
             return false;
         }
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        if($this->occurs[RepositoryConst::JUNII2_SELFDOI_DATACITE] < 0)
+        {
+            // selfdoi(datacite) is min occurs = 0, maxOccurs=1.
+            return false;
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         if($this->occurs[RepositoryConst::JUNII2_NAID] < 0)
         {
             // NAID is min occurs = 0, maxOccurs=1.
@@ -1844,23 +1852,33 @@ class Repository_Oaipmh_JuNii2 extends Repository_Oaipmh_FormatAbstract
         $this->getRepositoryHandleManager();
         $uri_jalcdoi = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_JALC_DOI);
         $uri_crossref = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_CROSS_REF_DOI);
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $uri_datacite = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_DATACITE_DOI);
         $uri_library_jalcdoi = $this->repositoryHandleManager->createSelfDoiUri($item_id, $item_no, RepositoryHandleManager::ID_LIBRARY_JALC_DOI);
         
-        if(strlen($uri_jalcdoi) > 0 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1)
+        if(strlen($uri_jalcdoi) > 0 && strlen($uri_crossref) < 1 && strlen($uri_datacite) < 1 && strlen($uri_library_jalcdoi) < 1)
         {
             $option = array();
             $option[RepositoryConst::JUNII2_SELFDOI_ATTRIBUTE_JALC_DOI] = RepositoryConst::JUNII2_SELFDOI_RA_JALC;
             $xml .= $this->outputElement($tag, $uri_jalcdoi, $option);
             
         }
-        else if(strlen($uri_crossref) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_library_jalcdoi) < 1)
+        else if(strlen($uri_crossref) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_datacite) < 1 && strlen($uri_library_jalcdoi) < 1)
         {
             $option = array();
             $option[RepositoryConst::JUNII2_SELFDOI_ATTRIBUTE_JALC_DOI] = RepositoryConst::JUNII2_SELFDOI_RA_CROSSREF;
             $xml = $this->outputElement($tag, $uri_crossref, $option);
             
         }
-        else if(strlen($uri_library_jalcdoi) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1)
+        else if(strlen($uri_datacite) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1)
+        {
+            $option = array();
+            $option[RepositoryConst::JUNII2_SELFDOI_ATTRIBUTE_JALC_DOI] = RepositoryConst::JUNII2_SELFDOI_RA_DATACITE;
+            $xml = $this->outputElement($tag, $uri_datacite, $option);
+            
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
+        else if(strlen($uri_library_jalcdoi) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1 && strlen($uri_datacite) < 1)
         {
             $option = array();
             $option[RepositoryConst::JUNII2_SELFDOI_ATTRIBUTE_JALC_DOI] = RepositoryConst::JUNII2_SELFDOI_RA_JALC;
diff --git a/repository/oaipmh/format/LearningObjectMetadata.class.php b/repository/oaipmh/format/LearningObjectMetadata.class.php
index bf82258..ef9a8af 100644
--- a/repository/oaipmh/format/LearningObjectMetadata.class.php
+++ b/repository/oaipmh/format/LearningObjectMetadata.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: LearningObjectMetadata.class.php 36217 2014-05-26 04:22:11Z satoshi_arata $
+// $Id: LearningObjectMetadata.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -3311,7 +3311,7 @@ class Repository_Oaipmh_LOM_LangString
         if(strlen($this->string) > 0){
             // format language.
             $this->language = RepositoryOutputFilter::language($this->language);
-            if($this->language === 'other')
+            if($this->language === RepositoryConst::ITEM_LANG_OTHER)
             {
                 $this->language = '';
             }
diff --git a/repository/oaipmh/format/Lido.class.php b/repository/oaipmh/format/Lido.class.php
index da29d32..12b0c58 100644
--- a/repository/oaipmh/format/Lido.class.php
+++ b/repository/oaipmh/format/Lido.class.php
@@ -129,10 +129,7 @@ class Repository_Oaipmh_Lido extends Repository_Oaipmh_FormatAbstract
         {
             return '';
         }
-
-
-        $this->fixOutputFormat();
-
+        
         // convert DOMDocument to XML string
         $xml = $this->domDocument->saveXML();
         
@@ -1159,228 +1156,5 @@ class Repository_Oaipmh_Lido extends Repository_Oaipmh_FormatAbstract
             }
         }
     }
-
-    /**
-     *
-     * LODO Schemaの妥当性検証パスするための暫定対応
-     *
-     **/
-    private function fixOutputFormat(){
-        $this->domDocument->normalizeDocument();
-
-        // sequence暫定対応(lido:descriptiveMetadata)
-        $descmeta = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_DESCRIPTIVE_METADATA);
-        if($descmeta->length===1){
-            $descmeta = $descmeta->item(0);
-
-            $obj_cls_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_CLASSIFICATION_WRAP)->item(0);
-            $obj_ident_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_IDENTIFICATION_WRAP)->item(0);
-            $event_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_WRAP)->item(0);
-$obj_rel_wrap = $descmeta->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_RELATION_WRAP)->item(0);
-
-            $descmeta->removeChild($obj_cls_wrap);
-            $descmeta->removeChild($obj_ident_wrap);
-            $descmeta->removeChild($event_wrap);
-            $descmeta->removeChild($obj_rel_wrap);
-
-            $descmeta->appendChild($obj_cls_wrap);
-            $descmeta->appendChild($obj_ident_wrap);
-            $descmeta->appendChild($event_wrap);
-            $descmeta->appendChild($obj_rel_wrap);
-        }
-
-        // sequence暫定対応(lido:objectIdentificationWrap)
-        $obj_ident_wrap = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_IDENTIFICATION_WRAP);
-        if($obj_ident_wrap->length ===1 ){
-            $obj_ident_wrap = $obj_ident_wrap->item(0);
-
-            $title_wrap = $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_TITLE_WRAP)->item(0);
-            $repo_wrap = $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_REPOSITORY_WRAP)->item(0);
-            $obj_desc_wrap =  $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_DESCRIPTION_WRAP)->item(0);
-            $obj_mesure_wrap = $obj_ident_wrap->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_MEASUREMENTS_WRAP)->item(0);
-            /*
-            $obj_ident_wrap->removeChild($title_wrap);
-            $obj_ident_wrap->removeChild($repo_wrap);
-            $obj_ident_wrap->removeChild($obj_desc_wrap);
-            $obj_ident_wrap->removeChild($obj_mesure_wrap);
-            */
-            $obj_ident_wrap->appendChild($title_wrap);
-            $obj_ident_wrap->appendChild($repo_wrap);
-            $obj_ident_wrap->appendChild($obj_desc_wrap);
-            $obj_ident_wrap->appendChild($obj_mesure_wrap);
-        }
-
-        // sequence暫定対応(lido:objectWorkType)
-        $obj_work_type = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_OBJECT_WORK_TYPE);
-        foreach($obj_work_type as $node){
-            //$id = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_CONCEPT_ID);
-            $term = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_TERM);
-            if($term->length >0 ){
-                foreach($term as $node2){
-                    //       $node->removeChild($node2);
-                    $node->appendChild($node2);
-                }
-            }
-        }
-
-
-        //eventID 0..*
-        //eventType 
-        //roleInEvent 0..*
-        //eventName 0..*
-        //eventActor 0..*
-        //culture 0..*
-        //eventDate 0..*
-        //periodName 0..*
-        //eventPlace 0..*
-        //eventMethod 0..*
-        //eventMaterialsTech 0..*
-        //thingPresent 0..*
-        //relatedEventSet 0..*
-        //eventDescriptionSet 0..*
-        $eventTag = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT);
-        if($eventTag->length === 1){
-            $tmp = $eventTag->item(0);
-            //            $event_id = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_ID);
-            $event_type = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_TYPE);
-            $event_actorTag = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_ACTOR);
-            $event_date = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_DATE);
-            $period_name = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_PERIOD_NAME);
-            $event_place = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_PLACE); 
-            $event_materialstech = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_MATERIALS_TECH);
-            
-            /*
-            foreach($event_id as $node) {
-                $tmp->appendChild($node);
-            }
-            */
-            // lido:event_type は lido:eventでは必須
-            if($event_type->length === 0 ){
-                $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_EVENT_TYPE);
-                $tmp->appendChild($node);
-            }
-            foreach($event_type as $node) {
-                $tmp->appendChild($node);
-            }           
-            foreach($event_actorTag as $node) {
-                $tmp->appendChild($node);
-            }
-            foreach($event_date as $node) {
-                $tmp->appendChild($node);
-            }
-            foreach($period_name as $node) {
-                $tmp->appendChild($node);
-            }
-            foreach($event_place as $node) {
-                $tmp->appendChild($node);
-            }
-            foreach($event_materialstech as $node) {
-                $tmp->appendChild($node);
-            }
-        }
-        
-        // RecordWrap
-        $record_wrap = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_WRAP);
-        if($record_wrap->length === 1 ){
-            $tmp = $record_wrap->item(0);
-            // recordID 1..*            
-            $rec_id = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_ID);
-            // recordType            
-            $rec_type = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_TYPE);
-            // recordSource 1..*
-            $rec_src = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_SOURCE);
-            // recordRights 0..*
-            //$rec_right = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_);
-
-            // recordInfoSet 0..*
-            $rec_infoset = $tmp->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_INFO_SET);
-
-            if($rec_id->length === 0 ){
-                $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_ID);
-                $tmp->appendChild($node);
-            }
-
-            if($rec_type->length === 0){
-                $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_TYPE);
-                $tmp->appendChild($node);
-            }
-
-            if($rec_src->length === 0 ){
-                $node = $this->domDocument->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_SOURCE);
-                $tmp->appendChild($node);
-            }
-            
-            $newDoc = new DOMDocument();
-            $root = $newDoc->createElement(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RECORD_WRAP);
-            $newDoc->appendChild($root);
-            foreach($rec_id as $node){
-                $root->appendChild($newDoc->importNode($node,true));
-            }
-            foreach($rec_type as $node){
-                $root->appendChild($newDoc->importNode($node,true));
-            }
-            foreach($rec_src as $node){
-                $root->appendChild($newDoc->importNode($node,true));
-            }
-            
-            foreach($rec_infoset as $node){
-                $root->appendChild($newDoc->importNode($node,true));
-            }
-            $this->deleteChildren($record_wrap->item(0));
-            $newNode = $this->domDocument->importNode($root,true);
-            $record_wrap->item(0)->parentNode->replaceChild($newNode,$record_wrap->item(0));
-            
-            
-        }
-
-        //resourceSet
-        //resourceID 0..1
-        //resourceRepresentation 0..*
-        //resourceType 0..1
-        //resourceRelType 0..*
-        //resourcePerspective 0..*
-        //resourceDescription 0..*
-        //resourceDateTaken 0..1
-        //resourceSource 0..*
-        //rightsResource 0..*
-        $resourceSet = $this->domDocument->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_SET);
-        foreach($resourceSet as $node){
-            $res_rep = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_REPRESENTATION);
-            $res_desc = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_DESCRIPTION);
-            $res_src = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RESOURCE_SOURCE);
-            $res_right = $node->getElementsByTagName(RepositoryConst::LIDO_TAG_NAMESPACE.RepositoryConst::LIDO_TAG_RIGHT_RESOURCE);
-            
-            foreach($res_rep as $n) {
-                $node->appendChild($n);
-            }
-            foreach($res_desc as $n){
-                $node->appendChild($n);
-            }
-            foreach($res_src as $n){
-                $node->appendChild($n);
-            }
-            foreach($res_right as $n){
-                $node->appendChild($n);
-            }
-        }
-        
-        
-        
-    }
-
-    private function deleteNode($node) { 
-        $this->deleteChildren($node); 
-        $parent = $node->parentNode; 
-        $oldnode = $parent->removeChild($node); 
-    } 
-
-    private function deleteChildren($node) {
-        while (isset($node->firstChild)) { 
-            $this->deleteChildren($node->firstChild); 
-            $node->removeChild($node->firstChild); 
-        } 
-    } 
-
-    
 }
 ?>
\ No newline at end of file
diff --git a/repository/opensearch/Opensearch.class.php b/repository/opensearch/Opensearch.class.php
index 20564bc..0479710 100644
--- a/repository/opensearch/Opensearch.class.php
+++ b/repository/opensearch/Opensearch.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Opensearch.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: Opensearch.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -131,6 +131,11 @@ class Repository_Opensearch extends RepositorySearch
         }
         // Add index recursive search. 2014/08/12 Y.Nakao --end--
         
+        if(isset($this->_request["affiliationid"]) && strlen($this->_request["affiliationid"]) > 0)
+        {
+        	$this->search_term['affiliationid'] = $this->_request["affiliationid"];
+        }
+        
         $this->validateRequestParameter();
         
         // switch format.
@@ -159,8 +164,7 @@ class Repository_Opensearch extends RepositorySearch
             case RepositorySearchRequestParameter::FORMAT_ATOM:
                 // output ATOM
                 require_once WEBAPP_DIR.'/modules/repository/opensearch/format/Atom.class.php';
-                $blockid = $this->RepositoryAction->getBlockPageId();
-                $outputClass = new Repository_OpenSearch_Atom($this->Session, $this->Db,$blockid);
+                $outputClass = new Repository_OpenSearch_Atom($this->Session, $this->Db);
                 $searchResult = $this->search();
                 $requestParam = $this->getRequestParameter();
                 $requestParam[self::REQUEST_LOG_TERM] = $this->log_term;
@@ -186,7 +190,10 @@ class Repository_Opensearch extends RepositorySearch
                                                         $searchResult);
                 break;
             default:
-                if(isset($this->search_term[self::REQUEST_WEKO_ID]) && strlen($this->search_term[self::REQUEST_WEKO_ID]) > 0)
+
+                // Update suppleContentsEntry Y.Yamazawa --start-- 2015/03/20 --start--
+                if((isset($this->search_term[self::REQUEST_WEKO_ID]) && strlen($this->search_term[self::REQUEST_WEKO_ID]) > 0)
+                    || (isset($this->search_term[self::REQUEST_ITEM_IDS]) && strlen($this->search_term[self::REQUEST_ITEM_IDS]) > 0))
                 {
                     // weko_idに該当するアイテムを検索
                     $result = $this->search();
@@ -196,7 +203,8 @@ class Repository_Opensearch extends RepositorySearch
                         break;
                     }
                 }
-                
+                // Update suppleContentsEntry Y.Yamazawa --end-- 2015/03/20 --end--
+
                 // redirect to snippet
                 if(strlen($redirectUrl) == 0)
                 {
@@ -216,7 +224,6 @@ class Repository_Opensearch extends RepositorySearch
                     $block_info = $this->RepositoryAction->getBlockPageId();
                     $redirectUrl .= "&page_id=". $block_info["page_id"].
                                     "&block_id=". $block_info["block_id"];
-
                 }
                 break;
         }
diff --git a/repository/opensearch/format/Atom.class.php b/repository/opensearch/format/Atom.class.php
index 3bf176e..08d35e8 100644
--- a/repository/opensearch/format/Atom.class.php
+++ b/repository/opensearch/format/Atom.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Atom.class.php 43084 2014-10-20 06:53:41Z yuko_nakao $
+// $Id: Atom.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -23,16 +23,13 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
     const XMLNS_PRISM       = "http://prismstandard.org/namespaces/basic/2.0/";
     const XMLNS_OPEN_SEARCH = "http://a9.com/-/spec/opensearch/1.1/";
     const XMLNS_WEKO_LOG    = "/wekolog/";
-
-
-    private $blockid = array();
+    
     /**
      * コンストラクタ
      */
-    public function __construct($session, $db,$blockid)
+    public function __construct($session, $db)
     {
         parent::__construct($session, $db);
-        $this->blockid = $blockid;
     }
     
     /**
@@ -100,7 +97,7 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
     private function outputParameter($request, $searchResult)
     {
         ///// request parameter string /////
-        $requesturl = BASE_URL;
+        $request_url = BASE_URL;
         if(substr($request_url, -1, 1)!="/"){
             $request_url .= "/";
         }
@@ -117,17 +114,20 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
         
         ///// feed title /////
         $feed_title = $repositoryName." OpenSearch";
-        if(strlen($request[self::REQUEST_WEKO_ID]) > 0)
-        {
-            $feed_title .= " - "."WEKOID : ".$request[self::REQUEST_WEKO_ID];
+        if(array_key_exists(parent::REQUEST_WEKO_ID, $request)) {
+            if(strlen($request[self::REQUEST_WEKO_ID]) > 0) {
+                $feed_title .= " - "."WEKOID : ".$request[parent::REQUEST_WEKO_ID];
+            }
         }
-        if(strlen($request[self::REQUEST_KEYWORD]) > 0)
-        {
-            $feed_title .= " : ".$request[self::REQUEST_KEYWORD];
+        if(array_key_exists(parent::REQUEST_KEYWORD, $request)) {
+            if(strlen($request[self::REQUEST_KEYWORD]) > 0) {
+                $feed_title .= " : ".$request[parent::REQUEST_KEYWORD];
+            }
         }
-        if(strlen($request[self::REQUEST_INDEX_ID]) > 0)
-        {
-            $feed_title .= " : ".$this->getIndexPath($request[self::REQUEST_INDEX_ID], ">");
+        if(array_key_exists(parent::REQUEST_INDEX_ID, $request)) {
+            if(strlen($request[self::REQUEST_INDEX_ID]) > 0) {
+                $feed_title .= " : ".$this->getIndexPath($request[parent::REQUEST_INDEX_ID], ">");
+            }
         }
         
         ///// search date /////
@@ -137,24 +137,24 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
         ///// output search request /////
         
         // feed title
-        $xml .= '   <title>'.$this->RepositoryAction->forXmlChange($feed_title).'</title>'.$LF;
+        $xml = '   <title>'.$this->RepositoryAction->forXmlChange($feed_title).'</title>'.parent::LF;
         
         // request url
-        $xml .= '   <link href="'.$this->RepositoryAction->forXmlChange($request_url).'" />'.$LF;
+        $xml .= '   <link href="'.$this->RepositoryAction->forXmlChange($request_url).'" />'.parent::LF;
         
         // request url
-        $xml .= '   <id>'.$this->RepositoryAction->forXmlChange($request_url).'</id>'.$LF;
+        $xml .= '   <id>'.$this->RepositoryAction->forXmlChange($request_url).'</id>'.parent::LF;
         
         // search date
-        $xml .= '   <updated>'.$this->RepositoryAction->forXmlChange($search_date).'</updated>'.$LF;
+        $xml .= '   <updated>'.$this->RepositoryAction->forXmlChange($search_date).'</updated>'.parent::LF;
         
         // search total
-        $xml .= '   <opensearch:totalResults>'.$this->total.'</opensearch:totalResults>'.$LF;
+        $xml .= '   <opensearch:totalResults>'.$this->total.'</opensearch:totalResults>'.parent::LF;
         if($this->total > 0){
             // start no
-            $xml .= '   <opensearch:startIndex>'.$this->startIndex.'</opensearch:startIndex>'.$LF;
+            $xml .= '   <opensearch:startIndex>'.$this->startIndex.'</opensearch:startIndex>'.parent::LF;
             // disp item num
-            $xml .= '   <opensearch:itemsPerPage>'.count($searchResult).'</opensearch:itemsPerPage>'.$LF.$LF;
+            $xml .= '   <opensearch:itemsPerPage>'.count($searchResult).'</opensearch:itemsPerPage>'.parent::LF.parent::LF;
         }
         
         return $xml;
@@ -186,7 +186,6 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
         {
             $itemData = array();
             $itemData = $this->getOutputData($request, $searchResult[$ii]["item_id"], $searchResult[$ii]["item_no"]);
-
             if(strlen($request[self::REQUEST_LOG_TERM]) > 0)
             {
                 // set log result
@@ -232,7 +231,7 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
             
             // mapping info
             $xml .= '       <prism:aggregationType>'.$this->RepositoryAction->forXmlChange($itemData[self::DATA_MAPPING_INFO]).'</prism:aggregationType>'.self::LF;
-
+            
             // item type name
             $xml .= '       <dc:type>'.$this->RepositoryAction->forXmlChange($itemData[self::DATA_ITEM_TYPE_NAME]).'</dc:type>'.self::LF;
             
@@ -246,17 +245,6 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
             for($jj=0; $jj<count($itemData[self::DATA_FILE_URI]); $jj++)
             {
                 $xml .= '       <dc:identifier>'.$this->RepositoryAction->forXmlChange("file_id:".$itemData[self::DATA_FILE_URI][$jj]).'</dc:identifier>'.self::LF;
-                //enclosure file link
-                //リダイレクト後のURLを作成する
-                $url = $itemData[self::DATA_FILE_URI][$jj];
-                $url = str_replace("/?","/index.php?",$url);
-                $url = str_replace("action=repository_uri","action=pages_view_main&active_action=repository_action_common_download",$url);
-                $url = str_replace("file_id","attribute_id",$url);
-                $url .= '&item_no='.$searchResult[0]['item_no'];
-                $url .= '&page_id='.$this->blockid['page_id'].'&block_id='.$this->blockid['block_id'];
-                
-                $xml .= '       <link rel="enclosure" title="'.$this->RepositoryAction->forXmlChange($itemData[self::DATA_FILE_NAME][$jj]).'" type="'.$this->RepositoryAction->forXmlChange($itemData[self::DATA_MIME_TYPE][$jj]).'" href="'.$this->RepositoryAction->forXmlChange($url).'" />'.self::LF;
-                
             }
             
             // creator
@@ -380,6 +368,19 @@ class Repository_OpenSearch_Atom extends Repository_Opensearch_FormatAbstract
                 $xml .= '       <prism:modificationDate>'.$this->RepositoryAction->forXmlChange($mod_date).'</prism:modificationDate>'.self::LF;
             }
             
+            // file pewview link
+            for ($jj = 0; $jj < count($itemData[self::DATA_URL]); $jj++)
+            {
+                $link = BASE_URL . "/index.php?action=repository_action_common_download&" . 
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_PREV . "=true";
+                
+                $xml .= '       <prism:url>'.$this->RepositoryAction->forXmlChange($link).'</prism:url>'.self::LF;
+            }
+            
             $xml .= '   </entry>'.self::LF.self::LF;
         }
         return $xml;
diff --git a/repository/opensearch/format/FormatAbstract.class.php b/repository/opensearch/format/FormatAbstract.class.php
index c0401eb..f3903fa 100644
--- a/repository/opensearch/format/FormatAbstract.class.php
+++ b/repository/opensearch/format/FormatAbstract.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: FormatAbstract.class.php 43084 2014-10-20 06:53:41Z yuko_nakao $
+// $Id: FormatAbstract.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,8 +12,8 @@
 // --------------------------------------------------------------------
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryOutputFilter.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatistics.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+require_once WEBAPP_DIR.'/modules/repository/components/FW/BusinessFactory.class.php';
 
 class Repository_Opensearch_FormatAbstract
 {
@@ -31,7 +31,6 @@ class Repository_Opensearch_FormatAbstract
     const DATA_ITEM_TYPE_NAME = "item_type_name";
     const DATA_MIME_TYPE = "mime_type";
     const DATA_FILE_URI = "file_uri";
-    const DATA_FILE_NAME = "file_name";
     const DATA_CREATOR = "creator";
     const DATA_PUBLISHER = "publisher";
     const DATA_INDEX_PATH = "index_path";
@@ -41,6 +40,7 @@ class Repository_Opensearch_FormatAbstract
     const DATA_ISSUE = "issue";
     const DATA_SPAGE = "spage";
     const DATA_EPAGE = "epage";
+    const DATA_URL = "url";
     const DATA_DATE_OF_ISSUED = "date_of_issued";
     const DATA_DESCRIPTION = "description";
     const DATA_PUB_DATE = "pub_date";
@@ -242,7 +242,7 @@ class Repository_Opensearch_FormatAbstract
                         self::DATA_ITEM_TYPE_NAME => "",
                         self::DATA_MIME_TYPE => array(),
                         self::DATA_FILE_URI => array(),
-                        self::DATA_FILE_NAME => array(),
+                        self::DATA_URL => array(),
                         self::DATA_CREATOR => array(),
                         self::DATA_CREATOR_LANG => array(),
                         self::DATA_PUBLISHER => array(),
@@ -337,7 +337,8 @@ class Repository_Opensearch_FormatAbstract
         $suffix = $this->repositoryHandleManager->getSuffix($itemId, $itemNo, RepositoryHandleManager::ID_Y_HANDLE);
         
         $wekoId = $suffix;
-        
+        $itemData[self::DATA_WEKO_ID] = $wekoId;
+
         ///// setting item type id /////
         $itemData[self::DATA_ITEM_TYPE_NAME] = $itemType[RepositoryConst::DBCOL_REPOSITORY_ITEM_TYPE_NAME];
         
@@ -366,13 +367,28 @@ class Repository_Opensearch_FormatAbstract
             
             for($jj=0; $jj<count($itemAttr[$ii]); $jj++)
             {
-               
-                /// set file information
-                if($inputType == RepositoryConst::ITEM_ATTR_TYPE_FILE)
+                // set file information
+                if ($inputType == RepositoryConst::ITEM_ATTR_TYPE_FILE) 
                 {
-                   
+                    // set file preview info
+                    $extension = $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_EXTENSION];
+                    $mimeType = $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_MIME_TYPE];
+                    $filePrevName = $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_PREV_NAME];
+                    $isImage = preg_match("/^image/", $mimeType);
+                    
+                    if (($extension == "pdf" || $mimeType == "application/pdf" || $isImage == 1) && $filePrevName != "") {
+                        $file = Array(
+                            RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID => $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID],
+                            RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO => $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO],
+                            RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID => $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID],
+                            RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO => $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO]
+                        ); 
+                        
+                        $itemData[self::DATA_URL][] = $file;
+                    }
+                    
                     // set file info
-                    if(is_array($itemData[self::DATA_MIME_TYPE]))
+                    if(strlen($itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_MIME_TYPE]) > 0)
                     {
                         array_push($itemData[self::DATA_MIME_TYPE], $itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_MIME_TYPE]);
                         $fileUri = BASE_URL."/?action=repository_uri".
@@ -380,11 +396,7 @@ class Repository_Opensearch_FormatAbstract
                                    "&file_id=".$itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID].
                                    "&file_no=".$itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO];
                         array_push($itemData[self::DATA_FILE_URI], $fileUri);
-                        
-                        array_push($itemData[self::DATA_FILE_NAME],$itemAttr[$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NAME]);
-
                     }
-
                 }
                 
                 /// check value
@@ -492,26 +504,12 @@ class Repository_Opensearch_FormatAbstract
         if(count($terms) == 2 && (int)$terms[0] != 0 && (int)$terms[1] != 0){
             $year = $terms[0];
             $month = $terms[1];
-            // ログ解析除外IPアドレス(log exception)
-            $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                     "WHERE param_name = 'log_exclusion'; ";
-            $ip_list = $this->Db->execute($query);
-            if(ip_list === false){
-                return false;
-            }
-            $log_exception = "";
-            $ip_list = str_replace("\r\n", "\n", $ip_list[0]["param_value"]);
-            $ip_list = str_replace("\r", "\n", $ip_list);
-            if($ip_list != ""){
-                $ip_list = explode("\n", $ip_list);
-                for($ii=0; $ii<count($ip_list); $ii++){
-                    $log_exception .= " AND ". DATABASE_PREFIX ."repository_log.ip_address <> '$ip_list[$ii]' ";
-                }
-            }
             
+            // ビジネスクラスを呼ぶ
             $transStartDate = $this->getNowDate();
+            BusinessFactory::initialize($this->Session, $this->Db, $transStartDate);
+            $usagestatistics = BusinessFactory::getFactory()->getBusiness("businessUsagestatistics");
             
-            $usagestatistics = new RepositoryUsagestatistics($this->Session, $this->Db, $transStartDate);
             for($ii=0; $ii<count($item_data); $ii++){
                 if($item_data[$ii]['item_id'] != "" && $item_data[$ii]['item_no'] != ""){
                     $item_data[$ii][self::DATA_WEKO_LOG_TERM] = $request[self::REQUEST_LOG_TERM];
diff --git a/repository/opensearch/format/Rss.class.php b/repository/opensearch/format/Rss.class.php
index 6860ab9..ec684ce 100644
--- a/repository/opensearch/format/Rss.class.php
+++ b/repository/opensearch/format/Rss.class.php
@@ -133,15 +133,15 @@ class Repository_OpenSearch_Rss extends Repository_Opensearch_FormatAbstract
         
         ///// feed title /////
         $feed_title = $repositoryName." OpenSearch";
-        if(strlen($request[self::REQUEST_WEKO_ID]) > 0)
+        if(isset($request[self::REQUEST_WEKO_ID]) && strlen($request[self::REQUEST_WEKO_ID]) > 0)
         {
             $feed_title .= " - "."WEKOID : ".$request[self::REQUEST_WEKO_ID];
         }
-        if(strlen($request[self::REQUEST_KEYWORD]) > 0)
+        if(isset($request[self::REQUEST_KEYWORD]) && strlen($request[self::REQUEST_KEYWORD]) > 0)
         {
             $feed_title .= " : ".$request[self::REQUEST_KEYWORD];
         }
-        if(strlen($request[self::REQUEST_INDEX_ID]) > 0)
+        if(isset($request[self::REQUEST_INDEX_ID]) && strlen($request[self::REQUEST_INDEX_ID]) > 0)
         {
             $feed_title .= " : ".$this->getIndexPath($request[self::REQUEST_INDEX_ID], "＞");
         }
@@ -386,8 +386,22 @@ class Repository_OpenSearch_Rss extends Repository_Opensearch_FormatAbstract
             $xml .= '       <prism:creationDate>'.$this->RepositoryAction->forXmlChange($insDate).'</prism:creationDate>'.self::LF; // 作成日
             
             // mod_date
+            $modDate = $this->RepositoryAction->changeDatetimeToW3C($itemData[self::DATA_MOD_DATE]);
             $xml .= '       <prism:modificationDate>'.$this->RepositoryAction->forXmlChange($modDate).'</prism:modificationDate>'.self::LF; // 更新日
             
+            // file pewview link
+            for ($jj = 0; $jj < count($itemData[self::DATA_URL]); $jj++)
+            {
+                $link = BASE_URL . "/index.php?action=repository_action_common_download&" . 
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_ID] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ITEM_NO] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_ATTRIBUTE_ID] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO . "=" . $itemData[self::DATA_URL][$jj][RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_NO] . "&" .
+                        RepositoryConst::DBCOL_REPOSITORY_FILE_FILE_PREV . "=true";
+                
+                $xml .= '       <prism:url>'.$this->RepositoryAction->forXmlChange($link).'</prism:url>'.self::LF;
+            }
+            
             $xml .= '   </item>'.self::LF.self::LF;
         }
         
diff --git a/repository/rss/Rss.class.php b/repository/rss/Rss.class.php
index 046909e..dabcd24 100644
--- a/repository/rss/Rss.class.php
+++ b/repository/rss/Rss.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Rss.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Rss.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/sitemap/Sitemap.class.php b/repository/sitemap/Sitemap.class.php
index 6b4e83d..9e82d4c 100644
--- a/repository/sitemap/Sitemap.class.php
+++ b/repository/sitemap/Sitemap.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Sitemap.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Sitemap.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/sql/mysql/table.sql b/repository/sql/mysql/table.sql
index c441a8e..bba7de6 100644
--- a/repository/sql/mysql/table.sql
+++ b/repository/sql/mysql/table.sql
@@ -4,23 +4,23 @@ CREATE TABLE `repository_item` (
     `revision_no` INT NOT NULL,
     `item_type_id` INT NOT NULL,
     `prev_revision_no` INT NOT NULL,
-    `title` TEXT default "",
-	`title_english` TEXT default "",
+    `title` TEXT NOT NULL,
+    `title_english` TEXT NOT NULL,
     `language` TEXT NOT NULL,
-    `review_status` VARCHAR(2) NOT NULL default 0,
+    `review_status` VARCHAR(2) NOT NULL default "0",
     `review_date` VARCHAR(23),
     `shown_status` INT(1) NOT NULL default 0,
     `shown_date` VARCHAR(23),
     `reject_status` INT(1) NOT NULL default 0,
     `reject_date` VARCHAR(23),
-    `reject_reason` TEXT default "",
-    `serch_key` TEXT default "",
-	`serch_key_english` TEXT default "",
-    `remark` TEXT default "",
-    `uri` TEXT default "",
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `reject_reason` TEXT NOT NULL,
+    `serch_key` TEXT NOT NULL,
+    `serch_key_english` TEXT NOT NULL,
+    `remark` TEXT NOT NULL,
+    `uri` TEXT NOT NULL,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -34,16 +34,16 @@ CREATE TABLE `repository_item` (
 CREATE TABLE `repository_item_type` (
     `item_type_id` INT,
     `item_type_name` TEXT NOT NULL,
-    `item_type_short_name` TEXT default "",
-    `explanation` TEXT default "",
+    `item_type_short_name` TEXT NOT NULL,
+    `explanation` TEXT NOT NULL,
     `mapping_info` TEXT,
     `icon_name` TEXT NULL,
     `icon_mime_type` TEXT NULL,
     `icon_extension` TEXT NULL,
     `icon` LONGBLOB,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -65,12 +65,12 @@ CREATE TABLE `repository_item_attr_type` (
     `hidden` INT(1) NOT NULL,
     `junii2_mapping` TEXT NOT NULL,
     `dublin_core_mapping` TEXT NOT NULL,
-    `lom_mapping` TEXT NOT NULL default '',
-    `lido_mapping` TEXT NOT NULL default '',
+    `lom_mapping` TEXT NOT NULL,
+    `lido_mapping` TEXT NOT NULL,
     `display_lang_type` TEXT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -84,9 +84,9 @@ CREATE TABLE `repository_item_attr_candidate` (
     `candidate_no` INT,
     `candidate_value` TEXT NOT NULL,
     `candidate_short_value` TEXT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -101,9 +101,9 @@ CREATE TABLE `repository_item_attr` (
     `attribute_no` INT,
     `attribute_value` TEXT NOT NULL,
     `item_type_id` INT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -117,9 +117,9 @@ CREATE TABLE `repository_position_index` (
     `item_no` INT,
     `index_id` INT,
     `custom_sort_order` INT NOT NULL default 0,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -130,25 +130,25 @@ CREATE TABLE `repository_position_index` (
 ) ENGINE=innodb ;
 CREATE TABLE `repository_index` (
     `index_id` INT,
-    `index_name` TEXT NOT NULL default "",
-    `index_name_english` TEXT NOT NULL default "",
+    `index_name` TEXT NOT NULL,
+    `index_name_english` TEXT NOT NULL,
     `parent_index_id` INT NOT NULL,
     `contents` INT NOT NULL default 0,
     `private_contents` INT NOT NULL default 0,
     `show_order` INT NOT NULL,
     `public_state` INT(1) NOT NULL default 0,
     `pub_date` VARCHAR(23) NOT NULL,
-    `access_role` TEXT NOT NULL default "",
-    `access_group` TEXT NOT NULL default "",
-    `exclusive_acl_role` TEXT NOT NULL default "",
-    `exclusive_acl_group` TEXT NOT NULL default "",
-    `comment` TEXT NOT NULL default "",
-    `display_more` TEXT NOT NULL default "",
+    `access_role` TEXT NOT NULL,
+    `access_group` TEXT NOT NULL,
+    `exclusive_acl_role` TEXT NOT NULL,
+    `exclusive_acl_group` TEXT NOT NULL,
+    `comment` TEXT NOT NULL,
+    `display_more` TEXT NOT NULL,
     `display_type` INT default 0,
     `rss_display` INT NOT NULL default 0,
     `select_index_list_display` INT(1) default 0,
-    `select_index_list_name` TEXT NOT NULL default "",
-    `select_index_list_name_english` TEXT NOT NULL default "",
+    `select_index_list_name` TEXT NOT NULL,
+    `select_index_list_name_english` TEXT NOT NULL,
     `thumbnail` LONGBLOB NOT NULL,
     `thumbnail_name` TEXT NOT NULL,
     `thumbnail_mime_type` TEXT NOT NULL,
@@ -159,9 +159,9 @@ CREATE TABLE `repository_index` (
     `owner_user_id` VARCHAR(40) NOT NULL default "",
     `biblio_flag` INT(1) NOT NULL default 0,
     `online_issn` VARCHAR(9) default "",
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -179,7 +179,7 @@ CREATE TABLE `repository_file` (
     `attribute_id` INT,
     `file_no` INT,
     `file_name` TEXT NOT NULL,
-    `display_name` TEXT default "",
+    `display_name` TEXT NOT NULL,
     `display_type` INT NOT NULL default 0,
     `show_order` INT,
     `mime_type` TEXT NOT NULL,
@@ -194,9 +194,9 @@ CREATE TABLE `repository_file` (
     `item_type_id` INT NOT NULL,
     `browsing_flag` INT NOT NULL default 0,
     `cover_created_flag` INT NOT NULL default 0,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -215,9 +215,9 @@ CREATE TABLE `repository_attached_file` (
     `mime_type` TEXT NOT NULL,
     `extension` TEXT NOT NULL,
     `attached_file` LONGBLOB,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -231,9 +231,9 @@ CREATE TABLE `repository_license_master` (
     `license_notation` TEXT NOT NULL,
     `img_url` TEXT NOT NULL,
     `text_url` TEXT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -251,9 +251,9 @@ CREATE TABLE `repository_thumbnail` (
     `extension` TEXT NOT NULL,
     `file` LONGBLOB,
     `item_type_id` INT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -271,12 +271,12 @@ CREATE TABLE `repository_personal_name` (
     `name` TEXT NOT NULL,
     `family_ruby` TEXT NOT NULL,
     `name_ruby` TEXT NOT NULL,
-    `e_mail_address` TEXT default "",
+    `e_mail_address` TEXT NOT NULL,
     `item_type_id` INT NOT NULL,
     `author_id` INT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -290,10 +290,10 @@ CREATE TABLE `repository_reference` (
     `org_reference_item_no` INT,
     `dest_reference_item_id` INT,
     `dest_reference_item_no` INT,
-    `reference` TEXT default "",
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `reference` TEXT NOT NULL,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -304,11 +304,11 @@ CREATE TABLE `repository_reference` (
 ) ENGINE=innodb ;
 CREATE TABLE `repository_parameter` (
     `param_name` TEXT(255),
-    `param_value` TEXT default "",
-    `explanation` TEXT default "",
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `param_value` TEXT NOT NULL,
+    `explanation` TEXT NOT NULL,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -318,37 +318,39 @@ CREATE TABLE `repository_parameter` (
 CREATE TABLE `repository_log` (
     `log_no` INT,
     `record_date` VARCHAR(23) NOT NULL,
-    `user_id` VARCHAR(40) NOT NULL default 0 NOT NULL,
+    `user_id` VARCHAR(40) NOT NULL default "0",
     `operation_id` INT NOT NULL,
     `item_id` INT default NULL,
     `item_no` INT default NULL,
     `attribute_id` INT default NULL,
     `file_no` INT default NULL,
-    `search_keyword` TEXT default NULL,
-    `ip_address` TEXT default '',
+    `search_keyword` TEXT NOT NULL,
+    `ip_address` TEXT NOT NULL,
     `numeric_ip_address` BIGINT NOT NULL default -1,
-    `host` TEXT default '',
-    `user_agent` TEXT default '',
-    `referer` TEXT NOT NULL default '',
+    `host` TEXT NOT NULL,
+    `user_agent` TEXT NOT NULL,
+    `referer` TEXT NOT NULL,
     `file_status` INT(2) default 0,
     `site_license` INT(2) default NULL,
+    `site_license_id` INT(11) default 0,
     `input_type` INT(2) default NULL,
     `login_status` INT(2) default NULL,
     `group_id` INT(11) default NULL,
     PRIMARY KEY(`log_no`),
+    INDEX `record_date`(`record_date`),
     KEY `user_id` (`user_id`),
     KEY `item_id` (`item_id`, `item_no`, `attribute_id`, `file_no`)
 ) ENGINE=MyISAM;
-CREATE TABLE repository_element_cd (
-	id integer not null,
-	seq integer not null,
-	data text not null,
-	minoccurs integer not null,
-	maxoccurs integer not null,
-	shoshiki text,
-	oai_dc_element text not null,
-	oai_dc_qualifier text,
-	oai_dc_option text,
+CREATE TABLE `repository_element_cd` (
+    id integer not null,
+    seq integer not null,
+    data text not null,
+    minoccurs integer not null,
+    maxoccurs integer not null,
+    shoshiki text,
+    oai_dc_element text not null,
+    oai_dc_qualifier text,
+    oai_dc_option text,
   PRIMARY KEY (id)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_biblio_info` (
@@ -357,16 +359,16 @@ CREATE TABLE `repository_biblio_info` (
     `attribute_id` INT,
     `biblio_no` INT,
     `biblio_name` TEXT,
-	`biblio_name_english` TEXT,
+    `biblio_name_english` TEXT,
     `volume` TEXT,
     `issue` TEXT,
     `start_page` TEXT,
     `end_page` TEXT,
     `date_of_issued` TEXT,
     `item_type_id` INT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -381,9 +383,9 @@ CREATE TABLE `repository_file_price` (
     `attribute_id` INT,
     `file_no` INT,
     `price` TEXT,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -396,7 +398,7 @@ CREATE TABLE `repository_ranking` (
     `rank_type` TEXT(255),
     `rank` INT,
     `disp_name` TEXT,
-	`disp_name_english` TEXT,
+    `disp_name_english` TEXT,
     `disp_value` TEXT,
     `item_id` INT,
     `item_no` INT,
@@ -412,22 +414,22 @@ CREATE TABLE `repository_supple` (
     `item_no` INT,
     `attribute_id` INT,
     `supple_no` INT,
-	`item_type_id` INT,
-	`supple_weko_item_id` INT,
+    `item_type_id` INT,
+    `supple_weko_item_id` INT,
     `supple_title` TEXT,
-	`supple_title_en` TEXT,
-    `uri` TEXT default "",
+    `supple_title_en` TEXT,
+    `uri` TEXT NOT NULL,
     `supple_item_type_name` TEXT,
     `mime_type` TEXT,
-	`file_id` INT,
-	`supple_review_status` INT(1) NOT NULL default 0,
-	`supple_review_date` VARCHAR(23),
-	`supple_reject_status` INT(1) NOT NULL default 0,
-	`supple_reject_date` VARCHAR(23),
-	`supple_reject_reason` TEXT,
-	`ins_user_id` VARCHAR(40) NOT NULL default 0,
-	`mod_user_id` VARCHAR(40) NOT NULL default 0,
-	`del_user_id` VARCHAR(40) NOT NULL default 0,
+    `file_id` INT,
+    `supple_review_status` INT(1) NOT NULL default 0,
+    `supple_review_date` VARCHAR(23),
+    `supple_reject_status` INT(1) NOT NULL default 0,
+    `supple_reject_date` VARCHAR(23),
+    `supple_reject_reason` TEXT,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -437,17 +439,17 @@ CREATE TABLE `repository_supple` (
     KEY `attribute_id` (`attribute_id`, `item_type_id`)
 ) ENGINE=innodb ;
 CREATE TABLE `repository_users` (
-	`user_id` varchar(40),
-	`contents_mail_flg` INT NOT NULL default 0,
-	`supple_mail_flg` INT NOT NULL default 0,
-	`ins_user_id` VARCHAR(40) NOT NULL default 0,
-	`mod_user_id` VARCHAR(40) NOT NULL default 0,
-	`del_user_id` VARCHAR(40) NOT NULL default 0,
-	`ins_date` VARCHAR(23),
-	`mod_date` VARCHAR(23),
-	`del_date` VARCHAR(23),
-	`is_delete` INT(1),
-	PRIMARY KEY(`user_id`)
+    `user_id` varchar(40),
+    `contents_mail_flg` INT NOT NULL default 0,
+    `supple_mail_flg` INT NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
+    `ins_date` VARCHAR(23),
+    `mod_date` VARCHAR(23),
+    `del_date` VARCHAR(23),
+    `is_delete` INT(1),
+    PRIMARY KEY(`user_id`)
 ) ENGINE=innodb;
 CREATE TABLE `repository_name_authority` (
     `author_id` INT NOT NULL,
@@ -456,9 +458,9 @@ CREATE TABLE `repository_name_authority` (
     `name` VARCHAR(255),
     `family_ruby` VARCHAR(255),
     `name_ruby` VARCHAR(255),
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -470,9 +472,9 @@ CREATE TABLE `repository_external_author_id_prefix` (
     `prefix_name` VARCHAR(255),
     `block_id` INT NOT NULL,
     `room_id` INT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -483,9 +485,9 @@ CREATE TABLE `repository_external_author_id_suffix` (
     `author_id` INT NOT NULL,
     `prefix_id` INT NOT NULL,
     `suffix` VARCHAR(255),
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -503,9 +505,9 @@ CREATE TABLE `repository_harvesting` (
     `post_index_id` INT,
     `automatic_sorting` INT,
     `execution_date` VARCHAR(20) default NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -528,19 +530,19 @@ CREATE TABLE `repository_harvesting_log` (
     `error_msg` TEXT,
     `response_date` VARCHAR(23),
     `last_mod_date` VARCHAR(23),
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     PRIMARY KEY(`log_id`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_pdf_cover_parameter` (
     `param_name` TEXT(255),
-    `text` TEXT default "",
+    `text` TEXT NOT NULL,
     `image` LONGBLOB NOT NULL,
     `extension` TEXT NOT NULL,
     `mimetype` TEXT NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -555,7 +557,7 @@ CREATE TABLE `repository_usagestatistics` (
     `operation_id` INT NOT NULL,
     `domain` VARCHAR(255) default '',
     `cnt` INT default 0 NOT NULL,
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     PRIMARY KEY(`record_date`, `item_id`, `item_no`, `attribute_id`, `file_no`, `operation_id`, `domain`)
 ) ENGINE=MyISAM;
@@ -564,10 +566,10 @@ CREATE TABLE `repository_item_type_name_multilanguage` (
     `item_type_id` INT NOT NULL default 0,
     `attribute_id` INT NOT NULL default 0,
     `language` VARCHAR(64) NOT NULL default "",
-    `item_type_name` TEXT NOT NULL default "",
-    `ins_user_id` VARCHAR(40) NOT NULL default 0,
-    `mod_user_id` VARCHAR(40) NOT NULL default 0,
-    `del_user_id` VARCHAR(40) NOT NULL default 0,
+    `item_type_name` TEXT NOT NULL,
+    `ins_user_id` VARCHAR(40) NOT NULL default "0",
+    `mod_user_id` VARCHAR(40) NOT NULL default "0",
+    `del_user_id` VARCHAR(40) NOT NULL default "0",
     `ins_date` VARCHAR(23),
     `mod_date` VARCHAR(23),
     `del_date` VARCHAR(23),
@@ -575,39 +577,39 @@ CREATE TABLE `repository_item_type_name_multilanguage` (
     PRIMARY KEY(`item_type_id`, `attribute_id`, `language`)
 ) ENGINE=innodb ;
 CREATE TABLE `repository_send_feedbackmail_author_id` (
-  `item_id` int(11) NOT NULL default '0',
-  `item_no` int(11) NOT NULL default '0',
-  `author_id_no` int(11) NOT NULL default '0',
-  `author_id` int(11) NOT NULL default '0',
+  `item_id` int(11) NOT NULL default 0,
+  `item_no` int(11) NOT NULL default 0,
+  `author_id_no` int(11) NOT NULL default 0,
+  `author_id` int(11) NOT NULL default 0,
   PRIMARY KEY  (`item_id`,`item_no`,`author_id_no`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_update_item` (
-  `item_id` int(11) NOT NULL default '0',
-  `item_no` int(11) NOT NULL default '0',
+  `item_id` int(11) NOT NULL default 0,
+  `item_no` int(11) NOT NULL default 0,
   PRIMARY KEY  (`item_id`,`item_no`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_lock` (
   `process_name` varchar(60) NOT NULL default '',
-  `status` int NOT NULL default '0',
-  `comment` text NOT NULL default '',
+  `status` int NOT NULL default 0,
+  `comment` TEXT NOT NULL,
   PRIMARY KEY (`process_name`)
 ) ENGINE=InnoDB;
 CREATE TABLE `repository_search_item_setup` (
-  `type_id` int NOT NULL default '0',
-  `search_type` text NOT NULL default '',
-  `use_search` int(1) NOT NULL default '0',
-  `default_show` int(1) NOT NULL default '0',
-  `junii2_mapping` text NOT NULL default '',
+  `type_id` int NOT NULL default 0,
+  `search_type` TEXT NOT NULL,
+  `use_search` int(1) NOT NULL default 0,
+  `default_show` int(1) NOT NULL default 0,
+  `junii2_mapping` TEXT NOT NULL,
   PRIMARY KEY (`type_id`)
 ) ENGINE=InnoDB;
 CREATE TABLE `repository_search_sort` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `item_type_id` int NOT NULL default '0',
-  `weko_id` varchar(9) NOT NULL default '0',
-  `title` text NOT NULL default '',
-  `title_en` text NOT NULL default '',
-  `uri` text NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `item_type_id` int NOT NULL default 0,
+  `weko_id` varchar(9) NOT NULL default "0",
+  `title` TEXT NOT NULL,
+  `title_en` TEXT NOT NULL,
+  `uri` TEXT NOT NULL,
   `review_date` varchar(23) NOT NULL default '',
   `ins_user_id` varchar(40) NOT NULL default '',
   `mod_date` varchar(23) NOT NULL default '',
@@ -625,334 +627,334 @@ CREATE TABLE `repository_search_sort` (
   INDEX `bibdate_itemid` (`biblio_date`, `item_id`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_allmetadata` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_filedata` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_title` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_author` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_keyword` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_niisubject` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_ndc` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_ndlc` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_bsh` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_ndlsh` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_mesh` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_ddc` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_lcc` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_udc` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_lcsh` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_description` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_publisher` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_contributor` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_type` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_format` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_identifier` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_uri` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_fulltexturl` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_selfdoi` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_isbn` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_issn` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_ncid` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_pmid` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_doi` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_naid` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_ichushi` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_jtitle` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_language` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_relation` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_coverage` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_rights` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_textversion` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_grantid` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_degreename` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_grantor` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_external_searchword` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `metadata` longtext NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `metadata` longtext NOT NULL,
   PRIMARY KEY  (`item_id`,`item_no`),
   FULLTEXT KEY `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_date` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `data_no` int NOT NULL default '0',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `data_no` int NOT NULL default 0,
   `metadata` varchar(23) NOT NULL default '',
   PRIMARY KEY  (`item_id`,`item_no`,`data_no`),
   INDEX `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_dateofissued` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `data_no` int NOT NULL default '0',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `data_no` int NOT NULL default 0,
   `metadata` varchar(23) NOT NULL default '',
   PRIMARY KEY  (`item_id`,`item_no`,`data_no`),
   INDEX `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_dateofgranted` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `data_no` int NOT NULL default '0',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `data_no` int NOT NULL default 0,
   `metadata` varchar(23) NOT NULL default '',
   PRIMARY KEY  (`item_id`,`item_no`,`data_no`),
   INDEX `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_search_dateofissued_ymd` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `data_no` int NOT NULL default '0',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `data_no` int NOT NULL default 0,
   `metadata` varchar(23) NOT NULL default '',
   PRIMARY KEY  (`item_id`,`item_no`,`data_no`),
   INDEX `metadata` (`metadata`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_index_browsing_authority` (
-  `index_id` int NOT NULL default '0',
-  `exclusive_acl_role_id` int NOT NULL default '0',
-  `exclusive_acl_room_auth` int NOT NULL default '0',
+  `index_id` int NOT NULL default 0,
+  `exclusive_acl_role_id` int NOT NULL default 0,
+  `exclusive_acl_room_auth` int NOT NULL default 0,
   `public_state` INT(1) NOT NULL default 0,
   `pub_date` VARCHAR(23) NOT NULL,
   `harvest_public_state` INT(1) NOT NULL default 1,
-  `ins_user_id` VARCHAR(40) NOT NULL default 0,
-  `mod_user_id` VARCHAR(40) NOT NULL default 0,
-  `del_user_id` VARCHAR(40) NOT NULL default 0,
+  `ins_user_id` VARCHAR(40) NOT NULL default "0",
+  `mod_user_id` VARCHAR(40) NOT NULL default "0",
+  `del_user_id` VARCHAR(40) NOT NULL default "0",
   `ins_date` VARCHAR(23),
   `mod_date` VARCHAR(23),
   `del_date` VARCHAR(23),
@@ -962,11 +964,11 @@ CREATE TABLE `repository_index_browsing_authority` (
   INDEX `index_public_state` (`public_state`, `pub_date`, `is_delete`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_index_browsing_groups` (
-  `index_id` int NOT NULL default '0',
-  `exclusive_acl_group_id` int NOT NULL default '0',
-  `ins_user_id` VARCHAR(40) NOT NULL default 0,
-  `mod_user_id` VARCHAR(40) NOT NULL default 0,
-  `del_user_id` VARCHAR(40) NOT NULL default 0,
+  `index_id` int NOT NULL default 0,
+  `exclusive_acl_group_id` int NOT NULL default 0,
+  `ins_user_id` VARCHAR(40) NOT NULL default "0",
+  `mod_user_id` VARCHAR(40) NOT NULL default "0",
+  `del_user_id` VARCHAR(40) NOT NULL default "0",
   `ins_date` VARCHAR(23),
   `mod_date` VARCHAR(23),
   `del_date` VARCHAR(23),
@@ -974,9 +976,9 @@ CREATE TABLE `repository_index_browsing_groups` (
   PRIMARY KEY  (`index_id`, `exclusive_acl_group_id`)
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_prefix` (
-  `id` int NOT NULL default '0',
-  `prefix_name` text NOT NULL default '',
-  `prefix_id` text NOT NULL default '',
+  `id` int NOT NULL default 0,
+  `prefix_name` TEXT NOT NULL,
+  `prefix_id` TEXT NOT NULL,
   `ins_user_id` VARCHAR(40) NOT NULL default '',
   `mod_user_id` VARCHAR(40) NOT NULL default '',
   `del_user_id` VARCHAR(40) NOT NULL default '',
@@ -987,10 +989,10 @@ CREATE TABLE `repository_prefix` (
   PRIMARY KEY  (`id`)
 ) ENGINE=innodb;
 CREATE TABLE `repository_suffix` (
-  `item_id` int NOT NULL default '0',
-  `item_no` int NOT NULL default '0',
-  `id` int NOT NULL default '0',
-  `suffix` text NOT NULL default '',
+  `item_id` int NOT NULL default 0,
+  `item_no` int NOT NULL default 0,
+  `id` int NOT NULL default 0,
+  `suffix` TEXT NOT NULL,
   `ins_user_id` VARCHAR(40) NOT NULL default '',
   `mod_user_id` VARCHAR(40) NOT NULL default '',
   `del_user_id` VARCHAR(40) NOT NULL default '',
@@ -1001,25 +1003,23 @@ CREATE TABLE `repository_suffix` (
   PRIMARY KEY  (`item_id`, `item_no`, `id`)
 ) ENGINE=innodb;
 CREATE TABLE `repository_filecleanup_deleted_file` ( 
-  `item_id` int(11) NOT NULL default '0',
-  `attribute_id` int(11) NOT NULL default '0',
-  `file_no` int(11) NOT NULL default '0',
+  `item_id` int(11) NOT NULL default 0,
+  `attribute_id` int(11) NOT NULL default 0,
+  `file_no` int(11) NOT NULL default 0,
   `extension` TEXT NOT NULL,
   PRIMARY KEY (`item_id`,`attribute_id`,`file_no`) 
 ) ENGINE=MyISAM; 
 CREATE TABLE `repository_send_mail_sitelicense` (
-  `no` int NOT NULL default '0',
-  `organization_name` TEXT NOT NULL default '',
-  `start_ip_address` BIGINT default 0,
-  `finish_ip_address` BIGINT default 0,
-  `mail_address` TEXT NOT NULL default '',
+  `no` int NOT NULL default 0,
+  `organization_name` TEXT NOT NULL,
+  `mail_address` TEXT NOT NULL,
   PRIMARY KEY (`no`)
 ) ENGINE=innodb;
 CREATE TABLE `repository_issn` (
-  `issn` VARCHAR(9) NOT NULL default '',
-  `jtitle` TEXT NOT NULL default '',
-  `jtitle_en` TEXT NOT NULL default '',
-  `set_spec` TEXT NOT NULL default '',
+  `issn` VARCHAR(9) NOT NULL,
+  `jtitle` TEXT NOT NULL,
+  `jtitle_en` TEXT NOT NULL,
+  `set_spec` TEXT NOT NULL,
   `ins_user_id` VARCHAR(40) NOT NULL default '0',
   `mod_user_id` VARCHAR(40) NOT NULL default '0',
   `del_user_id` VARCHAR(40) NOT NULL default '0',
@@ -1045,10 +1045,10 @@ CREATE TABLE `repository_item_external_searchword` (
 ) ENGINE=MyISAM;
 CREATE TABLE `repository_external_searchengine_analyticalrule` (
   `engine_id` int NOT NULL default 0,
-  `engine_name` TEXT NOT NULL default '',
-  `domain` TEXT NOT NULL default '',
-  `search_word` TEXT NOT NULL default '',
-  `delimiter` TEXT NOT NULL default '',
+  `engine_name` TEXT NOT NULL,
+  `domain` TEXT NOT NULL,
+  `search_word` TEXT NOT NULL,
+  `delimiter` TEXT NOT NULL,
   `ins_user_id` VARCHAR(40) NOT NULL default '0',
   `mod_user_id` VARCHAR(40) NOT NULL default '0',
   `del_user_id` VARCHAR(40) NOT NULL default '0',
@@ -1083,6 +1083,151 @@ CREATE TABLE `repository_doi_status` (
   `is_delete` INT(1),
    PRIMARY KEY(`item_id`, `item_no`)
 ) ENGINE=innodb;
+CREATE TABLE `repository_item_type_exclusive_base_auth` (
+  `item_type_id` int NOT NULL default 0,
+  `exclusive_base_auth_id` int NOT NULL default 0,
+  `ins_user_id` VARCHAR(40) NOT NULL default '0',
+  `mod_user_id` VARCHAR(40) NOT NULL default '0',
+  `del_user_id` VARCHAR(40) NOT NULL default '0',
+  `ins_date` VARCHAR(23),
+  `mod_date` VARCHAR(23),
+  `del_date` VARCHAR(23),
+  `is_delete` INT(1),
+   PRIMARY KEY(`item_type_id`, `exclusive_base_auth_id`)
+) ENGINE=innodb;
+CREATE TABLE `repository_item_type_exclusive_room_auth` (
+  `item_type_id` int NOT NULL default 0,
+  `exclusive_room_auth_id` int NOT NULL default 0,
+  `ins_user_id` VARCHAR(40) NOT NULL default '0',
+  `mod_user_id` VARCHAR(40) NOT NULL default '0',
+  `del_user_id` VARCHAR(40) NOT NULL default '0',
+  `ins_date` VARCHAR(23),
+  `mod_date` VARCHAR(23),
+  `del_date` VARCHAR(23),
+  `is_delete` INT(1),
+   PRIMARY KEY(`item_type_id`)
+) ENGINE=innodb;
+CREATE TABLE `repository_sitelicense_info` (
+  `organization_id` INT(11) NOT NULL default 0,
+  `show_order` INT default 0,
+  `organization_name` TEXT NOT NULL,
+  `group_name` TEXT NOT NULL,
+  `mail_address` VARCHAR(255) NOT NULL default '',
+  `ins_user_id` VARCHAR(40) NOT NULL default '0',
+  `mod_user_id` VARCHAR(40) NOT NULL default '0',
+  `del_user_id` VARCHAR(40) NOT NULL default '0',
+  `ins_date` VARCHAR(23),
+  `mod_date` VARCHAR(23),
+  `del_date` VARCHAR(23),
+  `is_delete` INT(1),
+   PRIMARY KEY(`organization_id`)
+) ENGINE=innodb;
+CREATE TABLE `repository_sitelicense_ip_address` (
+  `organization_id` INT(11) NOT NULL default 0,
+  `organization_no` INT(11) NOT NULL default 0,
+  `start_ip_address` VARCHAR(16) NOT NULL default '',
+  `finish_ip_address` VARCHAR(16) NOT NULL default '',
+  `ins_user_id` VARCHAR(40) NOT NULL default '0',
+  `mod_user_id` VARCHAR(40) NOT NULL default '0',
+  `del_user_id` VARCHAR(40) NOT NULL default '0',
+  `ins_date` VARCHAR(23),
+  `mod_date` VARCHAR(23),
+  `del_date` VARCHAR(23),
+  `is_delete` INT(1),
+   PRIMARY KEY(`organization_id`, `organization_no`)
+) ENGINE=innodb;
+CREATE TABLE `repository_doi_flag` (
+  `doi_flag_id` INT NOT NULL,
+  `nii_type` TEXT NOT NULL,
+  `jalc` INT(2) NOT NULL default 0,
+  `multiple_resolution` INT(2) NOT NULL default 0,
+  `crossref` INT(2) NOT NULL default 0,
+  `datacite` INT(2) NOT NULL default 0,
+  `ins_user_id` VARCHAR(40) NOT NULL default '0',
+  `mod_user_id` VARCHAR(40) NOT NULL default '0',
+  `del_user_id` VARCHAR(40) NOT NULL default '0',
+  `ins_date` VARCHAR(23),
+  `mod_date` VARCHAR(23),
+  `del_date` VARCHAR(23),
+  `is_delete` INT(1),
+   PRIMARY KEY(`doi_flag_id`)
+) ENGINE=innodb;
+CREATE TABLE `repository_operation_log` (
+    `log_id` INT,
+    `record_date` VARCHAR(23) NOT NULL,
+    `user_id` VARCHAR(40) NOT NULL default 0,
+    `request_parameter` TEXT,
+    `start_log_id` INT default 0,
+    PRIMARY KEY(`log_id`)
+) ENGINE=MyISAM;
+CREATE TABLE `repository_log_elapsed_time` (
+    `log_no` INT, 
+    `elapsed_time` INT, 
+    `ins_user_id` VARCHAR(40) NOT NULL default '0',
+    `mod_user_id` VARCHAR(40) NOT NULL default '0',
+    `del_user_id` VARCHAR(40) NOT NULL default '0',
+    `ins_date` VARCHAR(23),
+    `mod_date` VARCHAR(23),
+    `del_date` VARCHAR(23),
+    `is_delete` INT(1),
+    PRIMARY KEY(`log_no`)
+) ENGINE=MyISAM;
+CREATE TABLE `repository_robotlist_master` (
+  `robotlist_id` int(4) NOT NULL,
+  `robotlist_url` text NOT NULL,
+  `is_robotlist_use` int(1) NOT NULL default 0,
+  `del_column` varchar(40) NOT NULL,
+  `robotlist_version` varchar(40) NOT NULL,
+  `robotlist_date` varchar(100) NOT NULL,
+  `robotlist_revision` varchar(40) NOT NULL,
+  `robotlist_author` varchar(100) NOT NULL,
+  `ins_user_id` varchar(40) NOT NULL default '0',
+  `mod_user_id` varchar(40) NOT NULL default '0',
+  `del_user_id` varchar(40) NOT NULL default '0',
+  `ins_date` varchar(23),
+  `mod_date` varchar(23),
+  `del_date` varchar(23),
+  `is_delete` int(1),
+  PRIMARY KEY  (`robotlist_id`)
+) ENGINE=InnoDb DEFAULT CHARSET=utf8;
+CREATE TABLE `repository_robotlist_data` (
+  `list_id` int(10) NOT NULL AUTO_INCREMENT,
+  `robotlist_id` int(4) NOT NULL,
+  `word` text NOT NULL,
+  `status` varchar(2) NOT NULL default '0',
+  `ins_user_id` varchar(40) NOT NULL default '0',
+  `mod_user_id` varchar(40) NOT NULL default '0',
+  `del_user_id` varchar(40) NOT NULL default '0',
+  `ins_date` varchar(23),
+  `mod_date` varchar(23),
+  `del_date` varchar(23),
+  `is_delete` int(1),
+  PRIMARY KEY  (`list_id`)
+) ENGINE=InnoDb DEFAULT CHARSET=utf8;
+CREATE TABLE `repository_log_detail_search` (
+  `log_no` INT NOT NULL,
+  `advanced_search_id` INT(2) NOT NULL,
+  `ins_user_id` varchar(40) NOT NULL default 0,
+  `mod_user_id` varchar(40) NOT NULL default 0,
+  `del_user_id` varchar(40) NOT NULL default 0,
+  `ins_date` varchar(23),
+  `mod_date` varchar(23),
+  `del_date` varchar(23),
+  `is_delete` INT(1),
+  PRIMARY KEY  (`log_no`,`advanced_search_id`)
+) ENGINE=MyISAM;
+CREATE TABLE `repository_target_search_item` (
+  `search_item_id` INT(2) NOT NULL,
+  `ranking_flag` INT NOT NULL,
+  `ins_user_id` varchar(40) NOT NULL default 0,
+  `mod_user_id` varchar(40) NOT NULL default 0,
+  `del_user_id` varchar(40) NOT NULL default 0,
+  `ins_date` varchar(23),
+  `mod_date` varchar(23),
+  `del_date` varchar(23),
+  `is_delete` INT(1),
+  PRIMARY KEY  (`search_item_id`)
+) ENGINE=InnoDb;
 INSERT INTO `repository_external_author_id_prefix_seq_id` VALUE ('3');
 INSERT INTO `repository_external_author_id_prefix` (`prefix_id`, `prefix_name`, `block_id`, `room_id`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
     (1, 'CiNii ID', 0, 0, '1', '1', '0', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0),
@@ -1091,1612 +1236,1602 @@ INSERT INTO `repository_external_author_id_prefix` (`prefix_id`, `prefix_name`,
     (0, 'e_mail_address', 0, 0, '1', '1', '0', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0);
 
 INSERT INTO repository_element_cd VALUE
-	('10','1','title','1','1','','title','','lang'),
-	('20','2','alternative','0','0','','title','','lang'),
-	('30','3','creator','-1','0','','creator','','lang'),
-	('40','4','subject','0','0','','subject','',''),
-	('50','5','NIIsubject','0','0','','subject','','version'),
-	('60','6','NDC','0','0','','subject','','version'),
-	('70','7','NDLC','0','0','','subject','','version'),
-	('80','8','BSH','0','0','','subject','','version'),
-	('90','9','NDLSH','0','0','','subject','','version'),
-	('100','10','MeSH','0','0','','subject','','version'),
-	('110','11','DDC','0','0','','subject','','version'),
-	('120','12','LCC','0','0','','subject','','version'),
-	('130','13','UDC','0','0','','subject','','version'),
-	('140','14','LCSH','0','0','','subject','','version'),
-	('150','15','description','0','0','','description','',''),
-	('160','16','publisher','0','0','','publisher','','lang'),
-	('170','17','contributor','0','0','','contributor','','lang'),
-	('180','18','date','0','0','','date','',''),
-	('190','19','type','0','0','','type','',''),
-	('200','20','NIItype','1','1','NIItype','type','',''),
-	('210','21','format','0','0','','format','',''),
-	('220','22','identifier','0','0','','identifier','',''),
-	('230','23','URI','1','1','URI','identifier','',''),
-	('240','24','fullTextURL','-1','0','URI','identifier','',''),
-	('260','27','issn','-1','0','issn','identifier_journal','',''),
-	('270','28','NCID','-1','0','','identifier_journal','',''),
-	('280','29','jtitle','-1','1','','identifier_journal','','lang'),
-	('290','30','volume','-1','1','','identifier_journal','',''),
-	('300','31','issue','-1','1','','identifier_journal','',''),
-	('310','32','spage','-1','1','num2','identifier_journal','',''),
-	('320','33','epage','-1','1','num2','identifier_journal','',''),
-	('330','34','dateofissued','-1','1','date','identifier_journal','',''),
-	('340','35','source','0','0','','source','',''),
-	('350','36','language','0','0','','language','',''),
-	('360','37','relation','0','0','','relation','',''),
-	('370','38','pmid','0','1','URI','relation','',''),
-	('380','39','doi','0','1','URI','relation','',''),
-	('410','42','isVersionOf','0','0','URI','relation','',''),
-	('420','43','hasVersion','0','0','URI','relation','',''),
-	('430','44','isReplacedBy','0','0','URI','relation','',''),
-	('440','45','replaces','0','0','URI','relation','',''),
-	('450','46','isRequiredBy','0','0','URI','relation','',''),
-	('460','47','requires','0','0','URI','relation','',''),
-	('470','48','isPartOf','0','0','URI','relation','',''),
-	('480','49','hasPart','0','0','URI','relation','',''),
-	('490','50','isReferencedBy','0','0','URI','relation','',''),
-	('500','51','references','0','0','URI','relation','',''),
-	('510','52','isFormatOf','0','0','URI','relation','',''),
-	('520','53','hasFormat','0','0','URI','relation','',''),
-	('530','54','coverage','0','0','','coverage','',''),
-	('540','55','spatial','0','0','','coverage','',''),
-	('550','56','NIIspatial','0','0','','coverage','',''),
-	('560','57','temporal','0','0','','coverage','',''),
-	('570','58','NIItemporal','0','0','','coverage','',''),
-	('580','59','rights','0','0','','rights','',''),
-	('590','60','textversion','0','1','textversion','','',''),
-	('250','25','isbn','0','0','','identifier','',''),
-	('390','39','NAID','0','1','','relation','',''),
-	('400','40','ichushi','0','1','','relation','',''),
-	('600','60','grandid','-1','1','','identifier','',''),
-	('610','61','dateofgranted','-1','1','','data','',''),
-	('620','62','degreename','-1','1','','description','',''),
-	('630','63','grantor','-1','1','','description','','');
+    (10,1,'title',1,1,'','title','','lang'),
+    (20,2,'alternative',0,0,'','title','','lang'),
+    (30,3,'creator',-1,0,'','creator','','lang'),
+    (40,4,'subject',0,0,'','subject','',''),
+    (50,5,'NIIsubject',0,0,'','subject','','version'),
+    (60,6,'NDC',0,0,'','subject','','version'),
+    (70,7,'NDLC',0,0,'','subject','','version'),
+    (80,8,'BSH',0,0,'','subject','','version'),
+    (90,9,'NDLSH',0,0,'','subject','','version'),
+    (100,10,'MeSH',0,0,'','subject','','version'),
+    (110,11,'DDC',0,0,'','subject','','version'),
+    (120,12,'LCC',0,0,'','subject','','version'),
+    (130,13,'UDC',0,0,'','subject','','version'),
+    (140,14,'LCSH',0,0,'','subject','','version'),
+    (150,15,'description',0,0,'','description','',''),
+    (160,16,'publisher',0,0,'','publisher','','lang'),
+    (170,17,'contributor',0,0,'','contributor','','lang'),
+    (180,18,'date',0,0,'','date','',''),
+    (190,19,'type',0,0,'','type','',''),
+    (200,20,'NIItype',1,1,'NIItype','type','',''),
+    (210,21,'format',0,0,'','format','',''),
+    (220,22,'identifier',0,0,'','identifier','',''),
+    (230,23,'URI',1,1,'URI','identifier','',''),
+    (240,24,'fullTextURL',-1,0,'URI','identifier','',''),
+    (260,27,'issn',-1,0,'issn','identifier_journal','',''),
+    (270,28,'NCID',-1,0,'','identifier_journal','',''),
+    (280,29,'jtitle',-1,1,'','identifier_journal','','lang'),
+    (290,30,'volume',-1,1,'','identifier_journal','',''),
+    (300,31,'issue',-1,1,'','identifier_journal','',''),
+    (310,32,'spage',-1,1,'num2','identifier_journal','',''),
+    (320,33,'epage',-1,1,'num2','identifier_journal','',''),
+    (330,34,'dateofissued',-1,1,'date','identifier_journal','',''),
+    (340,35,'source',0,0,'','source','',''),
+    (350,36,'language',0,0,'','language','',''),
+    (360,37,'relation',0,0,'','relation','',''),
+    (370,38,'pmid',0,1,'URI','relation','',''),
+    (380,39,'doi',0,1,'URI','relation','',''),
+    (410,42,'isVersionOf',0,0,'URI','relation','',''),
+    (420,43,'hasVersion',0,0,'URI','relation','',''),
+    (430,44,'isReplacedBy',0,0,'URI','relation','',''),
+    (440,45,'replaces',0,0,'URI','relation','',''),
+    (450,46,'isRequiredBy',0,0,'URI','relation','',''),
+    (460,47,'requires',0,0,'URI','relation','',''),
+    (470,48,'isPartOf',0,0,'URI','relation','',''),
+    (480,49,'hasPart',0,0,'URI','relation','',''),
+    (490,50,'isReferencedBy',0,0,'URI','relation','',''),
+    (500,51,'references',0,0,'URI','relation','',''),
+    (510,52,'isFormatOf',0,0,'URI','relation','',''),
+    (520,53,'hasFormat',0,0,'URI','relation','',''),
+    (530,54,'coverage',0,0,'','coverage','',''),
+    (540,55,'spatial',0,0,'','coverage','',''),
+    (550,56,'NIIspatial',0,0,'','coverage','',''),
+    (560,57,'temporal',0,0,'','coverage','',''),
+    (570,58,'NIItemporal',0,0,'','coverage','',''),
+    (580,59,'rights',0,0,'','rights','',''),
+    (590,60,'textversion',0,1,'textversion','','',''),
+    (250,25,'isbn',0,0,'','identifier','',''),
+    (390,39,'NAID',0,1,'','relation','',''),
+    (400,40,'ichushi',0,1,'','relation','',''),
+    (600,60,'grandid',-1,1,'','identifier','',''),
+    (610,61,'dateofgranted',-1,1,'','data','',''),
+    (620,62,'degreename',-1,1,'','description','',''),
+    (630,63,'grantor',-1,1,'','description','','');
 
-INSERT INTO `repository_index` (`index_id`, `index_name`, `index_name_english`, `parent_index_id`, `contents`, `show_order`, `public_state`, `pub_date`, `access_role`, `access_group`, `exclusive_acl_role`, `exclusive_acl_group`, `comment`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
-(1, 'インデックス1', 'INDEX1', 0, '0', 1, 1, '2008-03-12 00:00:00.000', '1,2,3,4', '', '|-1', '', '', '1', '1', '0', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0),
-(2, 'インデックス2', 'INDEX2', 0, '0', 2, 1, '2008-03-12 00:00:00.000', '1,2,3,4', '', '|-1', '', '', '1', '1', '0', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0);
+INSERT INTO `repository_index` (`index_id`, `index_name`, `index_name_english`, `parent_index_id`, `contents`, `show_order`, `public_state`, `pub_date`, `access_role`, `access_group`, `exclusive_acl_role`, `exclusive_acl_group`, `comment`, `display_more`, `select_index_list_name`, `select_index_list_name_english`, `thumbnail`, `thumbnail_name`, `thumbnail_mime_type`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
+(1, 'インデックス1', 'INDEX1', 0, 0, 1, 1, '2008-03-12 00:00:00.000', '1,2,3,4', '', '|-1', '', '', '1', '1', '0', '', '', '', '', '', '', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0),
+(2, 'インデックス2', 'INDEX2', 0, 0, 2, 1, '2008-03-12 00:00:00.000', '1,2,3,4', '', '|-1', '', '', '1', '1', '0', '', '', '', '', '', '', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0);
 
 INSERT INTO `repository_index_browsing_authority` (`index_id`, `exclusive_acl_role_id`, `exclusive_acl_room_auth`, `public_state`, `pub_date`, `harvest_public_state`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
 (1, 0, -1, 1, '2008-03-12 00:00:00.000', 1, '1', '1', '0', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0),
 (2, 0, -1, 1, '2008-03-12 00:00:00.000', 1, '1', '1', '0', '2008-03-12 00:00:00.000', '2008-03-12 00:00:00.000', '', 0);
 
 INSERT INTO `repository_license_master` VALUE
-	('101','Creative Commons : 表示','./images/repository/default/88x31(1).png','http://creativecommons.org/licenses/by/2.1/jp/','1','0','0','2008-03-12 19:19:00.000','','','0'),
-	('102','Creative Commons : 表示 - 継承','./images/repository/default/88x31(2).png','http://creativecommons.org/licenses/by-sa/2.1/jp/','1','0','0','2008-03-12 19:19:00.000','','','0'),
-	('103','Creative Commons : 表示 - 改変禁止','./images/repository/default/88x31(3).png','http://creativecommons.org/licenses/by-nd/2.1/jp/','1','0','0','2008-03-12 19:19:00.000','','','0'),
-	('104','Creative Commons : 表示 - 非営利','./images/repository/default/88x31(4).png','http://creativecommons.org/licenses/by-nc/2.1/jp/','1','0','0','2008-03-12 19:19:00.000','','','0'),
-	('105','Creative Commons : 表示 - 非営利 - 継承','./images/repository/default/88x31(5).png','http://creativecommons.org/licenses/by-nc-sa/2.1/jp/','1','0','0','2008-03-12 19:19:00.000','','','0'),
-	('106','Creative Commons : 表示 - 非営利 - 改変禁止','./images/repository/default/88x31(6).png','http://creativecommons.org/licenses/by-nc-nd/2.1/jp/','1','0','0','2008-03-12 19:19:00.000','','','0');
+    (101,'Creative Commons : 表示','./images/repository/default/88x31(1).png','http://creativecommons.org/licenses/by/3.0/deed.ja','1','0','0','2008-03-12 19:19:00.000','','',0),
+    (102,'Creative Commons : 表示 - 継承','./images/repository/default/88x31(2).png','http://creativecommons.org/licenses/by-sa/3.0/deed.ja','1','0','0','2008-03-12 19:19:00.000','','',0),
+    (103,'Creative Commons : 表示 - 改変禁止','./images/repository/default/88x31(3).png','http://creativecommons.org/licenses/by-nd/3.0/deed.ja','1','0','0','2008-03-12 19:19:00.000','','',0),
+    (104,'Creative Commons : 表示 - 非営利','./images/repository/default/88x31(4).png','http://creativecommons.org/licenses/by-nc/3.0/deed.ja','1','0','0','2008-03-12 19:19:00.000','','',0),
+    (105,'Creative Commons : 表示 - 非営利 - 継承','./images/repository/default/88x31(5).png','http://creativecommons.org/licenses/by-nc-sa/3.0/deed.ja','1','0','0','2008-03-12 19:19:00.000','','',0),
+    (106,'Creative Commons : 表示 - 非営利 - 改変禁止','./images/repository/default/88x31(6).png','http://creativecommons.org/licenses/by-nc-nd/3.0/deed.ja','1','0','0','2008-03-12 19:19:00.000','','',0);
 
 INSERT INTO `repository_parameter` VALUE
-	('OS_type','Linux','OSの種類','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('disp_index_type','0','トップ画面(検索/一覧表示)の初期表示方法 0:最も新しい公開アイテムの属するインデックス 1:管理画面で指定したインデックス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('default_disp_index','0','トップ画面(検索/一覧表示)で初期表示するインデックスのID 初期表示インデックス表示方法が0の場合のみ有効。 プルダウンメニュで選択を予定','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_term_recent_regist','14','新規登録アイテムとみなす期間(日)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_term_stats','365','統計期間(日)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_disp_num','10','表示順位','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_is_disp_browse_item','1','ランキング表示可否, 最も閲覧されたアイテム','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_is_disp_download_item','1','ランキング表示可否, 最もダウンロードされたアイテム','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_is_disp_item_creator','1','ランキング表示可否, 最もアイテムを作成したユーザ','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_is_disp_keyword','1','ランキング表示可否, 最も検索されたキーワード','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_is_disp_recent_item','1','ランキング表示可否, 新着アイテム','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('item_coef_cp','1.0','アイテム制限, 公開アイテム数Xpの係数Cp','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('item_coef_ci','5','アイテム制限, ユーザ登録直後のアイテム数Ci','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('file_coef_cp','10.0','ファイル制限, 公開アイテム数Xpの係数Cp','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('file_coef_ci','50.0','ファイル制限, ユーザ登録直後のアップロード容量Ci','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('export_is_include_files','1','Export(アイテム一覧)でファイル込みでExportするか否か (1:ファイル込みでExport, 0:ファイルはExportしない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('review_flg','0','アイテムの査読・承認を行うか否か (1:行う, 0:行わない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('item_auto_public','1','承認後アイテムを自動公開するか否か (1:自動公開する, 0:自動公開しない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_From','hoge@hoge.com','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_SystemName','IRDB管理システム','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_Tanto','hoge@hoge.com','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_User-Agent','WEKO','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_Identify_repositoryName','WEKO','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_Identify_adminEmail','hoge@hoge.com','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prvd_Identify_earliestDatestamp','2007-03-01T00:00:00Z','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('path_wvWare','','wvWareコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('path_xlhtml','','xlhtmlコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('path_poppler','','popplerコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('path_ImageMagick','','ImageMagickコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('path_pdftk','','pdftkコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('path_ffmpeg','','ffmpegコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('path_mecab','','mecabコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('fulltextindex_contents','','実施した時のコンテンツ数','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('fulltextindex_starttime','','実施した時の開始日時','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('fulltextindex_endtime','','実施した時の終了日時','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('log_exclusion','','ログ解析除外対象','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('site_license','','サイトライセンス認可対象','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('site_license_item_type_id','','サイトライセンス除外対象アイテムタイプID','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('prefix','http://id.nii.ac.jp/prefix','prefixURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('suffix','http://id.nii.ac.jp/atom','suffixURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('IDServer','http://id.nii.ac.jp/','IDServerURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('AWSAccessKeyId','0JKCJ81PJ9QGDBPN7DR2','Amazon AWSAccessKeyId','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('AWSSecretAccessKey','3DhXSBYKMnma7PR3fP5i3fk/LHZzeqyKHXfg8E90','Amazon AWSSecretAccessKey','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('ranking_disp_setting','0','ランキングの表示設定(0:リアルタイムに更新する, 1:DB保存情報を表示する)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('default_disp_type','0','トップページ右側の初期表示設定(0:指定インデックス検索結果, 1:ランキング)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('WEKO_version','2.1.7','現在稼働中のWEKOバージョン情報','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('sort_disp','1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18','検索結果表示で表示するソート条件','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('sort_not_disp','','検索結果表示で表示しないソート条件','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('sort_disp_default','7|16','検索結果表示のデフォルトソート条件(index検索|keyword検索)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('default_list_view_num','20','検索結果表示のデフォルト表示件数','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('currency_setting','0','通貨単位設定(0:\\\, 1:$)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('select_language','0','WEKOモジュール内に言語選択を表示するか否か(0:表示しない, 1:表示する)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('alternative_language','japanese:0,english:0','他言語表示をするか否か(0:表示しない, 1:表示する)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('path_ssh', '', 'SSHコマンドの実行パス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('path_scp', '', 'SCPコマンドの実行パス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('els_auto', 'true', 'true:ELSの自動登録を行う false:ELSの自動登録を行わない','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('els_login_id', '', 'ELS用ログインID','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('els_host', 'www.ixsq.nii.ac.jp', 'ELS自動登録用ホスト名','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('supple_weko_url','','サプリWEKOのURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('review_flg_supple','0','サプリコンテンツの査読・承認を行うか否か (1:行う, 0:行わない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('review_mail_flg', '0', '査読通知メールを送信するか否か(1:送信する, 0:送信しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('review_mail', '', '査読通知メール送信先','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('ranking_last_reset_date', '', 'ランキングデータを最後に消去した日付','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('help_icon_display', '1', 'ヘルプアイコン表示設定(1:表示する、0:表示しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('oaiore_icon_display', '1', 'OAI-OREアイコン表示設定(1:表示する、0:表示しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('log_report_mail', '', '定型レポートメール送信先','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('lab_login_id', '', 'コンテンツラボ用ログインID','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('lab_host', '', 'コンテンツラボホスト名','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-	('lab_dir', '', 'コンテンツラボ転送先ディレクトリ','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('els_registered_index', '', 'ELSに登録済みのインデックス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('contents_lab_registered_index', '', 'コンテンツラボに登録済みのインデックス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('file_clean_up_last_date', '', 'ファイルクリーンアップを最後に実行した日付','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('select_index_list_display','0','「インデックス一覧」表示切り替え条件','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('AssociateTag','w04d-22','Amazon Associate Tag','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('harvesting_start_date', '', 'Start date of the last harvesting', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('harvesting_end_date', '', 'End date of the last harvesting', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('update_usage_statistics_last_date', '', '利用統計ログ集計を最後に実行した日付','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('send_feedback_mail_start_date', '', 'Start date of feedback mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('send_feedback_mail_end_date', '', 'End date of feedback mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('exclude_address_for_feedback', '', 'Exclude mail address for feedback mail','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('ichushi_is_connect', '0', '医中誌への連携チェック状態(1:連携,0:連携しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('ichushi_login_id', '', '医中誌ログインID', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('ichushi_login_passwd', '', '医中誌ログインパスワード','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('send_feedback_mail_activate_flg', '0', 'フィードバックメール送信機能利用設定(1:利用する,0:利用しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('is_make_privatetree', '0', 'プライベートツリーの自動作成を行うか否か(1:自動作成する, 0:自動作成しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','','0'),
-    ('privatetree_sort_order', '0', 'プライベートツリーのデフォルト表示順序(0:カスタムソート, 1:インデックス名順(昇順), 2:インデックス名順(降順))', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('privatetree_parent_indexid', '0', 'プライベートツリーが作成される親インデックスのID', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('private_tree_composition', '', 'プライベートツリー以下に作成されるインデックス構成', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('referenceURL', '', '引用情報のベースURL', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('send_sitelicense_mail_start_date', '', 'Start date of sitelicense mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-    ('send_sitelicense_mail_end_date', '', 'End date of sitelicense mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('send_sitelicense_mail_activate_flg', '0', 'サイトライセンスメール送信機能利用設定(1:利用する,0:利用しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('externalsearchword_stopword', '0', 'リファラ解析時のストップワードの使用状態(0:使用し形態素解析は行う、1:使用し形態素解析は行わない、2:使用しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('show_detail_tagcloudflag', '1', 'リフ詳細画面でタグクラウド表示フラグ(0:表示しない、1:表示する)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('tagcloud_max_value', '10', '詳細画面でのタグクラウドの最大数', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('search_query_plugin', '', '検索クエリプラグインのパス', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('output_oaipmh', '1', 'OAI-PMH出力フラグ 0:出力しない 1:出力する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_journal_article', '0', 'journal_article DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_article', '0', 'article DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_preprint', '0', 'preprint DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_departmental_bulletin_paper', '0', 'departmental_bulletin_paper DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_thesis_or_dissertation', '0', 'thesis_or_dissertation DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_conference_paper', '0', 'conference_paper DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_book', '0', 'book DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_technical_report', '0', 'technical_report DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_research_paper', '0', 'research_paper DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_learning_material', '0', 'learning_material DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_data_or_dataset', '0', 'data_or_dataset DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_software', '0', 'software DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_presentation', '0', 'presentation DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
-	('edit_doi_flag_others', '0', 'others DOI付与フラグ 0:付与しない 1:付与する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0');
-
+    ('OS_type','Linux','OSの種類','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('disp_index_type','0','トップ画面(検索/一覧表示)の初期表示方法 0:最も新しい公開アイテムの属するインデックス 1:管理画面で指定したインデックス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('default_disp_index','0','トップ画面(検索/一覧表示)で初期表示するインデックスのID 初期表示インデックス表示方法が0の場合のみ有効。 プルダウンメニュで選択を予定','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_term_recent_regist','14','新規登録アイテムとみなす期間(日)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_term_stats','365','統計期間(日)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_disp_num','10','表示順位','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_is_disp_browse_item','1','ランキング表示可否, 最も閲覧されたアイテム','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_is_disp_download_item','1','ランキング表示可否, 最もダウンロードされたアイテム','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_is_disp_item_creator','1','ランキング表示可否, 最もアイテムを作成したユーザ','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_is_disp_keyword','1','ランキング表示可否, 最も検索されたキーワード','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_is_disp_recent_item','1','ランキング表示可否, 新着アイテム','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('item_coef_cp','1.0','アイテム制限, 公開アイテム数Xpの係数Cp','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('item_coef_ci','5','アイテム制限, ユーザ登録直後のアイテム数Ci','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('file_coef_cp','10.0','ファイル制限, 公開アイテム数Xpの係数Cp','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('file_coef_ci','50.0','ファイル制限, ユーザ登録直後のアップロード容量Ci','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('export_is_include_files','1','Export(アイテム一覧)でファイル込みでExportするか否か (1:ファイル込みでExport, 0:ファイルはExportしない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('review_flg','0','アイテムの査読・承認を行うか否か (1:行う, 0:行わない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('item_auto_public','1','承認後アイテムを自動公開するか否か (1:自動公開する, 0:自動公開しない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_From','hoge@hoge.com','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_SystemName','IRDB管理システム','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_Tanto','hoge@hoge.com','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_User-Agent','WEKO','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_Identify_repositoryName','WEKO','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_Identify_adminEmail','hoge@hoge.com','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prvd_Identify_earliestDatestamp','2007-03-01T00:00:00Z','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_wvWare','','wvWareコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_xlhtml','','xlhtmlコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_poppler','','popplerコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_ImageMagick','','ImageMagickコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_pdftk','','pdftkコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_ffmpeg','','ffmpegコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_mecab','','mecabコマンドまでの絶対パス','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('fulltextindex_contents','','実施した時のコンテンツ数','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('fulltextindex_starttime','','実施した時の開始日時','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('fulltextindex_endtime','','実施した時の終了日時','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('log_exclusion','','ログ解析除外対象','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('site_license_item_type_id','','サイトライセンス除外対象アイテムタイプID','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('prefix','http://id.nii.ac.jp/prefix','prefixURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('suffix','http://id.nii.ac.jp/atom','suffixURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('IDServer','http://id.nii.ac.jp/','IDServerURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('AWSAccessKeyId','0JKCJ81PJ9QGDBPN7DR2','Amazon AWSAccessKeyId','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('AWSSecretAccessKey','3DhXSBYKMnma7PR3fP5i3fk/LHZzeqyKHXfg8E90','Amazon AWSSecretAccessKey','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ranking_disp_setting','0','ランキングの表示設定(0:リアルタイムに更新する, 1:DB保存情報を表示する)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('default_disp_type','0','トップページ右側の初期表示設定(0:指定インデックス検索結果, 1:ランキング)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('WEKO_version','2.2.0','現在稼働中のWEKOバージョン情報','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('sort_disp','1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18','検索結果表示で表示するソート条件','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('sort_not_disp','','検索結果表示で表示しないソート条件','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('sort_disp_default','7|16','検索結果表示のデフォルトソート条件(index検索|keyword検索)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('default_list_view_num','20','検索結果表示のデフォルト表示件数','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('currency_setting','0','通貨単位設定(0:\\\, 1:$)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('select_language','0','WEKOモジュール内に言語選択を表示するか否か(0:表示しない, 1:表示する)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('alternative_language','japanese:0,english:0','他言語表示をするか否か(0:表示しない, 1:表示する)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('path_ssh', '', 'SSHコマンドの実行パス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('path_scp', '', 'SCPコマンドの実行パス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('els_auto', 'true', 'true:ELSの自動登録を行う false:ELSの自動登録を行わない','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('els_login_id', '', 'ELS用ログインID','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('els_host', 'www.ixsq.nii.ac.jp', 'ELS自動登録用ホスト名','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('supple_weko_url','','サプリWEKOのURL','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('review_flg_supple','0','サプリコンテンツの査読・承認を行うか否か (1:行う, 0:行わない)','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('review_mail_flg', '0', '査読通知メールを送信するか否か(1:送信する, 0:送信しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('review_mail', '', '査読通知メール送信先','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('ranking_last_reset_date', '', 'ランキングデータを最後に消去した日付','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('help_icon_display', '1', 'ヘルプアイコン表示設定(1:表示する、0:表示しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('oaiore_icon_display', '1', 'OAI-OREアイコン表示設定(1:表示する、0:表示しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('log_report_mail', '', '定型レポートメール送信先','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('lab_login_id', '', 'コンテンツラボ用ログインID','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('lab_host', '', 'コンテンツラボホスト名','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('lab_dir', '', 'コンテンツラボ転送先ディレクトリ','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('els_registered_index', '', 'ELSに登録済みのインデックス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('contents_lab_registered_index', '', 'コンテンツラボに登録済みのインデックス','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('file_clean_up_last_date', '', 'ファイルクリーンアップを最後に実行した日付','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('select_index_list_display','0','「インデックス一覧」表示切り替え条件','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('AssociateTag','w04d-22','Amazon Associate Tag','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('harvesting_start_date', '', 'Start date of the last harvesting', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('harvesting_end_date', '', 'End date of the last harvesting', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('update_usage_statistics_last_date', '', '利用統計ログ集計を最後に実行した日付','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('send_feedback_mail_start_date', '', 'Start date of feedback mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('send_feedback_mail_end_date', '', 'End date of feedback mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('exclude_address_for_feedback', '', 'Exclude mail address for feedback mail','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('ichushi_is_connect', '0', '医中誌への連携チェック状態(1:連携,0:連携しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ichushi_login_id', '', '医中誌ログインID', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('ichushi_login_passwd', '', '医中誌ログインパスワード','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('send_feedback_mail_activate_flg', '0', 'フィードバックメール送信機能利用設定(1:利用する,0:利用しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('is_make_privatetree', '0', 'プライベートツリーの自動作成を行うか否か(1:自動作成する, 0:自動作成しない)','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('privatetree_sort_order', '0', 'プライベートツリーのデフォルト表示順序(0:カスタムソート, 1:インデックス名順(昇順), 2:インデックス名順(降順))', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('privatetree_parent_indexid', '0', 'プライベートツリーが作成される親インデックスのID', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('private_tree_composition', '', 'プライベートツリー以下に作成されるインデックス構成', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('referenceURL', '', '引用情報のベースURL', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('send_sitelicense_mail_start_date', '', 'Start date of sitelicense mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('send_sitelicense_mail_end_date', '', 'End date of sitelicense mail sending', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('send_sitelicense_mail_activate_flg', '0', 'サイトライセンスメール送信機能利用設定(1:利用する,0:利用しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('externalsearchword_stopword', '0', 'リファラ解析時のストップワードの使用状態(0:使用し形態素解析は行う、1:使用し形態素解析は行わない、2:使用しない)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('show_detail_tagcloudflag', '1', 'リフ詳細画面でタグクラウド表示フラグ(0:表示しない、1:表示する)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('tagcloud_max_value', '10', '詳細画面でのタグクラウドの最大数', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('search_query_plugin', '', '検索クエリプラグインのパス', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('output_oaipmh', '1', 'OAI-PMH出力フラグ 0:出力しない 1:出力する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('default_search_type', '0', '検索設定のデフォルト値設定 0:全文検索 1:キーワード検索', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('usagestatistics_link_display', '1', '利用統計リンク表示設定 0:表示しない 1:表示する','1','1','0','2008-08-31 00:00:00.000','2008-08-31 00:00:00.000','',0),
+    ('ranking_tab_display', '1', 'ランキングタブ表示値設定 0:表示しない 1:表示する', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('institution_name', '', 'Google Scholar メタタグ出力用機関名称設定値', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','',0),
+    ('crossref_query_service_account', '', 'CrossRef APIにアクセスするための設定値(メールアドレス)', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0'),
+    ('prefix_flag', '0', 'DOI付与時、YハンドルのPrefixIDをSuffixに付与するか否か(0:付与しない,1:付与する) すでにDOIを付与されている場合は変更できない', '1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','','0');
 
 INSERT INTO `repository_item_type` VALUE
-	('10001', '学術雑誌論文 / Journal Article', '学術雑誌論文 / Journal Article', 'default item type', 'Journal Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '紀要論文 / Departmental Bulletin Paper', '紀要論文 / Departmental Bulletin Paper', 'default item type', 'Departmental Bulletin Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '会議発表論文 / Conference Paper', '会議発表論文 / Conference Paper', 'default item type', 'Conference Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '一般雑誌記事 / Article', '一般雑誌記事 / Article', 'default item type', 'Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '会議発表用資料 / Presentation', '会議発表用資料 / Presentation', 'default item type', 'Presentation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '学位論文 / Thesis or Dissertation', '学位論文 / Thesis or Dissertation', 'default item type', 'Thesis or Dissertation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '報告書 / Research Paper', '報告書 / Research Paper', 'default item type', 'Research Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '図書 / Book', '図書 / Book', 'default item type', 'Book', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '図書の一部 / Book', '図書の一部 / Book', 'default item type', 'Book', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', 'その他 / Others', 'その他 / Others', 'default item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', 'DublinCore', 'DublinCore', 'harvesting item type', 'Journal Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', 'Journal Article', 'Journal Article', 'harvesting item type', 'Journal Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', 'Thesis or Dissertation', 'Thesis or Dissertation', 'harvesting item type', 'Thesis or Dissertation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', 'Departmental Bulletin Paper', 'Departmental Bulletin Paper', 'harvesting item type', 'Departmental Bulletin Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', 'Conference Paper', 'Conference Paper', 'harvesting item type', 'Conference Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', 'Presentation', 'Presentation', 'harvesting item type', 'Presentation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', 'Book', 'Book', 'harvesting item type', 'Book', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', 'Technical Report', 'Technical Report', 'harvesting item type', 'Technical Report', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', 'Research Paper', 'Research Paper', 'harvesting item type', 'Research Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', 'Article', 'Article', 'harvesting item type', 'Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', 'Preprint', 'Preprint', 'harvesting item type', 'Preprint', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', 'Learning Material', 'Learning Material', 'harvesting item type', 'Learning Material', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', 'Data or Dataset', 'Data or Dataset', 'harvesting item type', 'Data or Dataset', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', 'Software', 'Software', 'harvesting item type', 'Software', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', 'Others', 'Others', 'harvesting item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', 'Learning Object Metadata', 'Learning Object Metadata', 'harvesting item type', 'Learning Material', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', 'LIDO', 'LIDO', 'harvesting item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');
+    (10001, '学術雑誌論文 / Journal Article', '学術雑誌論文 / Journal Article', 'default item type', 'Journal Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, '紀要論文 / Departmental Bulletin Paper', '紀要論文 / Departmental Bulletin Paper', 'default item type', 'Departmental Bulletin Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, '会議発表論文 / Conference Paper', '会議発表論文 / Conference Paper', 'default item type', 'Conference Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, '一般雑誌記事 / Article', '一般雑誌記事 / Article', 'default item type', 'Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, '会議発表用資料 / Presentation', '会議発表用資料 / Presentation', 'default item type', 'Presentation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, '学位論文 / Thesis or Dissertation', '学位論文 / Thesis or Dissertation', 'default item type', 'Thesis or Dissertation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, '報告書 / Research Paper', '報告書 / Research Paper', 'default item type', 'Research Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, '図書 / Book', '図書 / Book', 'default item type', 'Book', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, '図書の一部 / Book', '図書の一部 / Book', 'default item type', 'Book', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 'その他 / Others', 'その他 / Others', 'default item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 'DublinCore', 'DublinCore', 'harvesting item type', 'Journal Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 'Journal Article', 'Journal Article', 'harvesting item type', 'Journal Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 'Thesis or Dissertation', 'Thesis or Dissertation', 'harvesting item type', 'Thesis or Dissertation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 'Departmental Bulletin Paper', 'Departmental Bulletin Paper', 'harvesting item type', 'Departmental Bulletin Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 'Conference Paper', 'Conference Paper', 'harvesting item type', 'Conference Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 'Presentation', 'Presentation', 'harvesting item type', 'Presentation', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 'Book', 'Book', 'harvesting item type', 'Book', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 'Technical Report', 'Technical Report', 'harvesting item type', 'Technical Report', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 'Research Paper', 'Research Paper', 'harvesting item type', 'Research Paper', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 'Article', 'Article', 'harvesting item type', 'Article', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 'Preprint', 'Preprint', 'harvesting item type', 'Preprint', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 'Learning Material', 'Learning Material', 'harvesting item type', 'Learning Material', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 'Data or Dataset', 'Data or Dataset', 'harvesting item type', 'Data or Dataset', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 'Software', 'Software', 'harvesting item type', 'Software', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 'Others', 'Others', 'harvesting item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 'Learning Object Metadata', 'Learning Object Metadata', 'harvesting item type', 'Learning Material', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 'LIDO', 'LIDO', 'harvesting item type', 'Others', '', '', '', '', '1', '1', '0', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0);
 
 INSERT INTO `repository_item_attr_type` (`item_type_id`, `attribute_id`, `show_order`, `attribute_name`, `attribute_short_name`, `input_type`, `is_required`, `plural_enable`, `line_feed_enable`, `list_view_enable`, `hidden`, `junii2_mapping`, `dublin_core_mapping`, `lom_mapping`, `lido_mapping`, `display_lang_type`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
-	('10001', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '7', '7', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '12', '12', '論文ID（NAID）', '論文ID（NAID）', 'text', '0', '0', '0', '0', '0', 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '13', '13', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '14', '14', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10001', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10002', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '7', '7', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
-	('10002', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '12', '12', '論文ID（NAID）', '論文ID（NAID）', 'text', '0', '0', '0', '0', '0', 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '13', '13', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '14', '14', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10002', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10003', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '7', '7', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '12', '12', '論文ID（NAID）', '論文ID（NAID）', 'text', '0', '0', '0', '0', '0', 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '13', '13', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '14', '14', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relationIsBasisFor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10003', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '7', '7', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '12', '12', '論文ID（NAID）', '論文ID（NAID）', 'text', '0', '0', '0', '0', '0', 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '13', '13', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '14', '14', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10004', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '6', '6', '会議概要（会議名, 開催地, 会期, 主催者等）', '会議概要（会議名, 開催地, 会期, 主催者等）', 'textarea', '0', '1', '0', '1', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '7', '7', '発表年月日', '発表年月日', 'date', '0', '0', '0', '0', '0', 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '8', '8', '公開者', '公開者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '9', '9', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '10', '10', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '11', '11', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '12', '12', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '13', '13', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '14', '14', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '15', '15', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '16', '16', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10005', '17', '17', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '5', '5', '公開者', '公開者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '6', '6', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '7', '7', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '8', '8', '学位名', '学位名', 'text', '0', '0', '0', '1', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '9', '9', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '1', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '10', '10', '学位授与年度', '学位授与年度', 'text', '0', '1', '0', '1', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '11', '11', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '12', '12', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '1', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '13', '13', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '14', '14', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '15', '15', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '16', '16', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '17', '17', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '18', '18', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '19', '19', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '20', '20', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10006', '21', '21', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '1', '1', 'その他（別言語等）の研究課題名', 'その他（別言語等）の研究課題名', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '2', '2', '研究代表者', '研究代表者', 'name', '0', '0', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '3', '3', '研究代表者別名', '研究代表者別名', 'name', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '4', '4', '研究代表者ID', '研究代表者ID', 'text', '0', '0', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '5', '5', '研究分担者', '研究分担者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '6', '6', '研究分担者別名', '研究分担者別名', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '7', '7', '研究分担者ID', '研究分担者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '8', '8', '報告年度', '報告年度', 'date', '0', '0', '0', '1', '0', 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '9', '9', '研究課題番号', '研究課題番号', 'text', '0', '0', '0', '1', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '10', '10', '研究代表者番号', '研究代表者番号', 'text', '0', '0', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '11', '11', '研究機関', '研究機関', 'text', '0', '0', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '12', '12', '助成元', '助成元', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '13', '13', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10007', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '7', '7', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '8', '8', '出版年月日', '出版年月日', 'date', '0', '0', '0', '1', '0', 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier','generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '12', '12', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '13', '13', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '14', '14', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '15', '15', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '16', '16', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '17', '17', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '18', '18', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '19', '19', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10008', '20', '20', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '7', '7', '図書名', '図書名', 'text', '0', '0', '0', '1', '0', 'jtitle', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '9', '9', '開始ページ', '開始ページ', 'text', '0', '0', '0', '1', '0', 'spage', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '10', '10', '終了ページ', '終了ページ', 'text', '0', '0', '0', '1', '0', 'epage', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '11', '11', '出版年月日', '出版年月日', 'date', '0', '0', '0', '1', '0', 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '12', '12', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '13', '13', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '14', '14', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-	('10009', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '1', '1', 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '2', '2', '著者', '著者', 'name', '0', '1', '1', '1', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '3', '3', '著者（英）', '著者（英）', 'name', '0', '1', '0', '0', '0', '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '4', '4', '著者ID', '著者ID', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '5', '5', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '6', '6', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '7', '7', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '8', '8', '出版者', '出版者', 'text', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
-    ('10010', '9', '9', 'ISSN', 'ISSN', 'text', '0', '0', '0', '0', '0', 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '10', '10', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '11', '11', '書誌レコードID', '書誌レコードID', 'text', '0', '0', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '12', '12', '論文ID（NAID）', '論文ID（NAID）', 'text', '0', '0', '0', '0', '0', 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '13', '13', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '14', '14', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '15', '15', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '16', '16', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '17', '17', '関連サイト', '関連サイト', 'link', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '18', '18', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '19', '19', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '20', '20', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '21', '21', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '22', '22', 'コンテンツ本体', 'コンテンツ本体', 'file', '0', '1', '1', '1', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('10010', '23', '23', '見出し', '見出し', 'heading', '0', '0', '0', '0', '0', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '2', '2', '著者名', '著者名', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '3', '3', '抄録', '抄録', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '4', '4', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '5', '5', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '6', '6', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '7', '7', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '8', '8', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '9', '9', '資源識別子', '資源識別子', 'link', '0', '1', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '10', '10', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '11', '11', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '12', '12', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '13', '13', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '14', '14', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '15', '15', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '16', '16', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20001', '17', '17', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20002', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20003', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20004', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20005', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20006', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20007', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20008', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20009', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20010', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20011', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20012', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20013', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20014', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '1', '1', 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', '0', '1', '0', '0', '0', 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '2', '2', '作成者', '作成者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '3', '3', '作成者(その他言語)', '作成者(その他言語)', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '4', '4', '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', '0', '1', '0', '0', '0', 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '5', '5', '日本十進分類法', '日本十進分類法', 'text', '0', '1', '0', '0', '0', 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '6', '6', '国立国会図書館分類表', '国立国会図書館分類表', 'text', '0', '1', '0', '0', '0', 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '7', '7', '日本件名標目', '日本件名標目', 'text', '0', '1', '0', '0', '0', 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '8', '8', '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '9', '9', '医学件名標目表', '医学件名標目表', 'text', '0', '1', '0', '0', '0', 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '10', '10', 'デューイ十進分類法', 'デューイ十進分類法', 'text', '0', '1', '0', '0', '0', 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '11', '11', '米国議会図書館分類法', '米国議会図書館分類法', 'text', '0', '1', '0', '0', '0', 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '12', '12', '国際十進分類法', '国際十進分類法', 'text', '0', '1', '0', '0', '0', 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '13', '13', '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', '0', '1', '0', '0', '0', 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '14', '14', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '15', '15', '公開者', '公開者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '16', '16', '公開者(その他言語)', '公開者(その他言語)', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '17', '17', '寄与者', '寄与者', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '18', '18', '寄与者(その他言語)', '寄与者(その他言語)', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '19', '19', '日付', '日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '20', '20', '資源タイプ', '資源タイプ', 'textarea', '0', '1', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '21', '21', 'フォーマット', 'フォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '22', '22', 'その他の資源識別子', 'その他の資源識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '23', '23', '資源識別子URI', '資源識別子URI', 'link', '1', '0', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '24', '24', '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', '0', '1', '0', '0', '0', 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '25', '26', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '26', '27', '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '27', '28', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '0', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '28', '29', '情報源', '情報源', 'text', '0', '1', '0', '0', '0', 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '29', '30', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '30', '31', '他の資源との関係', '他の資源との関係', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '31', '32', 'PubMed番号', 'PubMed番号', 'text', '0', '0', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '32', '33', 'DOI', 'DOI', 'text', '0', '0', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '33', '36', '異版である', '異版である', 'link', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '34', '37', '異版あり', '異版あり', 'link', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '35', '38', '置換される', '置換される', 'link', '0', '1', '0', '0', '0', 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '36', '39', '置換する', '置換する', 'link', '0', '1', '0', '0', '0', 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '37', '40', '要件とされる', '要件とされる', 'link', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '38', '41', '要件とする', '要件とする', 'link', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '39', '42', '部分である', '部分である', 'link', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '40', '43', '部分を持つ', '部分を持つ', 'link', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '41', '44', '参照される', '参照される', 'link', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '42', '45', '参照する', '参照する', 'link', '0', '1', '0', '0', '0', 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '43', '46', '別フォーマットである', '別フォーマットである', 'link', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '44', '47', '別フォーマットあり', '別フォーマットあり', 'link', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '45', '48', '範囲', '範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '46', '49', '空間的', '空間的', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '47', '50', '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', '0', '1', '0', '0', '0', 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '48', '51', '時間的', '時間的', 'text', '0', '1', '0', '0', '0', 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '49', '52', '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', '0', '1', '0', '0', '0', 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '50', '53', '権利', '権利', 'text', '0', '1', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '51', '54', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '52', '59', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '53', '60', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '54', '61', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '55', '55', '学位授与番号', '学位授与番号', 'text', '0', '0', '0', '0', '0', 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '56', '56', '学位授与年月日', '学位授与年月日', 'date', '0', '0', '0', '0', '0', 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '57', '57', '学位名', '学位名', 'text', '0', '0', '0', '0', '0', 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '58', '58', '学位授与機関', '学位授与機関', 'text', '0', '0', '0', '0', '0', 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '59', '34', 'NII論文ID', 'NII論文ID', 'text', '0', '0', '0', '0', '0', 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '60', '35', '医中誌ID', '医中誌ID', 'text', '0', '0', '0', '0', '0', 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20015', '61', '25', 'ISBN', 'ISBN', 'text', '0', '1', '0', '0', '0', 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '1', '1', 'URI', 'URI', 'link', '0', '1', '0', '0', '0', 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '2', '2', 'ISSN', 'ISSN', 'text', '0', '1', '0', '0', '0', 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '3', '3', 'NCID', 'NCID', 'text', '0', '1', '0', '0', '0', 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '4', '4', '書誌情報', '書誌情報', 'biblio_info', '0', '0', '0', '1', '0', 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '5', '5', '著者版フラグ', '著者版フラグ', 'select', '0', '0', '0', '0', '0', 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '6', '6', 'その他の識別子', 'その他の識別子', 'text', '0', '1', '0', '0', '0', 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '7', '7', '言語', '言語', 'text', '0', '1', '0', '0', '0', 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '8', '8', '内容記述', '内容記述', 'textarea', '0', '1', '0', '0', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '9', '9', '適用範囲', '適用範囲', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '10', '10', '構成', '構成', 'select', '0', '0', '0', '0', '0', '', '', 'generalStructure', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '11', '11', '粒度', '粒度', 'select', '0', '0', '0', '0', '0', '', '', 'generalAggregationLevel', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '12', '12', 'エディション（版）', 'エディション（版）', 'text', '0', '0', '0', '0', '0', '', '', 'lifeCycleVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '13', '13', 'ステータス（現状）', 'ステータス（現状）', 'select', '0', '0', '0', '0', '0', '', '', 'lifeCycleStatus', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '14', '14', '著者', '著者', 'name', '0', '1', '0', '0', '0', 'creator', 'creator', 'lifeCycleContributeRoleAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '15', '15', '発行者', '発行者', 'name', '0', '1', '0', '0', '0', 'publisher', 'publisher', 'lifeCycleContributeRolePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '16', '16', '寄与の日付', '寄与の日付', 'date', '0', '1', '0', '0', '0', 'date', 'date', 'lifeCycleContributeDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '17', '17', '原作者', '原作者', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleInitiator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '18', '18', '終了者（廃止者）', '終了者（廃止者）', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleTerminator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '19', '19', '校閲者', '校閲者', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '20', '20', '編集者', '編集者', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleEditor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '21', '21', 'グラフィックデザイナー', 'グラフィックデザイナー', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleGraphicalDesigner', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '22', '22', '技術', '技術', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleTechnicalImplementer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '23', '23', 'コンテンツプロバイダー', 'コンテンツプロバイダー', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleContentProvider', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '24', '24', '技術監修', '技術監修', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleTechnicalValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '25', '25', '教育監修', '教育監修', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleEducationalValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '26', '26', '台本作者', '台本作者', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleScriptWriter', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '27', '27', 'インストラクショナルデザイナー', 'インストラクショナルデザイナー', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleInstructionalDesigner', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '28', '28', '教科・専門家', '教科・専門家', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleSubjectMatterExpert', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '29', '29', 'その他の関係者(未知)', 'その他の関係者(未知)', 'text', '0', '1', '0', '0', '0', 'contributor', 'contributor', 'lifeCycleContributeRoleUnknown', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '30', '30', '寄与者', '寄与者', 'text', '0', '1', '0', '0', '0', '', '', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '31', '31', 'メタデータ識別子', 'メタデータ識別子', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '32', '32', 'メタデータ作成者', 'メタデータ作成者', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataContributeRoleCreator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '33', '33', 'メタデータ校閲者', 'メタデータ校閲者', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataContributeRoleValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '34', '34', 'メタデータへの寄与', 'メタデータへの寄与', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '35', '35', 'メタデータスキーマ', 'メタデータスキーマ', 'text', '0', '1', '0', '0', '0', '', '', 'metaMetadataMetadataSchema', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '36', '36', 'メタデータの記述言語', 'メタデータの記述言語', 'text', '0', '0', '0', '0', '0', '', '', 'metaMetadataLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '37', '37', 'ファイルフォーマット', 'ファイルフォーマット', 'text', '0', '1', '0', '0', '0', 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '38', '38', 'ファイルサイズ', 'ファイルサイズ', 'text', '0', '0', '0', '0', '0', '', '', 'technicalSize', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '39', '39', 'ファイルリンク', 'ファイルリンク', 'text', '0', '1', '0', '0', '0', '', '', 'technicalLocation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '40', '40', '動作環境', '動作環境', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '41', '41', '動作条件', '動作条件', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeName', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '42', '42', '推奨バージョン(下限)', '推奨バージョン(下限)', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeMinimumVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '43', '43', '推奨バージョン(上限)', '推奨バージョン(上限)', 'text', '0', '1', '0', '0', '0', '', '', 'technicalRequirementOrCompositeMaximumVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '44', '44', 'インストール手順', 'インストール手順', 'text', '0', '0', '0', '0', '0', '', '', 'technicalInstallationRemarks', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '45', '45', 'その他の技術要件', 'その他の技術要件', 'text', '0', '0', '0', '0', '0', '', '', 'technicalOtherPlatformRequirements', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '46', '46', '再生時間', '再生時間', 'text', '0', '0', '0', '0', '0', '', '', 'technicalDuration', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '47', '47', '双方向性・種別', '双方向性・種別', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalInteractivityType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '48', '48', '学習資源・種別', '学習資源・種別', 'checkbox', '0', '0', '0', '0', '0', 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '49', '49', '双方向性・レベル', '双方向性・レベル', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalInteractivityLevel', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '50', '50', '意味論的密度', '意味論的密度', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalSemanticDensity', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '51', '51', '想定利用者', '想定利用者', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalIntendedEndUserRole', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '52', '52', '想定利用環境', '想定利用環境', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalContext', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '53', '53', '想定利用者の対象年齢', '想定利用者の対象年齢', 'text', '0', '1', '0', '0', '0', '', '', 'educationalTypicalAgeRange', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '54', '54', '想定利用者における難易度', '想定利用者における難易度', 'checkbox', '0', '0', '0', '0', '0', '', '', 'educationalDifficulty', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '55', '55', '推定学習時間', '推定学習時間', 'text', '0', '1', '0', '0', '0', '', '', 'educationalTypicalLearningTime', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '56', '56', '教育情報・備考', '教育情報・備考', 'textarea', '0', '1', '0', '0', '0', '', '', 'educationalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '57', '57', '想定利用者の使用言語', '想定利用者の使用言語', 'text', '0', '1', '0', '0', '0', '', '', 'educationalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '58', '58', '使用料', '使用料', 'select', '0', '0', '0', '0', '0', '', '', 'rightsCost', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '59', '59', '著作権・利用制限条件', '著作権・利用制限条件', 'select', '0', '0', '0', '0', '0', '', '', 'rightsCopyrightAndOtherRestrictions', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '60', '60', '権利関係・備考', '権利関係・備考', 'textarea', '0', '0', '0', '0', '0', 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '61', '61', 'PubMed番号', 'PubMed番号', 'text', '0', '1', '0', '0', '0', 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '62', '62', 'DOI', 'DOI', 'text', '0', '1', '0', '0', '0', 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '63', '63', '異版である', '異版である', 'text', '0', '1', '0', '0', '0', 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '64', '64', '異版あり', '異版あり', 'text', '0', '1', '0', '0', '0', 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '65', '65', '要件とされる', '要件とされる', 'text', '0', '1', '0', '0', '0', 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '66', '66', '要件とする', '要件とする', 'text', '0', '1', '0', '0', '0', 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '67', '67', '部分である', '部分である', 'text', '0', '1', '0', '0', '0', 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '68', '68', '部分を持つ', '部分を持つ', 'text', '0', '1', '0', '0', '0', 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '69', '69', '参照される', '参照される', 'text', '0', '1', '0', '0', '0', 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '70', '70', '参照する', '参照する', 'text', '0', '1', '0', '0', '0', 'references', 'relation', 'relationReferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '71', '71', '別フォーマットである', '別フォーマットである', 'text', '0', '1', '0', '0', '0', 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '72', '72', '別フォーマットあり', '別フォーマットあり', 'text', '0', '1', '0', '0', '0', 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '73', '73', '基になる', '基になる', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relationIsBasisFor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '74', '74', '基づいている', '基づいている', 'text', '0', '1', '0', '0', '0', 'relation', 'relation', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '75', '75', '他の資源との関係', '他の資源との関係', 'textarea', '0', '1', '0', '0', '0', 'relation', 'relation', 'relationResource', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '76', '76', '教育利用コメント・作成者', '教育利用コメント・作成者', 'text', '0', '1', '0', '0', '0', '', '', 'annotationEntity', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '77', '77', '教育利用コメント・作成日', '教育利用コメント・作成日', 'date', '0', '1', '0', '0', '0', '', '', 'annotationDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '78', '78', '教育利用コメント・備考', '教育利用コメント・備考', 'textarea', '0', '1', '0', '0', '0', '', '', 'annotationDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '79', '79', '分類目的', '分類目的', 'checkbox', '0', '0', '0', '0', '0', '', '', 'classificationPurpose', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '80', '80', '分類体系の所在・名称', '分類体系の所在・名称', 'text', '0', '1', '0', '0', '0', '', '', 'classificationTaxonPathSource', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '81', '81', '分類体系における分類項目', '分類体系における分類項目', 'text', '0', '1', '0', '0', '0', '', '', 'classificationTaxonPathTaxon', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '82', '82', '分類・備考', '分類・備考', 'textarea', '0', '1', '0', '0', '0', '', '', 'classificationDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '83', '83', '分類・キーワード', '分類・キーワード', 'text', '0', '1', '0', '0', '0', '', '', 'classificationKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '84', '84', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '85', '85', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20016', '86', '86', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '1', '1', 'lidoレコードID', 'lidoレコードID', 'text', '1', '1', '0', '0', '0', 'identifier', 'identifier', '', 'lidoRecID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '2', '2', '作品タイプID', '作品タイプID', 'text', '1', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectClassificationWrap.objectWorkTypeWrap.objectWorkType.conceptID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '3', '3', '作品タイプ（語）', '作品タイプ（語）', 'text', '1', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectClassificationWrap.objectWorkTypeWrap.objectWorkType.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '4', '4', '分類ID', '分類ID', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectClassificationWrap.classificationWrap.classification.conceptID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '5', '5', '分類（語）', '分類（語）', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectClassificationWrap.classificationWrap.classification.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '6', '6', '資料/作品名（値）', '資料/作品名（値）', 'text', '0', '1', '0', '0', '0', 'title', 'title', '', 'descriptiveMetadata.objectIdentificationWrap.titleWrap.titleSet.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '7', '7', '銘/題辞写', '銘/題辞写', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectIdentificationWrap.inscriptionsWrap.inscriptions.inscriptionTranscription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '8', '8', '所蔵者名（値）', '所蔵者名（値）', 'name', '0', '1', '0', '0', '0', 'rights', 'rights', '', 'descriptiveMetadata.objectIdentificationWrap.repositoryWrap.repositorySet.repositoryName.legalBodyName.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '9', '9', '所蔵者ウェブリンク', '所蔵者ウェブリンク', 'link', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectIdentificationWrap.repositoryWrap.repositorySet.repositoryName.legalBodyWeblink', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '10', '10', '所蔵者資料/作品ID', '所蔵者資料/作品ID', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectIdentificationWrap.repositoryWrap.repositorySet.workID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '11', '11', '資料/作品状態（状態）', '資料/作品状態（状態）', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectIdentificationWrap.displayStateEditionWrap.displayState', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '12', '12', '記述ノート（値）', '記述ノート（値）', 'text', '0', '1', '0', '0', '0', 'description', 'description', '', 'descriptiveMetadata.objectIdentificationWrap.objectDescriptionWrap.objectDescriptionSet.descriptiveNoteValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '13', '13', '測定（表示用）', '測定（表示用）', 'text', '0', '1', '0', '0', '0', 'description', 'description', '', 'descriptiveMetadata.objectIdentificationWrap.objectMeasurementsWrap.objectMeasurementsSet.displayObjectMeasurements', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '14', '14', 'イベント内容（表示用）', 'イベント内容（表示用）', 'textarea', '0', '1', '0', '0', '0', 'coverage', 'coverage', '', 'descriptiveMetadata.eventWrap.eventSet.displayEvent', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '15', '15', 'イベントタイプ（語）', 'イベントタイプ（語）', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventType.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '16', '16', 'イベント行為者／役割（表示用）', 'イベント行為者／役割（表示用）', 'text', '0', '1', '0', '0', '0', 'description', 'description', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventActor.displayActorInRole', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '17', '17', 'イベント発生期間(表示用)', 'イベント発生期間(表示用)', 'text', '0', '1', '0', '0', '0', 'coverage', 'coverage', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventDate.displayDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '18', '18', 'イベント発生期間（西暦）（開始日）', 'イベント発生期間（西暦）（開始日）', 'date', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventDate.date.earliestDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '19', '19', 'イベント発生期間（西暦）（終了日）', 'イベント発生期間（西暦）（終了日）', 'date', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventDate.date.latestDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '20', '20', 'イベント発生時代・年代（語）', 'イベント発生時代・年代（語）', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.periodName.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '21', '21', 'イベント発生地（表示用）', 'イベント発生地（表示用）', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventPlace.displayPlace', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '22', '22', 'イベント発生地緯度・経度', 'イベント発生地緯度・経度', 'text', '0', '1', '0', '0', '0', 'spatial', 'coverage', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventPlace.place.gml', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '23', '23', 'イベント素材/技術(表示用)', 'イベント素材/技術(表示用)', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventMaterialsTech.displayMaterialsTech', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '24', '24', '主題(表示用)', '主題(表示用)', 'text', '0', '1', '0', '0', '0', 'subject', 'subject', '', 'descriptiveMetadata.objectRelationWrap.subjectWrap.subjectSet.displaySubject', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '25', '25', '関連作品(表示用)', '関連作品(表示用)', 'text', '0', '1', '0', '0', '0', '', '', '', 'descriptiveMetadata.objectRelationWrap.relatedWorksWrap.relatedWorkSet.relatedWork.displayObject', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '26', '26', '記録ID', '記録ID', 'text', '1', '1', '0', '0', '0', 'source', 'source', '', 'administrativeMetadata.recordWrap.recordID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '27', '27', '記録タイプ（語）', '記録タイプ（語）', 'text', '1', '1', '0', '0', '0', '', '', '', 'administrativeMetadata.recordWrap.recordType.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '28', '28', '記録者名（値）', '記録者名（値）', 'name', '1', '1', '0', '0', '0', 'creator', 'creator', '', 'administrativeMetadata.recordWrap.recordSource.legalBodyName.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '29', '29', '記録情報リンク', '記録情報リンク', 'link', '0', '1', '0', '0', '0', 'URI', 'identifier', '', 'administrativeMetadata.recordWrap.recordInfoSet.recordInfoLink', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '30', '30', '記録情報メタデータ記録日', '記録情報メタデータ記録日', 'date', '0', '1', '0', '0', '0', 'date', 'date', '', 'administrativeMetadata.recordWrap.recordInfoSet.recordMetadataDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '31', '31', 'リソースURL', 'リソースURL', 'link', '0', '1', '0', '0', '0', '', '', '', 'administrativeMetadata.resourceWrap.resourceSet.resourceRepresentation.linkResource', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '32', '32', 'リソース説明/記述', 'リソース説明/記述', 'textarea', '0', '1', '0', '0', '0', '', '', '', 'administrativeMetadata.resourceWrap.resourceSet.resourceDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '33', '33', 'リソース所有者名（値）', 'リソース所有者名（値）', 'name', '0', '1', '0', '0', '0', 'contributor', 'contributor', '', 'administrativeMetadata.resourceWrap.resourceSet.resourceSource.legalBodyName.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '34', '34', 'リソース権利クレジットライン', 'メタデータ校閲者(validator)リソース権利クレジットライン', 'text', '0', '1', '0', '0', '0', '', '', '', 'administrativeMetadata.resourceWrap.resourceSet.rightsResource.creditLine', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '35', '35', '機関ID', '機関ID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '36', '36', 'コンテンツID', 'コンテンツID', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-    ('20017', '37', '37', 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', '1', '0', '0', '0', '1', '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');
+    (10001, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 7, 7, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 12, 12, '論文ID（NAID）', '論文ID（NAID）', 'text', 0, 0, 0, 0, 0, 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 13, 13, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 14, 14, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 7, 7, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 12, 12, '論文ID（NAID）', '論文ID（NAID）', 'text', 0, 0, 0, 0, 0, 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 13, 13, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 14, 14, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 7, 7, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 12, 12, '論文ID（NAID）', '論文ID（NAID）', 'text', 0, 0, 0, 0, 0, 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 13, 13, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 14, 14, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relationIsBasisFor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 7, 7, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 12, 12, '論文ID（NAID）', '論文ID（NAID）', 'text', 0, 0, 0, 0, 0, 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 13, 13, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 14, 14, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 6, 6, '会議概要（会議名, 開催地, 会期, 主催者等）', '会議概要（会議名, 開催地, 会期, 主催者等）', 'textarea', '0', '1', '0', '1', '0', 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 7, 7, '発表年月日', '発表年月日', 'date', 0, 0, 0, 0, 0, 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 8, 8, '公開者', '公開者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 9, 9, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 10, 10, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 11, 11, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 12, 12, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 13, 13, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 14, 14, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 15, 15, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 16, 16, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 17, 17, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 5, 5, '公開者', '公開者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 6, 6, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 7, 7, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 8, 8, '学位名', '学位名', 'text', 0, 0, 0, 1, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 9, 9, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 1, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 10, 10, '学位授与年度', '学位授与年度', 'text', 0, 1, 0, 1, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 11, 11, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 12, 12, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 1, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 13, 13, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 14, 14, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 15, 15, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 16, 16, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 17, 17, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 18, 18, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 19, 19, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 20, 20, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 21, 21, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 1, 1, 'その他（別言語等）の研究課題名', 'その他（別言語等）の研究課題名', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 2, 2, '研究代表者', '研究代表者', 'name', 0, 0, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 3, 3, '研究代表者別名', '研究代表者別名', 'name', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 4, 4, '研究代表者ID', '研究代表者ID', 'text', 0, 0, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 5, 5, '研究分担者', '研究分担者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 6, 6, '研究分担者別名', '研究分担者別名', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 7, 7, '研究分担者ID', '研究分担者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 8, 8, '報告年度', '報告年度', 'date', 0, 0, 0, 1, 0, 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 9, 9, '研究課題番号', '研究課題番号', 'text', 0, 0, 0, 1, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 10, 10, '研究代表者番号', '研究代表者番号', 'text', 0, 0, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 11, 11, '研究機関', '研究機関', 'text', 0, 0, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 12, 12, '助成元', '助成元', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 13, 13, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 7, 7, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 8, 8, '出版年月日', '出版年月日', 'date', 0, 0, 0, 1, 0, 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier','generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 12, 12, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 13, 13, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 14, 14, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 15, 15, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 16, 16, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 17, 17, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 18, 18, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 19, 19, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 20, 20, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 7, 7, '図書名', '図書名', 'text', 0, 0, 0, 1, 0, 'jtitle', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 9, 9, '開始ページ', '開始ページ', 'text', 0, 0, 0, 1, 0, 'spage', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 10, 10, '終了ページ', '終了ページ', 'text', 0, 0, 0, 1, 0, 'epage', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 11, 11, '出版年月日', '出版年月日', 'date', 0, 0, 0, 1, 0, 'dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 12, 12, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 13, 13, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 14, 14, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 1, 1, 'その他（別言語等）のタイトル', 'その他（別言語等）のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 2, 2, '著者', '著者', 'name', 0, 1, 1, 1, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 3, 3, '著者（英）', '著者（英）', 'name', 0, 1, 0, 0, 0, '', '', '', '', 'english', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 4, 4, '著者ID', '著者ID', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 5, 5, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 6, 6, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 7, 7, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 8, 8, '出版者', '出版者', 'text', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 9, 9, 'ISSN', 'ISSN', 'text', 0, 0, 0, 0, 0, 'issn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 10, 10, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 11, 11, '書誌レコードID', '書誌レコードID', 'text', 0, 0, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 12, 12, '論文ID（NAID）', '論文ID（NAID）', 'text', 0, 0, 0, 0, 0, 'NAID', 'identifier', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 13, 13, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 14, 14, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 15, 15, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 16, 16, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 17, 17, '関連サイト', '関連サイト', 'link', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 18, 18, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 19, 19, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 20, 20, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 21, 21, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 22, 22, 'コンテンツ本体', 'コンテンツ本体', 'file', 0, 1, 1, 1, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 23, 23, '見出し', '見出し', 'heading', 0, 0, 0, 0, 0, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 2, 2, '著者名', '著者名', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 3, 3, '抄録', '抄録', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 4, 4, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 5, 5, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 6, 6, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 7, 7, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 8, 8, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 9, 9, '資源識別子', '資源識別子', 'link', 0, 1, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 10, 10, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 11, 11, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 12, 12, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 13, 13, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 14, 14, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 15, 15, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 16, 16, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20001, 17, 17, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 1, 1, 'その他(別言語等)のタイトル', 'その他(別言語等)のタイトル', 'text', 0, 1, 0, 0, 0, 'alternative', 'title', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 2, 2, '作成者', '作成者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 3, 3, '作成者(その他言語)', '作成者(その他言語)', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 4, 4, '国立情報学研究所 メタデータ主題語彙集', '国立情報学研究所 メタデータ主題語彙集', 'text', 0, 1, 0, 0, 0, 'NIIsubject', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 5, 5, '日本十進分類法', '日本十進分類法', 'text', 0, 1, 0, 0, 0, 'NDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 6, 6, '国立国会図書館分類表', '国立国会図書館分類表', 'text', 0, 1, 0, 0, 0, 'NDLC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 7, 7, '日本件名標目', '日本件名標目', 'text', 0, 1, 0, 0, 0, 'BSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 8, 8, '国立国会図書館件名標目表', '国立国会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'NDLSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 9, 9, '医学件名標目表', '医学件名標目表', 'text', 0, 1, 0, 0, 0, 'MeSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 10, 10, 'デューイ十進分類法', 'デューイ十進分類法', 'text', 0, 1, 0, 0, 0, 'DDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 11, 11, '米国議会図書館分類法', '米国議会図書館分類法', 'text', 0, 1, 0, 0, 0, 'LCC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 12, 12, '国際十進分類法', '国際十進分類法', 'text', 0, 1, 0, 0, 0, 'UDC', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 13, 13, '米国議会図書館件名標目表', '米国議会図書館件名標目表', 'text', 0, 1, 0, 0, 0, 'LCSH', 'subject', 'generalKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 14, 14, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 15, 15, '公開者', '公開者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 16, 16, '公開者(その他言語)', '公開者(その他言語)', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 17, 17, '寄与者', '寄与者', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', 'japanese', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 18, 18, '寄与者(その他言語)', '寄与者(その他言語)', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 19, 19, '日付', '日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributePublishDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 20, 20, '資源タイプ', '資源タイプ', 'textarea', 0, 1, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 21, 21, 'フォーマット', 'フォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 22, 22, 'その他の資源識別子', 'その他の資源識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 23, 23, '資源識別子URI', '資源識別子URI', 'link', 1, 0, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 24, 24, '本文フルテキストへのリンク', '本文フルテキストへのリンク', 'link', 0, 1, 0, 0, 0, 'fullTextURL', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 25, 26, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 26, 27, '処理レコードID(総合目録DB)', '処理レコードID(総合目録DB)', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 27, 28, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 0, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 28, 29, '情報源', '情報源', 'text', 0, 1, 0, 0, 0, 'source', 'source', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 29, 30, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 30, 31, '他の資源との関係', '他の資源との関係', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 31, 32, 'PubMed番号', 'PubMed番号', 'text', 0, 0, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 32, 33, 'DOI', 'DOI', 'text', 0, 0, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 33, 36, '異版である', '異版である', 'link', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 34, 37, '異版あり', '異版あり', 'link', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 35, 38, '置換される', '置換される', 'link', 0, 1, 0, 0, 0, 'isReplacedBy', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 36, 39, '置換する', '置換する', 'link', 0, 1, 0, 0, 0, 'replaces', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 37, 40, '要件とされる', '要件とされる', 'link', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 38, 41, '要件とする', '要件とする', 'link', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 39, 42, '部分である', '部分である', 'link', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 40, 43, '部分を持つ', '部分を持つ', 'link', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 41, 44, '参照される', '参照される', 'link', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 42, 45, '参照する', '参照する', 'link', 0, 1, 0, 0, 0, 'references', 'relation', 'relationRreferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 43, 46, '別フォーマットである', '別フォーマットである', 'link', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 44, 47, '別フォーマットあり', '別フォーマットあり', 'link', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 45, 48, '範囲', '範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 46, 49, '空間的', '空間的', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 47, 50, '国立情報学研究所 メタデータ主題語彙集(地域)', '国立情報学研究所 メタデータ主題語彙集(地域)', 'text', 0, 1, 0, 0, 0, 'NIIspatial', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 48, 51, '時間的', '時間的', 'text', 0, 1, 0, 0, 0, 'temporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 49, 52, '国立情報学研究所 メタデータ主題語彙集(時代)', '国立情報学研究所 メタデータ主題語彙集(時代)', 'text', 0, 1, 0, 0, 0, 'NIItemporal', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 50, 53, '権利', '権利', 'text', 0, 1, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 51, 54, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 52, 59, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 53, 60, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 54, 61, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 55, 55, '学位授与番号', '学位授与番号', 'text', 0, 0, 0, 0, 0, 'grantid', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 56, 56, '学位授与年月日', '学位授与年月日', 'date', 0, 0, 0, 0, 0, 'dateofgranted', 'date', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 57, 57, '学位名', '学位名', 'text', 0, 0, 0, 0, 0, 'degreename', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 58, 58, '学位授与機関', '学位授与機関', 'text', 0, 0, 0, 0, 0, 'grantor', 'description', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 59, 34, 'NII論文ID', 'NII論文ID', 'text', 0, 0, 0, 0, 0, 'NAID', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 60, 35, '医中誌ID', '医中誌ID', 'text', 0, 0, 0, 0, 0, 'ichushi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 61, 25, 'ISBN', 'ISBN', 'text', 0, 1, 0, 0, 0, 'isbn', 'identifier', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 1, 1, 'URI', 'URI', 'link', 0, 1, 0, 0, 0, 'URI', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 2, 2, 'ISSN', 'ISSN', 'text', 0, 1, 0, 0, 0, 'issn', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 3, 3, 'NCID', 'NCID', 'text', 0, 1, 0, 0, 0, 'NCID', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 4, 4, '書誌情報', '書誌情報', 'biblio_info', 0, 0, 0, 1, 0, 'jtitle,volume,issue,spage,epage,dateofissued', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 5, 5, '著者版フラグ', '著者版フラグ', 'select', 0, 0, 0, 0, 0, 'textversion', '', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 6, 6, 'その他の識別子', 'その他の識別子', 'text', 0, 1, 0, 0, 0, 'identifier', 'identifier', 'generalIdentifier', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 7, 7, '言語', '言語', 'text', 0, 1, 0, 0, 0, 'language', 'language', 'generalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 8, 8, '内容記述', '内容記述', 'textarea', 0, 1, 0, 0, 0, 'description', 'description', 'generalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 9, 9, '適用範囲', '適用範囲', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', 'generalCoverage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 10, 10, '構成', '構成', 'select', 0, 0, 0, 0, 0, '', '', 'generalStructure', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 11, 11, '粒度', '粒度', 'select', 0, 0, 0, 0, 0, '', '', 'generalAggregationLevel', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 12, 12, 'エディション（版）', 'エディション（版）', 'text', 0, 0, 0, 0, 0, '', '', 'lifeCycleVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 13, 13, 'ステータス（現状）', 'ステータス（現状）', 'select', 0, 0, 0, 0, 0, '', '', 'lifeCycleStatus', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 14, 14, '著者', '著者', 'name', 0, 1, 0, 0, 0, 'creator', 'creator', 'lifeCycleContributeRoleAuthor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 15, 15, '発行者', '発行者', 'name', 0, 1, 0, 0, 0, 'publisher', 'publisher', 'lifeCycleContributeRolePublisher', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 16, 16, '寄与の日付', '寄与の日付', 'date', 0, 1, 0, 0, 0, 'date', 'date', 'lifeCycleContributeDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 17, 17, '原作者', '原作者', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleInitiator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 18, 18, '終了者（廃止者）', '終了者（廃止者）', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleTerminator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 19, 19, '校閲者', '校閲者', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 20, 20, '編集者', '編集者', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleEditor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 21, 21, 'グラフィックデザイナー', 'グラフィックデザイナー', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleGraphicalDesigner', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 22, 22, '技術', '技術', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleTechnicalImplementer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 23, 23, 'コンテンツプロバイダー', 'コンテンツプロバイダー', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleContentProvider', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 24, 24, '技術監修', '技術監修', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleTechnicalValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 25, 25, '教育監修', '教育監修', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleEducationalValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 26, 26, '台本作者', '台本作者', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleScriptWriter', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 27, 27, 'インストラクショナルデザイナー', 'インストラクショナルデザイナー', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleInstructionalDesigner', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 28, 28, '教科・専門家', '教科・専門家', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleSubjectMatterExpert', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 29, 29, 'その他の関係者(未知)', 'その他の関係者(未知)', 'text', 0, 1, 0, 0, 0, 'contributor', 'contributor', 'lifeCycleContributeRoleUnknown', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 30, 30, '寄与者', '寄与者', 'text', 0, 1, 0, 0, 0, '', '', 'lifeCycleContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 31, 31, 'メタデータ識別子', 'メタデータ識別子', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataIdentifer', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 32, 32, 'メタデータ作成者', 'メタデータ作成者', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataContributeRoleCreator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 33, 33, 'メタデータ校閲者', 'メタデータ校閲者', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataContributeRoleValidator', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 34, 34, 'メタデータへの寄与', 'メタデータへの寄与', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataContribute', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 35, 35, 'メタデータスキーマ', 'メタデータスキーマ', 'text', 0, 1, 0, 0, 0, '', '', 'metaMetadataMetadataSchema', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 36, 36, 'メタデータの記述言語', 'メタデータの記述言語', 'text', 0, 0, 0, 0, 0, '', '', 'metaMetadataLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 37, 37, 'ファイルフォーマット', 'ファイルフォーマット', 'text', 0, 1, 0, 0, 0, 'format', 'format', 'technicalFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 38, 38, 'ファイルサイズ', 'ファイルサイズ', 'text', 0, 0, 0, 0, 0, '', '', 'technicalSize', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 39, 39, 'ファイルリンク', 'ファイルリンク', 'text', 0, 1, 0, 0, 0, '', '', 'technicalLocation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 40, 40, '動作環境', '動作環境', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 41, 41, '動作条件', '動作条件', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeName', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 42, 42, '推奨バージョン(下限)', '推奨バージョン(下限)', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeMinimumVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 43, 43, '推奨バージョン(上限)', '推奨バージョン(上限)', 'text', 0, 1, 0, 0, 0, '', '', 'technicalRequirementOrCompositeMaximumVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 44, 44, 'インストール手順', 'インストール手順', 'text', 0, 0, 0, 0, 0, '', '', 'technicalInstallationRemarks', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 45, 45, 'その他の技術要件', 'その他の技術要件', 'text', 0, 0, 0, 0, 0, '', '', 'technicalOtherPlatformRequirements', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 46, 46, '再生時間', '再生時間', 'text', 0, 0, 0, 0, 0, '', '', 'technicalDuration', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 47, 47, '双方向性・種別', '双方向性・種別', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalInteractivityType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 48, '学習資源・種別', '学習資源・種別', 'checkbox', 0, 0, 0, 0, 0, 'type', 'type', 'educationalLearningResourceType', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 49, 49, '双方向性・レベル', '双方向性・レベル', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalInteractivityLevel', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 50, 50, '意味論的密度', '意味論的密度', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalSemanticDensity', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 51, 51, '想定利用者', '想定利用者', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalIntendedEndUserRole', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 52, 52, '想定利用環境', '想定利用環境', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalContext', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 53, 53, '想定利用者の対象年齢', '想定利用者の対象年齢', 'text', 0, 1, 0, 0, 0, '', '', 'educationalTypicalAgeRange', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 54, 54, '想定利用者における難易度', '想定利用者における難易度', 'checkbox', 0, 0, 0, 0, 0, '', '', 'educationalDifficulty', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 55, 55, '推定学習時間', '推定学習時間', 'text', 0, 1, 0, 0, 0, '', '', 'educationalTypicalLearningTime', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 56, 56, '教育情報・備考', '教育情報・備考', 'textarea', 0, 1, 0, 0, 0, '', '', 'educationalDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 57, 57, '想定利用者の使用言語', '想定利用者の使用言語', 'text', 0, 1, 0, 0, 0, '', '', 'educationalLanguage', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 58, 58, '使用料', '使用料', 'select', 0, 0, 0, 0, 0, '', '', 'rightsCost', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 59, 59, '著作権・利用制限条件', '著作権・利用制限条件', 'select', 0, 0, 0, 0, 0, '', '', 'rightsCopyrightAndOtherRestrictions', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 60, 60, '権利関係・備考', '権利関係・備考', 'textarea', 0, 0, 0, 0, 0, 'rights', 'rights', 'rightsDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 61, 61, 'PubMed番号', 'PubMed番号', 'text', 0, 1, 0, 0, 0, 'pmid', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 62, 62, 'DOI', 'DOI', 'text', 0, 1, 0, 0, 0, 'doi', 'relation', 'relation', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 63, 63, '異版である', '異版である', 'text', 0, 1, 0, 0, 0, 'isVersionOf', 'relation', 'relationIsVersionOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 64, 64, '異版あり', '異版あり', 'text', 0, 1, 0, 0, 0, 'hasVersion', 'relation', 'relationHasVersion', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 65, 65, '要件とされる', '要件とされる', 'text', 0, 1, 0, 0, 0, 'isRequiredBy', 'relation', 'relationIsRequiredBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 66, 66, '要件とする', '要件とする', 'text', 0, 1, 0, 0, 0, 'requires', 'relation', 'relationRequires', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 67, 67, '部分である', '部分である', 'text', 0, 1, 0, 0, 0, 'isPartOf', 'relation', 'relationIsPartOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 68, 68, '部分を持つ', '部分を持つ', 'text', 0, 1, 0, 0, 0, 'hasPart', 'relation', 'relationHasPart', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 69, 69, '参照される', '参照される', 'text', 0, 1, 0, 0, 0, 'isReferencedBy', 'relation', 'relationIsReferencedBy', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 70, 70, '参照する', '参照する', 'text', 0, 1, 0, 0, 0, 'references', 'relation', 'relationReferences', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 71, 71, '別フォーマットである', '別フォーマットである', 'text', 0, 1, 0, 0, 0, 'isFormatOf', 'relation', 'relationIsFormatOf', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 72, 72, '別フォーマットあり', '別フォーマットあり', 'text', 0, 1, 0, 0, 0, 'hasFormat', 'relation', 'relationHasFormat', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 73, 73, '基になる', '基になる', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relationIsBasisFor', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 74, 74, '基づいている', '基づいている', 'text', 0, 1, 0, 0, 0, 'relation', 'relation', 'relationIsBasedOn', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 75, 75, '他の資源との関係', '他の資源との関係', 'textarea', 0, 1, 0, 0, 0, 'relation', 'relation', 'relationResource', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 76, 76, '教育利用コメント・作成者', '教育利用コメント・作成者', 'text', 0, 1, 0, 0, 0, '', '', 'annotationEntity', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 77, 77, '教育利用コメント・作成日', '教育利用コメント・作成日', 'date', 0, 1, 0, 0, 0, '', '', 'annotationDate', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 78, 78, '教育利用コメント・備考', '教育利用コメント・備考', 'textarea', 0, 1, 0, 0, 0, '', '', 'annotationDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 79, '分類目的', '分類目的', 'checkbox', 0, 0, 0, 0, 0, '', '', 'classificationPurpose', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 80, 80, '分類体系の所在・名称', '分類体系の所在・名称', 'text', 0, 1, 0, 0, 0, '', '', 'classificationTaxonPathSource', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 81, 81, '分類体系における分類項目', '分類体系における分類項目', 'text', 0, 1, 0, 0, 0, '', '', 'classificationTaxonPathTaxon', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 82, 82, '分類・備考', '分類・備考', 'textarea', 0, 1, 0, 0, 0, '', '', 'classificationDescription', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 83, 83, '分類・キーワード', '分類・キーワード', 'text', 0, 1, 0, 0, 0, '', '', 'classificationKeyword', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 84, 84, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 85, 85, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 86, 86, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 1, 1, 'lidoレコードID', 'lidoレコードID', 'text', 1, 1, 0, 0, 0, 'identifier', 'identifier', '', 'lidoRecID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 2, 2, '作品タイプID', '作品タイプID', 'text', 1, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectClassificationWrap.objectWorkTypeWrap.objectWorkType.conceptID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 3, 3, '作品タイプ（語）', '作品タイプ（語）', 'text', 1, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectClassificationWrap.objectWorkTypeWrap.objectWorkType.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 4, 4, '分類ID', '分類ID', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectClassificationWrap.classificationWrap.classification.conceptID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 5, 5, '分類（語）', '分類（語）', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectClassificationWrap.classificationWrap.classification.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 6, 6, '資料/作品名（値）', '資料/作品名（値）', 'text', 0, 1, 0, 0, 0, 'title', 'title', '', 'descriptiveMetadata.objectIdentificationWrap.titleWrap.titleSet.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 7, 7, '銘/題辞写', '銘/題辞写', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectIdentificationWrap.inscriptionsWrap.inscriptions.inscriptionTranscription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 8, 8, '所蔵者名（値）', '所蔵者名（値）', 'name', 0, 1, 0, 0, 0, 'rights', 'rights', '', 'descriptiveMetadata.objectIdentificationWrap.repositoryWrap.repositorySet.repositoryName.legalBodyName.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 9, 9, '所蔵者ウェブリンク', '所蔵者ウェブリンク', 'link', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectIdentificationWrap.repositoryWrap.repositorySet.repositoryName.legalBodyWeblink', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 10, 10, '所蔵者資料/作品ID', '所蔵者資料/作品ID', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectIdentificationWrap.repositoryWrap.repositorySet.workID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 11, 11, '資料/作品状態（状態）', '資料/作品状態（状態）', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectIdentificationWrap.displayStateEditionWrap.displayState', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 12, 12, '記述ノート（値）', '記述ノート（値）', 'text', 0, 1, 0, 0, 0, 'description', 'description', '', 'descriptiveMetadata.objectIdentificationWrap.objectDescriptionWrap.objectDescriptionSet.descriptiveNoteValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 13, 13, '測定（表示用）', '測定（表示用）', 'text', 0, 1, 0, 0, 0, 'description', 'description', '', 'descriptiveMetadata.objectIdentificationWrap.objectMeasurementsWrap.objectMeasurementsSet.displayObjectMeasurements', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 14, 14, 'イベント内容（表示用）', 'イベント内容（表示用）', 'textarea', 0, 1, 0, 0, 0, 'coverage', 'coverage', '', 'descriptiveMetadata.eventWrap.eventSet.displayEvent', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 15, 15, 'イベントタイプ（語）', 'イベントタイプ（語）', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventType.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 16, 16, 'イベント行為者／役割（表示用）', 'イベント行為者／役割（表示用）', 'text', 0, 1, 0, 0, 0, 'description', 'description', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventActor.displayActorInRole', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 17, 17, 'イベント発生期間(表示用)', 'イベント発生期間(表示用)', 'text', 0, 1, 0, 0, 0, 'coverage', 'coverage', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventDate.displayDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 18, 18, 'イベント発生期間（西暦）（開始日）', 'イベント発生期間（西暦）（開始日）', 'date', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventDate.date.earliestDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 19, 19, 'イベント発生期間（西暦）（終了日）', 'イベント発生期間（西暦）（終了日）', 'date', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventDate.date.latestDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 20, 20, 'イベント発生時代・年代（語）', 'イベント発生時代・年代（語）', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.periodName.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 21, 21, 'イベント発生地（表示用）', 'イベント発生地（表示用）', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventPlace.displayPlace', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 22, 22, 'イベント発生地緯度・経度', 'イベント発生地緯度・経度', 'text', 0, 1, 0, 0, 0, 'spatial', 'coverage', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventPlace.place.gml', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 23, 23, 'イベント素材/技術(表示用)', 'イベント素材/技術(表示用)', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.eventWrap.eventSet.event.eventMaterialsTech.displayMaterialsTech', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 24, 24, '主題(表示用)', '主題(表示用)', 'text', 0, 1, 0, 0, 0, 'subject', 'subject', '', 'descriptiveMetadata.objectRelationWrap.subjectWrap.subjectSet.displaySubject', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 25, 25, '関連作品(表示用)', '関連作品(表示用)', 'text', 0, 1, 0, 0, 0, '', '', '', 'descriptiveMetadata.objectRelationWrap.relatedWorksWrap.relatedWorkSet.relatedWork.displayObject', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 26, 26, '記録ID', '記録ID', 'text', 1, 1, 0, 0, 0, 'source', 'source', '', 'administrativeMetadata.recordWrap.recordID', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 27, 27, '記録タイプ（語）', '記録タイプ（語）', 'text', 1, 1, 0, 0, 0, '', '', '', 'administrativeMetadata.recordWrap.recordType.term', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 28, 28, '記録者名（値）', '記録者名（値）', 'name', 1, 1, 0, 0, 0, 'creator', 'creator', '', 'administrativeMetadata.recordWrap.recordSource.legalBodyName.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 29, 29, '記録情報リンク', '記録情報リンク', 'link', 0, 1, 0, 0, 0, 'URI', 'identifier', '', 'administrativeMetadata.recordWrap.recordInfoSet.recordInfoLink', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 30, 30, '記録情報メタデータ記録日', '記録情報メタデータ記録日', 'date', 0, 1, 0, 0, 0, 'date', 'date', '', 'administrativeMetadata.recordWrap.recordInfoSet.recordMetadataDate', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 31, 31, 'リソースURL', 'リソースURL', 'link', 0, 1, 0, 0, 0, '', '', '', 'administrativeMetadata.resourceWrap.resourceSet.resourceRepresentation.linkResource', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 32, 32, 'リソース説明/記述', 'リソース説明/記述', 'textarea', 0, 1, 0, 0, 0, '', '', '', 'administrativeMetadata.resourceWrap.resourceSet.resourceDescription', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 33, 33, 'リソース所有者名（値）', 'リソース所有者名（値）', 'name', 0, 1, 0, 0, 0, 'contributor', 'contributor', '', 'administrativeMetadata.resourceWrap.resourceSet.resourceSource.legalBodyName.appellationValue', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 34, 34, 'リソース権利クレジットライン', 'メタデータ校閲者(validator)リソース権利クレジットライン', 'text', 0, 1, 0, 0, 0, '', '', '', 'administrativeMetadata.resourceWrap.resourceSet.rightsResource.creditLine', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 35, 35, '機関ID', '機関ID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 36, 36, 'コンテンツID', 'コンテンツID', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20017, 37, 37, 'コンテンツ更新日時', 'コンテンツ更新日時', 'text', 1, 0, 0, 0, 1, '', '', '', '', '', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0);
 
 INSERT INTO `repository_item_attr_candidate` VALUE
-('10001', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10001', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10001', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10001', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10002', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10002', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10002', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10002', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10003', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10003', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10003', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10003', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10004', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10004', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10004', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10004', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10005', '14', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10005', '14', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10005', '14', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10005', '14', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10006', '18', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10006', '18', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10006', '18', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10006', '18', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10007', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10007', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10007', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10007', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10008', '17', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10008', '17', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10008', '17', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10008', '17', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10009', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10009', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10009', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10009', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10010', '20', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10010', '20', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10010', '20', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('10010', '20', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20002', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20002', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20002', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20002', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20003', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20003', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20003', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20003', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20004', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20004', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20004', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20004', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20005', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20005', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20005', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20005', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20006', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20006', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20006', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20006', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20007', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20007', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20007', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20007', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20008', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20008', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20008', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20008', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20009', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20009', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20009', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20009', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20010', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20010', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20010', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20010', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20011', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20011', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20011', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20011', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20012', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20012', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20012', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20012', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20013', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20013', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20013', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20013', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20014', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20014', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20014', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20014', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20015', '51', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20015', '51', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20015', '51', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20015', '51', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '5', '1', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '5', '2', 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '5', '3', 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '5', '4', 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '10', '1', 'atomic', 'atomic', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '10', '2', 'collection', 'collection', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '10', '3', 'networked', 'networked', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '10', '4', 'hierarchical', 'hierarchical', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '10', '5', 'linear', 'linear', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '11', '1', '1', '1', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '11', '2', '2', '2', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '11', '3', '3', '3', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '11', '4', '4', '4', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '13', '1', 'draft', 'draft', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '13', '2', 'final', 'final', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '13', '3', 'revised', 'revised', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '13', '4', 'unavailable', 'unavailable', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '47', '1', 'active', 'active', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '47', '2', 'expositive', 'expositive', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '47', '3', 'mixed', 'mixed', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '1', 'exercise', 'exercise', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '2', 'simulation', 'simulation', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '3', 'questionnaire', 'questionnaire', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '4', 'diagram', 'diagram', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '5', 'figure', 'figure', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '6', 'graph', 'graph', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '7', 'index', 'index', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '8', 'slide', 'slide', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '9', 'table', 'table', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '10', 'narrative text', 'narrative text', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '11', 'exam', 'exam', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '12', 'experiment', 'experiment', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '13', 'problem statement', 'problem statement', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '14', 'self assessment', 'self assessment', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '48', '15', 'lecture', 'lecture', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '49', '1', 'very low', 'very low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '49', '2', 'low', 'low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '49', '3', 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '49', '4', 'high', 'high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '49', '5', 'very high', 'very high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '50', '1', 'very low', 'very low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '50', '2', 'low', 'low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '50', '3', 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '50', '4', 'high', 'high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '50', '5', 'very high', 'very high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '51', '1', 'teacher', 'teacher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '51', '2', 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '51', '3', 'learner', 'learner', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '51', '4', 'manager', 'manager', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '52', '1', 'school', 'school', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '52', '2', 'higher education', 'higher education', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '52', '3', 'training', 'training', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '52', '4', 'other', 'other', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '54', '1', 'very easy', 'very easy', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '54', '2', 'easy', 'easy', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '54', '3', 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '54', '4', 'difficult', 'difficult', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '54', '5', 'very difficult', 'very difficult', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '58', '1', 'yes', 'yes', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '58', '2', 'no', 'no', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '59', '1', 'yes', 'yes', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '59', '2', 'no', 'no', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '1', 'discipline', 'discipline', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '2', 'idea', 'idea', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '3', 'prerequisite', 'prerequisite', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '4', 'educational objective', 'educational objective', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '5', 'accessibility restrictions', 'accessibility restrictions', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '6', 'educational level', 'educational level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '7', 'skill level', 'skill level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '8', 'security level', 'security level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0'),
-('20016', '79', '9', 'competency', 'competency', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', '0');
+    (10001, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10001, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10002, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10003, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10004, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 14, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 14, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 14, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10005, 14, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 18, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 18, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 18, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10006, 18, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10007, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 17, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 17, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 17, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10008, 17, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10009, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 20, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 20, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 20, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (10010, 20, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20002, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20003, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20004, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20005, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20006, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20007, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20008, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20009, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20010, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20011, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20012, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20013, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20014, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 51, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 51, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 51, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20015, 51, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 5, 1, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 5, 2, 'publisher', 'publisher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 5, 3, 'ETD', 'ETD', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 5, 4, 'none', 'none', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 10, 1, 'atomic', 'atomic', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 10, 2, 'collection', 'collection', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 10, 3, 'networked', 'networked', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 10, 4, 'hierarchical', 'hierarchical', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 10, 5, 'linear', 'linear', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 11, 1, '1', '1', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 11, 2, '2', '2', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 11, 3, '3', '3', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 11, 4, '4', '4', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 13, 1, 'draft', 'draft', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 13, 2, 'final', 'final', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 13, 3, 'revised', 'revised', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 13, 4, 'unavailable', 'unavailable', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 47, 1, 'active', 'active', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 47, 2, 'expositive', 'expositive', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 47, 3, 'mixed', 'mixed', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 1, 'exercise', 'exercise', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 2, 'simulation', 'simulation', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 3, 'questionnaire', 'questionnaire', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 4, 'diagram', 'diagram', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 5, 'figure', 'figure', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 6, 'graph', 'graph', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 7, 'index', 'index', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 8, 'slide', 'slide', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 9, 'table', 'table', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 10, 'narrative text', 'narrative text', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 11, 'exam', 'exam', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 12, 'experiment', 'experiment', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 13, 'problem statement', 'problem statement', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 14, 'self assessment', 'self assessment', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 48, 15, 'lecture', 'lecture', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 49, 1, 'very low', 'very low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 49, 2, 'low', 'low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 49, 3, 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 49, 4, 'high', 'high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 49, 5, 'very high', 'very high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 50, 1, 'very low', 'very low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 50, 2, 'low', 'low', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 50, 3, 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 50, 4, 'high', 'high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 50, 5, 'very high', 'very high', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 51, 1, 'teacher', 'teacher', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 51, 2, 'author', 'author', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 51, 3, 'learner', 'learner', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 51, 4, 'manager', 'manager', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 52, 1, 'school', 'school', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 52, 2, 'higher education', 'higher education', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 52, 3, 'training', 'training', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 52, 4, 'other', 'other', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 54, 1, 'very easy', 'very easy', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 54, 2, 'easy', 'easy', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 54, 3, 'medium', 'medium', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 54, 4, 'difficult', 'difficult', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 54, 5, 'very difficult', 'very difficult', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 58, 1, 'yes', 'yes', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 58, 2, 'no', 'no', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 59, 1, 'yes', 'yes', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 59, 2, 'no', 'no', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 1, 'discipline', 'discipline', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 2, 'idea', 'idea', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 3, 'prerequisite', 'prerequisite', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 4, 'educational objective', 'educational objective', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 5, 'accessibility restrictions', 'accessibility restrictions', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 6, 'educational level', 'educational level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 7, 'skill level', 'skill level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 8, 'security level', 'security level', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0),
+    (20016, 79, 9, 'competency', 'competency', '1', '1', '', '2008-03-18 00:00:00.000', '2008-03-18 00:00:00.000', '', 0);
 
 INSERT INTO `repository_pdf_cover_parameter` VALUE
     ('headerType','text','','','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000',''),
@@ -2705,317 +2840,375 @@ INSERT INTO `repository_pdf_cover_parameter` VALUE
     ('headerAlign','right','','','','1','1','0','2008-03-18 00:00:00.000','2008-03-18 00:00:00.000','');
 
 INSERT INTO `repository_item_type_name_multilanguage` VALUE
-('20016', '1', 'japanese', 'URI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '2', 'japanese', 'ISSN', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '3', 'japanese', 'NCID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '4', 'japanese', '書誌情報', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '5', 'japanese', '著者版フラグ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '6', 'japanese', 'その他の識別子', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '7', 'japanese', '言語', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '8', 'japanese', '内容記述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '9', 'japanese', '適用範囲', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '10', 'japanese', '構成', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '11', 'japanese', '粒度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '12', 'japanese', 'エディション（版）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '13', 'japanese', 'ステータス（現状）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '14', 'japanese', '著者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '15', 'japanese', '発行者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '16', 'japanese', '寄与の日付', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '17', 'japanese', '原作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '18', 'japanese', '更新者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '19', 'japanese', '校閲者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '20', 'japanese', '編集者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '21', 'japanese', 'グラフィックデザイナー', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '22', 'japanese', '技術', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '23', 'japanese', 'コンテンツプロバイダー', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '24', 'japanese', '技術監修', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '25', 'japanese', '教育監修', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '26', 'japanese', '台本作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '27', 'japanese', 'インストラクショナルデザイナー', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '28', 'japanese', '教科・専門家', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '29', 'japanese', 'その他の関係者(未知)', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '30', 'japanese', '寄与者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '31', 'japanese', 'メタデータ識別子', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '32', 'japanese', 'メタデータ作成者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '33', 'japanese', 'メタデータ校閲者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '34', 'japanese', 'メタデータの寄与者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '35', 'japanese', 'メタデータスキーマ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '36', 'japanese', 'メタデータの記述言語', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '37', 'japanese', 'ファイルフォーマット', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '38', 'japanese', 'ファイルサイズ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '39', 'japanese', 'ファイルリンク（URL/URI）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '40', 'japanese', '動作環境', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '41', 'japanese', '動作条件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '42', 'japanese', '推奨バージョン(下限)', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '43', 'japanese', '推奨バージョン(上限)', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '44', 'japanese', 'インストール手順', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '45', 'japanese', 'その他の技術要件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '46', 'japanese', '再生時間', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '47', 'japanese', '双方向性・種別', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '48', 'japanese', '学習資源・種別', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '49', 'japanese', '双方向性・レベル', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '50', 'japanese', '意味論的密度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '51', 'japanese', '想定利用者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '52', 'japanese', '想定利用環境', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '53', 'japanese', '想定利用者の対象年齢', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '54', 'japanese', '想定利用者における難易度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '55', 'japanese', '推定学習時間', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '56', 'japanese', '教育情報・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '57', 'japanese', '想定利用者の使用言語', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '58', 'japanese', '使用料', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '59', 'japanese', '著作権・利用制限条件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '60', 'japanese', '権利関係・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '61', 'japanese', 'PubMed番号', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '62', 'japanese', 'DOI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '63', 'japanese', '異版である', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '64', 'japanese', '異版あり', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '65', 'japanese', '要件とされる', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '66', 'japanese', '要件とする', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '67', 'japanese', '部分である', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '68', 'japanese', '部分を持つ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '69', 'japanese', '参照される', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '70', 'japanese', '参照する', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '71', 'japanese', '別フォーマットである', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '72', 'japanese', '別フォーマットあり', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '73', 'japanese', '基になる', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '74', 'japanese', '基づいている', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '75', 'japanese', '他の資源との関係', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '76', 'japanese', '教育利用コメント・作成者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '77', 'japanese', '教育利用コメント・作成日', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '78', 'japanese', '教育利用コメント・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '79', 'japanese', '分類・目的', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '80', 'japanese', '分類体系の所在・名称', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '81', 'japanese', '分類体系における分類項目', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '82', 'japanese', '分類・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '83', 'japanese', '分類・キーワード', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '84', 'japanese', '機関ID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '85', 'japanese', 'コンテンツID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '86', 'japanese', 'コンテンツ更新日時', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0');
+    (20016, 1, 'japanese', 'URI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 2, 'japanese', 'ISSN', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 3, 'japanese', 'NCID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 4, 'japanese', '書誌情報', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 5, 'japanese', '著者版フラグ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 6, 'japanese', 'その他の識別子', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 7, 'japanese', '言語', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 8, 'japanese', '内容記述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 9, 'japanese', '適用範囲', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 10, 'japanese', '構成', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 11, 'japanese', '粒度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 12, 'japanese', 'エディション（版）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 13, 'japanese', 'ステータス（現状）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 14, 'japanese', '著者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 15, 'japanese', '発行者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 16, 'japanese', '寄与の日付', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 17, 'japanese', '原作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 18, 'japanese', '更新者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 19, 'japanese', '校閲者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 20, 'japanese', '編集者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 21, 'japanese', 'グラフィックデザイナー', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 22, 'japanese', '技術', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 23, 'japanese', 'コンテンツプロバイダー', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 24, 'japanese', '技術監修', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 25, 'japanese', '教育監修', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 26, 'japanese', '台本作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 27, 'japanese', 'インストラクショナルデザイナー', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 28, 'japanese', '教科・専門家', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 29, 'japanese', 'その他の関係者(未知)', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 30, 'japanese', '寄与者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 31, 'japanese', 'メタデータ識別子', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 32, 'japanese', 'メタデータ作成者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 33, 'japanese', 'メタデータ校閲者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 34, 'japanese', 'メタデータの寄与者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 35, 'japanese', 'メタデータスキーマ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 36, 'japanese', 'メタデータの記述言語', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 37, 'japanese', 'ファイルフォーマット', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 38, 'japanese', 'ファイルサイズ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 39, 'japanese', 'ファイルリンク（URL/URI）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 40, 'japanese', '動作環境', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 41, 'japanese', '動作条件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 42, 'japanese', '推奨バージョン(下限)', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 43, 'japanese', '推奨バージョン(上限)', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 44, 'japanese', 'インストール手順', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 45, 'japanese', 'その他の技術要件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 46, 'japanese', '再生時間', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 47, 'japanese', '双方向性・種別', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 48, 'japanese', '学習資源・種別', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 49, 'japanese', '双方向性・レベル', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 50, 'japanese', '意味論的密度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 51, 'japanese', '想定利用者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 52, 'japanese', '想定利用環境', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 53, 'japanese', '想定利用者の対象年齢', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 54, 'japanese', '想定利用者における難易度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 55, 'japanese', '推定学習時間', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 56, 'japanese', '教育情報・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 57, 'japanese', '想定利用者の使用言語', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 58, 'japanese', '使用料', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 59, 'japanese', '著作権・利用制限条件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 60, 'japanese', '権利関係・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 61, 'japanese', 'PubMed番号', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 62, 'japanese', 'DOI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 63, 'japanese', '異版である', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 64, 'japanese', '異版あり', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 65, 'japanese', '要件とされる', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 66, 'japanese', '要件とする', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 67, 'japanese', '部分である', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 68, 'japanese', '部分を持つ', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 69, 'japanese', '参照される', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 70, 'japanese', '参照する', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 71, 'japanese', '別フォーマットである', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 72, 'japanese', '別フォーマットあり', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 73, 'japanese', '基になる', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 74, 'japanese', '基づいている', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 75, 'japanese', '他の資源との関係', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 76, 'japanese', '教育利用コメント・作成者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 77, 'japanese', '教育利用コメント・作成日', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 78, 'japanese', '教育利用コメント・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 79, 'japanese', '分類・目的', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 80, 'japanese', '分類体系の所在・名称', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 81, 'japanese', '分類体系における分類項目', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 82, 'japanese', '分類・備考', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 83, 'japanese', '分類・キーワード', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 84, 'japanese', '機関ID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 85, 'japanese', 'コンテンツID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 86, 'japanese', 'コンテンツ更新日時', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0);
 
 INSERT INTO `repository_item_type_name_multilanguage` VALUE
-('20016', '1', 'english', 'URI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '2', 'english', 'ISSN', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '3', 'english', 'NCID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '4', 'english', 'Bibliographic information', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '5', 'english', 'Author version flag', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '6', 'english', 'Other identifiers', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '7', 'english', 'Language', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '8', 'english', 'Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '9', 'english', 'Coverage', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '10', 'english', 'Structure', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '11', 'english', 'Aggregation Level', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '12', 'english', 'Life cycle-version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '13', 'english', 'Status', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '14', 'english', 'Author', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '15', 'english', 'Publisher', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '16', 'english', 'Contribute-Date', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '17', 'english', 'Initiator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '18', 'english', 'Terminator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '19', 'english', 'Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '20', 'english', 'Editor', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '21', 'english', 'Graphical Designer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '22', 'english', 'Technical Implementer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '23', 'english', 'Content Provider', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '24', 'english', 'Technical Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '25', 'english', 'Educational Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '26', 'english', 'Script Writer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '27', 'english', 'Instructional Designer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '28', 'english', 'Subject Matter Expert', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '29', 'english', 'Unknown', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '30', 'english', 'Contribute', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '31', 'english', 'Metadata-Identifier', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '32', 'english', 'Metadeta-Creator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '33', 'english', 'Metadata-Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '34', 'english', 'Metadata-Contribute', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '35', 'english', 'Metadata Schema', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '36', 'english', 'Metadata-Language', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '37', 'english', 'Format', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '38', 'english', 'Size', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '39', 'english', 'Location', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '40', 'english', 'Requirement-OrComposite-Type', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '41', 'english', 'Requirement-OrComposite-Name', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '42', 'english', 'Minimum Version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '43', 'english', 'Maximum Version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '44', 'english', 'Installation Remarks', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '45', 'english', 'Other Platform Requirements', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '46', 'english', 'Duration', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '47', 'english', 'Interactivity Type', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '48', 'english', 'Learning Resource Type', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '49', 'english', 'Interactivity Level', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '50', 'english', 'Semantic Density', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '51', 'english', 'Intended End User Role', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '52', 'english', 'Context', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '53', 'english', 'Typical Age Range', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '54', 'english', 'Difficulty', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '55', 'english', 'Typical Learning Time', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '56', 'english', 'Educational-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '57', 'english', 'Educational-Language', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '58', 'english', 'Cost', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '59', 'english', 'Copyright and Other Restrictions', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '60', 'english', 'Rights-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '61', 'english', 'PubMed number', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '62', 'english', 'DOI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '63', 'english', 'isversionof: is version of', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '64', 'english', 'hasversion: has version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '65', 'english', 'isrequiredby: is required by', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '66', 'english', 'requires: requires', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '67', 'english', 'ispartof: is part of', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '68', 'english', 'haspart: has part', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '69', 'english', 'isreferencedby: is referenced by', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '70', 'english', 'references: references', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '71', 'english', 'isformatof: is format of', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '72', 'english', 'hasformat: has format', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '73', 'english', 'isbasisfor: is basis for', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '74', 'english', 'isbasedon: is based on', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '75', 'english', 'Relation', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '76', 'english', 'Annotation-Entity', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '77', 'english', 'Annotation-Date', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '78', 'english', 'Annotation-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '79', 'english', 'Purpose', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '80', 'english', 'Taxon Path-Source', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '81', 'english', 'Taxon Path-Taxon', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '82', 'english', 'Classification-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '83', 'english', 'Classification-keyword', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '84', 'english', 'Authority Identifier', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '85', 'english', 'Content Identifier', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '86', 'english', 'Modified content', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0');
+    (20016, 1, 'english', 'URI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 2, 'english', 'ISSN', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 3, 'english', 'NCID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 4, 'english', 'Bibliographic information', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 5, 'english', 'Author version flag', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 6, 'english', 'Other identifiers', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 7, 'english', 'Language', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 8, 'english', 'Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 9, 'english', 'Coverage', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 10, 'english', 'Structure', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 11, 'english', 'Aggregation Level', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 12, 'english', 'Life cycle-version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 13, 'english', 'Status', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 14, 'english', 'Author', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 15, 'english', 'Publisher', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 16, 'english', 'Contribute-Date', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 17, 'english', 'Initiator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 18, 'english', 'Terminator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 19, 'english', 'Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 20, 'english', 'Editor', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 21, 'english', 'Graphical Designer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 22, 'english', 'Technical Implementer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 23, 'english', 'Content Provider', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 24, 'english', 'Technical Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 25, 'english', 'Educational Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 26, 'english', 'Script Writer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 27, 'english', 'Instructional Designer', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 28, 'english', 'Subject Matter Expert', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 29, 'english', 'Unknown', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 30, 'english', 'Contribute', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 31, 'english', 'Metadata-Identifier', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 32, 'english', 'Metadeta-Creator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 33, 'english', 'Metadata-Validator', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 34, 'english', 'Metadata-Contribute', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 35, 'english', 'Metadata Schema', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 36, 'english', 'Metadata-Language', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 37, 'english', 'Format', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 38, 'english', 'Size', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 39, 'english', 'Location', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 40, 'english', 'Requirement-OrComposite-Type', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 41, 'english', 'Requirement-OrComposite-Name', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 42, 'english', 'Minimum Version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 43, 'english', 'Maximum Version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 44, 'english', 'Installation Remarks', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 45, 'english', 'Other Platform Requirements', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 46, 'english', 'Duration', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 47, 'english', 'Interactivity Type', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 48, 'english', 'Learning Resource Type', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 49, 'english', 'Interactivity Level', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 50, 'english', 'Semantic Density', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 51, 'english', 'Intended End User Role', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 52, 'english', 'Context', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 53, 'english', 'Typical Age Range', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 54, 'english', 'Difficulty', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 55, 'english', 'Typical Learning Time', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 56, 'english', 'Educational-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 57, 'english', 'Educational-Language', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 58, 'english', 'Cost', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 59, 'english', 'Copyright and Other Restrictions', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 60, 'english', 'Rights-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 61, 'english', 'PubMed number', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 62, 'english', 'DOI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 63, 'english', 'isversionof: is version of', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 64, 'english', 'hasversion: has version', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 65, 'english', 'isrequiredby: is required by', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 66, 'english', 'requires: requires', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 67, 'english', 'ispartof: is part of', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 68, 'english', 'haspart: has part', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 69, 'english', 'isreferencedby: is referenced by', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 70, 'english', 'references: references', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 71, 'english', 'isformatof: is format of', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 72, 'english', 'hasformat: has format', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 73, 'english', 'isbasisfor: is basis for', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 74, 'english', 'isbasedon: is based on', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 75, 'english', 'Relation', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 76, 'english', 'Annotation-Entity', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 77, 'english', 'Annotation-Date', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 78, 'english', 'Annotation-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 79, 'english', 'Purpose', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 80, 'english', 'Taxon Path-Source', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 81, 'english', 'Taxon Path-Taxon', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 82, 'english', 'Classification-Description', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 83, 'english', 'Classification-keyword', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 84, 'english', 'Authority Identifier', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 85, 'english', 'Content Identifier', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 86, 'english', 'Modified content', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0);
 
 INSERT INTO `repository_item_type_name_multilanguage` VALUE
-('20016', '1', 'chinese', 'URI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '2', 'chinese', 'ISSN', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '3', 'chinese', 'NCID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '4', 'chinese', '书目信息', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '5', 'chinese', '作者版本标志', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '6', 'chinese', '其他标识符', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '7', 'chinese', '语言', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '8', 'chinese', '内容', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '9', 'chinese', '范围', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '10', 'chinese', '结构', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '11', 'chinese', '聚合程度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '12', 'chinese', '版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '13', 'chinese', '现况', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '14', 'chinese', '作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '15', 'chinese', '发表者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '16', 'chinese', '发表日期', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '17', 'chinese', '原始作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '18', 'chinese', '最近作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '19', 'chinese', '校阅者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '20', 'chinese', '编辑', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '21', 'chinese', '绘图员', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '22', 'chinese', '技术员', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '23', 'chinese', '内容提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '24', 'chinese', '技术监察', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '25', 'chinese', '教育审阅', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '26', 'chinese', '剧本作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '27', 'chinese', '教学设计', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '28', 'chinese', '科目专家', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '29', 'chinese', '提供者未明', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '30', 'chinese', '提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '31', 'chinese', '标记', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '32', 'chinese', '作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '33', 'chinese', '审阅者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '34', 'chinese', '提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '35', 'chinese', '诠释资料结构定义档', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '36', 'chinese', '诠释资料语言', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '37', 'chinese', '格式', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '38', 'chinese', '大小', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '39', 'chinese', '地点', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '40', 'chinese', '要求或组合类型', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '41', 'chinese', '要求或组合名称', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '42', 'chinese', '要求或组合最低版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '43', 'chinese', '要求或组合最高版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '44', 'chinese', '安装指示', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '45', 'chinese', '其他系统要求', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '46', 'chinese', '时限', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '47', 'chinese', '互动类型', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '48', 'chinese', '学习资源类型', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '49', 'chinese', '互动程度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '50', 'chinese', '语义密度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '51', 'chinese', '意属使用者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '52', 'chinese', '环境', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '53', 'chinese', '通常年龄范围', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '54', 'chinese', '难易度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '55', 'chinese', '通常学习时间', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '56', 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '57', 'chinese', '语言', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '58', 'chinese', '价格', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '59', 'chinese', '版权及其他限制', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '60', 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '61', 'chinese', '考研人数', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '62', 'chinese', 'DOI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '63', 'chinese', '本版本为', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '64', 'chinese', '其他版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '65', 'chinese', '要求者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '66', 'chinese', '有下列要求', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '67', 'chinese', '本版本为下列物件的一部分', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '68', 'chinese', '其他组合', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '69', 'chinese', '参照提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '70', 'chinese', '参照', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '71', 'chinese', '格式', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '72', 'chinese', '其他格式', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '73', 'chinese', '为下列物件的基础', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '74', 'chinese', '物件建基于', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '75', 'chinese', '其他关系', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '76', 'chinese', '物件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '77', 'chinese', '日期', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '78', 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '79', 'chinese', '目的', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '80', 'chinese', '分类（来源）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '81', 'chinese', '分类', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '82', 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '83', 'chinese', '关键字', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '84', 'chinese', '机构标记', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '85', 'chinese', '内容标记', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0')
-, ('20016', '86', 'chinese', '修改后的内容', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', '0');
+    (20016, 1, 'chinese', 'URI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 2, 'chinese', 'ISSN', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 3, 'chinese', 'NCID', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 4, 'chinese', '书目信息', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 5, 'chinese', '作者版本标志', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 6, 'chinese', '其他标识符', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 7, 'chinese', '语言', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 8, 'chinese', '内容', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 9, 'chinese', '范围', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 10, 'chinese', '结构', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 11, 'chinese', '聚合程度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 12, 'chinese', '版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 13, 'chinese', '现况', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 14, 'chinese', '作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 15, 'chinese', '发表者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 16, 'chinese', '发表日期', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 17, 'chinese', '原始作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 18, 'chinese', '最近作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 19, 'chinese', '校阅者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 20, 'chinese', '编辑', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 21, 'chinese', '绘图员', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 22, 'chinese', '技术员', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 23, 'chinese', '内容提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 24, 'chinese', '技术监察', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 25, 'chinese', '教育审阅', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 26, 'chinese', '剧本作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 27, 'chinese', '教学设计', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 28, 'chinese', '科目专家', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 29, 'chinese', '提供者未明', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 30, 'chinese', '提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 31, 'chinese', '标记', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 32, 'chinese', '作者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 33, 'chinese', '审阅者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 34, 'chinese', '提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 35, 'chinese', '诠释资料结构定义档', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 36, 'chinese', '诠释资料语言', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 37, 'chinese', '格式', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 38, 'chinese', '大小', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 39, 'chinese', '地点', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 40, 'chinese', '要求或组合类型', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 41, 'chinese', '要求或组合名称', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 42, 'chinese', '要求或组合最低版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 43, 'chinese', '要求或组合最高版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 44, 'chinese', '安装指示', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 45, 'chinese', '其他系统要求', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 46, 'chinese', '时限', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 47, 'chinese', '互动类型', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 48, 'chinese', '学习资源类型', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 49, 'chinese', '互动程度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 50, 'chinese', '语义密度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 51, 'chinese', '意属使用者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 52, 'chinese', '环境', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 53, 'chinese', '通常年龄范围', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 54, 'chinese', '难易度', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 55, 'chinese', '通常学习时间', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 56, 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 57, 'chinese', '语言', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 58, 'chinese', '价格', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 59, 'chinese', '版权及其他限制', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 60, 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 61, 'chinese', '考研人数', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 62, 'chinese', 'DOI', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 63, 'chinese', '本版本为', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 64, 'chinese', '其他版本', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 65, 'chinese', '要求者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 66, 'chinese', '有下列要求', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 67, 'chinese', '本版本为下列物件的一部分', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 68, 'chinese', '其他组合', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 69, 'chinese', '参照提供者', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 70, 'chinese', '参照', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 71, 'chinese', '格式', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 72, 'chinese', '其他格式', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 73, 'chinese', '为下列物件的基础', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 74, 'chinese', '物件建基于', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 75, 'chinese', '其他关系', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 76, 'chinese', '物件', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 77, 'chinese', '日期', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 78, 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 79, 'chinese', '目的', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 80, 'chinese', '分类（来源）', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 81, 'chinese', '分类', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 82, 'chinese', '描述', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 83, 'chinese', '关键字', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 84, 'chinese', '机构标记', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 85, 'chinese', '内容标记', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0),
+    (20016, 86, 'chinese', '修改后的内容', '', '', '', '2013-08-30 00:00:00.000', '2013-08-30 00:00:00.000', '', 0);
+
 INSERT INTO `repository_search_item_setup` (`type_id`, `search_type`, `use_search`, `default_show`, `junii2_mapping` ) VALUE
-    ('1', 'repository_detail_search_show_name_title', 1, 1, 'title,alternative'),
-    ('2', 'repository_detail_search_show_name_creator', 1, 1, 'creator'),
-    ('3', 'repository_detail_search_show_name_subject', 0, 0, 'subject'),
-    ('4', 'repository_detail_search_show_name_niisubject', 0, 0, 'NIIsubject,NDC,NDLC,BSH,NDLSH,MeSH,DDC,LCC,UDC,LCSH'),
-    ('5', 'repository_detail_search_show_name_description', 0, 0, 'description'),
-    ('6', 'repository_detail_search_show_name_publisher', 0, 0, 'publisher'),
-    ('7', 'repository_detail_search_show_name_contributor', 0, 0, 'contributor'),
-    ('8', 'repository_detail_search_show_name_date', 0, 0, 'date'),
-    ('9', 'repository_detail_search_show_name_item_type', 0, 0, ''),
-    ('10', 'repository_detail_search_show_name_type', 1, 1, 'type'),
-    ('11', 'repository_detail_search_show_name_format', 0, 0, 'format'),
-    ('12', 'repository_detail_search_show_name_id', 0, 0, 'identifier,URI,fullTextURL,selfDOI,ISBN,ISSN,NCID,pmid,doi,NAID,ichushi'),
-    ('13', 'repository_detail_search_show_name_jtitle', 0, 0, 'jtitle'),
-    ('14', 'repository_detail_search_show_name_dateofissued', 1, 1, 'dateofissued'),
-    ('15', 'repository_detail_search_show_name_language', 0, 0, 'language'),
-    ('16', 'repository_detail_search_show_name_spatial', 0, 0, 'spatial,NIIspatial'),
-    ('17', 'repository_detail_search_show_name_temporal', 0, 0, 'temporal,NIItemporal'),
-    ('18', 'repository_detail_search_show_name_rights', 0, 0, 'rights'),
-    ('19', 'repository_detail_search_show_name_textversion', 0, 0, 'textversion'),
-    ('20', 'repository_detail_search_show_name_grantid', 0, 0, 'grantid'),
-    ('21', 'repository_detail_search_show_name_dateofgranted', 0, 0, 'dateofgranted'),
-    ('22', 'repository_detail_search_show_name_degreename', 0, 0, 'degreename'),
-    ('23', 'repository_detail_search_show_name_grantor', 0, 0, 'grantor'),
-    ('24', 'repository_detail_search_show_name_index', 1, 1, '');
-INSERT INTO `repository_lock` (`process_name`, `status`) VALUE
-    ('Repository_Action_Common_Search_Update', 0),
-    ('Repository_Action_Common_Filecleanup_Update', 0),
-    ('Repository_Action_Common_Background_Sitelicensemail', 0),
-    ('Repository_Action_Common_Backgrounf_Log_Update', 0),
-    ('Repository_Action_Common_Updateexternalsearchword', 0);
+    (1, 'repository_detail_search_show_name_title', 1, 1, 'title,alternative'),
+    (2, 'repository_detail_search_show_name_creator', 1, 1, 'creator'),
+    (3, 'repository_detail_search_show_name_subject', 0, 0, 'subject'),
+    (4, 'repository_detail_search_show_name_niisubject', 0, 0, 'NIIsubject,NDC,NDLC,BSH,NDLSH,MeSH,DDC,LCC,UDC,LCSH'),
+    (5, 'repository_detail_search_show_name_description', 0, 0, 'description'),
+    (6, 'repository_detail_search_show_name_publisher', 0, 0, 'publisher'),
+    (7, 'repository_detail_search_show_name_contributor', 0, 0, 'contributor'),
+    (8, 'repository_detail_search_show_name_date', 0, 0, 'date'),
+    (9, 'repository_detail_search_show_name_item_type', 0, 0, ''),
+    (10, 'repository_detail_search_show_name_type', 1, 1, 'type'),
+    (11, 'repository_detail_search_show_name_format', 0, 0, 'format'),
+    (12, 'repository_detail_search_show_name_id', 0, 0, 'identifier,URI,fullTextURL,selfDOI,ISBN,ISSN,NCID,pmid,doi,NAID,ichushi'),
+    (13, 'repository_detail_search_show_name_jtitle', 0, 0, 'jtitle'),
+    (14, 'repository_detail_search_show_name_dateofissued', 1, 1, 'dateofissued'),
+    (15, 'repository_detail_search_show_name_language', 0, 0, 'language'),
+    (16, 'repository_detail_search_show_name_spatial', 0, 0, 'spatial,NIIspatial'),
+    (17, 'repository_detail_search_show_name_temporal', 0, 0, 'temporal,NIItemporal'),
+    (18, 'repository_detail_search_show_name_rights', 0, 0, 'rights'),
+    (19, 'repository_detail_search_show_name_textversion', 0, 0, 'textversion'),
+    (20, 'repository_detail_search_show_name_grantid', 0, 0, 'grantid'),
+    (21, 'repository_detail_search_show_name_dateofgranted', 0, 0, 'dateofgranted'),
+    (22, 'repository_detail_search_show_name_degreename', 0, 0, 'degreename'),
+    (23, 'repository_detail_search_show_name_grantor', 0, 0, 'grantor'),
+    (24, 'repository_detail_search_show_name_index', 1, 1, '');
+
+INSERT INTO `repository_lock` (`process_name`, `status`, `comment`) VALUE
+    ('Repository_Action_Common_Search_Update', 0, ''),
+    ('Repository_Action_Common_Filecleanup_Update', 0, ''),
+    ('Repository_Action_Common_Background_Sitelicensemail', 0, ''),
+    ('Repository_Action_Common_Background_Log_Update', 0, ''),
+    ('Repository_Action_Common_Updateexternalsearchword', 0, ''),
+    ('Repository_Action_Common_Background_Detailsearchitem', 0, ''),
+    ('Repository_Action_Common_Background_Deleterobotlist', 0, ''),
+    ('Repository_Action_Common_Background_Elapsedtime', 0, ''),
+    ('Repository_Action_Common_Robotlist', 0, '');
+
 INSERT INTO `repository_prefix` (id, prefix_name, prefix_id, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) VALUES
     (10, 'Yハンドル', '', 1, 1, '', '2014-02-28 00:00:00.000', '2014-02-28 00:00:00.000', '', 0),
     (20, 'CNRIハンドル', '', 1, 1, '', '2014-02-28 00:00:00.000', '2014-02-28 00:00:00.000', '', 0),
+    (25, 'DataCite', '', 1, 1, '', '2014-02-28 00:00:00.000', '2014-02-28 00:00:00.000', '', 0),
     (30, 'Cross Ref', '', 1, 1, '', '2014-02-28 00:00:00.000', '2014-02-28 00:00:00.000', '', 0),
     (40, 'JaLC DOI', '', 1, 1, '', '2014-02-28 00:00:00.000', '2014-02-28 00:00:00.000', '', 0),
     (50, '国会図書館JaLC DOIプレフィックス', '10.11501', 1, 1, '', '2014-02-28 00:00:00.000', '2014-02-28 00:00:00.000', '', 0);
+
+INSERT INTO `repository_doi_flag` (doi_flag_id, nii_type, jalc, multiple_resolution, crossref, datacite, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) VALUES
+    (1, 'article', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (2, 'book', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (3, 'conference paper', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (4, 'data or dataset', 1, 0, 0, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (5, 'departmental bulletin paper', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (6, 'journal article', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (7, 'learning material', 1, 0, 0, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (8, 'others', 0, 0, 0, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (9, 'preprint', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (10, 'presentation', 1, 0, 0, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (11, 'research paper', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (12, 'software', 1, 0, 0, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (13, 'technical report', 1, 0, 1, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (14, 'thesis or dissertation', 1, 1, 0, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0);
+
+INSERT INTO `repository_target_search_item` (search_item_id, ranking_flag, ins_user_id, mod_user_id, del_user_id, ins_date, mod_date, del_date, is_delete) VALUES
+    (0, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (1, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (2, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (3, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (4, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (5, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (6, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (7, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (8, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (9, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (10, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (11, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (12, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (13, 1, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (14, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (15, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (16, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (17, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (18, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (19, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (20, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (21, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (22, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (23, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (24, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0),
+    (25, 0, 1, 1, '', '2015-03-31 00:00:00.000', '2015-03-31 00:00:00.000', '', 0);
+
+INSERT INTO `repository_robotlist_master` (`robotlist_id`, `robotlist_url`, `is_robotlist_use`, `del_column`, `robotlist_version`, `robotlist_date`, `robotlist_revision`, `robotlist_author`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
+    (1, 'https://bitbucket.org/niijp/jairo-crawler-list/raw/master/JAIRO_Crawler-List_ip_blacklist.txt', 1, 'ip_address', '', '', '', '', 1, 1, '', '2015-06-22 00:00:00.000', '2015-06-22 00:00:00.000', '', 0),
+    (2, 'https://bitbucket.org/niijp/jairo-crawler-list/raw/master/JAIRO_Crawler-List_useragent.txt', 1, 'user_agent', '', '', '', '', 1, 1, '', '2015-06-22 00:00:00.000', '2015-06-22 00:00:00.000', '', 0);
+
 INSERT INTO `repository_external_searchengine_analyticalrule` VALUE
-    ('1','YAHOO! JAPAN','search.yahoo.co.jp','p','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('2','Google','www.google.co.jp','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('3','msn','www.bing.com','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('4','goo','search.goo.ne.jp','MT','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('5','infoseek','websearch.rakuten.co.jp','qt','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('6','excite','websearch.excite.co.jp','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('7','Fresh','search.fresheye.com','kw','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('8','OCN','wsearch.ocn.ne.jp','MT','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('9','BIGLOBE','cgi.search.biglobe.ne.jp','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('10','nifty','search.nifty.com','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
-    ('11','livedoor','search.livedoor.com','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0);
+    (1,'YAHOO! JAPAN','search.yahoo.co.jp','p','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (2,'Google','www.google.co.jp','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (3,'msn','www.bing.com','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (4,'goo','search.goo.ne.jp','MT','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (5,'infoseek','websearch.rakuten.co.jp','qt','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (6,'excite','websearch.excite.co.jp','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (7,'Fresh','search.fresheye.com','kw','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (8,'OCN','wsearch.ocn.ne.jp','MT','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (9,'BIGLOBE','cgi.search.biglobe.ne.jp','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (10,'nifty','search.nifty.com','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0),
+    (11,'livedoor','search.livedoor.com','q','/[+\\s]+/','1','1','0','2014-05-30 00:00:00.000','2014-05-30 00:00:00.000','',0);
+
 INSERT INTO `repository_external_searchword_stopword` (`stop_word`, `part_of_speech`, `ins_user_id`, `mod_user_id`, `del_user_id`, `ins_date`, `mod_date`, `del_date`, `is_delete`) VALUES
     ('したがって', 7, '1', '1', '0', '2014-05-30 00:00:00.000', '2014-05-30 00:00:00.000', '', 0),
     ('そこで', 7, '1', '1', '0', '2014-05-30 00:00:00.000', '2014-05-30 00:00:00.000', '', 0),
diff --git a/repository/swrc/Swrc.class.php b/repository/swrc/Swrc.class.php
index ceeb863..06b39e4 100644
--- a/repository/swrc/Swrc.class.php
+++ b/repository/swrc/Swrc.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Swrc.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Swrc.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -28,10 +28,6 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryOutputFilter.
  */
 class Repository_Swrc extends RepositoryAction
 {
-	// 使用コンポーネントを受け取るため
-	//var $session = null;
-	var $db = null;
-	
 	// リクエストパラメータを受け取るため
 	var $itemId = null;
 	var $itemNo = null;
diff --git a/repository/swrc/maple.ini b/repository/swrc/maple.ini
index e9d12bf..d39a6bb 100644
--- a/repository/swrc/maple.ini
+++ b/repository/swrc/maple.ini
@@ -1,18 +1,3 @@
-;[Convert]
-;*.trim =
-
-;[ValidateDef]
-;item_type_id
-
-;[Action]
-;session = "ref:Session"
-;db = "ref:DbObject"
-
-;[View]
-;success = "action:repository_view_main_export_detailconfirm"
-
-
-
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
diff --git a/repository/templates/default/repository_action_common_download_error.html b/repository/templates/default/repository_action_common_download_error.html
index 018ba16..e52bee7 100644
--- a/repository/templates/default/repository_action_common_download_error.html
+++ b/repository/templates/default/repository_action_common_download_error.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_action_common_download_error.html 527 2012-07-20 01:44:48Z ivis $          -->
+<!--// $Id: repository_action_common_download_error.html 6683 2011-03-18 11:02:11Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_admin.html b/repository/templates/default/repository_admin.html
index 0e2b8a1..857df32 100644
--- a/repository/templates/default/repository_admin.html
+++ b/repository/templates/default/repository_admin.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_admin.html 640 2014-10-24 08:07:50Z ivis $        -->
+<!--// $Id: repository_admin.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $        -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -168,6 +168,21 @@
 		     </select>
 		    </td>
 		   </tr>
+		   
+		   <{* ranking tab display setting 2014/12/19 K.Matsushita --start-- *}>
+		   <tr>
+		    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_ranking_display_setting}></td>
+		    <td class="w70 al item_edit_list">
+              <label>
+                  <input type="radio" name="ranking_tab_display" value="1" <{if $action.ranking_tab_display == "1"}>CHECKED<{/if}>/><{$lang.repository_admin_sort_disp}>
+              </label>
+              <label>
+                  <input type="radio" name="ranking_tab_display" value="0" <{if $action.ranking_tab_display == "0"}>CHECKED<{/if}> onclick="javascript: changeIndexAuto();"/><{$lang.repository_admin_sort_not_disp}><br>
+              </label>
+		    </td>
+		   </tr>
+		   <{* ranking tab display setting 2014/12/19 K.Matsushita --end-- *}>
+		   
 		   <tr>
 		    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_ranking_term_recent_regist}></td>
 		    <td class="w70 al item_edit_list">
@@ -197,6 +212,28 @@
 		    </td>
 		   </tr>
 		   
+		  <{* Default Search Type setting 2014/12/03 K.Sugimoto --start-- *}>
+		   <{* 検索設定 *}>
+		   <tr>
+		    <th class="al th_col_repos" colspan=2><{$lang.repository_admin_search}></th>
+		   </tr>
+           <tr>
+           <{* デフォルト検索設定 *}>
+            <td class="vt al item_edit_list normal w30">
+             <{$lang.repository_admin_default_search_type}>
+            </td>
+            <td class="w70 al item_edit_list">
+             <label style="margin-right:10px">
+              <input type="radio" name="default_search_type" value="0" <{if $action.default_search_type == 0}>checked=""<{/if}>>
+              <{$lang.repository_admin_detail_search_type}>
+             </label>
+             <label>
+              <input type="radio" name="default_search_type" value="1" <{if $action.default_search_type > 0}>checked=""<{/if}>>
+              <{$lang.repository_admin_simple_search_type}>
+             </label>
+            </td>
+           </tr>
+		  <{* Default Search Type setting 2014/12/03 K.Sugimoto --end-- *}>
           <{* Advanced Search condition setting 2013/11/20 R.Matsuura --start-- *}>
             <tr>
              <th class="al th_col_repos" colspan=2><{$lang.repository_detail_search_title}></th>
@@ -350,6 +387,21 @@
 		   </tr>
 		   <{* Help icon and OAI-ORE icon dipsplay setting 2010/02/10 K.Ando --end-- *}>
 
+		   <{* Usage Statistics link display setting 2014/12/16 K.Matsushita --start-- *}>
+		   <tr>
+		    <th class="al th_col_repos" colspan=2><{$lang.repository_admin_usagestatistics_link_display_setting}></th>
+		   </tr>
+		   <tr>
+		       <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_usagestatistics_link_display}></td>
+		       <td class="item_edit_list w70 al">
+			      <select id="usagestatistics_link_display" name="usagestatistics_link_display">
+				   <option value="0" <{if $action.usagestatistics_link_display == "0"}>SELECTED<{/if}> ><{$lang.repository_admin_sort_not_disp}></option>
+				   <option value="1" <{if $action.usagestatistics_link_display == "1"}>SELECTED<{/if}> ><{$lang.repository_admin_sort_disp}></option>
+				  </select>
+		        </td>
+		   </tr>
+		   <{* Usage Statistics link display setting 2014/12/16 K.Matsushita --end-- *}>
+
 		  </table>
 		  </div>
 		  </form>
@@ -574,19 +626,82 @@
 				<tr>
 					<th class="th_col_repos al" colspan=2><{$lang.repository_admin_log}></th>
 				</tr>
-				<tr>
-					<td class="vt al item_edit_list normal w30"><{$lang.repository_admin_log_exclusion}></td>
-					<td class="w70 al item_edit_list">
-						<div class="ranking_list_paging">
-							<{$lang.repository_admin_log_address}><br/>
-							<span class="small">
-								<{$lang.repository_admin_log_Robots_Exclusion1}><br/>
-								<{$lang.repository_admin_log_Robots_Exclusion2}><br/>
-							</span>
-						</div>
-						<div><textarea class="full al h10em" id="id_log_exclusion" name="log_exclusion"><{$smarty.session.admin_params.log_exclusion.param_value}></textarea></div>
-					</td>
-				</tr>
+                <tr>
+                    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_robotlist_delete_execute}></td>
+                    <td class="w70 al item_edit_list">
+                        <{if $action.logTableStatus == 0}>
+                            <input class="btn_white" type="button" id="robotlistUpdate" onclick="repositoryCls['<{$id}>'].repositoryRobotlistRun(); return false;" value="<{$lang.repository_execute}>"><br>
+                        <{else}>
+                            <table class="full">
+                                <tr>
+                                    <td>
+                                        <div class="warning_msg"><{$lang.repository_admin_robotlist_now_executing}></div>
+                                    </td>
+                                    <td class="w10">
+                                        <input class="btn_delete" type="button" value="<{$lang.repository_admin_robotlist_process_kill}>" onclick="repositoryCls['<{$id}>'].repositoryRobotlistCancel(); return false;">
+                                    </td>
+                                </tr>
+                            </table>
+                        <{/if}>
+                    </td>
+                </tr>
+                <tr>
+                    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_log_exclusion}></td>
+                    <td class="w70 al item_edit_list">
+                        <div class="ranking_list_paging">
+                            <{$lang.repository_admin_log_address}><br/>
+                        </div>
+                        <div>
+                            <textarea class="full al h10em" id="id_log_exclusion" name="log_exclusion" onchange="robotlistCheckbox<{$id}>();">
+                                <{$smarty.session.admin_params.log_exclusion.param_value}>
+                            </textarea>
+                        </div>
+                    </td>
+                </tr>
+                <{if $smarty.session.admin_params.robotlist|@count > 0}>
+                <tr>
+                    <td class="vt al item_edit_list normal w30">
+                        <{$lang.repository_admin_robotlist_common_crawler_list}>
+                    </td>
+                    <td class="al item_edit_list">
+                        <{section name=i loop=$smarty.session.admin_params.robotlist}>
+                           <{assign var="robotlist_value" value=$smarty.session.admin_params.robotlist[i]}>
+                            <table class="w92">
+                                <tr>
+                                    <td colspan="8">
+                                        <input type="checkbox" <{if $robotlist_value.check == "1"}>checked<{/if}> name="robotlistValid[<{$robotlist_value.robotlist_id}>]" onclick="robotlistCheckbox<{$id}>();">
+                                        <input type="text" class="full" name="robotlist_ip_address_value[<{$robotlist_value.robotlist_id}>]" value="<{$robotlist_value.url}>" readonly>
+                                    </td>
+                                </tr>
+                                <{if $robotlist_value.version == "" && $robotlist_value.date == "" && $robotlist_value.revision == "" && $robotlist_value.author == "" }>
+                                    <tr>
+                                        <td class="bright_red"><{$lang.repository_admin_robotlist_no_robotlist}></td>
+                                    </tr>
+                                <{else}>
+                                    <tr>
+                                        <td class="w20px" rowspan="2"></td>
+                                        <td class="w50px">Version</td>
+                                        <td class="w10px">:</td>
+                                        <td class="w50px"><{$robotlist_value.version}></td>
+                                        <td rowspan="2"></td>
+                                        <td class="w50px">Date</td>
+                                        <td class="w10px">:</td>
+                                        <td><{$robotlist_value.date}></td>
+                                    </tr>
+                                    <tr>
+                                        <td class="w50px">Revision</td>
+                                        <td class="w10px">:</td>
+                                        <td class="w50px"><{$robotlist_value.revision}></td>
+                                        <td class="w50px">Author</td>
+                                        <td class="w10px">:</td>
+                                        <td><{$robotlist_value.author}></td>
+                                    </tr>
+                                <{/if}>
+                            </table>
+                        <{/section}>
+                    </td>
+                </tr>
+                <{/if}>
 			</table>
 			</div>
 			</form>
@@ -606,41 +721,62 @@
 				     <!--<div><textarea rows="10" cols="40" id="id_site_license" name="site_license"><{$smarty.session.admin_params.site_license.param_value}></textarea></div>-->
 				     <div class="mb10">
 				      <table class="full tb01 m05">
-				       <{section name=i loop=$smarty.session.admin_params.sitelicense_org.param_value}>
-				       <{assign var="sitelicense_org" value=$smarty.session.admin_params.sitelicense_org.param_value}>
-				       <{assign var="sitelicense_from" value=$smarty.session.admin_params.ip_sitelicense_from.param_value}>
-				       <{assign var="sitelicense_to" value=$smarty.session.admin_params.ip_sitelicense_to.param_value}>
-				       <{assign var="cnt" value=$smarty.section.i.index}>
+                       <{section name=i loop=$smarty.session.admin_params.sitelicense_id.param_value}>
+                       <{assign var="sitelicense_id" value=$smarty.session.admin_params.sitelicense_id.param_value}>
+                       <{assign var="sitelicense_org" value=$smarty.session.admin_params.sitelicense_org.param_value}>
+                       <{assign var="sitelicense_group" value=$smarty.session.admin_params.sitelicense_group.param_value}>
+                       <{assign var="sitelicense_from" value=$smarty.session.admin_params.ip_sitelicense_from.param_value}>
+                       <{assign var="sitelicense_to" value=$smarty.session.admin_params.ip_sitelicense_to.param_value}>
+                       <{assign var="cnt" value=$smarty.section.i.index}>
                        <{assign var="sitelicense_mail" value=$smarty.session.admin_params.sitelicense_mail.param_value}>
-				       <tr class="brd01">
-				        <th class="th_col_repos al" colspan=2><{$lang.repository_admin_site_license_organization}></th>
-				         <td class="brd01 item_edit_list"><input type="text" class="full" name="sitelicense_org[]" id="id_sitelicense_org" value="<{$sitelicense_org[$cnt]|smarty:nodefaults}>"/></td>
-				         <td class="brd01 item_edit_list ac" rowspan="3">
-				           <input type="button" class="btn_white" <{if $cnt==0}>disabled<{/if}> onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('shfrow_up', <{$cnt}>); return false;" value="<{$lang.repository_up}>"/><br/>
-				           <input type="button" class="btn_white" <{if $cnt==(count($sitelicense_org)-1)}>disabled<{/if}> onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('shfrow_dw', <{$cnt}>); return false;" value="<{$lang.repository_dw}>"/>
-				         </td>
-				         <td class="brd01 item_edit_list ac" rowspan="3"><input type="button" class="btn_delete" onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('delrow', <{$cnt}>); return false;" value="<{$lang.repository_delete}>"/></td>
-				       </tr>
-				       <tr class="brd01">
+                       <tr class="brd01">
+                        <th class="th_col_repos al" colspan=2><{$lang.repository_admin_site_license_organization}></th>
+                         <td class="brd01 item_edit_list">
+                          <{* Sitelicense ID *}>
+                          <input type="hidden" name="sitelicense_id[]" id="sitelicense_organization_id<{$id}>" value="<{$sitelicense_id[$cnt]|default:'0'}>"/>
+                          <{* Sitelicense Organization Name *}>
+                          <input type="text" class="full" name="sitelicense_org[]" id="id_sitelicense_org" value="<{$sitelicense_org[$cnt]|smarty:nodefaults}>"/></td>
+                         <td class="brd01 item_edit_list ac" rowspan="4">
+                           <input type="button" class="btn_white" <{if $cnt==0}>disabled<{/if}> onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('shfrow_up', <{$cnt}>); return false;" value="<{$lang.repository_up}>"/><br/>
+                           <input type="button" class="btn_white" <{if $cnt==(count($sitelicense_org)-1)}>disabled<{/if}> onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('shfrow_dw', <{$cnt}>); return false;" value="<{$lang.repository_dw}>"/>
+                         </td>
+                         <td class="brd01 item_edit_list ac" rowspan="4"><input type="button" class="btn_delete" onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('delrow', <{$cnt}>); return false;" value="<{$lang.repository_delete}>"/></td>
+                       </tr>
+                       <tr class="brd01">
                         <th class="th_col_repos al" colspan=2><{$lang.repository_admin_site_license_mail_address}><br/></th>
+                         <{* Sitelicense Mail Address *}>
                          <td class="brd01 item_edit_list"><input type="text" class="full" name="sitelicense_mail[]" id="id_sitelicense_mail" value="<{$sitelicense_mail[$cnt]|smarty:nodefaults}>" /></td>
                        </tr>
                        <tr class="brd01">
-				        <th class="th_col_repos al" colspan=2>
-				         <{$lang.repository_admin_site_license_iprange}><br/>
-				         <{$lang.repository_admin_site_license_from_to}>
-				        </th>
-				         <td class="brd01 item_edit_list">
-				           <input type="text" class="w30px ar" name="ip_sitelicense_from[]" id="input_def_from_<{$cnt}>_1" value="<{$sitelicense_from[$cnt][0]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
-				           <input type="text" class="w30px ar" name="ip_sitelicense_from[]" id="input_def_from_<{$cnt}>_2" value="<{$sitelicense_from[$cnt][1]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
-				           <input type="text" class="w30px ar" name="ip_sitelicense_from[]" id="input_def_from_<{$cnt}>_3" value="<{$sitelicense_from[$cnt][2]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
-				           <input type="text" class="w30px ar" name="ip_sitelicense_from[]" id="input_def_from_<{$cnt}>_4" value="<{$sitelicense_from[$cnt][3]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />
-				           -
-				           <input type="text" class="w30px ar" name="ip_sitelicense_to[]" id="input_def_to_<{$cnt}>_1" value="<{$sitelicense_to[$cnt][0]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
-				           <input type="text" class="w30px ar" name="ip_sitelicense_to[]" id="input_def_to_<{$cnt}>_2" value="<{$sitelicense_to[$cnt][1]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
-				           <input type="text" class="w30px ar" name="ip_sitelicense_to[]" id="input_def_to_<{$cnt}>_3" value="<{$sitelicense_to[$cnt][2]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
-				           <input type="text" class="w30px ar" name="ip_sitelicense_to[]" id="input_def_to_<{$cnt}>_4" value="<{$sitelicense_to[$cnt][3]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />
-				         </td>
+                        <th class="th_col_repos al" colspan=2><{$lang.repository_admin_site_license_group}><br/></th>
+                         <{* Sitelicense group name *}>
+                         <td class="brd01 item_edit_list"><input type="text" class="full" name="sitelicense_group[]" id="id_sitelicense_group" value="<{$sitelicense_group[$cnt]|smarty:nodefaults}>" /></td>
+                       </tr>
+                       <tr class="brd01">
+                        <th class="th_col_repos al" colspan=2>
+                         <{$lang.repository_admin_site_license_iprange}><br/>
+                         <{$lang.repository_admin_site_license_from_to}>
+                        </th>
+                        <td class="brd01 item_edit_list">
+                         <{section name=j loop=$smarty.session.admin_params.ip_sitelicense_from.param_value[$cnt]}>
+                         <{assign var="ip_cnt" value=$smarty.section.j.index}>
+                          <{if $ip_cnt > 0}>
+                          <br><br>
+                          <{/if}>
+                          <{* Sitelicense IP Address (from - to) *}>
+                          <input type="text" class="w30px ar" name="ip_sitelicense_from[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_from_<{$cnt}>_<{$ip_cnt}>_1" value="<{$sitelicense_from[$cnt][$ip_cnt][0]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
+                          <input type="text" class="w30px ar" name="ip_sitelicense_from[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_from_<{$cnt}>_<{$ip_cnt}>_2" value="<{$sitelicense_from[$cnt][$ip_cnt][1]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
+                          <input type="text" class="w30px ar" name="ip_sitelicense_from[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_from_<{$cnt}>_<{$ip_cnt}>_3" value="<{$sitelicense_from[$cnt][$ip_cnt][2]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
+                          <input type="text" class="w30px ar" name="ip_sitelicense_from[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_from_<{$cnt}>_<{$ip_cnt}>_4" value="<{$sitelicense_from[$cnt][$ip_cnt][3]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />
+                          -
+                          <input type="text" class="w30px ar" name="ip_sitelicense_to[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_to_<{$cnt}>_<{$ip_cnt}>_1" value="<{$sitelicense_to[$cnt][$ip_cnt][0]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
+                          <input type="text" class="w30px ar" name="ip_sitelicense_to[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_to_<{$cnt}>_<{$ip_cnt}>_2" value="<{$sitelicense_to[$cnt][$ip_cnt][1]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
+                          <input type="text" class="w30px ar" name="ip_sitelicense_to[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_to_<{$cnt}>_<{$ip_cnt}>_3" value="<{$sitelicense_to[$cnt][$ip_cnt][2]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />&nbsp;.&nbsp;
+                          <input type="text" class="w30px ar" name="ip_sitelicense_to[<{$cnt}>][<{$ip_cnt}>][]" id="input_def_to_<{$cnt}>_<{$ip_cnt}>_4" value="<{$sitelicense_to[$cnt][$ip_cnt][3]}>" onclick="return checkInput(this.id, event);" onkeypress="return checkInput(this.id, event);" class="w30px" style="ime-mode:disabled;" />
+                          <{/section}>
+                          <br><br>
+                          <input type="button" class="btn_white" onclick="javascript: repositoryPdfCoverHeaderImgDelChk(); repositoryCls['<{$id}>'].repositoryAdminEditRowFileUpload('addiprow', <{$cnt}>); return false;" value="<{$lang.repository_admin_site_license_addrow}>" />
+				        </td>
 				       </tr>
 				       <{/section}>
 				      </table>
@@ -1171,18 +1307,63 @@
 		   </tr>
 		  <{* PrefixID *}>
           <{* Add new prefix 2013/12/25 T.Ichikawa --start-- *}>
+          <{* Add DataCite 2015/02/10 K.Sugimoto --start-- *}>
            <tr>
-    	    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_get_jalc_doi}></td>
-		    <td class="w70 al item_edit_list">
-		     <input id="jalcdoi_id" type="text" name="prefixJalcDoi" class="full al" value="<{if $action.prefixJalcDoi != null}><{$action.prefixJalcDoi}><{/if}>">
-            </td>
-           </tr>
-           <tr>
-    	    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_get_cross_ref_doi}></td>
-		    <td class="w70 al item_edit_list">
-		     <input id="crossref_id" type="text" name="prefixCrossRef" class="full al" value="<{if $action.prefixCrossRef != null}><{$action.prefixCrossRef}><{/if}>">
-            </td>
+            <{if $smarty.const._REPOSITORY_JALC_DOI == true || $smarty.const._REPOSITORY_JALC_CROSSREF_DOI == true || $smarty.const._REPOSITORY_JALC_DATACITE_DOI == true}>
+             <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_jalc}></td>
+              <td class="w70 al item_edit_list">
+               <table class="full">
+                 <{if $smarty.const._REPOSITORY_JALC_DOI == true}>
+                  <tr>
+                    <td>
+                      <{$lang.repository_admin_get_jalc_doi}>
+                    </td>
+                    <td class="full">
+                      <input id="jalcdoi_id" type="text" name="prefixJalcDoi" class="full al" value="<{if $action.prefixJalcDoi != null}><{$action.prefixJalcDoi}><{/if}>">
+                    </td>
+                  </tr>
+                 <{/if}>
+                 <{if $smarty.const._REPOSITORY_JALC_CROSSREF_DOI == true}>
+                  <tr>
+                    <td>
+                      <{$lang.repository_admin_get_cross_ref_doi}>
+                    </td>
+                    <td class="full">
+                      <input id="crossref_id" type="text" name="prefixCrossRef" class="full al" value="<{if $action.prefixCrossRef != null}><{$action.prefixCrossRef}><{/if}>">
+                    </td>
+                  </tr>
+                 <{/if}>
+                 <{if $smarty.const._REPOSITORY_JALC_DATACITE_DOI == true}>
+                  <tr>
+                    <td>
+                      <{$lang.repository_admin_get_datacite_doi}>
+                    </td>
+                    <td class="full">
+                      <input id="datacite_id" type="text" name="prefixDataCite" class="full al" value="<{if $action.prefixDataCite != null}><{$action.prefixDataCite}><{/if}>">
+                    </td>
+                  </tr>
+                 <{/if}>
+                 <tr>
+                   <td>
+                     <{$lang.repository_admin_prefix_flag}>
+                   </td>
+                   <td class="full">
+                     <label style="margin-right:10px">
+                      <input type="radio" name="prefix_flag" value="1" <{if $action.prefix_flag > 0}>checked=""<{/if}> <{if $action.exist_doi_item > 0}>disabled=""<{/if}>>
+                      <{$lang.repository_admin_add_prefix}>
+                     </label>
+                     <label>
+                      <input type="radio" name="prefix_flag" value="0" <{if $action.prefix_flag == 0}>checked=""<{/if}> <{if $action.exist_doi_item > 0}>disabled=""<{/if}>>
+                      <{$lang.repository_admin_do_not_add_prefix}>
+                     </label>
+                   </td>
+                 </tr>
+               </table>
+              </td>
+             </td>
+            <{/if}>
            </tr>
+          <{* Add DataCite 2015/02/10 K.Sugimoto --end-- *}>
            <tr>
     	    <td class="vt al item_edit_list normal w30"><{$lang.repository_admin_get_cnri}></td>
 		    <td class="w70 al item_edit_list">
@@ -1270,6 +1451,29 @@
                </tr>
                <{* Add ICHUSHI Login A.jin 2012/11/14 --end-- *}>
                
+               <{* Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/02 --start-- *}>
+               <tr>
+                 <{* CrossRef Query Services Account *}>
+                 <td class="vt al item_edit_list normal w30" nowrap="nowrap" valign="top"><{$lang.repository_admin_CrossRefQueryServicesAccount}></td>
+                 <td class="w70 al item_edit_list">
+                   <input type="text" name="CrossRefQueryServicesAccount" class="full al" value="<{$smarty.session.admin_params.CrossRefQueryServicesAccount.param_value}>">
+                </td>
+               </tr>
+               <{* Auto Input Metadata by CrossRef DOI K.Sugimoto 2015/03/02 --end-- *}>
+               
+               <{*Institution Name setting*}>
+               <tr>
+                <th class="th_col_repos al" colspan=2><{$lang.repository_admin_institution_name}></th>
+               </tr>
+               <tr>
+                   <td class="vt al item_edit_list normal w30">
+                       <{$lang.repository_admin_institution_name_explanation}>
+                   </td>
+                   <td class="w70 al item_edit_list">
+                    <input type="text" name="institutionName" class="full al" value="<{$smarty.session.admin_params.institution_name.param_value}>">
+                   </td>
+               </tr>
+               
 			   <{*OAI-PMH setting*}>
 			   <tr>
 			    <th class="th_col_repos al" colspan=2><{$lang.repository_admin_oaipmh}></th>
@@ -2283,6 +2487,10 @@
 	 	} else{
 	 		$('id_disp_index_type').disabled = true;
 	 		$('id_default_index').style.display = "none";
+	 		<{*Add ranking tab display setting 2015/03/24 K.Sugimoto --start--*}>
+	 		var ranking_tab_display = document.getElementsByName("ranking_tab_display");
+	 		ranking_tab_display[0].checked = true;
+	 		<{*Add ranking tab display setting 2015/03/24 K.Sugimoto --end--*}>
 	 	}
 	 	return;
   	}
@@ -3008,3 +3216,23 @@
         document.getElementById("id_external_searchword_word").value = document.getElementById("id_default_stopword").value;
     }
 </script>
+<{*Add ranking tab display setting 2015/03/24 K.Sugimoto --start--*}>
+<script class="nc_script" type="text/javascript">
+    changeIndexAuto = function() {
+        var ranking_tab_display = document.getElementsByName("ranking_tab_display");
+        if(ranking_tab_display[1].checked)
+        {
+            $('id_default_disp_type').value = '0';
+	 		$('id_disp_index_type').disabled = false;
+	 		if($('id_disp_index_type').value == '1'){
+	 			$('id_default_index').style.display = "";
+	 		}
+        }
+    }
+</script>
+<{*Add ranking tab display setting 2015/03/24 K.Sugimoto --end--*}>
+<script class="nc_script" type="text/javascript">
+    robotlistCheckbox<{$id}> = function() {
+        document.getElementById("robotlistUpdate").disabled = "disabled";
+    }
+</script>
diff --git a/repository/templates/default/repository_adminconf_confirm.html b/repository/templates/default/repository_adminconf_confirm.html
index b7046de..4a73165 100644
--- a/repository/templates/default/repository_adminconf_confirm.html
+++ b/repository/templates/default/repository_adminconf_confirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_adminconf_confirm.html 599 2014-07-14 09:06:17Z ivis $  -->
+<!--// $Id: repository_adminconf_confirm.html 36507 2014-05-30 02:18:58Z tomohiro_ichikawa $  -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_charge.html b/repository/templates/default/repository_charge.html
index f0a75b0..f561dd0 100644
--- a/repository/templates/default/repository_charge.html
+++ b/repository/templates/default/repository_charge.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_charge.html 516 2012-05-22 09:30:55Z ivis $      -->
+<!--// $Id: repository_charge.html 12845 2011-11-09 10:45:05Z yuko_nakao $      -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_cinii_admin.html b/repository/templates/default/repository_cinii_admin.html
index c86c533..5777341 100644
--- a/repository/templates/default/repository_cinii_admin.html
+++ b/repository/templates/default/repository_cinii_admin.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_cinii_admin.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_cinii_admin.html 31729 2014-02-18 00:32:14Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_edit_tree.html b/repository/templates/default/repository_edit_tree.html
index f98b212..8d1db46 100644
--- a/repository/templates/default/repository_edit_tree.html
+++ b/repository/templates/default/repository_edit_tree.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_edit_tree.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: repository_edit_tree.html 54835 2015-06-25 04:10:46Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -80,7 +80,7 @@
 						<th class="item_edit_list4 vt al ptb04 plr08"><{$lang.repository_edittree_publish}></th>
 						<td class="item_edit_list4 al" colspan="3">
 							<label for="publish_repos<{$id}>">
-								<input type="checkbox" id="publish_repos<{$id}>" onclick="if(this.checked==true){$('input_date_repos').style.display='block';}else{$('input_date_repos').style.display='none';}" disabled/>
+								<input type="checkbox" id="publish_repos<{$id}>" onclick="if(this.checked==true){$('input_date_repos').style.display='block';$('pubdate_recursive<{$id}>').checked='';}else{$('input_date_repos').style.display='none';$('pubdate_recursive<{$id}>').checked='';}" disabled/>
 									<{$lang.repository_edittree_show}><span style="color: #8a8;"><{$lang.repository_edittree_setpubdate}></span>
 							</label>
 							<div style="display: none;" id="input_date_repos" >
@@ -136,6 +136,13 @@
 							<input type="hidden" id="hid_pubyear_repos<{$id}>" />
 							<input type="hidden" id="hid_pubmonth_repos<{$id}>" />
 							<input type="hidden" id="hid_pubday_repos<{$id}>" />
+							
+							<div>
+								<label class="mt05 ml15" for="pubdate_recursive<{$id}>">
+									<input type="checkbox" id="pubdate_recursive<{$id}>" disabled/>
+									<{$lang.repository_edittree_pub_date_recursive}>
+								</label>
+							</div>
 						</td>
 					</tr>
 					<{* Add child index display more 2009/01/16 Y.Nakao --start-- *}>
@@ -171,6 +178,11 @@
                             <label for="create_cover_flag<{$id}>">
                                 <input type="checkbox" id="create_cover_flag<{$id}>" disabled="disabled"/><{$lang.repository_edittree_pdf_cover_create}><br/>
                             </label>
+                            <br>
+                            <label class="mt05 ml15" for="create_cover_recursive<{$id}>">
+                                <input type="checkbox" id="create_cover_recursive<{$id}>" disabled/>
+                                <{$lang.repository_edittree_pdf_cover_recursive}>
+                            </label>
                         </td>
                     </tr>
                     <{* Add PDF cover page setting 2013/01/29 A.Suzuki --end-- *}>
@@ -368,6 +380,10 @@
 									</td>
 								</tr>
 							</table>
+                            <label class="mt05 mb05 ml25" for="aclRoleIds_recursive<{$id}>">
+                                <input type="checkbox" id="aclRoleIds_recursive<{$id}>" disabled/>
+                                <{$lang.repository_edittree_exclusive_acl_role_ids_recursive}>
+                            </label>
 						</td>
 					</tr>
 					<tr class="tree_access_control">
@@ -395,6 +411,10 @@
 									</td>
 								</tr>
 							</table>
+                            <label class="mt05 ml20" for="aclRoomAuth_recursive<{$id}>">
+                                <input type="checkbox" id="aclRoomAuth_recursive<{$id}>" disabled/>
+                                <{$lang.repository_edittree_exclusive_acl_room_auth_recursive}>
+                            </label>
 						</td>
 					</tr>
 					<tr class="tree_access_control">
@@ -428,6 +448,10 @@
 									</td>
 								</tr>
 							</table>
+                            <label class="mt05 mb05 ml25" for="aclGroupIds_recursive<{$id}>">
+                                <input type="checkbox" id="aclGroupIds_recursive<{$id}>" disabled/>
+                                <{$lang.repository_edittree_exclusive_acl_group_ids_recursive}>
+                            </label>
 						</td>
 					</tr>
 					
@@ -645,6 +669,13 @@
 		alert('<{$lang.repository_edittree_pubdate_error}>');
 	}
 	
+    <{* Add recursively uppdate flag 2015/01/21 S.Suzuki --start-- *}>
+	var pubdate_recursive = $('pubdate_recursive<{$id}>');
+	var create_cover_recursive = $('create_cover_recursive<{$id}>');
+	var aclRoleIds_recursive = $('aclRoleIds_recursive<{$id}>');
+	var aclRoomAuth_recursive = $('aclRoomAuth_recursive<{$id}>');
+	var aclGroupIds_recursive = $('aclGroupIds_recursive<{$id}>');
+    <{* Add recursively uppdate flag 2015/01/21 S.Suzuki --end-- *}>
 </script>
 
 <script class="nc_script" type="text/javascript">
@@ -833,19 +864,19 @@
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++exclusive_acl_role_name.length;
 				if(list[ii] == '_AUTH_SYSADMIN_NAME'){
-					exclusive_acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_ADMIN_NAME'){
-					exclusive_acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_ADMIN_NAME}>';
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_ADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_CHIEF_NAME'){
-					exclusive_acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_CHIEF_NAME}>';
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_CHIEF_NAME}>';
 				} else if(list[ii] == '_AUTH_MODERATE_NAME'){
-					exclusive_acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_MODERATE_NAME}>';
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_MODERATE_NAME}>';
 				} else if(list[ii] == '_AUTH_GENERAL_NAME'){
-					exclusive_acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GENERAL_NAME}>';
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GENERAL_NAME}>';
 				} else if(list[ii] == '_AUTH_GUEST_NAME'){
-					exclusive_acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GUEST_NAME}>';
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GUEST_NAME}>';
 				} else if(list[ii] != '') {
-					exclusive_acl_role_name.options[ jj - 1 ].text = list[ii];
+					exclusive_acl_role_name.options[ jj - 1 ].innerHTML = list[ii];
 				}
 			}
 		}
@@ -880,25 +911,25 @@
 				var jj = ++acl_role_name.length;
                 // Add tree access control list 2012/02/22 T.Koyasu -start-
 				if(list[ii] == '_AUTH_SYSADMIN_NAME'){
-					acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
+					acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
                     acl_role_name.options[ jj - 1 ].disabled = "true";
                     //acl_role_name.options[ jj - 1 ].style.color = "#000";
 				} else if(list[ii] == '_AUTH_ADMIN_NAME'){
-					acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_ADMIN_NAME}>';
+					acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_ADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_CHIEF_NAME'){
-					acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_CHIEF_NAME}>';
+					acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_CHIEF_NAME}>';
 				} else if(list[ii] == '_AUTH_MODERATE_NAME'){
-					acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_MODERATE_NAME}>';
+					acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_MODERATE_NAME}>';
 				} else if(list[ii] == '_AUTH_GENERAL_NAME'){
-					acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GENERAL_NAME}>';
+					acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GENERAL_NAME}>';
 				} else if(list[ii] == '_AUTH_GUEST_NAME'){
-					acl_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GUEST_NAME}>';
+					acl_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GUEST_NAME}>';
                 } else if(list[ii] == '管理者'){
-                    acl_role_name.options[ jj - 1 ].text = list[ii];
+                    acl_role_name.options[ jj - 1 ].innerHTML = list[ii];
                     acl_role_name.options[ jj - 1 ].disabled = "true";
                     //acl_role_name.options[ jj - 1 ].style.color = "#000";
 				} else if(list[ii] != '') {
-					acl_role_name.options[ jj - 1 ].text = list[ii];
+					acl_role_name.options[ jj - 1 ].innerHTML = list[ii];
 				}
                 // Add tree access control list 2012/02/22 T.Koyasu -end-
 			}
@@ -930,19 +961,19 @@
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++exclusive_acl_group_name.length;
 				if(list[ii] == '_AUTH_SYSADMIN_NAME'){
-					exclusive_acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_ADMIN_NAME'){
-					exclusive_acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_ADMIN_NAME}>';
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_ADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_CHIEF_NAME'){
-					exclusive_acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_CHIEF_NAME}>';
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_CHIEF_NAME}>';
 				} else if(list[ii] == '_AUTH_MODERATE_NAME'){
-					exclusive_acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_MODERATE_NAME}>';
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_MODERATE_NAME}>';
 				} else if(list[ii] == '_AUTH_GENERAL_NAME'){
-					exclusive_acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GENERAL_NAME}>';
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GENERAL_NAME}>';
 				} else if(list[ii] == '_AUTH_GUEST_NAME'){
-					exclusive_acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GUEST_NAME}>';
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GUEST_NAME}>';
 				} else if(list[ii] != '') {
-					exclusive_acl_group_name.options[ jj - 1 ].text = list[ii];
+					exclusive_acl_group_name.options[ jj - 1 ].innerHTML = list[ii];
 				}
 			}
 		}
@@ -973,19 +1004,19 @@
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++acl_group_name.length;
 				if(list[ii] == '_AUTH_SYSADMIN_NAME'){
-					acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
+					acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_ADMIN_NAME'){
-					acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_ADMIN_NAME}>';
+					acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_ADMIN_NAME}>';
 				} else if(list[ii] == '_AUTH_CHIEF_NAME'){
-					acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_CHIEF_NAME}>';
+					acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_CHIEF_NAME}>';
 				} else if(list[ii] == '_AUTH_MODERATE_NAME'){
-					acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_MODERATE_NAME}>';
+					acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_MODERATE_NAME}>';
 				} else if(list[ii] == '_AUTH_GENERAL_NAME'){
-					acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GENERAL_NAME}>';
+					acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GENERAL_NAME}>';
 				} else if(list[ii] == '_AUTH_GUEST_NAME'){
-					acl_group_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GUEST_NAME}>';
+					acl_group_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GUEST_NAME}>';
 				} else if(list[ii] != '') {
-					acl_group_name.options[ jj - 1 ].text = list[ii];
+					acl_group_name.options[ jj - 1 ].innerHTML = list[ii];
 				}
 			}
 		}
@@ -1044,7 +1075,7 @@
 			cnt = group.length;
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++access_group_name.length;
-				access_group_name.options[ jj - 1 ].text = group[ii];
+				access_group_name.options[ jj - 1 ].innerHTML = group[ii];
 			}
 		}
 		///// access NG group /////
@@ -1065,7 +1096,7 @@
 			var cnt = group.length;
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++not_access_group_name.length;
-				not_access_group_name.options[ jj - 1 ].text = group[ii];
+				not_access_group_name.options[ jj - 1 ].innerHTML = group[ii];
 			}
 		}
 		
@@ -1089,19 +1120,19 @@
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++access_role_name.length;
 				if(auth[ii] == '_AUTH_SYSADMIN_NAME'){
-					access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
+					access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
 				} else if(auth[ii] == '_AUTH_ADMIN_NAME'){
-					access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_ADMIN_NAME}>';
+					access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_ADMIN_NAME}>';
 				} else if(auth[ii] == '_AUTH_CHIEF_NAME'){
-					access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_CHIEF_NAME}>';
+					access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_CHIEF_NAME}>';
 				} else if(auth[ii] == '_AUTH_MODERATE_NAME'){
-					access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_MODERATE_NAME}>';
+					access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_MODERATE_NAME}>';
 				} else if(auth[ii] == '_AUTH_GENERAL_NAME'){
-					access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GENERAL_NAME}>';
+					access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GENERAL_NAME}>';
 				} else if(auth[ii] == '_AUTH_GUEST_NAME'){
-					access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GUEST_NAME}>';
+					access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GUEST_NAME}>';
 				} else if(auth[ii] != '') {
-					access_role_name.options[ jj - 1 ].text = auth[ii];
+					access_role_name.options[ jj - 1 ].innerHTML = auth[ii];
 				}
 			}
 		}
@@ -1124,19 +1155,19 @@
 			for(ii=0; ii<cnt; ii++){
 				var jj = ++not_access_role_name.length;
 				if(auth[ii] == '_AUTH_SYSADMIN_NAME'){
-					not_access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
+					not_access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_SYSADMIN_NAME}>';
 				} else if(auth[ii] == '_AUTH_ADMIN_NAME'){
-					not_access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_ADMIN_NAME}>';
+					not_access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_ADMIN_NAME}>';
 				} else if(auth[ii] == '_AUTH_CHIEF_NAME'){
-					not_access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_CHIEF_NAME}>';
+					not_access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_CHIEF_NAME}>';
 				} else if(auth[ii] == '_AUTH_MODERATE_NAME'){
-					not_access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_MODERATE_NAME}>';
+					not_access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_MODERATE_NAME}>';
 				} else if(auth[ii] == '_AUTH_GENERAL_NAME'){
-					not_access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GENERAL_NAME}>';
+					not_access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GENERAL_NAME}>';
 				} else if(auth[ii] == '_AUTH_GUEST_NAME'){
-					not_access_role_name.options[ jj - 1 ].text = '<{$smarty.const._AUTH_GUEST_NAME}>';
+					not_access_role_name.options[ jj - 1 ].innerHTML = '<{$smarty.const._AUTH_GUEST_NAME}>';
 				} else if(auth[ii] != '') {
-					not_access_role_name.options[ jj - 1 ].text = auth[ii];
+					not_access_role_name.options[ jj - 1 ].innerHTML = auth[ii];
 				}
 			}
 		}
@@ -1339,6 +1370,33 @@
             biblio_flag.checked = "";
         }
         // Add issn and biblio flag 2014/04/16 --end--
+        
+        // Add recursively uppdate flag 2015/01/21 S.Suzuki --start--
+        if(edit_id == "0"){
+            pubdate_recursive.disabled = "true";
+            pubdate_recursive.checked = false;
+            create_cover_recursive.disabled = "true";
+            create_cover_recursive.checked = false;
+            aclRoleIds_recursive.disabled = "true";
+            aclRoleIds_recursive.checked = false;
+            aclRoomAuth_recursive.disabled = "true";
+            aclRoomAuth_recursive.checked = false;
+            aclGroupIds_recursive.disabled = "true";
+            aclGroupIds_recursive.checked = false;
+        }
+        else {
+            pubdate_recursive.disabled = "";
+            pubdate_recursive.checked = "";
+            create_cover_recursive.disabled = "";
+            create_cover_recursive.checked = "";
+            aclRoleIds_recursive.disabled = "";
+            aclRoleIds_recursive.checked = "";
+            aclRoomAuth_recursive.disabled = "";
+            aclRoomAuth_recursive.checked = "";
+            aclGroupIds_recursive.disabled = "";
+            aclGroupIds_recursive.checked = "";
+        }
+        // Add recursively uppdate flag 2015/01/21 S.Suzuki --end--
 	}
 </script>
 
@@ -1355,7 +1413,7 @@
 				var elm = not_access_group_name.options[ii];
 				if (elm.selected) {
 					var jj = ++access_group_name.length;
-					access_group_name.options[ jj-1 ].text = elm.text;
+					access_group_name.options[ jj-1 ].innerHTML = elm.text;
 					not_access_group_name.options[ii] = null;
 					access_group_id_txt.push(not_access_group_id_txt[ii]);
 					not_access_group_id_txt.splice(ii,1);
@@ -1385,7 +1443,7 @@
 				var elm = access_group_name.options[ii];
 				if (elm.selected) {
 					var jj = ++not_access_group_name.length;
-					not_access_group_name.options[ jj-1 ].text = elm.text;
+					not_access_group_name.options[ jj-1 ].innerHTML = elm.text;
 					access_group_name.options[ii] = null;
 					not_access_group_id_txt.push(access_group_id_txt[ii]);
 					access_group_id_txt.splice(ii,1);
@@ -1417,7 +1475,7 @@
 				var elm = not_access_role_name.options[ii];
 				if (elm.selected) {
 					var jj = ++access_role_name.length;
-					access_role_name.options[ jj-1 ].text = elm.text;
+					access_role_name.options[ jj-1 ].innerHTML = elm.text;
 					not_access_role_name.options[ii] = null;
 					access_role_id_txt.push(not_access_role_id_txt[ii]);
 					not_access_role_id_txt.splice(ii,1);
@@ -1447,7 +1505,7 @@
 				var elm = access_role_name.options[ii];
 				if (elm.selected) {
 					var jj = ++not_access_role_name.length;
-					not_access_role_name.options[ jj-1 ].text = elm.text;
+					not_access_role_name.options[ jj-1 ].innerHTML = elm.text;
 					access_role_name.options[ii] = null;
 					not_access_role_id_txt.push(access_role_id_txt[ii]);
 					access_role_id_txt.splice(ii,1);
@@ -1770,6 +1828,19 @@
         online_issn.disabled = "true";
         biblio_flag.disabled = "true";
         // Add issn and biblio flag 2014/04/16 T.Ichikawa --end--
+        
+        // Add recursively uppdate flag 2015/01/21 S.Suzuki --start--
+        pubdate_recursive.checked = false;
+        pubdate_recursive.disabled = "true";
+        create_cover_recursive.checked = false;
+        create_cover_recursive.disabled = "true";
+        aclRoleIds_recursive.checked = false;
+        aclRoleIds_recursive.disabled = "true";
+        aclRoomAuth_recursive.checked = false;
+        aclRoomAuth_recursive.disabled = "true";
+        aclGroupIds_recursive.checked = false;
+        aclGroupIds_recursive.disabled = "true";
+        // Add recursively uppdate flag 2015/01/21 S.Suzuki --end--
 	}
 </script>
 <{* make new index and del index 2008/12/09 Y.Nakao --end-- *}>
@@ -1878,6 +1949,15 @@
         pars += '&thumbnail_del=' + thumbnail_del;
         pars += '&create_cover_flag=' + encodeURIComponent(create_cover_flag.checked);
         pars += '&harvest_public_state=' + encodeURIComponent(harvest_public_state.checked);
+        
+        // Add recursively uppdate flag 2015/01/21 S.Suzuki --start--
+        pars += '&pubdate_recursive=' + encodeURIComponent(pubdate_recursive.checked);
+        pars += '&create_cover_recursive=' + encodeURIComponent(create_cover_recursive.checked);
+        pars += '&aclRoleIds_recursive=' + encodeURIComponent(aclRoleIds_recursive.checked);
+        pars += '&aclRoomAuth_recursive=' + encodeURIComponent(aclRoomAuth_recursive.checked);
+        pars += '&aclGroupIds_recursive=' + encodeURIComponent(aclGroupIds_recursive.checked);
+        // Add recursively uppdate flag 2015/01/21 S.Suzuki --end--
+        
         if ('<{$smarty.session.MyPrivateTreeRootId}>' != "") {
 			repositoryCls['<{$id}>'].repositoryIndexThumbnailFileUpload(pars, "privateTree");
 		} else {
@@ -1926,10 +2006,15 @@
 	
 	dragMouseUp = function(drop_id, drop_index){
 		if(drag_id && drag_id!="" && drop_id!=drag_id){
-			var pars =  '&edit_mode=sort'+
-						'&drag_id='+drag_id+
-						'&drop_id='+drop_id+
-						'&drop_index='+drop_index;
+			if (ctrl_pressed) {
+				var pars = '&edit_mode=copy_tree';
+			}
+			else {
+				var pars = '&edit_mode=sort';
+			}
+			pars += '&drag_id='+drag_id+
+					'&drop_id='+drop_id+
+					'&drop_index='+drop_index;
 			if('<{$smarty.session.MyPrivateTreeRootId}>' != ""){
 				repositoryCls['<{$id}>'].onSubmitEdittree_repos(pars, "privateTree");
 			} else {
@@ -2088,7 +2173,7 @@
 				var elm = exclusive_acl_role_name.options[ii];
 				if (elm.selected || exclusive_acl_user_auth_id_txt[ii] >= minAuth) {
 					var jj = ++acl_role_name.length;
-					acl_role_name.options[ jj-1 ].text = elm.text;
+					acl_role_name.options[ jj-1 ].innerHTML = elm.text;
 					exclusive_acl_role_name.options[ii] = null;
 					acl_role_id_txt.push(exclusive_acl_role_id_txt[ii]);
                     acl_user_auth_id_txt.push(exclusive_acl_user_auth_id_txt[ii]);
@@ -2162,7 +2247,7 @@
 				var elm = acl_role_name.options[ii];
 				if (elm.selected || acl_user_auth_id_txt[ii] <= maxAuth) {
 					var jj = ++exclusive_acl_role_name.length;
-					exclusive_acl_role_name.options[ jj-1 ].text = elm.text;
+					exclusive_acl_role_name.options[ jj-1 ].innerHTML = elm.text;
 					acl_role_name.options[ii] = null;
 					exclusive_acl_role_id_txt.push(acl_role_id_txt[ii]);
                     exclusive_acl_user_auth_id_txt.push(acl_user_auth_id_txt[ii]);
@@ -2206,7 +2291,7 @@
 				var elm = exclusive_acl_group_name.options[ii];
 				if (elm.selected) {
 					var jj = ++acl_group_name.length;
-					acl_group_name.options[ jj-1 ].text = elm.text;
+					acl_group_name.options[ jj-1 ].innerHTML = elm.text;
 					exclusive_acl_group_name.options[ii] = null;
 					acl_group_id_txt.push(exclusive_acl_group_id_txt[ii]);
 					exclusive_acl_group_id_txt.splice(ii,1);
@@ -2236,7 +2321,7 @@
 				var elm = acl_group_name.options[ii];
 				if (elm.selected) {
 					var jj = ++exclusive_acl_group_name.length;
-					exclusive_acl_group_name.options[ jj-1 ].text = elm.text;
+					exclusive_acl_group_name.options[ jj-1 ].innerHTML = elm.text;
 					acl_group_name.options[ii] = null;
 					exclusive_acl_group_id_txt.push(acl_group_id_txt[ii]);
 					acl_group_id_txt.splice(ii,1);
@@ -2297,3 +2382,25 @@
 	
 </script>
 <{* Add hide tree access control list 2013/04/19 K.Matsuo --end-- *}>
+
+<{* Add copy index tree 2014/01/20 S.Suzuki --start-- *}>
+<script class="nc_script" type="text/javascript">
+// キー状態保持変数
+ctrl_pressed = false;
+
+// Ctrlキーを押したとき
+document.onkeydown = function (e){
+    if (e.ctrlKey){
+        if (!e) e = window.event;
+        ctrl_pressed = true;
+    }
+};
+
+// Ctrlキーを放したとき
+document.onkeyup = function (e){
+    if (!e) e = window.event;
+    ctrl_pressed = false;
+};
+</script>
+<{* Add copy index tree 2014/01/20 S.Suzuki --end-- *}>
+
diff --git a/repository/templates/default/repository_edit_tree_confirm.html b/repository/templates/default/repository_edit_tree_confirm.html
index d7bfa2e..7cbfd3b 100644
--- a/repository/templates/default/repository_edit_tree_confirm.html
+++ b/repository/templates/default/repository_edit_tree_confirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_edit_tree_confirm.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_edit_tree_confirm.html 24105 2013-07-17 06:56:06Z koji_matsuo $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_export_detailconfirm.html b/repository/templates/default/repository_export_detailconfirm.html
index 4b08c67..e88a4a6 100644
--- a/repository/templates/default/repository_export_detailconfirm.html
+++ b/repository/templates/default/repository_export_detailconfirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_export_detailconfirm.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_export_detailconfirm.html 40423 2014-08-26 02:30:50Z tatsuya_koyasu $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_export_list.html b/repository/templates/default/repository_export_list.html
index ba492dd..5c79fc9 100644
--- a/repository/templates/default/repository_export_list.html
+++ b/repository/templates/default/repository_export_list.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_export_list.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_export_list.html 31571 2014-02-10 10:16:56Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_import_confirm.html b/repository/templates/default/repository_import_confirm.html
index d9d28bf..f3ea776 100644
--- a/repository/templates/default/repository_import_confirm.html
+++ b/repository/templates/default/repository_import_confirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_import_confirm.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_import_confirm.html 30569 2014-01-09 07:37:40Z rei_matsuura $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_import_select.html b/repository/templates/default/repository_import_select.html
index 44f0ea6..114ce3b 100644
--- a/repository/templates/default/repository_import_select.html
+++ b/repository/templates/default/repository_import_select.html
@@ -1,325 +1,325 @@
-<!--// ---------------------------------------------------------------------->
-<!--//                                                                     -->
-<!--// $Id: repository_import_select.html 651 2014-11-13 10:14:11Z ivis $          -->
-<!--//                                                                     -->
-<!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
-<!--// Research and Development Center for Scientific Information Resources -->
-<!--//                                                                     -->
-<!--// This program is licensed under a Creative Commons BSD Licence       -->
-<!--// http://creativecommons.org/licenses/BSD/                            -->
-<!--//                                                                     -->
-<!--// ---------------------------------------------------------------------->
-
-<{*Import*}>
-
-<{if strlen($action.error_msg) > 0}>
-	<p class="mtb10 error_msg">
-		<{$action.error_msg}>
-	</p>
-<{/if}>
-
-<{strip}>
-	<{if $smarty.session._lang=="japanese" && $action.help_icon_display == "1"}>
-		<div align="right" class="pt10 pr10">
-
-			<a href="#" style="cursor: help;" onclick="
-				if($('import_active_tab_id').value==0)
-				{
-					repositoryCls['<{$id}>'].repositoryHelp(event,'import');
-				}
-				else
-				{
-					repositoryCls['<{$id}>'].repositoryHelp(event,'import_authority');
-				}
-				return false;"
-			>
-				<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/default/help.png" alt="help">
-			</a>
-
-		</div>
-	<{/if}>
-<form id="attachment_form<{$id}>" target="attachment_form<{$id}>" enctype="multipart/form-data">
-<div class="mt10">
-	<div class="comp_tabset"></div>
-	<div class="comp_tabset_content" style="border-bottom: none; border-left: none; border-right: none;">
-		<{* タブ1：コンテンツ tab1:contents *}>
-		<div class="th_classic_content content text_color" id="import_tab_1" align="center" >
-       <{* show error massage list 2014/11/04 T.Koyasu --start-- *}>
-            <{if $action.error_info != null && count($action.error_info) > 0}>
-                <div class="error_msg mt05">
-                    <table class="full tb01" align="center">
-                        <tr>
-                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_item_title}></th>
-                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_error}></th>
-                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_attr_name}></th>
-                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_input_value}></th>
-                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_regist_value}></th>
-                        </tr>
-                        <{foreach from=$action.error_info item=error_list name=cnt}>
-                            <{assign var="iCnt" value=$smarty.foreach.cnt.iteration-1}>
-                            <{if $iCnt % 2 == 0}> 
-                                <tr class="list_line_repos1">
-                            <{else}>
-                                <tr class="list_line_repos2">
-                            <{/if}>
-                                <td class="w300px" style="white-space:normal; ">
-                                    <{$error_list.title}>
-                                </td>
-                                <td class="w300px" style="white-space:normal; ">
-                                    <{if $error_list.error_no == 1}>
-                                        <{$lang.repository_import_error_msg_no_xml}>
-                                    <{elseif $error_list.error_no == 2}>
-                                        <{$lang.repository_import_error_msg_parse_xml}>
-                                    <{elseif $error_list.error_no == 3}>
-                                        <{$lang.repository_import_error_msg_tag_num}>
-                                    <{elseif $error_list.error_no == 4}>
-                                        <{$lang.repository_import_error_msg_item_title}>
-                                    <{elseif $error_list.error_no == 5}>
-                                        <{$lang.repository_import_error_msg_item_shown_date}>
-                                    <{elseif $error_list.error_no == 6}>
-                                        <{$lang.repository_import_error_msg_item_no_shown_date}>
-                                    <{elseif $error_list.error_no == 7}>
-                                        <{$lang.repository_import_error_msg_item_attr_is_required}>
-                                    <{elseif $error_list.error_no == 8}>
-                                        <{$lang.repository_import_error_msg_item_attr_type}>
-                                    <{elseif $error_list.error_no == 9}>
-                                        <{$lang.repository_import_error_msg_item_attr_link}>
-                                    <{elseif $error_list.error_no == 10}>
-                                        <{$lang.repository_import_error_msg_item_attr_date}>
-                                    <{elseif $error_list.error_no == 11}>
-                                        <{$lang.repository_import_error_msg_item_attr_candidate}>
-                                    <{elseif $error_list.error_no == 12}>
-                                        <{$lang.repository_import_error_msg_biblio_issue_date}>
-                                    <{elseif $error_list.error_no == 13}>
-                                        <{$lang.repository_import_error_msg_thumbnail_not_exist}>
-                                    <{elseif $error_list.error_no == 14}>
-                                        <{$lang.repository_import_error_msg_file_not_exist}>
-                                    <{elseif $error_list.error_no == 15}>
-                                        <{$lang.repository_import_error_msg_file_pub_date}>
-                                    <{elseif $error_list.error_no == 16}>
-                                        <{$lang.repository_import_error_msg_flash_pub_date}>
-                                    <{elseif $error_list.error_no == 17}>
-                                        <{$lang.repository_import_error_msg_item_type}>
-                                    <{elseif $error_list.error_no == 18}>
-                                        <{$lang.repository_import_error_msg_edit_item_url}>
-                                    <{elseif $error_list.error_no == 19}>
-                                        <{$lang.repository_import_error_msg_edit_item_num}>
-                                    <{/if}>
-                                </td>
-                                <td>
-                                    <{$error_list.attr_name}>
-                                </td>
-                                <td>
-                                    <{$error_list.input_value}>
-                                </td>
-                                <td>
-                                    <{$error_list.regist_value}>
-                                </td>
-                            </tr>
-                        <{/foreach}>
-                    </table>
-                </div>
-            <{/if}>
-            <{* show error massage list 2014/11/04 T.Koyasu --end-- *}>
-			<div id="repo_side_navi" class="fl">
-				<{* make index tree 2008/12/03 Y.Nakao --start-- *}>
-				<div>
-					<h3 class="th_repos_title_bar nc_block_title c">
-						<span class="pl05">
-							<{$lang.repository_index_tree}>
-						</span>
-					</h3>
-					<div class="th_classic_content content" id="repository_import_tree" align="left" style="width: <{$smarty.const._SNIPPET_WIDTH}>px; overflow:auto;"></div>
-					<{include file="repository_item_search_tree.html"}>
-					<{* make index tree 2008/12/03 Y.Nakao --end-- *}>
-				</div>
-			</div>
-			<div class="repository_right_header plr20" style="position: relative; top: 70px">
-                <table class="tb01 full" style="position: relative; right:10px">
-					<tr>
-						<th class="item_edit_list"><{$lang.repository_import_select_item}></th>
-						<td class="item_edit_list al">
-							<div class="nobr"><input type="file" name="upload[]" size="30"/></div><!-- old w15em -->
-						</td>
-					</tr>
-					<tr>
-						<th class="item_edit_list"><{$lang.repository_import_index}></th>
-						<td class="item_edit_list al">
-							<{$lang.repository_import_select_index}><br />
-							<form name="import_select" method="post" enctype="multipart/form-data">
-								<{* Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/26 --start-- *}>
-								<{strip}>
-								<label class="pl10" id="selected_index">
-									<{foreach from=$action.selectedIndexName item=indexName name=loopIndexName}>
-										<{assign var="loopIndexName" value=$smarty.foreach.loopIndexName.iteration-1}>
-										<{if $loopIndexName>0}><br><{/if}><{$indexName}>
-									<{/foreach}>
-								</label>
-								<{/strip}>
-								<br/>
-								<input type="hidden" id="check_insert_idx" value="<{$action.selectedIndexIds}>" readonly />
-								<{* Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/26 --end-- *}>
-							</form>
-						</td>
-					</tr>
-				</table>
-
-				<center class="pt20">
-					<{* import button 2012/1/26 --start-- A.jin --start-- *}>
-					<input type="button" class="btn_blue ac" value="<{$lang.repository_import}>" onclick="repositoryCls['<{$id}>'].repositoryImportFileUpload();return false;" />
-				</center>
-				<{* import button 2012/1/26 --start-- A.jin --end-- *}>
-			</div>
-		</div>
-
-		<{* タブ2：WEKO著者名典拠 tab2:author *}>
-		<div class="th_classic_content content text_color" id="import_tab_2" align="center" style="height: 360px;">
-			<div align="right" class="pt10 pr10">
-				<span id="repositoryExportTemplate<{$id}>">
-					<a href="#" onclick="javascript: templateDownload(); return false;" ><{$lang.repository_importauthority_result_template}></a>
-				</span>
-				<span id="repository<{$id}>_exportBtn" style="position: relative; right: 110px " >
-					<img border="0" id="repositoryNowLoading<{$id}>" style="display:none" src="<{$smarty.const.BASE_URL}>/images/common/indicator.gif" />
-				</span>
-			</div>
-			<table class="tb01 w70" style="position: relative; top: 70px">
-				<tr>
-					<th class="item_edit_list"><{$lang.repository_import_select_item}></th>
-					<td class="item_edit_list al">
-						<div class="nobr"><input type="file" name="upload[]" size="30"/></div><!-- old w15em -->
-					</td>
-				</tr>
-			</table>
-			<center class="pt20" style="position: relative; top: 70px">
-				<input type="button" class="btn_blue ac" value="<{$lang.repository_import}>" onclick="repositoryCls['<{$id}>'].repositoryImportauthorityFileUpload();return false;" />
-			</center>
-		</div>
-	</div>
-</div>
-</form>
-<span style="display:none;height=0px;width=0px;" id="repositoryListDownload<{$id}>"></span>
-<{/strip}>
-<{* 2008/05/20 S.Kawasaki nc_script文字数制限の暫定対応でツリー生成-描画コードを分割して記述するように修正*}>
-<{* make index tree 2008/12/03 Y.Nakao --start-- *}>
-<script class="nc_script" type="text/javascript">
-    repositoryInitTree<{$id}>('repository_import_tree','<{$id}>', 'check');
-	$('repository_import_tree').style.height = <{$smarty.const._SNIPPET_HEIGHT}>+"px";
-	$('repository_import_tree').style.width = <{$smarty.const._SNIPPET_WIDTH}>+"px";
-</script>
-<script class="nc_script" type="text/javascript">
-    repositoryClickTreeCheck<{$id}> = function(id, idx_name){
-		if( $('selected_index') != null ) {
-			var elm_name = 'tree_check' + id;
-			if($(elm_name).checked){
-				// check true
-				if($('selected_index').innerHTML != ""){
-					//IE判定
-					var userAgent = window.navigator.userAgent.toLowerCase();
-					var appVersion = window.navigator.appVersion.toLowerCase();
-					if((userAgent.indexOf("msie") > -1) && (appVersion.indexOf("msie 8.") != -1)){
-						$('selected_index').innerHTML += '<BR>' + idx_name;
-					}
-					else{
-						$('selected_index').innerHTML += '<br>' + idx_name;
-					}
-					$('check_insert_idx').value += '|' + id;
-				} else {
-					$('selected_index').innerHTML = idx_name;
-					$('check_insert_idx').value = id;
-				}
-			} else {
-				// check false
-				// view index name
-				//IE判定
-				var userAgent = window.navigator.userAgent.toLowerCase();
-				var appVersion = window.navigator.appVersion.toLowerCase();
-
-				var str = '';
-				if((userAgent.indexOf("msie") > -1)&&(appVersion.indexOf("msie 8.") != -1)){
-					//IE8か
-					str = "<BR>"+$('selected_index').innerHTML+"<BR>";
-					var tempStr = "<BR>"+idx_name+"<BR>";
-					str = str.replace(tempStr, "<BR>");
-					str = str.substr(4,str.length-8);
-				}
-				else{
-					str = "<br>"+$('selected_index').innerHTML+"<br>";
-					var tempStr = "<br>"+idx_name+"<br>";
-					str = str.replace(tempStr, "<br>");
-					str = str.substr(4,str.length-8);
-				}
-
-				$('selected_index').innerHTML = str;
-				// hidden index id
-				str = "|"+$('check_insert_idx').value+"|";
-				str = str.replace("|"+id+"|", "|");
-				str = str.substr(1,str.length-2);
-				$('check_insert_idx').value = str;
-			}
-		}
-	}
-</script>
-<{* make index tree 2008/12/03 Y.Nakao --end-- *}>
-
-<{* import name_authority 2013/11/25 R.Matsuura --start-- *}>
-<{* display tab number *}>
-<input type="hidden" id="import_active_tab_id" name="import_active_tab" value="0" />
-<script class="nc_script" type="text/javascript">
-	changeActiveTab1 = function(){
-		$('import_active_tab_id').value = 0;
-	}
-	changeActiveTab2 = function(){
-		$('import_active_tab_id').value = 1;
-	}
-
-</script>
-
-<script class="nc_script" type="text/javascript">
-	var tabset = new compTabset('<{$id}>');
-	tabset.setActiveIndex( valueParseInt('0') );
-	tabset.addTabset('<{$lang.repository_import_tab_contents}>', changeActiveTab1);
-	tabset.addTabset('<{$lang.repository_import_tab_authority}>', changeActiveTab2);
-	tabset.render();
-</script>
-<script class="nc_script" type="text/javascript">
-	templateDownload = function() {
-		var url = _nc_base_url + "/index.php"+
-					"?action=repository_action_edit_importauthority_download" + "&page_is=" + <{$page_id}> + "&block_id=" + <{$block_id}>;
-
-		// brauzaCheck
-		var userAgent = window.navigator.userAgent.toLowerCase();
-		var appVersion = window.navigator.appVersion.toLowerCase();
-		//IE
-		if (userAgent.indexOf("msie") > -1 || userAgent.indexOf("trident") > -1) {
-			loadingIcon(true);
-			$('repositoryListDownload<{$id}>').innerHTML = '<iframe boder="0" name="exportFrame<{$id}>" id="exportFrame<{$id}>" src="'+url+'"></iframe>';
-		}
-		//Firefox…OK
-		else if (userAgent.indexOf("firefox") > -1) {
-			loadingIcon(true);
-			$('repositoryListDownload<{$id}>').innerHTML = '<iframe boder="0" name="exportFrame<{$id}>" id="exportFrame<{$id}>" src="'+url+'" onload="javascript: loadingIcon(false);"></iframe>';
-		}
-		else
-		{
-			$('repositoryListDownload<{$id}>').innerHTML = '<iframe boder="0" name="exportFrame<{$id}>" id="exportFrame<{$id}>" src="'+url+'"></iframe>';
-		}
-		return false;
-	}
-</script>
-<script class="nc_script" type="text/javascript">
-	loadingIcon = function(onFlg) {
-		if(onFlg)
-		{
-			$('repositoryExportTemplate<{$id}>').style.display='none';
-			$('repositoryNowLoading<{$id}>').style.display='';
-		}
-		else
-		{
-			$('repositoryExportTemplate<{$id}>').style.display='';
-			$('repositoryNowLoading<{$id}>').style.display='none';
-		}
-	}
-</script>
-<{* import name_authority 2013/11/25 R.Matsuura --end-- *}>
-<{include file="repository_script.html"}>
-
+<!--// ---------------------------------------------------------------------->
+<!--//                                                                     -->
+<!--// $Id: repository_import_select.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
+<!--//                                                                     -->
+<!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
+<!--// Research and Development Center for Scientific Information Resources -->
+<!--//                                                                     -->
+<!--// This program is licensed under a Creative Commons BSD Licence       -->
+<!--// http://creativecommons.org/licenses/BSD/                            -->
+<!--//                                                                     -->
+<!--// ---------------------------------------------------------------------->
+
+<{*Import*}>
+
+<{if strlen($action.error_msg) > 0}>
+	<p class="mtb10 error_msg">
+		<{$action.error_msg}>
+	</p>
+<{/if}>
+
+<{strip}>
+	<{if $smarty.session._lang=="japanese" && $action.help_icon_display == "1"}>
+		<div align="right" class="pt10 pr10">
+
+			<a href="#" style="cursor: help;" onclick="
+				if($('import_active_tab_id').value==0)
+				{
+					repositoryCls['<{$id}>'].repositoryHelp(event,'import');
+				}
+				else
+				{
+					repositoryCls['<{$id}>'].repositoryHelp(event,'import_authority');
+				}
+				return false;"
+			>
+				<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/default/help.png" alt="help">
+			</a>
+
+		</div>
+	<{/if}>
+<form id="attachment_form<{$id}>" target="attachment_form<{$id}>" enctype="multipart/form-data">
+<div class="mt10">
+	<div class="comp_tabset"></div>
+	<div class="comp_tabset_content" style="border-bottom: none; border-left: none; border-right: none; width: 900px;">
+		<{* タブ1：コンテンツ tab1:contents *}>
+		<div class="th_classic_content content text_color" id="import_tab_1" align="center" >
+       <{* show error massage list 2014/11/04 T.Koyasu --start-- *}>
+            <{if $action.error_info != null && count($action.error_info) > 0}>
+                <div class="error_msg mt05">
+                    <table class="full tb01" align="center">
+                        <tr>
+                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_item_title}></th>
+                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_error}></th>
+                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_attr_name}></th>
+                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_input_value}></th>
+                            <th class="th_col_repos ac"><{$lang.repository_import_error_header_regist_value}></th>
+                        </tr>
+                        <{foreach from=$action.error_info item=error_list name=cnt}>
+                            <{assign var="iCnt" value=$smarty.foreach.cnt.iteration-1}>
+                            <{if $iCnt % 2 == 0}> 
+                                <tr class="list_line_repos1">
+                            <{else}>
+                                <tr class="list_line_repos2">
+                            <{/if}>
+                                <td class="w300px" style="white-space:normal; ">
+                                    <{$error_list.title}>
+                                </td>
+                                <td class="w300px" style="white-space:normal; ">
+                                    <{if $error_list.error_no == 1}>
+                                        <{$lang.repository_import_error_msg_no_xml}>
+                                    <{elseif $error_list.error_no == 2}>
+                                        <{$lang.repository_import_error_msg_parse_xml}>
+                                    <{elseif $error_list.error_no == 3}>
+                                        <{$lang.repository_import_error_msg_tag_num}>
+                                    <{elseif $error_list.error_no == 4}>
+                                        <{$lang.repository_import_error_msg_item_title}>
+                                    <{elseif $error_list.error_no == 5}>
+                                        <{$lang.repository_import_error_msg_item_shown_date}>
+                                    <{elseif $error_list.error_no == 6}>
+                                        <{$lang.repository_import_error_msg_item_no_shown_date}>
+                                    <{elseif $error_list.error_no == 7}>
+                                        <{$lang.repository_import_error_msg_item_attr_is_required}>
+                                    <{elseif $error_list.error_no == 8}>
+                                        <{$lang.repository_import_error_msg_item_attr_type}>
+                                    <{elseif $error_list.error_no == 9}>
+                                        <{$lang.repository_import_error_msg_item_attr_link}>
+                                    <{elseif $error_list.error_no == 10}>
+                                        <{$lang.repository_import_error_msg_item_attr_date}>
+                                    <{elseif $error_list.error_no == 11}>
+                                        <{$lang.repository_import_error_msg_item_attr_candidate}>
+                                    <{elseif $error_list.error_no == 12}>
+                                        <{$lang.repository_import_error_msg_biblio_issue_date}>
+                                    <{elseif $error_list.error_no == 13}>
+                                        <{$lang.repository_import_error_msg_thumbnail_not_exist}>
+                                    <{elseif $error_list.error_no == 14}>
+                                        <{$lang.repository_import_error_msg_file_not_exist}>
+                                    <{elseif $error_list.error_no == 15}>
+                                        <{$lang.repository_import_error_msg_file_pub_date}>
+                                    <{elseif $error_list.error_no == 16}>
+                                        <{$lang.repository_import_error_msg_flash_pub_date}>
+                                    <{elseif $error_list.error_no == 17}>
+                                        <{$lang.repository_import_error_msg_item_type}>
+                                    <{elseif $error_list.error_no == 18}>
+                                        <{$lang.repository_import_error_msg_edit_item_url}>
+                                    <{elseif $error_list.error_no == 19}>
+                                        <{$lang.repository_import_error_msg_edit_item_num}>
+                                    <{elseif $error_list.error_no == 20}>
+                                        <{$lang.repository_import_error_msg_can_not_use_item_type}>
+                                    <{/if}>
+                                </td>
+                                <td>
+                                    <{$error_list.attr_name}>
+                                </td>
+                                <td>
+                                    <{$error_list.input_value}>
+                                </td>
+                                <td>
+                                    <{$error_list.regist_value}>
+                                </td>
+                            </tr>
+                        <{/foreach}>
+                    </table>
+                </div>
+            <{/if}>
+            <{* show error massage list 2014/11/04 T.Koyasu --end-- *}>
+			<div id="repo_side_navi" class="fl">
+				<{* make index tree 2008/12/03 Y.Nakao --start-- *}>
+				<div>
+					<h3 class="th_repos_title_bar nc_block_title c">
+						<span class="pl05">
+							<{$lang.repository_index_tree}>
+						</span>
+					</h3>
+					<div class="th_classic_content content" id="repository_import_tree" align="left" style="width: <{$smarty.const._SNIPPET_WIDTH}>px; overflow:auto;"></div>
+					<{include file="repository_item_search_tree.html"}>
+					<{* make index tree 2008/12/03 Y.Nakao --end-- *}>
+				</div>
+			</div>
+			<div class="repository_right_header plr20" style="position: relative; top: 70px">
+                <table class="tb01 full" style="position: relative; right:10px">
+					<tr>
+						<th class="item_edit_list"><{$lang.repository_import_select_item}></th>
+						<td class="item_edit_list al">
+							<div class="nobr"><input type="file" name="upload[]" size="30"/></div><!-- old w15em -->
+						</td>
+					</tr>
+					<tr>
+						<th class="item_edit_list"><{$lang.repository_import_index}></th>
+						<td class="item_edit_list al">
+							<{$lang.repository_import_select_index}><br />
+								<{* Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/26 --start-- *}>
+								<{strip}>
+								<label class="pl10" id="selected_index">
+									<{foreach from=$action.selectedIndexName item=indexName name=loopIndexName}>
+										<{assign var="loopIndexName" value=$smarty.foreach.loopIndexName.iteration-1}>
+										<{if $loopIndexName>0}><br><{/if}><{$indexName}>
+									<{/foreach}>
+								</label>
+								<{/strip}>
+								<br/>
+								<input type="hidden" id="check_insert_idx" value="<{$action.selectedIndexIds}>" readonly />
+								<{* Add specialized support for open.repo "auto affiliation in private tree" Y.Nakao 2013/06/26 --end-- *}>
+						</td>
+					</tr>
+				</table>
+
+				<center class="pt20">
+					<{* import button 2012/1/26 --start-- A.jin --start-- *}>
+					<input type="button" class="btn_blue ac" value="<{$lang.repository_import}>" onclick="repositoryCls['<{$id}>'].repositoryImportFileUpload();return false;" />
+				</center>
+				<{* import button 2012/1/26 --start-- A.jin --end-- *}>
+			</div>
+		</div>
+
+		<{* タブ2：WEKO著者名典拠 tab2:author *}>
+		<div class="th_classic_content content text_color" id="import_tab_2" align="center" style="height: 360px;">
+			<div align="right" class="pt10 pr10">
+				<span id="repositoryExportTemplate<{$id}>">
+					<a href="#" onclick="javascript: templateDownload(); return false;" ><{$lang.repository_importauthority_result_template}></a>
+				</span>
+				<span id="repository<{$id}>_exportBtn" style="position: relative; right: 110px " >
+					<img border="0" id="repositoryNowLoading<{$id}>" style="display:none" src="<{$smarty.const.BASE_URL}>/images/common/indicator.gif" />
+				</span>
+			</div>
+			<table class="tb01 w70" style="position: relative; top: 70px">
+				<tr>
+					<th class="item_edit_list"><{$lang.repository_import_select_item}></th>
+					<td class="item_edit_list al">
+						<div class="nobr"><input type="file" name="upload[]" size="30"/></div><!-- old w15em -->
+					</td>
+				</tr>
+			</table>
+			<center class="pt20" style="position: relative; top: 70px">
+				<input type="button" class="btn_blue ac" value="<{$lang.repository_import}>" onclick="repositoryCls['<{$id}>'].repositoryImportauthorityFileUpload();return false;" />
+			</center>
+		</div>
+	</div>
+</div>
+</form>
+<span style="display:none;height=0px;width=0px;" id="repositoryListDownload<{$id}>"></span>
+<{/strip}>
+<{* 2008/05/20 S.Kawasaki nc_script文字数制限の暫定対応でツリー生成-描画コードを分割して記述するように修正*}>
+<{* make index tree 2008/12/03 Y.Nakao --start-- *}>
+<script class="nc_script" type="text/javascript">
+    repositoryInitTree<{$id}>('repository_import_tree','<{$id}>', 'check');
+	$('repository_import_tree').style.height = <{$smarty.const._SNIPPET_HEIGHT}>+"px";
+	$('repository_import_tree').style.width = <{$smarty.const._SNIPPET_WIDTH}>+"px";
+</script>
+<script class="nc_script" type="text/javascript">
+    repositoryClickTreeCheck<{$id}> = function(id, idx_name){
+		if( $('selected_index') != null ) {
+			var elm_name = 'tree_check' + id;
+			if($(elm_name).checked){
+				// check true
+				if($('selected_index').innerHTML != ""){
+					//IE判定
+					var userAgent = window.navigator.userAgent.toLowerCase();
+					var appVersion = window.navigator.appVersion.toLowerCase();
+					if((userAgent.indexOf("msie") > -1) && (appVersion.indexOf("msie 8.") != -1)){
+						$('selected_index').innerHTML += '<BR>' + idx_name;
+					}
+					else{
+						$('selected_index').innerHTML += '<br>' + idx_name;
+					}
+					$('check_insert_idx').value += '|' + id;
+				} else {
+					$('selected_index').innerHTML = idx_name;
+					$('check_insert_idx').value = id;
+				}
+			} else {
+				// check false
+				// view index name
+				//IE判定
+				var userAgent = window.navigator.userAgent.toLowerCase();
+				var appVersion = window.navigator.appVersion.toLowerCase();
+
+				var str = '';
+				if((userAgent.indexOf("msie") > -1)&&(appVersion.indexOf("msie 8.") != -1)){
+					//IE8か
+					str = "<BR>"+$('selected_index').innerHTML+"<BR>";
+					var tempStr = "<BR>"+idx_name+"<BR>";
+					str = str.replace(tempStr, "<BR>");
+					str = str.substr(4,str.length-8);
+				}
+				else{
+					str = "<br>"+$('selected_index').innerHTML+"<br>";
+					var tempStr = "<br>"+idx_name+"<br>";
+					str = str.replace(tempStr, "<br>");
+					str = str.substr(4,str.length-8);
+				}
+
+				$('selected_index').innerHTML = str;
+				// hidden index id
+				str = "|"+$('check_insert_idx').value+"|";
+				str = str.replace("|"+id+"|", "|");
+				str = str.substr(1,str.length-2);
+				$('check_insert_idx').value = str;
+			}
+		}
+	}
+</script>
+<{* make index tree 2008/12/03 Y.Nakao --end-- *}>
+
+<{* import name_authority 2013/11/25 R.Matsuura --start-- *}>
+<{* display tab number *}>
+<input type="hidden" id="import_active_tab_id" name="import_active_tab" value="0" />
+<script class="nc_script" type="text/javascript">
+	changeActiveTab1 = function(){
+		$('import_active_tab_id').value = 0;
+	}
+	changeActiveTab2 = function(){
+		$('import_active_tab_id').value = 1;
+	}
+
+</script>
+
+<script class="nc_script" type="text/javascript">
+	var tabset = new compTabset('<{$id}>');
+	tabset.setActiveIndex( valueParseInt('0') );
+	tabset.addTabset('<{$lang.repository_import_tab_contents}>', changeActiveTab1);
+	tabset.addTabset('<{$lang.repository_import_tab_authority}>', changeActiveTab2);
+	tabset.render();
+</script>
+<script class="nc_script" type="text/javascript">
+	templateDownload = function() {
+		var url = _nc_base_url + "/index.php"+
+					"?action=repository_action_edit_importauthority_download" + "&page_is=" + <{$page_id}> + "&block_id=" + <{$block_id}>;
+
+		// brauzaCheck
+		var userAgent = window.navigator.userAgent.toLowerCase();
+		var appVersion = window.navigator.appVersion.toLowerCase();
+		//IE
+		if (userAgent.indexOf("msie") > -1 || userAgent.indexOf("trident") > -1) {
+			loadingIcon(true);
+			$('repositoryListDownload<{$id}>').innerHTML = '<iframe boder="0" name="exportFrame<{$id}>" id="exportFrame<{$id}>" src="'+url+'"></iframe>';
+		}
+		//Firefox…OK
+		else if (userAgent.indexOf("firefox") > -1) {
+			loadingIcon(true);
+			$('repositoryListDownload<{$id}>').innerHTML = '<iframe boder="0" name="exportFrame<{$id}>" id="exportFrame<{$id}>" src="'+url+'" onload="javascript: loadingIcon(false);"></iframe>';
+		}
+		else
+		{
+			$('repositoryListDownload<{$id}>').innerHTML = '<iframe boder="0" name="exportFrame<{$id}>" id="exportFrame<{$id}>" src="'+url+'"></iframe>';
+		}
+		return false;
+	}
+</script>
+<script class="nc_script" type="text/javascript">
+	loadingIcon = function(onFlg) {
+		if(onFlg)
+		{
+			$('repositoryExportTemplate<{$id}>').style.display='none';
+			$('repositoryNowLoading<{$id}>').style.display='';
+		}
+		else
+		{
+			$('repositoryExportTemplate<{$id}>').style.display='';
+			$('repositoryNowLoading<{$id}>').style.display='none';
+		}
+	}
+</script>
+<{* import name_authority 2013/11/25 R.Matsuura --end-- *}>
+<{include file="repository_script.html"}>
+
diff --git a/repository/templates/default/repository_item_confirm.html b/repository/templates/default/repository_item_confirm.html
index 318ab59..e30566a 100644
--- a/repository/templates/default/repository_item_confirm.html
+++ b/repository/templates/default/repository_item_confirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_confirm.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: repository_item_confirm.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -28,59 +28,97 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_5.png" alt="" />
-						<{elseif $smarty.session.attr_file_flg == 1}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_5.png" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_4.png" />
-						<{/if}>
-					<{else}>
-						<{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_5_eng.png" alt="" />
-						<{elseif $smarty.session.attr_file_flg == 1}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_5_eng.png" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_4_eng.png" />
-						<{/if}>
-					<{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_6.png" />
+                        <{elseif $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_5.png" />
+                        <{elseif $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_JPN" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_5.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_4.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_6_eng.png" />
+                        <{elseif $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_5_eng.png" />
+                        <{elseif $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_ENG" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_5_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_4_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">*}>
+                    </map>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">*}>
+                    </map>
+                    <map name="flowImgMap<{$id}>_no">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,561,37,561,0">*}>
+                    </map>
+                    <map name="flowImgMap<{$id}>_no_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">*}>
+                    </map>
 				</td>
 			</tr>
 		</table>
 	</div>
 
 <div align="center" class="text_color">
-<form>
  <div class="paging">
   <div class="mt10 mb05 " align=center>
-   <form onsubmit="return false;">
     <{if $smarty.session.edit_jalc_flag == "true"}>
      <input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editdoi'); return false;">
     <{else}>
      <input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editlinks'); return false;">
     <{/if}>
-    <input type="button" class="btn_next" value="<{$lang.repository_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemAdddb(); return false;">
-   </form>
+    <input type="button" class="btn_next" value="<{$lang.repository_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('next'); return false;">
   </div>
   <div class="paging">
   <b><{$lang.repository_itemtype}>: <{$smarty.session.item_type_all.item_type_name}></b>
   </div>
-
-	<{if $action.error_msg != null || $action.warning != ""}>
-		<{if count($action.error_msg) > 0}>
-		<div class="error_msg al">
-				<{section name=i loop=$action.error_msg}>
-					<{$action.error_msg[i]}><br />
-				<{/section}>
-			</div>
-		<{/if}>
-		<{if strlen($action.warning) > 0}>
-			<div class="warning_msg al">
-				<{$action.warning}>
-			</div>
-		<{/if}>
-	<{/if}>
+    <center>
+        <{if $action.errMsg != null && count($action.errMsg) > 0}>
+        <div class="error_msg al">
+            <{foreach from=$action.errMsg item=msg}>
+            <{$msg|smarty:nodefaults}><br/>
+            <{/foreach}>
+        </div>
+        <{/if}>
+        <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+        <div class="warning_msg al">
+            <{foreach from=$action.warningMsg item=msg}>
+            <{$msg|smarty:nodefaults}><br/>
+            <{/foreach}>
+        </div>
+        <{/if}>
+    </center>
 
   
   <div class="w80 item_edit_texts_frame">
@@ -503,18 +541,15 @@
  
  </div>
  
- </form>
 </div>
 
 <div align=center>
- <form onsubmit="return false;">
    <{if $smarty.session.edit_jalc_flag == "true"}>
     <input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editdoi'); return false;">
    <{else}>
     <input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editlinks'); return false;">
    <{/if}>
-  <input type="button" class="btn_next" value="<{$lang.repository_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemAdddb(); return false;">
- </form>
+  <input type="button" class="btn_next" value="<{$lang.repository_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('next'); return false;">
 </div>
 
 </div>
diff --git a/repository/templates/default/repository_item_contents.html b/repository/templates/default/repository_item_contents.html
index e79a767..aad885d 100644
--- a/repository/templates/default/repository_item_contents.html
+++ b/repository/templates/default/repository_item_contents.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_contents.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_item_contents.html 47574 2015-02-02 07:33:54Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -243,8 +243,9 @@
 												<{if $k > 0}>
 													, 
 												<{/if}>
-												<a href="" id="searchAuthorContents<{$id}>_<{$i}>_<{$j}>_<{$k}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorContents<{$id}>_<{$i}>_<{$j}>_<{$k}>' ); return false; " >
-													<{$attr[k].family}>&nbsp;<{$attr[k].name}>
+												<a href="<{$attr[k].url}>" >
+													<{*目次形式の著者名から検索できない不具合修正 2015/01/21 K.Sugimoto --start--*}>
+													<{$attr[k].family}> <{$attr[k].name}>
 												</a>
 											<{/section}>
 											<br/>
@@ -256,8 +257,9 @@
 												<{if $k > 0}>
 													, 
 												<{/if}>
-												<a href="" id="searchAuthorContentsAnother<{$id}>_<{$i}>_<{$j}>_<{$k}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorContentsAnother<{$id}>_<{$i}>_<{$j}>_<{$k}>' ); return false; " >
-													<{$attr[k].family}>&nbsp;<{$attr[k].name}>
+												<a href="<{$attr[k].url}>" >
+													<{$attr[k].family}> <{$attr[k].name}>
+													<{*目次形式の著者名から検索できない不具合修正 2015/01/21 K.Sugimoto --end--*}>
 												</a>
 											<{/section}>
 											<br/>
diff --git a/repository/templates/default/repository_item_customsort.html b/repository/templates/default/repository_item_customsort.html
index 62e6683..d433c07 100644
--- a/repository/templates/default/repository_item_customsort.html
+++ b/repository/templates/default/repository_item_customsort.html
@@ -106,7 +106,7 @@
 	}
 	else
 	{
-		elm.style.height = "450px";
+		elm.style.height = "480px";
 	}
 </script>
 
diff --git a/repository/templates/default/repository_item_detail.html b/repository/templates/default/repository_item_detail.html
index 0b5fb79..7e660ec 100644
--- a/repository/templates/default/repository_item_detail.html
+++ b/repository/templates/default/repository_item_detail.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_detail.html 645 2014-10-29 12:39:52Z ivis $          -->
+<!--// $Id: repository_item_detail.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -190,15 +190,23 @@
 						<{$smarty.session.item_info.item[0].title}>
 					<{/if}>
 				<{/if}>
-                <{* Add display usagestaticstics link A.Suzuki --start-- *}>
-                <{if $smarty.session.workflow_flg=="false" && $action.isDispUsageLink == true}>
-                    <span class="full ar info fr pt00">
-                        <a href="#" onclick="commonCls.sendPopupView(event, {'prefix_id_name':'popup_repository_'+0,'action':'repository_view_common_usagestatistics', 'itemId':<{$action.item_id}>, 'itemNo':<{$action.item_no}>}, {'top_el':$(this.id), 'target_el':$(this.id), 'center_flag':true}); return false;">
-                            <{$lang.repository_detail_show_usagestatistics}>
-                        </a>
-                    </span>
-                <{/if}>
-                <{* Add display usagestaticstics link A.Suzuki --end-- *}>
+				<{* Add display usagestaticstics link A.Suzuki --start-- *}>
+				<{if $smarty.session.workflow_flg=="false"}>
+					<{if $action.usagestatistics_link_display == "1" }>
+						<{if $action.isDispUsageLink == true}>
+							<span class="full ar info fr pt00">
+								<a href="#" onclick="commonCls.sendPopupView(event, {'prefix_id_name':'popup_repository_'+0,'action':'repository_view_common_usagestatistics', 'itemId':<{$action.item_id}>, 'itemNo':<{$action.item_no}>}, {'top_el':$(this.id), 'target_el':$(this.id), 'center_flag':true}); return false;">
+									<{$lang.repository_detail_show_usagestatistics}>
+								</a>
+							</span>
+						<{else}>
+							<span class="full ar info fr pt00">
+								<{$lang.repository_detail_usage_statistics_next_month}>
+							</span>
+						<{/if}>
+					<{/if}>
+				<{/if}>
+				<{* Add display usagestaticstics link A.Suzuki --end-- *}>
 			</h2>
 		</div><!-- // title -->
 		
@@ -272,7 +280,19 @@
 													<a href="<{$item_attr[i][j].text_url}>" target="_blank"><img class="ar" src="<{$item_attr[i][j].img_url}>" /></a><br />
 												<{/if}>
 												<{section name=k loop=$item_attr[i][j].license_notation_array}>
-													<{$item_attr[i][j].license_notation_array[k]}>
+													<{if $item_attr[i][j].license_id == 101}>
+														<{$lang.repository_item_file_license_notation_by}>
+													<{elseif $item_attr[i][j].license_id == 102}>
+														<{$lang.repository_item_file_license_notation_by_sa}>
+													<{elseif $item_attr[i][j].license_id == 103}>
+														<{$lang.repository_item_file_license_notation_by_nd}>
+													<{elseif $item_attr[i][j].license_id == 104}>
+														<{$lang.repository_item_file_license_notation_by_nc}>
+													<{elseif $item_attr[i][j].license_id == 105}>
+														<{$lang.repository_item_file_license_notation_by_nc_sa}>
+													<{elseif $item_attr[i][j].license_id == 106}>
+														<{$lang.repository_item_file_license_notation_by_nc_nd}>
+													<{/if}>
 													<{if count($item_attr[i][j].license_notation_array)!=0}>
 														<br />
 													<{/if}>
@@ -344,36 +364,69 @@
 											<tr class="tr_detail_line_repos">
 												<td class="td_detail_line_repos" colspan="2">
 													<div style="<{if $attr_type[i].hidden == '1'}>color: #808080;<{/if}>">
-														<{if $item_attr[i][j].price_accent == "free"}>
-															<b><{$lang.repository_item_embargo_candidate1}></b>
-														<{elseif $item_attr[i][j].price_accent == "license"}>
-															<b><{$lang.repository_log_is_sitelicense|replace:"UNIT":$smarty.session.money_unit|replace:"&amp;":"&"}></b>
+													    <{if $attr_type[i].input_type == 'file_price'}>
+													        <{* 課金ファイル *}>
+														    <{if $item_attr[i][j].price_accent == "free"}>
+														    	<b><{$lang.repository_item_embargo_candidate1}></b>
+														    <{elseif $item_attr[i][j].price_accent == "license"}>
+														    	<b><{$lang.repository_log_is_sitelicense|replace:"UNIT":$smarty.session.money_unit|replace:"&amp;":"&"}></b>
+														    <{else}>
+														    	<{section name=k loop=$item_attr[i][j].group_price}>
+														    		<{assign var="group_price" value=$item_attr[i][j].group_price}>
+														    		<span class="nobr">
+														    			<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+														    				<font style="margin-right: 7px; background-color: #ADD8E6;">
+														    				<b>
+														    			<{/if}>
+														    				<{if $group_price[k].name == "0"}>
+														    					<{$lang.repository_item_gest}>
+														    				<{else}>
+														    					<{$group_price[k].name}>
+														    				<{/if}>
+														    				:&nbsp;<{$smarty.session.money_unit|smarty:nodefaults}><{$group_price[k].price}>-
+														    				<{if $item_attr[i][j].price_accent[k] == "already"}>
+														    					[<{$lang.repository_workflow_already_paid}>]
+														    				<{/if}>
+														    			<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+														    				</b>
+														    				</font>
+														    			<{/if}>
+														    		</span>
+														    		<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
+														    			, 
+														    		<{/if}>
+														    	<{/section}>
+														    <{/if}>
 														<{else}>
-															<{section name=k loop=$item_attr[i][j].group_price}>
-																<{assign var="group_price" value=$item_attr[i][j].group_price}>
-																<span class="nobr">
-																	<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
-																		<font style="margin-right: 7px; background-color: #ADD8E6;">
-																		<b>
-																	<{/if}>
-																		<{if $group_price[k].name == "0"}>
-																			<{$lang.repository_item_gest}>
-																		<{else}>
-																			<{$group_price[k].name}>
-																		<{/if}>
-																		:&nbsp;<{$smarty.session.money_unit|smarty:nodefaults}><{$group_price[k].price}>-
-																		<{if $item_attr[i][j].price_accent[k] == "already"}>
-																			[<{$lang.repository_workflow_already_paid}>]
-																		<{/if}>
-																	<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
-																		</b>
-																		</font>
-																	<{/if}>
-																</span>
-																<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
-																	, 
-																<{/if}>
-															<{/section}>
+															<{* ファイル *}>
+														    <{if $item_attr[i][j].price_accent == "free"}>
+														    	<b><{$lang.repository_item_embargo_candidate1}></b>
+														    <{elseif $item_attr[i][j].price_accent == "license"}>
+														    	<b><{$lang.repository_log_sitelicense_member}></b>
+														    <{else}>
+															    <{$lang.repository_detail_file_authority_group}>
+															    <{section name=k loop=$item_attr[i][j].group_price}>
+															    	<{assign var="group_price" value=$item_attr[i][j].group_price}>
+															    	<span class="nobr">
+															    		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+															    			<font style="margin-right: 7px; background-color: #ADD8E6;">
+															    			<b>
+															    		<{/if}>
+															    			<{if $group_price[k].name == "0"}>
+															    				<{$lang.repository_item_gest}>
+															    			<{else}>
+															    				<{$group_price[k].name}>
+															    			<{/if}>
+															    		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+															    			</b>
+															    			</font>
+															    		<{/if}>
+															    	</span>
+															    	<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
+															    		, 
+															    	<{/if}>
+															    <{/section}>
+															<{/if}>
 														<{/if}>
 													</div>
 												</td>
@@ -458,7 +511,19 @@
 														<a href="<{$item_attr[i][j].text_url}>" target="_blank"><img class="ar" src="<{$item_attr[i][j].img_url}>" /></a><br />
 													<{/if}>
 													<{section name=k loop=$item_attr[i][j].license_notation_array}>
-														<{$item_attr[i][j].license_notation_array[k]}>
+														<{if $item_attr[i][j].license_id == 101}>
+															<{$lang.repository_item_file_license_notation_by}>
+														<{elseif $item_attr[i][j].license_id == 102}>
+															<{$lang.repository_item_file_license_notation_by_sa}>
+														<{elseif $item_attr[i][j].license_id == 103}>
+															<{$lang.repository_item_file_license_notation_by_nd}>
+														<{elseif $item_attr[i][j].license_id == 104}>
+															<{$lang.repository_item_file_license_notation_by_nc}>
+														<{elseif $item_attr[i][j].license_id == 105}>
+															<{$lang.repository_item_file_license_notation_by_nc_sa}>
+														<{elseif $item_attr[i][j].license_id == 106}>
+															<{$lang.repository_item_file_license_notation_by_nc_nd}>
+														<{/if}>
 														<{if count($item_attr[i][j].license_notation_array)!=0}>
 															<br />
 														<{/if}>
@@ -538,36 +603,70 @@
 												<tr class="tr_detail_line_repos" style="<{if $action.flash_image_num[i] != 1}>display:none;<{/if}>">
 													<td class="td_detail_line_repos" colspan="2">
 														<div style="<{if $attr_type[i].hidden == '1'}>color: #808080;<{/if}>">
-															<{if $item_attr[i][j].price_accent == "free"}>
-																<b><{$lang.repository_item_embargo_candidate1}></b>
-															<{elseif $item_attr[i][j].price_accent == "license"}>
-																<b><{$lang.repository_log_is_sitelicense|replace:"UNIT":$smarty.session.money_unit|replace:"&amp;":"&"}></b>
-															<{else}>
-																<{section name=k loop=$item_attr[i][j].group_price}>
-																	<{assign var="group_price" value=$item_attr[i][j].group_price}>
-																	<span class="nobr">
-																		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
-																			<font style="margin-right: 7px; background-color: #ADD8E6;">
-																			<b>
-																		<{/if}>
-																			<{if $group_price[k].name == "0"}>
-																				<{$lang.repository_item_gest}>
-																			<{else}>
-																				<{$group_price[k].name}>
-																			<{/if}>
-																			:&nbsp;<{$smarty.session.money_unit|smarty:nodefaults}><{$group_price[k].price}>-
-																			<{if $item_attr[i][j].price_accent[k] == "already"}>
-																				[<{$lang.repository_workflow_already_paid}>]
-																			<{/if}>
-																		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
-																			</b>
-																			</font>
-																		<{/if}>
-																	</span>
-																	<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
-																		, 
-																	<{/if}>
-																<{/section}>
+														    <{if $attr_type[i].input_type == 'file_price'}>
+														    
+															    <{if $item_attr[i][j].price_accent == "free"}>
+															    	<b><{$lang.repository_item_embargo_candidate1}></b>
+															    <{elseif $item_attr[i][j].price_accent == "license"}>
+															    	<b><{$lang.repository_log_is_sitelicense|replace:"UNIT":$smarty.session.money_unit|replace:"&amp;":"&"}></b>
+															    <{else}>
+															        <{* 課金ファイル *}>
+															    	<{section name=k loop=$item_attr[i][j].group_price}>
+															    		<{assign var="group_price" value=$item_attr[i][j].group_price}>
+															    		<span class="nobr">
+															    			<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+															    				<font style="margin-right: 7px; background-color: #ADD8E6;">
+															    				<b>
+															    			<{/if}>
+															    				<{if $group_price[k].name == "0"}>
+															    					<{$lang.repository_item_gest}>
+															    				<{else}>
+															    					<{$group_price[k].name}>
+															    				<{/if}>
+															    				:&nbsp;<{$smarty.session.money_unit|smarty:nodefaults}><{$group_price[k].price}>-
+															    				<{if $item_attr[i][j].price_accent[k] == "already"}>
+															    					[<{$lang.repository_workflow_already_paid}>]
+															    				<{/if}>
+															    			<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+															    				</b>
+															    				</font>
+															    			<{/if}>
+															    		</span>
+															    		<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
+															    			, 
+															    		<{/if}>
+															    	<{/section}>
+														        <{/if}>
+														    <{else}>
+														        <{if $item_attr[i][j].price_accent == "free"}>
+														        	<b><{$lang.repository_item_embargo_candidate1}></b>
+														        <{elseif $item_attr[i][j].price_accent == "license"}>
+														        	<b><{$lang.repository_log_sitelicense_member}></b>
+														        <{else}>
+														    	    <{* ファイル *}>
+														    	    <{$lang.repository_detail_file_authority_group}>
+														    		<{section name=k loop=$item_attr[i][j].group_price}>
+														    			<{assign var="group_price" value=$item_attr[i][j].group_price}>
+														    			<span class="nobr">
+														    				<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+														    					<font style="margin-right: 7px; background-color: #ADD8E6;">
+														    					<b>
+														    				<{/if}>
+														    					<{if $group_price[k].name == "0"}>
+														    						<{$lang.repository_item_gest}>
+														    					<{else}>
+														    						<{$group_price[k].name}>
+														    					<{/if}>
+														    				<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+														    					</b>
+														    					</font>
+														    				<{/if}>
+														    			</span>
+														    			<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
+														    				, 
+														    			<{/if}>
+														    		<{/section}>
+														    	<{/if}>
 															<{/if}>
 														</div>
 													</td>
@@ -596,12 +695,26 @@
 															</div>
 																" 
 														data-description="
-															<{section name=k loop=$item_attr[i][j].license_notation_array}>
-																<{$item_attr[i][j].license_notation_array[k]}>
-																<{if count($item_attr[i][j].license_notation_array)>1}>
-																	,&nbsp
-																<{/if}>
-															<{/section}>
+															<{if $item_attr[i][j].license_id == 101}>
+																<{$lang.repository_item_file_license_notation_by}>
+															<{elseif $item_attr[i][j].license_id == 102}>
+																<{$lang.repository_item_file_license_notation_by_sa}>
+															<{elseif $item_attr[i][j].license_id == 103}>
+																<{$lang.repository_item_file_license_notation_by_nd}>
+															<{elseif $item_attr[i][j].license_id == 104}>
+																<{$lang.repository_item_file_license_notation_by_nc}>
+															<{elseif $item_attr[i][j].license_id == 105}>
+																<{$lang.repository_item_file_license_notation_by_nc_sa}>
+															<{elseif $item_attr[i][j].license_id == 106}>
+																<{$lang.repository_item_file_license_notation_by_nc_nd}>
+															<{else}>
+																<{section name=k loop=$item_attr[i][j].license_notation_array}>
+																	<{$item_attr[i][j].license_notation_array[k]}>
+																	<{if count($item_attr[i][j].license_notation_array)>1}>
+																		,&nbsp
+																	<{/if}>
+																<{/section}>
+															<{/if}>
 															" 
 												 		/>
 												<{/if}>
@@ -664,7 +777,19 @@
 													<br />
 												<{/if}>
 												<{section name=k loop=$item_attr[i][j].license_notation_array}>
-													<{$item_attr[i][j].license_notation_array[k]}>
+													<{if $item_attr[i][j].license_id == 101}>
+														<{$lang.repository_item_file_license_notation_by}>
+													<{elseif $item_attr[i][j].license_id == 102}>
+														<{$lang.repository_item_file_license_notation_by_sa}>
+													<{elseif $item_attr[i][j].license_id == 103}>
+														<{$lang.repository_item_file_license_notation_by_nd}>
+													<{elseif $item_attr[i][j].license_id == 104}>
+														<{$lang.repository_item_file_license_notation_by_nc}>
+													<{elseif $item_attr[i][j].license_id == 105}>
+														<{$lang.repository_item_file_license_notation_by_nc_sa}>
+													<{elseif $item_attr[i][j].license_id == 106}>
+														<{$lang.repository_item_file_license_notation_by_nc_nd}>
+													<{/if}>
 													<{if count($item_attr[i][j].license_notation_array)!=0}>
 														<br />
 													<{/if}>
@@ -762,36 +887,69 @@
 											<tr class="tr_detail_line_repos">
 												<td class="td_detail_line_repos" colspan="2">
 													<div style="<{if $attr_type[i].hidden == '1'}>color: #808080;<{/if}>">
-														<{if $item_attr[i][j].price_accent == "free"}>
-															<b><{$lang.repository_item_embargo_candidate1}></b>
-														<{elseif $item_attr[i][j].price_accent == "license"}>
-															<b><{$lang.repository_log_is_sitelicense|replace:"UNIT":$smarty.session.money_unit|replace:"&amp;":"&"}></b>
-														<{else}>
-															<{section name=k loop=$item_attr[i][j].group_price}>
-																<{assign var="group_price" value=$item_attr[i][j].group_price}>
-																<span class="nobr">
-																	<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
-																		<font style="margin-right: 7px; background-color: #ADD8E6;">
-																		<b>
+														<{if $attr_type[i].input_type == 'file_price'}>
+															<{if $item_attr[i][j].price_accent == "free"}>
+																<b><{$lang.repository_item_embargo_candidate1}></b>
+															<{elseif $item_attr[i][j].price_accent == "license"}>
+																<b><{$lang.repository_log_is_sitelicense|replace:"UNIT":$smarty.session.money_unit|replace:"&amp;":"&"}></b>
+															<{else}>
+																<{* 課金ファイル *}>
+																<{section name=k loop=$item_attr[i][j].group_price}>
+																	<{assign var="group_price" value=$item_attr[i][j].group_price}>
+																	<span class="nobr">
+																		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+																			<font style="margin-right: 7px; background-color: #ADD8E6;">
+																			<b>
+																		<{/if}>
+																			<{if $group_price[k].name == "0"}>
+																				<{$lang.repository_item_gest}>
+																			<{else}>
+																				<{$group_price[k].name}>
+																			<{/if}>
+																			:&nbsp;<{$smarty.session.money_unit|smarty:nodefaults}><{$group_price[k].price}>-
+																			<{if $item_attr[i][j].price_accent[k] == "already"}>
+																				[<{$lang.repository_workflow_already_paid}>]
+																			<{/if}>
+																		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+																			</b>
+																			</font>
+																		<{/if}>
+																	</span>
+																	<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
+																		, 
 																	<{/if}>
-																		<{if $group_price[k].name == "0"}>
-																			<{$lang.repository_item_gest}>
-																		<{else}>
-																			<{$group_price[k].name}>
+																<{/section}>
+														    <{/if}>
+														<{else}>
+														    <{if $item_attr[i][j].price_accent == "free"}>
+														    	<b><{$lang.repository_item_embargo_candidate1}></b>
+														    <{elseif $item_attr[i][j].price_accent == "license"}>
+														    	<b><{$lang.repository_log_sitelicense_member}></b>
+														    <{else}>
+															    <{* ファイル *}>
+															    <{$lang.repository_detail_file_authority_group}>
+																<{section name=k loop=$item_attr[i][j].group_price}>
+																	<{assign var="group_price" value=$item_attr[i][j].group_price}>
+																	<span class="nobr">
+																		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+																			<font style="margin-right: 7px; background-color: #ADD8E6;">
+																			<b>
 																		<{/if}>
-																		:&nbsp;<{$smarty.session.money_unit|smarty:nodefaults}><{$group_price[k].price}>-
-																		<{if $item_attr[i][j].price_accent[k] == "already"}>
-																			[<{$lang.repository_workflow_already_paid}>]
+																			<{if $group_price[k].name == "0"}>
+																				<{$lang.repository_item_gest}>
+																			<{else}>
+																				<{$group_price[k].name}>
+																			<{/if}>
+																		<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
+																			</b>
+																			</font>
 																		<{/if}>
-																	<{if $item_attr[i][j].price_accent[k] == "true" || $item_attr[i][j].price_accent[k] == "already"}>
-																		</b>
-																		</font>
+																	</span>
+																	<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
+																		, 
 																	<{/if}>
-																</span>
-																<{if $smarty.section.k.index!=count($item_attr[i][j].group_price)-1}>
-																	, 
-																<{/if}>
-															<{/section}>
+																<{/section}>
+															<{/if}>
 														<{/if}>
 													</div>
 												</td>
@@ -840,7 +998,7 @@
 											<td class="w16px pd10" align="center">
 												<{* アイコン *}>
 												<{if $item_attr[i][j].download_url != ""}>
-													<a href="<{$item_attr[i][j].download_url}>" title="<{$lang.repository_supple_download_contents}>">
+													<a href="<{$item_attr[i][j].download_url}>" title="<{$lang.repository_supple_download_contents}>" target="_blank">
 														<div class="ptb10">
 															<{* Modify Directory specification BASE_URL K.Matsuo 2011/9/5 --start-- *}>
 															<{if $item_attr[i][j].mime_type == "1"}>
@@ -879,7 +1037,7 @@
 												<{$item_attr[i][j].supple_item_type_name}><br/>
 												
 												<{* タイトル *}>
-												<a href="<{$item_attr[i][j].uri}>">
+												<a href="<{$item_attr[i][j].uri}>" target="_blank">
 													<{if $smarty.session._lang=="japanese"}>
 														<{if $item_attr[i][j].supple_title != ""}>
 															<{$item_attr[i][j].supple_title}>
@@ -940,7 +1098,7 @@
 					<{if strlen($action.self_doi_uri) > 0}>
 						<tr>
 							<th class="th_detail_line_repos vt al w20 ws">
-								<{$lang.repository_detail_self_doi}>
+								<{$action.doi_type}>
 							</th>
 							<td>
 								<{$action.self_doi_uri}>
@@ -1103,19 +1261,21 @@
 													<{assign var=j value=$smarty.section.j.index}>
 													<{if $attr_type[i].display_lang_type|lower == "english"}>
 														<{if $item_attr[i][j].name!="" && $item_attr[i][j].family!=""}>
-															<a href="" id="searchAuthorDetailEng<{$id}>_<{$j}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailEng<{$id}>_<{$j}>' ); return false; " ><{$item_attr[i][j].name}>&nbsp;<{$item_attr[i][j].family}></a>
+														    <{*詳細画面の著者名から検索できない不具合修正 2015/01/06 K.Sugimoto --start--*}>
+															<a href="<{$item_attr[i][j].url}>" ><{$item_attr[i][j].name}> <{$item_attr[i][j].family}></a>
 														<{elseif $item_attr[i][j].family!=""}>
-															<a href="" id="searchAuthorDetailEng<{$id}>_<{$j}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailEng<{$id}>_<{$j}>' ); return false; " ><{$item_attr[i][j].family}></a>
+															<a href="<{$item_attr[i][j].url}>" ><{$item_attr[i][j].family}></a>
 														<{else}>
-															<a href="" id="searchAuthorDetailEng<{$id}>_<{$j}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailEng<{$id}>_<{$j}>' ); return false; " ><{$item_attr[i][j].name}></a>
+															<a href="<{$item_attr[i][j].url}>" ><{$item_attr[i][j].name}></a>
 														<{/if}>
 													<{else}>
 														<{if $item_attr[i][j].name!="" && $item_attr[i][j].family!=""}>
-															<a href="" id="searchAuthorDetailOther<{$id}>_<{$j}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailOther<{$id}>_<{$j}>' ); return false;" ><{$item_attr[i][j].family}>&nbsp;<{$item_attr[i][j].name}></a>
+															<a href="<{$item_attr[i][j].url}>" ><{$item_attr[i][j].family}> <{$item_attr[i][j].name}></a>
+														    <{*詳細画面の著者名から検索できない不具合修正 2015/01/06 K.Sugimoto --end--*}>
 														<{elseif $item_attr[i][j].family!=""}>
-															<a href="" id="searchAuthorDetailOther<{$id}>_<{$j}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailOther<{$id}>_<{$j}>' ); return false;" ><{$item_attr[i][j].family}></a>
+															<a href="<{$item_attr[i][j].url}>" ><{$item_attr[i][j].family}></a>
 														<{else}>
-															<a href="" id="searchAuthorDetailOther<{$id}>_<{$j}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailOther<{$id}>_<{$j}>' ); return false;" ><{$item_attr[i][j].name}></a>
+															<a href="<{$item_attr[i][j].url}>" ><{$item_attr[i][j].name}></a>
 														<{/if}>
 														<{if $attr_type[i].display_lang_type=="japanese"}>
 															<{if $item_attr[i][j].family_ruby!="" || $item_attr[i][j].name_ruby!=""}>
@@ -1150,32 +1310,13 @@
 												<th class="th_detail_line_repos vt al w20 ws"><{$attr_type[i].attribute_name}></th>
 												<td class="td_detail_line_repos w80">
 													<{section name=j loop=$item_attr[i]}>
-<!--														<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
+														<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
 															<{if $item_attr[i][j].attribute_value[1] != ""}>
 																<{$item_attr[i][j].attribute_value[1]}>
 															<{else}>
 																<{$item_attr[i][j].attribute_value[0]}>
 															<{/if}>
 														</a><br>
--->
-<!-- using iframe/img tag 2012/09/20 by mhaya start -->
-<{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
-	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
-<{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
-<!-- 
-	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
--->
-	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px /><br/>
-<{else}>
-	<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
-	<{if $item_attr[i][j].attribute_value[1] != ""}>
-		<{$item_attr[i][j].attribute_value[1]}>
-	<{else}>
-		<{$item_attr[i][j].attribute_value[0]}>
-	<{/if}>
-        </a><br/>
-<{/if}>
-<!-- using iframe/img tag 2012/09/20 by mhaya end -->
 													<{/section}>
 												</td>
 											</tr>
@@ -1583,28 +1724,30 @@
 					</tr>
 					
 					<{*公開状況*}>
-					<tr class="tr_detail_line_repos">
-						<th class="th_detail_line_repos vt al w20 ws"><{$lang.repository_shown_status}></th>
-						<td class="td_detail_line_repos w80">
-							<{if $action.review_status == "-1"}>
-								<{$lang.repository_item_edit}>
-							<{elseif $action.review_status=="0" && $action.reject_status=="0"}>
-								<{$lang.repository_item_review}>
-							<{elseif $action.review_status=="0" && $action.reject_status=="1"}>
-								<{$lang.repository_item_reject}>
-							<{elseif $action.review_status == "1" && ($action.shown_status == "1" || $smarty.session.shown_status == "1")}>
-								<{if $smarty.session.IsSelectShow=="true" && $smarty.session.workflow_flg=="false"}>
-									<input type="button" class="btn_white" value="<{$lang.repository_private}>" onclick="repositoryCls['<{$id}>'].repositoryChangeShownStatus(); return false;">
-								<{/if}>
-								<{$lang.repository_public}>
-							<{else}>
-								<{$lang.repository_private}>
-								<{if $smarty.session.IsSelectShow=="true" && $smarty.session.workflow_flg=="false"}>
-									<input type="button" class="btn_white" value="<{$lang.repository_public}>" onclick="repositoryCls['<{$id}>'].repositoryChangeShownStatus(1); return false;">
+					<{if $action.user_id!="0"}>
+						<tr class="tr_detail_line_repos">
+							<th class="th_detail_line_repos vt al w20 ws"><{$lang.repository_shown_status}></th>
+							<td class="td_detail_line_repos w80">
+								<{if $action.review_status == "-1"}>
+									<{$lang.repository_item_edit}>
+								<{elseif $action.review_status=="0" && $action.reject_status=="0"}>
+									<{$lang.repository_item_review}>
+								<{elseif $action.review_status=="0" && $action.reject_status=="1"}>
+									<{$lang.repository_item_reject}>
+								<{elseif $action.review_status == "1" && ($action.shown_status == "1" || $smarty.session.shown_status == "1")}>
+									<font color="black"><{$lang.repository_public}></font>
+									<{if $smarty.session.IsSelectShow=="true" && $smarty.session.workflow_flg=="false"}>
+										<input type="button" style="color:#666" value="<{$lang.repository_private_change}>" onclick="repositoryCls['<{$id}>'].repositoryChangeShownStatus(); return false;">
+									<{/if}>
+								<{else}>
+									<font color="black"><{$lang.repository_private}></font>
+									<{if $smarty.session.IsSelectShow=="true" && $smarty.session.workflow_flg=="false"}>
+										<input type="button" style="color:#666" value="<{$lang.repository_public_change}>" onclick="repositoryCls['<{$id}>'].repositoryChangeShownStatus(1); return false;">
+									<{/if}>
 								<{/if}>
-							<{/if}>
-						</td>
-					</tr>
+							</td>
+						</tr>
+					<{/if}>
 					<{* external search keyword display 2014/05/22 T.Ichikawa --start-- *}>
 					<{if $action.searchWordDisplayFlg == 1 && count($action.externalSearchWord) != 0}>
 					<tr class="tr_detail_line_repos">
diff --git a/repository/templates/default/repository_item_doi.html b/repository/templates/default/repository_item_doi.html
index 0be1a92..299667b 100644
--- a/repository/templates/default/repository_item_doi.html
+++ b/repository/templates/default/repository_item_doi.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_doi.html 42605 2014-10-03 01:02:01Z keiya_sugimoto $          -->
+<!--// $Id: repository_item_doi.html 49321 2015-03-03 12:15:32Z keiya_sugimoto $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -12,6 +12,11 @@
 
 <{strip}>
 <div id="repository<{$id}>_jalcdoiDiv">
+	<{if strlen($action.doi_count_msg) > 0}>
+	    <div class = "info al">
+	        <{$action.doi_count_msg}>
+	    </div>
+	<{/if}>
 	<table class="full">	
 		<tr>
 			<th class="pd10 th01">
@@ -45,40 +50,80 @@
 				<th class="pd10 al th01"><{$lang.repository_item_enterdoi_target_item}></th>
 			</tr>
 			<tr>
+			    <td class="pd10">
+			    <center>
+	                <input type="button" class="btn_blue" value="<{$lang.repository_item_add_doi}>" onclick="repositoryCls['<{$id}>'].repositoryDoiSet(<{$action.sortIndexId}>); return false;" style="margin : 10px !important">
+	            </center>
+			    </td>
+			</tr>
+			<tr>
 				<td>
 					<div>
 						<form id="enter_doi_form">
 							<table id="repository_doi_item_list<{$id}>" class="full">
 								<tr>
-									<{if $action.exist_jalcdoi_prefix == true}>
-										<th style="border: 1px solid #E0E0E0;">
-											<{$lang.repository_item_edit_jalcdoi}>
+									<{if $action.exist_jalcdoi_prefix == true && $smarty.const._REPOSITORY_JALC_DOI == true}>
+										<th style="border: 1px solid #E0E0E0; padding-top : 5px; padding-bottom : 5px;">
+    										<label style="display: block; width:100%;height:100%;" for="registing_all_jalcdoi_checkbox">
+											    <center>
+											        <B><{$lang.repository_item_edit_jalcdoi}></B><br>
+											        <input type="checkbox" id="registing_all_jalcdoi_checkbox" name="registing_all_jalcdoi_items" onclick="javascript: checkAll('registing_all_jalcdoi_checkbox');">
+											    </center>
+											</label>
+										</th>
+									<{/if}>
+									<{if $action.exist_crossref_prefix == true && $smarty.const._REPOSITORY_JALC_CROSSREF_DOI == true}>
+										<th style="border: 1px solid #E0E0E0; padding-top : 5px; padding-bottom : 5px;">
+    										<label style="display: block; width:100%;height:100%;" for="registing_all_crossref_checkbox">
+    										    <center>
+											        &nbsp;&nbsp;&nbsp;<B><{$lang.repository_item_edit_crossref}></B>&nbsp;&nbsp;&nbsp;<br>
+											        <input type="checkbox" id="registing_all_crossref_checkbox" name="registing_all_crossref_items" onclick="javascript: checkAll('registing_all_crossref_checkbox');">
+											    </center>
+											</label>
 										</th>
 									<{/if}>
-									<{if $action.exist_crossref_prefix == true}>
-										<th style="border: 1px solid #E0E0E0;">
-											<{$lang.repository_item_edit_crossref}>
+									<{if $action.exist_datacite_prefix == true && $smarty.const._REPOSITORY_JALC_DATACITE_DOI == true}>
+										<th style="border: 1px solid #E0E0E0; padding-top : 5px; padding-bottom : 5px;">
+    										<label style="display: block; width:100%;height:100%;" for="registing_all_datacite_checkbox">
+    										    <center>
+											        &nbsp;&nbsp;&nbsp;<B><{$lang.repository_item_edit_datacite}></B>&nbsp;&nbsp;&nbsp;<br>
+											        <input type="checkbox" id="registing_all_datacite_checkbox" name="registing_all_datacite_items" onclick="javascript: checkAll('registing_all_datacite_checkbox');">
+											    </center>
+											</label>
 										</th>
 									<{/if}>
-									<th style="border: 1px solid #E0E0E0;">
-										<{$lang.repository_item_edit_item_name}>
+									<th style="border: 1px solid #E0E0E0; padding-top : 5px; padding-bottom : 5px;">
+										<center>
+										    <{$lang.repository_item_edit_item_name}>
+										</center>
 									</th>
 								</tr>
 								<{foreach from=$action.doiData item=itemData name="doiItemList"}>
 									<{assign var="cnt" value=$smarty.foreach.doiItemList.iteration-1}> 
 									<tr id="repository_doi_management_<{$itemData.item_id}>" height="30px" style="border: 1px solid #E0E0E0;">
 										<{* td *}>
-										<{if $action.exist_jalcdoi_prefix == true}>
-											<td width="10%" style="border: 1px solid #E0E0E0;">
-												<input type="checkbox" id="registing_jalcdoi_checkbox<{$id}>_<{$cnt}>" name="registing_jalcdoi_items[]" value="<{$itemData.item_id}>" style="margin-left:45%" <{if $itemData.jalc_doi == 1}>disabled<{/if}> onclick="javascript: changeCheck('registing_jalcdoi_checkbox<{$id}>_<{$cnt}>', 'registing_crossref_checkbox<{$id}>_<{$cnt}>');">
+										<{if $action.exist_jalcdoi_prefix == true && $smarty.const._REPOSITORY_JALC_DOI == true}>
+											<td width="15%" style="border: 1px solid #E0E0E0;">
+												<center>
+												    <input type="checkbox" id="registing_jalcdoi_checkbox<{$id}>_<{$cnt}>" name="registing_jalcdoi_items[]" value="<{$itemData.item_id}>" <{if $itemData.jalc_doi == 1}>disabled<{/if}> onclick="javascript: changeCheck('registing_jalcdoi_checkbox<{$id}>_<{$cnt}>', 'registing_crossref_checkbox<{$id}>_<{$cnt}>', 'registing_datacite_checkbox<{$id}>_<{$cnt}>');">
+												</center>
 											</td>
 										<{/if}>
-										<{if $action.exist_crossref_prefix == true}>
-											<td width="10%" style="border: 1px solid #E0E0E0;">
-												<input type="checkbox" id="registing_crossref_checkbox<{$id}>_<{$cnt}>" name="registing_crossref_items[]" value="<{$itemData.item_id}>" style="margin-left:45%" <{if $itemData.cross_ref == 1}>disabled<{/if}> onclick="javascript: changeCheck('registing_crossref_checkbox<{$id}>_<{$cnt}>', 'registing_jalcdoi_checkbox<{$id}>_<{$cnt}>');">
+										<{if $action.exist_crossref_prefix == true && $smarty.const._REPOSITORY_JALC_CROSSREF_DOI == true}>
+											<td width="15%" style="border: 1px solid #E0E0E0;">
+												<center>
+												    <input type="checkbox" id="registing_crossref_checkbox<{$id}>_<{$cnt}>" name="registing_crossref_items[]" value="<{$itemData.item_id}>" <{if $itemData.cross_ref == 1}>disabled<{/if}> onclick="javascript: changeCheck('registing_crossref_checkbox<{$id}>_<{$cnt}>', 'registing_jalcdoi_checkbox<{$id}>_<{$cnt}>', 'registing_datacite_checkbox<{$id}>_<{$cnt}>');">
+												</center>
 											</td>
 										<{/if}>
-										<td style="padding: 2px; padding-left: 10px;" class="al" width="500">
+										<{if $action.exist_datacite_prefix == true && $smarty.const._REPOSITORY_JALC_DATACITE_DOI == true}>
+											<td width="15%" style="border: 1px solid #E0E0E0;">
+												<center>
+												    <input type="checkbox" id="registing_datacite_checkbox<{$id}>_<{$cnt}>" name="registing_datacite_items[]" value="<{$itemData.item_id}>" <{if $itemData.datacite == 1}>disabled<{/if}> onclick="javascript: changeCheck('registing_datacite_checkbox<{$id}>_<{$cnt}>', 'registing_crossref_checkbox<{$id}>_<{$cnt}>', 'registing_jalcdoi_checkbox<{$id}>_<{$cnt}>');">
+												</center>
+											</td>
+										<{/if}>
+										<td style="padding: 2px; padding-left: 10px;" class="al" width="55%">
 											<a href="#" onclick="javascript: repositoryCls['<{$id}>'].repositoryWorkflowItemDetail(event, <{$itemData.item_id}>,<{$itemData.item_no}>, true); return false;">
 											<{if $itemData.title!="" }>
 											  <{$itemData.title}>
@@ -94,22 +139,11 @@
 					</div>
 				</td>
 			</tr>
-			<tr>
-				<td>
-					<select id="jalc_all_check" name="default_disp_type" onchange="javascript: checkAll();" align="left" style="margin-top:4px; margin-left:10px">
-						<option value="0"><{$lang.repository_item_edit_select}></option>
-						<{if $action.exist_jalcdoi_prefix == true}>
-							<option value="1"><{$lang.repository_item_enterjalcdoi_all_check}></option>
-						<{/if}>
-						<{if $action.exist_crossref_prefix == true}>
-							<option value="2"><{$lang.repository_item_entercrossref_all_check}></option>
-						<{/if}>
-					</select>
-				</td>
-			</tr>
 		<{/if}>
 	</table>
-	<input type="button" class="btn_blue" value="<{$lang.repository_execute}>" onclick="repositoryCls['<{$id}>'].repositoryDoiSet(<{$action.sortIndexId}>); return false;">
+	<{if count($action.doiData) > 0}>
+	    <input type="button" class="btn_blue" value="<{$lang.repository_item_add_doi}>" onclick="repositoryCls['<{$id}>'].repositoryDoiSet(<{$action.sortIndexId}>); return false;" style="margin : 10px !important">
+	<{/if}>
 </div>
 
 <{/strip}>
@@ -128,31 +162,112 @@
 	}
 </script>
 <script class="nc_script" type="text/javascript">
-    checkAll = function()
+    checkAll = function(last)
     {
-        var checkall_select = $('jalc_all_check');
-        if(checkall_select.value == 1)
+        var check_flag = 0;
+        var last_check = document.getElementById(last);
+        var all_jalc = document.getElementById("registing_all_jalcdoi_checkbox");
+        var all_crossref = document.getElementById("registing_all_crossref_checkbox");
+        var all_datacite = document.getElementById("registing_all_datacite_checkbox");
+        if(last_check == all_jalc)
         {
-            var checkedbox = document.getElementsByName("registing_jalcdoi_items[]");
-            var delete_check = document.getElementsByName("registing_crossref_items[]");
+            if(all_jalc.checked == true)
+            {
+                check_flag = 1;
+                var checkedbox = document.getElementsByName("registing_jalcdoi_items[]");
+                var delete_check = document.getElementsByName("registing_crossref_items[]");
+                var delete_check_other = document.getElementsByName("registing_datacite_items[]");
+                if(all_crossref)
+                {
+                    all_crossref.checked = false;
+                }
+                if(all_datacite)
+                {
+                    all_datacite.checked = false;
+                }
+            }
+            else if(all_jalc.checked == false)
+            {
+                check_flag = 2;
+                var checkedbox = document.getElementsByName("registing_jalcdoi_items[]");
+            }
         }
-        else if(checkall_select.value == 2)
+        else if(last_check == all_crossref)
         {
-            var checkedbox = document.getElementsByName("registing_crossref_items[]");
-            var delete_check = document.getElementsByName("registing_jalcdoi_items[]");
+            if(all_crossref.checked == true)
+            {
+                check_flag = 1;
+                var checkedbox = document.getElementsByName("registing_crossref_items[]");
+                var delete_check = document.getElementsByName("registing_jalcdoi_items[]");
+                var delete_check_other = document.getElementsByName("registing_datacite_items[]");
+                if(all_jalc)
+                {
+                    all_jalc.checked = false;
+                }
+                if(all_datacite)
+                {
+                    all_datacite.checked = false;
+                }
+            }
+            else if(all_crossref.checked == false)
+            {
+                check_flag = 2;
+                var checkedbox = document.getElementsByName("registing_crossref_items[]");
+            }
+        }
+        else if(last_check == all_datacite)
+        {
+            if(all_datacite.checked == true)
+            {
+                check_flag = 1;
+                var checkedbox = document.getElementsByName("registing_datacite_items[]");
+                var delete_check = document.getElementsByName("registing_jalcdoi_items[]");
+                var delete_check_other = document.getElementsByName("registing_crossref_items[]");
+                if(all_jalc)
+                {
+                    all_jalc.checked = false;
+                }
+                if(all_crossref)
+                {
+                    all_crossref.checked = false;
+                }
+            }
+            else if(all_datacite.checked == false)
+            {
+                check_flag = 2;
+                var checkedbox = document.getElementsByName("registing_datacite_items[]");
+            }
         }
         if(checkedbox)
         {
-            for(var cnt = 0; cnt < checkedbox.length; cnt++)
+            if(check_flag == 1)
             {
-                if(checkedbox[cnt].disabled == false)
+                for(var cnt = 0; cnt < checkedbox.length; cnt++)
                 {
-                    checkedbox[cnt].checked = true;
+                    if(checkedbox[cnt].disabled == false)
+                    {
+                        checkedbox[cnt].checked = true;
+                    }
+                    
+                    if(delete_check[cnt])
+                    {
+                        delete_check[cnt].checked = false;
+                    }
+                    
+                    if(delete_check_other[cnt])
+                    {
+                        delete_check_other[cnt].checked = false;
+                    }
                 }
-                
-                if(delete_check[cnt])
+            }
+            else if(check_flag == 2)
+            {
+                for(var cnt = 0; cnt < checkedbox.length; cnt++)
                 {
-                    delete_check[cnt].checked = false;
+                    if(checkedbox[cnt].disabled == false)
+                    {
+                        checkedbox[cnt].checked = false;
+                    }
                 }
             }
         }
@@ -161,10 +276,14 @@
     }
 </script>
 <script class="nc_script" type="text/javascript">
-    changeCheck = function(last, before)
+    changeCheck = function(last, before, before_other)
     {
         var last_checked = document.getElementById(last);
         var before_checked = document.getElementById(before);
+        var before_other_checked = document.getElementById(before_other);
+        var all_jalc = document.getElementById("registing_all_jalcdoi_checkbox");
+        var all_crossref = document.getElementById("registing_all_crossref_checkbox");
+        var all_datacite = document.getElementById("registing_all_datacite_checkbox");
         
         if (last_checked && before_checked) 
         {
@@ -173,6 +292,25 @@
                 before_checked.checked = false;
             }
         }
+        if (last_checked && before_other_checked) 
+        {
+            if(last_checked.checked == true)
+            {
+                before_other_checked.checked = false;
+            }
+        }
+        if (all_jalc)
+        {
+            all_jalc.checked = false;
+        }
+        if (all_crossref)
+        {
+            all_crossref.checked = false;
+        }
+        if (all_datacite)
+        {
+            all_datacite.checked = false;
+        }
         
         return false;
     }
diff --git a/repository/templates/default/repository_item_edit_editdoi.html b/repository/templates/default/repository_item_edit_editdoi.html
index 80cd99b..5ebc714 100644
--- a/repository/templates/default/repository_item_edit_editdoi.html
+++ b/repository/templates/default/repository_item_edit_editdoi.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_edit_editdoi.html 42605 2014-10-03 01:02:01Z keiya_sugimoto $          -->
+<!--// $Id: repository_item_edit_editdoi.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -26,11 +26,38 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_6.png" alt="" />
-					<{else}>
-						<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_6_eng.png" alt="" />
-					<{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_5.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_4.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_5_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_4_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
 				</td>
 			</tr>
 		</table>
@@ -38,30 +65,90 @@
 
 	<div class="mt10" align=center>
 		<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>','repository_view_main_item_editlinks'); return false;">
-		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('stay');return false;" />
-		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('next');return false;" />
+		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('stay');return false;" />
+		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('next');return false;" />
 	</div>
+    <center>
+        <{if $action.errMsg != null && count($action.errMsg) > 0}>
+        <div class="error_msg al">
+            <{foreach from=$action.errMsg item=msg}>
+            <{$msg|smarty:nodefaults}><br/>
+            <{/foreach}>
+        </div>
+        <{/if}>
+        <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+        <div class="warning_msg al">
+            <{foreach from=$action.warningMsg item=msg}>
+            <{$msg|smarty:nodefaults}><br/>
+            <{/foreach}>
+        </div>
+        <{/if}>
+    </center>
 
  <div align="center" class="text_color">
   <form>
    <div class="paging">
     <{if $action.doi_status == '0' && $action.displays_doi_grant == true}>
-     <{if strlen($action.prefix_jalcdoi) > 0}>
-      <div class="paging" style="margin-left:28%" align="left">
-        <input type="checkbox" id="id_entry_jalcdoi_checkbox" name="entry_jalcdoi_checkbox" value="<{$action.suffix}>" align="center" onclick="javascript: changeJalcdoiCheckbox()" ><label for="id_entry_jalcdoi_checkbox"><{$lang.repository_item_enter_jalcdoi}></label>
-        &nbsp;&nbsp;<span>http://doi.org/<{$action.prefix_jalcdoi}>/<{$action.suffix}></span>
-        <input type="hidden" id="id_entry_jalcdoi_hidden" name="entry_jalcdoi_hidden" value="http://doi.org/<{$action.prefix_jalcdoi}>/<{$action.suffix}>">
-      </div>
-     <{/if}>
-     <{if strlen($action.prefix_crossref) > 0}>
-      <div class="paging" style="margin-left:28%" align="left">
-        <input type="checkbox" id="id_entry_crossref_checkbox" name="entry_crossref_checkbox" value="<{$action.suffix}>" align="center" onclick="javascript: changeCrossrefCheckbox()" ><label for="id_entry_crossref_checkbox"><{$lang.repository_item_enter_crossref}></label>
-        &nbsp;&nbsp;<span>http://doi.org/<{$action.prefix_crossref}>/<{$action.suffix}></span>
-        <input type="hidden" id="id_entry_crossref_hidden" name="entry_crossref_hidden" value="http://doi.org/<{$action.prefix_crossref}>/<{$action.suffix}>">
-      </div>
-     <{/if}>
+      <table>
+        <tbody>
+        <{if strlen($action.prefix_jalcdoi) > 0 && $smarty.const._REPOSITORY_JALC_DOI == true}>
+          <tr>
+            <td  style="padding-top : 10px; padding-left : 5px">
+              <input type="checkbox" id="id_entry_jalcdoi_checkbox" name="entry_jalcdoi_checkbox" value="<{$action.suffix}>" align="center" onclick="javascript: changeJalcdoiCheckbox();" >
+            </td>
+            <td  style="padding-top : 10px; padding-left : 5px">
+              <label style="display: block; width:100%;height:100%;" for="id_entry_jalcdoi_checkbox">
+                <{$lang.repository_item_enter_jalcdoi}>
+              </label>
+            </td>
+            <td  style="padding-top : 10px; padding-left : 10px">
+              <label style="display: block; width:100%;height:100%;" for="id_entry_jalcdoi_checkbox">
+                http://doi.org/<{$action.prefix_jalcdoi}>/<{if $action.prefix_flag > 0}><{$action.prefix_yhandle}>.<{/if}><{$action.suffix}>
+              </label>
+              <input type="hidden" id="id_entry_jalcdoi_hidden" name="entry_jalcdoi_hidden" value="http://doi.org/<{$action.prefix_jalcdoi}>/<{$action.suffix}>">
+            </td>
+          </tr>
+        <{/if}>
+        <{if strlen($action.prefix_crossref) > 0 && $smarty.const._REPOSITORY_JALC_CROSSREF_DOI == true}>
+          <tr>
+            <td  style="padding-top : 10px; padding-left : 5px">
+              <input type="checkbox" id="id_entry_crossref_checkbox" name="entry_crossref_checkbox" value="<{$action.suffix}>" align="center" onclick="javascript: changeCrossrefCheckbox();" >
+            </td>
+            <td  style="padding-top : 10px; padding-left : 5px">
+              <label style="display: block; width:100%;height:100%;" for="id_entry_crossref_checkbox">
+                <{$lang.repository_item_enter_crossref}>
+              </label>
+            </td>
+            <td  style="padding-top : 10px; padding-left : 10px">
+              <label style="display: block; width:100%;height:100%;" for="id_entry_crossref_checkbox">
+                http://doi.org/<{$action.prefix_crossref}>/<{if $action.prefix_flag > 0}><{$action.prefix_yhandle}>.<{/if}><{$action.suffix}>
+              </label>
+              <input type="hidden" id="id_entry_crossref_hidden" name="entry_crossref_hidden" value="http://doi.org/<{$action.prefix_crossref}>/<{$action.suffix}>">
+            </td>
+          </tr>
+        <{/if}>
+        <{if strlen($action.prefix_datacite) > 0 && $smarty.const._REPOSITORY_JALC_DATACITE_DOI == true}>
+          <tr>
+            <td  style="padding-top : 10px; padding-left : 5px">
+              <input type="checkbox" id="id_entry_datacite_checkbox" name="entry_datacite_checkbox" value="<{$action.suffix}>" align="center" onclick="javascript: changeDataciteCheckbox();" >
+            </td>
+            <td  style="padding-top : 10px; padding-left : 5px">
+              <label style="display: block; width:100%;height:100%;" for="id_entry_datacite_checkbox">
+                <{$lang.repository_item_enter_datacite}>
+              </label>
+            </td>
+            <td  style="padding-top : 10px; padding-left : 10px">
+              <label style="display: block; width:100%;height:100%;" for="id_entry_datacite_checkbox">
+                http://doi.org/<{$action.prefix_datacite}>/<{if $action.prefix_flag > 0}><{$action.prefix_yhandle}>.<{/if}><{$action.suffix}>
+              </label>
+              <input type="hidden" id="id_entry_datacite_hidden" name="entry_datacite_hidden" value="http://doi.org/<{$action.prefix_datacite}>/<{$action.suffix}>">
+            </td>
+          </tr>
+        <{/if}>
+        </tbody>
+      </table>
      <{if strlen($action.prefix_library_jalcdoi) > 0}>
-      <div class="paging" style="margin-left:28%" align="left">
+      <div class="paging" style="margin-left:33%" align="left">
         <{$lang.repository_item_enter_library_jalcdoi}></br>
         <input type="text" id="id_entry_library_jalcdoi_text" name="entry_library_jalcdoi_text" align="center" onfocus="javascript: focusLibraryJalcdoiText()" ><label for="id_entry_library_jalcdoi_text"></label>
         <input type="hidden" id="id_entry_library_jalcdoi_hidden" name="entry_library_jalcdoi_hidden" value="http://doi.org/<{$action.prefix_library_jalcdoi}>/<{$action.suffix}>">
@@ -69,7 +156,7 @@
      <{/if}>
     <{elseif $action.doi_status == '1'}>
      <div class="paging">
-       <input type="button" class="btn_delete ar" align="center" value="<{if $action.registed_library_jalcdoi == 1}><{$lang.repository_item_delete_library_jalcdoi}><{elseif $action.registed_doi == 1}><{$lang.repository_item_delete_jalcdoi}><{else}><{$lang.repository_item_delete_crossref}><{/if}>" onclick="if(!commonCls.confirm('<{$lang.repository_item_delete_jalcdoi_confirm}>'))return false; commonCls.sendView('<{$id}>', {'action':'repository_view_main_item_editdoi', 'drop_doi':'true'}); return false;" style="width:205px;" >
+       <input type="button" class="btn_delete_doi ar" align="center" value="<{if $action.registed_library_jalcdoi == 1}><{$lang.repository_item_delete_library_jalcdoi}><{elseif $action.registed_doi == 1}><{$lang.repository_item_delete_jalcdoi}><{elseif $action.registed_doi == 2}><{$lang.repository_item_delete_crossref}><{else}><{$lang.repository_item_delete_datacite}><{/if}>" onclick="if(!commonCls.confirm('<{$lang.repository_item_delete_jalcdoi_confirm}>'))return false; commonCls.sendView('<{$id}>', {'action':'repository_view_main_item_editdoi', 'drop_doi':'true'}); return false;">
      </div>
     <{elseif $action.doi_status == '2'}>
      <div class="paging">
@@ -80,8 +167,8 @@
   </form>
 
   <input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editlinks');return false;">
-  <input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('stay');return false;" />
-  <input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemConfirm('next');return false;" />
+  <input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('stay');return false;" />
+  <input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('next');return false;" />
  </div>
 
 </div>
@@ -98,6 +185,13 @@
                 $(id_entry_crossref_checkbox).checked = false;
             }
             
+            var checkDataCite = document.getElementById("id_entry_datacite_checkbox");
+            
+            if (checkDataCite)
+            {
+                $(id_entry_datacite_checkbox).checked = false;
+            }
+            
             var textLibraryJalcdoi = document.getElementById("id_entry_library_jalcdoi_text");
             
             if (textLibraryJalcdoi)
@@ -121,6 +215,43 @@
                 $(id_entry_jalcdoi_checkbox).checked = false;
             }
             
+            var checkDataCite = document.getElementById("id_entry_datacite_checkbox");
+            
+            if (checkDataCite)
+            {
+                $(id_entry_datacite_checkbox).checked = false;
+            }
+            
+            var textLibraryJalcdoi = document.getElementById("id_entry_library_jalcdoi_text");
+            
+            if (textLibraryJalcdoi)
+            {
+                $(id_entry_library_jalcdoi_text).value = "";
+            }
+        }
+        
+        return false;
+    }
+</script>
+<script class="nc_script" type="text/javascript">
+    changeDataciteCheckbox = function()
+    {
+        if($(id_entry_datacite_checkbox).checked == true)
+        {
+            var checkJalcdoi = document.getElementById("id_entry_jalcdoi_checkbox");
+            
+            if (checkJalcdoi)
+            {
+                $(id_entry_jalcdoi_checkbox).checked = false;
+            }
+            
+            var checkCrossRef = document.getElementById("id_entry_crossref_checkbox");
+            
+            if (checkCrossRef)
+            {
+                $(id_entry_crossref_checkbox).checked = false;
+            }
+            
             var textLibraryJalcdoi = document.getElementById("id_entry_library_jalcdoi_text");
             
             if (textLibraryJalcdoi)
@@ -149,6 +280,13 @@
             $(id_entry_crossref_checkbox).checked = false;
         }
         
+        var checkDataCite = document.getElementById("id_entry_datacite_checkbox");
+        
+        if (checkDataCite)
+        {
+            $(id_entry_datacite_checkbox).checked = false;
+        }
+        
         return false;
     }
 </script>
diff --git a/repository/templates/default/repository_item_edit_files.html b/repository/templates/default/repository_item_edit_files.html
index b476fee..aa54f66 100644
--- a/repository/templates/default/repository_item_edit_files.html
+++ b/repository/templates/default/repository_item_edit_files.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_edit_files.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_item_edit_files.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -27,19 +27,38 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<{if $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2.png" alt="" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2.png" alt="" />
-						<{/if}>
-					<{else}>
-						<{if $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2_eng.png" alt="" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2_eng.png" alt=""/>
-						<{/if}>
-					 <{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">
+                    </map>
 				</td>
 			</tr>
 		</table>
@@ -57,16 +76,25 @@
 		<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_selecttype'); return false;">
 		<{/if}>
 		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('stay'); return false;">
-		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles(''); return false;">
+		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('next'); return false;">
 	</div>
 	<div class="paging"><b><{$lang.repository_itemtype}> : <{$smarty.session.item_type_all.item_type_name}></b></div>
-	<{if $action.error_msg != null}>
-		<div class="error_msg al">
-			<{section name=i loop=$action.error_msg}>
-				<{$action.error_msg[i]}><br />
-			<{/section}>
-		</div>
-	<{/if}>
+
+    <{if $action.errMsg != null && count($action.errMsg) > 0}>
+    <div class="error_msg al">
+        <{foreach from=$action.errMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
+    <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+    <div class="warning_msg al">
+        <{foreach from=$action.warningMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
+    
 	<div id="can_drop"><{$lang.repository_drag_and_drop}></div>
 	<div class="paging">
 		<form id="attachment_form<{$id}>" target="attachment_form<{$id}>" enctype="multipart/form-data">
@@ -240,7 +268,7 @@
 	<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_selecttype'); return false;">
 	<{/if}>
 	<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('stay'); return false;">
-	<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles(''); return false;">
+	<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemUploadFiles('next'); return false;">
 </div>
 
 </div>
diff --git a/repository/templates/default/repository_item_edit_files_license.html b/repository/templates/default/repository_item_edit_files_license.html
index 4a626dd..2d067ae 100644
--- a/repository/templates/default/repository_item_edit_files_license.html
+++ b/repository/templates/default/repository_item_edit_files_license.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_edit_files_license.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: repository_item_edit_files_license.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -27,19 +27,38 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<{if $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2.png" alt="" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2.png" alt="" />
-						<{/if}>
-					<{else}>
-						<{if $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2_eng.png" alt="" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2_eng.png" alt=""/>
-						<{/if}>
-					<{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_2_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_2_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">
+                    </map>
 				</td>
 			</tr>
 		</table>
@@ -49,20 +68,27 @@
 	
 	<div class="mt10" align=center class="paging">
 		<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editfiles'); return false;"/>
-		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('stay'); return false;"/>
-		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts(); return false;" />
+		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('stay'); return false;"/>
+		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('next'); return false;" />
 	</div>
   <div class="paging">
    <b><{$lang.repository_itemtype}> : <{$smarty.session.item_type_all.item_type_name}></b>
   </div>
-	
-	<{if $action.error_msg != null}>
-		<div class="error_msg al">
-			<{section name=i loop=$action.error_msg}>
-				<{$action.error_msg[i]}><br />
-			<{/section}>
-		</div>
-	<{/if}>
+
+    <{if $action.errMsg != null && count($action.errMsg) > 0}>
+    <div class="error_msg al">
+        <{foreach from=$action.errMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
+    <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+    <div class="warning_msg al">
+        <{foreach from=$action.warningMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
   
   <form id="attachment_form<{$id}>" target="attachment_form<{$id}>" enctype="multipart/form-data">
   
@@ -197,7 +223,21 @@
          <option value="licence_free" <{if $item_attr[i][j].licence == "licence_free"}>SELECTED<{/if}> ><{$lang.repository_licence_free}></option>
          <{*ライセンスマスタに登録されている分だけライセンスをプルダウンメニューに入れる*}>
          <{section name=k loop=$license_master}>
-          <option value="<{$smarty.section.k.index}>" <{if $item_attr[i][j].licence == $smarty.section.k.index}>SELECTED<{/if}> ><{$license_master[k].license_notation}></option>
+          <option value="<{$smarty.section.k.index}>" <{if $item_attr[i][j].licence == $smarty.section.k.index}>SELECTED<{/if}> >
+            <{if $license_master[k].license_id == 101}>
+              <{$lang.repository_item_file_license_notation_by}>
+            <{elseif $license_master[k].license_id == 102}>
+              <{$lang.repository_item_file_license_notation_by_sa}>
+            <{elseif $license_master[k].license_id == 103}>
+              <{$lang.repository_item_file_license_notation_by_nd}>
+            <{elseif $license_master[k].license_id == 104}>
+              <{$lang.repository_item_file_license_notation_by_nc}>
+            <{elseif $license_master[k].license_id == 105}>
+              <{$lang.repository_item_file_license_notation_by_nc_sa}>
+            <{elseif $license_master[k].license_id == 106}>
+              <{$lang.repository_item_file_license_notation_by_nc_nd}>
+            <{/if}>
+          </option>
          <{/section}>
         </select>
         <span style="<{if $item_attr[i][j].licence == "licence_free"}>display:block<{else}>display:none<{/if}>" id="span_<{$cnt1}>_<{$cnt2}>">
@@ -280,15 +320,16 @@
          </span>
         <{/if}>
         <input id="embargo_<{$cnt1}>_flag_<{$cnt2}>" name="embargo_flag[]" type="hidden" value="<{$item_attr[i][j].embargo_flag}>" >
+        <{* 課金ファイル *}>
         <{if $attr_type[i].input_type == 'file_price'}>
          <{if $item_attr[i][j].price_num>0}>
-          <div id="not_set_price_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].embargo_flag==1}>style="display:block;"<{else}>style="display:none;"<{/if}>>
+          <div id="not_set_price_<{$cnt1}>_<{$cnt2}>" class="pl10" <{if $item_attr[i][j].embargo_flag==1}>style="display:block;"<{else}>style="display:none;"<{/if}>>
            <div class="ranking_paging"><{$lang.repository_item_embargo_open}></div>
           </div>
-          <div id="set_price_no_download_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].display_type==2 && $item_attr[i][j].embargo_flag==4}>style="display:block;"<{else}>style="display:none;"<{/if}>>
+          <div id="set_price_no_download_<{$cnt1}>_<{$cnt2}>" class="pl10" <{if $item_attr[i][j].display_type==2 && $item_attr[i][j].embargo_flag==4}>style="display:block;"<{else}>style="display:none;"<{/if}>>
            <div class="ranking_paging"><{$lang.repository_item_embargo_no_download}></div>
           </div>
-          <div id="set_price_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].embargo_flag==1 || ($item_attr[i][j].display_type==2 && $item_attr[i][j].embargo_flag==4)}>style="display:none;"<{else}>style="display:block;"<{/if}>>
+          <div id="set_price_<{$cnt1}>_<{$cnt2}>" class="pl10" <{if $item_attr[i][j].embargo_flag==1 || ($item_attr[i][j].display_type==2 && $item_attr[i][j].embargo_flag==4)}>style="display:none;"<{else}>style="display:block;"<{/if}>>
            <div class="ranking_paging"><{$lang.repository_item_set_price}></div>
            <div class="ranking_paging" style="color:#ff0000"><{$lang.repository_item_attention}></div>
            <div class="ranking_paging">
@@ -337,6 +378,61 @@
            <input type="button" class="btn_white" value="<{$lang.repository_item_add_price}>" onclick="javascript: repositoryCls['<{$id}>'].repositorySetPrice(1, <{$cnt1}>, <{$cnt2}>); return false;"/>
           </div>
          <{/if}>
+        <{* ファイル *}>
+        <{else if $attr_type[i].input_type == 'file'}>
+         <div id="embargo_file_authority_<{$cnt1}>_<{$cnt2}>" class="pl10">
+          <{if $item_attr[i][j].auth_num>0}>
+           <div id="not_set_price_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].embargo_flag==1}>style="display:block;"<{else}>style="display:none;"<{/if}>>
+            <div class="ranking_paging"><{$lang.repository_item_emvargo_file_authority}></div>
+           </div>
+           <div id="set_price_no_download_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].display_type==2 && $item_attr[i][j].embargo_flag==4}>style="display:block;"<{else}>style="display:none;"<{/if}>>
+            <div class="ranking_paging"><{$lang.repository_item_embargo_file_authority_no_download}></div>
+           </div>
+           <div id="set_price_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].embargo_flag==1 || ($item_attr[i][j].display_type==2 && $item_attr[i][j].embargo_flag==4)}>style="display:none;"<{else}>style="display:block;"<{/if}>>
+            <div class="ranking_paging"><{$lang.repository_item_set_file_authority}></div>
+            <div class="ranking_paging" style="color:#ff0000"><{$lang.repository_item_file_authority_attention}></div>
+            <div class="ranking_paging">
+             <table>
+              <tr class="ranking_repos text_color">
+               <th class="item_edit_list ac full"><{$lang.repository_item_group_name}></th>
+               <th class="item_edit_list ac"><{$lang.repository_delete}></th>
+              </tr>
+              <{section name=p loop=$item_attr[i][j].auth_num}>
+              <{assign var="auth_cnt" value=$smarty.section.p.index}>
+               <tr>
+                <td class="item_edit_list">
+                 <select name="auth_room_ids[]" class="full">
+                  <option value="0" <{if $item_attr[i][j].auth_room_id[p]==0}>SELECTED<{/if}>><{$lang.repository_item_gest}></option>
+                  <{* NC2に存在するグループ分 *}>
+                  <{section name=k loop=$smarty.session.all_group}>
+                  <{assign var="all_group" value=$smarty.session.all_group}>
+                   <option value="<{$all_group[k].room_id}>" <{if $item_attr[i][j].auth_room_id[p]==$all_group[k].room_id}>SELECTED<{/if}>><{$all_group[k].page_name}></option>
+                  <{/section}>
+                 </select>
+                </td>
+                <td class="item_edit_list">
+                 <input type="button" class="btn_delete ar" value="<{$lang.repository_delete}>" 
+                  onclick="javascript: repositoryCls['<{$id}>'].repositorySetPrice(2, <{$cnt1}>, <{$cnt2}>, <{$auth_cnt}>); return false;"
+                 />
+                </td>
+               </tr>
+              <{/section}>
+             </table>
+            </div>
+            <{if $item_attr[i][j].auth_num!=(count($smarty.session.all_group)+1)}>
+             <div class="ranking_paging">
+              <input type="button" class="btn_white" value="<{$lang.repository_item_add_group}>" onclick="javascript: repositoryCls['<{$id}>'].repositorySetPrice(1, <{$cnt1}>, <{$cnt2}>); return false;"/>
+             </div>
+            <{/if}>
+           </div>
+          <{else}>
+           <div id="not_set_price_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].embargo_flag==1}>style="display:block;"<{else}>style="display:none;"<{/if}>>
+            <div class="ranking_paging"><{$lang.repository_item_emvargo_file_authority}></div>
+           </div>
+           <div id="set_price_<{$cnt1}>_<{$cnt2}>" <{if $item_attr[i][j].embargo_flag==1}>style="display:none;"<{else}>style="display:block;"<{/if}>>
+            <input type="button" class="btn_white" value="<{$lang.repository_item_add_file_authority}>" onclick="javascript: repositoryCls['<{$id}>'].repositorySetPrice(1, <{$cnt1}>, <{$cnt2}>); return false;"/>
+           </div>
+          <{/if}>
         <{/if}>
        </td>
       </tr>
@@ -416,8 +512,8 @@
 
 <div align=center class="paging">
 	<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_editfiles'); return false;"/>
-	<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('stay'); return false;"/>
-	<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts(); return false;" />
+	<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('stay'); return false;"/>
+	<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditFilesLicense('next'); return false;" />
 </div>
 
 <{*Add check invalid date 2011/06/17 A.Suzuki --start--*}>
diff --git a/repository/templates/default/repository_item_edit_links.html b/repository/templates/default/repository_item_edit_links.html
index f32619f..a0e5cb9 100644
--- a/repository/templates/default/repository_item_edit_links.html
+++ b/repository/templates/default/repository_item_edit_links.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_edit_links.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: repository_item_edit_links.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -28,23 +28,63 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_4.png" alt="" />
-						<{elseif $smarty.session.attr_file_flg == 1}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_4.png" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_3.png" />
-						<{/if}>
-					<{else}>
-						<{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_4_eng.png" alt="" />
-						<{elseif $smarty.session.attr_file_flg == 1}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_4_eng.png" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_3_eng.png" />
-						<{/if}>
-					<{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_4.png" />
+                        <{elseif $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_3.png" />
+                        <{elseif $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_JPN" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_4.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_3.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_4_eng.png" />
+                        <{elseif $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_3_eng.png" />
+                        <{elseif $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_ENG" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_4_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_3_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,561,37,561,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
 				</td>
 			</tr>
 		</table>
@@ -52,25 +92,25 @@
 
 	<div class="mt5" style="text-align:center; text-valign: center;">
 		<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_edittexts'); return false;" />
-		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('stay'); return false;" />
-		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('next'); return false;" />
+		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('stay'); return false;" />
+		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('next'); return false;" />
 	</div>
-	<{if $action.error_msg != null || $action.warning != ""}>
-		<center>
-			<{if count($action.error_msg) > 0}>
-				<div class="error_msg al">
-					<{section name=i loop=$action.error_msg}>
-						<{$action.error_msg[i]}><br />
-					<{/section}>
-				</div>
-			<{/if}>
-			<{if strlen($action.warning) > 0}>
-				<div class="warning_msg al">
-					<{$action.warning}>
-				</div>
-			<{/if}>
-		</center>
-	<{/if}>
+    <center>
+        <{if $action.errMsg != null && count($action.errMsg) > 0}>
+        <div class="error_msg al">
+            <{foreach from=$action.errMsg item=msg}>
+            <{$msg|smarty:nodefaults}><br/>
+            <{/foreach}>
+        </div>
+        <{/if}>
+        <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+        <div class="warning_msg al">
+            <{foreach from=$action.warningMsg item=msg}>
+            <{$msg|smarty:nodefaults}><br/>
+            <{/foreach}>
+        </div>
+        <{/if}>
+    </center>
 
 <{* Add join set insert index and set item links 2008/12/17 Y.Nakao --start-- *}>
 <div class="box_center">
@@ -84,7 +124,7 @@
 			<{* keyword search *}>
 				<h3 class="th_repos text_color"><span><{$lang.repository_search_keyword}><{$lang.repository_search_start}></span></h3>
 
-				<form name="id_form_edit_links_search_keyword" name="form_edit_links_search_keyword" method="post">
+				<form name="id_form_edit_links_search_keyword" name="form_edit_links_search_keyword">
 				<div class="plr05 ptb10">
 					<div class="keyword_bk"><em><input type="text" class="<{if $smarty.session._lang == "japanese"}>keyword_text<{else}>keyword_text_eng<{/if}>" onkeypress="return clickSearch<{$id}>(event);" name="search_keyword" id="id_search_keyword" value="<{$smarty.session.link_searchkeyword}>"></em></div>
 					<input type="text" name="dummy" style="position:absolute;visibility:hidden">
@@ -264,8 +304,8 @@
 			</div>
 			<div style="text-align:center; text-valign: center;">
 				<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>', 'repository_view_main_item_edittexts'); return false;" />
-				<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('stay'); return false;" />
-				<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditDoi('next'); return false;" />
+				<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('stay'); return false;" />
+				<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('next'); return false;" />
 			</div>
 		</td>
 	</tr>
diff --git a/repository/templates/default/repository_item_edit_texts.html b/repository/templates/default/repository_item_edit_texts.html
index 148255e..a0ed0f7 100644
--- a/repository/templates/default/repository_item_edit_texts.html
+++ b/repository/templates/default/repository_item_edit_texts.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_edit_texts.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: repository_item_edit_texts.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -30,23 +30,63 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_3.png" alt="" />
-						<{elseif $smarty.session.attr_file_flg == 1}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_3.png" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_2.png" />
-						<{/if}>
-					<{else}>
-						<{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_3_eng.png" alt="" />
-						<{elseif $smarty.session.attr_file_flg == 1}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_3_eng.png" />
-						<{else}>
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_2_eng.png" />
-						<{/if}>
-					<{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_3.png" />
+                        <{elseif $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_2.png" />
+                        <{elseif $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_JPN" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_3.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_2.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $smarty.session.attr_file_flg == 1 && $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_3_eng.png" />
+                        <{elseif $smarty.session.doi_itemtype_flag == true}>
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_2_eng.png" />
+                        <{elseif $smarty.session.attr_file_flg == 1}>
+                            <img id="fileImg<{$id}>_ENG" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_3_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_2_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,561,37,561,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no_doi">
+                        <{if $smarty.session.edit_flag != 1}>
+                            <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">
+                        <{/if}>
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
 				</td>
 			</tr>
 		</table>
@@ -71,8 +111,8 @@
 		<input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>','repository_view_main_item_selecttype'); return false;">
 		<{/if}>
 		<{/if}>
-		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('stay');return false;" />
-		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('next');return false;" />
+		<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('stay');return false;" />
+		<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('next');return false;" />
 	</div>
 <div class="paging text_color" align="center">
 <b><{$lang.repository_itemtype}> : <{$smarty.session.item_type_all.item_type_name}></b>
@@ -93,6 +133,9 @@
 			<{if $smarty.session.login_connect=='1'}>
 			<option value="ichushi"><{$lang.repository_item_fill_data_type_ichushi}></option>
 			<{/if}>
+			<{if $action.crossref_flg}>
+			<option value="crossref"><{$lang.repository_item_fill_data_type_crossref}></option>
+			<{/if}>
 		</select>
 		</td>
 		<td class="item_edit_list3"style="text-align: right;" width="45px"><span id="fillPrefixId<{$id}>" class="nobr"></span></td>
@@ -108,18 +151,20 @@
 </table>
 
 <center>
-	<{if count($action.error_msg) > 0}>
-		<div class="error_msg al">
-			<{section name=i loop=$action.error_msg}>
-				<{$action.error_msg[i]}><br />
-			<{/section}>
-		</div>
-	<{/if}>
-	<{if strlen($action.warning) > 0}>
-		<div class="warning_msg al">
-			<{$action.warning}>
-		</div>
-	<{/if}>
+    <{if $action.errMsg != null && count($action.errMsg) > 0}>
+    <div class="error_msg al">
+        <{foreach from=$action.errMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
+    <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+    <div class="warning_msg al">
+        <{foreach from=$action.warningMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
 </center>
 
 <form name="item_attr_form" id="item_edit_text">
@@ -317,7 +362,7 @@
 						<span id="item_attr_name_fill_button_<{$smarty.section.i.index}>_<{$smarty.section.j.index}>_<{$smarty.section.k.index}>"></span>
 						<{* Modify Directory specification BASE_URL K.Matsuo 2011/9/2 *}>
 
-						<input type="button" style="width:23%;" class="btn_white nobr" value="fill"
+						<input type="button" style="width:23%;" class="btn_white nobr" value="<{$lang.repository_item_fill}>"
 						      onclick="this.style.display='none';
 						      $('item_attr_name_fill_button_<{$smarty.section.i.index}>_<{$smarty.section.j.index}>_<{$smarty.section.k.index}>').style.paddingLeft='16px';
 						      $('item_attr_name_fill_button_<{$smarty.section.i.index}>_<{$smarty.section.j.index}>_<{$smarty.section.k.index}>').style.paddingRight='16px';
@@ -353,7 +398,7 @@
 						<span id="item_attr_name_fill_button_<{$smarty.section.i.index}>_<{$smarty.section.j.index}>_<{$smarty.section.k.index}>"></span>
 						<{* Modify Directory specification BASE_URL K.Matsuo 2011/9/2 *}>
 
-						<input type="button" style="width:23%;" class="btn_white nobr" value="fill"
+						<input type="button" style="width:23%;" class="btn_white nobr" value="<{$lang.repository_item_fill}>"
 						      onclick="this.style.display='none';
 						      $('item_attr_name_fill_button_<{$smarty.section.i.index}>_<{$smarty.section.j.index}>_<{$smarty.section.k.index}>').style.paddingLeft='16px';
 						      $('item_attr_name_fill_button_<{$smarty.section.i.index}>_<{$smarty.section.j.index}>_<{$smarty.section.k.index}>').style.paddingRight='16px';
@@ -365,7 +410,7 @@
 					<tr>
 						<td></td>
 						<td colspan="3" align="left">
-						<input type="button" class="btn_white nobr" value="more ID" onclick="repositoryCls['<{$id}>'].repositoryItemEditSaveSession('add_author_id','<{$smarty.section.i.index}>','<{$smarty.section.j.index}>');return false;" /></td>
+						<input type="button" class="btn_white nobr" value="<{$lang.repository_item_more_id}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditSaveSession('add_author_id','<{$smarty.section.i.index}>','<{$smarty.section.j.index}>');return false;" /></td>
 					</tr>
 				</table>
 				</div>
@@ -671,8 +716,8 @@
 							<{/if}>
 							<{/section}>
 							</select>
-							<input type="hidden" id="send_feedback_mail_address_mailaddresses_id<{$id}>" name="send_feedback_mail_address_mailaddresses[]" value="<{$feedback_mailaddress_str}>" />
-							<input type="hidden" id="send_feedback_mail_address_author_id<{$id}>" name="send_feedback_mail_address_authors[]" value="<{$feedback_mailaddress_author_str}>"/>
+							<input type="hidden" id="send_feedback_mail_address_mailaddresses_id<{$id}>" name="send_feedback_mail_address_mailaddresses" value="<{$feedback_mailaddress_str}>" />
+							<input type="hidden" id="send_feedback_mail_address_author_id<{$id}>" name="send_feedback_mail_address_authors" value="<{$feedback_mailaddress_author_str}>"/>
 						</td>
 						<td class="pt00 pb00">
 							<input type="button" class="btn_delete" value="<{$lang.repository_delete}>" onclick="javascript: deleteFeedbackmail<{$id}>(); "/>
@@ -754,8 +799,8 @@
 <input type="button" class="btn_back" value="<{$lang.repository_return}>" onclick="commonCls.sendView('<{$id}>','repository_view_main_item_selecttype'); return false;">
 <{/if}>
 <{/if}>
-<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('stay');return false;" />
-<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditLinks('next');return false;" />
+<input type="button" class="btn_blue" value="<{$lang.repository_save}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('stay');return false;" />
+<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditTexts('next');return false;" />
 <!-- </form>  --></div>
 </div>
 </div>
@@ -903,6 +948,8 @@
  				alert('<{$lang.repository_item_fill_data_id_item}>'+'<{$lang.repository_item_fill_data_no_id_error}>');
  			} else if($('fill_type').value == 'ichushi'){
  				alert('<{$lang.repository_item_fill_data_id_ichushi}>'+'<{$lang.repository_item_fill_data_no_id_error}>');
+ 			} else if($('fill_type').value == 'crossref'){
+ 				alert('<{$lang.repository_item_fill_data_id_crossref}>'+'<{$lang.repository_item_fill_data_no_id_error}>');
  			}
  			$('fill_id').disabled = true;
  			$('fillBtn<{$id}>').disabled = true;
@@ -941,6 +988,10 @@
 			elm.innerHTML = '<{$lang.repository_item_fill_data_id_ichushi}> : ';
 			$('fill_id').disabled = false;
 			$('fillBtn<{$id}>').disabled = false;
+		} else if(key == 'crossref'){
+			elm.innerHTML = '<{$lang.repository_item_fill_data_id_crossref}> : ';
+			$('fill_id').disabled = false;
+			$('fillBtn<{$id}>').disabled = false;
 		} else {
 			elm.innerHTML = '';
 			$('fill_id').disabled = true;
diff --git a/repository/templates/default/repository_item_embargo.html b/repository/templates/default/repository_item_embargo.html
index 9345c0f..d1a74a1 100644
--- a/repository/templates/default/repository_item_embargo.html
+++ b/repository/templates/default/repository_item_embargo.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_embargo.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_item_embargo.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -60,7 +60,7 @@
        <label for="embargo_flag2"><{$lang.repository_item_embargo_candidate2}></label>
        </input>
        <br/>
-       <span id="embargo_open_date" style="<{if $action.embargo_flag_chk.value==2}>display:block;<{else}>display:none;<{/if}>">
+       <span id="embargo_open_date" style="<{if $action.embargo_flag_chk=='2'}>display:block;<{else}>display:none;<{/if}>">
          <input class="w035em" type="text" id="embargo_year" value="<{$action.date.year}>" />
          <{$lang.repository_year}>
          <select id="embargo_month">
@@ -128,7 +128,19 @@
         <{section name=k loop=$action.licence_master}>
         <{assign var="cnt" value=$smarty.section.k.index}>
           <option id="licence_id_<{$cnt+1}>" value="<{$action.licence_master[k].license_id}>" <{if $action.licence_master[k].license_id==$action.license_id }>SELECTED<{/if}> >
-          <{$action.licence_master[k].license_notation}>
+            <{if $action.licence_master[k].license_id == 101}>
+              <{$lang.repository_item_file_license_notation_by}>
+            <{elseif $action.licence_master[k].license_id == 102}>
+              <{$lang.repository_item_file_license_notation_by_sa}>
+            <{elseif $action.licence_master[k].license_id == 103}>
+              <{$lang.repository_item_file_license_notation_by_nd}>
+            <{elseif $action.licence_master[k].license_id == 104}>
+              <{$lang.repository_item_file_license_notation_by_nc}>
+            <{elseif $action.licence_master[k].license_id == 105}>
+              <{$lang.repository_item_file_license_notation_by_nc_sa}>
+            <{elseif $action.licence_master[k].license_id == 106}>
+              <{$lang.repository_item_file_license_notation_by_nc_nd}>
+            <{/if}>
           </option>
         <{/section}>
        </select>
diff --git a/repository/templates/default/repository_item_search_detail.html b/repository/templates/default/repository_item_search_detail.html
index c4ac530..05fb68e 100644
--- a/repository/templates/default/repository_item_search_detail.html
+++ b/repository/templates/default/repository_item_search_detail.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_search_detail.html 640 2014-10-24 08:07:50Z ivis $          -->
+<!--// $Id: repository_item_search_detail.html 41035 2014-09-05 06:06:29Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_search_keyword.html b/repository/templates/default/repository_item_search_keyword.html
index fa2ed6c..6ed05d1 100644
--- a/repository/templates/default/repository_item_search_keyword.html
+++ b/repository/templates/default/repository_item_search_keyword.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_search_keyword.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_item_search_keyword.html 31327 2014-01-30 02:20:58Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_search_mapping_type.html b/repository/templates/default/repository_item_search_mapping_type.html
index c322b75..fe50991 100644
--- a/repository/templates/default/repository_item_search_mapping_type.html
+++ b/repository/templates/default/repository_item_search_mapping_type.html
@@ -14,14 +14,14 @@
 			 </td>
 			 <td>
 			 	<label for='type<{$id}>_2'>
-					<input type='checkbox' id='type<{$id}>_2' value='DepartmentalBulletinPaper' ><span id='type_list<{$id}>_2'>DepartmentalBulletin Paper</span>
+					<input type='checkbox' id='type<{$id}>_2' value='DepartmentalBulletinPaper' ><span id='type_list<{$id}>_2'>Departmental Bulletin Paper</span>
 				</label>
 			 </td>
 		   </tr>
 		   <tr>
 			 <td>
 			 	<label for='type<{$id}>_3'>
-					<input type='checkbox' id='type<{$id}>_3' value='ConferencePaper' ><span id='type_list<{$id}>_3'>ConferencePaper</span>
+					<input type='checkbox' id='type<{$id}>_3' value='ConferencePaper' ><span id='type_list<{$id}>_3'>Conference Paper</span>
 				</label>
 			 </td>
 			 <td>
@@ -38,12 +38,12 @@
 		   <tr>
 			 <td>
 			 	<label for='type<{$id}>_6'>
-					<input type='checkbox' id='type<{$id}>_6' value='TechnicalReport' ><span id='type_list<{$id}>_6'>TechnicalReport</span>
+					<input type='checkbox' id='type<{$id}>_6' value='TechnicalReport' ><span id='type_list<{$id}>_6'>Technical Report</span>
 				</label>
 			 </td>
 			 <td>
 			 	<label for='type<{$id}>_7'>
-					<input type='checkbox' id='type<{$id}>_7' value='ResearchPaper' ><span id='type_list<{$id}>_7'>ResearchPaper</span>
+					<input type='checkbox' id='type<{$id}>_7' value='ResearchPaper' ><span id='type_list<{$id}>_7'>Research Paper</span>
 				</label>
 			 </td>
 			 <td>
diff --git a/repository/templates/default/repository_item_search_result.html b/repository/templates/default/repository_item_search_result.html
index d5284ae..1844e0a 100644
--- a/repository/templates/default/repository_item_search_result.html
+++ b/repository/templates/default/repository_item_search_result.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_search_result.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_item_search_result.html 47574 2015-02-02 07:33:54Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -282,20 +282,6 @@
 		</div><!-- // item_title -->
     </div><!-- // list_title_line -->
     
-    <{* Add alternative language setting 2009/08/12 A.Suzuki --start-- *}>
-    <{* 他言語タイトル *}>
-    <{if $action.alter_flg == "1" && $action.array_title[$loop_item] != "" && $action.array_title_english[$loop_item] != ""}>
-     <div class="pd05">
-      <{if $smarty.session._lang=="japanese"}>
-       <{$action.array_title_english[$loop_item]}>
-      <{else}>
-       <{$action.array_title[$loop_item]}>
-      <{/if}>
-      <br/>
-     </div>
-    <{/if}>
-    <{* Add alternative language setting 2009/08/12 A.Suzuki --end-- *}>
-    
     <{* 属性値 *}>
      <{* 改行分 *}>
      <{foreach from=$action.array_item_attr_list[$loop_item] item=list_data name=loop_list}>
@@ -318,7 +304,7 @@
              <{if $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][0]=="link"}>
                <a href="<{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[0]}>" target="_blank"><{if $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[1] != ""}><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[1]}><{else}><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[0]}><{/if}></a>
              <{elseif $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][0]=="name"}>
-               <a href="" id="searchAuthor<{$id}>_<{$loop_item}>_<{$loop_list}>_<{$loop_attr}>_<{$loop_str}>" onclick="javascript: redirectAuthorSearch<{$id}>('searchAuthor<{$id}>_<{$loop_item}>_<{$loop_list}>_<{$loop_attr}>_<{$loop_str}>'); return false; " ><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value}></a>
+               <a href="<{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].url}>" ><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value}></a>
              <{elseif $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][0]=="textarea"}>
 	             <{section name=i loop=$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value}>
 		             <{if $smarty.section.i.index!=0}><br/><{/if}>
diff --git a/repository/templates/default/repository_item_search_select_index_name_list.html b/repository/templates/default/repository_item_search_select_index_name_list.html
index 1920e0a..0703b64 100644
--- a/repository/templates/default/repository_item_search_select_index_name_list.html
+++ b/repository/templates/default/repository_item_search_select_index_name_list.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_search_select_index_name_list.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_item_search_select_index_name_list.html 22709 2013-05-17 06:39:14Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_search_tree.html b/repository/templates/default/repository_item_search_tree.html
index ec92050..b0d86d7 100644
--- a/repository/templates/default/repository_item_search_tree.html
+++ b/repository/templates/default/repository_item_search_tree.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_search_tree.html 663 2014-12-18 02:25:06Z ivis $          -->
+<!--// $Id: repository_item_search_tree.html 44638 2014-12-02 11:56:59Z tatsuya_koyasu $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_select_type.html b/repository/templates/default/repository_item_select_type.html
index ddd916b..43eac9f 100644
--- a/repository/templates/default/repository_item_select_type.html
+++ b/repository/templates/default/repository_item_select_type.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_select_type.html 600 2014-08-06 04:41:16Z ivis $          -->
+<!--// $Id: repository_item_select_type.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -11,7 +11,6 @@
 <!--// ---------------------------------------------------------------------->
 
 <div class="mt10">
-	
 	<div>
 		<table align="center">
 			<{* HELP *}>
@@ -28,46 +27,99 @@
 			<{* FLOW *}>
 			<tr>
 				<td align="center">
-					<{if $smarty.session._lang == "japanese"}>
-						<{if $action.itemtype_file[0]=="0"}>
-							<img id="fileImg<{$id}>_JPN" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
-							<img id="fileImg<{$id}>_JPN_DOI" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
-							<img id="fileImg<{$id}>_JPN_NO" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
-						<{elseif $action.itemtype_data[0][2]=="1"}>
-							<img id="fileImg<{$id}>_JPN" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
-							<img id="fileImg<{$id}>_JPN_DOI" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
-							<img id="fileImg<{$id}>_JPN_NO" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
-						<{else}>
-							<img id="fileImg<{$id}>_JPN" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
-							<img id="fileImg<{$id}>_JPN_DOI" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
-							<img id="fileImg<{$id}>_JPN_NO" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
-						<{/if}>
-					<{else}>
-						<{if $action.itemtype_file[0]=="0"}>
-							<img id="fileImg<{$id}>_ENG" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
-							<img id="fileImg<{$id}>_ENG_DOI" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
-							<img id="fileImg<{$id}>_ENG_NO" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
-						<{elseif $action.itemtype_data[0][2]=="true"}>
-							<img id="fileImg<{$id}>_ENG" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
-							<img id="fileImg<{$id}>_ENG_DOI" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
-							<img id="fileImg<{$id}>_ENG_NO" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
-						<{else}>
-							<img id="fileImg<{$id}>_ENG" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
-							<img id="fileImg<{$id}>_ENG_DOI" style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
-							<img id="fileImg<{$id}>_ENG_NO"style="display:none" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
-						<{/if}>
-					<{/if}>
+                    <{if $smarty.session._lang == "japanese"}>
+                        <{if $action.itemtype_file[0]=="0" &&  $action.itemtype_data[0][2]=="1"}>
+                            <img id="fileImg<{$id}>_JPN" style="display:none" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
+                            <img id="fileImg<{$id}>_JPN_DOI" style="display:none" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO" style="display:none" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1.png" />
+                        <{elseif $action.itemtype_file[0]=="0"}>
+                            <img id="fileImg<{$id}>_JPN" style="display:none" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
+                            <img id="fileImg<{$id}>_JPN_DOI" style="display:none" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" style="display:none" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1.png" />
+                        <{elseif $action.itemtype_data[0][2]=="1"}>
+                            <img id="fileImg<{$id}>_JPN" style="display:none" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
+                            <img id="fileImg<{$id}>_JPN_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO" style="display:none" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" style="display:none" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_JPN" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1.png" />
+                            <img id="fileImg<{$id}>_JPN_DOI" style="display:none" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO" style="display:none" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1.png" />
+                            <img id="fileImg<{$id}>_JPN_NO_DOI" style="display:none" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1.png" />
+                        <{/if}>
+                    <{else}>
+                        <{if $action.itemtype_file[0]=="0" && $action.itemtype_data[0][2]=="1"}>
+                            <img id="fileImg<{$id}>_ENG" style="display:none" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_DOI" style="display:none" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO" style="display:none" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1_eng.png" />
+                        <{elseif $action.itemtype_file[0]=="0"}>
+                            <img id="fileImg<{$id}>_ENG" style="display:none" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_DOI" style="display:none" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" style="display:none" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1_eng.png" />
+                        <{elseif $action.itemtype_data[0][2]=="1"}>
+                            <img id="fileImg<{$id}>_ENG" style="display:none" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_DOI" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO" style="display:none" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" style="display:none" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1_eng.png" />
+                        <{else}>
+                            <img id="fileImg<{$id}>_ENG" usemap="#flowImgMap<{$id}>" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_DOI" style="display:none" usemap="#flowImgMap<{$id}>_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_doi_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO" style="display:none" usemap="#flowImgMap<{$id}>_no" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_1_eng.png" />
+                            <img id="fileImg<{$id}>_ENG_NO_DOI" style="display:none" usemap="#flowImgMap<{$id}>_no_doi" src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_select_type_no_file_doi_1_eng.png" />
+                        <{/if}>
+                    <{/if}>
+                    <map name="flowImgMap<{$id}>">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_doi">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('files'); return false;" title="<{$lang.repository_item_editfiles}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,692,37,700,19,700,18,692,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="692,0,700,18,700,19,692,37,841,37,841,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,561,37,561,0">
+                    </map>
+                    <map name="flowImgMap<{$id}>_no_doi">
+                        <{*<area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('selecttype'); return false;" title="<{$lang.repository_item_selecttype}>" style="cursor: pointer;" shape="poly" coords="0,0,0,37,132,37,140,19,140,18,132,0">*}>
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('texts'); return false;" title="<{$lang.repository_item_edittexts}>" style="cursor: pointer;" shape="poly" coords="132,0,140,18,140,19,132,37,272,37,280,19,280,18,272,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('links'); return false;" title="<{$lang.repository_item_editlinks}>" style="cursor: pointer;" shape="poly" coords="272,0,280,18,280,19,272,37,412,37,420,19,420,18,412,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('doi'); return false;" title="<{$lang.repository_item_add_doi}>" style="cursor: pointer;" shape="poly" coords="412,0,420,18,420,19,412,37,552,37,560,19,560,18,552,0">
+                        <area onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('confirm'); return false;" title="<{$lang.repository_item_confirm}>" style="cursor: pointer;" shape="poly" coords="552,0,560,18,560,19,552,37,701,37,701,0">
+                    </map>
 				</td>
 			</tr>
 		</table>
 	</div>
 	
 <div align="center" class="text_color">
-  
-	<p class="error_meg">
-		
-		<{$action.error_msg}>
-	</p>
+    <{if $action.errMsg != null && count($action.errMsg) > 0}>
+    <div class="error_msg al">
+        <{foreach from=$action.errMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
+    <{if $action.warningMsg != null && count($action.warningMsg) > 0}>
+    <div class="warning_msg al">
+        <{foreach from=$action.warningMsg item=msg}>
+        <{$msg|smarty:nodefaults}><br/>
+        <{/foreach}>
+    </div>
+    <{/if}>
 
   <div class="paging">
     <{$lang.repository_item_msg_selecttype}>
@@ -85,11 +137,13 @@
   </div>
 </div>
 
-<div align=center class="paging">
-  <form onsubmit="return false;">
-	<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemEditFiles(); return false;" />
-  </form>
-</div>
+<{if $action.itemtype_data|@count > 0}>
+ <div align=center class="paging">
+   <form onsubmit="return false;">
+	<input type="button" class="btn_next" value="<{$lang.repository_page_next}>" onclick="repositoryCls['<{$id}>'].repositoryItemSelectType('next'); return false;" />
+   </form>
+ </div>
+<{/if}>
 
 </div>
 
@@ -110,33 +164,46 @@
     imgFlowFile = new Object();
     imgFlowFileNo = new Object();
     imgFlowDoi = new Object();
+    imgFlowFileNoDoi = new Object();
     <{if $smarty.session._lang == "japanese"}>
         imgFlowFile = $('fileImg<{$id}>_JPN');
         imgFlowFileNo = $('fileImg<{$id}>_JPN_NO');
         imgFlowDoi = $('fileImg<{$id}>_JPN_DOI');
+        imgFlowFileNoDoi = $('fileImg<{$id}>_JPN_NO_DOI');
     <{else}>
         imgFlowFile = $('fileImg<{$id}>_ENG');
         imgFlowFileNo = $('fileImg<{$id}>_ENG_NO');
         imgFlowDoi = $('fileImg<{$id}>_ENG_DOI');
+        imgFlowFileNoDoi = $('fileImg<{$id}>_ENG_NO_DOI');
     <{/if}>
     
-    if( attrfile[idx] != "1" )
+    if( attrfile[idx] != "1" && doigrant[idx] == "1")
+    {
+        imgFlowFile.style.display = "none";
+        imgFlowFileNo.style.display = "none";
+        imgFlowDoi.style.display = "none";
+        imgFlowFileNoDoi.style.display = "";
+    }
+    else if( attrfile[idx] != "1" )
     {
         imgFlowFile.style.display = "none";
         imgFlowFileNo.style.display = "";
         imgFlowDoi.style.display = "none";
+        imgFlowFileNoDoi.style.display = "none";
     }
     else if( doigrant[idx] == "1" )
     {
         imgFlowFile.style.display = "none";
         imgFlowFileNo.style.display = "none";
         imgFlowDoi.style.display = "";
+        imgFlowFileNoDoi.style.display = "none";
     }
     else
     {
         imgFlowFile.style.display = "";
         imgFlowFileNo.style.display = "none";
         imgFlowDoi.style.display = "none";
+        imgFlowFileNoDoi.style.display = "none";
     }
   }
 </script>
diff --git a/repository/templates/default/repository_item_setting.html b/repository/templates/default/repository_item_setting.html
index dfb7930..5d5cbb9 100644
--- a/repository/templates/default/repository_item_setting.html
+++ b/repository/templates/default/repository_item_setting.html
@@ -12,16 +12,52 @@
 <{strip}>
 	<{if $action.authCheckFlg==true}>
 	<div class="mt10 min-w1000px">
-		<div id="repo_side_navi" class="fl">
-			<div id="repository_index_tree">
+		
+		<{if $action.errMsg != null  && count($action.errMsg) > 0 }>
+		<p class="error_msg">
+			<span class="red">
+				<{foreach from=$action.errMsg item=msg}>
+					<{$msg|smarty:nodefaults}><br/>
+				<{/foreach}>
+			</span>
+		</p>
+		<{/if}>
+		
+		<div id="repo_side_navi" class="fl" style="width: <{$smarty.const._SNIPPET_WIDTH}>px; overflow:auto;">
+			<!-- キーワード検索 -->
+			<div id="_repository_keyword"  style="display:none;">
+				<h3 id="item_setting<{$id}>_title" class="th_repos_title_bar nc_block_title c"><span class="pl05"><{$lang.repository_admin_keyword_search}></span></h3>
+				<form name="id_form_search_delete_search_keyword" name="form_search_delete_search_keyword" method="post">
+					<div class="plr05 ptb10">
+						<div class="keyword_bk">
+							<em>
+								<input type="text" class="<{if $smarty.session._lang == "japanese"}>keyword_text<{else}>keyword_text_eng<{/if}>" onkeypress="return clickSearch<{$id}>(event);" name="search_keyword" id="id_search_delete_keyword<{$id}>" value="<{$action.searchkeywordForDelete}>">
+							</em>
+						</div>
+						<input type="text" name="dummy" style="position:absolute;visibility:hidden">
+						<div class="fl">
+							<input type="button" class="btn_blue mg00" value="<{$lang.repository_search_start}>" onclick="repositorySearchKeyword( encodeURIComponent($('id_search_delete_keyword<{$id}>').value)); return false;">
+						</div>
+						<div class="clear">
+							<label for="search_type_simple"><input type="radio" name="search_type<{$id}>" id="search_type_simple" value="simple" <{if $action.search_type=="simple"}>checked<{/if}>><{$lang.repository_search_type_simple}></label>&nbsp;
+							<label for="search_type_detail"><input type="radio" name="search_type<{$id}>" id="search_type_detail" value="detail" <{if $action.search_type!="simple"}>checked<{/if}>><{$lang.repository_search_type_detail}></label><br/>
+						</div>
+					</div>
+				</form>
+			</div>
+			<!-- キーワード検索 -->
+			<!-- インデックスツリー -->
+			<div id="repository_index_tree" style="display:none;">
 				<h3 id="item_setting<{$id}>_title" class="th_repos_title_bar nc_block_title c"><span class="pl05"><{$lang.repository_index_tree}></span></h3>
 				<div>
-					<div class="th_classic_content content" id="itemSettingTree<{$id}>panel" style="width: <{$smarty.const._SNIPPET_WIDTH}>px; overflow:auto;"></div>
+					<div class="th_classic_content content" id="itemSettingTree<{$id}>panel">
 					<{include file="repository_item_search_tree.html"}>
+					</div>
 				</div>
 			</div>
+			<!-- インデックスツリー -->
 		</div>
-
+		
 	    <div id="item_setting<{$id}>_tabs_id" class="repository_right_header pr05">
 			<div class="comp_tabset"></div>
 			<div class="comp_tabset_content">
@@ -32,18 +68,38 @@
 					<{include file="repository_item_embargo.html"}>
 				</div>
 				<div class="th_classic_content content text_color" id="itemSettingTab3" align="center">
-					<{include file="repository_item_listdelete.html"}>
+					<{if strlen($action.meta) > 0 || strlen($action.all) > 0 || strlen($action.searchkeywordForDelete) > 0 }>
+						<{include file="repository_item_searchdelete.html"}>
+					<{elseif $action.sortIndexId != 0 }>
+						<{include file="repository_item_listdelete.html"}>
+					<{else}>
+						<{if $smarty.session._lang=="japanese" && $action.help_icon_display == "1"}>
+							<div class="fr">
+								<a style="cursor: help;" onclick="repositoryCls['<{$id}>'].repositoryHelp(event,'item_doibulkgrant'); return false;" href="#">
+									<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/default/help.png" alt="help">
+								</a>
+							</div>
+						<{/if}>
+						<div style="height: 40px;">
+							<font style="color:#f00;"><{$lang.repository_item_listdelete_selsect_index_or_search_keyword}></font>
+						</div>
+					<{/if}>
 				</div>
+				
 				<div class="th_classic_content content text_color" id="itemSettingTab4" align="center">
 					<{include file="repository_item_doi.html"}>
 				</div>
+				
 			</div>
 			<input type="hidden" value="0" id="item_setting_active_tab_id" />
-
 		</div>
 	</div>
 	<{else}>
-		<{$lang._invalid_auth}>
+		<p class="error_msg">
+			<span class="red">
+				<{$lang._invalid_auth}>
+			</span>
+		</p>
 	<{/if}>
 <{/strip}>
 <{include file="repository_script.html"}>
@@ -54,21 +110,25 @@
 		var active_tab = "item_setting_active_tab_id";
 		$(active_tab).value = 0;
 		initSettingTree<{$id}>(1);
+		changeSideDiv<{$id}>(1);
 	}
 	changeActiveTab2 = function(){
 		var active_tab = "item_setting_active_tab_id";
 		$(active_tab).value = 1;
 		initSettingTree<{$id}>(2);
+		changeSideDiv<{$id}>(2);
 	}
 	changeActiveTab3 = function(){
 		var active_tab = "item_setting_active_tab_id";
 		$(active_tab).value = 2;
 		initSettingTree<{$id}>(3);
+		changeSideDiv<{$id}>(3);
 	}
 	changeActiveTab4 = function(){
 		var active_tab = "item_setting_active_tab_id";
 		$(active_tab).value = 3;
 		initSettingTree<{$id}>(4);
+		changeSideDiv<{$id}>(4);
 	}
 
 	initSettingTree<{$id}> = function(num){
@@ -94,6 +154,20 @@
 
 		$('itemSettingTree<{$id}>panel').style.width = <{$smarty.const._SNIPPET_WIDTH}>+"px";
 	}
+	
+	changeSideDiv<{$id}> = function(tabNumber){
+		
+		if( tabNumber == 3 ){
+			document.getElementById("repository_index_tree").style.display="block";
+			document.getElementById("_repository_keyword").style.display="block";
+		}
+		else
+		{
+			document.getElementById("repository_index_tree").style.display="block";
+			document.getElementById("_repository_keyword").style.display="none";
+		}
+	}
+	
 </script>
 
 <script class="nc_script" type="text/javascript">
@@ -168,4 +242,31 @@
 		}
 	}
 </script>
-
+<script class="nc_script" type="text/javascript">
+	repositorySearchKeyword = function(keyword){
+		var search_type = "";
+		var radioList = document.getElementsByName("search_type<{$id}>");
+		for(var i=0; i<radioList.length; i++){
+			if (radioList[i].checked) {
+				search_type = radioList[i].value;
+				break;
+			}
+		}
+		
+		if( search_type == "simple" ){
+			commonCls.sendView('<{$id}>', {'action':'repository_view_edit_item_setting',  'item_setting_active_tab':2, 'meta':keyword });
+		}
+		else{
+			commonCls.sendView('<{$id}>', {'action':'repository_view_edit_item_setting',  'item_setting_active_tab':2, 'all':keyword });
+		}
+	}
+</script>
+<script class="nc_script" type="text/javascript">
+	clickSearch<{$id}> = function(event) {
+		if ( event.keyCode == 13 ) {
+			// push key is 'enter'
+			repositorySearchKeyword( encodeURIComponent($('id_search_delete_keyword<{$id}>').value));
+			return false;
+		}
+	}
+</script>
diff --git a/repository/templates/default/repository_item_snippet.html b/repository/templates/default/repository_item_snippet.html
index 47c8a21..28b47b1 100644
--- a/repository/templates/default/repository_item_snippet.html
+++ b/repository/templates/default/repository_item_snippet.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_snippet.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_item_snippet.html 31729 2014-02-18 00:32:14Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_confirm.html b/repository/templates/default/repository_item_type_confirm.html
index ee3930d..df13bee 100644
--- a/repository/templates/default/repository_item_type_confirm.html
+++ b/repository/templates/default/repository_item_type_confirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_confirm.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_item_type_confirm.html 24559 2013-08-02 00:47:17Z koji_matsuo $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_edit.html b/repository/templates/default/repository_item_type_edit.html
index 8c7aedb..fc0fd4f 100644
--- a/repository/templates/default/repository_item_type_edit.html
+++ b/repository/templates/default/repository_item_type_edit.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_edit.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: repository_item_type_edit.html 36229 2014-05-26 05:49:55Z satoshi_arata $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_icon.html b/repository/templates/default/repository_item_type_icon.html
index d2edea3..ed2281c 100644
--- a/repository/templates/default/repository_item_type_icon.html
+++ b/repository/templates/default/repository_item_type_icon.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_icon.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_item_type_icon.html 30442 2014-01-07 02:32:23Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_importconfirm.html b/repository/templates/default/repository_item_type_importconfirm.html
index f55c5b8..450a6f9 100644
--- a/repository/templates/default/repository_item_type_importconfirm.html
+++ b/repository/templates/default/repository_item_type_importconfirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_importconfirm.html 270 2009-01-21 04:50:41Z ivis $          -->
+<!--// $Id: repository_item_type_importconfirm.html 4 2010-02-02 05:28:03Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_mapping.html b/repository/templates/default/repository_item_type_mapping.html
index c10be3b..bf073cb 100644
--- a/repository/templates/default/repository_item_type_mapping.html
+++ b/repository/templates/default/repository_item_type_mapping.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_mapping.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: repository_item_type_mapping.html 47653 2015-02-03 05:28:56Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -12,29 +12,29 @@
 <div class="mt10">
 <{*アイテムタイプマッピング設定*}>
 
-	<table class="box_center">
-		<{*ヘルプ*}>
-		<{if $smarty.session._lang=="japanese" && $action.help_icon_display == "1"}>
-			<tr>
-				<td align="right" class="ptb10">
-					<div>
-						<a href="#" onclick="repositoryCls['<{$id}>'].repositoryHelp(event,'itemtype_mapping'); return false;" style="cursor: help;">
-							<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/default/help.png" align="right" alt="help">
-						</a>
-					</div>
-				</td>
-			</tr>
-		<{/if}>
-		<tr>
-			<td>
-				 <{if $smarty.session._lang == "japanese"}>
-					<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_type_settings5.png" />
-				 <{else}>
-					<img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_type_settings5_eng.png" />
-				 <{/if}>
-			</td>
-		</tr>
-	</table>
+    <table class="box_center">
+        <{*ヘルプ*}>
+        <{if $smarty.session._lang=="japanese" && $action.help_icon_display == "1"}>
+            <tr>
+                <td align="right" class="ptb10">
+                    <div>
+                        <a href="#" onclick="repositoryCls['<{$id}>'].repositoryHelp(event,'itemtype_mapping'); return false;" style="cursor: help;">
+                            <img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/default/help.png" align="right" alt="help">
+                        </a>
+                    </div>
+                </td>
+            </tr>
+        <{/if}>
+        <tr>
+            <td>
+                 <{if $smarty.session._lang == "japanese"}>
+                    <img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_type_settings5.png" />
+                 <{else}>
+                    <img src="<{$smarty.const.CORE_BASE_URL}>/images/repository/<{$action.wekoThemeName}>/item_type_settings5_eng.png" />
+                 <{/if}>
+            </td>
+        </tr>
+    </table>
 
 <form name="mapping" method="post">
 
@@ -78,22 +78,24 @@
 <{*jin del*}>
 
 <div class="paging text_color mr10 ml10" align="center">
-  <table id="mapping_table" class="tb01 ac full">
-    <col align="left">
-    <col align="left">
+  <table id="mapping_table" class="tb01 ac">
+    <col align="left" width="100px">
     <col align="left" width="100px">
     <col align="left" width="120px">
-    <col align="left" width="200px">
-    <col align="left" width="50px">
+    <col align="left" width="300px">
    <tr>
     <{*どこまで表示するかはまた裁量による*}>
     <th class="item_edit_list ac"><{$lang.repository_mapping_name}></th>
     <th class="item_edit_list ac"><{$lang.repository_mapping_inputtype}></th>
     <th class="item_edit_list ac"><{$lang.repository_mapping_dublincore}></th>
-    <th class="item_edit_list ac"><{$lang.repository_mapping_junii2}></th>
-    <th class="item_edit_list ac"><{$lang.repository_lom_LearningObjectMetadata}></th>
-    <th class="item_edit_list ac"><{$lang.repository_mapping_lido}></th>
-	<th class="item_edit_list ac"><{$lang.repository_mapping_language}></th>
+    <th class="item_edit_list ac">
+        <select id="typeSelector" onchange="changeColumns<{$id}>();">
+            <option selected><{$lang.repository_mapping_junii2}></option>
+            <option><{$lang.repository_lom_LearningObjectMetadata}></option>
+            <option><{$lang.repository_mapping_lido}></option>
+        </select>
+    </th>
+    <th class="item_edit_list ac"><{$lang.repository_mapping_language}></th>
    </tr>
    <{*基本データ*}>
    <{*タイトル*}>
@@ -101,60 +103,60 @@
     <td class="item_edit_list al"><{$lang.repository_title}></td>
     <td class="item_edit_list al"><{$lang.repository_text}></td>
     <td class="item_edit_list al"><{$lang.repository_dublin_core_title}></td>
-    <td class="item_edit_list al"><{$lang.repository_junii2_title}>/<{$lang.repository_junii2_alternative}></td>
-    <td class="item_edit_list al">generalTitle</td>
-    <td class="item_edit_list al"><{$lang.repository_lido_title}></td>
-    <td class="item_edit_list al"><{$lang.repository_language_ja}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>"><{$lang.repository_junii2_title}>/<{$lang.repository_junii2_alternative}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">generalTitle</td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;"><{$lang.repository_lido_title}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>"><{$lang.repository_language_ja}></td>
    </tr>
    <{*タイトル(英)*}>
    <tr>
     <td class="item_edit_list al"><{$lang.repository_title_english}></td>
     <td class="item_edit_list al"><{$lang.repository_text}></td>
     <td class="item_edit_list al"><{$lang.repository_dublin_core_title}></td>
-    <td class="item_edit_list al"><{$lang.repository_junii2_title}>/<{$lang.repository_junii2_alternative}></td>
-    <td class="item_edit_list al">generalTitle</td>
-    <td class="item_edit_list al"><{$lang.repository_lido_title}></td>
-    <td class="item_edit_list al"><{$lang.repository_language_en}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>"><{$lang.repository_junii2_title}>/<{$lang.repository_junii2_alternative}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">generalTitle</td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;"><{$lang.repository_lido_title}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>"><{$lang.repository_language_en}></td>
    </tr>
    <{*言語*}>
    <tr>
     <td class="item_edit_list al"><{$lang.repository_language}></td>
     <td class="item_edit_list al"><{$lang.repository_attribute_type_pulldown}></td>
     <td class="item_edit_list al"><{$lang.repository_dublin_core_language}></td>
-    <td class="item_edit_list al"><{$lang.repository_junii2_language}></td>
-    <td class="item_edit_list al">generalLanguage</td>
-    <td class="item_edit_list al"><{$lang.repository_lido_no_setting}></td>
-    <td class="item_edit_list al"><{$lang.repository_language_no_mapping}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>"><{$lang.repository_junii2_language}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">generalLanguage</td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;"><{$lang.repository_lido_no_setting}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>"><{$lang.repository_language_no_mapping}></td>
    </tr>
    <{*公開日*}>
    <tr>
     <td class="item_edit_list al"><{$lang.repository_pub_date}></td>
     <td class="item_edit_list al"><{$lang.repository_attribute_type_date}></td>
     <td class="item_edit_list al"><{$lang.repository_dublin_core_date}></td>
-    <td class="item_edit_list al"><{$lang.repository_junii2_date}></td>
-    <td class="item_edit_list al">lifeCycleContribute</td>
-    <td class="item_edit_list al"><{$lang.repository_lido_no_setting}></td>
-    <td class="item_edit_list al"><{$lang.repository_language_no_mapping}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>"><{$lang.repository_junii2_date}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">lifeCycleContribute</td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;"><{$lang.repository_lido_no_setting}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>"><{$lang.repository_language_no_mapping}></td>
    </tr>
    <{*キーワード*}>
    <tr>
     <td class="item_edit_list al"><{$lang.repository_keyword}></td>
     <td class="item_edit_list al"><{$lang.repository_text}></td>
     <td class="item_edit_list al"><{$lang.repository_dublin_core_subject}></td>
-    <td class="item_edit_list al"><{$lang.repository_junii2_subject}></td>
-    <td class="item_edit_list al">generalKeyword</td>
-    <td class="item_edit_list al"><{$lang.repository_lido_keyword}></td>
-    <td class="item_edit_list al"><{$lang.repository_language_ja}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>"><{$lang.repository_junii2_subject}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">generalKeyword</td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;"><{$lang.repository_lido_keyword}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>"><{$lang.repository_language_ja}></td>
    </tr>
    <{*キーワード(英)*}>
    <tr>
     <td class="item_edit_list al"><{$lang.repository_keyword_english}></td>
     <td class="item_edit_list al"><{$lang.repository_text}></td>
     <td class="item_edit_list al"><{$lang.repository_dublin_core_subject}></td>
-    <td class="item_edit_list al"><{$lang.repository_junii2_subject}></td>
-    <td class="item_edit_list al">generalKeyword</td>
-    <td class="item_edit_list al"><{$lang.repository_lido_keyword}></td>
-    <td class="item_edit_list al"><{$lang.repository_language_en}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>"><{$lang.repository_junii2_subject}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">generalKeyword</td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;"><{$lang.repository_lido_keyword}></td>
+    <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>"><{$lang.repository_language_en}></td>
    </tr>
    
    <{if count($smarty.session.metadata_table)!=0}>
@@ -169,95 +171,95 @@
        <input type="hidden" name="dublin_core[]" value="identifier"/>identifier
       </td>
       <{*書誌情報のJuNii2は固定*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <input type="hidden" name="junii2[]" value="jtitle"/>jtitle
       </td>
       <{*書誌情報のLOMは固定*}>
-      <td class="item_edit_list al" rowspan="7">
+      <td class="item_edit_list al" rowspan="7" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">
        <input type="hidden" name="lom[]" value="generalIdentifier"/>generalIdentifier
       </td>
       <{*書誌情報のLIDOは固定*}>
-      <td class="item_edit_list al" rowspan="7">
+      <td class="item_edit_list al" rowspan="7" name="display_<{$lang.repository_mapping_lido}>" style="display: none;">
        <input type="hidden" name="lido[]" value="0"/><{$lang.repository_lido_no_setting}>
       </td>
-	  <{*書誌情報の表示言語は固定*}>
-	  <td class="item_edit_list al">
-	   <input type="hidden" name="disp_lang[]" value="japanese"/><{$lang.repository_language_ja}>
-	  </td>
+      <{*書誌情報の表示言語は固定*}>
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+       <input type="hidden" name="disp_lang[]" value="japanese"/><{$lang.repository_language_ja}>
+      </td>
      </tr>
      
-		<{*雑誌名(英)*}>
-		<tr>
-		 <td class="item_edit_list al"><{$lang.repository_item_biblio_name_english}></td>
-		 <{*書誌情報のJuNii2は固定*}>
-		 <td class="item_edit_list al">
-		  <input type="hidden" name="junii2[]" value="jtitle"/>jtitle
-		 </td>
-		<{*書誌情報の表示言語は固定*}>
-		 <td class="item_edit_list al">
-		 <input type="hidden" name="disp_lang[]" value="english"/><{$lang.repository_language_en}>
-		 </td>
-		</tr>
+        <{*雑誌名(英)*}>
+        <tr>
+         <td class="item_edit_list al"><{$lang.repository_item_biblio_name_english}></td>
+         <{*書誌情報のJuNii2は固定*}>
+         <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
+          <input type="hidden" name="junii2[]" value="jtitle"/>jtitle
+         </td>
+        <{*書誌情報の表示言語は固定*}>
+         <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+         <input type="hidden" name="disp_lang[]" value="english"/><{$lang.repository_language_en}>
+         </td>
+        </tr>
 
      <{*巻*}>
      <tr>
       <td class="item_edit_list al"><{$lang.repository_item_biblio_volume}></td>
       <{*書誌情報のJuNii2は固定*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <input type="hidden" name="junii2[]" value="volume"/>volume
       </td>
-		<{*書誌情報の表示言語は固定*}>
-		<td class="item_edit_list al">
-		 <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
-		</td>
+        <{*書誌情報の表示言語は固定*}>
+        <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+         <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
+        </td>
      </tr>
      <{*号*}>
      <tr>
       <td class="item_edit_list al"><{$lang.repository_item_biblio_issue}></td>
       <{*書誌情報のJuNii2は固定*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <input type="hidden" name="junii2[]" value="issue"/>issue
       </td>
-		<{*書誌情報の表示言語は固定*}>
-		<td class="item_edit_list al">
-		 <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
-		</td>
+        <{*書誌情報の表示言語は固定*}>
+        <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+         <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
+        </td>
      </tr>
      <{*開始ページ*}>
      <tr>
       <td class="item_edit_list al"><{$lang.repository_item_biblio_spage}></td>
       <{*書誌情報のJuNii2は固定*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <input type="hidden" name="junii2[]" value="spage"/>spage
       </td>
-		<{*書誌情報の表示言語は固定*}>
-		<td class="item_edit_list al">
-		 <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
-		</td>
+        <{*書誌情報の表示言語は固定*}>
+        <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+         <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
+        </td>
      </tr>
      <{*終了ページ*}>
      <tr>
       <td class="item_edit_list al"><{$lang.repository_item_biblio_epage}></td>
       <{*書誌情報のJuNii2は固定*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <input type="hidden" name="junii2[]" value="epage"/>epage
       </td>
-		<{*書誌情報の表示言語は固定*}>
-		<td class="item_edit_list al">
-		 <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
-		</td>
+        <{*書誌情報の表示言語は固定*}>
+        <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+         <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
+        </td>
      </tr>
      <{*発行年*}>
      <tr>
       <td class="item_edit_list al"><{$lang.repository_item_biblio_dateofissued}></td>
       <{*書誌情報のJuNii2は固定*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <input type="hidden" name="junii2[]" value="dateofissued"/>dateofissued
       </td>
-		<{*書誌情報の表示言語は固定*}>
-		<td class="item_edit_list al">
-		 <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
-		</td>
+        <{*書誌情報の表示言語は固定*}>
+        <td class="item_edit_list al" name="display_<{$lang.repository_mapping_language}>">
+         <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
+        </td>
      </tr>
    <{* 書誌情報以外 *}>
    <{else}>
@@ -311,24 +313,24 @@
                <{$metadata.dublin_core_mapping}>
            <{/if}>
        <{else}>
-	       <select class="full" name="dublin_core[]">
-	       <{foreach from=$action.dublinCoreArray item=dublinCore name=dcore}>
-	        <{* Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -start- *}>
-	        <{if $dublinCore=="0"}>
-	         <option value="0"><{$lang.repository_dublin_core_no_setting}></option>
-	        <{else}>
-	         <option value="<{$dublinCore}>" <{if $metadata.dublin_core_mapping==$dublinCore}>SELECTED<{/if}>><{$dublinCore}></option>
-	        <{/if}>
-	        <{* Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -end- *}>
-	       <{/foreach}>
-	       </select>
+           <select name="dublin_core[]" class="full">
+           <{foreach from=$action.dublinCoreArray item=dublinCore name=dcore}>
+            <{* Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -start- *}>
+            <{if $dublinCore=="0"}>
+             <option value="0"><{$lang.repository_dublin_core_no_setting}></option>
+            <{else}>
+             <option value="<{$dublinCore}>" <{if $metadata.dublin_core_mapping==$dublinCore}>SELECTED<{/if}>><{$dublinCore}></option>
+            <{/if}>
+            <{* Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -end- *}>
+           <{/foreach}>
+           </select>
        <{/if}>
       </td> 
       <{*以下のJuNii2親セレクトボックス選択時にJavascriptを呼び出し、必要に応じて子セレクトボックスを表示＆値を設定したい*}>
       <{* td bgcolor="lightgrey" width="150" *}>
       <{* select style="width:150px" name="junii2_parent[]" onChange="repositoryCls['<{$id}>'].setJunii2ChildItem(this,<{$smarty.foreach.metad.iteration-1}>,this.selectedIndex)" *}>
      
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_junii2}>">
        <{if ($smarty.session.itemtype_id == 20001 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 17) ||
             ($smarty.session.itemtype_id >= 20002 && $smarty.session.itemtype_id <= 20015 && $metadata.show_order >= 1 && $metadata.show_order <= 61) ||
             ($smarty.session.itemtype_id == 20016 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 86) || 
@@ -345,7 +347,7 @@
                <{$metadata.junii2_mapping}>
            <{/if}>
        <{else}>
-           <select class="full" name="junii2[]">
+           <select name="junii2[]" class="full">
            <{foreach from=$action.junii2Array item=junii2 name=jn2p}>
             <{* Mod insert 'undefine' to database in English 2012/02/14 T.Koyasu -start- *}>
             <{if $junii2=="0"}>
@@ -361,7 +363,7 @@
       
       
       <{* 2013/01/25 Add LOM A.Jin --start--*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_lom_LearningObjectMetadata}>" style="display: none;">
        <{if ($smarty.session.itemtype_id == 20001 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 17) ||
             ($smarty.session.itemtype_id >= 20002 && $smarty.session.itemtype_id <= 20015 && $metadata.show_order >= 1 && $metadata.show_order <= 61) ||
             ($smarty.session.itemtype_id == 20016 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 86) || 
@@ -378,7 +380,7 @@
                <{$metadata.lom_mapping}>
            <{/if}>
        <{else}>
-          <select name="lom[]" style="width: auto;">
+          <select name="lom[]" class="full">
           <{foreach from=$action.lomArray item=lom name=lomp}>
             <{if $lom=="0"}>
               <option value="0"><{$lang.repository_lom_no_setting}></option>
@@ -392,7 +394,7 @@
       <{* 2013/01/25 Add A.Jin --end--*}>
       
       <{* 2014/04/14 Add LIDO R.Matsuura --start--*}>
-      <td class="item_edit_list al">
+      <td class="item_edit_list al" name="display_<{$lang.repository_mapping_lido}>" style="display: none;">
        <{if ($smarty.session.itemtype_id == 20001 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 17) ||
             ($smarty.session.itemtype_id >= 20002 && $smarty.session.itemtype_id <= 20015 && $metadata.show_order >= 1 && $metadata.show_order <= 61) ||
             ($smarty.session.itemtype_id == 20016 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 86) || 
@@ -409,7 +411,7 @@
                <{$metadata.lido_mapping}>
            <{/if}>
        <{else}>
-          <select name="lido[]" style="width: 545px;">
+          <select name="lido[]" class="full">
           <{assign var="optgrp_flag" value="false"}>
           <{assign var="wrap_value" value=""}>
           <{foreach from=$action.lidoArray item=lido}>
@@ -439,12 +441,12 @@
       </td>
       <{* 2014/04/14 Add LIDO R.Matsuura --end--*}>
       
-		<{* 表示言語 *}>
-		<td class="item_edit_list al nobr">
-		 <{* 表示言語 "指定なし" で固定*}>
-		 <{if $metadata.input_type=="thumbnail" || $metadata.input_type=="file" || $metadata.input_type=="file_price" || $metadata.input_type=="date" || $metadata.input_type=="supple" || $metadata.input_type=="heading"}>
-		 <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
-		 <{else}>
+        <{* 表示言語 *}>
+        <td class="item_edit_list al nobr" name="display_<{$lang.repository_mapping_language}>" >
+         <{* 表示言語 "指定なし" で固定*}>
+         <{if $metadata.input_type=="thumbnail" || $metadata.input_type=="file" || $metadata.input_type=="file_price" || $metadata.input_type=="date" || $metadata.input_type=="supple" || $metadata.input_type=="heading"}>
+         <input type="hidden" name="disp_lang[]" value=" "/><{$lang.repository_language_no_mapping}>
+         <{else}>
           <{if ($smarty.session.itemtype_id == 20001 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 17) ||
             ($smarty.session.itemtype_id >= 20002 && $smarty.session.itemtype_id <= 20015 && $metadata.show_order >= 1 && $metadata.show_order <= 61) ||
             ($smarty.session.itemtype_id == 20016 && $metadata.attribute_id >= 1 && $metadata.attribute_id <= 86) || 
@@ -465,15 +467,15 @@
               <{/if}>
           
           <{else}>
-		  <select name="disp_lang[]">
-		   <{foreach from=$action.disp_lang_array item=disp_lang}>
-		    <option value="<{$disp_lang[0]}>" <{if $metadata.display_lang_type==$disp_lang[0]}>SELECTED<{/if}>><{$disp_lang[1]}></option>
-		   <{/foreach}>
-		  </select>
-		  <{/if}>
-		  
-		 <{/if}>
-		</td>
+          <select name="disp_lang[]" class="full">
+           <{foreach from=$action.disp_lang_array item=disp_lang}>
+            <option value="<{$disp_lang[0]}>" <{if $metadata.display_lang_type==$disp_lang[0]}>SELECTED<{/if}>><{$disp_lang[1]}></option>
+           <{/foreach}>
+          </select>
+          <{/if}>
+          
+         <{/if}>
+        </td>
      </tr>
     <{/if}>
    <{/foreach}>
@@ -492,3 +494,35 @@
 <{* mt10 *}>
 
 <{include file="repository_script.html"}>
+
+<script class="nc_script" type="text/javascript">
+changeColumns<{$id}> = function()
+{
+    // ヘッダ
+    var headers = ["display_<{$lang.repository_mapping_junii2}>", 
+                   "display_<{$lang.repository_lom_LearningObjectMetadata}>",
+                   "display_<{$lang.repository_mapping_lido}>"];
+    
+    // プルダウンの中身取得
+    var select = document.getElementById("typeSelector");
+    var options = document.getElementById("typeSelector").options;
+    var col = "display_" + options.item(select.selectedIndex).value;
+    
+    // すべて非表示
+    for (ii = 0; ii < headers.length; ii++)
+    {
+        elems = document.getElementsByName(headers[ii]);
+        
+        for(var jj = 0; jj < elems.length; jj++) {
+            elems[jj].style.display = "none";
+        }
+    }
+    
+    // 選択された列を表示
+    elems = document.getElementsByName(col);
+    
+    for(var ii = 0; ii < elems.length; ii++) {
+        elems[ii].style.display = "";
+    }
+}
+</script>
diff --git a/repository/templates/default/repository_item_type_mappingconfirm.html b/repository/templates/default/repository_item_type_mappingconfirm.html
index 7b515e0..3d6db18 100644
--- a/repository/templates/default/repository_item_type_mappingconfirm.html
+++ b/repository/templates/default/repository_item_type_mappingconfirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_mappingconfirm.html 599 2014-07-14 09:06:17Z ivis $          -->
+<!--// $Id: repository_item_type_mappingconfirm.html 36428 2014-05-29 04:01:44Z rei_matsuura $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_noitemtype.html b/repository/templates/default/repository_item_type_noitemtype.html
index 7b5a6ef..5045095 100644
--- a/repository/templates/default/repository_item_type_noitemtype.html
+++ b/repository/templates/default/repository_item_type_noitemtype.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_noitemtype.html 270 2009-01-21 04:50:41Z ivis $          -->
+<!--// $Id: repository_item_type_noitemtype.html 4 2010-02-02 05:28:03Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_item_type_setting.html b/repository/templates/default/repository_item_type_setting.html
index 1097827..90599c2 100644
--- a/repository/templates/default/repository_item_type_setting.html
+++ b/repository/templates/default/repository_item_type_setting.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_type_setting.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_item_type_setting.html 48517 2015-02-17 08:02:38Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -142,7 +142,7 @@
   <tr>
    <td class="ranking_list_paging" style="text-align: center;">
     <div class="ranking_list_paging" style="text-align: center;">
-     <select name="item_type_id" class="w500px">
+     <select id="item_type_id<{$id}>" name="item_type_id" class="w500px" onchange="javascript: changeItemtype<{$id}>();">
       <!-- アイテムタイプ一覧をスクリプトで登録。valueは主キー, 表示はアイテムタイプ名 -->
       <{foreach from=$action.itemtype_data item=item_type}>
        <option value="<{$item_type[0]}>" <{if $smarty.session.item_type_edit_flag==0 && count($action.itemtype_data)>12}>SELECTED<{/if}>><{$item_type[1]}></option>
@@ -160,6 +160,79 @@
     </div>
    </td>
   </tr>
+  <!-- アイテムタイプ権限管理 -->
+  <tr>
+   <table class="tb00 w500px" align="center">
+    <tr class="tree_access_control" >
+      <th class="ranking_repos ranking_paging al item_edit_list4" colspan="2"><{$lang.repository_access_role}>(<{$lang.repository_authority_base}>)</th>
+    </tr>
+    <tr class="tree_access_control">
+     <td colspan="2" class="pt00 pb00 pr00 pl00 item_edit_list4">
+      <table class="tb00 full">
+       <tr>
+        <td class="ptb04 plr08 w45 al">
+         <{$lang.repository_edittree_insert_OFF}><br/>
+         <select multiple id="itemtype_exclusive_itemtype_acl_role_name<{$id}>" class="full h10em" disabled></select>
+        </td>
+        <td class="ptb04 plr08 w10 ac" valign="middle">
+         <br/>
+         <input type="button" 
+                class="btn_white" 
+                value="&gt;&gt;" 
+                id="itemtype_acl_add_auth_btn<{$id}>" 
+                onclick="javascript: moveItemtypeACLRole<{$id}>('itemtype_exclusive_itemtype_acl_role_name<{$id}>', 'itemtype_acl_role_name<{$id}>');" disabled/><br/>
+         <br/>
+         <input type="button" 
+                class="btn_white" 
+                value="&lt;&lt;" 
+                id="itemtype_acl_del_auth_btn<{$id}>" 
+                onclick="javascript: moveItemtypeACLRole<{$id}>('itemtype_acl_role_name<{$id}>', 'itemtype_exclusive_itemtype_acl_role_name<{$id}>');" disabled/>
+         <br/>
+        </td>
+        <td class="ptb04 plr08 w45 al">
+         <{$lang.repository_edittree_insert_ON}><br/>
+         <select multiple id="itemtype_acl_role_name<{$id}>" class="full h10em" disabled></select>
+        </td>
+       </tr>
+      </table>
+     </td>
+    </tr>
+    <tr class="tree_access_control">
+     <th class="ranking_repos ranking_paging al item_edit_list4" colspan="2"><{$lang.repository_access_role}>(<{$lang.repository_authority_room}>)</th>
+    </tr>
+    <tr class="tree_access_control">
+     <td colspan="2">
+      <table class="tb00 full">
+       <tr>
+        <td class="al" colspan="3">
+         <{$lang.repository_edittree_insert_ON}>
+         </br>
+         <label>
+          <input checked="checked" type="checkbox" disabled>
+          <{$smarty.const._AUTH_CHIEF_NAME}>
+         </label>
+         <label for="itemtype_acl_room_auth<{$smarty.const._AUTH_MODERATE}><{$id}>">
+          <input id="itemtype_acl_room_auth<{$smarty.const._AUTH_MODERATE}><{$id}>" value="<{$smarty.const._ON}>" onclick="commonCls.changeAuthority(this, '<{$id}>');" type="checkbox" disabled>
+          <{$smarty.const._AUTH_MODERATE_NAME}>
+         </label>
+         <label for="itemtype_acl_room_auth<{$smarty.const._AUTH_GENERAL}><{$id}>">
+          <input id="itemtype_acl_room_auth<{$smarty.const._AUTH_GENERAL}><{$id}>" value="<{$smarty.const._ON}>" onclick="commonCls.changeAuthority(this, '<{$id}>');" type="checkbox" disabled>
+          <{$smarty.const._AUTH_GENERAL_NAME}>
+         </label>
+        </td>
+       </tr>
+      </table>
+     </td>
+    </tr>
+    <tr class="tree_access_control">
+     <td>
+      <div class="pt10 pb10 ac">
+       <input type="button" class="btn_blue" align="center" id="itemtype_send_button<{$id}>" value="<{$lang.repository_send}>" onclick="sendItemtypeACLRole<{$id}>(); return false;" disabled/>
+      </div>
+     </td>
+    </tr>
+   </table>
+  </tr>
  </table>
 </div>
     <input type="hidden" id="page_id" value="<{$page_id}>">
@@ -191,3 +264,208 @@
 	}
 </script>
 
+<script class="nc_script" type="text/javascript">
+    changeItemtype<{$id}> = function(){
+        var selects = document.getElementById("item_type_id<{$id}>");
+        var itemTypeId = selects.options[selects.selectedIndex].value;
+        // アイテムタイプの権限情報をAjaxを使って問い合わせる
+        var pars='';
+        pars =  'action=repository_action_edit_itemtype_auth_load';
+        pars += '&page_id=<{$page_id}>';
+        pars += '&block_id=<{$block_id}>';
+        pars += '&item_type_id='+itemTypeId;
+        var url = "<{$smarty.const.BASE_URL}>/index.php";
+        var myAjax = new Ajax.Request(
+                        url,
+                        {
+                            method: 'get',
+                            parameters: pars, 
+                            onComplete: function(req) {
+                                itemTypeInfo = eval("("+req.responseText+")");
+                                changeItemtypeAuthView<{$id}>(itemTypeId, itemTypeInfo);
+                            }
+                        }
+                    );
+    }
+</script>
+
+<script class="nc_script" type="text/javascript">
+    changeItemtypeAuthView<{$id}> = function(itemTypeId, itemTypeInfo){
+        // ベース権限(閲覧権限なし)
+        var exclusive_base_acl_role = document.getElementById("itemtype_exclusive_itemtype_acl_role_name<{$id}>");
+        // 現在表示されている要素をリセット
+        for(var i=exclusive_base_acl_role.childNodes.length-1; i>=0; i--) {
+            exclusive_base_acl_role.removeChild(exclusive_base_acl_role.childNodes[i]);
+        }
+        // 子要素の追加
+        for(var i=0; i < itemTypeInfo.exclusive_base_auth.length; i=i+1) {
+            for(var key in itemTypeInfo.exclusive_base_auth[i]) {
+                var option = document.createElement("option");
+                option.setAttribute("value", key);
+                if(itemTypeInfo.exclusive_base_auth[i][key] == '_AUTH_SYSADMIN_NAME'){
+                    option.text = "<{$smarty.const._AUTH_SYSADMIN_NAME}>";
+                } else if(itemTypeInfo.exclusive_base_auth[i][key] == '_AUTH_ADMIN_NAME'){
+                    option.text = "<{$smarty.const._AUTH_ADMIN_NAME}>";
+                } else if(itemTypeInfo.exclusive_base_auth[i][key] == '_AUTH_CHIEF_NAME'){
+                    option.text = "<{$smarty.const._AUTH_CHIEF_NAME}>";
+                } else if(itemTypeInfo.exclusive_base_auth[i][key] == '_AUTH_MODERATE_NAME'){
+                    option.text = "<{$smarty.const._AUTH_MODERATE_NAME}>";
+                } else if(itemTypeInfo.exclusive_base_auth[i][key] == '_AUTH_GENERAL_NAME'){
+                    option.text = "<{$smarty.const._AUTH_GENERAL_NAME}>";
+                } else if(itemTypeInfo.exclusive_base_auth[i][key] == '_AUTH_GUEST_NAME'){
+                    option.text = "<{$smarty.const._AUTH_GUEST_NAME}>";
+                } else {
+                    option.text = decodeAuthNameHtmlSpecialChars<{$id}>(itemTypeInfo.exclusive_base_auth[i][key]);
+                }
+                exclusive_base_acl_role.appendChild(option);
+            }
+        }
+        // ベース権限(閲覧権限あり)
+        var base_acl_role = document.getElementById("itemtype_acl_role_name<{$id}>");
+        // 現在表示されている要素をリセット
+        for(var i=base_acl_role.childNodes.length-1; i>=0; i--) {
+            base_acl_role.removeChild(base_acl_role.childNodes[i]);
+        }
+        // 子要素の追加
+        for(var i=0; i < itemTypeInfo.base_auth.length; i=i+1) {
+            for(var key in itemTypeInfo.base_auth[i]) {
+                var option = document.createElement("option");
+                option.setAttribute("value", key);
+                if(itemTypeInfo.base_auth[i][key] == '_AUTH_SYSADMIN_NAME'){
+                    option.text = "<{$smarty.const._AUTH_SYSADMIN_NAME}>";
+                } else if(itemTypeInfo.base_auth[i][key] == '_AUTH_ADMIN_NAME'){
+                    option.text = "<{$smarty.const._AUTH_ADMIN_NAME}>";
+                } else if(itemTypeInfo.base_auth[i][key] == '_AUTH_CHIEF_NAME'){
+                    option.text = "<{$smarty.const._AUTH_CHIEF_NAME}>";
+                } else if(itemTypeInfo.base_auth[i][key] == '_AUTH_MODERATE_NAME'){
+                    option.text = "<{$smarty.const._AUTH_MODERATE_NAME}>";
+                } else if(itemTypeInfo.base_auth[i][key] == '_AUTH_GENERAL_NAME'){
+                    option.text = "<{$smarty.const._AUTH_GENERAL_NAME}>";
+                } else if(itemTypeInfo.base_auth[i][key] == '_AUTH_GUEST_NAME'){
+                    option.text = "<{$smarty.const._AUTH_GUEST_NAME}>";
+                } else {
+                    option.text = decodeAuthNameHtmlSpecialChars<{$id}>(itemTypeInfo.base_auth[i][key]);
+                }
+                base_acl_role.appendChild(option);
+            }
+        }
+        // ルーム権限
+        var moderaterCheck = document.getElementById("itemtype_acl_room_auth<{$smarty.const._AUTH_MODERATE}><{$id}>");
+        var generalCheck = document.getElementById("itemtype_acl_room_auth<{$smarty.const._AUTH_GENERAL}><{$id}>");
+        // 現在表示されているチェック状態をリセット
+        moderaterCheck.checked = false;
+        generalCheck.checked = false;
+        // ルーム権限からチェック状態を設定
+        if(itemTypeInfo.room_auth >= 3) {
+            // 何もしない
+        } else if(itemTypeInfo.room_auth >= 2) {
+            moderaterCheck.checked = true;
+        } else if(itemTypeInfo.room_auth >= 1) {
+            moderaterCheck.checked = true;
+            generalCheck.checked = true;
+        } else {
+            moderaterCheck.checked = true;
+            generalCheck.checked = true;
+        }
+        
+        // 各フォームの使用状態を変更する
+        // ハーベスト用アイテムタイプの権限は変更不可
+        if(itemTypeId > 20000) {
+            exclusive_base_acl_role.disabled = false;
+            base_acl_role.disabled = true;
+            var addButton = document.getElementById("itemtype_acl_add_auth_btn<{$id}>");
+            addButton.disabled = true;
+            var delButton = document.getElementById("itemtype_acl_del_auth_btn<{$id}>");
+            delButton.disabled = true;
+            moderaterCheck.disabled = true;
+            generalCheck.disabled = true;
+            var sendButton = document.getElementById("itemtype_send_button<{$id}>");
+            sendButton.disabled = true;
+        } else {
+            exclusive_base_acl_role.disabled = false;
+            base_acl_role.disabled = false;
+            var addButton = document.getElementById("itemtype_acl_add_auth_btn<{$id}>");
+            addButton.disabled = false;
+            var delButton = document.getElementById("itemtype_acl_del_auth_btn<{$id}>");
+            delButton.disabled = false;
+            moderaterCheck.disabled = false;
+            generalCheck.disabled = false;
+            var sendButton = document.getElementById("itemtype_send_button<{$id}>");
+            sendButton.disabled = false;
+        }
+    }
+</script>
+
+<script class="nc_script" type="text/javascript">
+    moveItemtypeACLRole<{$id}> = function(from, to){
+        // "FROM"で選択されているオプション要素を"TO"へ移動する
+        var selectFrom = document.getElementById(from);
+        var selectTo = document.getElementById(to);
+        // 複数選択されているオプションの情報を取得
+        for(var i=selectFrom.childNodes.length-1; i>=0; i--) {
+            if(selectFrom.childNodes[i].selected == true) {
+                var tmpOption = selectFrom.childNodes[i].cloneNode();
+                tmpOption.text = selectFrom.childNodes[i].text;
+                selectTo.appendChild(tmpOption);
+                selectFrom.removeChild(selectFrom.childNodes[i]);
+            }
+        }
+    }
+</script>
+
+<script class="nc_script" type="text/javascript">
+    sendItemtypeACLRole<{$id}> = function(){
+        // 選択中のアイテムタイプ
+        var selects = document.getElementById("item_type_id<{$id}>");
+        // 除外ベース権限
+        var exclusiveBaseAuth = document.getElementById("itemtype_exclusive_itemtype_acl_role_name<{$id}>");
+        // 除外ルーム権限
+        var exclusiveRoomAuthModerater = document.getElementById("itemtype_acl_room_auth<{$smarty.const._AUTH_MODERATE}><{$id}>");
+        var exclusiveRoomAuthGeneral = document.getElementById("itemtype_acl_room_auth<{$smarty.const._AUTH_GENERAL}><{$id}>");
+        
+        // パラメータ用のデータを設定する
+        var itemTypeIdParam = "";
+        var exclusiveBaseAuthParam = "";
+        var exclusiveRoomAuthParam = "";
+        // アイテムタイプID (数値)
+        var itemTypeIdParam = selects.options[selects.selectedIndex].value;
+        // 除外ベース権限(カンマ区切りの数値)
+        for(var i=0; i < exclusiveBaseAuth.childNodes.length; i++) {
+            if(exclusiveBaseAuthParam.length > 0) {
+                exclusiveBaseAuthParam += ',';
+            }
+            exclusiveBaseAuthParam += exclusiveBaseAuth.childNodes[i].value;
+        }
+        // 除外ルーム権限(数値)
+        if(exclusiveRoomAuthModerater.checked == true && exclusiveRoomAuthGeneral.checked == true) {
+            exclusiveRoomAuthParam = 1;
+        } else if(exclusiveRoomAuthModerater.checked == true) {
+            exclusiveRoomAuthParam = 2;
+        } else {
+            exclusiveRoomAuthParam = 3;
+        }
+        
+        // アイテムタイプの権限情報をAjaxを使って問い合わせる
+        var pars='';
+        pars += '&item_type_id='+itemTypeIdParam;
+        pars += '&exclusive_base_auth='+exclusiveBaseAuthParam;
+        pars += '&exclusive_room_auth='+exclusiveRoomAuthParam;
+        repositoryCls['<{$id}>'].repositoryItemTypeAuthorityAdd(pars);
+    }
+</script>
+
+<script class="nc_script" type="text/javascript">
+    decodeAuthNameHtmlSpecialChars<{$id}> = function(str){
+        str = str.replace(/&amp;/g,"&");
+        str = str.replace(/&quot;/g,"\"");
+        str = str.replace(/&#039;/g,"'");
+        str = str.replace(/&lt;/g,"<");
+        str = str.replace(/&gt;/g,">");
+        str = str.replace(/\\/g,"\\");
+        return str;
+    }
+</script>
+
+<script class="nc_script" type="text/javascript">
+    changeItemtype<{$id}>();
+</script>
diff --git a/repository/templates/default/repository_log.html b/repository/templates/default/repository_log.html
index 1aba021..3bdeee8 100644
--- a/repository/templates/default/repository_log.html
+++ b/repository/templates/default/repository_log.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_log.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_log.html 30892 2014-01-17 08:20:21Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_mobile_item_contents.html b/repository/templates/default/repository_mobile_item_contents.html
index 8fdbeea..e92a871 100644
--- a/repository/templates/default/repository_mobile_item_contents.html
+++ b/repository/templates/default/repository_mobile_item_contents.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_item_contents.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_mobile_item_contents.html 47574 2015-02-02 07:33:54Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -226,7 +226,7 @@
                                                 <{if $k > 0}>
                                                     , 
                                                 <{/if}>
-                                                <a href="" id="searchAuthorResult<{$id}>_<{$i}>_<{$j}>_<{$k}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorResult<{$id}>_<{$i}>_<{$j}>_<{$k}>' ); return false; " >
+                                                <a href="<{$attr[k].url}>" >
                                                     <{$attr[k].family}> <{$attr[k].name}>
                                                 </a>
                                             <{/section}>
@@ -240,7 +240,7 @@
                                                 <{if $k > 0}>
                                                     , 
                                                 <{/if}>
-                                                <a href="" id="searchAuthorResult<{$id}>_<{$i}>_<{$j}>_<{$k}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorResult<{$id}>_<{$i}>_<{$j}>_<{$k}>' ); return false; " >
+                                                <a href="<{$attr[k].url}>" >
                                                     <{$attr[k].family}> <{$attr[k].name}>
                                                 </a>
                                             <{/section}>
diff --git a/repository/templates/default/repository_mobile_item_detail.html b/repository/templates/default/repository_mobile_item_detail.html
index 036831e..8942da0 100644
--- a/repository/templates/default/repository_mobile_item_detail.html
+++ b/repository/templates/default/repository_mobile_item_detail.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_item_detail.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_mobile_item_detail.html 47574 2015-02-02 07:33:54Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -563,7 +563,7 @@
                      </div>
                      <div style="text-align:left; padding-left:20px;">
                          <{if count($item_attr[i]) == 1}>
-                             <a href="" id="searchAuthorDetail<{$id}>_<{$k}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetail<{$id}>_<{$k}>' ); return false;" >
+                             <a href="<{$item_attr[i][0].url}>" >
                                  <{$item_attr[i][0].family}>
                                  <{if $item_attr[i][0].name!=""}>
                                      ,&nbsp;<{$item_attr[i][0].name}>
@@ -591,7 +591,7 @@
                                              <{$smarty.section.j.index_next}>.
                                          </td>
                                          <td style="width:100%; padding-top: 5px;">
-                                             <a href="" id="searchAuthorDetailElse<{$id}>_<{$k}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorDetailElse<{$id}>_<{$k}>' ); return false;" >
+                                             <a href="<{$item_attr[i][j].url}>" >
                                                  <{$item_attr[i][j].family}>
                                                  <{if $item_attr[i][j].name!=""}>
                                                      ,&nbsp;<{$item_attr[i][j].name}>
@@ -627,14 +627,6 @@
                     </div>
                     <div style="text-align:left; padding-left:20px;">
                         <{if count($item_attr[i])==1}>
-<!-- using iframe/img tag 2012/09/20 by mhaya start -->
-<{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
-	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
-
-<{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
-	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
-<{else}>
-
                              <a target="_blank" href="<{$item_attr[i][0].attribute_value[0]}>">
                                  <{if $item_attr[i][0].attribute_value[1] != ""}>
                                      <{$item_attr[i][0].attribute_value[1]}>
@@ -642,8 +634,6 @@
                                      <{$item_attr[i][0].attribute_value[0]}>
                                  <{/if}>
                              </a>
-<{/if}>
-<!-- using iframe/img tag 2012/09/20 by mhaya end -->
                         <{else}>
                             <table width="100%">
                                 <{section name=j loop=$item_attr[i]}>
@@ -652,14 +642,6 @@
                                             <{$smarty.section.j.index_next}>.
                                         </td>
                                         <td style="width:100%; padding-top: 5px;">
-<!-- using iframe/img tag 2012/09/20 by mhaya start -->
-<{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
-	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
-<{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
-	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
-<{else}>
-
-
                                             <a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
                                                 <{if $item_attr[i][j].attribute_value[1] != ""}>
                                                     <{$item_attr[i][j].attribute_value[1]}>
@@ -667,9 +649,6 @@
                                                     <{$item_attr[i][j].attribute_value[0]}>
                                                 <{/if}>
                                             </a>
-
-<{/if}>
-<!-- using iframe/img tag 2012/09/20 by mhaya end -->
                                         </td>
                                     </tr>
                                 <{/section}>
diff --git a/repository/templates/default/repository_mobile_item_search_indexlist.html b/repository/templates/default/repository_mobile_item_search_indexlist.html
index 2336cdc..fda028b 100644
--- a/repository/templates/default/repository_mobile_item_search_indexlist.html
+++ b/repository/templates/default/repository_mobile_item_search_indexlist.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_item_search_indexlist.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_mobile_item_search_indexlist.html 30197 2013-12-19 09:55:45Z rei_matsuura $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_mobile_item_search_result.html b/repository/templates/default/repository_mobile_item_search_result.html
index 85b44ba..181a744 100644
--- a/repository/templates/default/repository_mobile_item_search_result.html
+++ b/repository/templates/default/repository_mobile_item_search_result.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_item_search_result.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_mobile_item_search_result.html 47574 2015-02-02 07:33:54Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -304,7 +304,7 @@
                               <{if $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][0]=="link"}>
                                   <a href="<{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[0]}>" target="_blank"><{if $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[1] != ""}><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[1]}><{else}><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value[0]}><{/if}></a>
                               <{elseif $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][0]=="name"}>
-                                  <a href="" id="searchAuthorResult<{$id}>_<{$loop_item}>_<{$loop_list}>_<{$loop_attr}>_<{$loop_str}>" onclick="javascript: redirectAuthorSearch<{$id}>( 'searchAuthorResult<{$id}>_<{$loop_item}>_<{$loop_list}>_<{$loop_attr}>_<{$loop_str}>' ); return false; " ><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value}></a>
+                                  <a href="<{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].url}>" ><{$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value}></a>
                               <{elseif $action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][0]=="textarea"}>
                                   <{section name=i loop=$action.array_item_attr_list[$loop_item][$loop_list][$loop_attr][$loop_str].attr_value}>
                                       <{if $smarty.section.i.index!=0}><br/><{/if}>
diff --git a/repository/templates/default/repository_mobile_item_snippet.html b/repository/templates/default/repository_mobile_item_snippet.html
index 56bd439..987e5b9 100644
--- a/repository/templates/default/repository_mobile_item_snippet.html
+++ b/repository/templates/default/repository_mobile_item_snippet.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_item_snippet.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_mobile_item_snippet.html 40393 2014-08-25 09:29:15Z tatsuya_koyasu $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_mobile_pdf_reference.html b/repository/templates/default/repository_mobile_pdf_reference.html
index a821c98..14f26e6 100644
--- a/repository/templates/default/repository_mobile_pdf_reference.html
+++ b/repository/templates/default/repository_mobile_pdf_reference.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_pdf_reference.html 564 2014-04-14 01:06:48Z ivis $          -->
+<!--// $Id: repository_mobile_pdf_reference.html 29603 2013-12-10 02:05:47Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_mobile_ranking.html b/repository/templates/default/repository_mobile_ranking.html
index 352b51c..8cc4b0d 100644
--- a/repository/templates/default/repository_mobile_ranking.html
+++ b/repository/templates/default/repository_mobile_ranking.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_mobile_ranking.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_mobile_ranking.html 22981 2013-05-30 05:43:08Z ayumi_jin $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_multi_language.html b/repository/templates/default/repository_multi_language.html
index e7f390e..b0b759c 100644
--- a/repository/templates/default/repository_multi_language.html
+++ b/repository/templates/default/repository_multi_language.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_multi_language.html 564 2014-04-14 01:06:48Z ivis $          -->
+<!--// $Id: repository_multi_language.html 17250 2012-04-20 05:10:31Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_pdf_reference.html b/repository/templates/default/repository_pdf_reference.html
index d172b74..33f143c 100644
--- a/repository/templates/default/repository_pdf_reference.html
+++ b/repository/templates/default/repository_pdf_reference.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_pdf_reference.html 564 2014-04-14 01:06:48Z ivis $          -->
+<!--// $Id: repository_pdf_reference.html 27451 2013-10-23 09:10:00Z shota_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_prefix_confirm.html b/repository/templates/default/repository_prefix_confirm.html
index 0a02641..0cae040 100644
--- a/repository/templates/default/repository_prefix_confirm.html
+++ b/repository/templates/default/repository_prefix_confirm.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_prefix_confirm.html 530 2012-07-30 08:21:05Z ivis $          -->
+<!--// $Id: repository_prefix_confirm.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_prefix_image.html b/repository/templates/default/repository_prefix_image.html
index 093de9a..90299f9 100644
--- a/repository/templates/default/repository_prefix_image.html
+++ b/repository/templates/default/repository_prefix_image.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_prefix_image.html 530 2012-07-30 08:21:05Z ivis $          -->
+<!--// $Id: repository_prefix_image.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_prefix_setpath.html b/repository/templates/default/repository_prefix_setpath.html
index d40afb3..83f510d 100644
--- a/repository/templates/default/repository_prefix_setpath.html
+++ b/repository/templates/default/repository_prefix_setpath.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_prefix_setpath.html 530 2012-07-30 08:21:05Z ivis $          -->
+<!--// $Id: repository_prefix_setpath.html 18717 2012-07-24 06:43:22Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_ranking.html b/repository/templates/default/repository_ranking.html
index 429d1b3..7097daa 100644
--- a/repository/templates/default/repository_ranking.html
+++ b/repository/templates/default/repository_ranking.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_ranking.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_ranking.html 22981 2013-05-30 05:43:08Z ayumi_jin $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_redirect.html b/repository/templates/default/repository_redirect.html
index 42a6e9d..0a3fc31 100644
--- a/repository/templates/default/repository_redirect.html
+++ b/repository/templates/default/repository_redirect.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_redirect.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_redirect.html 30260 2013-12-20 02:13:11Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_review.html b/repository/templates/default/repository_review.html
index 15dd5d8..176509b 100644
--- a/repository/templates/default/repository_review.html
+++ b/repository/templates/default/repository_review.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_review.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_review.html 23154 2013-06-06 08:21:04Z ayumi_jin $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_script.html b/repository/templates/default/repository_script.html
index 68c6163..75b1269 100644
--- a/repository/templates/default/repository_script.html
+++ b/repository/templates/default/repository_script.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_script.html 530 2012-07-30 08:21:05Z ivis $          -->
+<!--// $Id: repository_script.html 18290 2012-06-25 07:05:42Z atsushi_suzuki $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_scriptFileDownload.html b/repository/templates/default/repository_scriptFileDownload.html
index 995fc49..f230be6 100644
--- a/repository/templates/default/repository_scriptFileDownload.html
+++ b/repository/templates/default/repository_scriptFileDownload.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_scriptFileDownload.html 554 2014-02-17 10:55:47Z ivis $          -->
+<!--// $Id: repository_script.html 9736 2011-07-04 06:40:22Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -13,6 +13,6 @@
 	<script class="nc_script" type="text/javascript">
 		var fileInfo = "<{$action.fileIdx}>";
 		var fileInfoArray = fileInfo.split("_");
-		location.href="<{$smarty.const.BASE_URL}>/?action=repository_action_common_download&item_id=<{$action.item_id}>"+"&item_no="+fileInfoArray[0]+"&attribute_id="+fileInfoArray[1]+"&file_no="+fileInfoArray[2]+"&block_id=<{$block_id}>&page_id=<{$page_id}>";
+		location.href="<{$smarty.const.BASE_URL}>/?action=repository_action_common_download&item_id="+fileInfoArray[0]+"&item_no="+fileInfoArray[1]+"&attribute_id="+fileInfoArray[2]+"&file_no="+fileInfoArray[3]+"&block_id=<{$block_id}>&page_id=<{$page_id}>";
 	</script>
 <{/if}>
diff --git a/repository/templates/default/repository_search_script.html b/repository/templates/default/repository_search_script.html
index 80b2243..a237135 100644
--- a/repository/templates/default/repository_search_script.html
+++ b/repository/templates/default/repository_search_script.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_search_script.html 645 2014-10-29 12:39:52Z ivis $          -->
+<!--// $Id: repository_search_script.html 47574 2015-02-02 07:33:54Z tomohiro_ichikawa $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -9,27 +9,6 @@
 <!--// http://creativecommons.org/licenses/BSD/                            -->
 <!--//                                                                     -->
 <!--// ---------------------------------------------------------------------->
-<{* for Author Search --start-- *}>
-<script class="nc_script" type="text/javascript">
-	redirectAuthorSearch<{$id}> = function(authorLinkId) {
-		var elm = $(authorLinkId);
-		var keyword = encodeURIComponent(elm.text);
-		keyword = keyword.replace("%C2%A0", " ");
-		if(keyword != "undefined" && keyword != null && keyword != "")
-		{
-			var sort_order = 0;
-			sort_order = "<{$smarty.session.sort_order}>";
-		    location.href = "<{$smarty.const.BASE_URL}>" + "/?action=pages_view_main&active_action=repository_view_main_item_snippet"
-		    				+ "&creator=" + keyword
-		    				+ "&count=" + "<{$smarty.session.list_view_num}>"
-		    				+ "&order=" + sort_order
-		    				+ "&pn=1"
-	    					+ "&page_id=<{$page_id}>&block_id=<{$block_id}>";
-		}
-		return false;
-	}
-</script>
-<{* for Author Search --end-- *}>
 <script class="nc_script" type="text/javascript">
 	redirctSearchKeyword<{$id}> = function() {
         <{* Bug Fix WEKO-2014-042 2014/07/18 T.Koyasu --start-- *}>
diff --git a/repository/templates/default/repository_select_language.html b/repository/templates/default/repository_select_language.html
index e2b342c..af2ee38 100644
--- a/repository/templates/default/repository_select_language.html
+++ b/repository/templates/default/repository_select_language.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_select_language.html 562 2014-04-14 01:03:17Z ivis $          -->
+<!--// $Id: repository_select_language.html 30197 2013-12-19 09:55:45Z rei_matsuura $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_supple_deletepopup.html b/repository/templates/default/repository_supple_deletepopup.html
index e13000d..887e214 100644
--- a/repository/templates/default/repository_supple_deletepopup.html
+++ b/repository/templates/default/repository_supple_deletepopup.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_supple_deletepopup.html 516 2012-05-22 09:30:55Z ivis $          -->
+<!--// $Id: repository_supple_deletepopup.html 15261 2012-02-06 10:13:57Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_supple_popup.html b/repository/templates/default/repository_supple_popup.html
index 9cf19b0..e33f779 100644
--- a/repository/templates/default/repository_supple_popup.html
+++ b/repository/templates/default/repository_supple_popup.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_supple_popup.html 516 2012-05-22 09:30:55Z ivis $          -->
+<!--// $Id: repository_supple_popup.html 15261 2012-02-06 10:13:57Z yuko_nakao $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_suppleworkflow.html b/repository/templates/default/repository_suppleworkflow.html
index 24e9569..e4d9b45 100644
--- a/repository/templates/default/repository_suppleworkflow.html
+++ b/repository/templates/default/repository_suppleworkflow.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_suppleworkflow.html 554 2014-02-17 10:55:47Z ivis $      -->
+<!--// $Id: repository_suppleworkflow.html 23154 2013-06-06 08:21:04Z ayumi_jin $      -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/repository_workflow.html b/repository/templates/default/repository_workflow.html
index e6fe690..8e7f800 100644
--- a/repository/templates/default/repository_workflow.html
+++ b/repository/templates/default/repository_workflow.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_workflow.html 554 2014-02-17 10:55:47Z ivis $      -->
+<!--// $Id: repository_workflow.html 23154 2013-06-06 08:21:04Z ayumi_jin $      -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
diff --git a/repository/templates/default/smartphone/repository_item_contents.html b/repository/templates/default/smartphone/repository_item_contents.html
index 6522c35..c8d77bd 100644
--- a/repository/templates/default/smartphone/repository_item_contents.html
+++ b/repository/templates/default/smartphone/repository_item_contents.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_contents.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_item_contents.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -11,7 +11,7 @@
 <!--// ---------------------------------------------------------------------->
 <{strip}>
     <div class="mt10">
-        <{include file="repository_item_search_indexlist.html"}>
+        <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/smartphone/repository_item_search_indexlist.html'}>
         <form id="export_print" method="post">
             <div id="search_print_order" class="pd10">
                 <table class="repository_contents_table">
diff --git a/repository/templates/default/smartphone/repository_item_detail.html b/repository/templates/default/smartphone/repository_item_detail.html
index 24e7260..cf97ef7 100644
--- a/repository/templates/default/smartphone/repository_item_detail.html
+++ b/repository/templates/default/smartphone/repository_item_detail.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_detail.html 645 2014-10-29 12:39:52Z ivis $          -->
+<!--// $Id: repository_item_detail.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -895,8 +895,6 @@
                                                 <th class="th_detail_line_repos vt al w20 ws"><{$attr_type[i].attribute_name}></th>
                                                 <td class="td_detail_line_repos w80">
                                                     <{section name=j loop=$item_attr[i]}>
-<!-- using iframe/img tag 2012/09/20 by mhaya start -->
-<!-- 
                                                         <a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
                                                             <{if $item_attr[i][j].attribute_value[1] != ""}>
                                                                 <{$item_attr[i][j].attribute_value[1]}>
@@ -904,21 +902,6 @@
                                                                 <{$item_attr[i][j].attribute_value[0]}>
                                                             <{/if}>
                                                         </a><br>
--->
-<{if $item_attr[i][j].attribute_value[1] != "" && (strstr(strtolower($item_attr[i][0].attribute_value[1]),"iframe"))==true}>
-	<iframe src="<{$item_attr[i][j].attribute_value[0]}>" height="700" width="100%" scrolling="auto">Sorry. This content use IFrame</iframe>
-<{elseif strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true||strstr(strtolower($item_attr[i][j].attribute_value[0]),".jpg")==true}>
-	<img src="<{$item_attr[i][j].attribute_value[0]}>" alt="<{$item_attr[i][j].attribute_value[1]}>" width=200px height=200px />
-<{else}>
-	<a target="_blank" href="<{$item_attr[i][j].attribute_value[0]}>">
-	<{if $item_attr[i][j].attribute_value[1] != ""}>
-		<{$item_attr[i][j].attribute_value[1]}>
-	<{else}>
-		<{$item_attr[i][j].attribute_value[0]}>
-	<{/if}>
-	</a><br>
-<{/if}>
-<!-- using iframe/img tag 2012/09/20 by mhaya end -->
                                                     <{/section}>
                                                 </td>
                                             </tr>
@@ -1362,7 +1345,7 @@
                 
                 <{*show pdf reference S.Suzuki 2013/11/27 --start--*}>
                     <{if count($action.fileName) > 0}>
-                        <{include file="repository_pdf_reference.html"}>
+                        <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_pdf_reference.html'}>
                     <{/if}>
                 <{*show pdf reference S.Suzuki 2013/11/27 --end--*}>
                 
@@ -1420,7 +1403,7 @@
 
 </div>
 
-<{include file="repository_script.html"}>
+<{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_script.html'}>
 
 <script class="nc_script" type="text/javascript">
     redirctPrevPage = function() {
diff --git a/repository/templates/default/smartphone/repository_item_search_result.html b/repository/templates/default/smartphone/repository_item_search_result.html
index e38c0fc..f1e86c5 100644
--- a/repository/templates/default/smartphone/repository_item_search_result.html
+++ b/repository/templates/default/smartphone/repository_item_search_result.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_search_result.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_item_search_result.html 16446 2012-04-10 05:49:27Z ayumi_jin $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -11,7 +11,7 @@
 <!--// ---------------------------------------------------------------------->
 <{* 検索結果表示画面 *}>
 <div class="mt10">
-<{include file="smartphone/repository_item_search_indexlist.html"}>
+<{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/smartphone/repository_item_search_indexlist.html'}>
 
 <form id="export_print" method="post" class="min-w685px">
 <{* when child index is any and item is no, item list is not view *}>
diff --git a/repository/templates/default/smartphone/repository_item_snippet.html b/repository/templates/default/smartphone/repository_item_snippet.html
index b17a547..e1eb74d 100644
--- a/repository/templates/default/smartphone/repository_item_snippet.html
+++ b/repository/templates/default/smartphone/repository_item_snippet.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_item_snippet.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_item_snippet.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -62,13 +62,13 @@
     <{* Include display html --start-- *}>
     <div class="repository_right_frame">
         <{if $smarty.session.serach_screen=="0"}>
-            <{include file="smartphone/repository_item_search_result.html"}>
+            <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/smartphone/repository_item_search_result.html'}>
         <{elseif $smarty.session.serach_screen=="1"}>
-            <{include file="smartphone/repository_item_detail.html"}>
+            <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/smartphone/repository_item_detail.html'}>
         <{elseif $smarty.session.serach_screen==2}>
-            <{include file="smartphone/repository_ranking.html"}>
+            <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/smartphone/repository_ranking.html'}>
         <{elseif $smarty.session.serach_screen==3}>
-            <{include file="smartphone/repository_item_contents.html"}>
+            <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/smartphone/repository_item_contents.html'}>
         <{/if}>
     </div>
     <{* Include display html --end-- *}>
@@ -125,7 +125,7 @@
         location.href="<{$smarty.const.BASE_URL}>/?action=pages_view_main&page_id="+<{$page_id}>;
     </script>
 <{else}>
-    <{include file="repository_scriptFileDownload.html"}>
+    <{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_scriptFileDownload.html'}>
 <{/if}>
 
 <{if $action.uri_export!=null && $action.uri_export.status=="login"}>
@@ -273,7 +273,7 @@
         }
 </script>
 <{* Script for indexSubTreeList Y.Nakao 2012/04/10 --end-- *}>
-<{include file="repository_script.html"}>
+<{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_script.html'}>
 <{* Bug Fix WEKO-2014-042 2014/07/18 T.Koyasu --start-- *}>
-<{include file="repository_search_script.html"}>
+<{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_search_script.html'}>
 <{* Bug Fix WEKO-2014-042 2014/07/18 T.Koyasu --end-- *}>
diff --git a/repository/templates/default/smartphone/repository_ranking.html b/repository/templates/default/smartphone/repository_ranking.html
index c3101df..e9a33db 100644
--- a/repository/templates/default/smartphone/repository_ranking.html
+++ b/repository/templates/default/smartphone/repository_ranking.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_ranking.html 610 2014-08-29 07:24:55Z ivis $          -->
+<!--// $Id: repository_ranking.html 53594 2015-05-28 05:25:53Z kaede_matsushita $          -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -405,7 +405,7 @@
 <{/if}>
 </div>
 
-<{include file="repository_script.html"}>
+<{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_script.html'}>
 
 
 
diff --git a/repository/templates/default/smartphone/repository_workflow.html b/repository/templates/default/smartphone/repository_workflow.html
index 789d433..10a21bb 100644
--- a/repository/templates/default/smartphone/repository_workflow.html
+++ b/repository/templates/default/smartphone/repository_workflow.html
@@ -1,6 +1,6 @@
 <!--// ---------------------------------------------------------------------->
 <!--//                                                                     -->
-<!--// $Id: repository_workflow.html 610 2014-08-29 07:24:55Z ivis $      -->
+<!--// $Id: repository_workflow.html 15823 2012-02-28 09:33:45Z yuko_nakao $      -->
 <!--//                                                                     -->
 <!--// Copyright (c) 2007 - 2008, National Institute of Informatics,        -->
 <!--// Research and Development Center for Scientific Information Resources -->
@@ -452,7 +452,7 @@
 <{* display tab number *}>
 <input type="hidden" id="workflow_active_tab_id" name="workflow_active_tab" value="0" />
 
-<{include file="repository_script.html"}>
+<{include file=$smarty.const.WEBAPP_DIR|cat:'/modules/repository/templates/default/repository_script.html'}>
 
 <script class="nc_script" type="text/javascript">
 	changeActiveTab1 = function(){
diff --git a/repository/uri/Uri.class.php b/repository/uri/Uri.class.php
index cc2621a..67b2536 100644
--- a/repository/uri/Uri.class.php
+++ b/repository/uri/Uri.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Uri.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Uri.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -64,7 +64,11 @@ class Repository_Uri extends RepositoryAction
 		
 		// get block_id and page_id
 		$block_info = $this->getBlockPageId();
-		
+
+		// Add suppleContentsEntry  Y.Yamazawa --start-- 2015/04/01 --start--
+		$this->setLangResource();
+		// Add suppleContentsEntry  Y.Yamazawa --end-- 2015/04/01 --end--
+
 		// make redirect URL
 		$redirect_url = BASE_URL;
         if($_SERVER["REQUEST_METHOD"] == HTTP_REQUEST_METHOD_PUT){
@@ -87,8 +91,8 @@ class Repository_Uri extends RepositoryAction
 		} else if(strlen($this->file_no) == 0){
 			$query = "SELECT file_no ".
 					" FROM ".DATABASE_PREFIX."repository_file ".
-					" WHERE item_id = '".$this->item_id."' ".
-					" AND attribute_id = '".$this->file_id."'; ";
+					" WHERE item_id = ".$this->item_id." ".
+					" AND attribute_id = ".$this->file_id." ; ";
 			$result = $this->Db->execute($query);
 			if($result === false || count($result) == 0) {
 				// go to item detail
@@ -196,10 +200,11 @@ class Repository_Uri extends RepositoryAction
         // Get upload file data
         require_once(WEBAPP_DIR. "/modules/repository/components/RepositoryFileUpload.class.php");
         $fileUpload = new RepositoryFileUpload();
-        $fileData = $fileUpload->getUploadData();
+        $fileData = $fileUpload->getUploadData($statusCodeMsg);
         if(empty($fileData))
         {
-            $swordUpdate->setHeader(400);
+            $swordUpdate->setHeader($statusCodeMsg);
+
             return;
         }
         $this->Session->setParameter("swordFileData", $fileData);
diff --git a/repository/validator/Validator_DownloadCheck.class.php b/repository/validator/Validator_DownloadCheck.class.php
index 6db31d7..318a5b0 100644
--- a/repository/validator/Validator_DownloadCheck.class.php
+++ b/repository/validator/Validator_DownloadCheck.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Validator_DownloadCheck.class.php 645 2014-10-29 12:39:52Z ivis $
+// $Id: Validator_DownloadCheck.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -16,6 +16,7 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexAuthorit
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryDbAccess.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryCheckFileTypeUtility.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+require_once MAPLE_DIR. '/validator/Validator.interface.php';
 
 /**
  * validator file download.
@@ -42,6 +43,12 @@ class Repository_Validator_DownloadCheck extends Validator
     private $pdf_cover_header = "";
     // Add PDF cover page 2012/06/13 A.Suzuki --end--
     
+    // maple.iniを更新し、新しくValidateDefに変数を追加した場合、
+    // privateのメンバ変数を追加する。
+    // メンバ変数はNetCommons側から自動的に付与されず、
+    // validate関数の第一引数attributesに入る
+    // そのため、ValidateDefに変数を追加した場合、attributesから
+    // 忘れずに値を取ってくるようにする
     
     // for file download
     private $item_id = "";
@@ -54,6 +61,7 @@ class Repository_Validator_DownloadCheck extends Validator
     private $img = "";              // download thumbnail
     private $item_type_id = "";     // download item type icon
     private $flash = "";            // download flash
+    private $image_slide = "";      // download slide_image
     private $pay = "false";         // user agree pay for view file.
     
     // Fix jump to close detail page. 2012/01/30 Y.Nakao --start--
@@ -90,8 +98,7 @@ class Repository_Validator_DownloadCheck extends Validator
         $this->RepositoryAction = new RepositoryAction();
         $this->RepositoryAction->Session = $this->Session;
         $this->RepositoryAction->Db = $this->Db;
-        $result = $this->RepositoryAction->initAction();
-        $result = $this->RepositoryAction->exitAction();
+        $result = $this->RepositoryAction->initAction(false);
         if ( $result === false )
         {
             return false;
@@ -166,7 +173,7 @@ class Repository_Validator_DownloadCheck extends Validator
             // ----------------------------------------
             if($this->Session->getParameter("_mobile_flag") == _OFF)
             {
-                $this->Session->setParameter('repository'.$this->block_id.'FileDownloadKey', $this->item_no."_".$this->attribute_id."_".$this->file_no);
+                $this->Session->setParameter('repository'.$this->block_id.'FileDownloadKey', $this->item_id."_".$this->item_no."_".$this->attribute_id."_".$this->file_no);
             }
             
             // ----------------------------------------
@@ -230,7 +237,7 @@ class Repository_Validator_DownloadCheck extends Validator
                 }
                 if($this->closeCharge($trade_id_price[0]))
                 {
-                    $this->Session->setParameter('repository'.$this->block_id.'FileDownloadKey', $this->item_no."_".$this->attribute_id."_".$this->file_no);
+                    $this->Session->setParameter('repository'.$this->block_id.'FileDownloadKey', $this->item_id."_".$this->item_no."_".$this->attribute_id."_".$this->file_no);
                     
                     $url = BASE_URL.'/?action=pages_view_main'.
                             "&active_action=repository_view_main_item_detail".
@@ -291,7 +298,7 @@ class Repository_Validator_DownloadCheck extends Validator
         
         // ファイル/FLASHの公開状況をチェック
         $status = "close";
-        if($this->flash == "true")
+        if($this->flash == "true" || $this->image_slide == "true")
         {
             $status = $this->checkFlashAccessStatus($fileData);
         }
@@ -310,6 +317,10 @@ class Repository_Validator_DownloadCheck extends Validator
      */
     public function checkFlashAccessStatus($fileData)
     {
+        // set file pub date
+        $date = explode(" ", $fileData[RepositoryConst::DBCOL_REPOSITORY_FILE_PUB_DATE]);
+        $filePubDate = implode('', explode("-", $date[0]));
+        
         // set flash pub date in 'pub_date'
         if(strlen($fileData[RepositoryConst::DBCOL_REPOSITORY_FILE_FLASH_PUB_DATE]) > 0)
         {
@@ -331,9 +342,22 @@ class Repository_Validator_DownloadCheck extends Validator
         {
             return "close";
         }
-        
         // check file status.
-        return $this->checkFileAccessStatus($fileData);
+        $status = $this->checkFileAccessStatus($fileData);
+        
+        // アクセスが非公開のとき、Flash公開日に関わらずViewerを表示する
+        if($filePubDate === "99991231"){
+            // ファイル登録時、アクセスが非公開の場合、課金額が空のレコードが登録されるため、
+            // ログインしたユーザでは確定的にCloseとなる
+            // 未ログインの場合はLoginが返ってくるので、返り値を調べている
+            if($status === "close"){
+                return "free";
+            } else {
+                return $status;
+            }
+        } else {
+            return $status;
+        }
     }
     
     /**
@@ -869,26 +893,12 @@ class Repository_Validator_DownloadCheck extends Validator
     }
     
     // Add check site license 2008/10/20 Y.Nakao --start--
-    public function checkSiteLicense($item_id="", $item_no=""){
-        // get user ip address
-        if(isset($_SERVER['HTTP_X_FORWARDED_FOR']) && strlen($_SERVER['HTTP_X_FORWARDED_FOR']) > 0) {
-            $access_ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
-        } else {
-            $access_ip = getenv("REMOTE_ADDR");
-        }
-        $ipaddress = explode(".", $access_ip);
-        // get param table data : site_license
-        $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                 "WHERE param_name = 'site_license'; ";
-        $result = $this->Db->execute($query);
-        if($result === false){
-            return "false";
-        }
-        $site_license = explode("|", $result[0]['param_value']);
-        
+    public function checkSiteLicense($item_id="", $item_no="", &$sitelicense_id=0){
+        // サイトライセンス除外アイテムタイプのチェック（引数が設定されている場合のみ）
+        // 除外アイテムタイプであった場合はSLユーザーであってもfalseを返すので一番先に処理をする
         $site_license_item_type_id = "";
         $item_type_id = "";
-        if(strlen($item_id)>0 && strlen($item_no)>0)
+        if(strlen($item_id)>0 && strlen($item_no)>0 && $item_id > 0 && $item_no > 0)
         {
             // Add item_type_id for site license 2009/01/07 A.Suzuki --start--
             // get param table data : site_license_item_type_id
@@ -915,59 +925,76 @@ class Repository_Validator_DownloadCheck extends Validator
             }
             $item_type_id = $result[0]['item_type_id'];
             // Add item_type_id for site license 2009/01/07 A.Suzuki --end--
-        }
-        
-        for($ii=0; $ii<count($site_license); $ii++){
-            $param_site_license = explode(",", $site_license[$ii]);
-            $ipaddress_from = array("");
-            if(isset($param_site_license[1])){
-                $ipaddress_from = explode(",", $param_site_license[1]);
-            }
-            if(isset($param_site_license[2]) && $param_site_license[2] != ""){
-                // from to
-                // Fix roop bug 2010/10/14 Y.Nakao --start--
-                $ip = sprintf("%03d", $ipaddress[0]).
-                      sprintf("%03d", $ipaddress[1]).
-                      sprintf("%03d", $ipaddress[2]).
-                      sprintf("%03d", $ipaddress[3]);
-                $ipaddress_to = explode(",", $param_site_license[2]);
-                $ipaddress_from = explode(".", $ipaddress_from[0]);
-                $ipaddress_to = explode(".", $ipaddress_to[0]);
-                $from = sprintf("%03d", $ipaddress_from[0]).
-                        sprintf("%03d", $ipaddress_from[1]).
-                        sprintf("%03d", $ipaddress_from[2]).
-                        sprintf("%03d", $ipaddress_from[3]);
-                $to   = sprintf("%03d", $ipaddress_to[0]).
-                        sprintf("%03d", $ipaddress_to[1]).
-                        sprintf("%03d", $ipaddress_to[2]).
-                        sprintf("%03d", $ipaddress_to[3]);  
-                if( $from <= $ip && $ip <= $to ){
-                    if(strlen($item_id)>0 && strlen($item_no)>0)
-                    {
-                        for($jj=0; $jj<count($site_license_item_type_id); $jj++){
-                            if($site_license_item_type_id[$jj] == $item_type_id){
-                                return "false";
-                            }
-                        }
+            if(count($result) > 0) {
+                $item_type_id = $result[0]['item_type_id'];
+                // Add item_type_id for site license 2009/01/07 A.Suzuki --end--
+                for($jj=0; $jj<count($site_license_item_type_id); $jj++){
+                    if($site_license_item_type_id[$jj] == $item_type_id){
+                        return "false";
                     }
-                    return "true";
                 }
-                // Fix roop bug 2010/10/14 Y.Nakao --end--
-            } else {
-                // same ip
-                if($access_ip == $ipaddress_from[0]){
-                    if(strlen($item_id)>0 && strlen($item_no)>0)
-                    {
-                        for($jj=0; $jj<count($site_license_item_type_id); $jj++){
-                            if($site_license_item_type_id[$jj] == $item_type_id){
-                                return "false";
-                            }
-                        }
+            }
+        }
+        
+        // サイトライセンスユーザーであるかどうかのチェック
+        // ユーザーのIPアドレスの取得
+        if(isset($_SERVER['HTTP_X_FORWARDED_FOR']) && strlen($_SERVER['HTTP_X_FORWARDED_FOR']) > 0) {
+            $access_ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
+        } else {
+            $access_ip = getenv("REMOTE_ADDR");
+        }
+        // IPアドレスを0埋めの12桁の文字列にする
+        $ipaddress = explode(".", $access_ip);
+        $ip = sprintf("%03d", $ipaddress[0]).
+              sprintf("%03d", $ipaddress[1]).
+              sprintf("%03d", $ipaddress[2]).
+              sprintf("%03d", $ipaddress[3]);
+        // サイトライセンスに設定されたIPレンジの取得
+        $query = "SELECT organization_id, start_ip_address, finish_ip_address FROM ". DATABASE_PREFIX. "repository_sitelicense_ip_address ".
+                 "WHERE is_delete = ? ;";
+        $params = array();
+        $params[] = 0;
+        $sitelicense_ip = $this->Db->execute($query, $params);
+        if($sitelicense_ip === false){
+            return "false";
+        }
+        // チェック処理
+        for($ii=0; $ii<count($sitelicense_ip); $ii++){
+            if(isset($sitelicense_ip[$ii]["start_ip_address"]) && strlen($sitelicense_ip[$ii]["start_ip_address"]) > 0){
+                // IPレンジの始点を0埋め12ケタの文字列にする
+                $start_ip = explode(".", $sitelicense_ip[$ii]["start_ip_address"]);
+                $from = sprintf("%03d", $start_ip[0]).
+                        sprintf("%03d", $start_ip[1]).
+                        sprintf("%03d", $start_ip[2]).
+                        sprintf("%03d", $start_ip[3]);
+                if(isset($sitelicense_ip[$ii]["finish_ip_address"]) && strlen($sitelicense_ip[$ii]["finish_ip_address"]) > 0){
+                    // IPレンジの終点を0埋め12ケタの文字列にする
+                    $finish_ip = explode(".", $sitelicense_ip[$ii]["finish_ip_address"]);
+                    $to = sprintf("%03d", $finish_ip[0]).
+                          sprintf("%03d", $finish_ip[1]).
+                          sprintf("%03d", $finish_ip[2]).
+                          sprintf("%03d", $finish_ip[3]);
+                    // ユーザーのIPアドレスが範囲内に収まっていればtrueを返す
+                    if($from <= $ip && $ip <= $to){
+                        $sitelicense_id = $sitelicense_ip[$ii]["organization_id"];
+                        return "true";
                     }
+                } elseif($ip == $from) {
+                    // IPが始点(=from)のみ設定されている場合はそれと一致するかどうかを判定する
+                    $sitelicense_id = $sitelicense_ip[$ii]["organization_id"];
                     return "true";
                 }
             }
         }
+        
+        // add Check users oraganization 2015/01/19 T.Ichikawa --start--
+        // ユーザーがサイトライセンス組織に所属しているかのチェック
+        $sitelicense_group = $this->checkSiteLicenseGroup($sitelicense_id);
+        // サイトライセンス組織に設定されている場合はtrueを返す
+        if($sitelicense_group === true) {
+            return "true";
+        }
+        // add Check users oraganization 2015/01/19 T.Ichikawa --end--
         return "false";
     }
     
@@ -1051,6 +1078,10 @@ class Repository_Validator_DownloadCheck extends Validator
         if($this->pdf_cover_header != null){
             return;
         }
+        // image_slide
+        if(isset($attributes[13]) && strlen($attributes[13]) > 0){
+            $this->image_slide = $attributes[13];
+        }
     }
     
     /**
@@ -1695,5 +1726,48 @@ class Repository_Validator_DownloadCheck extends Validator
     }
     // Add check charge record from log table 2008/10/16 Y.Nakao --end--
     
+    // Add check sitelicense group 2015/01/19 T.Ichikawa --start--
+    /**
+     * check sitelicense group
+     *
+     * @return bool sitelicense_flag
+     */
+    public function checkSiteLicenseGroup(&$sitelicense_id)
+    {
+        // ユーザー所属組織情報の取得
+        $query = "SELECT content FROM ". DATABASE_PREFIX. "users_items_link ".
+                 "WHERE user_id = ? ".
+                 "AND item_id = ? ;";
+        $params = array();
+        $params[] = $this->Session->getParameter("_user_id");
+        $params[] = 8;
+        $result = $this->Db->execute($query, $params);
+        if($result == false) {
+            return false;
+        }
+        // ユーザーが組織に所属している場合、それがサイトライセンス組織であるか判定する
+        if(isset($result) && count($result) > 0 && strlen($result[0]["content"]) > 0) {
+            // サイトライセンス組織情報の取得
+            $query = "SELECT organization_id, group_name FROM ". DATABASE_PREFIX. "repository_sitelicense_info ".
+                     "WHERE is_delete = ? ;";
+            $params = array();
+            $params[] = 0;
+            $sitelicense_groups = $this->Db->execute($query, $params);
+            if($result == false) {
+                return false;
+            }
+            // チェック処理
+            for($ii = 0; $ii < count($sitelicense_groups); $ii++) {
+                // ユーザーの所属組織名がサイトライセンス組織名と一致した場合trueを返す
+                if($result[0]["content"] == $sitelicense_groups[$ii]["group_name"]) {
+                    $sitelicense_id = $sitelicense_groups[$ii]["organization_id"];
+                    return true;
+                }
+            }
+        }
+        
+        return false;
+    }
+    // Add check sitelicense group 2015/01/19 T.Ichikawa --end--
 }
 ?>
\ No newline at end of file
diff --git a/repository/view/common/edit/tree/confirm/Confirm.class.php b/repository/view/common/edit/tree/confirm/Confirm.class.php
index 001a9d6..be9b0fe 100644
--- a/repository/view/common/edit/tree/confirm/Confirm.class.php
+++ b/repository/view/common/edit/tree/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Confirm.class.php 14655 2012-01-13 11:47:27Z tatsuya_koyasu $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/common/help/Help.class.php b/repository/view/common/help/Help.class.php
index 558cab7..32db6ef 100644
--- a/repository/view/common/help/Help.class.php
+++ b/repository/view/common/help/Help.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Help.class.php 600 2014-08-06 04:41:16Z ivis $
+// $Id: Help.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -34,7 +34,7 @@ class Repository_View_Common_Help extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     //Path作成
     //helpファイルの判別
diff --git a/repository/view/common/item/detail/Detail.class.php b/repository/view/common/item/detail/Detail.class.php
index 4f6de17..f7bcc0d 100644
--- a/repository/view/common/item/detail/Detail.class.php
+++ b/repository/view/common/item/detail/Detail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Detail.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Detail.class.php 27738 2013-10-29 10:01:04Z shota_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/common/item/supple/deletepopup/Deletepopup.class.php b/repository/view/common/item/supple/deletepopup/Deletepopup.class.php
index fb6654e..215900e 100644
--- a/repository/view/common/item/supple/deletepopup/Deletepopup.class.php
+++ b/repository/view/common/item/supple/deletepopup/Deletepopup.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Deletepopup.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Deletepopup.class.php 9461 2011-06-16 00:39:22Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/common/item/supple/logincheck/Logincheck.class.php b/repository/view/common/item/supple/logincheck/Logincheck.class.php
index b4fa742..81655de 100644
--- a/repository/view/common/item/supple/logincheck/Logincheck.class.php
+++ b/repository/view/common/item/supple/logincheck/Logincheck.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Logincheck.class.php 567 2014-05-21 08:30:29Z ivis $
+// $Id: Logincheck.class.php 36236 2014-05-26 07:53:04Z satoshi_arata $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/common/item/supple/popup/Popup.class.php b/repository/view/common/item/supple/popup/Popup.class.php
index 811f92c..1e4ea8c 100644
--- a/repository/view/common/item/supple/popup/Popup.class.php
+++ b/repository/view/common/item/supple/popup/Popup.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Popup.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Popup.class.php 9286 2011-06-03 02:22:01Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/common/item/supple/redirect/Redirect.class.php b/repository/view/common/item/supple/redirect/Redirect.class.php
index a10810c..f2f07dc 100644
--- a/repository/view/common/item/supple/redirect/Redirect.class.php
+++ b/repository/view/common/item/supple/redirect/Redirect.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Redirect.class.php 377 2009-10-15 04:30:23Z ivis $
+// $Id: Redirect.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,12 +14,12 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchTableProcessing.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム詳細画面のサプリコンテンツ新規登録処理・サプリコンテンツタブからのサプリコンテンツ更新処理
  *
- * @package     [[package名]]
- * @access      public
+ * @author IVIS
  */
 class Repository_View_Common_Item_Supple_Redirect extends RepositoryAction
 {
@@ -36,23 +36,65 @@ class Repository_View_Common_Item_Supple_Redirect extends RepositoryAction
 	var $mailMain = null;
 	
     /**
-     * [[機能説明]]
-     *
+     * アイテム詳細画面の新規登録時のサプリコンテンツ登録
+     * または、サプリコンテンツタブでのサプリコンテンツ更新処理
+     * 1.アイテム詳細画面から新規登録を行った場合、サプリコンテンツの登録を行う
+     * 2.サプリコンテンツタブからサプリWEKOのアイテム更新を行った場合、サプリコンテンツの更新を行う
      * @access  public
      */
     function execute()
     {
-		// check Session and Db Object
-		if($this->Session == null){
-			$container =& DIContainerFactory::getContainer();
-	        $this->Session =& $container->getComponent("Session");
-		}
-		if($this->Db== null){
-			$container =& DIContainerFactory::getContainer();
-			$this->Db =& $container->getComponent("DbObject");
-		}
-		
-        //アクション初期化処理
+        try{
+            $this->initActionParam();
+            // Update suppleContentsEntry Y.Yamazawa --start-- 2015/03/17 --start--
+        	// EJWEKO サプリアイテム情報登録＆詳細画面へリダイレクト
+        	if($this->mode == "add_new"){
+        	    // リダイレクトURL
+        	    $redirect_url = $this->redirectUrl();
+
+        	    // サプリコンテンツの登録
+        	    $this->entrySupple();
+        	}
+        	else if($this->mode == "edit"){
+        	    // サプリコンテンツの更新
+        	    $this->updateSupple($redirect_url);
+        	}
+        	// Update suppleContentsEntry Y.Yamazawa --end-- 2015/03/17 --end--
+            
+            // TODO：検索テーブル再作成のビジネスロジックを作る
+            $searchTableProcessing = new RepositorySearchTableProcessing($this->Session, $this->Db);
+            $searchTableProcessing->updateSearchTableForItem($this->item_id, $this->item_no);
+            
+          	//アクション終了処理
+    		$result = $this->exitAction();     // トランザクションが成功していればCOMMITされる
+    		header("HTTP/1.1 301 Moved Permanently");
+      		header("Location: ".$redirect_url);
+      		return;
+        }
+        catch(AppException $e){
+            if(!isset($redirect_url)){
+                $redirect_url = $this->redirectUrl();
+            }
+            $msg = $e->getMessage();
+            $this->errorLog($msg, __FILE__, __CLASS__, __LINE__);
+            $this->Session->setParameter("supple_error",$msg);
+            header("HTTP/1.1 301 Moved Permanently");
+      		header("Location: ".$redirect_url);
+      		return;
+        }
+    }
+
+    /**
+     * パラメータの初期化
+     * @throws RepositoryException
+     */
+    private function initActionParam()
+    {
+        // check Session and Db Object
+        if($this->Session == null){
+            $container =& DIContainerFactory::getContainer();
+            $this->Session =& $container->getComponent("Session");
+        }
         $result = $this->initAction();
         if ( $result === false ) {
             $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
@@ -62,497 +104,76 @@ class Repository_View_Common_Item_Supple_Redirect extends RepositoryAction
             $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
             throw $exception;
         }
+    }
 
-    	// EJWEKO サプリアイテム情報登録＆詳細画面へリダイレクト
-    	if($this->mode == "add_new"){
-			// サプリアクションからの遷移を示すフラグ
-            $this->Session->setParameter("supple_flag", "true");
-            
-            // ユーザID取得
-            $user_id = $this->Session->getParameter("_user_id");
-        	
-        	// サプリアイテム登録
-        	$supple_data = array();
-			$supple_data = $this->getSuppleDataFromOpenSearch("weko_id", $this->weko_id);
-			if($supple_data === false){
-				return "error";
-			}
-			
-			// 該当サプリアイテムなし
-			if(count($supple_data) == 0){
-				$this->Session->setParameter("supple_error", 3);
-				return "error";
-			}
-			
-			// アイテムタイプ情報を取得
-			$query = "SELECT attr_type.item_type_id, attr_type.attribute_id, item.uri, item.title, item.title_english ".
-					 "FROM ".DATABASE_PREFIX."repository_item_attr_type AS attr_type, ".DATABASE_PREFIX."repository_item AS item ".
-					 "WHERE item.item_id = ? ".
-					 "AND item.item_no = ? ".
-					 "AND item.item_type_id = attr_type.item_type_id ".
-					 "AND attr_type.input_type = 'supple' ".
-					 "AND item.is_delete = 0 ".
-					 "AND attr_type.is_delete = 0;";
-			$params = array();
-			$params[] = $this->item_id;	// item_id
-			$params[] = $this->item_no;	// item_no
-			$item_type_result = $this->Db->execute($query, $params);
-			if($item_type_result === false){
-				return "error";
-			}
-			
-			// サプリテーブルを検索
-        	$query = "SELECT MAX(supple_no) FROM ".DATABASE_PREFIX."repository_supple ".
-        			 "WHERE item_id = ? ".
-        			 "AND item_no = ? ".
-        			 "AND attribute_id = ? ".
-        			 "AND item_type_id = ?;";
-        	$params = array();
-			$params[] = $this->item_id;	// item_id
-			$params[] = $this->item_no;	// item_no
-			$params[] = $item_type_result[0]['attribute_id'];	// attribute_id
-			$params[] = $item_type_result[0]['item_type_id'];	// item_type_id
-			$result = $this->Db->execute($query, $params);
-			if($result === false){
-				return "error";
-			}
-        	
-			if($result[0]['MAX(supple_no)'] == null){
-				$supple_num = 1;
-			} else {
-				$supple_num = $result[0]['MAX(supple_no)'] + 1;
-			}
-			
-			// 新規査読アイテム登録メール送信処理
-			// 査読通知メールを送るか否か
-    	    $query = "SELECT param_value ".
-					 "FROM ".DATABASE_PREFIX."repository_parameter ".
-					 "WHERE param_name = 'review_mail_flg';";
-			$result = $this->Db->execute($query);
-			if ($result === false) {
-				array_push($error_msg, $this->Db->ErrorMsg());
-				// roll back
-				$this->failTrans();
-				return 'error';
-			}
-			$review_mail_flg = $result[0]['param_value'];
-			
-			// サプリコンテンツの査読を行うか否か
-        	$query = "SELECT param_value ".
-        			 "FROM ".DATABASE_PREFIX."repository_parameter ".
-        			 "WHERE param_name = 'review_flg_supple';";
-        	$result = $this->Db->execute($query);
-        	if($result === false){
-                return "error";
-			}
-			$review_flg_supple = $result[0]['param_value'];
-			
-			// サプリアイテム登録
-			$query = "INSERT INTO ". DATABASE_PREFIX ."repository_supple ".
-					 "(item_id, item_no, attribute_id, supple_no, ".
-					 " item_type_id, supple_weko_item_id, supple_title, supple_title_en, ".
-					 " uri, supple_item_type_name, mime_type, file_id, supple_review_status, ".
-		   			 " supple_review_date, ins_user_id, mod_user_id, ins_date, mod_date, del_date, is_delete) ".
-					 "VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);";
-        	$params = array();
-			$params[] = $this->item_id;	// item_id
-			$params[] = $this->item_no;	// item_no
-			$params[] = $item_type_result[0]['attribute_id'];	// attribute_id
-			$params[] = $supple_num;		// supple_no
-			$params[] = $item_type_result[0]['item_type_id'];	// item_type_id
-			$params[] = $supple_data["supple_weko_item_id"];	// supple_weko_item_id
-			$params[] = $supple_data["supple_title"];	// supple_title
-			$params[] = $supple_data["supple_title_en"];	// supple_title_en
-			$params[] = $supple_data["uri"];	// uri
-			$params[] = $supple_data["supple_item_type_name"];	// supple_item_type_name
-			$params[] = $supple_data["mime_type"];	// mime_type
-			$params[] = $supple_data["file_id"];	// file_id
-    		if($review_flg_supple == 1){
-				// 査読を行う
-				$params[] = 0;	// supple_review_status
-				$params[] = "";	// supple_review_date
-			} else {
-				// 査読を行わない（自動的に承認する）
-				$params[] = 1;	// supple_review_status
-				$params[] = $this->TransStartDate;	// supple_review_date
-			}
-			$params[] = $user_id;	// ins_user_id
-			$params[] = $user_id;	// mod_user_id
-			$params[] = $this->TransStartDate;	// ins_date
-			$params[] = $this->TransStartDate;	// mod_date
-			$params[] = null;	// del_date
-			$params[] = 0;	// is_delete
-			$result = $this->Db->execute($query, $params);
-			if($result === false){
-				return "error";
-			}
-			
-			// リダイレクトURL
-	    	$redirect_url = $item_type_result[0]['uri'];
-	    	
-			// 新規査読サプリコンテンツ登録メール送信処理
-			if($review_flg_supple == 1){
-				// 査読を行う
-				if($review_mail_flg == 1){
-					// 言語リソース取得
-					$smartyAssign = $this->Session->getParameter("smartyAssign");
-					// send review mail
-					// 査読通知メールを送信する
-					// 件名
-					// set subject
-					$subj = $smartyAssign->getLang("repository_mail_review_subject");
-					$this->mailMain->setSubject($subj);
-					
-					// page_idおよびblock_idを取得
-					$block_info = $this->getBlockPageId();
-					// メール本文をリソースから読み込む
-					// set Mail body
-					$body = '';
-					$body .= $smartyAssign->getLang("repository_mail_review_body")."\n\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_suppple_contents")."\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_title");
-					if($this->Session->getParameter("_lang") == "japanese"){
-						if($supple_data["supple_title"] != ""){
-							$body .= $supple_data["supple_title"];
-						} else if($supple_data["supple_title_en"] != ""){
-							$body .= $supple_data["supple_title_en"];
-						} else {
-							$body .= "no title";
-						}
-					} else {
-						if($supple_data["supple_title_en"] != ""){
-							$body .= $supple_data["supple_title_en"];
-						} else if($supple_data["supple_title"] != ""){
-							$body .= $supple_data["supple_title"];
-						} else {
-							$body .= "no title";
-						}
-					}
-					
-					$body .= "\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_detailurl").$supple_data["uri"]."\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_title_is_registed");
-					if($this->Session->getParameter("_lang") == "japanese"){
-						if($item_type_result[0]['title'] != ""){
-							$body .= $item_type_result[0]['title'];
-						} else if($item_type_result[0]['title_english'] != ""){
-							$body .= $item_type_result[0]['title_english'];
-						} else {
-							$body .= "no title";
-						}
-					} else {
-						if($item_type_result[0]['title_english'] != ""){
-							$body .= $item_type_result[0]['title_english'];
-						} else if($item_type_result[0]['title'] != ""){
-							$body .= $item_type_result[0]['title'];
-						} else {
-							$body .= "no title";
-						}
-					}
-					$body .= "\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_detailurl_is_registed").$item_type_result[0]['uri']."\n";
-					$body .= "\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_reviewurl")."\n";
-					$body .= BASE_URL;
-					if(substr(BASE_URL,-1,1) != "/"){
-						$body .= "/";
-					}
-					$body .= "?active_action=repository_view_edit_review&review_active_tab=1&page_id=".$block_info["page_id"]."&block_id=".$block_info["block_id"];
-					$body .= "\n\n".$smartyAssign->getLang("repository_mail_review_close");
-					$this->mailMain->setBody($body);
-					// ---------------------------------------------
-					// 送信メール情報取得
-					//   送信者のメールアドレス
-					//   送り主の名前
-					//   送信先ユーザを取得
-					// create mail body
-					//   get send from user mail address
-					//   get send from user name
-					//   get send to user
-					// ---------------------------------------------
-					$users = array();
-					$this->getReviewMailInfo($users);
-					// ---------------------------------------------
-					// 送信先を設定
-					// set send to user
-					// ---------------------------------------------
-					// 送信ユーザを設定
-					// $usersの中身
-					// $users["email"] : 送信先メールアドレス
-					// $user["handle"] : ハンドルネーム
-					//                   なければ空白が自動設定される
-					// $user["type"]   : type (html(email) or text(mobile_email))
-					//                   なければhtmlが自動設定される
-					// $user["lang_dirname"] : 言語
-					//                         なければ現在の選択言語が自動設定される
-					$this->mailMain->setToUsers($users);
-					
-					// ---------------------------------------------
-					// メール送信
-					// send confirm mail
-					// ---------------------------------------------
-					if(count($users) > 0){
-						// 送信者がいる場合は送信
-						$return = $this->mailMain->send();
-					}
-					 
-					// 言語リソース開放
-					$this->Session->removeParameter("smartyAssign");
-					
-				}
-			}
-    	}
-    	
-    	else if($this->mode == "edit"){
-    		// サプリアクションからの遷移を示すフラグ
-            //$this->Session->setParameter("supple_flag", "true");
-            
-            // ユーザID取得
-            $user_id = $this->Session->getParameter("_user_id");
-        	
-        	// サプリアイテム情報取得
-        	$supple_data = array();
-			$supple_data = $this->getSuppleDataFromOpenSearch("weko_id", $this->weko_id);
-			if($supple_data === false){
-				return "error";
-			}
-			
-			// 該当サプリアイテムなし
-			if(count($supple_data) == 0){
-				$this->Session->setParameter("supple_error", 3);
-				return "error";
-			}
-			
-			// 新規査読アイテム登録メール送信処理
-			// 査読通知メールを送るか否か
-    	    $query = "SELECT param_value ".
-					 "FROM ".DATABASE_PREFIX."repository_parameter ".
-					 "WHERE param_name = 'review_mail_flg';";
-			$result = $this->Db->execute($query);
-			if ($result === false) {
-				array_push($error_msg, $this->Db->ErrorMsg());
-				// roll back
-				$this->failTrans();
-				return 'error';
-			}
-			$review_mail_flg = $result[0]['param_value'];
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/30 --start--
+    /**
+     * サプリコンテンツの登録
+     * @param unknown $redirect_url
+     */
+    private function entrySupple()
+    {
+        $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
+        $this->Session->setParameter("supple_flag", "true");
 
-			// サプリコンテンツの査読を行うか否か
-        	$query = "SELECT param_value ".
-        			 "FROM ".DATABASE_PREFIX."repository_parameter ".
-        			 "WHERE param_name = 'review_flg_supple';";
-        	$result = $this->Db->execute($query);
-        	if($result === false){
-                return "error";
-			}
-			$review_flg_supple = $result[0]['param_value'];
-						
-			// サプリアイテム更新
-			$query = "UPDATE ". DATABASE_PREFIX ."repository_supple ".
-					 "SET supple_title = ?, ".
-					 "supple_title_en = ?, ".
-					 "uri = ?, ".
-					 "supple_item_type_name = ?, ".
-					 "mime_type = ?, ".
-					 "file_id = ?, ".
-					 "supple_review_status = ?, ".
-					 "supple_review_date = ?, ".
-					 "supple_reject_status = ?, ".
-					 "supple_reject_date = ?, ".
-					 "supple_reject_reason = ?, ".
-					 "mod_user_id = ?, ".
-					 "del_user_id = ?, ".
-					 "mod_date = ?, ".
-					 "del_date = ?, ".
-					 "is_delete = ? ".
-					 "WHERE item_id = ? ".
-					 "AND item_no = ? ".
-					 "AND attribute_id = ? ".
-					 "AND supple_no = ? ;";
-        	$params = array();
-			$params[] = $supple_data["supple_title"];			// supple_title
-			$params[] = $supple_data["supple_title_en"];		// supple_title_en
-			$params[] = $supple_data["uri"];					// uri
-			$params[] = $supple_data["supple_item_type_name"];	// supple_item_type_name
-			$params[] = $supple_data["mime_type"];				// mime_type
-			$params[] = $supple_data["file_id"];				// file_id
-    		if($review_flg_supple == 1){
-				// 査読を行う
-				$params[] = 0;									// supple_review_status
-				$params[] = "";									// supple_review_date
-				$supple_workflow_active_tab = 1;			// 承認待タブへ
-			} else {
-				// 査読を行わない（自動的に承認する）
-				$params[] = 1;									// supple_review_status
-				$params[] = $this->TransStartDate;				// supple_review_date
-				$supple_workflow_active_tab = 2;			// 承認済タブへ
-			}
-			$params[] = 0;										// supple_reject_status
-			$params[] = "";										// supple_reject_date
-			$params[] = "";										// supple_reject_reason
-			$params[] = $user_id;								// mod_user_id
-			$params[] = null;									// del_user_id
-			$params[] = $this->TransStartDate;					// mod_date
-			$params[] = null;									// del_date
-			$params[] = 0;										// is_delete
-			$params[] = $this->item_id;							// item_id
-			$params[] = $this->item_no;							// item_no
-			$params[] = $this->attribute_id;					// attribute_id
-			$params[] = $this->supple_no;						// supple_no
-			$result = $this->Db->execute($query, $params);
-			if($result === false){
-				return "error";
-			}
-			
-			$id_array = $this->getBlockPageId();
-			
-			// リダイレクトURL
-	    	$redirect_url = BASE_URL."/index.php?action=pages_view_main&active_action=repository_view_main_suppleworkflow".
-	    					"&supple_workflow_active_tab=".$supple_workflow_active_tab.
-	    					"&page_id=".$id_array['page_id'].
-							"&block_id=".$id_array['block_id'];
-	    	
-    		// 査読サプリコンテンツ登録メール送信処理
-			if($review_flg_supple == 1){
-				// 査読を行う
-				if($review_mail_flg == 1){
-					// 登録先アイテム情報取得
-					$query = "SELECT title, title_english, uri ".
-							 "FROM ".DATABASE_PREFIX."repository_item ".
-							 "WHERE item_id = ? ".
-							 "AND item_no = ? ".
-							 "AND is_delete = ?;";
-					$params = array();
-					$params[] = $this->item_id;
-					$params[] = $this->item_no;
-					$params[] = 0;
-					$item_data = $this->Db->execute($query, $params);
-					if($item_data === false){
-						return "error";
-					}
-					
-					// 言語リソース取得
-					$smartyAssign = $this->Session->getParameter("smartyAssign");
-					// send review mail
-					// 査読通知メールを送信する
-					// 件名
-					// set subject
-					$subj = $smartyAssign->getLang("repository_mail_review_subject");
-					$this->mailMain->setSubject($subj);
-					
-					// page_idおよびblock_idを取得
-					$block_info = $this->getBlockPageId();
-					// メール本文をリソースから読み込む
-					// set Mail body
-					$body = '';
-					$body .= $smartyAssign->getLang("repository_mail_review_body")."\n\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_suppple_contents")."\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_title");
-					if($this->Session->getParameter("_lang") == "japanese"){
-						if($supple_data["supple_title"] != ""){
-							$body .= $supple_data["supple_title"];
-						} else if($supple_data["supple_title_en"] != ""){
-							$body .= $supple_data["supple_title_en"];
-						} else {
-							$body .= "no title";
-						}
-					} else {
-						if($supple_data["supple_title_en"] != ""){
-							$body .= $supple_data["supple_title_en"];
-						} else if($supple_data["supple_title"] != ""){
-							$body .= $supple_data["supple_title"];
-						} else {
-							$body .= "no title";
-						}
-					}
-					
-					$body .= "\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_detailurl").$supple_data["uri"]."\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_title_is_registed");
-					if($this->Session->getParameter("_lang") == "japanese"){
-						if($item_data[0]['title'] != ""){
-							$body .= $item_data[0]['title'];
-						} else if($item_data[0]['title_english'] != ""){
-							$body .= $item_data[0]['title_english'];
-						} else {
-							$body .= "no title";
-						}
-					} else {
-						if($item_data[0]['title_english'] != ""){
-							$body .= $item_data[0]['title_english'];
-						} else if($item_data[0]['title'] != ""){
-							$body .= $item_data[0]['title'];
-						} else {
-							$body .= "no title";
-						}
-					}
-					$body .= "\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_supple_detailurl_is_registed").$item_data[0]['uri']."\n";
-					$body .= "\n";
-					$body .= $smartyAssign->getLang("repository_mail_review_reviewurl")."\n";
-					$body .= BASE_URL;
-					if(substr(BASE_URL,-1,1) != "/"){
-						$body .= "/";
-					}
-					$body .= "?active_action=repository_view_edit_review&review_active_tab=1&page_id=".$block_info["page_id"]."&block_id=".$block_info["block_id"];
-					$body .= "\n\n".$smartyAssign->getLang("repository_mail_review_close");
-					$this->mailMain->setBody($body);
-					// ---------------------------------------------
-					// 送信メール情報取得
-					//   送信者のメールアドレス
-					//   送り主の名前
-					//   送信先ユーザを取得
-					// create mail body
-					//   get send from user mail address
-					//   get send from user name
-					//   get send to user
-					// ---------------------------------------------
-					$users = array();
-					$this->getReviewMailInfo($users);
-					// ---------------------------------------------
-					// 送信先を設定
-					// set send to user
-					// ---------------------------------------------
-					// 送信ユーザを設定
-					// $usersの中身
-					// $users["email"] : 送信先メールアドレス
-					// $user["handle"] : ハンドルネーム
-					//                   なければ空白が自動設定される
-					// $user["type"]   : type (html(email) or text(mobile_email))
-					//                   なければhtmlが自動設定される
-					// $user["lang_dirname"] : 言語
-					//                         なければ現在の選択言語が自動設定される
-					$this->mailMain->setToUsers($users);
-					
-					// ---------------------------------------------
-					// メール送信
-					// send confirm mail
-					// ---------------------------------------------
-					if(count($users) > 0){
-						// 送信者がいる場合は送信
-						$return = $this->mailMain->send();
-					}
-					 
-					// 言語リソース開放
-					$this->Session->removeParameter("smartyAssign");
-					
-				}
-			}
-    	}
-    	
-    	// 失敗？？
-    	else {
-    		
-    	}
+        $this->infoLog("businessSupple", __FILE__, __CLASS__, __LINE__);
+        $businessSupple->entrySuppleContents($this->item_id,$this->item_no,$this->weko_id);
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/30 --end--
 
-      	//アクション終了処理
-		$result = $this->exitAction();     // トランザクションが成功していればCOMMITされる
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/30 --start--
+    /**
+     * サプリコンテンツの更新
+     * @param リダイレクトURL $redirect_url
+     */
+    private function updateSupple(&$redirect_url)
+    {
+        // サプリアクションからの遷移を示すフラグ
+        $this->Session->setParameter("supple_flag", "true");
+        // サプリコンテンツ更新
+        $this->infoLog("businessSupple", __FILE__, __CLASS__, __LINE__);
+        $businessSupple = BusinessFactory::getFactory()->getBusiness("businessSupple");
+        $businessSupple->updateSuppleContents($this->item_id,$this->item_no,$this->attribute_id,$this->supple_no,$this->weko_id);
+        $supple_workflow_active_tab = $businessSupple->redirectURLParameterOfSuppleWorkflowActiveTab();
+        
+        // リダイレクトURL
+        $id_array = $this->getBlockPageId();
+        $redirect_url = BASE_URL."/index.php?action=pages_view_main&active_action=repository_view_main_suppleworkflow".
+                "&supple_workflow_active_tab=".$supple_workflow_active_tab.
+                "&page_id=".$id_array['page_id'].
+                "&block_id=".$id_array['block_id'];
+    }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/30 --end--
+
+    // Add suppleContentsEntry Y.Yamazawa --start-- 2015/03/30 --start--
+    /**
+     * リダイレクトURLの取得
+     * @return リダイレクトURL
+     */
+    private function redirectUrl()
+    {
+        // アイテムタイプ情報を取得
+        $query = "SELECT attr_type.item_type_id, attr_type.attribute_id, item.uri, item.title, item.title_english ".
+                "FROM ".DATABASE_PREFIX."repository_item_attr_type AS attr_type, ".DATABASE_PREFIX."repository_item AS item ".
+                "WHERE item.item_id = ? ".
+                "AND item.item_no = ? ".
+                "AND item.item_type_id = attr_type.item_type_id ".
+                "AND attr_type.input_type = 'supple' ".
+                "AND item.is_delete = 0 ".
+                "AND attr_type.is_delete = 0;";
+        $params = array();
+        $params[] = $this->item_id;	// item_id
+        $params[] = $this->item_no;	// item_no
+        $item_type_result = $this->Db->execute($query, $params);
+        if($item_type_result === false){
+            $this->Session->setParameter("supple_error","repository_entry_failed_entry_suppleContents");
+            return "error";
+        }
+        // リダイレクトURL
+        $redirect_url = $item_type_result[0]['uri'];
 
-    	// redirect
-		header("HTTP/1.1 301 Moved Permanently");
-  		header("Location: ".$redirect_url);
-  		
-  		return;
+        return $redirect_url;
     }
+    // Add suppleContentsEntry Y.Yamazawa --end-- 2015/03/30 --end--
 }
 ?>
diff --git a/repository/view/common/item/supple/redirect/maple.ini b/repository/view/common/item/supple/redirect/maple.ini
index b53d5f0..a459bf7 100644
--- a/repository/view/common/item/supple/redirect/maple.ini
+++ b/repository/view/common/item/supple/redirect/maple.ini
@@ -9,9 +9,6 @@ item_no.range ="1, 1, 1:lang._invalid_input"
 mode.required ="1:lang._invalid_input"
 weko_id.required ="1:lang._invalid_input"
 
-[DIContainer]
-filename = "dicon.ini"
-
 [Action]
 Session = "ref:Session"
 Db = "ref:DbObject"
diff --git a/repository/view/common/itemtype/multilang/Multilang.class.php b/repository/view/common/itemtype/multilang/Multilang.class.php
index 426ecab..abea72e 100644
--- a/repository/view/common/itemtype/multilang/Multilang.class.php
+++ b/repository/view/common/itemtype/multilang/Multilang.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Multilang.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Multilang.class.php 22759 2013-05-21 04:47:11Z koji_matsuo $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -34,7 +34,7 @@ class Repository_View_Common_Itemtype_Multilang extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         return "success";
     }
diff --git a/repository/view/common/itemtype/multilang/maple.ini b/repository/view/common/itemtype/multilang/maple.ini
index 3b4ea03..f240dec 100644
--- a/repository/view/common/itemtype/multilang/maple.ini
+++ b/repository/view/common/itemtype/multilang/maple.ini
@@ -6,6 +6,8 @@ sel_node_pid.required ="1:lang._invalid_input"
 default_edit.required ="1:lang._invalid_input"
 
 [Action]
+Session = "ref:Session"
+Db = "ref:DbObject"
 
 [View]
 define:theme = 1
diff --git a/repository/view/common/redirect/Redirect.class.php b/repository/view/common/redirect/Redirect.class.php
index 72ce2e3..78a8ef6 100644
--- a/repository/view/common/redirect/Redirect.class.php
+++ b/repository/view/common/redirect/Redirect.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Redirect.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Redirect.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -37,7 +37,7 @@ class Repository_View_Common_Redirect extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
 		// check base_url with "/"
 		$this->redirect_url = BASE_URL."|";
diff --git a/repository/view/common/usagestatistics/Usagestatistics.class.php b/repository/view/common/usagestatistics/Usagestatistics.class.php
index 87cacf2..a916ecc 100644
--- a/repository/view/common/usagestatistics/Usagestatistics.class.php
+++ b/repository/view/common/usagestatistics/Usagestatistics.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Usagestatistics.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: Usagestatistics.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,7 +12,6 @@
 // --------------------------------------------------------------------
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatistics.class.php';
 
 /**
  * Usage statistics
@@ -110,7 +109,7 @@ class Repository_View_Common_Usagestatistics extends RepositoryAction
      * 
      * @return string
      */
-    public function execute()
+    public function executeApp()
     {
         try
         {
@@ -123,19 +122,36 @@ class Repository_View_Common_Usagestatistics extends RepositoryAction
                 return "error";
             }
             
+            // Set Usage statistics setting 2015/03/24 K.Sugimoto --start--
+            $result = $this->getAdminParam('usagestatistics_link_display', $usagestatistics_link_display, $Error_Msg);
+            if ( $result == false ){
+                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
+                $DetailMsg = null;                              //詳細メッセージ文字列作成
+                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
+                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
+                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
+                throw $exception;
+            }
+            if ($usagestatistics_link_display == 0)
+            {
+            	return "invalid";
+            }
+            // Set Usage statistics setting 2015/03/24 K.Sugimoto --end--
+            
             // Set item title
             $this->setItemTitle();
             
             // Get date array for pulldown
             $this->dateList = $this->setDateList();
             
-            $RepositoryUsagestatistics = new RepositoryUsagestatistics($this->Session, $this->Db, $this->TransStartDate);
+            $this->infoLog("businessUsagestatistics", __FILE__, __CLASS__, __LINE__);
+            $RepositoryUsagestatistics = BusinessFactory::getFactory()->getBusiness("businessUsagestatistics");
             
             // Get usages views
             $this->usagesViews = $RepositoryUsagestatistics->getUsagesViews($this->itemId, $this->itemNo, $this->year, $this->month);
             
             // Get usages downloads
-            $this->usagesDownloads = $RepositoryUsagestatistics->getUsagesDownloads($this->itemId, $this->itemNo, $this->year, $this->month);
+			$this->usagesDownloads = $RepositoryUsagestatistics->getUsagesDownloads($this->itemId, $this->itemNo, $this->year, $this->month);
             
             $this->exitAction();
             return "success";
@@ -278,8 +294,17 @@ class Repository_View_Common_Usagestatistics extends RepositoryAction
         $result = array();
         $this->getItemTableData($this->itemId, $this->itemNo, $result, $errMsg);
         
-        $title = $result["item"][0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE];
-        $titleEn = $result["item"][0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH];
+        $title = 0;
+        $titleEn = 0;
+        
+        if( isset($result["item"][0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE]) ){
+            $title = $result["item"][0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE];
+        }
+        
+        if( isset($result["item"][0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH]) ){
+            $titleEn = $result["item"][0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH];
+        }
+        
         if($this->Session->getParameter("_lang")=="japanese")
         {
             $this->title = $title;
diff --git a/repository/view/common/usagestatistics/maple.ini b/repository/view/common/usagestatistics/maple.ini
index 39fd6ae..a311415 100644
--- a/repository/view/common/usagestatistics/maple.ini
+++ b/repository/view/common/usagestatistics/maple.ini
@@ -7,6 +7,7 @@ define:theme = 1
 define:theme_name = "system"
 success = "repository_usage_statistics.html"
 error = "repository_usage_statistics.html"
+invalid = "repository_error_invalid_auth.html"
 
 [ValidateDef]
 itemId
@@ -18,3 +19,4 @@ month
 define:theme = 1
 success = "repository_mobile_usage_statistics.html"
 error = "repository_mobile_usage_statistics.html"
+invalid = "repository_error_invalid_auth.html"
diff --git a/repository/view/edit/admin/Admin.class.php b/repository/view/edit/admin/Admin.class.php
index 969bf11..75154b7 100644
--- a/repository/view/edit/admin/Admin.class.php
+++ b/repository/view/edit/admin/Admin.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Admin.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Admin.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -16,8 +16,8 @@
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHarvesting.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatisticsSendMail.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchRequestParameter.class.php';
 
 /**
  * [[機能説明]]
@@ -41,6 +41,9 @@ class Repository_View_Edit_Admin extends RepositoryAction
     //Add new prefix2013/12/24T.Ichikawa --start--
     var $prefixJalcDoi = null;
     var $prefixCrossRef = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    var $prefixDataCite = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     var $prefixCnri = null;
     var $prefixYHandle = null;
     //Add new prefix 2013/12/24 T.Ichikawa --end--
@@ -58,12 +61,34 @@ class Repository_View_Edit_Admin extends RepositoryAction
     // Add Detail Search 2013/11/20 R.Matsuura --end--
     public $oaipmh_output_flag = null;
     
+    public $institution_name = null;
+    
+    // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+    public $default_search_type = null;
+    // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+    public $usagestatistics_link_display = null;
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+    public $ranking_tab_display = null;
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+    
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    public $prefix_flag = null;
+    public $exist_doi_item = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
+    public $logTableStatus = null;
+    
+    
     /**
      * [[機能説明]]
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         $istest = true;             // テスト用フラグ
         try {           
@@ -305,59 +330,69 @@ class Repository_View_Edit_Admin extends RepositoryAction
             // ----------------------------------------------------
             // site license
             // ----------------------------------------------------
-            if(isset($admin_params['site_license']['param_value'])) {
-                $site_license = explode("|", $admin_params['site_license']['param_value']);
-            }else {
-                $site_license = array();
-            }
+            // サイトライセンス基本情報取得
+            $query = "SELECT * FROM ". DATABASE_PREFIX. "repository_sitelicense_info ".
+                     "WHERE is_delete = ? ".
+                     "ORDER BY show_order ASC ;";
+            $params = array();
+            $params[] = 0;
+            $sl_info = $this->Db->execute($query, $params);
+            
             $cnt_ipaddress = 0;
+            $sitelicense_id = array();
             $sitelicense_org = array();
+            $sitelicense_group = array();
             $ipaddress_from = array();
             $ipaddress_to = array();
             $sitelicense_mail = array();
-            for($ii=0; $ii<count($site_license); $ii++){
-                if(array_key_exists($ii, $site_license) && strlen($site_license[$ii]) > 0)
-                {
-                    $param_site_license = explode(",", $site_license[$ii]);
-                    if(array_key_exists(1, $param_site_license))
-                    {
-                        $from = explode(".", $param_site_license[1]);
-                        if(count($from) == 4){
-                            array_push($sitelicense_org, $param_site_license[0]);
-                            array_push($sitelicense_mail, $param_site_license[3]);
-                            array_push($ipaddress_from, array($from[0], $from[1], $from[2], $from[3]));
-                            if(array_key_exists(2, $param_site_license))
-                            {
-                                $to = explode(".", $param_site_license[2]);
-                                if(count($to) == 4){
-                                    array_push($ipaddress_to, array($to[0], $to[1], $to[2], $to[3]));
-                                } else {
-                                    array_push($ipaddress_to, array("", "", "", ""));
-                                }
-                            }
+            for($ii=0; $ii<count($sl_info); $ii++){
+                // 機関ID
+                $sitelicense_id[$ii] = $sl_info[$ii]["organization_id"];
+                // 機関名
+                $sitelicense_org[$ii] = $sl_info[$ii]["organization_name"];
+                // 組織名
+                $sitelicense_group[$ii] = $sl_info[$ii]["group_name"];
+                // IPアドレス
+                // サイトライセンスIP情報取得
+                $query = "SELECT * FROM ". DATABASE_PREFIX. "repository_sitelicense_ip_address ".
+                         "WHERE organization_id = ? ".
+                         "AND is_delete = ? ;";
+                $params = array();
+                $params[] = $sl_info[$ii]["organization_id"];
+                $params[] = 0;
+                $ip_address = $this->Db->execute($query, $params);
+                if(isset($ip_address)) {
+                    for($jj = 0; $jj < count($ip_address); $jj++) {
+                        // 開始IPアドレス
+                        if(strlen($ip_address[$jj]["start_ip_address"]) > 0) {
+                            $start_ip_address = explode(".", $ip_address[$jj]["start_ip_address"]);
+                            $ipaddress_from[$ii][$jj] = array($start_ip_address[0], $start_ip_address[1], $start_ip_address[2], $start_ip_address[3]);
+                        } else {
+                            $ipaddress_from[$ii][$jj] = array("", "", "", "");
+                        }
+                        // 終了IPアドレス
+                        if(strlen($ip_address[$jj]["finish_ip_address"]) > 0) {
+                            $finish_ip_address = explode(".", $ip_address[$jj]["finish_ip_address"]);
+                            $ipaddress_to[$ii][$jj] = array($finish_ip_address[0], $finish_ip_address[1], $finish_ip_address[2], $finish_ip_address[3]);
+                        } else {
+                            $ipaddress_to[$ii][$jj] = array("", "", "", "");
                         }
                     }
+                } else {
+                        $ipaddress_from[$ii][0] = array("", "", "", "");
+                        $ipaddress_to[$ii][0] = array("", "", "", "");
                 }
+                // メールアドレス
+                $sitelicense_mail[$ii] = $sl_info[$ii]["mail_address"];
             }
-            // Bugfix Input scrutiny 2011/06/17 Y.Nakao --start--
-            // decode explode delimiters.
-            $sitelicense_org = str_replace("&#124;", "|", $sitelicense_org);
-            $sitelicense_org = str_replace("&#44;", ",", $sitelicense_org);
-            $sitelicense_org = str_replace("&#46;", ".", $sitelicense_org);
-            // Bugfix Input scrutiny 2011/06/17 Y.Nakao --end--
-            // Add decode mail address T.Ichikawa 2014/04/11 --start--
-            // decode explode delimiters.
-            $sitelicense_mail = str_replace("&#124;", "|", $sitelicense_mail);
-            $sitelicense_mail = str_replace("&#44;", ",", $sitelicense_mail);
-            $sitelicense_mail = str_replace("&#46;", ".", $sitelicense_mail);
-            // Add decode mail address T.Ichikawa 2014/04/11 --end--
+            
+            $admin_params["sitelicense_id"]["param_value"] = $sitelicense_id;
             $admin_params["sitelicense_org"]["param_value"] = $sitelicense_org;
+            $admin_params["sitelicense_group"]["param_value"] = $sitelicense_group;
             $admin_params["ip_sitelicense_from"]["param_value"] = $ipaddress_from;
             $admin_params["ip_sitelicense_to"]["param_value"] = $ipaddress_to;
             $admin_params["sitelicense_mail"]["param_value"] = $sitelicense_mail;
             
-            // Add site license 2008/10/20 Y.Nakao --end--
-            
             // Add item type select for site license 2009/01/06 A.Suzuki --start--
             $site_license_item_id = explode(",", $admin_params['site_license_item_type_id']['param_value']);
             
@@ -470,10 +505,11 @@ class Repository_View_Edit_Admin extends RepositoryAction
             // Add send feedback mail to sitelicense user 2014/04/22 T.Ichikawa --end--
             
             // Add feedback mail 2012/08/22 A.Suzuki --start--
-            $SendMail = new RepositoryUsagestatisticsSendMail($this->Session, $this->Db, $this->TransStartDate);
-            
             // Get send mail status
-            $SendMail->openProgressFile(false);
+            $this->infoLog("businessSendusagestatisticsmail", __FILE__, __CLASS__, __LINE__);
+            $SendMail = BusinessFactory::getFactory()->getBusiness("businessSendusagestatisticsmail");
+            // 引数は一番最後以外ダミー（リファレンス渡しになっているので一応変数を書いている）
+            $status = $SendMail->openProgressFile($mailAddress, $orderNum, $isAuhtor, $authorId, false);
             
             $admin_params["feedbackMail_uri"]["path"] = BASE_URL ."/?action=repository_action_common_usagestatisticsmail&login_id=[login_id]&password=[password]";
             $excludeUserDataList = array();
@@ -507,7 +543,7 @@ class Repository_View_Edit_Admin extends RepositoryAction
             }
             $this->Session->setParameter("excludeUserDataList", $excludeUserDataList);
             $this->Session->setParameter("excludeUserDataText", $excludeUserDataText);
-            $this->Session->setParameter("sendFeedbackStatus", $SendMail->getStatus());
+            $this->Session->setParameter("sendFeedbackStatus", $status);
             $this->Session->setParameter("feedbackSendMailActivateFlagOrg", $admin_params["send_feedback_mail_activate_flg"]["param_value"]);
             
             // Add feedback mail 2012/08/22 A.Suzuki --end--
@@ -570,7 +606,7 @@ class Repository_View_Edit_Admin extends RepositoryAction
             }
             // search string 'OAI-PMH'
             $search_result = strpos($resBody, "OAI-PMH");
-
+            
             if(is_numeric($search_result) && $search_result > 0) {
                 // url rewrite is used
                 $show_base_url = BASE_URL ."/oai";
@@ -721,6 +757,11 @@ class Repository_View_Edit_Admin extends RepositoryAction
             if(!isset($this->prefixCrossRef)) {
                 $this->prefixCrossRef = $repositoryHandleManager->getCrossRefPrefix();
             }
+        	// Add DataCite 2015/02/10 K.Sugimoto --start--
+            if(!isset($this->prefixDataCite)) {
+                $this->prefixDataCite = $repositoryHandleManager->getDataCitePrefix();
+            }
+        	// Add DataCite 2015/02/10 K.Sugimoto --end--
             if(!isset($this->prefixCnri)) {
                 $this->prefixCnri = $repositoryHandleManager->getCnriPrefix();
             }
@@ -836,6 +877,179 @@ class Repository_View_Edit_Admin extends RepositoryAction
                 }
             }
             
+            // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+            // Default Search Type
+            if(isset($admin_params["default_search_type"]["param_value"]) 
+                && strlen($admin_params["default_search_type"]["param_value"]) > 0)
+            {
+                $this->default_search_type = $admin_params["default_search_type"]["param_value"];
+            }
+            else
+            {
+            	$searchParam = new RepositorySearchRequestParameter();
+            	$result = $searchParam->getDefaultSearchType();
+                if(count($result) > 0)
+                {
+                    $this->default_search_type = $result[0]['param_value'];
+                }
+            }
+            // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+            // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+            if(isset($admin_params["usagestatistics_link_display"]["param_value"])
+            && strlen($admin_params["usagestatistics_link_display"]["param_value"]) > 0)
+            {
+                $this->usagestatistics_link_display = $admin_params["usagestatistics_link_display"]["param_value"];
+            }
+            else
+            {
+                $query = "SELECT param_value ".
+                        "FROM ".DATABASE_PREFIX."repository_parameter ".
+                        "WHERE param_name = ? ".
+                        "AND is_delete = ? ;";
+                $params = array();
+                $params[] = "usagestatistics_link_display";
+                $params[] = 0;
+                $result = $this->dbAccess->executeQuery($query, $params);
+                if(count($result) > 0)
+                {
+                    $this->usagestatistics_link_display = $result[0]['param_value'];
+                }
+            }
+            
+            // institution name
+            if(isset($admin_params["institution_name"]["param_value"]) 
+                && strlen($admin_params["institution_name"]["param_value"]) > 0)
+            {
+                $this->institution_name = $admin_params["institution_name"]["param_value"];
+            }
+            else
+            {
+                $query = "SELECT param_value ".
+                         "FROM ".DATABASE_PREFIX."repository_parameter ".
+                         "WHERE param_name = ? ".
+                         "AND is_delete = ? ;";
+                $params = array();
+                $params[] = "institution_name";
+                $params[] = 0;
+                $result = $this->dbAccess->executeQuery($query, $params);
+                if(count($result) > 0)
+                {
+                    $this->institution_name = $result[0]['param_value'];
+                }
+            }
+            
+            // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+            // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+            if(isset($admin_params["ranking_tab_display"]["param_value"])
+            && strlen($admin_params["ranking_tab_display"]["param_value"]) > 0)
+            {
+                $this->ranking_tab_display = $admin_params["ranking_tab_display"]["param_value"];
+            }
+            else
+            {
+                $query = "SELECT param_value ".
+                        "FROM ".DATABASE_PREFIX."repository_parameter ".
+                        "WHERE param_name = ? ".
+                        "AND is_delete = ? ;";
+                $params = array();
+                $params[] = "ranking_tab_display";
+                $params[] = 0;
+                $result = $this->dbAccess->executeQuery($query, $params);
+                if(count($result) > 0)
+                {
+                    $this->ranking_tab_display = $result[0]['param_value'];
+                }
+            }
+            // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+            
+        	// Add DataCite 2015/02/10 K.Sugimoto --start--
+	        $query = "SELECT COUNT(*) ".
+	                 "FROM ".DATABASE_PREFIX."repository_doi_status ;";
+            $params = array();
+	        $result = $this->dbAccess->executeQuery($query, $params);
+	        
+	        if(count($result) > 0 && $result[0]["COUNT(*)"] != 0){
+	        	$this->exist_doi_item = 1;
+	        }else{
+	        	$this->exist_doi_item = 0;
+	        }
+
+            if(isset($admin_params["perfix_flag"]["param_value"]) 
+                && strlen($admin_params["prefix_flag"]["param_value"]) > 0)
+            {
+                $this->prefix_flag = $admin_params["prefix_flag"]["param_value"];
+            }
+            else
+            {
+	            $query = "SELECT param_value ".
+	                     "FROM ".DATABASE_PREFIX. "repository_parameter ".
+				         "WHERE `param_name` = ? ".
+                         "AND is_delete = ? ;";
+			    $params = array();
+			    $params[] = "prefix_flag";
+			    $params[] = 0;
+                $result = $this->dbAccess->executeQuery($query, $params);
+                if(count($result) > 0)
+                {
+                    $this->prefix_flag = $result[0]['param_value'];
+                }
+            }
+        	// Add DataCite 2015/02/10 K.Sugimoto --end--
+
+		    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+            if(!isset($admin_params["CrossRefQueryServicesAccount"]["param_value"]))
+            {
+                $query = "SELECT param_value ".
+                        "FROM ".DATABASE_PREFIX."repository_parameter ".
+                        "WHERE param_name = ? ".
+                        "AND is_delete = ? ;";
+                $params = array();
+                $params[] = "crossref_query_service_account";
+                $params[] = 0;
+                $result = $this->dbAccess->executeQuery($query, $params);
+                if(count($result) > 0)
+                {
+			    	$admin_params["CrossRefQueryServicesAccount"]["param_value"] = $result[0]["param_value"];
+                }
+            }
+		    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+            
+            // Add RobotList 2015/04/06 S.Suzuki --start--
+            $query = "SELECT * ".
+                     "FROM ".DATABASE_PREFIX."repository_robotlist_master " . 
+                     "WHERE is_delete = ? ; ";
+            $params = array();
+            $params[] = 0;
+            $result = $this->dbAccess->executeQuery($query, $params);
+            
+            $robotlistInfo = array();
+            
+            for ($ii = 0; $ii < count($result); $ii++){
+                $robotlistInfo[$ii]["robotlist_id"] = $result[$ii]["robotlist_id"];
+                $robotlistInfo[$ii]["url"] = $result[$ii]["robotlist_url"];
+                $robotlistInfo[$ii]["check"]  = $result[$ii]["is_robotlist_use"];
+                $robotlistInfo[$ii]["version"]  = $result[$ii]["robotlist_version"];
+                $robotlistInfo[$ii]["date"]  = $result[$ii]["robotlist_date"];
+                $robotlistInfo[$ii]["revision"]  = $result[$ii]["robotlist_revision"];
+                $robotlistInfo[$ii]["author"]  = $result[$ii]["robotlist_author"];
+            }
+            
+            $admin_params["robotlist"] = $robotlistInfo;
+            
+            // lock テーブルを見て実行中か確認
+            $query = "SELECT * ".
+                     "FROM ".DATABASE_PREFIX."repository_lock " . 
+                     "WHERE process_name = ? ; ";
+            $params = array();
+            $params[] = "Repository_Action_Common_Robotlist";
+            
+            $result = $this->dbAccess->executeQuery($query, $params);
+            
+            $this->logTableStatus = $result[0]["status"];
+            // Add RobotList 2015/04/06 S.Suzuki --start--
+            
             // ----------------------------------------------------
             // 終了処理
             // ----------------------------------------------------
diff --git a/repository/view/edit/adminconf/confirm/Confirm.class.php b/repository/view/edit/adminconf/confirm/Confirm.class.php
index a46af42..4dfbfc9 100644
--- a/repository/view/edit/adminconf/confirm/Confirm.class.php
+++ b/repository/view/edit/adminconf/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Confirm.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/edit/admineditrow/Admineditrow.class.php b/repository/view/edit/admineditrow/Admineditrow.class.php
index d1e08a9..ebf9940 100644
--- a/repository/view/edit/admineditrow/Admineditrow.class.php
+++ b/repository/view/edit/admineditrow/Admineditrow.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Admineditrow.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Admineditrow.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -33,19 +33,43 @@ class Repository_View_Edit_Admineditrow extends RepositoryAction
     // bug fix return from this class, no set prefix 2014/07/03 T.Koyasu --start--
     public $prefixJalcDoi = null;
     public $prefixCrossRef = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    public $prefixDataCite = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
     public $prefixCnri = null;
     public $prefixYHandle = null;
     // bug fix return from this class, no set prefix 2014/07/03 T.Koyasu --end--
     
     // OAI-PMH Output Flag
     public $oaipmh_output_flag = null;
+    
+    // Institution Name
+    public $institutionName = null;
+	
+	// Add Default Search Type 2014/12/03 K.Sugimoto --start--
+    // Default Search Type
+    public $default_search_type = null;
+	// Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+    public $usagestatistics_link_display = null;
+    // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+    public $ranking_tab_display = null;
+    // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
 	
+    // Add DataCite 2015/02/12 K.Sugimoto --start--
+    public $prefix_flag = null;
+    public $exist_doi_item = null;
+    // Add DataCite 2015/02/12 K.Sugimoto --end--
+    
     /**
      * [[機能説明]]
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	// 表示タブ情報
     	if($this->admin_active_tab == ""){
@@ -143,6 +167,25 @@ class Repository_View_Edit_Admineditrow extends RepositoryAction
 	    	$admin_params["disp_index_type"]["param_value"] = $result[0]["param_value"];
         }
         
+	    // Auto Input Metadata by CrossRef DOI 2015/03/04 K.Sugimoto --start--
+        if($admin_params["CrossRefQueryServicesAccount"]["param_value"] == null){
+        	//DBから取得
+	       	$query = "SELECT param_value ".
+	       	         "FROM ". DATABASE_PREFIX ."repository_parameter ".
+	       			 "WHERE param_name = 'crossref_query_service_account'; ";
+	    	//　SELECT実行
+	        $result = $this->Db->execute($query);
+	       	if ($result === false) {
+		        $errNo = $this->Db->ErrorNo();
+		        $errMsg = $this->Db->ErrorMsg();
+		        $this->Session->setParameter("error_code",$errMsg);
+	       		if($istest) { echo $errMsg . "<br>"; }
+		        return 'error';
+	    	}
+	    	$admin_params["CrossRefQueryServicesAccount"]["param_value"] = $result[0]["param_value"];
+        }
+	    // Auto Input Metadata by CrossRef DOI 2015/03/04 K.Sugimoto --end--
+        
         $this->Session->setParameter("admin_params", $admin_params);
         
         // Add Default External Word 2014/06/09 T.Ichikawa --start--
@@ -158,12 +201,62 @@ class Repository_View_Edit_Admineditrow extends RepositoryAction
         $this->getSearchSetting();
         
         // bug fix return from this class, no set prefix 2014/07/03 T.Koyasu --start--
-        $this->getEachPrefix();
+        $this->getEachPrefix($admin_params);
         // bug fix return from this class, no set prefix 2014/07/03 T.Koyasu --end--
         
-        //OAI-PMH Output Flag
+        // OAI-PMH Output Flag
         $this->oaipmh_output_flag = $admin_params["oaipmh_output_flag"]["param_value"];
     	
+        // Institution Name
+        $this->institutionName = $admin_params["institution_name"]["param_value"];
+        
+        // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+        // Default Search Type
+        $this->default_search_type = $admin_params["default_search_type"]["param_value"];
+    	// Add Default Search Type 2014/12/03 K.Sugimoto --end--
+
+        // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --start--
+        $this->usagestatistics_link_display = $admin_params["usagestatistics_link_display"]["param_value"];
+        // Add Usage Statistics link display setting 2014/12/16 K.Matsushita --end--
+
+        // Add ranking tab display setting 2014/12/19 K.Matsushita --start--
+        $this->ranking_tab_display = $admin_params["ranking_tab_display"]["param_value"];
+        // Add ranking tab display setting 2014/12/19 K.Matsushita --end--
+    	
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $query = "SELECT COUNT(*) ".
+                 "FROM ".DATABASE_PREFIX."repository_doi_status ;";
+        $params = array();
+        $result = $this->Db->execute($query, $params);
+        
+        if(count($result) > 0 && $result[0]["COUNT(*)"] != 0){
+        	$this->exist_doi_item = 1;
+        }else{
+        	$this->exist_doi_item = 0;
+        }
+
+        if(isset($admin_params["prefix_flag"]["param_value"]) 
+            && strlen($admin_params["prefix_flag"]["param_value"]) > 0)
+        {
+	        $this->prefix_flag = $admin_params["prefix_flag"]["param_value"];
+        }
+        else
+        {
+            $query = "SELECT param_value ".
+                     "FROM ".DATABASE_PREFIX. "repository_parameter ".
+			         "WHERE `param_name` = ? ".
+                     "AND is_delete = ? ;";
+		    $params = array();
+		    $params[] = "prefix_flag";
+		    $params[] = 0;
+            $result = $this->Db->execute($query, $params);
+            if(count($result) > 0)
+            {
+                $this->prefix_flag = $result[0]['param_value'];
+            }
+        }
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
+
     	return 'success';
     }
     
@@ -192,15 +285,14 @@ class Repository_View_Edit_Admineditrow extends RepositoryAction
      * get each prefix
      *
      */
-    private function getEachPrefix()
+    private function getEachPrefix(&$admin_params)
     {
-        $this->prefixCnri = $this->Session->getParameter("prefixCnri");
-        $this->prefixJalcDoi = $this->Session->getParameter("prefixJalcDoi");
-        $this->prefixCrossRef = $this->Session->getParameter("prefixCrossRef");
-        
-        $this->Session->removeParameter("prefixCnri");
-        $this->Session->removeParameter("prefixJalcDoi");
-        $this->Session->removeParameter("prefixCrossRef");
+        // Add DataCite 2015/02/10 K.Sugimoto --start--
+        $this->prefixCnri = $admin_params["prefixCnri"]["param_value"];
+        $this->prefixJalcDoi = $admin_params["prefixJalcDoi"]["param_value"];
+        $this->prefixCrossRef = $admin_params["prefixCrossRef"]["param_value"];
+        $this->prefixDataCite = $admin_params["prefixDataCite"]["param_value"];
+        // Add DataCite 2015/02/10 K.Sugimoto --end--
         
         $DATE = new Date();
         $this->TransStartDate = $DATE->getDate().".000";
diff --git a/repository/view/edit/cinii/admin/Admin.class.php b/repository/view/edit/cinii/admin/Admin.class.php
index a784e38..b8d1e21 100644
--- a/repository/view/edit/cinii/admin/Admin.class.php
+++ b/repository/view/edit/cinii/admin/Admin.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Admin.class.php 535 2012-12-07 09:26:24Z ivis $
+// $Id: Admin.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -104,7 +104,7 @@ class Repository_View_Edit_Cinii_Admin extends RepositoryAction
 	 *
 	 * @access  public
 	 */
-	function execute()
+	function executeApp()
 	{
 		// show result
 		$this->els_result = $this->Session->getParameter("els_result");
diff --git a/repository/view/edit/import/confirm/Confirm.class.php b/repository/view/edit/import/confirm/Confirm.class.php
index 271aeb9..b693f47 100644
--- a/repository/view/edit/import/confirm/Confirm.class.php
+++ b/repository/view/edit/import/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Confirm.class.php 48455 2015-02-16 10:53:40Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -44,7 +44,7 @@ class Repository_View_Edit_Import_Confirm extends RepositoryAction
     /**
      * @access  public
      */
-    function executeForWeko()
+    function executeApp()
     {
         $this->error_msg = $this->Session->getParameter("error_msg");
         $this->Session->removeParameter("error_msg");
diff --git a/repository/view/edit/import/select/Select.class.php b/repository/view/edit/import/select/Select.class.php
index 6b6701e..b9cb4d2 100644
--- a/repository/view/edit/import/select/Select.class.php
+++ b/repository/view/edit/import/select/Select.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Select.class.php 651 2014-11-13 10:14:11Z ivis $
+// $Id: Select.class.php 43857 2014-11-11 08:54:28Z tomohiro_ichikawa $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/edit/item/setting/Setting.class.php b/repository/view/edit/item/setting/Setting.class.php
index 4a9376e..3c64ee6 100644
--- a/repository/view/edit/item/setting/Setting.class.php
+++ b/repository/view/edit/item/setting/Setting.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setting.class.php 40575 2014-08-28 00:25:12Z tatsuya_koyasu $
+// $Id: Setting.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,6 +13,7 @@
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearch.class.php';
 
 /**
  * [[アイテム管理viewアクション]]
@@ -31,6 +32,9 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
     var $Session = null;
     var $Db = null;
     
+    // エラーメッセージ
+    public $errMsg = null;
+    
     /*
      * 選択タブ
      */
@@ -72,99 +76,127 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
     public $doiData = array();
     public $exist_jalcdoi_prefix = false;
     public $exist_crossref_prefix = false;
+    public $exist_datacite_prefix = false;
+    
+    /*
+     * DOI付与アイテム数表示用
+     */
+    public $doi_count_msg = null;
+    
+    /*
+     * 検索削除表示用
+     */
+    public $searchkeywordForDelete = null; // 検索欄に表示するキーワード
+    public $meta = null;                   // キーワード検索で入力された検索キーワード
+    public $all = null;                    // 全文検索で入力された検索キーワード
+    public $search_type = null;            // キーワード検索なのか、全文検索なのかを保存するフラグ
+    public $titleData = array();           // 検索結果が入った配列
+    public $delete_success_num = 0;        // 削除に成功したアイテム数
+    public $page_no = null;                // 表示しているページ番号
+    public $page_num = 0;                  // 全体のページ数
+    public $list_view_num = 100;           // 1ページに表示するアイテム数
+    public $item_num = null;               // 検索結果の総アイテム数
     
     /**
      * [[機能説明]]
      *
      * @access  public
      */
-    function execute()
+    protected  function executeApp()
     {
-        try{
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                                                  //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );                             //詳細メッセージ設定
-                $this->failTrans();                                                 //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
+        //言語設定
+        $this->setLangResource();
+        
+        // 権限チェック
+        $user_auth_id = $this->Session->getParameter("_user_auth_id");
+        $auth_id = $this->Session->getParameter("_auth_id");
+        if($user_auth_id >= $this->repository_admin_base 
+         && $auth_id >= $this->repository_admin_room)
+        {
+            $this->authCheckFlg = true;
+        }else{
+            $this->authCheckFlg = false;
+            $this->errorLog("viewing rights error", __FILE__, __CLASS__, __LINE__);//エラーログ
+            return "error";
+        }
+        
+        // セッション削除  選択インデックス
+        $this->Session->removeParameter("searchIndexId");
+         
+        // 保存された選択タブを変数に設定
+        if($this->Session->getParameter("item_setting_active_tab") == ""){
+            if(isset($this->item_setting_active_tab)){
+                //Viewからの遷移の場合そのまま
             }
-            
-            //言語設定
-            $this->setLangResource();
-            
-            // 権限チェック
-            $user_auth_id = $this->Session->getParameter("_user_auth_id");
-            $auth_id = $this->Session->getParameter("_auth_id");
-            if($user_auth_id >= $this->repository_admin_base 
-             && $auth_id >= $this->repository_admin_room)
-            {
-                $this->authCheckFlg = true;
-            }else{
-                $this->authCheckFlg = false;
-                $result = $this->exitAction();
-                return "error";
+            else{
+                $this->item_setting_active_tab = 0;
             }
+        } else {
+            $this->item_setting_active_tab = $this->Session->getParameter("item_setting_active_tab");
             
-            // セッション削除  選択インデックス
-            $this->Session->removeParameter("searchIndexId");
-             
-            // 保存された選択タブを変数に設定
-            if($this->Session->getParameter("item_setting_active_tab") == ""){
-                if(isset($this->item_setting_active_tab)){
-                    //Viewからの遷移の場合そのまま
-                }
-                else{
-                    $this->item_setting_active_tab = 0;
-                }
-            } else {
-                $this->item_setting_active_tab = $this->Session->getParameter("item_setting_active_tab");
-                
-            }
+        }
+        
+        //Actionから描画時
+        if($this->Session->getParameter("targetIndexId") != null){
+            $this->sortIndexId = $this->Session->getParameter("targetIndexId");
+            $this->Session->setParameter("searchIndexId", $this->sortIndexId);
+            $this->sortIndexName = $this->getSortIdxName($this->sortIndexId);
+        }
+        
+        // ======================================================================
+        // 検索削除 アイテムから描画時
+        // ======================================================================
+        // 削除成功数
+        if( $this->Session->getParameter("delete_success_num") != null ){
+            $this->delete_success_num = $this->Session->getParameter("delete_success_num");
+        }
+        
+        // 検索欄のキーワード
+        if( $this->Session->getParameter("searchkeywordForDelete") != null ){
+            $searchkeyword = $this->Session->getParameter("searchkeywordForDelete");
+            $this->searchkeywordForDelete = urldecode($searchkeyword);
+        }
             
-            //Actionから描画時
-            if($this->Session->getParameter("targetIndexId") != null){
-                $this->sortIndexId = $this->Session->getParameter("targetIndexId");
-                $this->Session->setParameter("searchIndexId", $this->sortIndexId);
-                $this->sortIndexName = $this->getSortIdxName($this->sortIndexId);
+        // 検索タイプ
+        if( $this->Session->getParameter("search_type") != null ){
+            $search_type = $this->Session->getParameter("search_type");
+            // キーワード検索か全文検索か判定
+            if( $search_type == "simple" ){
+                $this->search_type = "simple";
+            }
+            else 
+            {
+                $this->search_type = "detail";
             }
-            // アイテム管理画面を表示する
-            $this->displayCustomsort();
-            $this->displayEmbago();
-            $this->displayListdelete();
-            $this->displayDoi();
-
-            // セッションクリア
-            $this->Session->removeParameter("targetIndexId");
-            $this->Session->removeParameter("targetIndexName");
-            $this->Session->removeParameter("isDeleteSubIndexItem");
-            $this->Session->removeParameter("item_setting_active_tab");
-            // セッションクリア
-            $this->Session->removeParameter("embargo_flag");
-            $this->Session->removeParameter("embargo_year");
-            $this->Session->removeParameter("embargo_month");
-            $this->Session->removeParameter("embargo_day");
-            $this->Session->removeParameter("license_id");
-            $this->Session->removeParameter("licence_free_text");
-            $this->Session->removeParameter("embargo_recursion");
-            
-            return 'success';
-        }catch(RepositoryException $Exception){
-            //エラーログ出力
-            $this->logFile(
-                "Repository_View_Edit_Item_Setting",                 //クラス名
-                "execute",                      //メソッド名
-                $Exception->getCode(),          //ログID
-                $Exception->getMessage(),       //主メッセージ
-                $Exception->getDetailMsg() );   //詳細メッセージ           
-            //アクション終了処理
-            $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_error_msg);
-            return "error";
         }
+        // ======================================================================
+        
+        // アイテム管理画面を表示する
+        $this->displayCustomsort();
+        $this->displayEmbago();
+        $this->displayListdelete();
+        $this->displayDoi();
+        $this->displaySearchDelete();
+        
+        // セッションクリア
+        $this->Session->removeParameter("targetIndexId");
+        $this->Session->removeParameter("targetIndexName");
+        $this->Session->removeParameter("isDeleteSubIndexItem");
+        $this->Session->removeParameter("item_setting_active_tab");
+        // セッションクリア
+        $this->Session->removeParameter("embargo_flag");
+        $this->Session->removeParameter("embargo_year");
+        $this->Session->removeParameter("embargo_month");
+        $this->Session->removeParameter("embargo_day");
+        $this->Session->removeParameter("license_id");
+        $this->Session->removeParameter("licence_free_text");
+        $this->Session->removeParameter("embargo_recursion");
+        // 検索削除関連セッションクリア
+        $this->Session->removeParameter("delete_success_num");
+        $this->Session->removeParameter("searchkeywordForDelete");
+        $this->Session->removeParameter("search_type");
+        
+        return 'success';
     }
     
     /**
@@ -368,12 +400,27 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
             $this->Session->setParameter("searchIndexId", $this->sortIndexId);
         }
         
+        // DOI付与アイテム数を表示
+        $doi_count = $this->Session->getParameter("doi_count");
+        $this->Session->removeParameter("doi_count");
+        if(isset($doi_count) && $doi_count > 0)
+        {
+	        $smartyAssign = $this->Session->getParameter("smartyAssign");
+	        if($smartyAssign == null || !isset($smartyAssign))
+	        {
+	            $this->setLangResource();
+	            $smartyAssign = $this->Session->getParameter("smartyAssign");
+	        }
+            $this->doi_count_msg = sprintf($smartyAssign->getLang("repository_item_doi_count_msg"), $doi_count);
+        }
+        
         if(isset($this->sortIndexId) && $this->sortIndexId > 0)
         {
             $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
             $this->exist_jalcdoi_prefix = $CheckDoi->existJalcdoiPrefix();
             $this->exist_crossref_prefix = $CheckDoi->existCrossrefPrefix();
-            if($CheckDoi->isHarvestPublicIndex($this->sortIndexId) && ($this->exist_jalcdoi_prefix || $this->exist_crossref_prefix))
+            $this->exist_datacite_prefix = $CheckDoi->existDatacitePrefix();
+            if($CheckDoi->isHarvestPublicIndex($this->sortIndexId) && ($this->exist_jalcdoi_prefix || $this->exist_crossref_prefix || $this->exist_datacite_prefix))
             {
                 //1 データベース[PREFIX]_repository_position_indexテーブルからインデックスの情報を1～100件まで取得する。
                 //  以下のカラム条件に一致するインデックスの情報を1件～100件まで取得する。
@@ -406,31 +453,67 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
                         $cross_ref_grant_flag = $CheckDoi->checkDoiGrant($item_result[$ii]['item_id'], $item_result[$ii]['item_no'], 
                                                Repository_Components_Checkdoi::TYPE_CROSS_REF, 
                                                Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_MANAGEMENT);
-                        if($jalc_doi_grant_flag && $cross_ref_grant_flag)
+                        $datacite_grant_flag = $CheckDoi->checkDoiGrant($item_result[$ii]['item_id'], $item_result[$ii]['item_no'], 
+                                               Repository_Components_Checkdoi::TYPE_DATACITE, 
+                                               Repository_Components_Checkdoi::CHECKING_STATUS_ITEM_MANAGEMENT);
+                        if($jalc_doi_grant_flag && $cross_ref_grant_flag && $datacite_grant_flag)
                         {
-                            // 両方付与可能
+                            // 全て付与可能
                             $this->setDoiData($item_result[$ii]['item_id'],
                                               $item_result[$ii]['item_no'],
                                               $this->doiData, 
                                               Repository_Components_Checkdoi::CAN_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CAN_GRANT_DOI, 
                                               Repository_Components_Checkdoi::CAN_GRANT_DOI);
                         }
-                        else if($jalc_doi_grant_flag && !$cross_ref_grant_flag)
+                        else if($jalc_doi_grant_flag && !$cross_ref_grant_flag && !$datacite_grant_flag)
                         {
                             // JaLC DOIのみ付与可能
                             $this->setDoiData($item_result[$ii]['item_id'],
                                               $item_result[$ii]['item_no'],
                                               $this->doiData, 
                                               Repository_Components_Checkdoi::CAN_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CANNOT_GRANT_DOI, 
                                               Repository_Components_Checkdoi::CANNOT_GRANT_DOI);
                         }
-                        else if(!$jalc_doi_grant_flag && $cross_ref_grant_flag)
+                        else if(!$jalc_doi_grant_flag && $cross_ref_grant_flag && !$datacite_grant_flag)
                         {
                             // Cross Refのみ付与可能
                             $this->setDoiData($item_result[$ii]['item_id'],
                                               $item_result[$ii]['item_no'],
                                               $this->doiData, 
                                               Repository_Components_Checkdoi::CANNOT_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CAN_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CANNOT_GRANT_DOI);
+                        }
+                        else if(!$jalc_doi_grant_flag && !$cross_ref_grant_flag && $datacite_grant_flag)
+                        {
+                            // DataCiteのみ付与可能
+                            $this->setDoiData($item_result[$ii]['item_id'],
+                                              $item_result[$ii]['item_no'],
+                                              $this->doiData, 
+                                              Repository_Components_Checkdoi::CANNOT_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CANNOT_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CAN_GRANT_DOI);
+                        }
+                        else if($jalc_doi_grant_flag && $cross_ref_grant_flag && !$datacite_grant_flag)
+                        {
+                            // JaLC DOI、Cross Ref付与可能
+                            $this->setDoiData($item_result[$ii]['item_id'],
+                                              $item_result[$ii]['item_no'],
+                                              $this->doiData, 
+                                              Repository_Components_Checkdoi::CAN_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CAN_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CANNOT_GRANT_DOI);
+                        }
+                        else if($jalc_doi_grant_flag && !$cross_ref_grant_flag && $datacite_grant_flag)
+                        {
+                            // JaLCDOI、DataCite付与可能
+                            $this->setDoiData($item_result[$ii]['item_id'],
+                                              $item_result[$ii]['item_no'],
+                                              $this->doiData, 
+                                              Repository_Components_Checkdoi::CAN_GRANT_DOI, 
+                                              Repository_Components_Checkdoi::CANNOT_GRANT_DOI, 
                                               Repository_Components_Checkdoi::CAN_GRANT_DOI);
                         }
                     }
@@ -438,6 +521,8 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
                     {
                         break;
                     }
+                    
+                    $count++;
                 }
             }
         }
@@ -449,8 +534,9 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
      * @param doi_data
      * @param jalc_doi_flag  0:can grant 1:cannot grant
      * @param cross_ref_flag 0:can grant 1:cannot grant
+     * @param datacite_flag 0:can grant 1:cannot grant
      */
-    private function setDoiData($item_id, $item_no, &$doi_data, $jalc_doi_flag, $cross_ref_flag)
+    private function setDoiData($item_id, $item_no, &$doi_data, $jalc_doi_flag, $cross_ref_flag, $datacite_flag)
     {
         $query = "SELECT item_id, item_no, title, title_english ".
                  "FROM ".DATABASE_PREFIX."repository_item ".
@@ -468,9 +554,121 @@ class Repository_View_Edit_Item_Setting extends RepositoryAction
         {
             $result[0]['jalc_doi'] = $jalc_doi_flag;
             $result[0]['cross_ref'] = $cross_ref_flag;
+            $result[0]['datacite'] = $datacite_flag;
             //3 リクエストパラメータ:doiDataに2で取得したアイテム情報を格納する。
             array_push($doi_data,$result[0]);
         }
     }
+    
+    /**
+     * 検索削除
+     */
+    private function displaySearchDelete(){
+        
+        // 検索ボタンが押下されたまたはactionから戻ってきて検索キーワードがある
+        if( $this->meta != null || $this->all != null || $this->searchkeywordForDelete != null ){
+            
+            $repositorySearch = new RepositorySearch();
+            
+            $repositorySearch->list_view_num = $this->list_view_num;
+            
+            // アイテムの順序はタイトル順で固定
+            $repositorySearch->sort_order = Repository_Components_Querygenerator::ORDER_TITLE_ASC;
+            
+            $this->page_no = $repositorySearch->page_no;
+            
+            // キーワードを検索欄に表示するために設定
+            if( $this->meta != null ){
+                $this->meta = urldecode($this->meta);
+                $this->searchkeywordForDelete = $this->meta;
+                $repositorySearch->search_term[repositorySearch::REQUEST_META] = $this->searchkeywordForDelete;
+                $this->search_type = "simple";
+            }
+            else if( $this->all != null )
+            {
+                $this->all = urldecode($this->all);
+                $this->searchkeywordForDelete = $this->all;
+                $repositorySearch->search_term[repositorySearch::REQUEST_ALL] = $this->searchkeywordForDelete;
+                $this->search_type = "detail";
+            }
+            else{
+                // actionから戻ってきた場合、検索実行のための処理
+                // actionからの場合リクエストパラメータから自動で取得してくれないので検索キーワードを設定する
+                if( $this->search_type === "simple" ){
+                    $repositorySearch->search_term[repositorySearch::REQUEST_META] = $this->searchkeywordForDelete;
+                }
+                else if( $this->search_type === "detail" )
+                {
+                    $repositorySearch->search_term[repositorySearch::REQUEST_ALL] = $this->searchkeywordForDelete;
+                }
+            }
+            
+            $this->infoLog("repositorySearch search_term:".print_r($repositorySearch->search_term, true), __FILE__, __CLASS__, __LINE__);
+            
+            // 検索実行
+            $result = $repositorySearch->search();
+            
+            // アイテム総数は検索した後に分かる
+            $this->item_num = $repositorySearch->getTotal();
+            
+            // 表示されるページ数計算
+            $this->page_num = (int)($this->item_num / $this->list_view_num);
+            if(($this->item_num%$this->list_view_num) != 0){
+                $this->page_num++;
+            }
+            
+            // 検索結果がある場合表示のために整形する
+            if(count($result) > 0){
+                $this->displaySearchResult($result);
+            }
+        }
+        else{
+            
+            return true;
+        }
+    }
+    
+    /**
+     * 検索削除 検索結果整形
+     * @param searchResult search()の戻り値 Array([0] => Array ( [item_id] => 5 [item_no] => 1 [uri] => http://localhost/netcommons2.4.2.0/htdocs/?action=repository_uri&item_id=5 ))
+     */
+    private function displaySearchResult($searchResult){
+        
+        // タイトルを取得して配列に加える
+        for( $ii=0; $ii<count($searchResult); $ii++ ){
+            
+            $item_id = $searchResult[$ii]['item_id'];
+            $item_no = $searchResult[$ii]['item_no'];
+            
+            $query = " SELECT title, title_english ".
+                     " FROM ".DATABASE_PREFIX."repository_item ".
+                     " WHERE item_id = ? ".
+                     " AND item_no = ? ".
+                     " AND is_delete = ? ;";
+            $params = array();
+            $params[] = $item_id;
+            $params[] = $item_no;
+            $params[] = 0;
+            // SELECT実行
+            $selectTitle = $this->dbAccess->executeQuery($query, $params);
+            
+            if(isset($selectTitle[0]))
+            {
+                // タイトルを追加
+                $arr_title = array( 'title' => $selectTitle[0]['title'] );
+                $searchResult[$ii] += $arr_title;
+                
+                $arr_title_english = array( 'title_english' => $selectTitle[0]['title_english'] );
+                $searchResult[$ii] += $arr_title_english;
+            }
+        }
+        
+        // メンバ変数に整形後の配列を代入
+        $this->titleData = $searchResult;
+        
+        // セッションに検索結果を保存
+        $this->Session->setParameter("search_delete_item_data", $searchResult);
+    }
+    
 }
 ?>
diff --git a/repository/view/edit/itemtype/confirm/Confirm.class.php b/repository/view/edit/itemtype/confirm/Confirm.class.php
index 3b9305c..fa8c4f5 100644
--- a/repository/view/edit/itemtype/confirm/Confirm.class.php
+++ b/repository/view/edit/itemtype/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Confirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -24,8 +24,6 @@ require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.
  */
 class Repository_View_Edit_Itemtype_Confirm extends RepositoryAction 
 {
-	// 使用コンポーネントを受け取るため
-	var $Session = null;
 	// メタデータ表示用メンバ
 	var $metadata_array = null;		// メタデータ表示内容配列
 	var $metadata_title = null;		// メタデータ項目名配列
@@ -43,30 +41,13 @@ class Repository_View_Edit_Itemtype_Confirm extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         
         // Add theme_name for image file Y.Nakao 2011/08/03 --start--
         $this->setThemeName();
         // Add theme_name for image file Y.Nakao 2011/08/03 --end--
         
-    	/* 2008/02/27 htmlから直接セッション情報を読み込む形に変更
-    	// 材料はsessionに保存済み。本当は今更することはないか。
-    	
-       	// 
-    	// メタデータ入力情報初期設定
-		//
-    	$this->metadata_array = array();
-    	$this->metadata_title = $this->session->getParameter("metadata_title");
-    	$this->metadata_type = $this->session->getParameter("metadata_type");
-	    $this->metadata_required = $this->session->getParameter("metadata_required");
-   		$this->metadata_disp = $this->session->getParameter("metadata_disp");
-    	for($ii=0; $ii<count($this->metadata_title); $ii++) {
-    		array_push($this->metadata_array , array($this->metadata_title[$ii],
-    				$this->metadata_type[$ii], $this->metadata_required[$ii],
-    				$this->metadata_disp[$ii]));
-    	}
-    	*/
         // Set help icon setting 2010/02/10 K.Ando --start--
         $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
 		if ( $result == false ){
diff --git a/repository/view/edit/itemtype/edit/Edit.class.php b/repository/view/edit/itemtype/edit/Edit.class.php
index 6d88f4b..21e08c1 100644
--- a/repository/view/edit/itemtype/edit/Edit.class.php
+++ b/repository/view/edit/itemtype/edit/Edit.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Edit.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Edit.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -61,7 +61,7 @@ class Repository_View_Edit_Itemtype_Edit extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         
         // Add theme_name for image file Y.Nakao 2011/08/03 --start--
diff --git a/repository/view/edit/itemtype/icon/Icon.class.php b/repository/view/edit/itemtype/icon/Icon.class.php
index 1abe695..0d2b761 100644
--- a/repository/view/edit/itemtype/icon/Icon.class.php
+++ b/repository/view/edit/itemtype/icon/Icon.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Icon.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Icon.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -36,7 +36,7 @@ class Repository_View_Edit_Itemtype_Icon extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         // Add theme_name for image file Y.Nakao 2011/08/03 --start--
         $this->setThemeName();
diff --git a/repository/view/edit/itemtype/import/Import.class.php b/repository/view/edit/itemtype/import/Import.class.php
index 1825ca4..3c66387 100644
--- a/repository/view/edit/itemtype/import/Import.class.php
+++ b/repository/view/edit/itemtype/import/Import.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Import.class.php 270 2009-01-21 04:50:41Z ivis $
+// $Id: Import.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,19 +12,20 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
  * [[Item Type Import]]
  *
  * @access      public
  */
-class Repository_View_Edit_Itemtype_Import
+class Repository_View_Edit_Itemtype_Import extends RepositoryAction
 {
 	
     /**
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         return 'success';
     }
diff --git a/repository/view/edit/itemtype/import/maple.ini b/repository/view/edit/itemtype/import/maple.ini
index bee5eb1..97d14fc 100644
--- a/repository/view/edit/itemtype/import/maple.ini
+++ b/repository/view/edit/itemtype/import/maple.ini
@@ -5,8 +5,8 @@
 ;*.trim =
 
 [Action]
-session = "ref:Session"
-db = "ref:DbObject"
+Session = "ref:Session"
+Db = "ref:DbObject"
 
 [View]
 :define:theme = 1
diff --git a/repository/view/edit/itemtype/mapping/Mapping.class.php b/repository/view/edit/itemtype/mapping/Mapping.class.php
index d527137..78b4aee 100644
--- a/repository/view/edit/itemtype/mapping/Mapping.class.php
+++ b/repository/view/edit/itemtype/mapping/Mapping.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Mapping.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Mapping.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -46,7 +46,7 @@ class Repository_View_Edit_Itemtype_Mapping extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         
         // Add theme_name for image file Y.Nakao 2011/08/03 --start--
diff --git a/repository/view/edit/itemtype/mappingconfirm/Mappingconfirm.class.php b/repository/view/edit/itemtype/mappingconfirm/Mappingconfirm.class.php
index 9bd3266..2aa7fbf 100644
--- a/repository/view/edit/itemtype/mappingconfirm/Mappingconfirm.class.php
+++ b/repository/view/edit/itemtype/mappingconfirm/Mappingconfirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Mappingconfirm.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Mappingconfirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -38,7 +38,7 @@ class Repository_View_Edit_Itemtype_Mappingconfirm extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         
         // Add theme_name for image file Y.Nakao 2011/08/03 --start--
diff --git a/repository/view/edit/itemtype/setting/Setting.class.php b/repository/view/edit/itemtype/setting/Setting.class.php
index 23eecb6..6e169f5 100644
--- a/repository/view/edit/itemtype/setting/Setting.class.php
+++ b/repository/view/edit/itemtype/setting/Setting.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setting.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: Setting.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -41,7 +41,7 @@ class Repository_View_Edit_Itemtype_Setting extends RepositoryAction
 	 *
 	 * @access  public
 	 */
-	function execute()
+	function executeApp()
 	{
 	    
             // Add theme_name for image file Y.Nakao 2011/08/03 --start--
diff --git a/repository/view/edit/log/Log.class.php b/repository/view/edit/log/Log.class.php
index 60bfc4f..bea681e 100644
--- a/repository/view/edit/log/Log.class.php
+++ b/repository/view/edit/log/Log.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Log.class.php 562 2014-04-14 01:03:17Z ivis $
+// $Id: Log.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -60,7 +60,7 @@ class Repository_View_Edit_Log extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	// 開始・終了日の選択候補（デフォルトチェック込み）文字列の作成
     	// 年
diff --git a/repository/view/edit/maple.ini b/repository/view/edit/maple.ini
index 5e35f82..4985733 100644
--- a/repository/view/edit/maple.ini
+++ b/repository/view/edit/maple.ini
@@ -29,4 +29,4 @@ module = main.ini
 ;config = main.ini
 
 [Action]
-db = "ref:DbObject"
+Db = "ref:DbObject"
diff --git a/repository/view/edit/prefix/confirm/Confirm.class.php b/repository/view/edit/prefix/confirm/Confirm.class.php
index 8c67622..6b892ab 100644
--- a/repository/view/edit/prefix/confirm/Confirm.class.php
+++ b/repository/view/edit/prefix/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 567 2014-05-21 08:30:29Z ivis $
+// $Id: Confirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -14,6 +14,7 @@
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
  * [[機能説明]]
@@ -34,7 +35,7 @@ class Repository_View_Edit_Prefix_Confirm extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         /////////////////////////////////
         // get PrefixID from DB
diff --git a/repository/view/edit/prefix/image/Image.class.php b/repository/view/edit/prefix/image/Image.class.php
index 3284f19..9f18f8c 100644
--- a/repository/view/edit/prefix/image/Image.class.php
+++ b/repository/view/edit/prefix/image/Image.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Image.class.php 427 2010-08-09 01:03:45Z ivis $
+// $Id: Image.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -30,7 +30,7 @@ class Repository_View_Edit_Prefix_Image extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	$DATE = new Date();
     	$this->nowtime = $DATE->getDate(DATE_FORMAT_TIMESTAMP);
diff --git a/repository/view/edit/prefix/setpath/Setpath.class.php b/repository/view/edit/prefix/setpath/Setpath.class.php
index 68a36e3..9f3d2fb 100644
--- a/repository/view/edit/prefix/setpath/Setpath.class.php
+++ b/repository/view/edit/prefix/setpath/Setpath.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Setpath.class.php 328 2009-05-15 08:09:28Z ivis $
+// $Id: Setpath.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -29,7 +29,7 @@ class Repository_View_Edit_Prefix_Setpath extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
     	return 'success';
     }
diff --git a/repository/view/edit/review/Review.class.php b/repository/view/edit/review/Review.class.php
index 12939d1..d9528b6 100644
--- a/repository/view/edit/review/Review.class.php
+++ b/repository/view/edit/review/Review.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Review.class.php 436 2010-10-06 00:30:06Z ivis $
+// $Id: Review.class.php 1603 2010-10-05 06:03:04Z atsushi_suzuki $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/edit/tree/Tree.class.php b/repository/view/edit/tree/Tree.class.php
index bf4b6be..d7b9050 100644
--- a/repository/view/edit/tree/Tree.class.php
+++ b/repository/view/edit/tree/Tree.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Tree.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Tree.class.php 38124 2014-07-01 06:56:02Z rei_matsuura $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/main/charge/Charge.class.php b/repository/view/main/charge/Charge.class.php
index f9464a9..66c76d3 100644
--- a/repository/view/main/charge/Charge.class.php
+++ b/repository/view/main/charge/Charge.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Charge.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Charge.class.php 41863 2014-09-22 08:45:13Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/main/export/detailconfirm/Detailconfirm.class.php b/repository/view/main/export/detailconfirm/Detailconfirm.class.php
index 9672e33..bbba10c 100644
--- a/repository/view/main/export/detailconfirm/Detailconfirm.class.php
+++ b/repository/view/main/export/detailconfirm/Detailconfirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Detailconfirm.class.php 610 2014-08-29 07:24:55Z ivis $
+// $Id: Detailconfirm.class.php 40423 2014-08-26 02:30:50Z tatsuya_koyasu $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/main/export/list/List.class.php b/repository/view/main/export/list/List.class.php
index fd5b4c6..b88790a 100644
--- a/repository/view/main/export/list/List.class.php
+++ b/repository/view/main/export/list/List.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: List.class.php 554 2014-02-17 10:55:47Z ivis $
+// $Id: List.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -34,7 +34,7 @@ class Repository_View_Main_Export_List extends RepositoryAction
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         //$this->setLangResource();
         $smartyAssign = $this->Session->getParameter("smartyAssign");
diff --git a/repository/view/main/item/confirm/Confirm.class.php b/repository/view/main/item/confirm/Confirm.class.php
index 02103a3..77e3dda 100644
--- a/repository/view/main/item/confirm/Confirm.class.php
+++ b/repository/view/main/item/confirm/Confirm.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Confirm.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Confirm.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,53 +12,80 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：確認画面表示
  *
- * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Item_Confirm extends RepositoryAction
+class Repository_View_Main_Item_Confirm extends WekoAction
 {
-    var $error_msg = array();        // エラーメッセージ
-    var $warning = "";        // 警告
+    // 表示用パラメーター
+    /**
+     * input_type : textarea 表示用配列
+     * @var array
+     */
+    public $textarea_data = array();
+    
+    /**
+     * input_type : link 表示用配列
+     * @var array
+     */
+    public $link_data = array();
+    
+    /**
+     * ファイルライセンス情報表示用配列
+     * @var array
+     */
+    public $license_data = array();
     
-    // for Linefeed of textarea 
-    var $Session = null;
-    var $Db = null;
-    var $textarea_data = array();
-    var $link_data = array();
-    var $license_data = array();
+    /**
+     * input_type : heading 表示用配列
+     * @var array
+     */
+    public $heading = array();
     
-    // Set help icon setting 2010/02/10 K.Ando --start--
-    var $help_icon_display =  "";
-    // Set help icon setting 2010/02/10 K.Ando --end--
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
+     */
+    public $help_icon_display =  "";
     
-    // Add contents page Y.Nakao 2010/08/06 --start--
-    var $heading = array();
-    // Add contents page Y.Nakao 2010/08/06 --end--
+    // リクエストパラメーター
+    /**
+     * 警告メッセージ配列
+     * @var array
+     */
+    public $warningMsg = null;
     
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * 実行処理
+     * @see ActionBase::executeApp()
      */
-    function execute()
+    protected function executeApp()
     {
+        if(!is_array($this->warningMsg)){
+            $this->warningMsg = array();
+        }
         
-        // Add theme_name for image file Y.Nakao 2011/08/03 --start--
-        $this->setThemeName();
-        // Add theme_name for image file Y.Nakao 2011/08/03 --end--
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setLangResource();
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
         
+        // セッション情報取得
         $attr_type = $this->Session->getParameter("item_attr_type");
         $item_attr = $this->Session->getParameter("item_attr");
         $license_master = $this->Session->getParameter("license_master");
         
         $this->textarea_data = array();
-        
         for($ii=0; $ii<count($attr_type); $ii++){
             if($attr_type[$ii]['input_type'] == "textarea"){
                 $tmp_textarea_data = array();
@@ -87,58 +114,15 @@ class Repository_View_Main_Item_Confirm extends RepositoryAction
                     }
                 }
             }
-            // Add contents page Y.Nakao 2010/08/06 --start--
             else if($attr_type[$ii]['input_type'] == 'heading'){
                 for($jj=0; $jj<count($item_attr[$ii]); $jj++){
                     $this->heading[$jj] = explode("|", $item_attr[$ii][$jj], 4);
                 }
             }
-            // Add contents page Y.Nakao 2010/08/06 --end--
-        }
-        
-        // Add registered info save action 2009/02/13 Y.Nakao --start--
-        // check all input data
-        $base_attr = $this->Session->getParameter("base_attr");
-        $item_pub_date = $this->Session->getParameter("item_pub_date");
-        $item_attr_type = $this->Session->getParameter("item_attr_type");
-        $item_num_attr = $this->Session->getParameter("item_num_attr");
-        $item_attr = $this->Session->getParameter("item_attr");
-        $item_attr_type = $this->Session->getParameter("item_attr_type");
-        $indice = $this->Session->getParameter("indice");
-        // 基本情報チェック
-        $this->error_msg = array();
-        $this->warning = '';
-        if($this->Session->getParameter("error_msg") != null){
-            // addDBでのエラー
-            $this->error_msg = $this->Session->getParameter("error_msg");
-        }
-        $ItemRegister = new ItemRegister($this->Session, $this->Db);
-        $item = array();
-        $item["item_id"] = intval($this->Session->getParameter("edit_item_id"));
-        $item["item_no"] = intval($this->Session->getParameter("edit_item_no"));
-        $item['title'] = $base_attr["title"];
-        $item['title_english'] = $base_attr["title_english"];
-        //Add language 2009/08/26 K.Ito --start--
-        $item['language'] = $base_attr["language"];
-        //Add language 2009/08/26 K.Ito --end--
-        $item['pub_year'] = $item_pub_date["year"];
-        $item['pub_month'] = $item_pub_date["month"];
-        $item['pub_day'] = $item_pub_date["day"];
-        $ItemRegister->checkBaseInfo($item, $this->error_msg, $this->warning);
-        $ItemRegister->checkEntryInfo($item_attr_type, $item_num_attr, $item_attr, 'all', $this->error_msg, $this->warning);
-        $ItemRegister->checkIndex($indice, $this->error_msg, $this->warning);
-        
-        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --start--
-        $contributorErrorMsg = $this->Session->getParameter("contributorErrorMsg");
-        if(strlen($contributorErrorMsg) > 0)
-        {
-            array_push($this->error_msg, $contributorErrorMsg);
         }
-        // Add Contributor(Posted agency) A.Suzuki 2011/12/13 --end--
         
-        // 
         $this->Session->removeParameter('item_entry_flg');
-        if(count($this->error_msg) == 0){
+        if(count($this->errMsg) == 0){
             // entry OK
             $this->Session->setParameter('item_entry_flg', 'true');
         } else {
@@ -146,23 +130,16 @@ class Repository_View_Main_Item_Confirm extends RepositoryAction
             $this->Session->setParameter('item_entry_flg', 'false');
         }
         
-        // Add registered info save action 2009/02/13 Y.Nakao --end--
-        
-        // Add review mail setting 2009/09/30 Y.Nakao --start--
-        $this->setLangResource();
-        // Add review mail setting 2009/09/30 Y.Nakao --end--
-        
-        // Set help icon setting 2010/02/10 K.Ando --start--
-        $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-        if ( $result == false ){
-            $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-            $DetailMsg = null;                              //詳細メッセージ文字列作成
-            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
             throw $exception;
         }
-        // Set help icon setting 2010/02/10 K.Ando --end--
+        
         return 'success';
     }
 }
diff --git a/repository/view/main/item/confirm/maple.ini b/repository/view/main/item/confirm/maple.ini
index b676de5..2f34466 100644
--- a/repository/view/main/item/confirm/maple.ini
+++ b/repository/view/main/item/confirm/maple.ini
@@ -11,3 +11,4 @@ Db = "ref:DbObject"
 [View]
 define:theme = 1
 success = "repository_item_confirm.html"
+error = "repository_item_confirm.html"
diff --git a/repository/view/main/item/detail/Detail.class.php b/repository/view/main/item/detail/Detail.class.php
index e121a35..f80ccbf 100644
--- a/repository/view/main/item/detail/Detail.class.php
+++ b/repository/view/main/item/detail/Detail.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Detail.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Detail.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -15,7 +15,6 @@
 
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryUsagestatistics.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryItemAuthorityManager.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexAuthorityManager.class.php';
@@ -92,6 +91,10 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
     var $oaiore_icon_display = "";
     // Set help icon setting 2010/02/10 K.Ando --end--
     
+    // Set Usage statistics setting 2014/12/15 K.Matsushita --start--
+    var $usagestatistics_link_display = "";
+    // Set Usage statistics setting 2014/12/15 K.Matsushita --end--
+    
     // For flash annotation
     var $encode_baseurl = "";
     var $annoteaUser = "";
@@ -178,13 +181,20 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
     // Add for JaLC DOI R.Matsuura 2014/06/13 --start--
     public $self_doi_uri = null;
     // Add for JaLC DOI R.Matsuura 2014/06/13 --end--
+    // Add DataCite K.Sugimoto 2015/02/16 --start--
+    public $doi_type = null;
+    // Add DataCite K.Sugimoto 2015/02/16 --end--
+    
+    // Add for display shown_status only login user K.Matsushita 2014/12/12 --start--
+    public $user_id = null;
+    // Add for display shown_status only login user K.Matsushita 2014/12/12 --end--
     
     /**
      * [[機能説明]]
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         try {
             //アクション初期化処理
@@ -199,6 +209,10 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                 throw $exception;
             }
             
+            // Add for display shown_status only login user K.Matsushita 2014/12/12 --start--
+            $this->user_id = $this->Session->getParameter("_user_id");
+            // Add for display shown_status only login user K.Matsushita 2014/12/12 --end--
+            
             $searchParam = new RepositorySearchRequestParameter();
             $searchParam->setRequestParameterFromReferrer();
             $searchParam->setActionParameter();
@@ -233,7 +247,8 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
 
             // Create instance
             $NameAuthority = new NameAuthority($this->Session, $this->Db);
-            $this->RepositoryUsagestatistics = new RepositoryUsagestatistics($this->Session, $this->Db, $this->TransStartDate);
+            $this->infoLog("businessUsagestatistics", __FILE__, __CLASS__, __LINE__);
+            $this->RepositoryUsagestatistics = BusinessFactory::getFactory()->getBusiness("businessUsagestatistics");
             
             // For flash annotation
             $this->encode_baseurl = urlencode(BASE_URL);
@@ -258,7 +273,12 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             // Fix redirct prev page 2009/07/17 A.Suzuki --start--
             if($this->Session->getParameter("supple_flag") != "true"){
                 $tmp_uri = urldecode($this->Session->getParameter("prev_page_uri"));
-                $prev_page_uri = $_SERVER["HTTP_REFERER"];
+                if(isset($_SERVER["HTTP_REFERER"])){
+                	$prev_page_uri = $_SERVER["HTTP_REFERER"];
+                }
+                else{
+                	$prev_page_uri = "";
+                }
                 if($tmp_uri != "" && $tmp_uri != null && BASE_URL."/?".$_SERVER["QUERY_STRING"] == $prev_page_uri){
                     $this->Session->setParameter("prev_page_uri", urlencode($tmp_uri));
                 } else if(strpos($prev_page_uri, BASE_URL) == 0){
@@ -309,16 +329,9 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             // Add supple error message 2009/08/27 A.Suzuki --start--
             // 言語リソースを設定
             $this->setLangResource();
-            if($this->Session->getParameter("supple_error") === 1){
-                // no set address error
-                $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang("repository_supple_no_address");
-            } else if($this->Session->getParameter("supple_error") === 2){
-                // get false error
-                $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang("repository_supple_get_false");
-            } else if($this->Session->getParameter("supple_error") === 3){
-                // no item error
-                $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang("repository_supple_no_item");
-            }
+            // Update for entry SuppleContents Y.Yamazawa 2015/03/30 --start--
+            $this->setSuppleErrorFromSessionParameter();
+            // Update for entry SuppleContents Y.Yamazawa 2015/03/30 --end--
 
             $this->Session->removeParameter("supple_error");
             // Add supple error message 2009/08/27 A.Suzuki --end--
@@ -668,7 +681,7 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                     $query = "SELECT `index_name` ".
                              "FROM ". DATABASE_PREFIX ."repository_index ".
                              "WHERE `index_id` IN (".implode(",", $pos_index_id).") ".
-                             "AND `is_delete` = '0' ";
+                             "AND `is_delete` = 0 ";
                     // Add config management authority 2010/02/23 Y.Nakao --start--
                     // if($user_auth_id < _AUTH_MODERATE){
                     if($user_auth_id < $this->repository_admin_base || $auth_id < $this->repository_admin_room){
@@ -845,47 +858,32 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                 $this->IsSelectDelete = "true";
                 $this->IsSelectEdit = "true";
                 $this->IsSelectShow = "true";
-                $this->IsSuppleAdd = "true";    // Add supple add flag 2009/08/28 A.Suzuki
             } else {
                 // システム管理者、アイテム登録者以外 閲覧のみ
                 $this->IsSelectPublish = "false";
                 $this->IsSelectDelete = "false";
                 $this->IsSelectEdit = "false";
                 $this->IsSelectShow = "false";
-                
-                // Add supple add flag 2009/08/28 A.Suzuki --start--
-                // 所属インデックスに投稿権限があるユーザの場合
-                for($ii=0; $ii<count($result); $ii++){
-                    $query = "SELECT access_role FROM ".DATABASE_PREFIX."repository_index ".
-                             "WHERE index_id = ? ".
-                             "AND is_delete = 0;";
-                    $params = array();
-                    $params[] = $result[$ii]["index_id"];
-                    $ret = $this->Db->execute($query, $params);
-                    if($ret === false ){
-                        $this->failTrans();
-                        // Add smartPhone support T.Koyasu 2012/04/09 -start-
-                        if($this->smartphoneFlg) {
-                            return 'error_sp';
-                        } else {
-                            return "error";
-                        }
-                        // Add smartPhone support T.Koyasu 2012/04/09 -end-
-                    }
-                    $access_role_ids = explode(",", $ret[0]['access_role']);
-                    for($jj=0; $jj<count($access_role_ids); $jj++){
-                        if($access_role_ids[$jj] == $role_auth_id){
-                            $this->IsSuppleAdd = "true";
-                            break;
-                        }
-                    }
-                    if($this->IsSuppleAdd == "true"){
-                        break;
-                    }
+            }
+
+            // Update SuppleContentEntry Y.Yamazawa 2015/04/15 --start--
+            // サプリコンテンツ
+            $dispResult = $this->isShowSuppleButton($result,$isError);
+            if($isError === true)
+            {
+                $this->failTrans();
+                if($this->smartphoneFlg) {
+                    return 'error_sp';
+                } else {
+                    return "error";
                 }
-                // Add supple add flag 2009/08/28 A.Suzuki --end--
             }
-            
+            if($dispResult === true)
+            {
+                $this->IsSuppleAdd = "true";
+            }
+            // Update SuppleContentEntry Y.Yamazawa 2015/04/15 --end--
+
             // Add supple WEKO URL check 2009/08/31 A.Suzuki --start--
             $supple_weko_url = "";
             // パラメタテーブルからサプリWEKOのアドレスを取得する
@@ -947,64 +945,10 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                 // For support to output meta tag 2011/12/06 A.Suzuki --start--
                 if($this->addHeaderFlag)
                 {
+                    // Add metadata pdf url 2014/12/24 S.Suzuki --start--
                     $metaTagDataList = null;
-                    $itemPubDate = "";
-                    if($this->convertDataFormatForGoogleScholar(
-                        $result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_SHOWN_DATE],
-                        $tmpItemPubDate))
-                    {
-                        $itemPubDate = $tmpItemPubDate;
-                    }
-                    $tagContent = "";
-                    if($result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_LANGUAGE] == RepositoryConst::ITEM_LANG_JA)
-                    {
-                        // Item's language is Japanese
-                        if(strlen($result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE]) > 0)
-                        {
-                            // output Japanese title
-                            $tagContent = $result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE];
-                        } else {
-                            // output English title
-                            $tagContent = $result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH];
-                        }
-                    } else {
-                        // Item's language is English
-                        if(strlen($result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH]) > 0)
-                        {
-                            // output English title
-                            $tagContent = $result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH];
-                        } else {
-                            // output Japanese title
-                            $tagContent = $result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE];
-                        }
-                    }
-                    
-                    // Add title to metatag
-                    $output = $this->createTags(
-                            RepositoryConst::TAG_NAME_META,
-                            array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_TITLE,
-                                   RepositoryConst::TAG_ATTR_KEY_CONTENT => $tagContent ));
-                    $this->commonMain->addHeader($output);
-                    
-                    // Add online date to metatag
-                    $output = $this->createTags(
-                        RepositoryConst::TAG_NAME_META,
-                        array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_ONLINE_DATE,
-                               RepositoryConst::TAG_ATTR_KEY_CONTENT => $itemPubDate ));
-                    $this->commonMain->addHeader($output);
-                    
-                    // Add abstract html url to metatag
-                    $output = $this->createTags(
-                        RepositoryConst::TAG_NAME_META,
-                        array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_ABSTRACT_HTML_URL,
-                               RepositoryConst::TAG_ATTR_KEY_CONTENT => $result[0][RepositoryConst::DBCOL_REPOSITORY_ITEM_URI]));
-                    $this->commonMain->addHeader($output);
-                    
-                    // Add to metatag list
-                    $this->createMetaTagDataList(
-                        $itemPubDate,
-                        RepositoryConst::JUNII2_DATE_OF_ISSUED,
-                        $metaTagDataList);
+                    $this->outputBasicMetaTag($result[0], $block_obj);
+                    // Add metadata pdf url 2014/12/24 S.Suzuki --end--
                 }
                 // For support to output meta tag 2011/12/06 A.Suzuki --end--
                 // Add output ID in detail page 2009/01/15 A.Suzuki --start--
@@ -1056,7 +1000,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                 $Error_Msg;         // エラーメッセージ
                 $result = $this->getItemData($item_id, $item_no, $Result_List, $Error_Msg, false, true);
                 if($result == true) {
-                    
                     // キーワードの"|"を","に置換しセッションに保存 2008/10/06 A.Suzuki add Start
                     $keyword = str_replace("|", ", ", $Result_List["item"][0]["serch_key"]);
                     $keyword_english = str_replace("|", ", ", $Result_List["item"][0]["serch_key_english"]);
@@ -1064,23 +1007,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                     $this->Session->setParameter("keyword_english", $keyword_english);
                     // キーワードの"|"を","に置換しセッションに保存 2008/10/06 A.Suzuki add End
                     
-                    // Add keyword to metatag 2014/06/17 T.Ichikawa --start--
-                    $keyword_meta = explode(", ", $keyword);
-                    for($ii = 0; $ii < count($keyword_meta); $ii++) {
-                        $this->createMetaTagDataList(
-                            $keyword_meta[$ii],
-                            RepositoryConst::JUNII2_SUBJECT,
-                            $metaTagDataList);
-                    }
-                    $keyword_english_meta = explode(", ", $keyword_english);
-                    for($ii = 0; $ii < count($keyword_english_meta); $ii++) {
-                        $this->createMetaTagDataList(
-                            $keyword_english_meta[$ii],
-                            RepositoryConst::JUNII2_SUBJECT,
-                            $metaTagDataList);
-                    }
-                    // Add external search word display 2014/06/17 T.Ichikawa --end--
-                    
                     // Add matadata select language 2009/07/31 A.Suzuki --start--
                     $lang = $this->Session->getParameter("_lang");
                     
@@ -1195,14 +1121,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                     $str_array = explode("\n", $Result_List['item_attr'][$ii][$jj]['attribute_value']);
                                     $Result_List['item_attr'][$ii][$jj]['attribute_value'] = $str_array;
                                     
-                                    if($this->addHeaderFlag)
-                                    {
-                                        // Add to metatag list
-                                        $this->createMetaTagDataList(
-                                            $Result_List['item_attr'][$ii][$jj]['attribute_value'][0],
-                                            $Result_List['item_attr_type'][$ii]['junii2_mapping'],
-                                            $metaTagDataList);
-                                    }
                                 }
                                 if($value_flg === false){
                                     unset($Result_List['item_attr_type'][$ii]);
@@ -1220,14 +1138,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                     $str_array = explode("|", $Result_List['item_attr'][$ii][$jj]['attribute_value'], 2);
                                     $Result_List['item_attr'][$ii][$jj]['attribute_value'] = $str_array;
                                     
-                                    if($this->addHeaderFlag)
-                                    {
-                                        // Add to metatag list
-                                        $this->createMetaTagDataList(
-                                            $Result_List['item_attr'][$ii][$jj]['attribute_value'][0],
-                                            $Result_List['item_attr_type'][$ii]['junii2_mapping'],
-                                            $metaTagDataList);
-                                    }
                                 }
                                 if($value_flg === false){
                                     unset($Result_List['item_attr_type'][$ii]);
@@ -1244,86 +1154,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                         strlen($Result_List['item_attr'][$ii][0]['date_of_issued']) > 0)
                                     {
                                         $value_flg = true;
-                                        
-                                        // For support to output meta tag 2011/12/06 A.Suzuki --start--
-                                        if($this->addHeaderFlag)
-                                        {
-                                            $tagContent = "";
-                                            
-                                            // Journal title in Japanese
-                                            $tagContent .= $Result_List['item_attr'][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_BIBLIO_NAME];
-                                            
-                                            // Journal title in English
-                                            if(strlen($Result_List['item_attr'][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_BIBLIO_NAME_ENGLISH]) > 0)
-                                            {
-                                                if(strlen($tagContent) > 0)
-                                                {
-                                                    $tagContent .= " = ";
-                                                }
-                                                $tagContent .= $Result_List['item_attr'][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_BIBLIO_NAME_ENGLISH];
-                                            }
-                                            
-                                            // Add journal title to metatag
-                                            if(strlen($tagContent) > 0)
-                                            {
-                                                // Add to metatag list
-                                                $this->createMetaTagDataList(
-                                                    $tagContent,
-                                                    RepositoryConst::JUNII2_JTITLE,
-                                                    $metaTagDataList);
-                                            }
-                                            
-                                            // Add volume to metatag
-                                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_VOLUME]) > 0)
-                                            {
-                                                // Add to metatag list
-                                                $this->createMetaTagDataList(
-                                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_VOLUME],
-                                                    RepositoryConst::JUNII2_VOLUME,
-                                                    $metaTagDataList);
-                                            }
-                                            
-                                            // Add issue to metatag
-                                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_ISSUE]) > 0)
-                                            {
-                                                // Add to metatag list
-                                                $this->createMetaTagDataList(
-                                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_ISSUE],
-                                                    RepositoryConst::JUNII2_ISSUE,
-                                                    $metaTagDataList);
-                                            }
-                                            
-                                            // Add first page to metatag
-                                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_START_PAGE]) > 0)
-                                            {
-                                                // Add to metatag list
-                                                $this->createMetaTagDataList(
-                                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_START_PAGE],
-                                                    RepositoryConst::JUNII2_SPAGE,
-                                                    $metaTagDataList);
-                                            }
-                                            
-                                            // Add last page to metatag
-                                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_END_PAGE]) > 0)
-                                            {
-                                                // Add to metatag list
-                                                $this->createMetaTagDataList(
-                                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_END_PAGE],
-                                                    RepositoryConst::JUNII2_EPAGE,
-                                                    $metaTagDataList);
-                                            }
-                                            
-                                            // Add publication date to metatag
-                                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_DATE_OF_ISSUED]) > 0)
-                                            {
-                                                // Add to metatag list
-                                                $this->createMetaTagDataList(
-                                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_DATE_OF_ISSUED],
-                                                    RepositoryConst::JUNII2_DATE_OF_ISSUED,
-                                                    $metaTagDataList);
-                                            }
-                                        }
-                                        // For support to output meta tag 2011/12/06 A.Suzuki --end--
                                     }
                                 }
                                 if($value_flg === false){
@@ -1339,6 +1169,20 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                     } else {
                                         continue;
                                     }
+                                    // Add author link url 2015/01/28 T.Ichikawa --start--
+                                    $author_url = BASE_URL. "/?action=repository_opensearch&creator=";
+                                    $author_name = "";
+                                    if(strtolower($Result_List['item_attr_type'][$ii]['display_lang_type']) == "english") {
+                                        $author_name .= $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME].
+                                                        " ".
+                                                        $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY];
+                                    } else {
+                                        $author_name .= $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY].
+                                                        " ".
+                                                        $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME];
+                                    }
+                                    $Result_List['item_attr'][$ii][$jj]['url'] = $author_url. urlencode($author_name);
+                                    // Add author link url 2015/01/28 T.Ichikawa --end--
                                     $author_id_text = "";
                                     $author_id_array = $NameAuthority->getExternalAuthorIdData($Result_List['item_attr'][$ii][$jj]['author_id']);
                                     for($kk=0;$kk<count($author_id_array);$kk++){
@@ -1348,46 +1192,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                         $author_id_text .= $author_id_array[$kk]["prefix_name"].":".$author_id_array[$kk]["suffix"];
                                     }
                                     $Result_List['item_attr'][$ii][$jj]['author_id_text'] = $author_id_text;
-                                    
-                                    // For support to output meta tag 2011/12/06 A.Suzuki --start--
-                                    if($this->addHeaderFlag)
-                                    {
-                                        $tagContent = "";
-                                        if(strtolower($Result_List['item_attr_type'][$ii]['display_lang_type']) == "english")
-                                        {
-                                            $tagContent = $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME];
-                                            if(strlen($Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY]) > 0)
-                                            {
-                                                if(strlen($tagContent) > 0)
-                                                {
-                                                    $tagContent .= ",";
-                                                }
-                                                $tagContent .= $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY];
-                                            }
-                                        }
-                                        else
-                                        {
-                                            $tagContent = $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY];
-                                            if(strlen($Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME]) > 0)
-                                            {
-                                                if(strlen($tagContent) > 0)
-                                                {
-                                                    $tagContent .= ",";
-                                                }
-                                                $tagContent .= $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME];
-                                            }
-                                        }
-                                        
-                                        if(strlen($tagContent) > 0)
-                                        {
-                                            // Add to metatag list
-                                            $this->createMetaTagDataList(
-                                                $tagContent,
-                                                $Result_List['item_attr_type'][$ii]['junii2_mapping'],
-                                                $metaTagDataList);
-                                        }
-                                    }
-                                    // For support to output meta tag 2011/12/06 A.Suzuki --end--
                                 }
                                 if($value_flg === false){
                                     unset($Result_List['item_attr_type'][$ii]);
@@ -1442,20 +1246,8 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                     } else {
                                         continue;
                                     }
-                                    // Bug fix send array data (originally, send string) 2014/09/05 T.Ichikawa --start--
-                                    $orgValue = $Result_List['item_attr'][$ii][$jj]['attribute_value'];
-                                    // Bug fix send array data (originally, send string) 2014/09/05 T.Ichikawa --end--
                                     $str_array = explode("|", $Result_List['item_attr'][$ii][$jj]['attribute_value'], 4);
                                     $Result_List['item_attr'][$ii][$jj]['attribute_value'] = $str_array;
-                                    
-                                    if($this->addHeaderFlag)
-                                    {
-                                        // Add to metatag list
-                                        $this->createMetaTagDataList(
-                                            $orgValue,
-                                            $Result_List['item_attr_type'][$ii]['junii2_mapping'],
-                                            $metaTagDataList);
-                                    }
                                 }
                                 if($value_flg === false){
                                     unset($Result_List['item_attr_type'][$ii]);
@@ -1469,15 +1261,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                     } else {
                                         continue;
                                     }
-                                    
-                                    if($this->addHeaderFlag)
-                                    {
-                                        // Add to metatag list
-                                        $this->createMetaTagDataList(
-                                            $Result_List['item_attr'][$ii][$jj]['attribute_value'],
-                                            $Result_List['item_attr_type'][$ii]['junii2_mapping'],
-                                            $metaTagDataList);
-                                    }
                                 }
                                 if($value_flg === false){
                                     unset($Result_List['item_attr_type'][$ii]);
@@ -1554,9 +1337,59 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                 // To get pdf reference from servers 2013/10/21 S.Suzuki --end--
                             }
                             // Fix change file download action 2013/5/9 Y.Nakao --end--
+                            
+                            // Add metadata pdf url 2014/12/19 S.Suzuki --start--
+                            $files = $Result_List['item_attr'][$ii];
+                            
+                            if ($this->addHeaderFlag && count($files) > 0)
+                            {
+                                $this->outputFileMetaTag($files);
+                            }
+                            // Add metadata pdf url 2014/12/19 S.Suzuki --end--
                         }
                     }
                     // Add matadata select language 2009/07/31 A.Suzuki --end--
+                    
+                    // Add metadata pdf url 2014/12/19 S.Suzuki --start--
+                    $query = "SELECT * ".
+                             "FROM ". DATABASE_PREFIX ."repository_parameter ".    
+                             "WHERE param_name = ? AND ".  // param_name
+                             "is_delete = ?; ";         // 削除されていない
+                    $params = null;
+                    // $queryの?を置き換える配列
+                    $params[] = "institution_name";
+                    $params[] = 0;
+                    // SELECT実行
+                    $result = $this->Db->execute($query, $params);
+                    if($result === false) {
+                        $Error_Msg = $this->Db->ErrorMsg();
+                        array_push($this->errMsg, $Error_Msg);
+                        //アクション終了処理
+                        $result = $this->exitAction();     //トランザクションが成功していればCOMMITされる
+                        if ( $result === false ) {
+                            $exception = new RepositoryException( "ERR_MSG_xxx-xxx3", 1 );  //主メッセージとログIDを指定して例外を作成
+                            //$DetailMsg = null;                              //詳細メッセージ文字列作成
+                            //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx3, $埋込み文字1, $埋込み文字2 );
+                            //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
+                            throw $exception;
+                        }
+                        // Add smartPhone support T.Koyasu 2012/04/09 -start-
+                        if($this->smartphoneFlg) {
+                            return 'error_sp';
+                        } else {
+                            return "error";
+                        }
+                        // Add smartPhone support T.Koyasu 2012/04/09 -end-
+                    }
+                    
+                    // Add pdf url to metatag
+                    $output = $this->createTags(
+                        RepositoryConst::TAG_NAME_META,
+                        array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_DISSERTATION_INSTITUTION,
+                               RepositoryConst::TAG_ATTR_KEY_CONTENT => $result[0][RepositoryConst::DBCOL_REPOSITORY_PARAMETER_PARAM_VALUE]));
+                    $this->commonMain->addHeader($output);
+                    // Add metadata pdf url 2014/12/19 S.Suzuki --end--
+                    
                     // Add item type multi-language 2013/07/25 K.Matsuo --start--
                     $this->setItemtypeNameMultiLanguage($Result_List['item'][0]['item_type_id'], $Result_List['item_attr_type']);
                     // Add item type multi-language 2013/07/25 K.Matsuo --end--
@@ -1576,6 +1409,9 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                     // Add for JaLC DOI R.Matsuura 2014/06/13 --end--
                     
                     $this->Session->setParameter("item_info", $Result_List);
+                    
+                    // メタデータ設定
+                    $this->otherMetadataTag($Result_List, $metaTagDataList);
                 } else {
                     array_push($this->errMsg, $Error_Msg);
                     //アクション終了処理
@@ -1590,9 +1426,31 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                 //  return 'error';
                 }
 
-                // Add log common action Y.Nakao 2010/03/05 --start--
-                $this->entryLog(3, $this->item_id, $this->item_no, "", "", "");
-                // Add log common action Y.Nakao 2010/03/05 --end--
+                // Mod entryLog T.Koyasu 2015/03/06 --start--
+                // entry log
+                $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+                $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+                $logManager->entryLogForDetailView($this->item_id, $this->item_no);
+                
+                // update external search keyword
+                $referer = "";
+                if(isset($_SERVER["HTTP_REFERER"]))
+                {
+                    $referer = $_SERVER["HTTP_REFERER"];
+                }
+                else 
+                {
+                    $referer = getenv("HTTP_REFERER");
+                }
+                
+                // is referer empty?
+                // is this weko base_url?
+                if(strlen($referer) > 0 && strpos($referer, BASE_URL) !== 0){
+                    require_once WEBAPP_DIR. '/modules/repository/components/RepositoryExternalSearchWordManager.class.php';
+                    $searchWordManager = new Repository_Components_RepositoryExternalSearchWordManager($this->Session, $this->Db, $this->TransStartDate);
+                    $searchWordManager->insertExternalSearchWordFromURL($this->item_id, $this->item_no, $referer);
+                }
+                // Mod entryLog T.Koyasu 2015/03/06 --end--
                 
                 // アイテムの所属インデックスを検索
                 //$result = $this->Db->selectExecute("repository_position_index", array('item_id' => $item_id ));
@@ -1854,6 +1712,18 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             }
             // Set help icon setting 2010/02/10 K.Ando --end--
             
+            // Set Usage statistics setting 2014/12/15 K.Matsushita --start--
+            $result = $this->getAdminParam('usagestatistics_link_display', $this->usagestatistics_link_display, $Error_Msg);
+            if ( $result == false ){
+                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
+                $DetailMsg = null;                              //詳細メッセージ文字列作成
+                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
+                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
+                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
+                throw $exception;
+            }
+            // Set Usage statistics setting 2014/12/15 K.Matsushita --end--
+            
             // For support to output meta tag 2011/12/06 A.Suzuki --start--
             if($this->addHeaderFlag)
             {
@@ -1909,7 +1779,432 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             }
             // Add smartPhone support T.Koyasu 2012/04/09 -end-
         }
-
+    }
+    
+    /**
+     * output basic metadata for Google Scholar
+     *
+     * @param string $item basic info
+     */
+    private function outputBasicMetaTag($item, $block_obj) 
+    {
+        $itemPubDate = "";
+        if($this->convertDataFormatForGoogleScholar(
+            $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_SHOWN_DATE],
+            $tmpItemPubDate) )
+        {
+            $itemPubDate = $tmpItemPubDate;
+        }
+        
+        $tagContent = "";
+        if($item[RepositoryConst::DBCOL_REPOSITORY_ITEM_LANGUAGE] == RepositoryConst::ITEM_LANG_JA)
+        {
+            // Item's language is Japanese
+            if(strlen($item[RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE]) > 0)
+            {
+                // output Japanese title
+                $tagContent = $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE];
+            } else {
+                // output English title
+                $tagContent = $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH];
+            }
+        } else {
+            // Item's language is English
+            if(strlen($item[RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH]) > 0)
+            {
+                // output English title
+                $tagContent = $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE_ENGLISH];
+            } else {
+                // output Japanese title
+                $tagContent = $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_TITLE];
+            }
+        }
+        
+        // Add title to metatag
+        $output = $this->createTags(
+                RepositoryConst::TAG_NAME_META,
+                array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_TITLE,
+                       RepositoryConst::TAG_ATTR_KEY_CONTENT => $tagContent ));
+        $this->commonMain->addHeader($output);
+        
+        // Add online date to metatag
+        $output = $this->createTags(
+            RepositoryConst::TAG_NAME_META,
+            array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_ONLINE_DATE,
+                   RepositoryConst::TAG_ATTR_KEY_CONTENT => $itemPubDate ));
+        $this->commonMain->addHeader($output);
+        
+        // direct link to item detail page
+        $directLink = BASE_URL . "/?" . 
+                     "action=pages_view_main&" .
+                     "active_action=repository_view_main_item_detail&" . 
+                     "item_id=" . $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_ITEM_ID] . "&" . 
+                     "item_no=" . $item[RepositoryConst::DBCOL_REPOSITORY_ITEM_ITEM_NO] . "&" . 
+                     "page_id=" . $block_obj["page_id"] . "&" . "block_id=" . $block_obj["block_id"];
+        
+        // Add abstract html url to metatag
+        $output = $this->createTags(
+            RepositoryConst::TAG_NAME_META,
+            array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_ABSTRACT_HTML_URL,
+                   RepositoryConst::TAG_ATTR_KEY_CONTENT => $directLink) );
+        $this->commonMain->addHeader($output);
+        
+        // Add to metatag list
+        $this->createMetaTagDataList(
+            $itemPubDate,
+            RepositoryConst::JUNII2_DATE_OF_ISSUED,
+            $metaTagDataList);
+    }
+    
+    /**
+     * set other metadata for Google Scholar
+     *
+     * @param array $Result_List matadata array
+     * @param array $metaTagDataList metadata list
+     */
+    private function otherMetadataTag(&$Result_List, &$metaTagDataList)
+    {
+        // Add keyword to metatag 2014/06/17 T.Ichikawa --start--
+        $keyword_meta = explode(", ", $this->Session->getParameter("keyword"));
+        for($ii = 0; $ii < count($keyword_meta); $ii++) {
+            $this->createMetaTagDataList(
+                $keyword_meta[$ii],
+                RepositoryConst::JUNII2_SUBJECT,
+                $metaTagDataList);
+        }
+        $keyword_english_meta = explode(", ", $this->Session->getParameter("keyword_english"));
+        for($ii = 0; $ii < count($keyword_english_meta); $ii++) {
+            $this->createMetaTagDataList(
+                $keyword_english_meta[$ii],
+                RepositoryConst::JUNII2_SUBJECT,
+                $metaTagDataList);
+        }
+        // Add external search word display 2014/06/17 T.Ichikawa --end--
+        
+        $lang = $this->Session->getParameter("_lang");
+        
+        for($ii=0; $ii<count($Result_List['item_attr_type']); $ii++){
+            
+            if ($Result_List['item_attr_type'][$ii]['display_flag'] != "false") {
+                // ファイル、課金ファイルはスルーする
+                if(isset($Result_List['item_attr_type'][$ii]['input_type'])
+                    && $Result_List['item_attr_type'][$ii]['input_type']!="file" 
+                    && $Result_List['item_attr_type'][$ii]['input_type']!="file_price"
+                    && $Result_List['item_attr_type'][$ii]['input_type']!="thumbnail"
+                    && $Result_List['item_attr_type'][$ii]['input_type']!="supple")
+                {
+                    // テキストエリア内の改行対応2009/02/12 A.Suzuki --start--
+                    if($Result_List['item_attr_type'][$ii]['input_type']=="textarea"){
+                        for($jj=0; $jj<count($Result_List['item_attr'][$ii]); $jj++){
+                            if($this->addHeaderFlag)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List['item_attr'][$ii][$jj]['attribute_value'][0],
+                                    $Result_List['item_attr_type'][$ii]['junii2_mapping'],
+                                    $metaTagDataList);
+                            }
+                        }
+                    }
+                    else if($Result_List['item_attr_type'][$ii]['input_type']=="link"){
+                        for($jj=0; $jj<count($Result_List['item_attr'][$ii]); $jj++){
+                            if($this->addHeaderFlag)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List['item_attr'][$ii][$jj]['attribute_value'][0],
+                                    $Result_List['item_attr_type'][$ii]['junii2_mapping'],
+                                    $metaTagDataList);
+                            }
+                        }
+                    } 
+                    else if($Result_List['item_attr_type'][$ii]['input_type']=="biblio_info")
+                    {
+                        // For support to output meta tag 2011/12/06 A.Suzuki --start--
+                        if($this->addHeaderFlag)
+                        {
+                            $tagContent = "";
+                            
+                            // Journal title in Japanese
+                            $tagContent .= $Result_List['item_attr'][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_BIBLIO_NAME];
+                            
+                            // Journal title in English
+                            if(strlen($Result_List['item_attr'][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_BIBLIO_NAME_ENGLISH]) > 0)
+                            {
+                                if(strlen($tagContent) > 0)
+                                {
+                                    $tagContent .= " = ";
+                                }
+                                $tagContent .= $Result_List['item_attr'][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_BIBLIO_NAME_ENGLISH];
+                            }
+                            
+                            // Add journal title to metatag
+                            if(strlen($tagContent) > 0)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $tagContent,
+                                    RepositoryConst::JUNII2_JTITLE,
+                                    $metaTagDataList);
+                            }
+                            
+                            // Add volume to metatag
+                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_VOLUME]) > 0)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_VOLUME],
+                                    RepositoryConst::JUNII2_VOLUME,
+                                    $metaTagDataList);
+                            }
+                            
+                            // Add issue to metatag
+                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_ISSUE]) > 0)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_ISSUE],
+                                    RepositoryConst::JUNII2_ISSUE,
+                                    $metaTagDataList);
+                            }
+                            
+                            // Add first page to metatag
+                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_START_PAGE]) > 0)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_START_PAGE],
+                                    RepositoryConst::JUNII2_SPAGE,
+                                    $metaTagDataList);
+                            }
+                            
+                            // Add last page to metatag
+                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_END_PAGE]) > 0)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_END_PAGE],
+                                    RepositoryConst::JUNII2_EPAGE,
+                                    $metaTagDataList);
+                            }
+                            
+                            // Add publication date to metatag
+                            if(strlen($Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_DATE_OF_ISSUED]) > 0)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List["item_attr"][$ii][0][RepositoryConst::DBCOL_REPOSITORY_BIBLIO_INFO_DATE_OF_ISSUED],
+                                    RepositoryConst::JUNII2_DATE_OF_ISSUED,
+                                    $metaTagDataList);
+                            }
+                        }
+                        // For support to output meta tag 2011/12/06 A.Suzuki --end--
+                    } 
+                    else if($Result_List['item_attr_type'][$ii]['input_type']=="name")
+                    {
+                        for($jj=0; $jj<count($Result_List['item_attr'][$ii]); $jj++){
+                            // For support to output meta tag 2011/12/06 A.Suzuki --start--
+                            if($this->addHeaderFlag)
+                            {
+                                $tagContent = "";
+                                if(strtolower($Result_List['item_attr_type'][$ii]['display_lang_type']) == "english")
+                                {
+                                    $tagContent = $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME];
+                                    if(strlen($Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY]) > 0)
+                                    {
+                                        if(strlen($tagContent) > 0)
+                                        {
+                                            $tagContent .= ",";
+                                        }
+                                        $tagContent .= $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY];
+                                    }
+                                }
+                                else
+                                {
+                                    $tagContent = $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_FAMILY];
+                                    if(strlen($Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME]) > 0)
+                                    {
+                                        if(strlen($tagContent) > 0)
+                                        {
+                                            $tagContent .= ",";
+                                        }
+                                        $tagContent .= $Result_List['item_attr'][$ii][$jj][RepositoryConst::DBCOL_REPOSITORY_PERSONAL_NAME_NAME];
+                                    }
+                                }
+                                
+                                if(strlen($tagContent) > 0)
+                                {
+                                    // Add to metatag list
+                                    $this->createMetaTagDataList(
+                                        $tagContent,
+                                        $Result_List['item_attr_type'][$ii]['junii2_mapping'],
+                                        $metaTagDataList);
+                                }
+                            }
+                            // For support to output meta tag 2011/12/06 A.Suzuki --end--
+                        }
+                    } 
+                    else if($Result_List['item_attr_type'][$ii]['input_type']=="heading")
+                    {
+                        for($jj=0; $jj<count($Result_List['item_attr'][$ii]); $jj++){
+                            if($this->addHeaderFlag)
+                            {
+                                for($jj=0; $jj<count($Result_List['item_attr'][$ii]); $jj++)
+                                {
+                                    $orgValue = implode("|", $Result_List['item_attr'][$ii][$jj]['attribute_value']);
+                                    
+                                    // Add to metatag list
+                                    $this->createMetaTagDataList(
+                                        $orgValue,
+                                        $Result_List['item_attr_type'][$ii]['junii2_mapping'],
+                                        $metaTagDataList);
+                                }
+                            }
+                        }
+                    } 
+                    else {
+                        for($jj=0; $jj<count($Result_List['item_attr'][$ii]); $jj++){
+                            if($this->addHeaderFlag)
+                            {
+                                // Add to metatag list
+                                $this->createMetaTagDataList(
+                                    $Result_List['item_attr'][$ii][$jj]['attribute_value'],
+                                    $Result_List['item_attr_type'][$ii]['junii2_mapping'],
+                                    $metaTagDataList);
+                            }
+                        }
+                    }
+                }
+            }
+        }
+    }
+    
+    /**
+     * output file metadata for Google Scholar
+     *
+     * @param string $files pdf files and other files
+     */
+    private function outputFileMetaTag($files)
+    {
+        // popplerのパスを取得
+        $query = "SELECT `param_value` ".
+                 "FROM `". DATABASE_PREFIX ."repository_parameter` ".
+                 "WHERE `param_name` = 'path_poppler';";
+        
+        $poppler_path = $this->Db->execute($query);
+        
+        if ($poppler_path === false) {
+            $errMsg = $this->Db->ErrorMsg();
+            $this->failTrans();             //トランザクション失敗を設定(ROLLBACK)
+            return false;
+        }
+        
+        // popplerパス
+        $poppler = $poppler_path[0]['param_value'];
+        
+        $pdfinfoExists = false;
+        if( strlen($poppler) >= 1 && (file_exists($poppler."pdfinfo.exe") || file_exists($poppler."pdfinfo")))
+        {
+            $pdfinfoExists = true;
+        }
+        
+        $pdfData   = array("url" => "", "file_no" => 0, "size" => 0);
+        $otherData = array("url" => "", "file_no" => 0);
+        
+        // ファイルの中身をpdfとその他に分けてデータを集める
+        for($ii = 0; $ii < count($files); $ii++)
+        {
+            $item = $files[$ii];
+            
+            // ファイルurl
+            $url = BASE_URL . "/?action=repository_uri" . 
+                  "&item_id=" . $item["item_id"] .
+                  "&file_id=" . $item["attribute_id"].
+                  "&file_no=" . $item["file_no"];
+            
+            // pdfファイル
+            if ($item["extension"] == "pdf")
+            {
+                $size = 0;
+                $pdfPath = BASE_DIR . "/webapp/uploads/repository/files/" .
+                           $item["item_id"] . "_" . 
+                           $item["attribute_id"] . "_" . 
+                           $item["file_no"] . ".pdf";
+                
+                // pdfinfoが存在しているなら、pdfのページ数で比較
+                if ($pdfinfoExists)
+                {
+                    $output = null;
+                    exec($poppler . "pdfinfo " . $pdfPath , $output);
+                    
+                    // ページ数取得
+                    for ($jj = 0; $jj < count($output); $jj++)
+                    {
+                        if (preg_match("/^Pages:/", $output[$jj]) == 1)
+                        {
+                            $params = explode(":", $output[$jj]);
+                            $size = trim($params[1]);
+                        }
+                    }
+                }
+                // pdfinfoが存在しないならfilesizeで比較
+                else
+                {
+                    $size = filesize($pdfPath);
+                }
+                
+                if ($size > $pdfData["size"] && $size > 0)
+                {
+                    $pdfData["file_no"] = $item["file_no"];
+                    $pdfData["url"] = $url;
+                    $pdfData["size"] = $size;
+                }
+                
+                // 初回
+                if ($pdfData["url"] == "")
+                {
+                    $pdfData["file_no"] = $item["file_no"];
+                    $pdfData["url"] = $url;
+                    $pdfData["size"] = $size;
+                }
+            }
+            // pdfファイル以外
+            else 
+            {
+                if ($item["file_no"] < $otherData["file_no"])
+                {
+                    $otherData["file_no"] = $item["file_no"];
+                    $otherData["url"] = $url;
+                }
+                
+                // 初回
+                if ($otherData["url"] == "")
+                {
+                    $otherData["file_no"] = $item["file_no"];
+                    $otherData["url"] = $url;
+                }
+            }
+        }
+        
+        // タグを発行
+        
+        // pdfファイル
+        // Add pdf url to metatag
+        $output = $this->createTags(
+                        RepositoryConst::TAG_NAME_META,
+                        array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_PDF_URL,
+                        RepositoryConst::TAG_ATTR_KEY_CONTENT => $pdfData["url"]) );
+        
+        $this->commonMain->addHeader($output);
+        
+        // pdfファイル以外
+        // Add fulltext url to metatag
+        $output = $this->createTags(
+                        RepositoryConst::TAG_NAME_META,
+                        array( RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_FULLTEXT_HTML_URL,
+                        RepositoryConst::TAG_ATTR_KEY_CONTENT => $otherData["url"]) );
+        
+        $this->commonMain->addHeader($output);
     }
     
     // Add Convert Date Format for Google Scholar 2011/12/06 A.Suzuki --start--
@@ -1938,30 +2233,20 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
         // ----------------------
         // Convert date format
         // ----------------------
-        $exDateTime = explode(" ", $dateTime);
-        $exDate = explode("-", $exDateTime[0], 3);
         
-        // Month
-        if(isset($exDate[1]) && strlen($exDate[1]) > 0)
-        {
-            $retDate .= $exDate[1];
-            
-            // Day
-            if(isset($exDate[2]) && strlen($exDate[2]) > 0)
-            {
-                $retDate .= "/".$exDate[2];
-            }
-        }
+        // Add metadata pdf url 2014/12/24 S.Suzuki --start--
+        $date = explode(" ", $dateTime);
         
-        // Year
-        if(strlen($exDate[0]) > 0)
+        $ymd = explode("-", $date[0]);
+        
+        if (isset($ymd[0]) && isset($ymd[1]) && isset($ymd[2]) && count($ymd) == 3)
         {
-            if(strlen($retDate) > 0)
-            {
-                $retDate .= "/";
-            }
-            $retDate .= $exDate[0];
+            $retDate = $ymd[0] . "/" . $ymd[1] . "/" . $ymd[2];
+        }
+        else {
+            return false;
         }
+        // Add metadata pdf url 2014/12/24 S.Suzuki --end--
         
         // Check return value
         if(strlen($retDate) > 0)
@@ -1997,7 +2282,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             $retDataList[RepositoryConst::JUNII2_CREATOR] = array();
             $retDataList[RepositoryConst::JUNII2_PUBLISHER] = array();
             $retDataList[RepositoryConst::JUNII2_CONTRIBUTOR] = array();
-            $retDataList[RepositoryConst::JUNII2_FULL_TEXT_URL] = array();
             $retDataList[RepositoryConst::JUNII2_SUBJECT] = array();
             $retDataList[RepositoryConst::JUNII2_DATE_OF_ISSUED] = "";
             $retDataList[RepositoryConst::JUNII2_JTITLE] = "";
@@ -2156,45 +2440,11 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
                                     array( RepositoryConst::TAG_ATTR_KEY_NAME => $attrName,
                                            RepositoryConst::TAG_ATTR_KEY_CONTENT => $val )));
                             // Add metatag for Mendeley 2012/10/10 T.Koyasu -start-
-                            // Add citation_date meta tag for Mendeley
-                            if($attrName == RepositoryConst::GOOGLESCHOLAR_PUB_DATE){
-                                // $val is month/day/year , month/year or year
-                                $exDate = explode("/", $val);
-                                if(isset($exDate) && count($exDate) > 0){
-                                    // last val of $exDate -> $year
-                                    $year = $exDate[count($exDate) - 1];
-                                    array_push(
-                                        $retMetaTagTextList, 
-                                        $this->createTags(
-                                            RepositoryConst::TAG_NAME_META, 
-                                            array(RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_DATE, 
-                                                  RepositoryConst::TAG_ATTR_KEY_CONTENT => $year)));
-                                }
-                            }
-                            // Add metatag for Mendeley 2012/10/10 T.Koyasu -end-
                         }
                     }
                 }
             }
             // Add metatag for Mendeley 2012/10/10 T.Koyasu -start-
-            // Add citation_authors meta tag for Mendeley
-            $authorsStr = "";
-            for($ii=0; $ii<count($authorsList); $ii++){
-                if(strlen($authorsStr) != 0){
-                    $authorsStr .= "; ";
-                }
-                $authorsStr .= $authorsList[$ii];
-            }
-            if(strlen($authorsStr) > 0){
-                // Create metatag
-                array_push(
-                    $retMetaTagTextList, 
-                    $this->createTags(
-                        RepositoryConst::TAG_NAME_META, 
-                        array(RepositoryConst::TAG_ATTR_KEY_NAME => RepositoryConst::GOOGLESCHOLAR_AUTHORS, 
-                              RepositoryConst::TAG_ATTR_KEY_CONTENT => $authorsStr)));
-            }
-            // Add metatag for Mendeley 2012/10/10 T.Koyasu -end-
         }
         
         return $retMetaTagTextList;
@@ -2423,18 +2673,6 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
         // set file icon.
         $fileData['mime_type'] = $this->getFileIconID($fileData['mime_type'], $fileData['extension']);
         
-        if($this->addHeaderFlag)
-        {
-            // Add to metatag list
-            $fileURL = BASE_URL."/?action=repository_uri&item_id=".$this->item_id.
-                       "&file_id=".$fileData["attribute_id"].
-                       "&file_no=".$fileData['file_no'];
-            $this->createMetaTagDataList(
-                $fileURL,
-                RepositoryConst::JUNII2_FULL_TEXT_URL,
-                $metaTagDataList);
-        }
-        
         // Add free license input line break 2012/02/02 T.Koyasu -start-
         $license_notation_array = explode("\n", $fileData['license_notation']);
         $fileData['license_notation_array'] = $license_notation_array;
@@ -2507,6 +2745,12 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             $word_id = 0;
             for($ii = 0; $ii < count($word_sort); $ii++) {
                 $word_id = $word_sort[$ii];
+                // bug fix external searchword empty 2015/04/10 K.Sugimoto --start--
+                if(strlen($result[$word_id]["word"]) == 0)
+                {
+                    continue;
+                }
+                // bug fix external searchword empty 2015/04/10 K.Sugimoto --end--
                 $this->externalSearchWord[$ii]["searchValue"] = urldecode($result[$word_id]["word"]);
                 $this->externalSearchWord[$ii]["url"] = urlencode($result[$word_id]["word"]);
                 //フラグがtrueだったらフォントサイズは一定とする
@@ -2530,21 +2774,102 @@ class Repository_View_Main_Item_Detail extends RepositoryAction
             $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
             $uri_jalcdoi = $repositoryHandleManager->createSelfDoiUri($this->item_id, $this->item_no, RepositoryHandleManager::ID_JALC_DOI);
             $uri_crossref = $repositoryHandleManager->createSelfDoiUri($this->item_id, $this->item_no, RepositoryHandleManager::ID_CROSS_REF_DOI);
+            // Add DataCite 2015/02/10 K.Sugimoto --start--
+            $uri_datacite = $repositoryHandleManager->createSelfDoiUri($this->item_id, $this->item_no, RepositoryHandleManager::ID_DATACITE_DOI);
             $uri_library_jalcdoi = $repositoryHandleManager->createSelfDoiUri($this->item_id, $this->item_no, RepositoryHandleManager::ID_LIBRARY_JALC_DOI);
-            if(strlen($uri_jalcdoi) > 0 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1)
+            if(strlen($uri_jalcdoi) > 0 && strlen($uri_crossref) < 1 && strlen($uri_datacite) < 1 && strlen($uri_library_jalcdoi) < 1)
             {
                 $this->self_doi_uri = $uri_jalcdoi;
+                $this->doi_type = "JaLC DOI";
             }
-            else if(strlen($uri_crossref) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_library_jalcdoi) < 1)
+            else if(strlen($uri_crossref) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_datacite) < 1 && strlen($uri_library_jalcdoi) < 1)
             {
                 $this->self_doi_uri = $uri_crossref;
+                $this->doi_type = "JaLC CrossRef DOI";
+            }
+            else if(strlen($uri_datacite) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1 && strlen($uri_library_jalcdoi) < 1)
+            {
+                $this->self_doi_uri = $uri_datacite;
+                $this->doi_type = "JaLC DataCite DOI";
             }
-            else if(strlen($uri_library_jalcdoi) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1)
+            // Add DataCite 2015/02/10 K.Sugimoto --end--
+            else if(strlen($uri_library_jalcdoi) > 0 && strlen($uri_jalcdoi) < 1 && strlen($uri_crossref) < 1 && strlen($uri_datacite) < 1)
             {
                 $this->self_doi_uri = $uri_library_jalcdoi;
+                $this->doi_type = "JaLC DOI";
             }
         }
     }
     // Add for JaLC DOI R.Matsuura 2014/06/13 --end--
+
+    // Add for entry SuppleContents Y.Yamazawa 2015/03/30 --start--
+    /**
+     * セッションからサプリエラーメッセージを引き出しメンバーにセット
+     */
+    private function setSuppleErrorFromSessionParameter()
+    {
+        if($this->Session->getParameter("supple_error") === 1){
+            // no set address error
+            $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang("repository_supple_no_address");
+        } else if($this->Session->getParameter("supple_error") === 2){
+            // get false error
+            $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang("repository_supple_get_false");
+        } else if($this->Session->getParameter("supple_error") === 3){
+            // no item error
+            $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang("repository_supple_no_item");
+        }else{
+            $key = $this->Session->getParameter("supple_error");
+            if(!is_null($this->Session->getParameter("supple_error")) && !is_array($key)){
+                $this->supple_error = $this->Session->getParameter("smartyAssign")->getLang($key);
+                $this->Session->removeParameter($key);
+            }
+        }
+    }
+
+    /**
+     * サプリメンタルコンテンツ追加ボタンを表示
+     *
+     * 表示非表示条件
+     * 【ツリーの投稿権限】
+     * ベース権限+ルーム権限両方に権限がある：表示
+     * ベース権限+ルーム権限片方しか権限がない：非表示
+     * ルーム権限がある：表示
+     *
+     * @param array $indexID インデックスID
+     * @param unknown $isError エラー発生
+     * @return boolean true:表示する false:表示しない
+     */
+    private function isShowSuppleButton($indexID,&$isError)
+    {
+        $isShow = false;
+        $indexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->TransStartDate);
+        $auth_id = $this->getRoomAuthorityID();
+        $user_id = $this->Session->getParameter("_user_id");
+
+        $isError = false;
+        // 所属インデックスに投稿権限があるユーザの場合
+        for($ii=0; $ii<count($indexID); $ii++){
+
+            $result = $indexAuthorityManager->isRegistItemToIndex($auth_id, $user_id, $indexID[$ii]["index_id"], $isError);
+            if($isError === true)
+            {
+                return false;
+            }
+
+            if($result === true)
+            {
+                $isShow = true;
+                break;
+            }
+        }
+
+        if($auth_id < REPOSITORY_ITEM_REGIST_AUTH)
+        {
+            $isShow = false;
+        }
+
+        return $isShow;
+    }
+    // Add for entry SuppleContents Y.Yamazawa 2015/03/30 --end--
 }
 ?>
\ No newline at end of file
diff --git a/repository/view/main/item/detail/maple.ini b/repository/view/main/item/detail/maple.ini
index 1fa4c86..54b04ba 100644
--- a/repository/view/main/item/detail/maple.ini
+++ b/repository/view/main/item/detail/maple.ini
@@ -35,8 +35,5 @@ success_sp = "repository_mobile_item_snippet.html"
 error_sp = "repository_mobile_item_detail.html"
 golistview_sp = "repository_mobile_item_snippet.html"
 
-[DIContainer]
-filename_languagescomp = "/modules/repository/view/main/item/snippet/dicon.ini"
-
 [SmartyAssign::items]
 global = lang.ini
\ No newline at end of file
diff --git a/repository/view/main/item/editdoi/Editdoi.class.php b/repository/view/main/item/editdoi/Editdoi.class.php
index 2faf99c..9dc6c75 100644
--- a/repository/view/main/item/editdoi/Editdoi.class.php
+++ b/repository/view/main/item/editdoi/Editdoi.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editdoi.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Editdoi.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,95 +12,145 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：DOI付与画面表示
  *
- * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Item_Editdoi extends RepositoryAction
+class Repository_View_Main_Item_Editdoi extends WekoAction
 {
+    // 表示用パラメーター
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
+     */
     public $help_icon_display =  "";
     
+    /**
+     * DOI表示フラグ
+     * @var bool
+     */
     public $displays_doi_grant = false;
+    
+    /**
+     * DOIステータス
+     * @var int
+     */
     public $doi_status = 0;
     
     /**
      * registed doi
-     * 0:not registed
-     * 1:jalcdoi registed
-     * 2:crossref registed
+     *   0:not registed
+     *   1:jalcdoi registed
+     *   2:crossref registed
+     *   3:datacite registed
+     * @var int
      */
     public $registed_doi = 0;
     
     /**
      * registed library jalcdoi
-     * 0:not registed
-     * 1:registed
+     *   0:not registed
+     *   1:registed
+     * @var int
      */
     public $registed_library_jalcdoi = 0;
     
     /**
      * prefix of JaLC DOI
-     *
      * @var string
      */
     public $prefix_jalcdoi = null;
     
     /**
      * prefix of Cross Ref
-     *
      * @var string
      */
     public $prefix_crossref = null;
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * prefix of DataCite
+     * @var string
+     */
+    public $prefix_datacite = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
     /**
      * prefix of Library JaLC DOI
-     *
      * @var string
      */
     public $prefix_library_jalcdoi = null;
     
     /**
      * suffix
-     *
      * @var string
      */
     public $suffix = null;
     
     /**
-     * when drop doi, it going to be 'true'
-     *
+     * drop doi
+     *   when drop doi, it going to be 'true'
      * @var string
      */
     public $drop_doi = null;
     
     /**
-     * 0:new item
-     * 1:edit item
-     * 
+     * edit flag
+     *   0:new item
+     *   1:edit item
      * @var string
      */
     public $edit_flag = 0;
     
+    // Add DataCite 2015/02/10 K.Sugimoto --start--
+    /**
+     * prefix add flag
+     *   0:do not add
+     *   1:add
+     */
+    public $prefix_flag = null;
+    
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * prefix of YHandle
+     * @var string
      */
-    function executeForWeko()
+    public $prefix_yhandle = null;
+    // Add DataCite 2015/02/10 K.Sugimoto --end--
+    
+    // リクエストパラメーター
+    /**
+     * 警告メッセージ配列
+     * @var array
+     */
+    public $warningMsg = null;
+
+    /**
+     * 実行処理
+     * @see ActionBase::executeApp()
+     */
+    protected function executeApp()
     {
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setLangResource();
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        
         $item_id = intval($this->Session->getParameter("edit_item_id"));
         $item_no = intval($this->Session->getParameter("edit_item_no"));
         
         // DOI付与可能かどうかをチェック
-        //$DATE = new Date();
-        //$this->TransStartDate = $DATE->getDate().".000";
-        $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
-        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->TransStartDate);
+        $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->accessDate);
+        require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
+        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->accessDate);
         if($this->drop_doi == 'true')
         {
             $repositoryHandleManager->dropDoiSuffix($item_id, $item_no);
@@ -109,38 +159,74 @@ class Repository_View_Main_Item_Editdoi extends RepositoryAction
             $item_id, $item_no, Repository_Components_Checkdoi::TYPE_JALC_DOI);
         $displays_crossref_grant = $CheckDoi->checkDoiGrant(
             $item_id, $item_no, Repository_Components_Checkdoi::TYPE_CROSS_REF);
+        $displays_datacite_grant = $CheckDoi->checkDoiGrant(
+            $item_id, $item_no, Repository_Components_Checkdoi::TYPE_DATACITE);
         $displays_library_jalcdoi_grant = $CheckDoi->checkDoiGrant(
             $item_id, $item_no, Repository_Components_Checkdoi::TYPE_LIBRARY_JALC_DOI);
         if($displays_jalcdoi_grant)
         {
             $this->prefix_jalcdoi = $repositoryHandleManager->getJalcDoiPrefix();
+            $this->prefix_yhandle = $repositoryHandleManager->getYHandlePrefix();
             $this->suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
             $this->displays_doi_grant = true;
         }
         if($displays_crossref_grant)
         {
             $this->prefix_crossref = $repositoryHandleManager->getCrossRefPrefix();
+            $this->prefix_yhandle = $repositoryHandleManager->getYHandlePrefix();
+            $this->suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
+            $this->displays_doi_grant = true;
+        }
+        if($displays_datacite_grant)
+        {
+            $this->prefix_datacite = $repositoryHandleManager->getDataCitePrefix();
+            $this->prefix_yhandle = $repositoryHandleManager->getYHandlePrefix();
             $this->suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
             $this->displays_doi_grant = true;
         }
         if($displays_library_jalcdoi_grant)
         {
             $this->prefix_library_jalcdoi = $repositoryHandleManager->getLibraryJalcDoiPrefix();
+            $this->prefix_yhandle = $repositoryHandleManager->getYHandlePrefix();
             $this->suffix = $repositoryHandleManager->getYHandleSuffix($item_id, $item_no);
             $this->displays_doi_grant = true;
         }
+        
+        $query = "SELECT param_value ".
+                 "FROM {repository_parameter} ".
+                 "WHERE `param_name` = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = "prefix_flag";
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if(count($result) > 0 && $result[0]["param_value"] == 1)
+        {
+        	$this->prefix_flag = 1;
+        }
+        else
+        {
+        	$this->prefix_flag = 0;
+        }
+        
         $this->doi_status = $CheckDoi->getDoiStatus($item_id, $item_no);
         if($this->doi_status == 1)
         {
             $jalcdoi_suffix = $repositoryHandleManager->getJalcdoiSuffix($item_id, $item_no);
-            if(strlen($jalcdoi_suffix) > 0)
+            $crossref_suffix = $repositoryHandleManager->getCrossrefSuffix($item_id, $item_no);
+            $datacite_suffix = $repositoryHandleManager->getDataciteSuffix($item_id, $item_no);
+            if(strlen($jalcdoi_suffix) > 0 && strlen($crossref_suffix) < 1 && strlen($datacite_suffix) < 1)
             {
                 $this->registed_doi = 1;
             }
-            else
+            else if(strlen($crossref_suffix) > 0 && strlen($jalcdoi_suffix) < 1 && strlen($datacite_suffix) < 1)
             {
                 $this->registed_doi = 2;
             }
+            else if(strlen($datacite_suffix) > 0 && strlen($jalcdoi_suffix) < 1 && strlen($crossref_suffix) < 1)
+            {
+                $this->registed_doi = 3;
+            }
             
             $library_jalcdoi_suffix = $repositoryHandleManager->getLibraryJalcdoiSuffix($item_id, $item_no);
             if(strlen($library_jalcdoi_suffix) > 0)
@@ -153,7 +239,6 @@ class Repository_View_Main_Item_Editdoi extends RepositoryAction
             }
         }
         
-        $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
         $uri = $repositoryHandleManager->getSubstanceUri($item_id, $item_no);
         if(strlen($uri) == 0)
         {
@@ -163,12 +248,21 @@ class Repository_View_Main_Item_Editdoi extends RepositoryAction
         {
             $this->edit_flag = 1;
         }
-        // $this->edit_flag = $this->Session->getParameter("edit_flag");
         
         // DOI付与画面を通過したことを示すフラグをセッションに保存
         $this->Session->removeParameter("edit_jalc_flag");
         $this->Session->setParameter("edit_jalc_flag", "true");
         
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        
         return 'success';
     }
 }
diff --git a/repository/view/main/item/editdoi/maple.ini b/repository/view/main/item/editdoi/maple.ini
index cf455b0..7f44af5 100644
--- a/repository/view/main/item/editdoi/maple.ini
+++ b/repository/view/main/item/editdoi/maple.ini
@@ -11,3 +11,4 @@ Db = "ref:DbObject"
 [View]
 define:theme = 1
 success = "repository_item_edit_editdoi.html"
+error = "repository_item_edit_editdoi.html"
diff --git a/repository/view/main/item/editfiles/Editfiles.class.php b/repository/view/main/item/editfiles/Editfiles.class.php
index 3ade9ad..d3a4069 100644
--- a/repository/view/main/item/editfiles/Editfiles.class.php
+++ b/repository/view/main/item/editfiles/Editfiles.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editfiles.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Editfiles.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,67 +12,57 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：ファイル選択画面表示
  *
- * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Item_Editfiles extends RepositoryAction
+class Repository_View_Main_Item_Editfiles extends WekoAction
 {
-   	var $error_msg = "";		// エラーメッセージ
-	
-    // Set help icon setting 2010/02/10 K.Ando --start--
-    var $help_icon_display =  "";
-    // Set help icon setting 2010/02/10 K.Ando --end--
-   	
-	/**
-     * [[機能説明]]
-     *
-     * @access  public
+    // 表示用パラメーター
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
      */
-    function execute()
+    public $help_icon_display =  "";
+    
+    // リクエストパラメーター
+    /**
+     * 警告メッセージ配列
+     * @var array
+     */
+    public $warningMsg = null;
+    
+    /**
+     * 実行処理
+     * @see ActionBase::executeApp()
+     */
+    protected function executeApp()
     {
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
         
-        // Add theme_name for image file Y.Nakao 2011/08/03 --start--
-        $this->setThemeName();
-        // Add theme_name for image file Y.Nakao 2011/08/03 --end--
+        // Add registered info save action 2009/01/29 Y.Nakao --start--
+        $repositoryAction->setLangResource();
+        // Add registered info save action 2009/01/29 Y.Nakao --end--
         
-    	// セッションからエラーメッセージのコピー
-    	$this->error_msg = $this->Session->getParameter("error_msg");
-    	$this->Session->removeParameter("error_msg");
-
-    	// Add registered info save action 2009/01/29 Y.Nakao --start--
-    	$this->setLangResource();
-    	// Add registered info save action 2009/01/29 Y.Nakao --end--
-    	
-        // Set help icon setting 2010/02/10 K.Ando --start--
-        $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-		if ( $result == false ){
-			$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-            $DetailMsg = null;                              //詳細メッセージ文字列作成
-            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
             throw $exception;
-		}
-        // Set help icon setting 2010/02/10 K.Ando --end--
-    	
-/*
-    	// アイテムタイプをDBから取得
-    	$id = $this->session->getParameter("item_type_id");
-    	$params = array("item_type_id" => $id);
-    	$item_type = $this->db->selectExecute("repository_item_type",$params);
-    	if($item_type === false) {
-    		return 'false';
-    	}
-    	// アイテムタイプ名をセッションに登録
-    	$this->session->setParameter("item_type_name", $item_type[0]['item_type_name']);
-    	// アイテム属性タイプをDBから取得
-    	$item_attr_type = $this->db->selectExecute("repository_item_attr_type" ,$params);
-*/
+        }
+        
         return 'success';
     }
 }
diff --git a/repository/view/main/item/editfiles/maple.ini b/repository/view/main/item/editfiles/maple.ini
index bd59314..9cb59bf 100644
--- a/repository/view/main/item/editfiles/maple.ini
+++ b/repository/view/main/item/editfiles/maple.ini
@@ -8,7 +8,7 @@ authcheck = "1,_auth_id>=REPOSITORY_ITEM_REGIST_AUTH:lang._invalid_auth"
 Session = "ref:Session"
 Db = "ref:DbObject"
 
-
 [View]
 define:theme = 1
 success = "repository_item_edit_files.html"
+error = "repository_item_edit_files.html"
diff --git a/repository/view/main/item/editfileslicense/Editfileslicense.class.php b/repository/view/main/item/editfileslicense/Editfileslicense.class.php
index b221135..881b02e 100644
--- a/repository/view/main/item/editfileslicense/Editfileslicense.class.php
+++ b/repository/view/main/item/editfileslicense/Editfileslicense.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editfileslicense.class.php 599 2014-07-14 09:06:17Z ivis $
+// $Id: Editfileslicense.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -13,178 +13,149 @@
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
 
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/ItemRegister.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryHandleManager.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：ファイルライセンス設定画面表示
  *
- * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Item_Editfileslicense extends RepositoryAction
+class Repository_View_Main_Item_Editfileslicense extends WekoAction
 {
-	//メンバ変数
-	var $row_num = array();
-	var $error_msg = "";		// エラーメッセージ
-	
-	// Add convert to flash 2010/02/10 A.Suzuki --start--
-	var $flash_convertible = array();
-	// Add convert to flash 2010/02/10 A.Suzuki --end--
-
-    // Set help icon setting 2010/02/10 K.Ando --start--
-    var $help_icon_display =  "";
-    // Set help icon setting 2010/02/10 K.Ando --end--
-	
+    // 表示用パラメーター
+    /**
+     * row num
+     * @var array
+     */
+    public $row_num = array();
+    
+    /**
+     * フラッシュ表示選択可能フラグ配列
+     * @var array
+     */
+    public $flash_convertible = array();
+    
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
+     */
+    public $help_icon_display =  "";
+    
+    // リクエストパラメーター
+    /**
+     * 警告メッセージ配列
+     * @var array
+     */
+    public $warningMsg = null;
+    
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * 実行処理
+     * @see ActionBase::executeApp()
      */
-    function execute()
+    protected function executeApp()
     {
-       	try {
-	        //アクション初期化処理
-	        $result = $this->initAction();
-    		if ( $result === false ) {
-	            $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-	        }
-	        
-            // ファイル(not multimedia)のFLASH変換はIDサーバと連携している場合のみ
-            $fileConvertFlag = false;
-            // prefixIDをDBから取得
-
-            $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->dbAccess, $this->TransStartDate);
-            
-            $prefixID = $repositoryHandleManager->getPrefix(RepositoryHandleManager::ID_Y_HANDLE);
-            
-            if(strlen($prefixID) > 0){
-                $fileConvertFlag = true;
-            }
-            
-            // マルチメディアファイルのFLVへの変換はffmpegが使用可能な場合のみ
-            $itemRegister = new ItemRegister($this->Session, $this->Db);
-            $multimediaConvertFlag = $itemRegister->getIsValidFfmpeg();
-	        
-	        // テーブル描画用Row数情報を作成
-	        $item_attr = $this->Session->getParameter("item_attr");	
-	        $item_attr_type = $this->Session->getParameter("item_attr_type");
-	        $this->row_num = array_fill(0, count($item_attr), 0);
-	        for ($ii = 0; $ii < count($item_attr_type); $ii++) {
-	        	if($item_attr_type[$ii]['input_type'] == "file" || $item_attr_type[$ii]['input_type']=='file_price'){
-	        		for ($jj = 0; $jj < count($item_attr[$ii]); $jj++) {
-	        			if ($item_attr[$ii][$jj] != null) {
-       						// ファイルが存在している個数分、Row数を増やしていく
-                            if($item_attr_type[$ii]['input_type']=='file_price')
-                            {
-                                $this->row_num[$ii] += 2;
-                            }
-                            else
-                            {
-                                $this->row_num[$ii]++;
-                            }
-	        				
-	        				// Add convert to flash 2010/02/10 A.Suzuki --start--
-	        				$this->flash_convertible[$ii][$jj] = null;
-	        				if (array_key_exists('upload', $item_attr[$ii][$jj]) && $item_attr[$ii][$jj]['upload'] != null)
-	        				{
-	        					$extension = strtolower($item_attr[$ii][$jj]['upload']['extension']);
-	        					switch($extension){
-                                    case "swf":
-                                    case "flv":
-                                        // swf, flv の場合はFlash表示を常に選択可能
-                                        $this->flash_convertible[$ii][$jj] = "true";
-                                        break;
-	        						case "doc":
-	        						case "docx":
-	        						case "xls":
-	        						case "xlsx":
-	        						case "ppt":
-	        						case "pptx":
-	        						case "pdf":
-                                        if($fileConvertFlag)
-                                        {
-                                            // ファイルのFLASH変換はIDサーバと連携している場合のみ
-                                            $this->flash_convertible[$ii][$jj] = "true";
-                                        }
-                                        break;
-	        						case "emf":
-	        						case "wmf":
-	        						case "bmp":
-	        						case "png":
-	        						case "gif":
-	        						case "tiff":
-	        						case "jpg":
-	        						case "jp2":
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        
+        // ファイル(not multimedia)のFLASH変換はIDサーバと連携している場合のみ
+        $fileConvertFlag = false;
+        
+        // prefixIDをDBから取得
+        $repositoryHandleManager = new RepositoryHandleManager($this->Session, $this->Db, $this->accessDate);
+        $prefixID = $repositoryHandleManager->getPrefix(RepositoryHandleManager::ID_Y_HANDLE);
+        if(strlen($prefixID) > 0){
+            $fileConvertFlag = true;
+        }
+        
+        // マルチメディアファイルのFLVへの変換はffmpegが使用可能な場合のみ
+        $itemRegister = new ItemRegister($this->Session, $this->Db);
+        $multimediaConvertFlag = $itemRegister->getIsValidFfmpeg();
+        
+        // テーブル描画用Row数情報を作成
+        $item_attr = $this->Session->getParameter("item_attr");
+        $item_attr_type = $this->Session->getParameter("item_attr_type");
+        
+        $this->row_num = array_fill(0, count($item_attr), 0);
+        for ($ii = 0; $ii < count($item_attr_type); $ii++) {
+            if($item_attr_type[$ii]['input_type'] == "file" || $item_attr_type[$ii]['input_type']=='file_price'){
+                for ($jj = 0; $jj < count($item_attr[$ii]); $jj++) {
+                    if ($item_attr[$ii][$jj] != null) {
+                        // ファイルが存在している個数分、Row数を増やしていく
+                        if($item_attr_type[$ii]['input_type']=='file_price')
+                        {
+                            $this->row_num[$ii] += 2;
+                        } else {
+                            $this->row_num[$ii]++;
+                        }
+                        // Add convert to flash 2010/02/10 A.Suzuki --start--
+                        $this->flash_convertible[$ii][$jj] = null;
+                        if (array_key_exists('upload', $item_attr[$ii][$jj]) && $item_attr[$ii][$jj]['upload'] != null)
+                        {
+                            $extension = strtolower($item_attr[$ii][$jj]['upload']['extension']);
+                            switch($extension){
+                                case "swf":
+                                case "flv":
+                                    // swf, flv の場合はFlash表示を常に選択可能
+                                    $this->flash_convertible[$ii][$jj] = "true";
+                                    break;
+                                case "doc":
+                                case "docx":
+                                case "xls":
+                                case "xlsx":
+                                case "ppt":
+                                case "pptx":
+                                case "pdf":
+                                    if($fileConvertFlag){
+                                        // ファイルのFLASH変換はIDサーバと連携している場合のみ
                                         $this->flash_convertible[$ii][$jj] = "true";
-                                        break;
-                                    
-                                    default :
-                                        if( $multimediaConvertFlag &&
-                                            $this->isMultimediaFile(
+                                    }
+                                    break;
+                                case "emf":
+                                case "wmf":
+                                case "bmp":
+                                case "png":
+                                case "gif":
+                                case "tiff":
+                                case "jpg":
+                                case "jp2":
+                                    $this->flash_convertible[$ii][$jj] = "true";
+                                    break;
+                                default :
+                                    if( $multimediaConvertFlag &&
+                                        $repositoryAction->isMultimediaFile(
                                                 strtolower($item_attr[$ii][$jj]['upload']['mimetype']),
                                                 strtolower($item_attr[$ii][$jj]['upload']['extension'])))
-                                        {
-                                            // マルチメディアファイルのFLVへの変換はffmpegが使用可能な場合のみ
-                                            $this->flash_convertible[$ii][$jj] = "true";
-                                        }
-	        							break;
-	        					}
-	        				}
-	        				// Add convert to flash 2010/02/10 A.Suzuki --end--
-	        			}
-	        		}
-	        	}
-			}
-	        
-	        // セッションからエラーメッセージのコピー
-    		$this->error_msg = $this->Session->getParameter("error_msg");
-    		$this->Session->removeParameter("error_msg"); 
-            
-       		// アクション終了処理
-			$result = $this->exitAction();	// トランザクションが成功していればCOMMITされる
-			if ( $result == false ){
-				$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-			}
-			
-	        // Set help icon setting 2010/02/10 K.Ando --start--
-	        $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-			if ( $result == false ){
-				$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-			}
-	        // Set help icon setting 2010/02/10 K.Ando --end--
-
-			return 'success';
-        } catch ( RepositoryException $Exception) {
-    	    //エラーログ出力
-        	$this->logFile(
-	        	"SampleAction",					//クラス名
-	        	"execute",						//メソッド名
-	        	$Exception->getCode(),			//ログID
-	        	$Exception->getMessage(),		//主メッセージ
-	        	$Exception->getDetailMsg() );	//詳細メッセージ	        
-        	//アクション終了処理
-      		$this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-	        //異常終了
-	        $this->Session->setParameter("error_msg", $user_error_msg);
-    	    return "error";
-		}
+                                    {
+                                        // マルチメディアファイルのFLVへの変換はffmpegが使用可能な場合のみ
+                                        $this->flash_convertible[$ii][$jj] = "true";
+                                    }
+                                    break;
+                            }
+                        }
+                        // Add convert to flash 2010/02/10 A.Suzuki --end--
+                    }
+                }
+            }
+        }
+        
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        
+        return 'success';
     }
 }
 ?>
diff --git a/repository/view/main/item/editfileslicense/maple.ini b/repository/view/main/item/editfileslicense/maple.ini
index 6515326..82740ea 100644
--- a/repository/view/main/item/editfileslicense/maple.ini
+++ b/repository/view/main/item/editfileslicense/maple.ini
@@ -11,3 +11,4 @@ Db = "ref:DbObject"
 [View]
 define:theme = 1
 success = "repository_item_edit_files_license.html"
+error = "repository_item_edit_files_license.html"
diff --git a/repository/view/main/item/editlinks/Editlinks.class.php b/repository/view/main/item/editlinks/Editlinks.class.php
index 5da5678..d3b096f 100644
--- a/repository/view/main/item/editlinks/Editlinks.class.php
+++ b/repository/view/main/item/editlinks/Editlinks.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Editlinks.class.php 600 2014-08-06 04:41:16Z ivis $
+// $Id: Editlinks.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,162 +12,135 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/RepositorySearchRequestParameter.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：リンク設定画面表示
  *
- * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Item_Editlinks extends RepositoryAction
+class Repository_View_Main_Item_Editlinks extends WekoAction
 {
-    // 使用コンポーネントを受け取るため
-    var $Session = null;
-    var $Db = null;
+    // 表示用パラメーター
+    /**
+     * relation選択肢
+     * @var array
+     */
+    public $relationArray = array();
     
-    //メンバ変数
-    var $relationArray = array();   // relation選択肢
-    var $error_msg = array();       // エラーメッセージ
-    var $warning = "";      // 警告
-    var $relationArray_count = 0;   // relation個数
+    /**
+     * relation個数
+     * @var int
+     */
+    public $relationArray_count = 0;
     
-    // Set help icon setting 2010/02/10 K.Ando --start--
-    var $help_icon_display =  "";
-    // Set help icon setting 2010/02/10 K.Ando --end--
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
+     */
+    public $help_icon_display =  "";
     
+    // リクエストパラメーター
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * 警告メッセージ配列
+     * @var array
      */
-    function execute()
+    public $warningMsg = null;
+    
+    /**
+     * 実行処理
+     * @see ActionBase::executeApp()
+     */
+    protected function executeApp()
     {
-        $istest = true;             // テスト用フラグ
-        try {           
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            
-            // Add addin S.Arata 2012/08/02 --start--
-            $this->addin->preExecute();
-            // Add addin S.Arata 2012/08/02 --end--
-            
-            // Add relation options 2008/10/16 A.Suzuki --start--
-            $container =& DIContainerFactory::getContainer();
-            $filterChain =& $container->getComponent("FilterChain");
-            $smartyAssign =& $filterChain->getFilterByName("SmartyAssign");
-            
-            $this->relationArray = array(
-                //languageリソースから項目を取得する
-                array("isVersionOf", $smartyAssign->getLang("repository_item_relation_is_version_of")),
-                array("hasVersion", $smartyAssign->getLang("repository_item_relation_has_version")),
-                array("isReplacedBy", $smartyAssign->getLang("repository_item_relation_is_replaced_by")),
-                array("replaces", $smartyAssign->getLang("repository_item_relation_replaces")),
-                array("isRequiredBy", $smartyAssign->getLang("repository_item_relation_is_required_by")),
-                array("requires", $smartyAssign->getLang("repository_item_relation_requires")),
-                array("isPartOf", $smartyAssign->getLang("repository_item_relation_is_part_of")),
-                array("hasPart", $smartyAssign->getLang("repository_item_relation_has_part")),
-                array("isReferencedBy", $smartyAssign->getLang("repository_item_relation_is_referenced_by")),
-                array("references", $smartyAssign->getLang("repository_item_relation_references")),
-                array("isFormatOf", $smartyAssign->getLang("repository_item_relation_is_format_of")),
-                array("hasFormat", $smartyAssign->getLang("repository_item_relation_has_format"))
-            );
-            $this->Session->setParameter("relationArray", $this->relationArray);
-            $this->relationArray_count = count($this->relationArray);
-            // Add relation options 2008/10/16 A.Suzuki --end--
-            
-            // ツリー開閉情報
-            $indice = $this->Session->getParameter("indice");
-            $open_ids = $this->Session->getParameter("view_open_node_index_id_item_link");
-            if(strlen($open_ids) > 0)
-            {
-                for($ii=0; $ii<count($indice); $ii++){
-                    $parent_index = array();
-                    $this->getParentIndex($indice[$ii]["index_id"], $parent_index);
-                    for($jj=0; $jj<count($parent_index); $jj++){
-                        if(!is_numeric(strpos($open_ids, ",".$parent_index[$jj]["index_id"].","))){
-                            if(substr_count($open_ids, ",".$parent_index[$jj]["index_id"].",")==0 &&
-                              $parent_index[$jj]["index_id"] != $indice[$ii]["index_id"]){
-                                $open_ids .= ",".$parent_index[$jj]["index_id"].",";
-                            }
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setLangResource();
+        $smartyAssign = $this->Session->getParameter("smartyAssign");
+        
+        $this->relationArray = array(
+            //languageリソースから項目を取得する
+            array("isVersionOf", $smartyAssign->getLang("repository_item_relation_is_version_of")),
+            array("hasVersion", $smartyAssign->getLang("repository_item_relation_has_version")),
+            array("isReplacedBy", $smartyAssign->getLang("repository_item_relation_is_replaced_by")),
+            array("replaces", $smartyAssign->getLang("repository_item_relation_replaces")),
+            array("isRequiredBy", $smartyAssign->getLang("repository_item_relation_is_required_by")),
+            array("requires", $smartyAssign->getLang("repository_item_relation_requires")),
+            array("isPartOf", $smartyAssign->getLang("repository_item_relation_is_part_of")),
+            array("hasPart", $smartyAssign->getLang("repository_item_relation_has_part")),
+            array("isReferencedBy", $smartyAssign->getLang("repository_item_relation_is_referenced_by")),
+            array("references", $smartyAssign->getLang("repository_item_relation_references")),
+            array("isFormatOf", $smartyAssign->getLang("repository_item_relation_is_format_of")),
+            array("hasFormat", $smartyAssign->getLang("repository_item_relation_has_format"))
+        );
+        $this->Session->setParameter("relationArray", $this->relationArray);
+        $this->relationArray_count = count($this->relationArray);
+        
+        // ツリー開閉情報
+        $indice = $this->Session->getParameter("indice");
+        $open_ids = $this->Session->getParameter("view_open_node_index_id_item_link");
+        if(strlen($open_ids) > 0)
+        {
+            for($ii=0; $ii<count($indice); $ii++){
+                $parent_index = array();
+                $this->getParentIndex($indice[$ii]["index_id"], $parent_index);
+                for($jj=0; $jj<count($parent_index); $jj++){
+                    if(!is_numeric(strpos($open_ids, ",".$parent_index[$jj]["index_id"].","))){
+                        if(substr_count($open_ids, ",".$parent_index[$jj]["index_id"].",")==0 &&
+                          $parent_index[$jj]["index_id"] != $indice[$ii]["index_id"]){
+                            $open_ids .= ",".$parent_index[$jj]["index_id"].",";
                         }
                     }
                 }
-                $this->Session->setParameter("view_open_node_index_id_item_link", $open_ids);
             }
-            
-            // セッションからエラーメッセージのコピー
-            $this->error_msg = $this->Session->getParameter("error_msg");
-            if(!is_array($this->error_msg))
+            $this->Session->setParameter("view_open_node_index_id_item_link", $open_ids);
+        }
+        
+        if($this->Session->getParameter("link_search_error") != null){
+            $this->addErrMsg(sprintf($smartyAssign->getLang("repository_item_link_search_error"), $this->Session->getParameter("link_search_error")));
+        }
+        if($this->Session->getParameter("link_search_no_item") != null){
+            $this->addErrMsg(sprintf($smartyAssign->getLang("repository_item_link_search_no_item"), $this->Session->getParameter("link_search_no_item")));
+        }
+        $this->Session->removeParameter("link_search_error");
+        $this->Session->removeParameter("link_search_no_item");
+        $this->Session->removeParameter("edit_jalc_flag");
+        
+        // Add Default Search Type 2014/12/03 K.Sugimoto --start--
+        if(strlen($this->Session->getParameter("link_searchtype")) == 0){
+            $searchParam = new RepositorySearchRequestParameter();
+            $result = $searchParam->getDefaultSearchType();
+            if(isset($result[0]['param_value']))
             {
-                $this->error_msg = array();
-            }
-            $this->Session->removeParameter("error_msg");
-            $this->setLangResource();
-            // Bugfix error_meg 2011/06/03 Y.Nakao --start--
-            if($this->Session->getParameter("link_search_error") != null){
-                array_push($this->error_msg, sprintf($this->Session->getParameter("smartyAssign")->getLang("repository_item_link_search_error"), $this->Session->getParameter("link_search_error")));
-            }
-            if($this->Session->getParameter("link_search_no_item") != null){
-                array_push($this->error_msg, sprintf($this->Session->getParameter("smartyAssign")->getLang("repository_item_link_search_no_item"), $this->Session->getParameter("link_search_no_item")));
-            }
-            // Bugfix error_meg 2011/06/03 Y.Nakao --end--
-            $this->Session->removeParameter("link_search_error");
-            $this->Session->removeParameter("link_search_no_item");
-            $this->warning = $this->Session->getParameter("warning");
-            $this->Session->removeParameter("warning");
-            
-            $this->Session->removeParameter("edit_jalc_flag");
-
-            // Set help icon setting 2010/02/10 K.Ando --start--
-            $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            // Set help icon setting 2010/02/10 K.Ando --end--
-            
-            // Add addin S.Arata 2012/08/02 --start--
-            $this->addin->postExecute();
-            // Add addin S.Arata 2012/08/02 --end--
-            
-            // アクション終了処理
-            $result = $this->exitAction();  // トランザクションが成功していればCOMMITされる
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
+                if($result[0]['param_value'] == 0)
+                {
+                    $this->Session->setParameter("link_searchtype", "detail");
+                }
+                else if($result[0]['param_value'] == 1)
+                {
+                    $this->Session->setParameter("link_searchtype", "simple");
+                }
             }
-            return 'success';
-        } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            $this->logFile(
-                "SampleAction",                 //クラス名
-                "execute",                      //メソッド名
-                $Exception->getCode(),          //ログID
-                $Exception->getMessage(),       //主メッセージ
-                $Exception->getDetailMsg() );   //詳細メッセージ           
-            //アクション終了処理
-            $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_error_msg);
-            return "error";
         }
+        // Add Default Search Type 2014/12/03 K.Sugimoto --end--
+        
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        
+        return 'success';
     }
 }
 ?>
diff --git a/repository/view/main/item/editlinks/maple.ini b/repository/view/main/item/editlinks/maple.ini
index b6ab318..56bb369 100644
--- a/repository/view/main/item/editlinks/maple.ini
+++ b/repository/view/main/item/editlinks/maple.ini
@@ -11,4 +11,4 @@ Db = "ref:DbObject"
 [View]
 define:theme = 1
 success = "repository_item_edit_links.html"
-texts = "action:repository_view_main_item_edittexts"
+error = "repository_item_edit_links.html"
diff --git a/repository/view/main/item/edittexts/Edittexts.class.php b/repository/view/main/item/edittexts/Edittexts.class.php
index e03b4c7..7d97965 100644
--- a/repository/view/main/item/edittexts/Edittexts.class.php
+++ b/repository/view/main/item/edittexts/Edittexts.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Edittexts.class.php 640 2014-10-24 08:07:50Z ivis $
+// $Id: Edittexts.class.php 54835 2015-06-25 04:10:46Z keiya_sugimoto $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,353 +12,336 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/NameAuthority.class.php';
 
 /**
- * [[機能説明]]
+ * アイテム登録：メタデータ入力画面表示
  *
- * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Item_Edittexts extends RepositoryAction
+class Repository_View_Main_Item_Edittexts extends WekoAction
 {
-    //メンバ変数
-//    var $year_option_pub = array();
-    var $month_option_pub = array();
-    var $day_option_pub = array();
+    // 表示用パラメーター
     
-    // 発行年月日の表示処理　A.Suzuki 2008/10/07 --Start--
-    var $year_of_issued = "";        // 発行年
-    var $month_of_issued = array();    // 発行月
-    var $day_of_issued = array();    // 発行日
-    // 発行年月日の表示処理　A.Suzuki 2008/10/07 --End--
+    /**
+     * アイテム公開日：月 選択肢配列
+     * @var array
+     */
+    public $month_option_pub = array();
     
-    // アイテム属性：date 追加　A.Suzuki 2008/10/14 --Start--
-    var $year_of_date = "";        // 年
-    var $month_of_date = array();    // 月
-    var $day_of_date = array();        // 日
-    // アイテム属性：date　追加  A.Suzuki 2008/10/14 --End--
+    /**
+     * アイテム公開日：日 選択肢配列
+     * @var array
+     */
+    public $day_option_pub = array();
     
-    // Add search bar for fill data 2008/11/19 A.Suzuki --start--
-    var $biblio_info_check = false;    // 書誌情報の存在チェック(存在する:true, 存在しない:false)
-    var $access_key_check = false;    // AWSAccessKeyIdの存在チェック(存在する:true, 存在しない:false)
-    // Add search bar for fill data 2008/11/19 A.Suzuki --end--
+    /**
+     * 書誌情報：発行年月日 月 選択肢配列
+     * @var array
+     */
+    public $month_of_issued = array();
     
-    var $link_data = array();
+    /**
+     * 書誌情報：発行年月日 日 選択肢配列
+     * @var array
+     */
+    public $day_of_issued = array();
     
-    var $error_msg = array();        // エラーメッセージ
-    var $warning = "";        // 警告
-
-    // Set help icon setting 2010/02/10 K.Ando --start--
-    var $help_icon_display =  "";
-    // Set help icon setting 2010/02/10 K.Ando --end--
+    /**
+     * 日付：月 選択肢配列
+     * @var array
+     */
+    public $month_of_date = array();
     
-    // Add contents page Y.Nakao 2010/08/06 --start--
-    var $heading = array();
-    // Add contents page Y.Nakao 2010/08/06 --end--
+    /**
+     * 日付：日 選択肢配列
+     * @var array
+     */
+    public $day_of_date = array();
+    
+    /**
+     * 書誌情報の存在チェックフラグ
+     * @var bool
+     */
+    public $biblio_info_check = false;
     
-    // Get author ID prefix list 2010/11/04 A.Suzuki --start--
-    var $author_id_prefix_list = array();
-    // Get author ID prefix list 2010/11/04 A.Suzuki --end--
+    /**
+     * AWSAccessKeyIdの存在チェックフラグ
+     * @var bool
+     */
+    public $access_key_check = false;
+    
+    /**
+     * link情報配列
+     * @var array
+     */
+    public $link_data = array();
     
     /**
-     * [[機能説明]]
-     *
-     * @access  public
+     * heading情報配列
+     * @var array
      */
-    function execute()
+    public $heading = array();
+    
+    /**
+     * author_id_prefix配列
+     * @var array
+     */
+    public $author_id_prefix_list = array();
+    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+    /**
+     * crossrefフラグ
+     * @var bool
+     */
+    public $crossref_flg = false;
+    // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+    
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
+     */
+    public $help_icon_display =  "";
+    
+    // リクエストパラメーター
+    /**
+     * 警告メッセージ配列
+     * @var array
+     */
+    public $warningMsg = null;
+    
+    /**
+     * 実行処理
+     * @see ActionBase::executeApp()
+     */
+    protected function executeApp()
     {
-        $istest = true;                // テスト用フラグ
-           try {            
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            
-            // Add addin Y.Nakao 2012/07/27 --start--
-            $this->addin->preExecute();
-            // Add addin Y.Nakao 2012/07/27 --end--
-            
-            $NameAuthority = new NameAuthority($this->Session, $this->Db);
-/*
-        // 開始・終了日の選択候補（デフォルトチェック込み）文字列の作成
-        // 年
-        $now = mktime();
-//        for ( $ii=-6; $ii<=0; $ii++ ) {        // 6年前から現在まで (ログ用)
-           for ( $ii=-10; $ii<=10; $ii++ ) {    // 10年前から10年後まで
-            $str_year = date(
-                            "Y",
-                            mktime(
-                                date('H',$now),
-                                date('i',$now),
-                                date('s',$now),
-                                date('m',$now),
-                                date('d',$now),
-                                date('Y',$now)+$ii
-                            )
-            );
-            $select_s = $ii==-1 ? 1 : 0;
-            $select_e = $ii==0 ? 1 : 0;
-            array_push($this->year_option_start,Array($str_year,$select_s));
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $repositoryAction->setLangResource();
+        
+        $NameAuthority = new NameAuthority($this->Session, $this->Db);
+        
+        // セッションから現在のアイテム公開日を取得
+        $item_pub_date = $this->Session->getParameter('item_pub_date');
+        
+        // 月
+        for ( $ii=1; $ii<=12; $ii++ ) {
+            $str_month = ($ii);
+            $select = ($ii == $item_pub_date['month']) ? 1 : 0;
+            array_push($this->month_option_pub, array($str_month,$select));
         }
-*/
-            // セッションから現在のアイテム公開日を取得
-            $item_pub_date = $this->Session->getParameter('item_pub_date');
-                        
-            // 月
-            for ( $ii=1; $ii<=12; $ii++ ) {
-                $str_month = ($ii);
-//                $select = $str_month==date('m',$now) ? 1 : 0;
-                $select = ($ii == $item_pub_date['month']) ? 1 : 0;
-                array_push($this->month_option_pub, array($str_month,$select));
-            }
-            // 日
-            for ( $ii=1; $ii<=31; $ii++ ) {
-                $str_day = ($ii);
-//                $select = $str_day==date('d',$now) ? 1 : 0;
-                $select = ($ii == $item_pub_date['day']) ? 1 : 0;
-                array_push($this->day_option_pub, array($str_day,$select));
-            }
-            
-            // 発行年月日の表示処理　A.Suzuki 2008/10/07 --Start--
-            // セッションから現在の発行年月日を取得
-            $temp_item_attr_type = $this->Session->getParameter('item_attr_type');
-            $temp_item_attr = $this->Session->getParameter('item_attr');
-            
-            $this->month_of_issued = array();
-            $this->day_of_issued = array();
-            $this->month_of_date = array();
-            $this->day_of_date = array();
-            if(count($temp_item_attr_type) > 0)
-            {
-                $this->month_of_issued = array_fill(0,count($temp_item_attr_type),array());
-                $this->day_of_issued = array_fill(0,count($temp_item_attr_type),array());
-                
-                $this->month_of_date = array_fill(0,count($temp_item_attr_type),array());
-                $this->day_of_date = array_fill(0,count($temp_item_attr_type),array());
-            }
+        // 日
+        for ( $ii=1; $ii<=31; $ii++ ) {
+            $str_day = ($ii);
+            $select = ($ii == $item_pub_date['day']) ? 1 : 0;
+            array_push($this->day_option_pub, array($str_day,$select));
+        }
+        
+        // セッションから現在の発行年月日を取得
+        $temp_item_attr_type = $this->Session->getParameter('item_attr_type');
+        $temp_item_attr = $this->Session->getParameter('item_attr');
+        $this->month_of_issued = array();
+        $this->day_of_issued = array();
+        $this->month_of_date = array();
+        $this->day_of_date = array();
+        if(count($temp_item_attr_type) > 0)
+        {
+            $this->month_of_issued = array_fill(0,count($temp_item_attr_type),array());
+            $this->day_of_issued = array_fill(0,count($temp_item_attr_type),array());
             
-            for ($ii=0; $ii<count($temp_item_attr_type); $ii++) {
-                if ($temp_item_attr_type[$ii]['input_type'] == 'biblio_info') {
-                    // Add search bar for fill data 2008/11/19 A.Suzuki --start--
-                    // アイテムタイプに書誌情報があるかチェック
-                    if($this->biblio_info_check == false){
-                        $this->biblio_info_check = true;    
+            $this->month_of_date = array_fill(0,count($temp_item_attr_type),array());
+            $this->day_of_date = array_fill(0,count($temp_item_attr_type),array());
+        }
+        
+        for ($ii=0; $ii<count($temp_item_attr_type); $ii++) {
+            if ($temp_item_attr_type[$ii]['input_type'] == 'biblio_info') {
+                // アイテムタイプに書誌情報があるかチェック
+                if($this->biblio_info_check == false){
+                    $this->biblio_info_check = true;
+                }
+                // 月
+                for ( $jj=1; $jj<=12; $jj++ ) {
+                    $str_month = ($jj);
+                    $select = 0;
+                    if(isset($temp_item_attr[$ii][0]['month']) && $jj == $temp_item_attr[$ii][0]['month'])
+                    {
+                        $select = 1;
                     }
-                    // Add search bar for fill data 2008/11/19 A.Suzuki --end--
-                    
+                    array_push($this->month_of_issued[$ii], array($str_month,$select));
+                }
+                // 日
+                for ( $jj=1; $jj<=31; $jj++ ) {
+                    $str_day = ($jj);
+                    $select = 0;
+                    if(isset($temp_item_attr[$ii][0]['day']) && $jj == $temp_item_attr[$ii][0]['day'])
+                    {
+                        $select = 1;
+                    }
+                    array_push($this->day_of_issued[$ii], array($str_day,$select));
+                }
+            } else if ($temp_item_attr_type[$ii]['input_type'] == 'date') {
+                for($ll=0; $ll<count($temp_item_attr[$ii]); $ll++){
+                    $monthArray[$ll] = array();
+                    $dayArray[$ll] = array();
                     // 月
                     for ( $jj=1; $jj<=12; $jj++ ) {
                         $str_month = ($jj);
                         $select = 0;
-                        if(isset($temp_item_attr[$ii][0]['month']) && $jj == $temp_item_attr[$ii][0]['month'])
-                        {
+                        if(isset($temp_item_attr[$ii][$ll]['date_month']) && $temp_item_attr[$ii][$ll]['date_month'] == $jj) {
                             $select = 1;
                         }
-                        array_push($this->month_of_issued[$ii], array($str_month,$select));
+                        array_push($monthArray[$ll], array($str_month,$select));
                     }
                     // 日
                     for ( $jj=1; $jj<=31; $jj++ ) {
                         $str_day = ($jj);
                         $select = 0;
-                        if(isset($temp_item_attr[$ii][0]['day']) && $jj == $temp_item_attr[$ii][0]['day'])
-                        {
+                        if(isset($temp_item_attr[$ii][$ll]['date_day']) && $temp_item_attr[$ii][$ll]['date_day'] == $jj) {
                             $select = 1;
                         }
-                        array_push($this->day_of_issued[$ii], array($str_day,$select));
+                        array_push($dayArray[$ll], array($str_day,$select));
                     }
+                    array_push($this->month_of_date[$ii], $monthArray[$ll]);
+                    array_push($this->day_of_date[$ii], $dayArray[$ll]);
                 }
-                // Add item attribute:date 2008/10/14 A.Suzuki --Start--
-                else if ($temp_item_attr_type[$ii]['input_type'] == 'date') {
-                    for($ll=0; $ll<count($temp_item_attr[$ii]); $ll++){
-                        $monthArray[$ll] = array();
-                        $dayArray[$ll] = array();
-                        // 月
-                        for ( $jj=1; $jj<=12; $jj++ ) {
-                            $str_month = ($jj);
-                            // Bug fix undefined key 2014/09/05 T.Ichikawa --start--
-                            $select = 0;
-                            if(isset($temp_item_attr[$ii][$ll]['date_month']) && $temp_item_attr[$ii][$ll]['date_month'] == $jj) {
-                                $select = 1;
-                            }
-                            //array_push($this->month_of_date[$ii], array($str_month,$select));
-                            array_push($monthArray[$ll], array($str_month,$select));
-                        }
-                        // 日
-                        for ( $jj=1; $jj<=31; $jj++ ) {
-                            $str_day = ($jj);
-                            $select = 0;
-                            if(isset($temp_item_attr[$ii][$ll]['date_day']) && $temp_item_attr[$ii][$ll]['date_day'] == $jj) {
-                                $select = 1;
-                            }
-                            // Bug fix undefined key 2014/09/05 T.Ichikawa --end--
-                            //array_push($this->day_of_date[$ii], array($str_day,$select));
-                            array_push($dayArray[$ll], array($str_day,$select));
-                        }
-                        array_push($this->month_of_date[$ii], $monthArray[$ll]);
-                        array_push($this->day_of_date[$ii], $dayArray[$ll]);
-                    }
+            } else if($temp_item_attr_type[$ii]['input_type'] == 'link'){
+                for($jj=0; $jj<count($temp_item_attr[$ii]); $jj++){
+                    $this->link_data[$ii][$jj] = explode("|", $temp_item_attr[$ii][$jj], 2);
                 }
-                // Add item attribute:date 2008/10/14 A.Suzuki --End--
-                // Add link name 2009/03/19 A.Suzuki --start--
-                else if($temp_item_attr_type[$ii]['input_type'] == 'link'){
-                    for($jj=0; $jj<count($temp_item_attr[$ii]); $jj++){
-                        $this->link_data[$ii][$jj] = explode("|", $temp_item_attr[$ii][$jj], 2);
-                    }
-                }
-                // Add link name 2009/03/19 A.Suzuki --end--
-                // Add contents page Y.Nakao 2010/08/06 --start--
-                else if($temp_item_attr_type[$ii]['input_type'] == 'heading'){
-                    for($jj=0; $jj<count($temp_item_attr[$ii]); $jj++){
-                        $this->heading[$jj] = explode("|", $temp_item_attr[$ii][$jj], 4);
-                    }
+            } else if($temp_item_attr_type[$ii]['input_type'] == 'heading'){
+                for($jj=0; $jj<count($temp_item_attr[$ii]); $jj++){
+                    $this->heading[$jj] = explode("|", $temp_item_attr[$ii][$jj], 4);
                 }
-                // Add contents page Y.Nakao 2010/08/06 --end--
-            }
-            // 発行年月日の表示処理　A.Suzuki 2008/10/07 --End--
-
-            // Add search bar for fill data 2008/11/20 A.Suzuki --start--
-            // AWSAccesskeyIdが登録されているかをチェック
-               $query = "SELECT param_value ".
-                     "FROM ". DATABASE_PREFIX ."repository_parameter ".    
-                     "WHERE param_name = 'AWSAccessKeyId' AND ".
-                     "is_delete = 0; ";            // 削除されていない
-            $params = null;
-            //　SELECT実行
-            $result = $this->Db->execute($query, $params);
-            if($result === false) {
-                return 'error';
-            }
-            //AWSAccessKeyIdが登録されている場合
-            if(trim($result[0]['param_value']) != null) {
-                $this->access_key_check = true;
-            }
-            // Add search bar for fill data 2008/11/20 A.Suzuki --end--
-            
-            // Add for get lang resource 2008/12/17 A.Suzuki --start--
-            $this->setLangResource();
-            // Add for get lang resource 2008/12/17 A.Suzuki --end--
-            
-            // アイテムリンク設定画面から戻ってきた場合
-            // リンクアイテム検索で使用したセッションを削除する
-            $this->Session->removeParameter("search_index_id_link");
-            $this->Session->removeParameter("link_searchkeyword");
-            $this->Session->removeParameter("link_search");
-            $this->Session->removeParameter("view_open_node_index_id_item_link");
-
-            // Set help icon setting 2010/02/10 K.Ando --start--
-            $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
             }
-            // Set help icon setting 2010/02/10 K.Ando --end--
-            
-            // Get author ID prefix list 2010/11/04 A.Suzuki --start--
-            $result = $NameAuthority->getExternalAuthorIdPrefixList();
-            if($result === false) {
-                $this->failTrans();
-                return 'error';
-            }
-            $this->author_id_prefix_list = $result;
-            // Get author ID prefix list 2010/11/04 A.Suzuki --end--
-            
-            // Check ichushi connect staus 2012/12/05 A.Jin --start--
-            //医中誌連携チェックがONか調べる
-            $query = "SELECT param_value ".
-                     "FROM ". DATABASE_PREFIX ."repository_parameter ". 
-                     "WHERE param_name = 'ichushi_is_connect' AND ".
-                     "is_delete = 0; ";         // 削除されていない
-            $params = null;
-            // SELECT実行
-               $result = $this->Db->execute($query, $params);
-            if($result === false) {
-                return 'error';
-            }
-               // ichushi_is_connectが登録されている場合
-            if($result[0]['param_value'] == 1) {
-                $login_id = "";
-                $login_password = "";
-                $cookie = "";
-                
-                //ログイン情報取得
-                $is_get_login_info = $this->getLoginInfoIchushi($login_id, $login_password);
-                //ログインチェック
-                if($is_get_login_info == true) {
-                    $result = $this->loginIchushi($login_id,$login_password,$cookie);
-                    if($result === true){
-                        $this->Session->setParameter("login_connect", 1);
-                        //ログアウト
-                        $this->logoutIchushi($cookie);
-                    } else {
-                        $this->Session->setParameter("login_connect", 0);
-                    }
+        }
+        
+        // AWSAccesskeyIdが登録されているかをチェック
+        $query = "SELECT param_value ".
+                 "FROM {repository_parameter} ".
+                 "WHERE param_name = ? ".
+                 "AND is_delete = ?; ";
+        $params = array();
+        $params[] = 'AWSAccessKeyId';
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($this->Db->ErrorMsg());
+            $exception->addError($this->Db->ErrorMsg());
+            throw $exception;
+        }
+        //AWSAccessKeyIdが登録されている場合
+        if(trim($result[0]['param_value']) != null) {
+            $this->access_key_check = true;
+        }
+        // Add search bar for fill data 2008/11/20 A.Suzuki --end--
+        
+        // アイテムリンク設定画面から戻ってきた場合
+        // リンクアイテム検索で使用したセッションを削除する
+        $this->Session->removeParameter("search_index_id_link");
+        $this->Session->removeParameter("link_searchkeyword");
+        $this->Session->removeParameter("link_search");
+        $this->Session->removeParameter("link_searchtype");
+        $this->Session->removeParameter("view_open_node_index_id_item_link");
+        
+        // Get author ID prefix list 2010/11/04 A.Suzuki --start--
+        $result = $NameAuthority->getExternalAuthorIdPrefixList();
+        if($result === false) {
+            $tmpErrorMsg = "Cannot get external authorID prefix list.";
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        $this->author_id_prefix_list = $result;
+        // Get author ID prefix list 2010/11/04 A.Suzuki --end--
+        
+        // Check ichushi connect staus 2012/12/05 A.Jin --start--
+        //医中誌連携チェックがONか調べる
+        $query = "SELECT param_value ".
+                 "FROM {repository_parameter} ". 
+                 "WHERE param_name = ? ".
+                 "AND is_delete = ?; ";
+        $params = array();
+        $params[] = 'ichushi_is_connect';
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($this->Db->ErrorMsg());
+            $exception->addError($this->Db->ErrorMsg());
+            throw $exception;
+        }
+        // ichushi_is_connectが登録されている場合
+        if($result[0]['param_value'] == 1) {
+            $login_id = "";
+            $login_password = "";
+            $cookie = "";
+            //ログイン情報取得
+            $is_get_login_info = $repositoryAction->getLoginInfoIchushi($login_id, $login_password);
+            //ログインチェック
+            if($is_get_login_info == true) {
+                $result = $repositoryAction->loginIchushi($login_id,$login_password,$cookie);
+                if($result === true){
+                    $this->Session->setParameter("login_connect", 1);
+                    //ログアウト
+                    $repositoryAction->logoutIchushi($cookie);
                 } else {
                     $this->Session->setParameter("login_connect", 0);
                 }
             } else {
                 $this->Session->setParameter("login_connect", 0);
             }
-            // Check ichushi connect staus 2012/12/05 A.Jin --end--
-            
-            // セッションからエラーメッセージのコピー
-            $this->error_msg = $this->Session->getParameter("error_msg");
-                $this->Session->removeParameter("error_msg");
-                if(!is_array($this->error_msg))
-                {
-                    $this->error_msg = array();
-                }
-                
-                if($this->error_msg != "" && !is_array($this->error_msg)){
-                    $tmp_error = $this->error_msg;
-                    $this->error_msg = array($tmp_error);
-                    unset($tmp_error);
-                }
-                
-                $this->warning = $this->Session->getParameter("warning");
-            $this->Session->removeParameter("warning");
-            
-            // Add addin Y.Nakao 2012/07/27 --start--
-            $this->addin->postExecute();
-            // Add addin Y.Nakao 2012/07/27 --end--
-            
-            // アクション終了処理
-            $result = $this->exitAction();  // トランザクションが成功していればCOMMITされる
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
+        } else {
+            $this->Session->setParameter("login_connect", 0);
+        }
+        // Check ichushi connect staus 2012/12/05 A.Jin --end--
             
-            return 'success';
-        } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            $this->logFile(
-                "SampleAction",                    //クラス名
-                "execute",                        //メソッド名
-                $Exception->getCode(),            //ログID
-                $Exception->getMessage(),        //主メッセージ
-                $Exception->getDetailMsg() );    //詳細メッセージ            
-            //アクション終了処理
-              $this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-            //異常終了
-            $this->Session->setParameter("error_msg", $user_error_msg);
-            return "error";
+        // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --start--
+        $query = "SELECT param_value ".
+                 "FROM {repository_parameter} ".
+                 "WHERE param_name = ? ".
+                 "AND is_delete = ? ;";
+        $params = array();
+        $params[] = "crossref_query_service_account";
+        $params[] = 0;
+        $result = $this->Db->execute($query, $params);
+        if($result === false) {
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($this->Db->ErrorMsg());
+            $exception->addError($this->Db->ErrorMsg());
+            throw $exception;
+        }
+        if(count($result) > 0 && strlen($result[0]['param_value']) > 0)
+        {
+            $this->crossref_flg = true;
+        }
+        // Auto Input Metadata by CrossRef DOI 2015/03/02 K.Sugimoto --end--
+        
+        $error_msg = $this->Session->getParameter("error_msg");
+        if(count($error_msg) > 0)
+        {
+            $this->errMsg = $error_msg;
+            $this->Session->removeParameter("error_msg");
+        }
+        
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
         }
+        
+        return 'success';
     }
 }
 ?>
diff --git a/repository/view/main/item/edittexts/maple.ini b/repository/view/main/item/edittexts/maple.ini
index c2aa2cf..183799c 100644
--- a/repository/view/main/item/edittexts/maple.ini
+++ b/repository/view/main/item/edittexts/maple.ini
@@ -11,3 +11,4 @@ Db = "ref:DbObject"
 [View]
 define:theme = 1
 success = "repository_item_edit_texts.html"
+error = "repository_item_edit_texts.html"
diff --git a/repository/view/main/item/selecttype/Selecttype.class.php b/repository/view/main/item/selecttype/Selecttype.class.php
index 85a023f..56b1c97 100644
--- a/repository/view/main/item/selecttype/Selecttype.class.php
+++ b/repository/view/main/item/selecttype/Selecttype.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Selecttype.class.php 600 2014-08-06 04:41:16Z ivis $
+// $Id: Selecttype.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,225 +12,212 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/Checkdoi.class.php';
+require_once WEBAPP_DIR. '/modules/repository/components/ItemtypeManager.class.php';
 
 /**
- * [[アイテム登録：アイテムタイプ選択画面用VIEW]]
+ * アイテム登録：アイテムタイプ選択画面表示
  *
  * @package     [[package名]]
  * @access      public
  * @version 1.0 新規作成
  *          2.0 登録フロー表示改善対応 2008/06/26 Y.Nakao  
  */
-class Repository_View_Main_Item_Selecttype extends RepositoryAction
+class Repository_View_Main_Item_Selecttype extends WekoAction
 {
-	// メンバ変数
-	/*
-	 * item type data
-	 * 0: item type id
-	 * 1: item type name
-	 * 2: flag thag the item type is able to grant doi or not
-	 *    can grant:1, cannot grant:0
-	 */
-	var $itemtype_data= array();
-	var $error_msg = array();		// エラーメッセージ
-	var $itemtype_file = array();  // アイテムタイプの属性にファイルが含まれているか否か
-
-    // Set help icon setting 2010/02/10 K.Ando --start--
-    var $help_icon_display =  "";
-    // Set help icon setting 2010/02/10 K.Ando --end--
-	
-	/**
-     * [[機能説明]]
-     *
-     * @access  public
+    // 表示用パラメーター
+    /**
+     * item type data
+     *   0: item type id
+     *   1: item type name
+     *   2: flag thag the item type is able to grant doi or not
+     *      can grant:1, cannot grant:0
+     * @var array
      */
-    function execute()
-    {    	
-    	$istest = true;				// テスト用フラグ
-       	try {    		
-	        //アクション初期化処理
-	        $result = $this->initAction();
-    		if ( $result === false ) {
-	            $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-	        }
-                
-	    	// タブ切替時にセッションの初期化
-	    	$this->Session->removeParameter("edit_flag");
-	    	$this->Session->removeParameter("edit_item_id");
-	    	$this->Session->removeParameter("edit_item_no");
-	    	$this->Session->removeParameter("edit_start_date");
-	    	$this->Session->removeParameter("delete_file_list");
-	    	$this->Session->removeParameter('item_pub_date');
-	    	$this->Session->removeParameter('item_keyword');
-	    	$this->Session->removeParameter("item_type_all");
-	    	$this->Session->removeParameter("item_attr_type");
-	    	$this->Session->removeParameter("item_num_cand");
-	    	$this->Session->removeParameter("option_data");
-	    	$this->Session->removeParameter("isfile");
-	    	$this->Session->removeParameter("item_num_attr");
-	    	$this->Session->removeParameter("item_attr");
-	    	$this->Session->removeParameter("base_attr");
-	    	$this->Session->removeParameter("indice");
-	    	$this->Session->removeParameter("link");
-	    	$this->Session->removeParameter("link_search");
-	    	$this->Session->removeParameter("link_searchkeyword");
-	    	$this->Session->removeParameter("open_node_index_id_link");
-	    	$this->Session->removeParameter("open_node_index_id_index");
-	    	$this->Session->removeParameter("license_master");
-	    	$this->Session->removeParameter("error_msg");
-			// 登録フローに表示されるファイル登録部分の改善対応 update 2008/06/26 Y.Nakao --start--
-	    	$this->Session->removeParameter("attr_file_flg");
-			// 登録フローに表示されるファイル登録部分の改善対応 update 2008/06/26 Y.Nakao --end--
-			$this->Session->removeParameter("doi_itemtype_flag");
-			
-            // Add e-person 2013/11/20 R.Matsuura --start--
-            $this->Session->removeParameter("feedback_mailaddress_str");
-            $this->Session->removeParameter("feedback_mailaddress_author_str");
-            $this->Session->removeParameter("feedback_mailaddress_array");
-            $this->Session->removeParameter("feedback_mailaddress_author_array");
-            // Add e-person 2013/11/20 R.Matsuura --end--
-			
-	    	// Add file price Y.Nakao 2008/08/28 --start--
-			$this->Session->removeParameter("all_group");
-			$this->Session->removeParameter("user_group");
-			// Add file price Y.Nakao 2008/08/28 --end--
-
-			// change index tree 2008/12/03 Y.Nakao --start--
-	    	$this->Session->removeParameter("view_open_node_index_id_insert_item");
-	    	$this->Session->removeParameter("view_open_node_index_id_item_link");
-	    	// change index tree 2008/12/03 Y.Nakao --end--
-				    	    	
-	    	// 既存の全アイテムタイプをDBから取得
-	       	$query = "SELECT * ".
-	       			 "FROM ". DATABASE_PREFIX ."repository_item_type ".		// アイテムタイプテーブル
-	       			 "WHERE is_delete = ?; ";			// 削除フラグ
-	       	$params = null;
-	       	$params[] = 0;		
-	    	//　SELECT実行
-	        $item_type = $this->Db->execute($query, $params);
-	 		if($item_type === false){
-	    		$errNo = $this->Db->ErrorNo();
-			    $errMsg = $this->Db->ErrorMsg();
-			    $this->Session->setParameter("error_msg",$errMsg);
-	    		return 'error';
-	    	}
-	    	// 主キーとアイテム名を抜き出し
-	    	$this->itemtype_data = array();
-	    	// 登録フローに表示されるファイル登録部分の改善対応 2008/06/26 Y.Nakao --start--
-	    	// default item type 2008/09/17 Y.Nakao --start--
-	    	$default_itemtype = array();
-   			$create_itemtype = array();
-   			$default_file = array();
-   			$create_file = array();
-	    	for($ii=0; $ii<count($item_type); $ii++) {
-				// 現アイテムタイプの属性を取得
-	    		$query = "SELECT INPUT_TYPE ".
-						 "FROM ". DATABASE_PREFIX ."repository_item_attr_type ".
-						 "WHERE item_type_id = ? ".
-	    				 "AND is_delete = ?; ";
-	    		$params = null;
-	    		$params[] = $item_type[$ii]['item_type_id'];
-	    		$params[] = 0;
-	    		$item_attr = $this->Db->execute($query, $params);
-	    		if($item_attr === false){
-	    			$errNo = $this->Db->ErrorNo();
-			    	$errMsg = $this->Db->ErrorMsg();
-			    	$this->Session->setParameter("error_msg",$errMsg);
-	    			return 'error';
-	    		}
-	    		$attr_file = 0;
-	    		for($jj=0; $jj<count($item_attr); $jj++){
-	    			if( strcmp($item_attr[$jj]['INPUT_TYPE'], "file") == 0 || 
-	    				strcmp($item_attr[$jj]['INPUT_TYPE'], "file_price") == 0 || // Add file price Y.Nakao 2008/08/28
-	    				strcmp($item_attr[$jj]['INPUT_TYPE'], "thumbnail") == 0){
-	    				$attr_file = 1;
-	    				break;
-	    			}
-	    		}
-	    		// default item type show top
-	    		if($item_type[$ii]['item_type_id']>1000){
-                    if($item_type[$ii]['item_type_id']<20001)
-                    {
-                        array_push($default_itemtype,
-                            array($item_type[$ii]['item_type_id'], $item_type[$ii]['item_type_name']));
-                        array_push($default_file, $attr_file);
-                    }
-	    		} else {
-	    			array_push($create_itemtype,
-	    				array($item_type[$ii]['item_type_id'], $item_type[$ii]['item_type_name']));
-	    			array_push($create_file, $attr_file);
-	    		}
-	    		
-	    	}
-	    	$this->itemtype_data = array();
-    		$this->itemtype_data = array_merge($default_itemtype, $create_itemtype);
-    		$this->itemtype_file = array();
-    		$this->itemtype_file = array_merge($default_file, $create_file);
-    		// default item type 2008/09/17 Y.Nakao --end--
-			// 登録フローに表示されるファイル登録部分の改善対応 2008/06/26 Y.Nakao --end--
-	    	
-    		for($cnt = 0; $cnt < count($this->itemtype_data); $cnt++)
-    		{
-                $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->TransStartDate);
-                if($CheckDoi->checkDoiGrantItemtype($this->itemtype_data[$cnt][0], Repository_Components_Checkdoi::TYPE_JALC_DOI) || 
-                   $CheckDoi->checkDoiGrantItemtype($this->itemtype_data[$cnt][0], Repository_Components_Checkdoi::TYPE_CROSS_REF))
+    public $itemtype_data = array();
+    
+    /**
+     * アイテムタイプの属性にファイルが含まれているか否かを示す配列
+     * @var array
+     */
+    public $itemtype_file = array();
+    
+    /**
+     * ヘルプアイコン表示フラグ
+     * @var string
+     */
+    public $help_icon_display = "";
+    
+    // リクエストパラメーター
+    /**
+     * 警告メッセージ配列
+     * @var array
+     */
+    public $warningMsg = null;
+    
+    /**
+     * 実行処理
+     * @see ActionBase::executeApp()
+     */
+    protected function executeApp()
+    {
+        // タブ切替時にセッションの初期化
+        $this->initSessionParams();
+        
+        // RepositoryActionのインスタンス
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->dbAccess = $this->Db;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        
+        // Add itemtype authority 2014/12/18 T.Ichikawa --start--
+        $item_type = array();
+        // 権限IDを取得する
+        $query = "SELECT role_authority_id ".
+                 "FROM ".DATABASE_PREFIX. "users ".
+                 "WHERE user_id = ? ;";
+        $params = array();
+        $params[] = $this->Session->getParameter("_user_id");
+        $role_auth = $this->Db->execute($query, $params);
+        if(count($role_auth) > 0) {
+            // ユーザー権限レベルを取得する
+            $query = "SELECT user_authority_id ".
+                     "FROM ".DATABASE_PREFIX. "authorities ".
+                     "WHERE role_authority_id = ? ;";
+            $params = array();
+            $params[] = $role_auth[0]["role_authority_id"];
+            $user_auth = $this->Db->execute($query, $params);
+            // 権限が一般以上ならアイテムタイプを取得する
+            if($user_auth[0]["user_authority_id"]  >= REPOSITORY_ITEM_REGIST_AUTH) {
+                // ルーム権限を取得する
+                $room_auth = $repositoryAction->getRoomAuthorityID($this->Session->getParameter("_user_id"));
+                // 現在のユーザーの権限で使用できるアイテムタイプを取得する
+                $itemtypeManager = new Repository_Components_Itemtypemanager($this->Session, $this->Db, $this->accessDate);
+                $item_type = $itemtypeManager->getItemtypeDataByUserAuth($role_auth[0]["role_authority_id"], $room_auth);
+            }
+        }
+        // Add itemtype authority 2014/12/18 T.Ichikawa --end--
+            
+        // 主キーとアイテム名を抜き出し
+        // 登録フローに表示されるファイル登録部分の改善対応 2008/06/26 Y.Nakao --start--
+        // default item type 2008/09/17 Y.Nakao --start--
+        $default_itemtype = array();
+        $create_itemtype = array();
+        $default_file = array();
+        $create_file = array();
+        for($ii=0; $ii<count($item_type); $ii++) {
+            // 現アイテムタイプの属性を取得
+            $query = "SELECT INPUT_TYPE ".
+                     "FROM ". DATABASE_PREFIX ."repository_item_attr_type ".
+                     "WHERE item_type_id = ? ".
+                     "AND is_delete = ?; ";
+            $params = array();
+            $params[] = $item_type[$ii]['item_type_id'];
+            $params[] = 0;
+            $item_attr = $this->Db->execute($query, $params);
+            if($item_attr === false){
+                $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+                $exception = new AppException($this->Db->ErrorMsg());
+                $exception->addError($this->Db->ErrorMsg());
+                throw $exception;
+            }
+            $attr_file = 0;
+            for($jj=0; $jj<count($item_attr); $jj++){
+                if( strcmp($item_attr[$jj]['INPUT_TYPE'], "file") == 0 || 
+                    strcmp($item_attr[$jj]['INPUT_TYPE'], "file_price") == 0 || // Add file price Y.Nakao 2008/08/28
+                    strcmp($item_attr[$jj]['INPUT_TYPE'], "thumbnail") == 0)
                 {
-                    array_push($this->itemtype_data[$cnt], 1);
+                    $attr_file = 1;
+                    break;
                 }
-                else
-                {
-                    array_push($this->itemtype_data[$cnt], 0);
+            }
+            
+            // default item type show top
+            if($item_type[$ii]['item_type_id']>1000){
+                if($item_type[$ii]['item_type_id']<20001){
+                    array_push($default_itemtype, array($item_type[$ii]['item_type_id'], $item_type[$ii]['item_type_name']));
+                    array_push($default_file, $attr_file);
                 }
-	    	}
-	    	
-	    	// セッションからエラーメッセージのコピー
-	    	$this->error_msg = $this->Session->getParameter("error_msg");
-   		 	$this->Session->removeParameter("error_msg");    
+            } else {
+                array_push($create_itemtype, array($item_type[$ii]['item_type_id'], $item_type[$ii]['item_type_name']));
+                array_push($create_file, $attr_file);
+            }
+        }
+        
+        $this->itemtype_data = array_merge($default_itemtype, $create_itemtype);
+        $this->itemtype_file = array_merge($default_file, $create_file);
+        // default item type 2008/09/17 Y.Nakao --end--
+        // 登録フローに表示されるファイル登録部分の改善対応 2008/06/26 Y.Nakao --end--
+        
+        for($cnt = 0; $cnt < count($this->itemtype_data); $cnt++){
+            $CheckDoi = new Repository_Components_Checkdoi($this->Session, $this->Db, $this->accessDate);
+            if( $CheckDoi->checkDoiGrantItemtype($this->itemtype_data[$cnt][0], Repository_Components_Checkdoi::TYPE_JALC_DOI) ||
+                $CheckDoi->checkDoiGrantItemtype($this->itemtype_data[$cnt][0], Repository_Components_Checkdoi::TYPE_CROSS_REF) ||
+                $CheckDoi->checkDoiGrantItemtype($this->itemtype_data[$cnt][0], Repository_Components_Checkdoi::TYPE_LIBRARY_JALC_DOI) ||
+                $CheckDoi->checkDoiGrantItemtype($this->itemtype_data[$cnt][0], Repository_Components_Checkdoi::TYPE_DATACITE))
+            {
+                array_push($this->itemtype_data[$cnt], 1);
+            } else {
+                array_push($this->itemtype_data[$cnt], 0);
+            }
+        }
         
-	        // Set help icon setting 2010/02/10 K.Ando --start--
-	        $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-			if ( $result == false ){
-				$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-			}
-	        // Set help icon setting 2010/02/10 K.Ando --end--
-   		 	
-       	    // アクション終了処理
-			$result = $this->exitAction();	// トランザクションが成功していればCOMMITされる
-			if ( $result == false ){
-				$exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );	//主メッセージとログIDを指定して例外を作成
-	            $DetailMsg = null;                              //詳細メッセージ文字列作成
-	            sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-	            $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-	            $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-	            throw $exception;
-			}
-	    	return 'success';
-        } catch ( RepositoryException $Exception) {
-    	    //エラーログ出力
-        	$this->logFile(
-	        	"SampleAction",					//クラス名
-	        	"execute",						//メソッド名
-	        	$Exception->getCode(),			//ログID
-	        	$Exception->getMessage(),		//主メッセージ
-	        	$Exception->getDetailMsg() );	//詳細メッセージ	        
-        	//アクション終了処理
-      		$this->exitAction();                   //トランザクションが失敗していればROLLBACKされる        
-	        //異常終了
-	        $this->Session->setParameter("error_msg", $user_error_msg);
-    	    return "error";
-		}
+        // Set help icon setting
+        $tmpErrorMsg = "";
+        $result = $repositoryAction->getAdminParam('help_icon_display', $this->help_icon_display, $tmpErrorMsg);
+        if ( $result === false ){
+            $this->errorLog($tmpErrorMsg, __FILE__, __CLASS__, __LINE__);
+            $exception = new AppException($tmpErrorMsg);
+            $exception->addError($tmpErrorMsg);
+            throw $exception;
+        }
+        
+        return 'success';
+    }
+    
+    /**
+     * セッションパラメーターの初期化
+     */
+    private function initSessionParams(){
+        $this->Session->removeParameter("edit_flag");
+        $this->Session->removeParameter("edit_item_id");
+        $this->Session->removeParameter("edit_item_no");
+        $this->Session->removeParameter("edit_start_date");
+        $this->Session->removeParameter("delete_file_list");
+        $this->Session->removeParameter('item_pub_date');
+        $this->Session->removeParameter('item_keyword');
+        $this->Session->removeParameter("item_type_all");
+        $this->Session->removeParameter("item_attr_type");
+        $this->Session->removeParameter("item_num_cand");
+        $this->Session->removeParameter("option_data");
+        $this->Session->removeParameter("isfile");
+        $this->Session->removeParameter("item_num_attr");
+        $this->Session->removeParameter("item_attr");
+        $this->Session->removeParameter("base_attr");
+        $this->Session->removeParameter("indice");
+        $this->Session->removeParameter("link");
+        $this->Session->removeParameter("link_search");
+        $this->Session->removeParameter("link_searchkeyword");
+        $this->Session->removeParameter("link_searchtype");
+        $this->Session->removeParameter("open_node_index_id_link");
+        $this->Session->removeParameter("open_node_index_id_index");
+        $this->Session->removeParameter("license_master");
+        $this->Session->removeParameter("error_msg");
+        $this->Session->removeParameter("filelist");
+        $this->Session->removeParameter("attr_file_flg");
+        $this->Session->removeParameter("doi_itemtype_flag");
+        $this->Session->removeParameter("feedback_mailaddress_str");
+        $this->Session->removeParameter("feedback_mailaddress_author_str");
+        $this->Session->removeParameter("feedback_mailaddress_array");
+        $this->Session->removeParameter("feedback_mailaddress_author_array");
+        $this->Session->removeParameter("all_group");
+        $this->Session->removeParameter("user_group");
+        $this->Session->removeParameter("view_open_node_index_id_insert_item");
+        $this->Session->removeParameter("view_open_node_index_id_item_link");
+        $this->Session->removeParameter("search_index_id_link");
     }
 }
 ?>
diff --git a/repository/view/main/item/snippet/Snippet.class.php b/repository/view/main/item/snippet/Snippet.class.php
index 8c8bf4b..6a7545c 100644
--- a/repository/view/main/item/snippet/Snippet.class.php
+++ b/repository/view/main/item/snippet/Snippet.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Snippet.class.php 663 2014-12-18 02:25:06Z ivis $
+// $Id: Snippet.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics,
 // Research and Development Center for Scientific Information Resources
@@ -172,12 +172,16 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
 
     public $setSearchParameter = "";
 
+    // add file download after login T.Ichikawa 2015/02/03 --start--
+    var $fileIdx = "";                  // ログイン後のファイルダウンロード情報
+    // add file download after login T.Ichikawa 2015/02/03 --end--
+
     /**
      *
      *
      * @access  public
      */
-    function execute()
+    function executeApp()
     {
         try
         {
@@ -203,8 +207,12 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
 	                $this->RepositorySearch->weko_id = "";
 
 	                // Top page access log
-	                $this->entryLog(RepositoryConst::LOG_OPERATION_TOP);
-
+                    // Mod entryLog T.Koyasu 2015/03/06 --start--
+                    $this->infoLog("businessLogmanager", __FILE__, __CLASS__, __LINE__);
+                    $logManager = BusinessFactory::getFactory()->getBusiness("businessLogmanager");
+                    $logManager->entryLogForTopView();
+                    // Mod entryLog T.Koyasu 2015/03/06 --start--
+	                
 	                //インデックス指定及び最も新しいインデックスのとき、index_idを取得し、設定する。
 	                $this->RepositorySearch->setDefaultSearchParameter();
 	                $this->setSearchRequest();
@@ -225,11 +233,6 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
 	            $status = $this->decideScreenChanges();
 	            if($status != 'true')
 	            {
-	                if($status == "goRankingView")
-	                {
-	                    // Top page access log
-	                    $this->entryLog(RepositoryConst::LOG_OPERATION_TOP);
-	                }
 	                return $status;
 	            }
 
@@ -258,6 +261,12 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
 	                    //目次形式の場合は「デフォルトソート順(インデックス)」固定
 	                   $this->RepositorySearch->sort_order = $this->RepositorySearch->validateSortOrder(array(), $this->RepositorySearch->index_id, "");
 	                }
+	                // Improve Search Log 2015/03/27 K.Sugimoto --start--
+	                if(isset($this->index_id) && $this->index_id > 0)
+	                {
+		                $this->RepositorySearch->search_term["idx"] = $this->index_id;
+	                }
+	                // Improve Search Log 2015/03/27 K.Sugimoto --end--
 	            }
 
 	            //A.Jin Add 2013/7/2 --end--
@@ -341,6 +350,13 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
         $this->Session->removeParameter("error_msg");
 
         // file download key
+        // add file download after login T.Ichikawa 2015/02/03 --start-- 
+        if(strlen($this->fileIdx) == 0 && $this->Session->getParameter("_user_id") != "0" && strlen($this->Session->getParameter("_login_id")) != 0)
+        {
+            // file download login.
+            $this->fileIdx = $this->Session->getParameter('repository'.$this->block_id.'FileDownloadKey');
+        }
+        // add file download after login T.Ichikawa 2015/02/03 --end-- 
         $this->Session->removeParameter('repository'.$this->block_id.'FileDownloadKey');
         // TODO ### Add for Test Y.Nakao --start--
 
@@ -691,6 +707,12 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
             $this->Session->setParameter("ranking_flg", 1);
             $this->Session->removeParameter("searchIndexId");
             $this->Session->setParameter("uri_export", $this->uri_export);
+            // Fix download request url 2015/02/03 T.Ichikawa --start--
+            if(strlen($this->fileIdx) > 0)
+            {
+                $this->Session->setParameter('repository'.$this->block_id.'FileDownloadKey', $this->fileIdx);
+            }
+            // Fix download request url 2015/02/03 T.Ichikawa --end--
             return "goRankingView";
         }
         else
@@ -965,8 +987,9 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
                         // Fix contents page heading count --end--
                         // contents page must display heading
                         // BugFix undefined offset 2014/09/04 T.Ichikawa --start--
-                        if(count($resultItemAttr[$nCnt_attr_type]) > 0)
-                        {
+                        if(empty($resultItemAttr[$nCnt_attr_type])) {
+                            array_push($this->heading, array());
+                        } else {
                             array_push($this->heading, explode("|", $resultItemAttr[$nCnt_attr_type][0]['attribute_value'], 4));
                         }
                         // BugFix undefined offset 2014/09/04 T.Ichikawa --end--
@@ -1009,7 +1032,14 @@ class Repository_View_Main_Item_Snippet extends RepositoryAction
                                     $str .= $resultItemAttr[$nCnt_attr_type][$nCnt]['name'];
                                 }
                             }
-                            array_push($this->array_attr, array("last_flg"=>0, "attr_value" => $str));
+                            // Add author link url 2015/01/28 T.Ichikawa --start--
+                            $url = BASE_URL. "/?action=repository_opensearch&creator=". urlencode($str);
+                            array_push($this->array_attr, array("last_flg"=>0, "attr_value" => $str, "url" => $url));
+                            if($this->indexDispType == 1)
+                            {
+                                $this->contents[count($this->contents)-1]['item_attr'][$nCnt_attr_type][$nCnt]['url'] = $url;
+                            }
+                            // Add author link url 2015/01/28 T.Ichikawa --end--
                         }
                         // 改行指定があった場合、文末に " , "は表示しない
                         if($resultItemAttrType[$nCnt_attr_type]['line_feed_enable'] == 1){
diff --git a/repository/view/main/item/snippet/maple.ini b/repository/view/main/item/snippet/maple.ini
index ef523d3..29a5ab4 100644
--- a/repository/view/main/item/snippet/maple.ini
+++ b/repository/view/main/item/snippet/maple.ini
@@ -56,8 +56,5 @@ success = "repository_mobile_item_snippet.html"
 success_sp = "repository_mobile_item_snippet.html"
 error_sp = "repository_mobile_item_snippet.html"
 
-[DIContainer]
-filename_languagescomp = "/modules/repository/view/main/item/snippet/dicon.ini"
-
 [SmartyAssign::items]
 global = lang.ini
\ No newline at end of file
diff --git a/repository/view/main/maple.ini b/repository/view/main/maple.ini
index 7ec531d..f8e3559 100644
--- a/repository/view/main/maple.ini
+++ b/repository/view/main/maple.ini
@@ -25,4 +25,4 @@ module = main.ini
 ;config = main.ini
 
 [Action]
-db = "ref:DbObject"
+Db = "ref:DbObject"
diff --git a/repository/view/main/privatetree/Privatetree.class.php b/repository/view/main/privatetree/Privatetree.class.php
index 7451dc4..631ad8d 100644
--- a/repository/view/main/privatetree/Privatetree.class.php
+++ b/repository/view/main/privatetree/Privatetree.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Privatetree.class.php 564 2014-04-14 01:06:48Z ivis $
+// $Id: Tree.class.php 15374 2012-02-10 12:41:17Z yuko_nakao $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
diff --git a/repository/view/main/ranking/Ranking.class.php b/repository/view/main/ranking/Ranking.class.php
index 3c55607..3dd4151 100644
--- a/repository/view/main/ranking/Ranking.class.php
+++ b/repository/view/main/ranking/Ranking.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Ranking.class.php 663 2014-12-18 02:25:06Z ivis $
+// $Id: Ranking.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -12,22 +12,18 @@
 // --------------------------------------------------------------------
 
 /* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */
+require_once WEBAPP_DIR. '/modules/repository/components/common/WekoAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryAction.class.php';
 require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexManager.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryIndexAuthorityManager.class.php';
-require_once WEBAPP_DIR. '/modules/repository/components/RepositoryItemAuthorityManager.class.php';
 
 /**
- * [[機能説明]]
+ * Show Ranking
  *
  * @package     [[package名]]
  * @access      public
  */
-class Repository_View_Main_Ranking extends RepositoryAction
+class Repository_View_Main_Ranking extends WekoAction 
 {
-    // 使用コンポーネントを受け取るため
-    var $Db = null;
-    var $Session = null;
     var $request = null;
     
     var $refer_ranking = Array();
@@ -41,26 +37,14 @@ class Repository_View_Main_Ranking extends RepositoryAction
     var $ranking_is_disp_item_creator = "1";
     var $ranking_is_disp_keyword = "1";
     var $ranking_is_disp_recent_item = "1";
-
-    // ランキング集計期間（新着アイテム以外）
-    var $rank_term = 365;
-    // ランキング数（新着アイテム以外）
-    var $rank_num = 5;
-    // 新着アイテム扱いの期間（過去Ｘ日）
-    var $newitem_term = 14;
-
-    // Add log exception from ip address 2008.11.10 Y.Nakao --start--
-    var $log_exception = "";
-    // Add log exception from ip address 2008.11.10 Y.Nakao --end--
     
-    var $count_refer = 0;            // 閲覧回数ランキング表示数
-    var $count_download = 0;            // ダウンロード数ランキング表示数
-    var $count_user = 0;                // ユーザーランキング表示数
-    var $count_keyword = 0;            // キーワードランキング表示数
-    var $count_recent = 0;            // 新着アイテム表示数
+    var $count_refer = 0;                   // 閲覧回数ランキング表示数
+    var $count_download = 0;                // ダウンロード数ランキング表示数
+    var $count_user = 0;                    // ユーザーランキング表示数
+    var $count_keyword = 0;                 // キーワードランキング表示数
+    var $count_recent = 0;                  // 新着アイテム表示数
     
-    var $thumbnail = array();        // サムネイルの有無を格納 
-//    var $IsDownLoadFile = array();        // ファイルダウンロード可否
+    var $thumbnail = array();               // サムネイルの有無を格納 
 
     // Add child index display more 2009/01/20 Y.Nakao --start--
     // ランキング表示かどうか判定(アコーディオン表示用JavaScriptをhtmlに組み込むかの判定に使用)
@@ -69,7 +53,7 @@ class Repository_View_Main_Ranking extends RepositoryAction
     // Add child index display more 2009/01/20 Y.Nakao --end--
     
     // Add title_english 2009/07/22 A.Suzuki --start--
-    var $select_lang = "";    // 選択中の言語
+    var $select_lang = "";                  // 選択中の言語
     // Add title_english 2009/07/22 A.Suzuki --end--
     
     // fix download any files from repositoy_uri 2010/01/08 Y.Nakao --start--
@@ -80,15 +64,6 @@ class Repository_View_Main_Ranking extends RepositoryAction
     var $help_icon_display =  "";
     var $oaiore_icon_display = "";
     // Set help icon setting 2010/02/10 K.Ando --end--
-
-    // Add log reset ranking refer 2010/02/18 K.Ando --start--
-    var $ranking_reset_last_date = "";
-    var $ranking_term_date = "";
-    // Add log reset ranking refer 2010/02/18 K.Ando --end--
-    
-    // Add came from flash 2011/01/04 H.Goto --start--
-    var $version_flg = null;
-    // Add came from flash 2011/01/04 H.Goto --end--
     
     // Add index list 2010/04/13 S.Abe --start--
     var $select_index_list_display = "";
@@ -96,850 +71,283 @@ class Repository_View_Main_Ranking extends RepositoryAction
     // Add index list 2010/04/13 S.Abe --end--
 
     // Fix advanced search for ranking view at top page. Y.Nakao 2014/01/14 --start--
-    public $active_search_flag = null;  // flag for detail search or simple search
-    public $detail_search_usable_item = array();   // detail search usable item
-    public $all_search_type = null;     // all search type
-    public $detail_search_item_type = array();     // search itemtype
-    public $detail_search_select_item = array();   // search itemtype
-    public $default_detail_search = array();       // default detail search items
+    public $active_search_flag = null;              // flag for detail search or simple search
+    public $detail_search_usable_item = array();    // detail search usable item
+    public $all_search_type = null;                 // all search type
+    public $detail_search_item_type = array();      // search itemtype
+    public $detail_search_select_item = array();    // search itemtype
+    public $default_detail_search = array();        // default detail search items
     // Fix advanced search for ranking view at top page. Y.Nakao 2014/01/14 --end--
 
-    function SetData($Session, $Db, $log_exception, $ranking_term_date, $TransStartDate) {
-        $this->Session = $Session;
-        $this->Db = $Db;
-        $this->log_exception = $log_exception;
-        $this->ranking_term_date = $ranking_term_date;
-        $this->TransStartDate = $TransStartDate;
-        
-        // Add Bug-fix WEKO-2014-005 2014/04/25 T.Koyasu --start--
-        $this->dbAccess = new RepositoryDbAccess($this->Db);
-        // Add Bug-fix WEKO-2014-005 2014/04/25 T.Koyasu --end--
-        
-        // Add Advanced Search 2013/11/26 R.Matsuura --start--
-        $indexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->TransStartDate);
-        // Add Advanced Search 2013/11/26 R.Matsuura --end--        // Add tree access control list 2012/03/07 T.Koyasu -start-
-        $role_auth_id = $this->Session->getParameter('_role_auth_id');
-        $user_auth_id = $this->Session->getParameter('_user_auth_id');
-        $user_id = $this->Session->getParameter('_user_id');
-        $this->Session->removeParameter('_role_auth_id');
-        $this->Session->removeParameter('_user_auth_id');
-        $this->Session->setParameter('_user_id', '0');
-        $this->setConfigAuthority();
-        $this->Session->setParameter('_role_auth_id', $role_auth_id);
-        $this->Session->setParameter('_user_auth_id', $user_auth_id);
-        $this->Session->setParameter('_user_id', $user_id);
-        // Add tree access control list 2012/03/07 T.Koyasu -end-
-    }
-    
+    // Fix download request url 2015/02/03 T.Ichikawa --start--
+    var $fileIdx = "";                              // ログイン後のファイルダウンロード情報
+    var $block_id = null;
+    // Fix download request url 2015/02/03 T.Ichikawa --end--
+
     /**
-     * [[機能説明]]
+     * create ranking data
      *
      * @access  public
      */
-    function execute()
-    {    
-           try {
-               
-            //アクション初期化処理
-            $result = $this->initAction();
-            if ( $result === false ) {
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-                $this->failTrans();                                        //トランザクション失敗を設定(ROLLBACK)
-                $user_error_msg = 'initで既に・・・';
-                throw $exception;
-            }
-            
-            // fix download any files from repositoy_uri 2010/01/08 Y.Nakao --start--
-            $user_id = $this->Session->getParameter("_user_id");
-            $this->uri_export = $this->Session->getParameter("uri_export");
-            $this->Session->removeParameter("uri_export");
-               if(!is_array($this->uri_export) || count($this->uri_export) != 4){
-                $this->uri_export = null;
-            } else {
-                $tmp_status = $this->uri_export["status"];
-                $this->uri_export["status"] = $this->checkExportFileDownload($this->uri_export["status"]);
-                if($tmp_status == "login"){
-                    // ログイン処理を読みだす
-                    // sessionにはreloadを保存、表示にはloginを使用
-                    $this->Session->setParameter("uri_export", $this->uri_export);
-                    $this->uri_export["status"] = "login";
-                } else if($tmp_status == "download" && $this->uri_export["status"] == "true"){
-                    // ログイン処理実行
-                    // sessionは解放、表示にはdownloadを使用
-                    $this->uri_export["status"] = "download";
-                } else {
-                    // ログインキャンセルとかエラーとか予期せぬ事態
-                    $this->uri_export["status"] = "";
-                    $tmp = false;
-                }
-            }
-            // fix download any files from repositoy_uri 2010/01/08 Y.Nakao --end--
-            
-            // 未ログイン時のファイルダウンロード対応 2008/09/02 Y.Nakao --end--
-            
-            // Add title_english 2009/07/22 A.Suzuki --start--
-            $this->select_lang = $this->Session->getParameter("_lang");
-            // Add title_english 2009/07/22 A.Suzuki --end--    
-            // Add index list 2010/04/13 S.Abe --start--
-            $this->select_index_list_display = $this->getSelectIndexListDisplay();
-            if($this->select_index_list_display == 1) {
-                // Add Advanced Search 2013/11/26 R.Matsuura --start--
-                $indexManager = new RepositoryIndexManager($this->Session, $this->dbAccess, $this->TransStartDate);
-                // Add Advanced Search 2013/11/26 R.Matsuura --end--
-                $this->select_index_list = $indexManager->getDisplayIndexList($this->repository_admin_base, $this->repository_admin_room);    
-            }
-            // Add index list 2010/04/13 S.Abe --end--
+    protected function executeApp()
+    {
+        $this->select_lang = $this->Session->getParameter("_lang");
+        $this->showTopPageProcess();
+        
+        // Add ranking tab display setting 2015/03/24 K.Sugimoto --start--
+        $result = $this->getAdminParamByName('ranking_tab_display');
+        if ($result == 0)
+        {
+            return "invalid";
+        }
+        // Add ranking tab display setting 2015/03/24 K.Sugimoto --end--
+
+        // ランキング数（新着アイテム以外）
+        $items = $this->getAdminParamByName('ranking_disp_num');
+        if($items != "" && $items != null){
+            $this->rank_num = $items;
+        }
+        
+        // Add ranking update setting 2008/12/1 A.Suzuki --start--
+        // is ranking realtime?
+        $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
+                 "WHERE param_name = 'ranking_disp_setting'; ";
+        $result = $this->Db->execute($query);
+        if($result === false){
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+        }
+        
+        // get each ranking show flag
+        $this->ranking_is_disp_browse_item = $this->getAdminParamByName('ranking_is_disp_browse_item');
+        $this->ranking_is_disp_download_item = $this->getAdminParamByName('ranking_is_disp_download_item');
+        $this->ranking_is_disp_item_creator = $this->getAdminParamByName('ranking_is_disp_item_creator');
+        $this->ranking_is_disp_keyword = $this->getAdminParamByName('ranking_is_disp_keyword');
+        $this->ranking_is_disp_recent_item = $this->getAdminParamByName('ranking_is_disp_recent_item');
+        
+        if($result[0]["param_value"] == 1) {
+            // no realtime, show ranking from database
+            $this->setRankingDataFromDatabase();
             
+        } else {
+            // Add ranking update setting 2008/12/1 A.Suzuki --end--
+            // real time ranking
+            $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+            $ranking = BusinessFactory::getFactory()->getBusiness("businessRanking");
             
-            // ランキング数（新着アイテム以外）
-            $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_term_stats'");
-               if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-                $this->rank_term = $items[0]['param_value'];
+            // set OFF create ranking that is not show
+            if ( $this->ranking_is_disp_browse_item != "1" ){
+                $ranking->toOffReferRanking();
             }
-            // ランキング数（新着アイテム以外）
-            $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_disp_num'");
-               if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-                $this->rank_num = $items[0]['param_value'];
+            if ( $this->ranking_is_disp_download_item != "1" ){
+                $ranking->toOffDownloadRanking();
             }
-            // 新着アイテム扱いの期間（過去Ｘ日）
-            $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_term_recent_regist'");
-               if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-                $this->newitem_term = $items[0]['param_value'];
+            if ( $this->ranking_is_disp_item_creator != "1" ){
+                $ranking->toOffUserRanking();
             }
-            // Add log reset ranking refer 2010/02/18 K.Ando --start--
-            // last reset-ranking date
-            $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_last_reset_date';");
-               if($items[0]['param_value'] != "" && $items[0]['param_value'] != null){
-                $this->ranking_reset_last_date = $items[0]['param_value'];
-            }
-            if($this->ranking_reset_last_date != "" )
-            {
-                // Fix date calculate 2010/07/29 A.Suzuki --start--
-                //$logjikan = time()- 60 * 60 * 24 * $this->rank_term;
-                //$jikan = strtotime($this->ranking_reset_last_date);
-                //$this->ranking_term_sec = $jikan <= $logjikan  ? $logjikan : $jikan;
-                $this->ranking_reset_last_date = str_replace("/","-",$this->ranking_reset_last_date);
-                $query = "SELECT DATE_SUB(NOW(), INTERVAL ? DAY) AS rank_date;";
-                $params = array();
-                $params[] = $this->rank_term;
-                $result = $this->Db->execute($query, $params);
-                $rank_term_date = $result[0]['rank_date'];
-                $query = "SELECT DATEDIFF(?, ?) AS date_diff;";
-                $params = array();
-                $params[] = $rank_term_date;
-                $params[] = $this->ranking_reset_last_date;
-                $result = $this->Db->execute($query, $params);
-                if($result[0]['date_diff'] >= 0){
-                    $this->ranking_term_date = $rank_term_date;
-                } else {
-                    $this->ranking_term_date = $this->ranking_reset_last_date;
-                }
-                // Fix date calculate 2010/07/29 A.Suzuki --end--
-            }else
-            {
-                // Fix date calculate 2010/07/29 A.Suzuki --start--
-                //$this->ranking_term_sec = time() - 60 * 60 * 24 * $this->rank_term;
-                $query = "SELECT DATE_SUB(NOW(), INTERVAL ? DAY) AS rank_date;";
-                $params = array();
-                $params[] = $this->rank_term;
-                $result = $this->Db->execute($query, $params);
-                $this->ranking_term_date = $result[0]['rank_date'];
-                // Fix date calculate 2010/07/29 A.Suzuki --end--
+            if ( $this->ranking_is_disp_keyword != "1" ){
+                $ranking->toOffKeywordRanking();
             }
-            // Add log reset ranking refer 2010/02/18 K.Ando --end--
-            
-            // Add ranking update setting 2008/12/1 A.Suzuki --start--
-                $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter ".
-                     "WHERE param_name = 'ranking_disp_setting'; ";
-            $result = $this->Db->execute($query);
-            if($result === false){
-                return 'error';
+            if ( $this->ranking_is_disp_recent_item != "1" ){
+                $ranking->toOffNewItemRanking();
             }
             
-            if($result[0]["param_value"] == 1) {
-                // get ranking data from repository_ranking
-                $query = "SELECT * ".
-                         "FROM " .DATABASE_PREFIX ."repository_ranking ".
-                         "WHERE is_delete = 0 ".
-                         "ORDER BY rank;";
-                $result = $this->Db->execute($query);
-                if($result === false){
-                    return 'error';
-                }
-    
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_browse_item'");
-                $this->ranking_is_disp_browse_item = $items[0]['param_value'];
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_download_item'");
-                $this->ranking_is_disp_download_item = $items[0]['param_value'];
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_item_creator'");
-                $this->ranking_is_disp_item_creator = $items[0]['param_value'];
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_keyword'");
-                $this->ranking_is_disp_keyword = $items[0]['param_value'];
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_recent_item'");
-                $this->ranking_is_disp_recent_item = $items[0]['param_value'];
-                
-                for ( $ii=0; $ii<count($result); $ii++ ){
-                    switch($result[$ii]['rank_type']){
-                        case "referRanking":
-                            if($this->ranking_is_disp_browse_item == "1"){
-                                if(count($this->refer_ranking) < $this->rank_num) {
-                                    $disp_flg = false;
-                                      if(count($this->refer_ranking) < 3){
-                                        // check thumbnail
-                                        // modify show thumbnail all rank 2011/10/20 K.Matsuo --start--
-                                          $disp_flg = true;
-                                        $this->checkDownload($result[$ii]['item_id'], $result[$ii]['item_no'], "", "refer", count($this->refer_ranking));
-                                        // modify show thumbnail all rank 2011/10/20 K.Matsuo --end--
-                                      }
-                                      
-                                      // Add title_english 2009/07/22 A.Suzuki --start--
-                                      if($this->select_lang == "japanese"){
-                                          if($result[$ii]['disp_name'] != "" && $result[$ii]['disp_name'] != null){
-                                              $display_title = $result[$ii]['disp_name'];
-                                          } else {
-                                              $display_title = $result[$ii]['disp_name_english'];
-                                          }
-                                      } else {
-                                          if($result[$ii]['disp_name_english'] != "" && $result[$ii]['disp_name_english'] != null){
-                                              $display_title = $result[$ii]['disp_name_english'];
-                                          } else {
-                                              $display_title = $result[$ii]['disp_name'];
-                                          }
-                                      }
-                                    // Add title_english 2009/07/22 A.Suzuki --end--
-                                      
-                                    array_push($this->refer_ranking,Array($result[$ii]['rank'],$display_title,$result[$ii]['disp_value'],$result[$ii]['item_id'],$result[$ii]['item_no'], $disp_flg));
-                                }
-                            }
-                            break;
-                        case "downloadRanking":
-                            if($this->ranking_is_disp_download_item == "1"){
-                                if(count($this->download_ranking) < $this->rank_num) {
-                                    $disp_flg = false;
-                                    // check thumbnail
-                                    // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
-                                    if(count($this->download_ranking) < 3){
-                                          $disp_flg = true;
-                                          $this->checkDownload($result[$ii]['item_id'], $result[$ii]['item_no'], $result[$ii]['file_no'], "download", count($this->download_ranking));
-                                      }
-                                    // modify show thubnail all rank 2011/10/20 K.Matsuo --end--
-                                                                            
-                                      // Add title_english 2009/07/22 A.Suzuki --start--
-                                      if($this->select_lang == "japanese"){
-                                          if($result[$ii]['disp_name'] != "" && $result[$ii]['disp_name'] != null){
-                                              $display_title = $result[$ii]['disp_name'];
-                                          } else {
-                                              $display_title = $result[$ii]['disp_name_english'];
-                                          }
-                                      } else {
-                                          if($result[$ii]['disp_name_english'] != "" && $result[$ii]['disp_name_english'] != null){
-                                              $display_title = $result[$ii]['disp_name_english'];
-                                          } else {
-                                              $display_title = $result[$ii]['disp_name'];
-                                          }
-                                      }
-                                    // Add title_english 2009/07/22 A.Suzuki --end--
-                                      
-                                    array_push($this->download_ranking,Array($result[$ii]['rank'],$display_title,$result[$ii]['disp_value'],$result[$ii]['item_id'],$result[$ii]['item_no'], $disp_flg));
-                                }
-                            }
-                            break;
-                        case "userRanking":
-                            if($this->ranking_is_disp_item_creator == "1"){
-                                if(count($this->user_ranking) < $this->rank_num) {
-                                    $hlink = "";
-                                    $disp_flg = false;
-                                      if(count($this->user_ranking) < 3){
-                                          $disp_flg = true;
-                                      }
-                                    // check thumbnail
-                                    array_push($this->user_ranking,Array($result[$ii]['rank'],$result[$ii]['disp_name'],$result[$ii]['disp_value'],$hlink, $disp_flg));
-                                }
-                            }
-                            break;
-                        case "keywordRanking":
-                            if($this->ranking_is_disp_keyword == "1"){
-                                if(count($this->keyword_ranking) < $this->rank_num) {
-                                    $hlink = BASE_URL. "/?action=repository_opensearch&keyword=". urlencode($result[$ii]['disp_name']);
-                                    $disp_flg = false;
-                                      if(count($this->keyword_ranking) < 3){
-                                          $disp_flg = true;
-                                      }
-                                    array_push($this->keyword_ranking,Array($result[$ii]['rank'],$result[$ii]['disp_name'],$result[$ii]['disp_value'],$hlink, $disp_flg));
-                                }
-                            }
-                            break;
-                        case "recentRanking":
-                            if($this->ranking_is_disp_recent_item == "1"){
-                                if(count($this->newitem_ranking) < $this->rank_num) {
-                                    $disp_flg = false;
-                                      if(count($this->newitem_ranking) < 3){
-                                          $disp_flg = true;
-                                        // check thumbnail
-                                        // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
-                                        $this->checkDownload($result[$ii]['item_id'], $result[$ii]['item_no'], "", "recent", count($this->newitem_ranking));
-                                        // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
-                                      }
-                                      
-                                      // Add title_english 2009/07/22 A.Suzuki --start--
-                                      if($this->select_lang == "japanese"){
-                                          if($result[$ii]['disp_name'] != "" && $result[$ii]['disp_name'] != null){
-                                              $display_title = $result[$ii]['disp_name'];
-                                          } else {
-                                              $display_title = $result[$ii]['disp_name_english'];
-                                          }
-                                      } else {
-                                          if($result[$ii]['disp_name_english'] != "" && $result[$ii]['disp_name_english'] != null){
-                                              $display_title = $result[$ii]['disp_name_english'];
-                                          } else {
-                                              $display_title = $result[$ii]['disp_name'];
-                                          }
-                                      }
-                                    // Add title_english 2009/07/22 A.Suzuki --end--
-                                      
-                                    array_push($this->newitem_ranking,Array($result[$ii]['rank'],$display_title,$result[$ii]['disp_value'],$result[$ii]['item_id'],$result[$ii]['item_no'], $disp_flg));
-                                }
-                            }
-                            break;
-                        default:
-                    }                    
-                  }
-                  
-                  $this->count_refer = count($this->refer_ranking);
-                $this->count_download = count($this->download_ranking);
-                $this->count_user = count($this->user_ranking);
-                $this->count_keyword = count($this->keyword_ranking);
-                $this->count_recent = count($this->newitem_ranking);
-                
-            } else {
-            // Add ranking update setting 2008/12/1 A.Suzuki --end--
-            
-                // Add log exclusion from user-agaent 2011/04/28 H.Ito --start--
-                // Call Common function ->logExclusion()
-                $this->log_exception = $this->createLogExclusion(0,false);
-                // Add log exclusion from user-agaent 2011/04/28 H.Ito --end--
-                
-                // Add tree access control list 2012/03/07 T.Koyasu -start-
-                $role_auth_id = $this->Session->getParameter('_role_auth_id');
-                $user_auth_id = $this->Session->getParameter('_user_auth_id');
-                $user_id = $this->Session->getParameter('_user_id');
-                $this->Session->removeParameter('_role_auth_id');
-                $this->Session->removeParameter('_user_auth_id');
-                $this->Session->setParameter('_user_id', '0');
-                $this->Session->setParameter('_role_auth_id', $role_auth_id);
-                $this->Session->setParameter('_user_auth_id', $user_auth_id);
-                $this->Session->setParameter('_user_id', $user_id);
-                // Add tree access control list 2012/03/07 T.Koyasu -end-
+            // create ranking data
+            $ranking->execute();
 
-                // 閲覧ランキングを表示するか
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_browse_item'");
-                $this->ranking_is_disp_browse_item = $items[0]['param_value'];
-                if ( $this->ranking_is_disp_browse_item=="1" ){
-                    $this->referRanking();
-                }
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_download_item'");
-                $this->ranking_is_disp_download_item = $items[0]['param_value'];
-                if ( $this->ranking_is_disp_download_item=="1" ){
-                    $this->downloadRanking();
-                }
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_item_creator'");
-                $this->ranking_is_disp_item_creator = $items[0]['param_value'];
-                if ( $this->ranking_is_disp_item_creator=="1" ){
-                    $this->userRanking();
-                }
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_keyword'");
-                $this->ranking_is_disp_keyword = $items[0]['param_value'];
-                if ( $this->ranking_is_disp_keyword=="1" ){
-                    $this->keywordRanking();
-                }
-                
-                $items = $this->Db->execute("SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name='ranking_is_disp_recent_item'");
-                $this->ranking_is_disp_recent_item = $items[0]['param_value'];
-                if ( $this->ranking_is_disp_recent_item=="1" ){
-                    $this->recentRanking();
-                }
-            }
-            
-            if($this->count_refer !=  0 && $this->count_refer < 3){
-                for($ii=$this->count_refer;$ii < 3; $ii++){
-                    array_push($this->refer_ranking,Array($ii+1,"","","","","true"));
-                    $this->count_refer++;
-                }
+            // is show each ranking
+            if ( $this->ranking_is_disp_browse_item == "1" ){
+                $this->referRanking($ranking);
             }
-            if($this->count_download != 0 && $this->count_download < 3){
-                for($ii=$this->count_download;$ii < 3; $ii++){
-                    array_push($this->download_ranking,Array($ii+1,"","","","","true"));
-                    $this->count_download++;
-                }
+            if ( $this->ranking_is_disp_download_item == "1" ){
+                $this->downloadRanking($ranking);
             }
-               if($this->count_user != 0 && $this->count_user < 3){
-                for($ii=$this->count_user;$ii < 3; $ii++){
-                    array_push($this->user_ranking,Array($ii+1,"","","","true"));
-                    $this->count_user++;
-                }
+            if ( $this->ranking_is_disp_item_creator == "1" ){
+                $this->userRanking($ranking);
             }
-               if($this->count_keyword != 0 && $this->count_keyword < 3){
-                for($ii=$this->count_keyword;$ii < 3; $ii++){
-                    array_push($this->keyword_ranking,Array($ii+1,"","","","true"));
-                    $this->count_keyword++;
-                }
+            if ( $this->ranking_is_disp_keyword == "1" ){
+                $this->keywordRanking($ranking);
             }
-            if($this->count_recent != 0 && $this->count_recent < 3){
-                for($ii=$this->count_recent;$ii < 3; $ii++){
-                    array_push($this->newitem_ranking,Array($ii+1,"","","","","true"));
-                    $this->count_recent++;
-                }
+            if ( $this->ranking_is_disp_recent_item == "1" ){
+                $this->recentRanking($ranking);
             }
+        }
+        
+        $this->setEmptyRanking();
+        
+        $this->help_icon_display = $this->getAdminParamByName('help_icon_display');
+        
+        return $this->getViewResult();
+    }
 
-            // Set help icon setting 2010/02/10 K.Ando --start--
-            $result = $this->getAdminParam('help_icon_display', $this->help_icon_display, $Error_Msg);
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 );    //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            $result = $this->getAdminParam('oaiore_icon_display', $this->oaiore_icon_display, $Error_Msg);
-            if ( $result == false ){
-                $exception = new RepositoryException( ERR_MSG_xxx-xxx1, xxx-xxx1 ); //主メッセージとログIDを指定して例外を作成
-                $DetailMsg = null;                              //詳細メッセージ文字列作成
-                sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx1);
-                $exception->setDetailMsg( $DetailMsg );         //詳細メッセージ設定
-                $this->failTrans();                             //トランザクション失敗を設定(ROLLBACK)
-                throw $exception;
-            }
-            // Set help icon setting 2010/02/10 K.Ando --end--
-
-            
-               //アクション終了処理
-            $result = $this->exitAction();     //トランザクションが成功していればCOMMITされる
-            if ( $result === false ) {
-                $exception = new RepositoryException( "ERR_MSG_xxx-xxx3", 1 );    //主メッセージとログIDを指定して例外を作成
-                //$DetailMsg = null;                              //詳細メッセージ文字列作成
-                //sprintf( $DetailMsg, ERR_DETAIL_xxx-xxx3, $埋込み文字1, $埋込み文字2 );
-                //$exception->setDetailMsg( $DetailMsg );             //詳細メッセージ設定
-                throw $exception;
+    /**
+     * create view detail ranking data
+     *
+     */
+    private function referRanking($ranking)
+    {
+        $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+        $ranking = BusinessFactory::getFactory()->getBusiness("businessRanking");
+        $items = $ranking->getReferRanking();
+        
+        $len = count($items);
+        for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
+            $disp_flg = false;
+            if($ii < 3){
+                $disp_flg = true;
             }
             
-            if($this->Session->getParameter("serach_screen") == 2 && $this->Session->getParameter("ranking_flg") == 1)
-            {
-                // Fix advanced search for ranking view at top page. Y.Nakao 2014/01/14 --start--
-                require_once WEBAPP_DIR."/modules/repository/components/RepositorySearchRequestParameter.class.php";
-                $searchParam = new RepositorySearchRequestParameter();
-                $searchParam->setActionParameter();
-                $this->search_type = $searchParam->all_search_type;
-                $this->active_search_flag = $searchParam->active_search_flag;
-                $this->detail_search_usable_item = $searchParam->detail_search_usable_item;
-                $this->detail_search_item_type = $searchParam->detail_search_item_type;
-                $this->detail_search_select_item = $searchParam->detail_search_select_item;
-                for($ii = 0; $ii < count($this->detail_search_select_item); $ii++) {
-                    if(array_key_exists("value", $this->detail_search_select_item[$ii])) {
-                        $this->detail_search_select_item[$ii]["value"] = str_replace("\\", "\\\\", $this->detail_search_select_item[$ii]["value"]);
-                    }
-                }
-                $this->default_detail_search = $searchParam->default_detail_search;
-                // Fix advanced search for ranking view at top page. Y.Nakao 2014/01/14 --end--
-                $this->Session->setParameter("ranking_flg", 0);
-                // Add smart phone support T.Koyasu 2012/04/03 -start-
-                if($this->smartphoneFlg){
-                    return 'snippet_sp';
+            // check thumbnail
+            // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
+            $this->checkDownload($items[$ii]['item_id'], $items[$ii]['item_no'], "", "refer", $ii);
+            // modify show thubnail all rank 2011/10/20 K.Matsuo --end--
+            // Add title_english 2009/07/22 A.Suzuki --start--
+            if($this->select_lang == "japanese"){
+                if($items[$ii]['title'] != "" && $items[$ii]['title'] != null){
+                    $display_title = $items[$ii]['title'];
                 } else {
-                    return 'snippet';
+                    $display_title = $items[$ii]['title_english'];
                 }
-                // Add smart phone support T.Koyasu 2012/04/03 -end-
             } else {
-                // Add child index display more 2009/01/20 Y.Nakao --start--
-                // ランキングのみの表示であるフラグを立てる this view action is dispay ranking
-                $this->display_ranking = "true";
-                // Add child index display more 2009/01/20 Y.Nakao --end-- 
-                
-                // Add smart phone support T.Koyasu 2012/04/02 -start-
-                if($this->smartphoneFlg){
-                    return 'success_sp';
+                if($items[$ii]['title_english'] != "" && $items[$ii]['title_english'] != null){
+                    $display_title = $items[$ii]['title_english'];
                 } else {
-                    return 'success';
+                    $display_title = $items[$ii]['title'];
                 }
-                // Add smart phone support T.Koyasu 2012/04/02 -end-
             }
-            
-         } catch ( RepositoryException $Exception) {
-            //エラーログ出力
-            /*
-            logFile(
-                "SampleAction",                    //クラス名
-                "execute",                        //メソッド名
-                $Exception->getCode(),            //ログID
-                $Exception->getMessage(),        //主メッセージ
-                $Exception->getDetailMsg() );    //詳細メッセージ            
-            */
-            //アクション終了処理
-            $result = $this->exitAction();     //トランザクションが成功していればCOMMITされる
-            return "error";
-        }        
-    }
-
-    /**
-     * 閲覧回数ランキング計算
-     *
-     */
-    function referRanking()
-    {
-        $items = $this->getReferRankingData();   // ranking acquisition portion is made into a function K.Matsuo 2011/11/18
-          
-          $len = count($items);
-        for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
-              $disp_flg = false;
-              if($ii < 3){
-                  $disp_flg = true;
-              }
-                      
-              // check thumbnail
-              // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
-//              if($ii == 0){
-                  $this->checkDownload($items[$ii]['item_id'], $items[$ii]['item_no'], "", "refer", $ii);
-//              }              
-            // modify show thubnail all rank 2011/10/20 K.Matsuo --end--
-              // Add title_english 2009/07/22 A.Suzuki --start--
-              if($this->select_lang == "japanese"){
-                  if($items[$ii]['title'] != "" && $items[$ii]['title'] != null){
-                      $display_title = $items[$ii]['title'];
-                  } else {
-                      $display_title = $items[$ii]['title_english'];
-                  }
-              } else {
-                  if($items[$ii]['title_english'] != "" && $items[$ii]['title_english'] != null){
-                      $display_title = $items[$ii]['title_english'];
-                  } else {
-                      $display_title = $items[$ii]['title'];
-                  }
-              }
             // Add title_english 2009/07/22 A.Suzuki --end--
-              
-            array_push($this->refer_ranking,Array(($ii+1),$display_title,$items[$ii]['count(*)'],$items[$ii]['item_id'],$items[$ii]['item_no'], $disp_flg));
+            
+            array_push($this->refer_ranking,Array(($ii+1),$display_title,$items[$ii]['CNT'],$items[$ii]['item_id'],$items[$ii]['item_no'], $disp_flg));
         }
-          $this->count_refer = count($this->refer_ranking);          
+        $this->count_refer = count($this->refer_ranking);          
     }
     
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --start--
     /**
-     * ログDBから閲覧回数を取得
+     * create download ranking data
      *
-     * @param unknown_type $log_exception
-     * @param unknown_type $ranking_term_date
-     * @return unknown
      */
-    public function getReferRankingData()
+    private function downloadRanking()
     {
-        $repositoryIndexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->TransStartDate);
-        $public_index_query = $repositoryIndexAuthorityManager->getPublicIndexQuery(false, $this->repository_admin_base, $this->repository_admin_room);
-        // Make TmpTable 2014/11/07 T.Ichikawa --start--
-        $now = date("YmdHis", strtotime($this->TransStartDate));
-        $public_index_query = $this->replaceQueryForTemporaryTable($public_index_query, $now, $cntGroupNum);
-        
-        $sqlCmd=" 
-            SELECT item.item_id, item.item_no, item.title, item.title_english,count(*)
-              FROM ". DATABASE_PREFIX ."repository_log LEFT JOIN ". DATABASE_PREFIX ."repository_item item
-              ON ". DATABASE_PREFIX ."repository_log.item_id = item.item_id
-              INNER JOIN ". DATABASE_PREFIX ."repository_position_index pos ON item.item_id = pos.item_id AND item.item_no = pos.item_no AND pos.is_delete = 0
-              INNER JOIN (".$public_index_query.") pub ON pos.index_id = pub.index_id
-              WHERE ". DATABASE_PREFIX ."repository_log.operation_id='3' 
-                AND item.shown_date<=NOW()
-                AND ". DATABASE_PREFIX ."repository_log.record_date>='".$this->ranking_term_date."' ".
-                $this->log_exception.// Add log exception from ip address 2008.11.10 Y.Nakao
-                " AND item.shown_status = 1 ".
-                " AND item.is_delete = 0 ".
-              "  GROUP BY ". DATABASE_PREFIX ."repository_log.item_id 
-              ORDER BY count(*) desc; ";
-        $result = $this->Db->execute($sqlCmd);
+        $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+        $ranking = BusinessFactory::getFactory()->getBusiness("businessRanking");
+        $items = $ranking->getDownloadRanking();
         
-        $this->dropTemporaryTable($now, $cntGroupNum);
-        // Make TmpTable 2014/11/07 T.Ichikawa --end--
-        return $result;
+        $len = count($items);
+        for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
+            $disp_flg = false;
+            if($ii < 3){
+                $disp_flg = true;
             }
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --end--
-
-    /**
-     * ダウンロードランキング計算
-     *
-     */
-    function downloadRanking()
-    {
-        $items = $this->getDownloadRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
-          $len = count($items);
-          for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
-              $disp_flg = false;
-              if($ii < 3){
-                  $disp_flg = true;
-              }
           
-              // check thumbnail
+            // check thumbnail
             // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
-//              if($ii == 0){
-                  $this->checkDownload($items[$ii]['item_id'], $items[$ii]['item_no'], $items[$ii]['file_no'], "download", $ii);
-//              }
+            $this->checkDownload($items[$ii]['item_id'], $items[$ii]['item_no'], $items[$ii]['file_no'], "download", $ii);
             // modify show thubnail all rank 2011/10/20 K.Matsuo --end--
               
-              // Add title_english 2009/07/22 A.Suzuki --start--
-              if($this->select_lang == "japanese"){
-                  if($items[$ii]['title'] != "" && $items[$ii]['title'] != null){
-                      $display_title = $items[$ii]['title'];
-                  } else {
-                      $display_title = $items[$ii]['title_english'];
-                  }
-              } else {
-                  if($items[$ii]['title_english'] != "" && $items[$ii]['title_english'] != null){
-                      $display_title = $items[$ii]['title_english'];
-                  } else {
-                      $display_title = $items[$ii]['title'];
-                  }
-              }
+            // Add title_english 2009/07/22 A.Suzuki --start--
+            if($this->select_lang == "japanese"){
+                if($items[$ii]['title'] != "" && $items[$ii]['title'] != null){
+                    $display_title = $items[$ii]['title'];
+                } else {
+                    $display_title = $items[$ii]['title_english'];
+                }
+            } else {
+                if($items[$ii]['title_english'] != "" && $items[$ii]['title_english'] != null){
+                    $display_title = $items[$ii]['title_english'];
+                } else {
+                    $display_title = $items[$ii]['title'];
+                }
+            }
             // Add title_english 2009/07/22 A.Suzuki --end--
-              
-              array_push($this->download_ranking,Array(($ii+1),$display_title."(".$items[$ii]['file_name'].")",$items[$ii]['count(*)'],$items[$ii]['item_id'],$items[$ii]['item_no'],$disp_flg));
-          }
-          $this->count_download = count($this->download_ranking);
+            array_push($this->download_ranking,Array(($ii+1),$display_title."(".$items[$ii]['file_name'].")",$items[$ii]['CNT'],$items[$ii]['item_id'],$items[$ii]['item_no'],$disp_flg));
+        }
+        $this->count_download = count($this->download_ranking);
     }
-        
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --start--
-    /**
-     * ログDBから閲覧回数を取得
-     *
-     * @param unknown_type $log_exception
-     * @param unknown_type $ranking_term_date
-     * @return unknown
-     */
-    public function getDownloadRankingData()
-    {
-        // Mod OpenDepo 2014/01/31 S.Arata --start--
-        $repositoryIndexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->TransStartDate);
-        $public_index_query = $repositoryIndexAuthorityManager->getPublicIndexQuery(false, $this->repository_admin_base, $this->repository_admin_room);
-        // Make TmpTable 2014/11/07 T.Ichikawa --start--
-        $now = date("YmdHis", strtotime($this->TransStartDate));
-        $public_index_query = $this->replaceQueryForTemporaryTable($public_index_query, $now, $cntGroupNum);
-        // Modify for remove IE Continuation log K.Matsuo 2011/11/17 --start-- 
-        $sqlCmd=" 
-            SELECT item.item_id,item.item_no,item.title,item.title_english,". DATABASE_PREFIX ."repository_file.file_name,". DATABASE_PREFIX ."repository_file.file_no,count(*)
-            FROM (
-                SELECT DISTINCT DATE_FORMAT( record_date, '%Y-%m-%d %H:%i' ) AS record_date,
-                    ip_address, item_id, item_no, attribute_id, file_no, user_id, operation_id, user_agent
-                    FROM ". DATABASE_PREFIX ."repository_log
-                    WHERE operation_id='2' ) AS ". DATABASE_PREFIX ."repository_log, 
-            ". DATABASE_PREFIX ."repository_item item 
-            INNER JOIN ". DATABASE_PREFIX ."repository_position_index pos ON item.item_id = pos.item_id AND item.item_no = pos.item_no AND pos.is_delete = 0
-            INNER JOIN (".$public_index_query.") pub ON pos.index_id = pub.index_id,
-            ". DATABASE_PREFIX ."repository_file
-            WHERE ". DATABASE_PREFIX ."repository_log.operation_id='2' 
-              AND ". DATABASE_PREFIX ."repository_log.item_id = ". DATABASE_PREFIX ."repository_file.item_id 
-              AND ". DATABASE_PREFIX ."repository_log.file_no = ". DATABASE_PREFIX ."repository_file.file_no 
-              AND item.item_id = ". DATABASE_PREFIX ."repository_file.item_id
-              AND ". DATABASE_PREFIX ."repository_log.attribute_id = ". DATABASE_PREFIX ."repository_file.attribute_id 
-              AND item.shown_date<=NOW()
-              AND ". DATABASE_PREFIX ."repository_log.record_date>='".$this->ranking_term_date."' ".
-              $this->log_exception.// Add log exception from ip address 2008.11.10 Y.Nakao
-              " AND item.shown_status = 1 ".
-              " AND item.is_delete = 0 ".
-              " GROUP BY ". DATABASE_PREFIX ."repository_log.item_id, ". DATABASE_PREFIX ."repository_log.attribute_id, ". DATABASE_PREFIX ."repository_log.file_no 
-            ORDER BY count(*) desc;     ";
-        $result = $this->Db->execute($sqlCmd);
-        $this->dropTemporaryTable($now, $cntGroupNum);
-        // Make TmpTable 2014/11/07 T.Ichikawa --end--
-        return $result;
-        // Mod OpenDepo 2014/01/31 S.Arata --end--
-            }
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --end--
-    
 
     /**
-     * ユーザランキング計算
+     * create regist users ranking data
      *
      */
-    function userRanking()
+    private function userRanking()
     {
-        $items = $this->getUserRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+        $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+        $ranking = BusinessFactory::getFactory()->getBusiness("businessRanking");
+        $items = $ranking->getUserRanking();
         
-          $len = count($items);
-          for ( $ii=0; $ii<$len && $ii<$this->rank_num; $ii++ ){
-              $hlink="";
-              $disp_flg = false;
-              if($ii < 3){
-                  $disp_flg = true;
-              }
-            array_push($this->user_ranking,Array(($ii+1),$items[$ii]['handle'],$items[$ii]['count(*)'],$hlink,$disp_flg));
-          }
-          $this->count_user = count($this->user_ranking);
+        $len = count($items);
+        for ( $ii=0; $ii<$len && $ii<$this->rank_num; $ii++ ){
+            $hlink="";
+            $disp_flg = false;
+            if($ii < 3){
+                $disp_flg = true;
+            }
+            array_push($this->user_ranking,Array(($ii+1),$items[$ii]['handle'],$items[$ii]['CNT'],$hlink,$disp_flg));
+        }
+        $this->count_user = count($this->user_ranking);
     }
     
-        
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --start--
-    /**
-     * ログDBからユーザランキングを取得
-     *
-     * @param unknown_type $log_exception
-     * @param unknown_type $ranking_term_date
-     * @return unknown
-     */
-    public function getUserRankingData(){
-        $sqlCmd="SELECT ". DATABASE_PREFIX ."users.handle,count(*)
-              FROM ". DATABASE_PREFIX ."repository_item
-                LEFT JOIN ". DATABASE_PREFIX ."users 
-                ON ". DATABASE_PREFIX ."users.user_id = ". DATABASE_PREFIX ."repository_item.ins_user_id 
-                LEFT JOIN ". DATABASE_PREFIX ."repository_log 
-                ON ". DATABASE_PREFIX ."repository_log.item_id = ". DATABASE_PREFIX ."repository_item.item_id 
-                AND ". DATABASE_PREFIX ."repository_log.item_no = ". DATABASE_PREFIX ."repository_item.item_no 
-              WHERE ". DATABASE_PREFIX ."repository_item.shown_status='1' 
-                AND ". DATABASE_PREFIX ."repository_item.shown_date<=NOW() 
-                AND ". DATABASE_PREFIX ."repository_item.shown_date>='".$this->ranking_term_date."' 
-                AND ". DATABASE_PREFIX ."repository_log.operation_id = '1' ".
-                $this->log_exception.// Add log exception from ip address 2008.11.10 Y.Nakao 
-            "   GROUP BY ". DATABASE_PREFIX ."repository_item.ins_user_id 
-                ORDER BY count(*) desc; ";
-        $items = $this->Db->execute($sqlCmd);
-        // Bug fix exclude unpublic index's item 2010/04/16 A.Suzuki --end--        
-        return $items;
-    }    
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --end--
-    
     /**
-     * 検索ワードランキング計算
+     * create keyword ranking data
      *
      */
-    function keywordRanking()
+    private function keywordRanking()
     {
-        $items = $this->getKeywordRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+        $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+        $ranking = BusinessFactory::getFactory()->getBusiness("businessRanking");
+        $items = $ranking->getKeywordRanking();
         
-          $len = count($items);
-          for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
+        $len = count($items);
+        for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
             $hlink = BASE_URL. "/?action=repository_opensearch&keyword=". urlencode($items[$ii]['search_keyword']);
-              $disp_flg = false;
-              if($ii < 3){
-                  $disp_flg = true;
-              }
-            array_push($this->keyword_ranking,Array(($ii+1),$items[$ii]['search_keyword'],$items[$ii]['count(*)'],$hlink,$disp_flg));
-          }
-          $this->count_keyword = count($this->keyword_ranking);
+            $disp_flg = false;
+            if($ii < 3){
+                $disp_flg = true;
+            }
+            array_push($this->keyword_ranking,Array(($ii+1),$items[$ii]['search_keyword'],$items[$ii]['CNT'],$hlink,$disp_flg));
+        }
+        $this->count_keyword = count($this->keyword_ranking);
     }
-
-        
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --start--
-    /**
-     * ログDBからキーワード検索回数を取得
-     *
-     * @param unknown_type $log_exception
-     * @param unknown_type $ranking_term_date
-     * @return unknown
-     */
-    public function getKeywordRankingData(){
-        $sqlCmd=" 
-            SELECT ". DATABASE_PREFIX ."repository_log.search_keyword,count(*) 
-              FROM ". DATABASE_PREFIX ."repository_log 
-              LEFT JOIN ". DATABASE_PREFIX ."repository_item 
-                ON ". DATABASE_PREFIX ."repository_log.item_id = ". DATABASE_PREFIX ."repository_item.item_id 
-              WHERE ". DATABASE_PREFIX ."repository_log.operation_id='4' 
-                AND NOT(". DATABASE_PREFIX ."repository_log.search_keyword='') 
-                AND ". DATABASE_PREFIX ."repository_log.record_date<=NOW() 
-                AND ". DATABASE_PREFIX ."repository_log.record_date>='".$this->ranking_term_date."' ".
-                $this->log_exception.// Add log exception from ip address 2008.11.10 Y.Nakao
-              "  GROUP BY ". DATABASE_PREFIX ."repository_log.search_keyword 
-              ORDER BY count(*) desc; 
-        ";
-        $items = $this->Db->execute($sqlCmd);
-        // Bug fix exclude unpublic index's item 2010/04/16 A.Suzuki --end--        
-        return $items;
-    }    
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --end--
     
     /**
-     * 新着アイテム計算
+     * create new item's data
      *
      */
-    function recentRanking()
+    private function recentRanking()
     {
-        $items = $this->getRecentRankingData(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
+        $this->infoLog("businessRanking", __FILE__, __CLASS__, __LINE__);
+        $ranking = BusinessFactory::getFactory()->getBusiness("businessRanking");
+        $items = $ranking->getNewItemRanking(); // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18
           
-          $len = count($items);
-          for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
-              $date = substr($items[$ii]['shown_date'],0,10);
-              $disp_flg = false;
-              if($ii < 3){
-                  $disp_flg = true;
-              }
-              
-              // check thumbnail
-//              if($ii == 0){
-                  $this->checkDownload($items[$ii]['item_id'], $items[$ii]['item_no'], "", "recent", $ii);
-//              }
-              
-              // Add title_english 2009/07/22 A.Suzuki --start--
-              if($this->select_lang == "japanese"){
-                  if($items[$ii]['title'] != "" && $items[$ii]['title'] != null){
-                      $display_title = $items[$ii]['title'];
-                  } else {
-                      $display_title = $items[$ii]['title_english'];
-                  }
-              } else {
-                  if($items[$ii]['title_english'] != "" && $items[$ii]['title_english'] != null){
-                      $display_title = $items[$ii]['title_english'];
-                  } else {
-                      $display_title = $items[$ii]['title'];
-                  }
-              }
+        $len = count($items);
+        for ( $ii=0; $ii<$len&&$ii<$this->rank_num; $ii++ ){
+            $date = substr($items[$ii]['shown_date'],0,10);
+            $disp_flg = false;
+            if($ii < 3){
+                $disp_flg = true;
+            }
+            $this->checkDownload($items[$ii]['item_id'], $items[$ii]['item_no'], "", "recent", $ii);
+            
+            // Add title_english 2009/07/22 A.Suzuki --start--
+            if($this->select_lang == "japanese"){
+                if($items[$ii]['title'] != "" && $items[$ii]['title'] != null){
+                    $display_title = $items[$ii]['title'];
+                } else {
+                    $display_title = $items[$ii]['title_english'];
+                }
+            } else {
+                if($items[$ii]['title_english'] != "" && $items[$ii]['title_english'] != null){
+                    $display_title = $items[$ii]['title_english'];
+                } else {
+                    $display_title = $items[$ii]['title'];
+                }
+            }
             // Add title_english 2009/07/22 A.Suzuki --end--
-              
+            
             array_push($this->newitem_ranking,Array(($ii+1),$display_title,$date,$items[$ii]['item_id'],$items[$ii]['item_no'],$disp_flg));
-           }
-           $this->count_recent = count($this->newitem_ranking);
+        }
+        $this->count_recent = count($this->newitem_ranking);
     }
     
-        
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --start--
-    /**
-     * アイテムDBから新着アイテムを取得
-     *
-     * @param unknown_type $log_exception
-     * @param unknown_type $ranking_term_date
-     * @return unknown
-     */
-    public function getRecentRankingData(){
-        // Mod OpenDepo 2014/01/31 S.Arata --start--
-        $repositoryIndexAuthorityManager = new RepositoryIndexAuthorityManager($this->Session, $this->dbAccess, $this->TransStartDate);
-        $public_index_query = $repositoryIndexAuthorityManager->getPublicIndexQuery(false, $this->repository_admin_base, $this->repository_admin_room);
-        // Make TmpTable 2014/11/07 T.Ichikawa --start--
-        $now = date("YmdHis", strtotime($this->TransStartDate));
-        $public_index_query = $this->replaceQueryForTemporaryTable($public_index_query, $now, $cntGroupNum);
-        
-        $sqlCmd=" 
-            SELECT DISTINCT item.item_id,item.item_no,item.title,item.title_english,item.shown_date
-              FROM ". DATABASE_PREFIX ."repository_item item
-              INNER JOIN ".DATABASE_PREFIX."repository_position_index pos
-              ON item.item_id = pos.item_id AND item.item_no = pos.item_no AND pos.is_delete = 0
-              INNER JOIN (".$public_index_query.") pub
-              ON pos.index_id = pub.index_id
-              WHERE item.shown_date >= '".$this->ranking_term_date."'
-                AND item.shown_date<=NOW() ".
-               " AND item.shown_status = 1 ".
-               " AND item.is_delete = 0 ".
-             " ORDER BY item.shown_date desc, item.item_id desc;
-        ";
-        $result = $this->Db->execute($sqlCmd);
-        $this->dropTemporaryTable($now, $cntGroupNum);
-        // Make TmpTable 2014/11/07 T.Ichikawa --end--
-        return $result;
-        // Mod OpenDepo 2014/01/31 S.Arata --end--
-            }
-    // Add ranking acquisition portion is made into a function K.Matsuo 2011/11/18 --end--
-    
     // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
     /**
      * ファイルダウンロード可否チェック
@@ -957,13 +365,14 @@ class Repository_View_Main_Ranking extends RepositoryAction
                  "   WHERE item_id = ? ".
                  "     AND item_no = ? ".
                  "       AND is_delete = 0 ".
-                 "ORDER BY file_no;";
+                 " ORDER BY file_no;";
         $params = null;
         $params[] = $item_id;
         $params[] = $item_no;
         $result = $this->Db->execute($query, $params);
         if($result === false){
-            return false;
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
         }
         
         $file_data = null;
@@ -1005,79 +414,344 @@ class Repository_View_Main_Ranking extends RepositoryAction
     // modify show thubnail all rank 2011/10/20 K.Matsuo --end--
     
     /**
-     * ランキング処理用に一時テーブルを使用する
-     * 
-     * @param string $query
-     * @param string $date
+     * getter admin param
+     *
+     * @param string $paramName
+     * @return param_value
      */
-     private function replaceQueryForTemporaryTable($mod_query, $date, &$cntGroupNum=0) {
-        // 一時テーブル作成
-        $query = "CREATE TEMPORARY TABLE ". DATABASE_PREFIX. "repository_index_browsing_authority_".$date." ".
-                 "( PRIMARY KEY (`index_id`), ".
-                   "KEY `index_browsing_authority` (`exclusive_acl_role_id`,`exclusive_acl_room_auth`,`public_state`,`pub_date`,`is_delete`), ".
-                   "KEY `index_public_state` (`public_state`,`pub_date`,`is_delete`) ) ".
-                 "SELECT * FROM ". DATABASE_PREFIX. "repository_index_browsing_authority ;";
-        $result = $this->Db->execute($query);
-        
-        // Bug Fix temporary table can read only once 2014/11/20 T.Koyasu --start--
-        // repository_index_browsing_groups is multiple exist in $mod_query
-        // temporary table can read only once in query
-        // therefore, create temporary table more than once
-        // 一時テーブルを一つのクエリ内で複数回参照するとエラーとなる
-        // $mod_query内にはrepository_index_browsing_groupsの記述が複数回(1~2)含まれているため、
-        // $mod_query内の出現回数を調べ、その分ユニークな一時テーブルを作成している
-        $word_num = mb_substr_count($mod_query, DATABASE_PREFIX. "repository_index_browsing_groups");
-        for($temp_table_num = 0; $temp_table_num < $word_num; $temp_table_num++){
-            $query = "CREATE TEMPORARY TABLE ". DATABASE_PREFIX. "repository_index_browsing_groups_".$date."_". $temp_table_num. " ".
-                     "( PRIMARY KEY (`index_id`,`exclusive_acl_group_id`) ) ".
-                     "SELECT * FROM ". DATABASE_PREFIX. "repository_index_browsing_groups ;";
-            $result = $this->Db->execute($query);
-            $cntGroupNum++;
+    private function getAdminParamByName($paramName)
+    {
+        $query = "SELECT param_value FROM ". DATABASE_PREFIX ."repository_parameter WHERE param_name=?";
+        $params = array();
+        $params[] = $paramName;
+        $result = $this->Db->execute($query, $params);
+        if($result === false || count($result) === 0){
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
         }
-        // Bug Fix temporary table can read only once 2014/11/20 T.Koyasu --end--
-        
-        $query = "CREATE TEMPORARY TABLE ". DATABASE_PREFIX. "pages_users_link_".$date." ".
-                 "( PRIMARY KEY (`room_id`,`user_id`), ".
-                   "KEY `user_id` (`user_id`) ) ".
-                 "SELECT * FROM ". DATABASE_PREFIX. "pages_users_link ;";
-        $result = $this->Db->execute($query);
-        // クエリを一時テーブルを参照するよう修正
-        $mod_query = str_replace(DATABASE_PREFIX."repository_index_browsing_authority", 
-                                 DATABASE_PREFIX."repository_index_browsing_authority_".$date, 
-                                 $mod_query);
         
-        // Bug Fix temporary table can read only once 2014/11/20 T.Koyasu --start--
-        // replace repository_index_browsing_groups to repository_index_browsing_groups
-        $pattern = "/". DATABASE_PREFIX. "repository_index_browsing_groups[^_]/";
-        $limit = 1;
-        for($temp_table_num = 0; $temp_table_num < $word_num; $temp_table_num++){
-            $replacement = DATABASE_PREFIX."repository_index_browsing_groups_".$date. "_". $temp_table_num. " ";
-            $mod_query = preg_replace($pattern, $replacement, $mod_query, $limit);
+        return $result[0]['param_value'];
+    }
+    
+    /**
+     * create ranking data from database
+     *
+     * @return unknown
+     */
+    private function setRankingDataFromDatabase()
+    {
+       // get ranking data from repository_ranking
+       $query = "SELECT * ".
+                "FROM " .DATABASE_PREFIX ."repository_ranking ".
+                "WHERE is_delete = 0 ".
+                "ORDER BY rank;";
+       $result = $this->Db->execute($query);
+       if($result === false){
+            $this->errorLog($this->Db->ErrorMsg(), __FILE__, __CLASS__, __LINE__);
+            throw new AppException($this->Db->ErrorMsg());
+       }
+       
+       for ( $ii=0; $ii<count($result); $ii++ ){
+           switch($result[$ii]['rank_type']){
+               case "referRanking":
+                   if($this->ranking_is_disp_browse_item == "1"){
+                       if(count($this->refer_ranking) < $this->rank_num) {
+                           $disp_flg = false;
+                           if(count($this->refer_ranking) < 3){
+                               // check thumbnail
+                               // modify show thumbnail all rank 2011/10/20 K.Matsuo --start--
+                               $disp_flg = true;
+                               $this->checkDownload($result[$ii]['item_id'], $result[$ii]['item_no'], "", "refer", count($this->refer_ranking));
+                               // modify show thumbnail all rank 2011/10/20 K.Matsuo --end--
+                           }
+                           
+                           // Add title_english 2009/07/22 A.Suzuki --start--
+                           if($this->select_lang == "japanese"){
+                               if($result[$ii]['disp_name'] != "" && $result[$ii]['disp_name'] != null){
+                                   $display_title = $result[$ii]['disp_name'];
+                               } else {
+                                   $display_title = $result[$ii]['disp_name_english'];
+                               }
+                           } else {
+                               if($result[$ii]['disp_name_english'] != "" && $result[$ii]['disp_name_english'] != null){
+                                   $display_title = $result[$ii]['disp_name_english'];
+                               } else {
+                                   $display_title = $result[$ii]['disp_name'];
+                               }
+                           }
+                           // Add title_english 2009/07/22 A.Suzuki --end--
+                             
+                           array_push($this->refer_ranking,Array($result[$ii]['rank'],$display_title,$result[$ii]['disp_value'],$result[$ii]['item_id'],$result[$ii]['item_no'], $disp_flg));
+                       }
+                   }
+                   break;
+               case "downloadRanking":
+                   if($this->ranking_is_disp_download_item == "1"){
+                       if(count($this->download_ranking) < $this->rank_num) {
+                           $disp_flg = false;
+                           // check thumbnail
+                           // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
+                           if(count($this->download_ranking) < 3){
+                               $disp_flg = true;
+                               $this->checkDownload($result[$ii]['item_id'], $result[$ii]['item_no'], $result[$ii]['file_no'], "download", count($this->download_ranking));
+                           }
+                           // modify show thubnail all rank 2011/10/20 K.Matsuo --end--
+                           // Add title_english 2009/07/22 A.Suzuki --start--
+                           if($this->select_lang == "japanese"){
+                               if($result[$ii]['disp_name'] != "" && $result[$ii]['disp_name'] != null){
+                                   $display_title = $result[$ii]['disp_name'];
+                               } else {
+                                   $display_title = $result[$ii]['disp_name_english'];
+                               }
+                           } else {
+                               if($result[$ii]['disp_name_english'] != "" && $result[$ii]['disp_name_english'] != null){
+                                   $display_title = $result[$ii]['disp_name_english'];
+                               } else {
+                                   $display_title = $result[$ii]['disp_name'];
+                               }
+                           }
+                           // Add title_english 2009/07/22 A.Suzuki --end--
+                             
+                           array_push($this->download_ranking,Array($result[$ii]['rank'],$display_title,$result[$ii]['disp_value'],$result[$ii]['item_id'],$result[$ii]['item_no'], $disp_flg));
+                       }
+                   }
+                   break;
+               case "userRanking":
+                   if($this->ranking_is_disp_item_creator == "1"){
+                       if(count($this->user_ranking) < $this->rank_num) {
+                           $hlink = "";
+                           $disp_flg = false;
+                           if(count($this->user_ranking) < 3){
+                               $disp_flg = true;
+                           }
+                           // check thumbnail
+                           array_push($this->user_ranking,Array($result[$ii]['rank'],$result[$ii]['disp_name'],$result[$ii]['disp_value'],$hlink, $disp_flg));
+                       }
+                   }
+                   break;
+               case "keywordRanking":
+                   if($this->ranking_is_disp_keyword == "1"){
+                       if(count($this->keyword_ranking) < $this->rank_num) {
+                           $hlink = BASE_URL. "/?action=repository_opensearch&keyword=". urlencode($result[$ii]['disp_name']);
+                           $disp_flg = false;
+                           if(count($this->keyword_ranking) < 3){
+                               $disp_flg = true;
+                           }
+                           array_push($this->keyword_ranking,Array($result[$ii]['rank'],$result[$ii]['disp_name'],$result[$ii]['disp_value'],$hlink, $disp_flg));
+                       }
+                   }
+                   break;
+               case "recentRanking":
+                   if($this->ranking_is_disp_recent_item == "1"){
+                       if(count($this->newitem_ranking) < $this->rank_num) {
+                           $disp_flg = false;
+                           if(count($this->newitem_ranking) < 3){
+                               $disp_flg = true;
+                               // check thumbnail
+                               // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
+                               $this->checkDownload($result[$ii]['item_id'], $result[$ii]['item_no'], "", "recent", count($this->newitem_ranking));
+                               // modify show thubnail all rank 2011/10/20 K.Matsuo --start--
+                           }
+                             
+                           // Add title_english 2009/07/22 A.Suzuki --start--
+                           if($this->select_lang == "japanese"){
+                               if($result[$ii]['disp_name'] != "" && $result[$ii]['disp_name'] != null){
+                                   $display_title = $result[$ii]['disp_name'];
+                               } else {
+                                   $display_title = $result[$ii]['disp_name_english'];
+                               }
+                           } else {
+                               if($result[$ii]['disp_name_english'] != "" && $result[$ii]['disp_name_english'] != null){
+                                   $display_title = $result[$ii]['disp_name_english'];
+                               } else {
+                                   $display_title = $result[$ii]['disp_name'];
+                               }
+                           }
+                           // Add title_english 2009/07/22 A.Suzuki --end--
+                             
+                           array_push($this->newitem_ranking,Array($result[$ii]['rank'],$display_title,$result[$ii]['disp_value'],$result[$ii]['item_id'],$result[$ii]['item_no'], $disp_flg));
+                       }
+                   }
+                   break;
+               default:
+           }
+       }
+       
+       $this->count_refer = count($this->refer_ranking);
+       $this->count_download = count($this->download_ranking);
+       $this->count_user = count($this->user_ranking);
+       $this->count_keyword = count($this->keyword_ranking);
+       $this->count_recent = count($this->newitem_ranking);
+    }
+    
+    /**
+     * if ranking data less 3, push empty data
+     *
+     */
+    private function setEmptyRanking()
+    {
+        if($this->count_refer !=  0 && $this->count_refer < 3){
+            for($ii=$this->count_refer;$ii < 3; $ii++){
+                array_push($this->refer_ranking,Array($ii+1,"","","","","true"));
+                $this->count_refer++;
+            }
+        }
+        if($this->count_download != 0 && $this->count_download < 3){
+            for($ii=$this->count_download;$ii < 3; $ii++){
+                array_push($this->download_ranking,Array($ii+1,"","","","","true"));
+                $this->count_download++;
+            }
+        }
+           if($this->count_user != 0 && $this->count_user < 3){
+            for($ii=$this->count_user;$ii < 3; $ii++){
+                array_push($this->user_ranking,Array($ii+1,"","","","true"));
+                $this->count_user++;
+            }
+        }
+           if($this->count_keyword != 0 && $this->count_keyword < 3){
+            for($ii=$this->count_keyword;$ii < 3; $ii++){
+                array_push($this->keyword_ranking,Array($ii+1,"","","","true"));
+                $this->count_keyword++;
+            }
+        }
+        if($this->count_recent != 0 && $this->count_recent < 3){
+            for($ii=$this->count_recent;$ii < 3; $ii++){
+                array_push($this->newitem_ranking,Array($ii+1,"","","","","true"));
+                $this->count_recent++;
+            }
+        }
+    }
+    
+    private function getViewResult()
+    {
+        $smartphoneFlg = false;
+        if(_REPOSITORY_SMART_PHONE_DISPLAY)
+        {
+            $smartphoneFlg = true;
         }
-        // Bug Fix temporary table can read only once 2014/11/20 T.Koyasu --end--
-        
-        $mod_query = str_replace(DATABASE_PREFIX."pages_users_link", 
-                                 DATABASE_PREFIX."pages_users_link_".$date, 
-                                 $mod_query);
         
-        return $mod_query;
-     }
-     
+        if($this->Session->getParameter("serach_screen") == 2 && $this->Session->getParameter("ranking_flg") == 1)
+        {
+            // Fix advanced search for ranking view at top page. Y.Nakao 2014/01/14 --start--
+            require_once WEBAPP_DIR."/modules/repository/components/RepositorySearchRequestParameter.class.php";
+            $searchParam = new RepositorySearchRequestParameter();
+            $searchParam->setActionParameter();
+            $this->search_type = $searchParam->all_search_type;
+            $this->active_search_flag = $searchParam->active_search_flag;
+            $this->detail_search_usable_item = $searchParam->detail_search_usable_item;
+            $this->detail_search_item_type = $searchParam->detail_search_item_type;
+            $this->detail_search_select_item = $searchParam->detail_search_select_item;
+            for($ii = 0; $ii < count($this->detail_search_select_item); $ii++) {
+                if(array_key_exists("value", $this->detail_search_select_item[$ii])) {
+                    $this->detail_search_select_item[$ii]["value"] = str_replace("\\", "\\\\", $this->detail_search_select_item[$ii]["value"]);
+                }
+            }
+            $this->default_detail_search = $searchParam->default_detail_search;
+            // Fix advanced search for ranking view at top page. Y.Nakao 2014/01/14 --end--
+            $this->Session->setParameter("ranking_flg", 0);
+            // Add smart phone support T.Koyasu 2012/04/03 -start-
+            if($smartphoneFlg){
+                return 'snippet_sp';
+            } else {
+                return 'snippet';
+            }
+            // Add smart phone support T.Koyasu 2012/04/03 -end-
+        } else {
+            // Add child index display more 2009/01/20 Y.Nakao --start--
+            // ランキングのみの表示であるフラグを立てる this view action is dispay ranking
+            $this->display_ranking = "true";
+            // Add child index display more 2009/01/20 Y.Nakao --end-- 
+            
+            // Add smart phone support T.Koyasu 2012/04/02 -start-
+            if($smartphoneFlg){
+                return 'success_sp';
+            } else {
+                return 'success';
+            }
+            // Add smart phone support T.Koyasu 2012/04/02 -end-
+        }
+    }
+    
+    /** 
+     * get download status from session
+     * when download export-file from repository_uri access
+     *
+     */
+    private function downloadExportFileFromRepositoryUri()
+    {
+        $this->uri_export = $this->Session->getParameter("uri_export");
+        $this->Session->removeParameter("uri_export");
+           if(!is_array($this->uri_export) || count($this->uri_export) != 4){
+            $this->uri_export = null;
+        } else {
+            $tmp_status = $this->uri_export["status"];
+            $this->uri_export["status"] = $this->checkExportFileDownload($this->uri_export["status"]);
+            if($tmp_status == "login"){
+                // ログイン処理を読みだす
+                // sessionにはreloadを保存、表示にはloginを使用
+                $this->Session->setParameter("uri_export", $this->uri_export);
+                $this->uri_export["status"] = "login";
+            } else if($tmp_status == "download" && $this->uri_export["status"] == "true"){
+                // ログイン処理実行
+                // sessionは解放、表示にはdownloadを使用
+                $this->uri_export["status"] = "download";
+            } else {
+                // ログインキャンセルとかエラーとか予期せぬ事態
+                $this->uri_export["status"] = "";
+                $tmp = false;
+            }
+        }
+    }
+    
     /**
-     * ランキング処理用の一時テーブルを削除する
-     * 
-     * @param string $date
-     * @param int    $cntGroupNum
+     * get item_id, item_no, attribute_id and file_no of download file when download file after login
+     *
      */
-     private function dropTemporaryTable($date, $cntGroupNum) {
-        $this->Db->execute("DROP TEMPORARY TABLE IF EXISTS ".DATABASE_PREFIX ."repository_index_browsing_authority_".$date.";");
-        // Bug Fix temporary table can read only once 2014/11/20 T.Koyasu --start--
-        // drop table to all temporary table "repository_index_browsing_groups_YYYYMMDD_?" by wild card
-        for($ii = 0; $ii < $cntGroupNum; $ii++){
-            $this->Db->execute("DROP TEMPORARY TABLE IF EXISTS ".DATABASE_PREFIX ."repository_index_browsing_groups_".$date."_".$ii.";");
+    private function isDownloadFileAfterLogin()
+    {
+        // add file download after login T.Ichikawa 2015/02/03 --start-- 
+        $user_id = $this->Session->getParameter("_user_id");
+        if(strlen($this->fileIdx) == 0 && $user_id != "0" && strlen($this->Session->getParameter("_login_id")) != 0)
+        {
+            // file download login.
+            $this->fileIdx = $this->Session->getParameter('repository'.$this->block_id.'FileDownloadKey');
         }
-        // Bug Fix temporary table can read only once 2014/11/20 T.Koyasu --end--
-        $this->Db->execute("DROP TEMPORARY TABLE IF EXISTS ".DATABASE_PREFIX ."pages_users_link_".$date.";");
-     }
+        $this->Session->removeParameter('repository'.$this->block_id.'FileDownloadKey');
+        // add file download after login T.Ichikawa 2015/02/03 --end--
+    }
+    
+    /**
+     * get index list when show index list
+     *
+     */
+    private function showIndexListForTopPage()
+    {
+        $repositoryAction = new RepositoryAction();
+        $repositoryAction->Db = $this->Db;
+        $repositoryAction->Session = $this->Session;
+        $repositoryAction->TransStartDate = $this->accessDate;
+        $this->select_index_list_display = $repositoryAction->getSelectIndexListDisplay();
+        if($this->select_index_list_display == 1) {
+            // Add Advanced Search 2013/11/26 R.Matsuura --start--
+            $indexManager = new RepositoryIndexManager($this->Session, $this->Db, $this->accessDate);
+            // Add Advanced Search 2013/11/26 R.Matsuura --end--
+            $this->select_index_list = $indexManager->getDisplayIndexList($this->repository_admin_base, $this->repository_admin_room);    
+        }
+        
+        $this->oaiore_icon_display = $this->getAdminParamByName('oaiore_icon_display');
+    }
+    
+    /**
+     * setting and get parameter by session when top page is ranking
+     *
+     */
+    private function showTopPageProcess()
+    {
+        $this->downloadExportFileFromRepositoryUri();
+        
+        $this->isDownloadFileAfterLogin();
+        
+        $this->showIndexListForTopPage();
+    }
 }
 ?>
diff --git a/repository/view/main/ranking/maple.ini b/repository/view/main/ranking/maple.ini
index eac7c9d..862c439 100644
--- a/repository/view/main/ranking/maple.ini
+++ b/repository/view/main/ranking/maple.ini
@@ -14,6 +14,7 @@ snippet = "repository_item_snippet.html"
 
 success_sp = "smartphone/repository_ranking.html"
 snippet_sp = "smartphone/repository_item_snippet.html"
+invalid = "repository_error_invalid_auth.html"
 
 [MobileView]
 define:theme = 1
@@ -21,6 +22,7 @@ success = "repository_mobile_ranking.html"
 success_sp = "repository_mobile_ranking.html"
 snippet = "repository_mobile_item_snippet.html"
 snippet_sp = "repository_mobile_item_snippet.html"
+invalid = "repository_error_invalid_auth.html"
 
 [SmartyAssign]
 module = main.ini
diff --git a/repository/view/main/suppleworkflow/Suppleworkflow.class.php b/repository/view/main/suppleworkflow/Suppleworkflow.class.php
index c7f4d02..c1719fb 100644
--- a/repository/view/main/suppleworkflow/Suppleworkflow.class.php
+++ b/repository/view/main/suppleworkflow/Suppleworkflow.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Suppleworkflow.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Suppleworkflow.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -299,12 +299,12 @@ class Repository_View_Main_Suppleworkflow extends RepositoryAction
 				 "FROM ". DATABASE_PREFIX ."repository_supple AS SUPPLE, ".	// サプリテーブル
 				 		  DATABASE_PREFIX ."repository_item AS ITEM ".			// アイテムテーブル
 				 "WHERE SUPPLE.ins_user_id = '". $user_id ."' ".	// 作成者が自分
-				 " AND SUPPLE.is_delete = '0' ";			// 削除されていない
+				 " AND SUPPLE.is_delete = 0 ";			// 削除されていない
 		if($review_status!=null && $review_status!=""){
-			$query .= " AND SUPPLE.supple_review_status = '".$review_status."' ";	// 査読状況
+			$query .= " AND SUPPLE.supple_review_status = ".$review_status." ";	// 査読状況
 		}
 		if($reject_status!=null && $reject_status!=""){
-		 	$query .= " AND SUPPLE.supple_reject_status = '".$reject_status."' ";	// 却下状況
+		 	$query .= " AND SUPPLE.supple_reject_status = ".$reject_status." ";	// 却下状況
 		}
 		$query .= " AND SUPPLE.item_id = ITEM.item_id ".
 				  " AND SUPPLE.item_no = ITEM.item_no ".
diff --git a/repository/view/main/workflow/Workflow.class.php b/repository/view/main/workflow/Workflow.class.php
index 714645d..22dbb1a 100644
--- a/repository/view/main/workflow/Workflow.class.php
+++ b/repository/view/main/workflow/Workflow.class.php
@@ -1,7 +1,7 @@
 <?php
 // --------------------------------------------------------------------
 //
-// $Id: Workflow.class.php 516 2012-05-22 09:30:55Z ivis $
+// $Id: Workflow.class.php 53594 2015-05-28 05:25:53Z kaede_matsushita $
 //
 // Copyright (c) 2007 - 2008, National Institute of Informatics, 
 // Research and Development Center for Scientific Information Resources
@@ -353,7 +353,7 @@ class Repository_View_Main_Workflow extends RepositoryAction
 				 "FROM ". DATABASE_PREFIX ."repository_item ITEM, ".				// アイテムテーブル
 				 		  DATABASE_PREFIX ."repository_item_type ITEMTYPE ".	// アイテムタイプテーブル
 				 "WHERE (ITEM.ins_user_id = '". $user_id ."' OR ITEM.mod_user_id = '". $user_id ."' ) ".	// 作成者が自分
-				 " AND ITEM.is_delete = '0' ";			// 削除されていない
+				 " AND ITEM.is_delete = 0 ";			// 削除されていない
 		if($review_status!=null && $review_status!=""){
 			$query .= " AND ITEM.review_status = '".$review_status ."' ";	// 査読状況
 		}
